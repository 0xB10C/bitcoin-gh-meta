[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19967 (test: Replace (dis)?connect_nodes globals with TestFramework methods by robot-dreams)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-10-03T20:27:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20074#issuecomment-703160726",
      "id" : 703160726,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20074",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMzE2MDcyNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-03T20:27:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/703160726",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20074#discussion_r499226290"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20074"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499226290"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ISTM this stopping, restarting, and connecting can be avoided per https://github.com/bitcoin/bitcoin/pull/19720/files#r499226085.",
      "commit_id" : "1a3f92da41f7a41a1f1eabd246c25e771bfdd29c",
      "created_at" : "2020-10-04T09:41:57Z",
      "diff_hunk" : "@@ -47,11 +47,25 @@ def set_test_params(self):\n         self.rpc_timeout = 480\n         self.num_nodes = 2\n         self.extra_args = [\n-            [\"-blockfilterindex\", \"-peerblockfilters\"],\n-            [\"-blockfilterindex\"],\n+            [\"-blockfilterindex=basic\", \"-peerblockfilters\"],\n+            [\"-blockfilterindex=basic\", \"-peerblockfilters=0\"],\n         ]\n \n     def run_test(self):\n+        self.stop_node(0)\n+\n+        self.log.info('Check that -peerblockfilters without -blockfilterindex raises init error')\n+        err_msg = 'Error: Cannot set -peerblockfilters without -blockfilterindex.'\n+        self.nodes[0].assert_start_raises_init_error(['-blockfilterindex=0', '-peerblockfilters'], err_msg)\n+\n+        self.log.info('Check that passing unknown -blockfilterindex type raises init error')\n+        err_msg = 'Error: Unknown -blockfilterindex value foo.'\n+        self.nodes[0].assert_start_raises_init_error(['-blockfilterindex=foo', '-peerblockfilters'], err_msg)\n+\n+        # Restart and restore default \"chain\" topology\n+        self.start_node(0, extra_args=self.extra_args[0])\n+        self.connect_nodes(1, 0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20074#discussion_r499226290",
      "id" : 499226290,
      "line" : 67,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTIyNjI5MA==",
      "original_commit_id" : "1a3f92da41f7a41a1f1eabd246c25e771bfdd29c",
      "original_line" : 67,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blockfilters.py",
      "position" : 32,
      "pull_request_review_id" : 501606982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20074",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-04T09:52:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499226290",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20074#discussion_r499226473"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20074"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499226473"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: here, above line 57, and below line 212, I prefer the less-verbose \"Test...\" over \"Check that...\" and it's also probably the most frequently used term in the functional test logging. It's subjective though, apart from being less long.",
      "commit_id" : "1a3f92da41f7a41a1f1eabd246c25e771bfdd29c",
      "created_at" : "2020-10-04T09:44:13Z",
      "diff_hunk" : "@@ -47,11 +47,25 @@ def set_test_params(self):\n         self.rpc_timeout = 480\n         self.num_nodes = 2\n         self.extra_args = [\n-            [\"-blockfilterindex\", \"-peerblockfilters\"],\n-            [\"-blockfilterindex\"],\n+            [\"-blockfilterindex=basic\", \"-peerblockfilters\"],\n+            [\"-blockfilterindex=basic\", \"-peerblockfilters=0\"],\n         ]\n \n     def run_test(self):\n+        self.stop_node(0)\n+\n+        self.log.info('Check that -peerblockfilters without -blockfilterindex raises init error')\n+        err_msg = 'Error: Cannot set -peerblockfilters without -blockfilterindex.'\n+        self.nodes[0].assert_start_raises_init_error(['-blockfilterindex=0', '-peerblockfilters'], err_msg)\n+\n+        self.log.info('Check that passing unknown -blockfilterindex type raises init error')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20074#discussion_r499226473",
      "id" : 499226473,
      "line" : 61,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTIyNjQ3Mw==",
      "original_commit_id" : "1a3f92da41f7a41a1f1eabd246c25e771bfdd29c",
      "original_line" : 61,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blockfilters.py",
      "position" : 26,
      "pull_request_review_id" : 501606982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20074",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-04T09:52:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499226473",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20074#discussion_r499226914"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20074"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499226914"
         }
      },
      "author_association" : "MEMBER",
      "body" : "pico-nit, if you retouch maybe (a) s/get/Get/ and (b) can remove the EOL full stop per most frequent practice in the functional test logging",
      "commit_id" : "1a3f92da41f7a41a1f1eabd246c25e771bfdd29c",
      "created_at" : "2020-10-04T09:49:13Z",
      "diff_hunk" : "@@ -78,7 +92,7 @@ def run_test(self):\n         assert int(self.nodes[0].getnetworkinfo()['localservices'], 16) & NODE_COMPACT_FILTERS != 0\n         assert int(self.nodes[1].getnetworkinfo()['localservices'], 16) & NODE_COMPACT_FILTERS == 0\n \n-        self.log.info(\"get cfcheckpt on chain to be re-orged out.\")\n+        self.log.debug(\"get cfcheckpt on chain to be re-orged out.\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20074#discussion_r499226914",
      "id" : 499226914,
      "line" : 95,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTIyNjkxNA==",
      "original_commit_id" : "1a3f92da41f7a41a1f1eabd246c25e771bfdd29c",
      "original_line" : 95,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blockfilters.py",
      "position" : 42,
      "pull_request_review_id" : 501606982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20074",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-04T09:52:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499226914",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20074#discussion_r499227004"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20074"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499227004"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, here and line 106, can remove the full stop while changing this",
      "commit_id" : "1a3f92da41f7a41a1f1eabd246c25e771bfdd29c",
      "created_at" : "2020-10-04T09:50:10Z",
      "diff_hunk" : "@@ -195,7 +209,7 @@ def run_test(self):\n         computed_cfhash = uint256_from_str(hash256(cfilter.filter_data))\n         assert_equal(computed_cfhash, stale_cfhashes[999])\n \n-        self.log.info(\"Requests to node 1 without NODE_COMPACT_FILTERS results in disconnection.\")\n+        self.log.info(\"Check that requests without NODE_COMPACT_FILTERS results in disconnection.\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20074#discussion_r499227004",
      "id" : 499227004,
      "line" : 212,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTIyNzAwNA==",
      "original_commit_id" : "1a3f92da41f7a41a1f1eabd246c25e771bfdd29c",
      "original_line" : 212,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blockfilters.py",
      "position" : 60,
      "pull_request_review_id" : 501606982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20074",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-04T09:52:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499227004",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Just found an odd edge case in manual testing when the node is already up:\r\n```\r\n$ ./src/bitcoind -blockfilterindex=1\r\nError: Cannot obtain a lock on data directory /###/.bitcoin. Bitcoin Core is probably already running.\r\n\r\n$ ./src/bitcoind -blockfilterindex=basic\r\nError: Unknown -blockfilterindex value 1.\r\n```\r\nEdit: the cause was setting `blockfilterindex=1` in `bitcoin.conf`, removing that line then yields:\r\n```\r\n$ ./src/bitcoind -blockfilterindex=basic\r\nError: Cannot obtain a lock on data directory /###/.bitcoin. Bitcoin Core is probably already running.\r\n```",
      "created_at" : "2020-10-04T09:59:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20074#issuecomment-703231595",
      "id" : 703231595,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20074",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMzIzMTU5NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-04T10:13:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/703231595",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Seems reproducible:\r\n```python\r\nself.log.info('Test passing two valid -blockfilter types raises init error')\r\nerr_msg = 'Error: Unknown -blockfilterindex value basic -blockfilterindex=1.'\r\nself.nodes[0].assert_start_raises_init_error(['-blockfilterindex=basic -blockfilterindex=1', '-peerblockfilters'], err_msg)\r\nerr_msg = 'Error: Unknown -blockfilterindex value basic -blockfilterindex=basic.'\r\nself.nodes[0].assert_start_raises_init_error(['-blockfilterindex=basic -blockfilterindex=basic', '-peerblockfilters'], err_msg)\r\nerr_msg = 'Error: Unknown -blockfilterindex value 1 -blockfilterindex=basic.'\r\nself.nodes[0].assert_start_raises_init_error(['-blockfilterindex=1 -blockfilterindex=basic', '-peerblockfilters'], err_msg)\r\nerr_msg = 'Error: Unknown -blockfilterindex value 1 -blockfilterindex=1.'\r\nself.nodes[0].assert_start_raises_init_error(['-blockfilterindex=1 -blockfilterindex=1', '-peerblockfilters'], err_msg)\r\neerblockfilters'], err_msg)\r\n```",
      "created_at" : "2020-10-04T11:15:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20074#issuecomment-703239941",
      "id" : 703239941,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20074",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMzIzOTk0MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-04T11:15:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/703239941",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
