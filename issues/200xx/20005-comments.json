[
   {
      "author_association" : "MEMBER",
      "body" : "Another observation by @roconnor-blockstream: it seems `memcmp(...) <= 0` is not affected, while `memcmp(...) < 0`.",
      "created_at" : "2020-09-23T18:36:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/20005#issuecomment-697857319",
      "id" : 697857319,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20005",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5Nzg1NzMxOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-23T18:36:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/697857319",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Technically my claim was, from my very limited understanding, the bug can only change non-zero results from memcpy to zero results.  Still, even in this case if the result of `memcmp(x,y)` is changed from a `1` to a `0`, the value of `memcmp(...) <= 0` will change from false to true.",
      "created_at" : "2020-09-23T20:49:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/20005#issuecomment-697965176",
      "id" : 697965176,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20005",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5Nzk2NTE3Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-23T20:49:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/697965176",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/21371712?v=4",
         "events_url" : "https://api.github.com/users/roconnor-blockstream/events{/privacy}",
         "followers_url" : "https://api.github.com/users/roconnor-blockstream/followers",
         "following_url" : "https://api.github.com/users/roconnor-blockstream/following{/other_user}",
         "gists_url" : "https://api.github.com/users/roconnor-blockstream/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/roconnor-blockstream",
         "id" : 21371712,
         "login" : "roconnor-blockstream",
         "node_id" : "MDQ6VXNlcjIxMzcxNzEy",
         "organizations_url" : "https://api.github.com/users/roconnor-blockstream/orgs",
         "received_events_url" : "https://api.github.com/users/roconnor-blockstream/received_events",
         "repos_url" : "https://api.github.com/users/roconnor-blockstream/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/roconnor-blockstream/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/roconnor-blockstream/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/roconnor-blockstream"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Here is the example of the bug appearing when using the `>` operator on 2 arrays: https://godbolt.org/z/j5en9d\r\nHere it appears with `std::lexicographical_compare`: https://godbolt.org/z/a6scYK\r\n\r\n`-fno-builtin-memcmp` Doesn't do anything for either of these (as they didn't call `memcmp`)",
      "created_at" : "2020-09-24T20:28:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/20005#issuecomment-698571650",
      "id" : 698571650,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20005",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5ODU3MTY1MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-24T21:25:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/698571650",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@elichai Great find. That's... unfortunate.\r\n\r\nIt appears that code paths that use memcmp for (in)equality checks (e.g. memcmp(...) == 0) are unaffected. I suspect this means that automatically generated operator== on simple classes/structs aren't affected either. @real-or-random also found evidence for this in the bug's code.\r\n\r\nHowever, @elichai's finding means that `-fno-builtin-memcmp` is not enough, as there are C++ headers that directly invoke `__builtin_memcmp`. Some possibilities (we're not restricted to just one of them, though):\r\n* Outlaw compiling with affected compilers entirely (by introducing a sanity check, and a unit test)\r\n* Figure out exactly which GCC `-f...` optimization flag controls the presence of the bug, and disabled that (always, or selectively on known-bad compilers)\r\n* Find the subset of affected C++ headers, and remove them from the codebase (replace them with my_memcmp where needed or so).",
      "created_at" : "2020-09-24T20:58:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/20005#issuecomment-698584843",
      "id" : 698584843,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20005",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5ODU4NDg0Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-24T20:58:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/698584843",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Another worth mentioning is that `arith_uint256` managed to dodge this: https://github.com/bitcoin/bitcoin/blob/master/src/arith_uint256.h#L217-L222\r\n\r\nwhile manually going over all the `-O2` flags in my GCC 10.2 I found that disabling these 5 flags make the bug disappear:\r\n`-fno-tree-dce -fno-tree-dominator-opts -fno-tree-fre -fno-tree-pre -fno-code-hoisting`\r\n\r\nquickly reading the description of these they don't sound like something we'd like to disable that quickly :(",
      "created_at" : "2020-09-24T21:26:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/20005#issuecomment-698597260",
      "id" : 698597260,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20005",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5ODU5NzI2MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-24T21:28:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/698597260",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This is a patch against the broken GCC versions that emits a warning when the bug could be triggered:\r\nhttps://gist.github.com/real-or-random/1548239059158370416dfdc6a866329a\r\n\r\nWhen I compile the project with this patch, I don't get any warning. That's good news. But unfortunately, this is not perfeclty sound. It catches all known examples but it fails to catch the `std::lexicographical_compare` example in this thread.... Maybe the reason is buried somewhere in this function but I don't know. https://gcc.gnu.org/onlinedocs/gcc-10.2.0/libstdc++/api/a00596_source.html#l01592",
      "created_at" : "2020-09-25T18:14:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/20005#issuecomment-699078122",
      "id" : 699078122,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20005",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5OTA3ODEyMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-25T18:14:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/699078122",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1071625?v=4",
         "events_url" : "https://api.github.com/users/real-or-random/events{/privacy}",
         "followers_url" : "https://api.github.com/users/real-or-random/followers",
         "following_url" : "https://api.github.com/users/real-or-random/following{/other_user}",
         "gists_url" : "https://api.github.com/users/real-or-random/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/real-or-random",
         "id" : 1071625,
         "login" : "real-or-random",
         "node_id" : "MDQ6VXNlcjEwNzE2MjU=",
         "organizations_url" : "https://api.github.com/users/real-or-random/orgs",
         "received_events_url" : "https://api.github.com/users/real-or-random/received_events",
         "repos_url" : "https://api.github.com/users/real-or-random/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/real-or-random/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/real-or-random/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/real-or-random"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "With\r\n```\r\n               location_t loc = EXPR_HAS_LOCATION(exp) ? EXPR_LOCATION (exp) : UNKNOWN_LOCATION;\r\n               expanded_location s = expand_location (loc);\r\n               fnotice(stderr, \"%s:%d: Potentially miscompiled memcmp\\n\", s.file, s.line);\r\n```\r\nI get a not so usefully located message, but a message none the less:\r\n```\r\n/nix/store/034wplfrxzhmljmajhmyya2ahg4z0nbl-gcc-9.3.0/include/c++/9.3.0/bits/stl_algobase.h:940: Potentially miscompiled memcmp\r\n```",
      "created_at" : "2020-09-25T22:25:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/20005#issuecomment-699186791",
      "id" : 699186791,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20005",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5OTE4Njc5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-25T22:25:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/699186791",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/21371712?v=4",
         "events_url" : "https://api.github.com/users/roconnor-blockstream/events{/privacy}",
         "followers_url" : "https://api.github.com/users/roconnor-blockstream/followers",
         "following_url" : "https://api.github.com/users/roconnor-blockstream/following{/other_user}",
         "gists_url" : "https://api.github.com/users/roconnor-blockstream/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/roconnor-blockstream",
         "id" : 21371712,
         "login" : "roconnor-blockstream",
         "node_id" : "MDQ6VXNlcjIxMzcxNzEy",
         "organizations_url" : "https://api.github.com/users/roconnor-blockstream/orgs",
         "received_events_url" : "https://api.github.com/users/roconnor-blockstream/received_events",
         "repos_url" : "https://api.github.com/users/roconnor-blockstream/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/roconnor-blockstream/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/roconnor-blockstream/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/roconnor-blockstream"
      }
   }
]
