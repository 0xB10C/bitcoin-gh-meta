[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18095 (Fix crashes and infinite loop in ListWalletDir() by uhliksk)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-06-30T13:00:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-651774831",
      "id" : 651774831,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19419",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MTc3NDgzMQ==",
      "updated_at" : "2020-06-30T13:00:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/651774831",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "No strong opinion regarding excluding some paths. Current patch needs to be updated (format) and maybe change implementation to use a list of ignore/exclude paths.\r\n\r\nThis can improve GUI by reducing freezes but it's not the right fix for that. When `ListWalletDir` is triggered from the GUI, it should be called on a background thread. Alternatively we could consider caching `ListWalletDir` result and invalidate it when wallets are created or loaded.",
      "created_at" : "2020-07-01T09:40:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-652311748",
      "id" : 652311748,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19419",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjMxMTc0OA==",
      "updated_at" : "2020-07-01T09:40:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652311748",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> No strong opinion regarding excluding some paths. Current patch needs to be updated (format) and maybe change implementation to use a list of ignore/exclude paths.\r\n> \r\n> This can improve GUI by reducing freezes but it's not the right fix for that. When `ListWalletDir` is triggered from the GUI, it should be called on a background thread. Alternatively we could consider caching `ListWalletDir` result and invalidate it when wallets are created or loaded.\r\n\r\nyup, ugly quick fix and background thread seams reasonable.. but fix proves the point and lets be honest why should we waste time and risk locks, when traverse trough known node dir?.. .  also other GUI freezes should be tackled.\r\nBefore moon scale there is a long list of things in my backlog, that need to be fixed before bam..\r\n.\r\nThere might be soon real users who use the gui,  and lets be real, gui is bitcoin for them.\r\n\r\n",
      "created_at" : "2020-07-01T12:22:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-652386136",
      "id" : 652386136,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19419",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjM4NjEzNg==",
      "updated_at" : "2020-07-01T12:22:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652386136",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r448630671"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448630671"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Instead of multiple variables, you can declare something like `const std::vector ignore_paths{ GetBlocksDir(), sub_path / \"testnet3\", ... }` and then compare against this.",
      "commit_id" : "3d69e4ccaeae53a8a14f05b062448f4898734dbe",
      "created_at" : "2020-07-01T21:40:32Z",
      "diff_hunk" : "@@ -60,33 +60,69 @@ std::vector<fs::path> ListWalletDir()\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n+    fs::path sub_path = GetDataDir();\n+\n+    bool we_have_wallets_dir = (wallet_dir != sub_path);\n+    const fs::path fblocks = GetBlocksDir();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r448630671",
      "id" : 448630671,
      "line" : 66,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzMDY3MQ==",
      "original_commit_id" : "3d69e4ccaeae53a8a14f05b062448f4898734dbe",
      "original_line" : 66,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : 7,
      "pull_request_review_id" : 441214538,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T21:40:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448630671",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r448701432"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448701432"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "yup  :+1:  , btw strange how long those bare strings survived refactor, still no global #define BLOCKS_DIR or TESTNET_STR etc.     ",
      "commit_id" : "3d69e4ccaeae53a8a14f05b062448f4898734dbe",
      "created_at" : "2020-07-02T01:39:34Z",
      "diff_hunk" : "@@ -60,33 +60,69 @@ std::vector<fs::path> ListWalletDir()\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n+    fs::path sub_path = GetDataDir();\n+\n+    bool we_have_wallets_dir = (wallet_dir != sub_path);\n+    const fs::path fblocks = GetBlocksDir();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r448701432",
      "id" : 448701432,
      "in_reply_to_id" : 448630671,
      "line" : 66,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcwMTQzMg==",
      "original_commit_id" : "3d69e4ccaeae53a8a14f05b062448f4898734dbe",
      "original_line" : 66,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : 7,
      "pull_request_review_id" : 441294967,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-02T01:39:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448701432",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   }
]
