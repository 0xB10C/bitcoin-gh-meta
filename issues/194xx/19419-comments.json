[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19933 (wallet: bugfix; if datadir has a trailing '/'  listwalletdir would strip lead char of walletname by Saibato)\n* #19077 (wallet: Add sqlite as an alternative wallet database and use it for new descriptor wallets by achow101)\n* #18095 (Fix crashes and infinite loop in ListWalletDir() by uhliksk)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-06-30T13:00:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-651774831",
      "id" : 651774831,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19419",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MTc3NDgzMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-02T22:13:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/651774831",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "No strong opinion regarding excluding some paths. Current patch needs to be updated (format) and maybe change implementation to use a list of ignore/exclude paths.\r\n\r\nThis can improve GUI by reducing freezes but it's not the right fix for that. When `ListWalletDir` is triggered from the GUI, it should be called on a background thread. Alternatively we could consider caching `ListWalletDir` result and invalidate it when wallets are created or loaded.",
      "created_at" : "2020-07-01T09:40:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-652311748",
      "id" : 652311748,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19419",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjMxMTc0OA==",
      "updated_at" : "2020-07-01T09:40:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652311748",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> No strong opinion regarding excluding some paths. Current patch needs to be updated (format) and maybe change implementation to use a list of ignore/exclude paths.\r\n> \r\n> This can improve GUI by reducing freezes but it's not the right fix for that. When `ListWalletDir` is triggered from the GUI, it should be called on a background thread. Alternatively we could consider caching `ListWalletDir` result and invalidate it when wallets are created or loaded.\r\n\r\nyup, ugly quick fix and background thread seams reasonable.. but fix proves the point and lets be honest why should we waste time and risk locks, when traverse trough known node dir?.. .  also other GUI freezes should be tackled.\r\nBefore moon scale there is a long list of things in my backlog, that need to be fixed before bam..\r\n.\r\nThere might be soon real users who use the gui,  and lets be real, gui is bitcoin for them.\r\n\r\n",
      "created_at" : "2020-07-01T12:22:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-652386136",
      "id" : 652386136,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19419",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjM4NjEzNg==",
      "updated_at" : "2020-07-01T12:22:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652386136",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r448630671"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448630671"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Instead of multiple variables, you can declare something like `const std::vector ignore_paths{ GetBlocksDir(), sub_path / \"testnet3\", ... }` and then compare against this.",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-07-01T21:40:32Z",
      "diff_hunk" : "@@ -60,33 +60,69 @@ std::vector<fs::path> ListWalletDir()\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n+    fs::path sub_path = GetDataDir();\n+\n+    bool we_have_wallets_dir = (wallet_dir != sub_path);\n+    const fs::path fblocks = GetBlocksDir();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r448630671",
      "id" : 448630671,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzMDY3MQ==",
      "original_commit_id" : "3d69e4ccaeae53a8a14f05b062448f4898734dbe",
      "original_line" : 66,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 441214538,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448630671",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r448701432"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448701432"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "yup  :+1:  , btw strange how long those bare strings survived refactor, still no global #define BLOCKS_DIR or TESTNET_STR etc.     ",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-07-02T01:39:34Z",
      "diff_hunk" : "@@ -60,33 +60,69 @@ std::vector<fs::path> ListWalletDir()\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n+    fs::path sub_path = GetDataDir();\n+\n+    bool we_have_wallets_dir = (wallet_dir != sub_path);\n+    const fs::path fblocks = GetBlocksDir();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r448701432",
      "id" : 448701432,
      "in_reply_to_id" : 448630671,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcwMTQzMg==",
      "original_commit_id" : "3d69e4ccaeae53a8a14f05b062448f4898734dbe",
      "original_line" : 66,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 441294967,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448701432",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r452407475"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452407475"
         }
      },
      "author_association" : "MEMBER",
      "body" : "better to define `skip_path` here\r\n\r\nNote to other reviewers, the enum file_type: https://www.boost.org/doc/libs/1_66_0/libs/filesystem/doc/reference.html#Enum-file_type",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-07-09T18:23:12Z",
      "diff_hunk" : "@@ -57,23 +57,48 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    bool skip_path;\n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"testnet3\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",\n+                                        };\n+\n     for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n         if (ec) {\n             LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n             continue;\n         }\n-\n-        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n-        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n-        const fs::path path = it->path().string().substr(offset);\n+        // We dont want to iterate trough those special node dirs\n+        if (it->status().type() == fs::directory_file) {\n+            skip_path = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r452407475",
      "id" : 452407475,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQwNzQ3NQ==",
      "original_commit_id" : "4aa7bc58d4d615069774997dd68f2b6925165fbf",
      "original_line" : 85,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 445863101,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452407475",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r452409592"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452409592"
         }
      },
      "author_association" : "MEMBER",
      "body" : "could use `break;` so you don't need to check `!skip_path &&` (and in fact, don't need it at all)\r\n\r\nYou can also do `it.disable_recursion_pending();` here",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-07-09T18:26:58Z",
      "diff_hunk" : "@@ -57,23 +57,48 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    bool skip_path;\n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"testnet3\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",\n+                                        };\n+\n     for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n         if (ec) {\n             LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n             continue;\n         }\n-\n-        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n-        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n-        const fs::path path = it->path().string().substr(offset);\n+        // We dont want to iterate trough those special node dirs\n+        if (it->status().type() == fs::directory_file) {\n+            skip_path = false;\n+            for(const auto& fpath: ignore_paths) {\n+                if (!skip_path && it->path().string().find(fpath.string()) == 0) {\n+                    skip_path = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r452409592",
      "id" : 452409592,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQwOTU5Mg==",
      "original_commit_id" : "4aa7bc58d4d615069774997dd68f2b6925165fbf",
      "original_line" : 88,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 445863101,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452409592",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r452410603"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452410603"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: just use brackets and newline\r\n\r\nAlso, I think we should follow symlinks? `symlink_file`",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-07-09T18:28:53Z",
      "diff_hunk" : "@@ -57,23 +57,48 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    bool skip_path;\n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"testnet3\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",\n+                                        };\n+\n     for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n         if (ec) {\n             LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n             continue;\n         }\n-\n-        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n-        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n-        const fs::path path = it->path().string().substr(offset);\n+        // We dont want to iterate trough those special node dirs\n+        if (it->status().type() == fs::directory_file) {\n+            skip_path = false;\n+            for(const auto& fpath: ignore_paths) {\n+                if (!skip_path && it->path().string().find(fpath.string()) == 0) {\n+                    skip_path = true;\n+                }\n+            }\n+            if (skip_path) {\n+                it.disable_recursion_pending();\n+                continue;\n+            }\n+        } else it.disable_recursion_pending();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r452410603",
      "id" : 452410603,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQxMDYwMw==",
      "original_commit_id" : "4aa7bc58d4d615069774997dd68f2b6925165fbf",
      "original_line" : 95,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 445863101,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452410603",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453349974"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453349974"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Following symlinks could create an infinite loop.",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-07-12T18:45:54Z",
      "diff_hunk" : "@@ -57,23 +57,48 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    bool skip_path;\n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"testnet3\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",\n+                                        };\n+\n     for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n         if (ec) {\n             LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n             continue;\n         }\n-\n-        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n-        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n-        const fs::path path = it->path().string().substr(offset);\n+        // We dont want to iterate trough those special node dirs\n+        if (it->status().type() == fs::directory_file) {\n+            skip_path = false;\n+            for(const auto& fpath: ignore_paths) {\n+                if (!skip_path && it->path().string().find(fpath.string()) == 0) {\n+                    skip_path = true;\n+                }\n+            }\n+            if (skip_path) {\n+                it.disable_recursion_pending();\n+                continue;\n+            }\n+        } else it.disable_recursion_pending();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453349974",
      "id" : 453349974,
      "in_reply_to_id" : 452410603,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM0OTk3NA==",
      "original_commit_id" : "4aa7bc58d4d615069774997dd68f2b6925165fbf",
      "original_line" : 95,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 446901219,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453349974",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453350233"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453350233"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since we're using exact paths in `ignore_paths`, can't we use an exact match? (And then `ignore_paths` can become an `unordered_set` and just use `.count` here...)",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-07-12T18:48:46Z",
      "diff_hunk" : "@@ -57,23 +57,48 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    bool skip_path;\n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"testnet3\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",\n+                                        };\n+\n     for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n         if (ec) {\n             LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n             continue;\n         }\n-\n-        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n-        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n-        const fs::path path = it->path().string().substr(offset);\n+        // We dont want to iterate trough those special node dirs\n+        if (it->status().type() == fs::directory_file) {\n+            skip_path = false;\n+            for(const auto& fpath: ignore_paths) {\n+                if (!skip_path && it->path().string().find(fpath.string()) == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453350233",
      "id" : 453350233,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM1MDIzMw==",
      "original_commit_id" : "4aa7bc58d4d615069774997dd68f2b6925165fbf",
      "original_line" : 87,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 446901377,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453350233",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453350304"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453350304"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Suggest alphabetising.",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-07-12T18:49:33Z",
      "diff_hunk" : "@@ -57,23 +57,48 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    bool skip_path;\n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"testnet3\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453350304",
      "id" : 453350304,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM1MDMwNA==",
      "original_commit_id" : "4aa7bc58d4d615069774997dd68f2b6925165fbf",
      "original_line" : 75,
      "original_position" : 19,
      "original_start_line" : 71,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 446901377,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453350304",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453350602"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453350602"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Consider adding \"blktree\" and \"coins\" (see `files.md`)",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-07-12T18:52:31Z",
      "diff_hunk" : "@@ -57,23 +57,48 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    bool skip_path;\n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"testnet3\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453350602",
      "id" : 453350602,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM1MDYwMg==",
      "original_commit_id" : "4aa7bc58d4d615069774997dd68f2b6925165fbf",
      "original_line" : 75,
      "original_position" : 19,
      "original_start_line" : 71,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 446901377,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453350602",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453350994"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453350994"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Or hopefully `std::filesystem::path::lexically_relative` (C++17) :)",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-07-12T18:56:20Z",
      "diff_hunk" : "@@ -57,23 +57,48 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    bool skip_path;\n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"testnet3\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",\n+                                        };\n+\n     for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n         if (ec) {\n             LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n             continue;\n         }\n-\n-        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n-        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n-        const fs::path path = it->path().string().substr(offset);\n+        // We dont want to iterate trough those special node dirs\n+        if (it->status().type() == fs::directory_file) {\n+            skip_path = false;\n+            for(const auto& fpath: ignore_paths) {\n+                if (!skip_path && it->path().string().find(fpath.string()) == 0) {\n+                    skip_path = true;\n+                }\n+            }\n+            if (skip_path) {\n+                it.disable_recursion_pending();\n+                continue;\n+            }\n+        } else it.disable_recursion_pending();\n \n         if (it->status().type() == fs::directory_file && IsBerkeleyBtree(it->path() / \"wallet.dat\")) {\n             // Found a directory which contains wallet.dat btree file, add it as a wallet.\n-            paths.emplace_back(path);\n+            // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n+            // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453350994",
      "id" : 453350994,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM1MDk5NA==",
      "original_commit_id" : "4aa7bc58d4d615069774997dd68f2b6925165fbf",
      "original_line" : 100,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 446901377,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453350994",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453351273"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453351273"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            if (ignore_paths.count(it->path()) {\r\n                it.disable_recursion_pending();\r\n                continue;\r\n            }\r\n```",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-07-12T18:59:17Z",
      "diff_hunk" : "@@ -57,23 +57,48 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    bool skip_path;\n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"testnet3\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",\n+                                        };\n+\n     for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n         if (ec) {\n             LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n             continue;\n         }\n-\n-        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n-        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n-        const fs::path path = it->path().string().substr(offset);\n+        // We dont want to iterate trough those special node dirs\n+        if (it->status().type() == fs::directory_file) {\n+            skip_path = false;\n+            for(const auto& fpath: ignore_paths) {\n+                if (!skip_path && it->path().string().find(fpath.string()) == 0) {\n+                    skip_path = true;\n+                }\n+            }\n+            if (skip_path) {\n+                it.disable_recursion_pending();\n+                continue;\n+            }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453351273",
      "id" : 453351273,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM1MTI3Mw==",
      "original_commit_id" : "4aa7bc58d4d615069774997dd68f2b6925165fbf",
      "original_line" : 94,
      "original_position" : 42,
      "original_start_line" : 85,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 446901377,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453351273",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453531725"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453531725"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> (and in fact, don't need it at all)\r\n\r\nhmm... If we allow wallets in those dir yes, but i would choose to touch the dir's not at all, \r\nPlease view fixup I will post before i squash.\r\nI guess we will need the skip  But sure about that we need some vote. :+1:    ",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-07-13T09:51:46Z",
      "diff_hunk" : "@@ -57,23 +57,48 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    bool skip_path;\n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"testnet3\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",\n+                                        };\n+\n     for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n         if (ec) {\n             LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n             continue;\n         }\n-\n-        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n-        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n-        const fs::path path = it->path().string().substr(offset);\n+        // We dont want to iterate trough those special node dirs\n+        if (it->status().type() == fs::directory_file) {\n+            skip_path = false;\n+            for(const auto& fpath: ignore_paths) {\n+                if (!skip_path && it->path().string().find(fpath.string()) == 0) {\n+                    skip_path = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453531725",
      "id" : 453531725,
      "in_reply_to_id" : 452409592,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzUzMTcyNQ==",
      "original_commit_id" : "4aa7bc58d4d615069774997dd68f2b6925165fbf",
      "original_line" : 88,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 447101681,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453531725",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453656346"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453656346"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : ":+1: Though I choose  \r\n`if (std::count(ignore_paths.begin(), ignore_paths.end(), it->path())) {`\r\nnot sure ignore_paths has a count?",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-07-13T13:39:30Z",
      "diff_hunk" : "@@ -57,23 +57,48 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    bool skip_path;\n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"testnet3\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",\n+                                        };\n+\n     for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n         if (ec) {\n             LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n             continue;\n         }\n-\n-        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n-        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n-        const fs::path path = it->path().string().substr(offset);\n+        // We dont want to iterate trough those special node dirs\n+        if (it->status().type() == fs::directory_file) {\n+            skip_path = false;\n+            for(const auto& fpath: ignore_paths) {\n+                if (!skip_path && it->path().string().find(fpath.string()) == 0) {\n+                    skip_path = true;\n+                }\n+            }\n+            if (skip_path) {\n+                it.disable_recursion_pending();\n+                continue;\n+            }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453656346",
      "id" : 453656346,
      "in_reply_to_id" : 453351273,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY1NjM0Ng==",
      "original_commit_id" : "4aa7bc58d4d615069774997dd68f2b6925165fbf",
      "original_line" : 94,
      "original_position" : 42,
      "original_start_line" : 85,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 447259253,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453656346",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453756689"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453756689"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe also the default blocks dir too",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-07-13T15:58:45Z",
      "diff_hunk" : "@@ -57,23 +57,48 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    bool skip_path;\n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"testnet3\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453756689",
      "id" : 453756689,
      "in_reply_to_id" : 453350602,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc1NjY4OQ==",
      "original_commit_id" : "4aa7bc58d4d615069774997dd68f2b6925165fbf",
      "original_line" : 75,
      "original_position" : 19,
      "original_start_line" : 71,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 447386215,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453756689",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453757173"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453757173"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It will once changed to an `unordered_set` as suggested",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-07-13T15:59:30Z",
      "diff_hunk" : "@@ -57,23 +57,48 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    bool skip_path;\n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"testnet3\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",\n+                                        };\n+\n     for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n         if (ec) {\n             LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n             continue;\n         }\n-\n-        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n-        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n-        const fs::path path = it->path().string().substr(offset);\n+        // We dont want to iterate trough those special node dirs\n+        if (it->status().type() == fs::directory_file) {\n+            skip_path = false;\n+            for(const auto& fpath: ignore_paths) {\n+                if (!skip_path && it->path().string().find(fpath.string()) == 0) {\n+                    skip_path = true;\n+                }\n+            }\n+            if (skip_path) {\n+                it.disable_recursion_pending();\n+                continue;\n+            }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453757173",
      "id" : 453757173,
      "in_reply_to_id" : 453351273,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc1NzE3Mw==",
      "original_commit_id" : "4aa7bc58d4d615069774997dd68f2b6925165fbf",
      "original_line" : 94,
      "original_position" : 42,
      "original_start_line" : 85,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 447386838,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453757173",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453777359"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453777359"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "    const std::vector<fs::path> ignore_paths = {\r\n                                        blocks_dir,\r\n                                        data_dir / \"blktree\",",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-07-13T16:31:04Z",
      "diff_hunk" : "@@ -57,23 +57,48 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    bool skip_path;\n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"testnet3\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453777359",
      "id" : 453777359,
      "in_reply_to_id" : 453350602,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc3NzM1OQ==",
      "original_commit_id" : "4aa7bc58d4d615069774997dd68f2b6925165fbf",
      "original_line" : 75,
      "original_position" : 19,
      "original_start_line" : 71,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 447412381,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/453777359",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, looks good to me",
      "created_at" : "2020-08-13T21:47:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-673726585",
      "id" : 673726585,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19419",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MzcyNjU4NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-13T21:47:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/673726585",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, please squash your commits.",
      "created_at" : "2020-08-14T16:41:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-674161697",
      "id" : 674161697,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19419",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDE2MTY5Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-14T16:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674161697",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "squashed and rebased https://github.com/bitcoin/bitcoin/pull/19419/commits/caa418440dd5e996c730def08e807ddb5d504a44",
      "created_at" : "2020-08-15T12:37:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-674391599",
      "id" : 674391599,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19419",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDM5MTU5OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-15T12:37:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674391599",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r471897714"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471897714"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`disable_recursion_pending` is a new name introduced in Boost 1.72. We support much older. Renaming this to `no_push` (the old name) should just work.",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-08-18T03:50:59Z",
      "diff_hunk" : "@@ -57,35 +57,59 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    // Those directory's are referenced in doc/files.md\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"blktree\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"coins\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"testnet3\"\n+                                        };\n+\n     for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n         if (ec) {\n             LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n             continue;\n         }\n \n-        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n-        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n-        const fs::path path = it->path().string().substr(offset);\n-\n-        if (it->status().type() == fs::directory_file && IsBerkeleyBtree(it->path() / \"wallet.dat\")) {\n-            // Found a directory which contains wallet.dat btree file, add it as a wallet.\n-            paths.emplace_back(path);\n-        } else if (it.level() == 0 && it->symlink_status().type() == fs::regular_file && IsBerkeleyBtree(it->path())) {\n-            if (it->path().filename() == \"wallet.dat\") {\n-                // Found top-level wallet.dat btree file, add top level directory \"\"\n-                // as a wallet.\n-                paths.emplace_back();\n-            } else {\n-                // Found top-level btree file not called wallet.dat. Current bitcoin\n-                // software will never create these files but will allow them to be\n-                // opened in a shared database environment for backwards compatibility.\n-                // Add it to the list of available wallets.\n-                paths.emplace_back(path);\n+        // We dont want to iterate trough those special node dirs\n+        if (std::count(ignore_paths.begin(), ignore_paths.end(), it->path())) {\n+            it.disable_recursion_pending();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r471897714",
      "id" : 471897714,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg5NzcxNA==",
      "original_commit_id" : "caa418440dd5e996c730def08e807ddb5d504a44",
      "original_line" : 88,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 468972448,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471897714",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r474580767"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474580767"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "How about?\r\n\r\nSuggestion:\r\n\r\n``` Diff\r\ndiff --git a/src/fs.h b/src/fs.h\r\nindex dfbecc18e..390c38790 100644\r\n--- a/src/fs.h\r\n+++ b/src/fs.h\r\n@@ -17,6 +17,10 @@\r\n /** Filesystem operations and types */\r\n namespace fs = boost::filesystem;\r\n \r\n+#ifndef NAMESPACE_BOOST\r\n+#define NAMESPACE_BOOST\r\n+#endif\r\n+\r\n /** Bridge operations to C stdio */\r\n namespace fsbridge {\r\n     FILE *fopen(const fs::path& p, const char *mode);\r\ndiff --git a/src/wallet/walletutil.cpp b/src/wallet/walletutil.cpp\r\nindex a1387111e..806818a36 100644\r\n--- a/src/wallet/walletutil.cpp\r\n+++ b/src/wallet/walletutil.cpp\r\n@@ -85,7 +85,13 @@ std::vector<fs::path> ListWalletDir()\r\n \r\n         // We dont want to iterate trough those special node dirs\r\n         if (std::count(ignore_paths.begin(), ignore_paths.end(), it->path())) {\r\n-            it.disable_recursion_pending();\r\n+            #ifdef NAMESPACE_BOOST\r\n+            // BOOST iterator\r\n+                    it.no_push();\r\n+            #else\r\n+            // We have >= c++17\r\n+                    it.disable_recursion_pending();\r\n+            #endif\r\n             continue;\r\n         }\r\n \r\n```",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-08-21T09:35:26Z",
      "diff_hunk" : "@@ -57,35 +57,59 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    // Those directory's are referenced in doc/files.md\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"blktree\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"coins\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"testnet3\"\n+                                        };\n+\n     for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n         if (ec) {\n             LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n             continue;\n         }\n \n-        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n-        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n-        const fs::path path = it->path().string().substr(offset);\n-\n-        if (it->status().type() == fs::directory_file && IsBerkeleyBtree(it->path() / \"wallet.dat\")) {\n-            // Found a directory which contains wallet.dat btree file, add it as a wallet.\n-            paths.emplace_back(path);\n-        } else if (it.level() == 0 && it->symlink_status().type() == fs::regular_file && IsBerkeleyBtree(it->path())) {\n-            if (it->path().filename() == \"wallet.dat\") {\n-                // Found top-level wallet.dat btree file, add top level directory \"\"\n-                // as a wallet.\n-                paths.emplace_back();\n-            } else {\n-                // Found top-level btree file not called wallet.dat. Current bitcoin\n-                // software will never create these files but will allow them to be\n-                // opened in a shared database environment for backwards compatibility.\n-                // Add it to the list of available wallets.\n-                paths.emplace_back(path);\n+        // We dont want to iterate trough those special node dirs\n+        if (std::count(ignore_paths.begin(), ignore_paths.end(), it->path())) {\n+            it.disable_recursion_pending();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r474580767",
      "id" : 474580767,
      "in_reply_to_id" : 471897714,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU4MDc2Nw==",
      "original_commit_id" : "caa418440dd5e996c730def08e807ddb5d504a44",
      "original_line" : 88,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 472347517,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474580767",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.",
      "created_at" : "2020-10-04T11:35:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-703242278",
      "id" : 703242278,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19419",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMzI0MjI3OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-04T11:35:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/703242278",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r499245395"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499245395"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please add \"signet\".",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-10-04T13:13:10Z",
      "diff_hunk" : "@@ -57,35 +57,59 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    // Those directory's are referenced in doc/files.md\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"blktree\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"coins\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"testnet3\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r499245395",
      "id" : 499245395,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI0NTM5NQ==",
      "original_commit_id" : "caa418440dd5e996c730def08e807ddb5d504a44",
      "original_line" : 78,
      "original_position" : 21,
      "original_start_line" : 76,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 501622460,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499245395",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r499248059"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499248059"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit:\r\n```suggestion\r\n    // Those directories are referenced in doc/files.md\r\n```",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-10-04T13:40:06Z",
      "diff_hunk" : "@@ -57,35 +57,59 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    // Those directory's are referenced in doc/files.md",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r499248059",
      "id" : 499248059,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI0ODA1OQ==",
      "original_commit_id" : "caa418440dd5e996c730def08e807ddb5d504a44",
      "original_line" : 68,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 501624707,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499248059",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r499248311"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499248311"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit:\r\n```suggestion\r\n        // We don't want to iterate through those special node dirs\r\n```",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-10-04T13:42:04Z",
      "diff_hunk" : "@@ -57,35 +57,59 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    // Those directory's are referenced in doc/files.md\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"blktree\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"coins\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"testnet3\"\n+                                        };\n+\n     for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n         if (ec) {\n             LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n             continue;\n         }\n \n-        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n-        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n-        const fs::path path = it->path().string().substr(offset);\n-\n-        if (it->status().type() == fs::directory_file && IsBerkeleyBtree(it->path() / \"wallet.dat\")) {\n-            // Found a directory which contains wallet.dat btree file, add it as a wallet.\n-            paths.emplace_back(path);\n-        } else if (it.level() == 0 && it->symlink_status().type() == fs::regular_file && IsBerkeleyBtree(it->path())) {\n-            if (it->path().filename() == \"wallet.dat\") {\n-                // Found top-level wallet.dat btree file, add top level directory \"\"\n-                // as a wallet.\n-                paths.emplace_back();\n-            } else {\n-                // Found top-level btree file not called wallet.dat. Current bitcoin\n-                // software will never create these files but will allow them to be\n-                // opened in a shared database environment for backwards compatibility.\n-                // Add it to the list of available wallets.\n-                paths.emplace_back(path);\n+        // We dont want to iterate trough those special node dirs",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r499248311",
      "id" : 499248311,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI0ODMxMQ==",
      "original_commit_id" : "caa418440dd5e996c730def08e807ddb5d504a44",
      "original_line" : 86,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : null,
      "pull_request_review_id" : 501624862,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499248311",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r499250262"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499250262"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I personally prefer \"throwing\" versions of the Boost.Filesystem API. But I don't think that combining \"throwing\" and \"non-throwing\" versions of the Boost.Filesystem API in the same function is a good design.",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-10-04T14:04:21Z",
      "diff_hunk" : "@@ -57,35 +57,59 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    // Those directory's are referenced in doc/files.md\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"blktree\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"coins\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"testnet3\"\n+                                        };\n+\n     for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n         if (ec) {\n             LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n             continue;\n         }\n \n-        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n-        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n-        const fs::path path = it->path().string().substr(offset);\n-\n-        if (it->status().type() == fs::directory_file && IsBerkeleyBtree(it->path() / \"wallet.dat\")) {\n-            // Found a directory which contains wallet.dat btree file, add it as a wallet.\n-            paths.emplace_back(path);\n-        } else if (it.level() == 0 && it->symlink_status().type() == fs::regular_file && IsBerkeleyBtree(it->path())) {\n-            if (it->path().filename() == \"wallet.dat\") {\n-                // Found top-level wallet.dat btree file, add top level directory \"\"\n-                // as a wallet.\n-                paths.emplace_back();\n-            } else {\n-                // Found top-level btree file not called wallet.dat. Current bitcoin\n-                // software will never create these files but will allow them to be\n-                // opened in a shared database environment for backwards compatibility.\n-                // Add it to the list of available wallets.\n-                paths.emplace_back(path);\n+        // We dont want to iterate trough those special node dirs\n+        if (std::count(ignore_paths.begin(), ignore_paths.end(), it->path())) {\n+            it.disable_recursion_pending();\n+            continue;\n+        }\n+\n+        try {\n+            if (it->status().type() == fs::directory_file && IsBerkeleyBtree(it->path() / \"wallet.dat\")) {\n+                // Found a directory which contains wallet.dat btree file, add it as a wallet.\n+                // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n+                // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n+                paths.emplace_back(it->path().string().substr(offset));\n+            } else if (it.level() == 0 && it->symlink_status().type() == fs::regular_file && IsBerkeleyBtree(it->path())) {\n+                if (it->path().filename() == \"wallet.dat\") {\n+                    // Found top-level wallet.dat btree file, add top level directory \"\"\n+                    // as a wallet.\n+                    paths.emplace_back();\n+                } else {\n+                    // Found top-level btree file not called wallet.dat. Current bitcoin\n+                    // software will never create these files but will allow them to be\n+                    // opened in a shared database environment for backwards compatibility.\n+                    // Add it to the list of available wallets.\n+                    paths.emplace_back(it->path().filename());\n+                }\n             }\n+        } catch (const std::exception& e) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r499250262",
      "id" : 499250262,
      "line" : 112,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI1MDI2Mg==",
      "original_commit_id" : "caa418440dd5e996c730def08e807ddb5d504a44",
      "original_line" : 112,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : 74,
      "pull_request_review_id" : 501626615,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-08T10:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/499250262",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r501628611"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501628611"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "with catch boost::exception\r\nand  dynamic_cast<std.exception i run with a recursive path in an non catched     \r\n EXCEPTION: N5boost10filesystem16filesystem_errorE\r\nso unless u have a hint, i leave it that way, for now?",
      "commit_id" : "da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b",
      "created_at" : "2020-10-08T10:54:23Z",
      "diff_hunk" : "@@ -57,35 +57,59 @@ static bool IsBerkeleyBtree(const fs::path& path)\n std::vector<fs::path> ListWalletDir()\n {\n     const fs::path wallet_dir = GetWalletDir();\n+    const fs::path data_dir = GetDataDir();\n+    const fs::path blocks_dir = GetBlocksDir();\n+\n     const size_t offset = wallet_dir.string().size() + 1;\n     std::vector<fs::path> paths;\n     boost::system::error_code ec;\n \n+    // Here we place the top level dirs we want to skip in case walletdir is datadir or blocksdir\n+    // Those directory's are referenced in doc/files.md\n+    const std::vector<fs::path> ignore_paths = {\n+                                        blocks_dir,\n+                                        data_dir / \"blktree\",\n+                                        data_dir / \"chainstate\",\n+                                        data_dir / \"coins\",\n+                                        data_dir / \"database\",\n+                                        data_dir / \"indexes\",\n+                                        data_dir / \"regtest\",\n+                                        data_dir / \"testnet3\"\n+                                        };\n+\n     for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n         if (ec) {\n             LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n             continue;\n         }\n \n-        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n-        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n-        const fs::path path = it->path().string().substr(offset);\n-\n-        if (it->status().type() == fs::directory_file && IsBerkeleyBtree(it->path() / \"wallet.dat\")) {\n-            // Found a directory which contains wallet.dat btree file, add it as a wallet.\n-            paths.emplace_back(path);\n-        } else if (it.level() == 0 && it->symlink_status().type() == fs::regular_file && IsBerkeleyBtree(it->path())) {\n-            if (it->path().filename() == \"wallet.dat\") {\n-                // Found top-level wallet.dat btree file, add top level directory \"\"\n-                // as a wallet.\n-                paths.emplace_back();\n-            } else {\n-                // Found top-level btree file not called wallet.dat. Current bitcoin\n-                // software will never create these files but will allow them to be\n-                // opened in a shared database environment for backwards compatibility.\n-                // Add it to the list of available wallets.\n-                paths.emplace_back(path);\n+        // We dont want to iterate trough those special node dirs\n+        if (std::count(ignore_paths.begin(), ignore_paths.end(), it->path())) {\n+            it.disable_recursion_pending();\n+            continue;\n+        }\n+\n+        try {\n+            if (it->status().type() == fs::directory_file && IsBerkeleyBtree(it->path() / \"wallet.dat\")) {\n+                // Found a directory which contains wallet.dat btree file, add it as a wallet.\n+                // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n+                // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n+                paths.emplace_back(it->path().string().substr(offset));\n+            } else if (it.level() == 0 && it->symlink_status().type() == fs::regular_file && IsBerkeleyBtree(it->path())) {\n+                if (it->path().filename() == \"wallet.dat\") {\n+                    // Found top-level wallet.dat btree file, add top level directory \"\"\n+                    // as a wallet.\n+                    paths.emplace_back();\n+                } else {\n+                    // Found top-level btree file not called wallet.dat. Current bitcoin\n+                    // software will never create these files but will allow them to be\n+                    // opened in a shared database environment for backwards compatibility.\n+                    // Add it to the list of available wallets.\n+                    paths.emplace_back(it->path().filename());\n+                }\n             }\n+        } catch (const std::exception& e) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#discussion_r501628611",
      "id" : 501628611,
      "in_reply_to_id" : 499250262,
      "line" : 112,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTYyODYxMQ==",
      "original_commit_id" : "caa418440dd5e996c730def08e807ddb5d504a44",
      "original_line" : 112,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/wallet/walletutil.cpp",
      "position" : 74,
      "pull_request_review_id" : 504660397,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19419",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-08T10:54:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501628611",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased https://github.com/bitcoin/bitcoin/pull/19419/commits/da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b and addressed reviews.",
      "created_at" : "2020-10-08T10:59:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-705494228",
      "id" : 705494228,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19419",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNTQ5NDIyOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-08T10:59:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/705494228",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   }
]
