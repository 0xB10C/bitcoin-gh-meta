[
   {
      "body" : "Rather rename it to `CheckBlockPoW` then... but considering that's already covered by `CheckProofOfWork`, perhaps `CheckBlockHeader` should just be removed entirely and inlined where applicable.",
      "created_at" : "2017-02-08T03:25:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9717#issuecomment-278218882",
      "id" : 278218882,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9717",
      "updated_at" : "2017-02-08T03:25:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/278218882",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "I'm all for unifying CheckBlockHeader with CheckProofOfWork in pow.o, but one step at a time.\r\nHere are more future suggestions: \r\nhttps://github.com/jtimon/bitcoin/compare/pre-0.14-dont-call-me...jtimon:pre-0.14-encapsulate-pow\r\n\r\nCurrently the only difference between CheckProofOfWork and CheckBlockHeader and thus prevent from unifying the two functions are:\r\n\r\n1) Using CValidationState to give more detailed errors with CheckBlockHeader. \r\nPossible solution: More detailed errors are good, let's call with CheckBlockHeader and bring CValidationState down to CheckProofOfWork too.\r\n\r\n2) Not all CheckProofOfWork callers use CBlockHeader, this is can be a performance problem for refactor (see 'Pow: Performance hit: pre-static-CheckProofOfWork...').\r\n\r\nWe can rename CheckBlockHeader to CheckProofOfWork, CheckBlockPoW or whatever, no problem.\r\n",
      "created_at" : "2017-02-08T06:00:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9717#issuecomment-278237040",
      "id" : 278237040,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9717",
      "updated_at" : "2017-02-08T06:00:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/278237040",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "utACK.\r\n\r\nI'm not strongly in favor of this change though, given that if more functionality gets added to checkblockheader ever you would want to add fCheckPOW again.\r\n\r\nI am opposed to the other changes mentioned, ie, making checkproofofwork add the dos scores, seems better to keep checkproofofwork a pure function.",
      "created_at" : "2017-03-29T20:56:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9717#issuecomment-290223084",
      "id" : 290223084,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9717",
      "updated_at" : "2017-03-29T20:56:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/290223084",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "body" : "If there are plans to add more functionality back to this functions (which I wouldn't oppose too), and I can only think that you are referring to this check https://github.com/bitcoin/bitcoin/blob/master/src/validation.cpp#L2967 then we definitely don't want either this PR or @luke-jr 's suggestion of going further and fully remove CheckBlockHeader in one step.\r\n\r\nBut if we don't plan to put that code back there, then the fCheckPOW parameter doesn't make any sense in CheckBlockHeader. Better is better. This was supposed to be the simplest fix for something that honestly looks embarrassing when I think of reviewers reading this function without looking at the history or thinking about https://github.com/bitcoin/bitcoin/blob/master/src/validation.cpp#L2967 .\r\n\r\nLet's please first decide whether we want to remove fCheckPOW from this function or we want to bring the check ```block.GetBlockTime() > nAdjustedTime + MAX_FUTURE_BLOCK_TIME)``` back here (which I'm not opposed to and I'm happy to write myself if that's what's preferred, I don't care).\r\n\r\nAfter this, as @luke-jr points out CheckBlockHeader is just a wrapper for CheckProofOfWork but passing CValidationState. An option would be to remove it, another option would be to use CValidationState or maybe put it in https://github.com/bitcoin/bitcoin/blob/master/src/script/script_error.h (and maybe rename script_error.h to consensus/errors.o too, who knows).\r\n\r\nBut if we can't decide whether fCheckPOW here is pointless or not (and I don't want to bet, but maybe the compiler has already decided for us at a lower level), I don't want to put more decisions in the same PR.\r\n\r\n@luke-jr @JeremyRubin Does that sound reasonable to you?\r\n\r\nFor more context:\r\nThe comments are really appreciated in the context of #9177 which I'm trying to complete while rewriting in a simpler and less disruptive way (it will remain on top of #8994 though, since that currently allows to reuse all existing rpc/python tests except segwit.py for any custom chain [or even testnet3 and mainchain] instead of having to replace regtest with your new testchain to do so).\r\n\r\nAt the same time, I understand neither this nor #9177 are a priority for bitcoin core itself, since I believe it is unlikely #9177 will ever be merged on mainnet unless I find a way that doesn't affect performance at all on mainchain and at the same time is not very disruptive (which as said I believe it's unlikely). It would be very useful for rebasing elements to have  #9177 completed and merged in bitcoin core, but bitcoin core shouldn't care about that since not all it's users care about elements.\r\nOn the other hand I think #8855 #8994 can be very useful for testing within bitcoin core itself, but have no relation with this PR, only with #9177.\r\n\r\nPS: Sorry for the text wall, this shouldn't happen in a +4-4 PR.",
      "created_at" : "2017-04-06T22:32:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9717#issuecomment-292344265",
      "id" : 292344265,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9717",
      "updated_at" : "2017-04-06T22:32:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/292344265",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   }
]
