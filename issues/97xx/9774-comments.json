[
   {
      "body" : "Concept ACK, implementation is much simpler as I expected",
      "created_at" : "2017-02-16T19:25:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9774#issuecomment-280432183",
      "id" : 280432183,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9774",
      "updated_at" : "2017-02-16T19:25:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280432183",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9774#discussion_r101605182"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101605182"
         }
      },
      "body" : "Indentation looks wonky here (also below)",
      "commit_id" : "56f6bafde89ac60739e84cbdb270637b992e92ac",
      "created_at" : "2017-02-16T19:25:58Z",
      "diff_hunk" : "@@ -1248,14 +1248,21 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n         }\n     }\n \n+    // Check for host lookup allowed before parsing any network related parameters\n+    fNameLookup = GetBoolArg(\"-dns\", DEFAULT_NAME_LOOKUP);\n+\n     bool proxyRandomize = GetBoolArg(\"-proxyrandomize\", DEFAULT_PROXYRANDOMIZE);\n     // -proxy sets a proxy for all outgoing network traffic\n     // -noproxy (or -proxy=0) as well as the empty string can be used to not set a proxy, this is the default\n     std::string proxyArg = GetArg(\"-proxy\", \"\");\n     SetLimited(NET_TOR);\n     if (proxyArg != \"\" && proxyArg != \"0\") {\n-        CService resolved(LookupNumeric(proxyArg.c_str(), 9050));\n-        proxyType addrProxy = proxyType(resolved, proxyRandomize);\n+        CService proxyAddr;\n+        if (!Lookup(proxyArg.c_str(), proxyAddr, 9050, fNameLookup)) {\n+            return InitError(strprintf(_(\"Invalid -proxy address: '%s'\"), proxyArg));\n+        }\n+\n+\tproxyType addrProxy = proxyType(proxyAddr, proxyRandomize);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9774#discussion_r101605182",
      "id" : 101605182,
      "original_commit_id" : "56f6bafde89ac60739e84cbdb270637b992e92ac",
      "original_position" : 20,
      "path" : "src/init.cpp",
      "position" : 20,
      "pull_request_review_id" : 22340120,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9774",
      "updated_at" : "2017-02-16T19:26:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101605182",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9774#discussion_r101630238"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101630238"
         }
      },
      "body" : "Emacs C++ mode seems to like futzing with whitespace. I'll cleanup.\r\n\r\nSince you wrote it, any thoughts on the -torcontrol parsing?",
      "commit_id" : "56f6bafde89ac60739e84cbdb270637b992e92ac",
      "created_at" : "2017-02-16T21:25:20Z",
      "diff_hunk" : "@@ -1248,14 +1248,21 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n         }\n     }\n \n+    // Check for host lookup allowed before parsing any network related parameters\n+    fNameLookup = GetBoolArg(\"-dns\", DEFAULT_NAME_LOOKUP);\n+\n     bool proxyRandomize = GetBoolArg(\"-proxyrandomize\", DEFAULT_PROXYRANDOMIZE);\n     // -proxy sets a proxy for all outgoing network traffic\n     // -noproxy (or -proxy=0) as well as the empty string can be used to not set a proxy, this is the default\n     std::string proxyArg = GetArg(\"-proxy\", \"\");\n     SetLimited(NET_TOR);\n     if (proxyArg != \"\" && proxyArg != \"0\") {\n-        CService resolved(LookupNumeric(proxyArg.c_str(), 9050));\n-        proxyType addrProxy = proxyType(resolved, proxyRandomize);\n+        CService proxyAddr;\n+        if (!Lookup(proxyArg.c_str(), proxyAddr, 9050, fNameLookup)) {\n+            return InitError(strprintf(_(\"Invalid -proxy address: '%s'\"), proxyArg));\n+        }\n+\n+\tproxyType addrProxy = proxyType(proxyAddr, proxyRandomize);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9774#discussion_r101630238",
      "id" : 101630238,
      "original_commit_id" : "56f6bafde89ac60739e84cbdb270637b992e92ac",
      "original_position" : 20,
      "path" : "src/init.cpp",
      "position" : 20,
      "pull_request_review_id" : 22365894,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9774",
      "updated_at" : "2017-02-16T21:25:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101630238",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1492956?v=3",
         "events_url" : "https://api.github.com/users/jmcorgan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jmcorgan/followers",
         "following_url" : "https://api.github.com/users/jmcorgan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jmcorgan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jmcorgan",
         "id" : 1492956,
         "login" : "jmcorgan",
         "organizations_url" : "https://api.github.com/users/jmcorgan/orgs",
         "received_events_url" : "https://api.github.com/users/jmcorgan/received_events",
         "repos_url" : "https://api.github.com/users/jmcorgan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jmcorgan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jmcorgan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jmcorgan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9774#discussion_r101706374"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101706374"
         }
      },
      "body" : "Yes, that'd have to use libevent DNS lookups, which are asynchronous by default, thus someone more complicated to handle. There may be a synchronous way of doing lookups as well, I don't remember if that's exposed outside the http sublibrary.\r\n\r\nI'm not sure how important it is in practice, as running torcontrol over a network is extremely discouraged by the Tor developers [not even getting started about potentially leaking the DNS hostname of your Tor router to the internet!]. The choices are pretty much localhost TCP or localhost UNIX socket. The latter we don't currently handle, would be more pressing than hostname lookups.\r\n\r\nNote that the plan is still to port over the P2P code to libevent, so these interfaces will likely grow together in the future. Might as well wait for that and to it in a similar way.",
      "commit_id" : "56f6bafde89ac60739e84cbdb270637b992e92ac",
      "created_at" : "2017-02-17T08:22:25Z",
      "diff_hunk" : "@@ -1248,14 +1248,21 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n         }\n     }\n \n+    // Check for host lookup allowed before parsing any network related parameters\n+    fNameLookup = GetBoolArg(\"-dns\", DEFAULT_NAME_LOOKUP);\n+\n     bool proxyRandomize = GetBoolArg(\"-proxyrandomize\", DEFAULT_PROXYRANDOMIZE);\n     // -proxy sets a proxy for all outgoing network traffic\n     // -noproxy (or -proxy=0) as well as the empty string can be used to not set a proxy, this is the default\n     std::string proxyArg = GetArg(\"-proxy\", \"\");\n     SetLimited(NET_TOR);\n     if (proxyArg != \"\" && proxyArg != \"0\") {\n-        CService resolved(LookupNumeric(proxyArg.c_str(), 9050));\n-        proxyType addrProxy = proxyType(resolved, proxyRandomize);\n+        CService proxyAddr;\n+        if (!Lookup(proxyArg.c_str(), proxyAddr, 9050, fNameLookup)) {\n+            return InitError(strprintf(_(\"Invalid -proxy address: '%s'\"), proxyArg));\n+        }\n+\n+\tproxyType addrProxy = proxyType(proxyAddr, proxyRandomize);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9774#discussion_r101706374",
      "id" : 101706374,
      "original_commit_id" : "56f6bafde89ac60739e84cbdb270637b992e92ac",
      "original_position" : 20,
      "path" : "src/init.cpp",
      "position" : 20,
      "pull_request_review_id" : 22442914,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9774",
      "updated_at" : "2017-02-17T08:24:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101706374",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
