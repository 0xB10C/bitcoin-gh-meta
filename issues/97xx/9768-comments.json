[
   {
      "body" : "If you're working on custom logging stuff anyway: what would be really nice is something that would queue up debug messages, then print them only if the test fails. This lowers the amount of spam in the Travis log in the good case, and gives full troubleshooting information in the bad case (when you need it).\r\n",
      "created_at" : "2017-02-16T08:42:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-280268516",
      "id" : 280268516,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9768",
      "updated_at" : "2017-02-16T09:05:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280268516",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj done: https://github.com/bitcoin/bitcoin/pull/9780",
      "created_at" : "2017-02-16T20:15:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-280446044",
      "id" : 280446044,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9768",
      "updated_at" : "2017-02-16T20:15:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280446044",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101633768"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101633768"
         }
      },
      "body" : "Would upgrade this to a warning, since this is leaving files behind. Also this is a really useful print to see on the console when a test fails.",
      "commit_id" : "3b336aba4ef250868d6f3dc2bf741b0bbf621d39",
      "created_at" : "2017-02-16T21:42:11Z",
      "diff_hunk" : "@@ -140,38 +139,35 @@ def main(self):\n         success = False\n         try:\n             os.makedirs(self.options.tmpdir, exist_ok=False)\n+            self.start_logging()\n             self.setup_chain()\n             self.setup_network()\n             self.run_test()\n             success = True\n         except JSONRPCException as e:\n-            print(\"JSONRPC error: \"+e.error['message'])\n-            traceback.print_tb(sys.exc_info()[2])\n+            self.log.exception(\"JSONRPC error: \"+e.error['message'])\n         except AssertionError as e:\n-            print(\"Assertion failed: \" + str(e))\n-            traceback.print_tb(sys.exc_info()[2])\n+            self.log.exception(\"Assertion failed: \" + str(e))\n         except KeyError as e:\n-            print(\"key not found: \"+ str(e))\n-            traceback.print_tb(sys.exc_info()[2])\n+            self.log.exception(\"key not found: \"+ str(e))\n         except Exception as e:\n-            print(\"Unexpected exception caught during testing: \" + repr(e))\n-            traceback.print_tb(sys.exc_info()[2])\n+            self.log.exception(\"Unexpected exception caught during testing: \" + repr(e))\n         except KeyboardInterrupt as e:\n-            print(\"Exiting after \" + repr(e))\n+            self.log.warning(\"Exiting after \" + repr(e))\n \n         if not self.options.noshutdown:\n-            print(\"Stopping nodes\")\n+            self.log.info(\"Stopping nodes\")\n             stop_nodes(self.nodes)\n         else:\n-            print(\"Note: bitcoinds were not stopped and may still be running\")\n+            self.log.info(\"Note: bitcoinds were not stopped and may still be running\")\n \n         if not self.options.nocleanup and not self.options.noshutdown and success:\n-            print(\"Cleaning up\")\n+            self.log.info(\"Cleaning up\")\n             shutil.rmtree(self.options.tmpdir)\n             if not os.listdir(self.options.root):\n                 os.rmdir(self.options.root)\n         else:\n-            print(\"Not cleaning up dir %s\" % self.options.tmpdir)\n+            self.log.info(\"Not cleaning up dir %s\" % self.options.tmpdir)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101633768",
      "id" : 101633768,
      "original_commit_id" : "a8e2ab2ed74d2f9837b56979b2fe6fa23c8c516e",
      "original_position" : 73,
      "path" : "qa/rpc-tests/test_framework/test_framework.py",
      "position" : null,
      "pull_request_review_id" : 22369562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768",
      "updated_at" : "2017-03-06T19:12:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101633768",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101635232"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101635232"
         }
      },
      "body" : "You should say something about test_framework.log and console logging in the tests' --help output.\r\n\r\nWhat you wrote in the commit message is good, but obviously no one is going to see if it is just in this commit message.",
      "commit_id" : "3b336aba4ef250868d6f3dc2bf741b0bbf621d39",
      "created_at" : "2017-02-16T21:48:47Z",
      "diff_hunk" : "@@ -113,6 +113,8 @@ def main(self):\n                           help=\"Directory for caching pregenerated datadirs\")\n         parser.add_option(\"--tmpdir\", dest=\"tmpdir\", default=tempfile.mkdtemp(prefix=\"test\"),\n                           help=\"Root directory for datadirs\")\n+        parser.add_option(\"--loglevel\", dest=\"loglevel\", default=\"ERROR\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101635232",
      "id" : 101635232,
      "original_commit_id" : "a8e2ab2ed74d2f9837b56979b2fe6fa23c8c516e",
      "original_position" : 13,
      "path" : "qa/rpc-tests/test_framework/test_framework.py",
      "position" : 13,
      "pull_request_review_id" : 22369562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768",
      "updated_at" : "2017-03-06T19:12:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101635232",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101635498"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101635498"
         }
      },
      "body" : "Should stop trying to print e here and below because log.exception already formats and prints the exception and stack trace: https://docs.python.org/3/library/logging.html#logging.Logger.exception. It's not helpful to see same information printed multiple times and in inconsistent ways.",
      "commit_id" : "3b336aba4ef250868d6f3dc2bf741b0bbf621d39",
      "created_at" : "2017-02-16T21:50:05Z",
      "diff_hunk" : "@@ -140,38 +139,35 @@ def main(self):\n         success = False\n         try:\n             os.makedirs(self.options.tmpdir, exist_ok=False)\n+            self.start_logging()\n             self.setup_chain()\n             self.setup_network()\n             self.run_test()\n             success = True\n         except JSONRPCException as e:\n-            print(\"JSONRPC error: \"+e.error['message'])\n-            traceback.print_tb(sys.exc_info()[2])\n+            self.log.exception(\"JSONRPC error: \"+e.error['message'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101635498",
      "id" : 101635498,
      "original_commit_id" : "a8e2ab2ed74d2f9837b56979b2fe6fa23c8c516e",
      "original_position" : 40,
      "path" : "qa/rpc-tests/test_framework/test_framework.py",
      "position" : null,
      "pull_request_review_id" : 22369562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768",
      "updated_at" : "2017-03-06T19:12:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101635498",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101636133"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101636133"
         }
      },
      "body" : "Can you list what the log levels are? At least should probably mention that passing --loglevel=0 will show complete log output.",
      "commit_id" : "3b336aba4ef250868d6f3dc2bf741b0bbf621d39",
      "created_at" : "2017-02-16T21:53:07Z",
      "diff_hunk" : "@@ -113,6 +113,8 @@ def main(self):\n                           help=\"Directory for caching pregenerated datadirs\")\n         parser.add_option(\"--tmpdir\", dest=\"tmpdir\", default=tempfile.mkdtemp(prefix=\"test\"),\n                           help=\"Root directory for datadirs\")\n+        parser.add_option(\"--loglevel\", dest=\"loglevel\", default=\"ERROR\",\n+                          help=\"log events at this level and higher to the console\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101636133",
      "id" : 101636133,
      "original_commit_id" : "a8e2ab2ed74d2f9837b56979b2fe6fa23c8c516e",
      "original_position" : 14,
      "path" : "qa/rpc-tests/test_framework/test_framework.py",
      "position" : null,
      "pull_request_review_id" : 22369562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768",
      "updated_at" : "2017-03-06T19:12:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101636133",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101638985"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101638985"
         }
      },
      "body" : "I think you're better off dropping this call. The default debug level seems to be 0, and the value of DEBUG is 10 so this potentially throws away logs.\r\n\r\nAlso would drop the 3 other setLevel(logging.DEBUG) calls below.",
      "commit_id" : "3b336aba4ef250868d6f3dc2bf741b0bbf621d39",
      "created_at" : "2017-02-16T22:07:13Z",
      "diff_hunk" : "@@ -183,12 +179,41 @@ def main(self):\n                     from collections import deque\n                     print(\"\".join(deque(open(f), MAX_LINES_TO_PRINT)))\n         if success:\n-            print(\"Tests successful\")\n+            self.log.info(\"Tests successful\")\n             sys.exit(0)\n         else:\n-            print(\"Failed\")\n+            self.log.warning(\"Failed\")\n             sys.exit(1)\n \n+    def start_logging(self):\n+        # Add logger and logging handlers\n+        self.log = logging.getLogger('TestFramework')\n+        self.log.setLevel(logging.DEBUG)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101638985",
      "id" : 101638985,
      "original_commit_id" : "a8e2ab2ed74d2f9837b56979b2fe6fa23c8c516e",
      "original_position" : 92,
      "path" : "qa/rpc-tests/test_framework/test_framework.py",
      "position" : 92,
      "pull_request_review_id" : 22369562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768",
      "updated_at" : "2017-03-06T19:12:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101638985",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101639295"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101639295"
         }
      },
      "body" : "Calling getattr doesn't seem to be necessary, the documentation says setLevel already accepts a string: \r\nhttps://docs.python.org/3/library/logging.html#logging.Handler.setLevel. Maybe upper() is still useful though.",
      "commit_id" : "3b336aba4ef250868d6f3dc2bf741b0bbf621d39",
      "created_at" : "2017-02-16T22:08:37Z",
      "diff_hunk" : "@@ -183,12 +179,41 @@ def main(self):\n                     from collections import deque\n                     print(\"\".join(deque(open(f), MAX_LINES_TO_PRINT)))\n         if success:\n-            print(\"Tests successful\")\n+            self.log.info(\"Tests successful\")\n             sys.exit(0)\n         else:\n-            print(\"Failed\")\n+            self.log.warning(\"Failed\")\n             sys.exit(1)\n \n+    def start_logging(self):\n+        # Add logger and logging handlers\n+        self.log = logging.getLogger('TestFramework')\n+        self.log.setLevel(logging.DEBUG)\n+        # Create file handler to log all messages\n+        fh = logging.FileHandler(self.options.tmpdir + '/test_framework.log')\n+        fh.setLevel(logging.DEBUG)\n+        # Create console handler to log messages to stderr. By default this logs only error messages, but can be configured with --loglevel.\n+        ch = logging.StreamHandler()\n+        console_log_level = getattr(logging, self.options.loglevel.upper(), None)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101639295",
      "id" : 101639295,
      "original_commit_id" : "a8e2ab2ed74d2f9837b56979b2fe6fa23c8c516e",
      "original_position" : 98,
      "path" : "qa/rpc-tests/test_framework/test_framework.py",
      "position" : null,
      "pull_request_review_id" : 22369562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768",
      "updated_at" : "2017-03-06T19:12:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101639295",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101639658"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101639658"
         }
      },
      "body" : "Junk lines?",
      "commit_id" : "3b336aba4ef250868d6f3dc2bf741b0bbf621d39",
      "created_at" : "2017-02-16T22:10:40Z",
      "diff_hunk" : "@@ -183,12 +179,41 @@ def main(self):\n                     from collections import deque\n                     print(\"\".join(deque(open(f), MAX_LINES_TO_PRINT)))\n         if success:\n-            print(\"Tests successful\")\n+            self.log.info(\"Tests successful\")\n             sys.exit(0)\n         else:\n-            print(\"Failed\")\n+            self.log.warning(\"Failed\")\n             sys.exit(1)\n \n+    def start_logging(self):\n+        # Add logger and logging handlers\n+        self.log = logging.getLogger('TestFramework')\n+        self.log.setLevel(logging.DEBUG)\n+        # Create file handler to log all messages\n+        fh = logging.FileHandler(self.options.tmpdir + '/test_framework.log')\n+        fh.setLevel(logging.DEBUG)\n+        # Create console handler to log messages to stderr. By default this logs only error messages, but can be configured with --loglevel.\n+        ch = logging.StreamHandler()\n+        console_log_level = getattr(logging, self.options.loglevel.upper(), None)\n+        if not isinstance(console_log_level, int):\n+            raise ValueError('Invalid log level: %s' % loglevel)\n+        ch.setLevel(console_log_level)\n+        # Format logs the same as bitcoind's debug.log (so log files can be concatenated and sorted)\n+        formatter = logging.Formatter(fmt = '%(asctime)s %(name)s (%(levelname)s): %(message)s', datefmt='%Y-%m-%d %H:%M:%S')\n+        fh.setFormatter(formatter)\n+        ch.setFormatter(formatter)\n+        # add the handlers to the logger\n+        self.log.addHandler(fh)\n+        self.log.addHandler(ch)\n+\n+        if self.options.trace_rpc:\n+            rpc_logger = logging.getLogger(\"BitcoinRPC\")\n+            rpc_logger.setLevel(logging.DEBUG)\n+            rpc_handler = logging.StreamHandler()\n+            rpc_handler.setLevel(logging.DEBUG)\n+            rpc_logger.addHandler(rpc_handler)\n+            rpc_logger.debug(\"debug\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r101639658",
      "id" : 101639658,
      "original_commit_id" : "a8e2ab2ed74d2f9837b56979b2fe6fa23c8c516e",
      "original_position" : 116,
      "path" : "qa/rpc-tests/test_framework/test_framework.py",
      "position" : null,
      "pull_request_review_id" : 22369562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768",
      "updated_at" : "2017-03-06T19:12:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/101639658",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "utACK 3e7ed8c21c3f52a312a538746aebbbb06f67e3a1",
      "created_at" : "2017-02-17T11:12:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-280623090",
      "id" : 280623090,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9768",
      "updated_at" : "2017-02-17T11:38:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280623090",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "@ryanofsky thanks for the great feedback. I'm going to hold back on making any changes until I get some more concept ACKs/NACKs. I want to make sure people are happy going in this direction before I spend any time addressing review comments.",
      "created_at" : "2017-02-17T21:45:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-280775055",
      "id" : 280775055,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9768",
      "updated_at" : "2017-02-17T21:45:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280775055",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "@MarcoFalke @laanwj @jonasschnelli @sdaftuar you're the most active contributors to the qa directory. Can you have a quick look and give me a concept ACK/NACK so I know whether to continue in this direction.\r\n\r\nNo rush. Obviously you're all busy with the 0.14 release.",
      "created_at" : "2017-02-22T01:27:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-281538485",
      "id" : 281538485,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9768",
      "updated_at" : "2017-02-22T01:27:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/281538485",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "Concept ACK.  \r\n\r\nI haven't reviewed this PR in detail yet, but what I'd find useful is if the default behavior when running a single test locally was to print all log messages to the console, and only suppress log messages when running the tests through the `rpc-tests.py` script.",
      "created_at" : "2017-02-27T18:16:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-282803195",
      "id" : 282803195,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9768",
      "updated_at" : "2017-02-27T18:16:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/282803195",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "@sdaftuar the eventual aim will be to add a lot more low-level logging (eg logging when every p2p message is sent or received on the mininode connection). Those low-level logs will always be saved to test_framework.log, but by default are not printed to the console. If the user want low-level logs printed to console, they can specify --loglevel when running the script.",
      "created_at" : "2017-02-28T16:29:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-283089586",
      "id" : 283089586,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9768",
      "updated_at" : "2017-02-28T16:29:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/283089586",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104489334"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104489334"
         }
      },
      "body" : "Thanks. Updated.",
      "commit_id" : "3b336aba4ef250868d6f3dc2bf741b0bbf621d39",
      "created_at" : "2017-03-06T18:43:36Z",
      "diff_hunk" : "@@ -113,6 +113,8 @@ def main(self):\n                           help=\"Directory for caching pregenerated datadirs\")\n         parser.add_option(\"--tmpdir\", dest=\"tmpdir\", default=tempfile.mkdtemp(prefix=\"test\"),\n                           help=\"Root directory for datadirs\")\n+        parser.add_option(\"--loglevel\", dest=\"loglevel\", default=\"ERROR\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104489334",
      "id" : 104489334,
      "original_commit_id" : "a8e2ab2ed74d2f9837b56979b2fe6fa23c8c516e",
      "original_position" : 13,
      "path" : "qa/rpc-tests/test_framework/test_framework.py",
      "position" : 13,
      "pull_request_review_id" : 25329437,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768",
      "updated_at" : "2017-03-06T19:12:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104489334",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104489393"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104489393"
         }
      },
      "body" : "Updated",
      "commit_id" : "3b336aba4ef250868d6f3dc2bf741b0bbf621d39",
      "created_at" : "2017-03-06T18:43:45Z",
      "diff_hunk" : "@@ -113,6 +113,8 @@ def main(self):\n                           help=\"Directory for caching pregenerated datadirs\")\n         parser.add_option(\"--tmpdir\", dest=\"tmpdir\", default=tempfile.mkdtemp(prefix=\"test\"),\n                           help=\"Root directory for datadirs\")\n+        parser.add_option(\"--loglevel\", dest=\"loglevel\", default=\"ERROR\",\n+                          help=\"log events at this level and higher to the console\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104489393",
      "id" : 104489393,
      "original_commit_id" : "a8e2ab2ed74d2f9837b56979b2fe6fa23c8c516e",
      "original_position" : 14,
      "path" : "qa/rpc-tests/test_framework/test_framework.py",
      "position" : null,
      "pull_request_review_id" : 25329482,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768",
      "updated_at" : "2017-03-06T19:12:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104489393",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104489442"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104489442"
         }
      },
      "body" : "Yep, good catch.",
      "commit_id" : "3b336aba4ef250868d6f3dc2bf741b0bbf621d39",
      "created_at" : "2017-03-06T18:43:57Z",
      "diff_hunk" : "@@ -140,38 +139,35 @@ def main(self):\n         success = False\n         try:\n             os.makedirs(self.options.tmpdir, exist_ok=False)\n+            self.start_logging()\n             self.setup_chain()\n             self.setup_network()\n             self.run_test()\n             success = True\n         except JSONRPCException as e:\n-            print(\"JSONRPC error: \"+e.error['message'])\n-            traceback.print_tb(sys.exc_info()[2])\n+            self.log.exception(\"JSONRPC error: \"+e.error['message'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104489442",
      "id" : 104489442,
      "original_commit_id" : "a8e2ab2ed74d2f9837b56979b2fe6fa23c8c516e",
      "original_position" : 40,
      "path" : "qa/rpc-tests/test_framework/test_framework.py",
      "position" : null,
      "pull_request_review_id" : 25329533,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768",
      "updated_at" : "2017-03-06T19:12:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104489442",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104489635"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104489635"
         }
      },
      "body" : "good point. Fixed.",
      "commit_id" : "3b336aba4ef250868d6f3dc2bf741b0bbf621d39",
      "created_at" : "2017-03-06T18:44:46Z",
      "diff_hunk" : "@@ -140,38 +139,35 @@ def main(self):\n         success = False\n         try:\n             os.makedirs(self.options.tmpdir, exist_ok=False)\n+            self.start_logging()\n             self.setup_chain()\n             self.setup_network()\n             self.run_test()\n             success = True\n         except JSONRPCException as e:\n-            print(\"JSONRPC error: \"+e.error['message'])\n-            traceback.print_tb(sys.exc_info()[2])\n+            self.log.exception(\"JSONRPC error: \"+e.error['message'])\n         except AssertionError as e:\n-            print(\"Assertion failed: \" + str(e))\n-            traceback.print_tb(sys.exc_info()[2])\n+            self.log.exception(\"Assertion failed: \" + str(e))\n         except KeyError as e:\n-            print(\"key not found: \"+ str(e))\n-            traceback.print_tb(sys.exc_info()[2])\n+            self.log.exception(\"key not found: \"+ str(e))\n         except Exception as e:\n-            print(\"Unexpected exception caught during testing: \" + repr(e))\n-            traceback.print_tb(sys.exc_info()[2])\n+            self.log.exception(\"Unexpected exception caught during testing: \" + repr(e))\n         except KeyboardInterrupt as e:\n-            print(\"Exiting after \" + repr(e))\n+            self.log.warning(\"Exiting after \" + repr(e))\n \n         if not self.options.noshutdown:\n-            print(\"Stopping nodes\")\n+            self.log.info(\"Stopping nodes\")\n             stop_nodes(self.nodes)\n         else:\n-            print(\"Note: bitcoinds were not stopped and may still be running\")\n+            self.log.info(\"Note: bitcoinds were not stopped and may still be running\")\n \n         if not self.options.nocleanup and not self.options.noshutdown and success:\n-            print(\"Cleaning up\")\n+            self.log.info(\"Cleaning up\")\n             shutil.rmtree(self.options.tmpdir)\n             if not os.listdir(self.options.root):\n                 os.rmdir(self.options.root)\n         else:\n-            print(\"Not cleaning up dir %s\" % self.options.tmpdir)\n+            self.log.info(\"Not cleaning up dir %s\" % self.options.tmpdir)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104489635",
      "id" : 104489635,
      "original_commit_id" : "a8e2ab2ed74d2f9837b56979b2fe6fa23c8c516e",
      "original_position" : 73,
      "path" : "qa/rpc-tests/test_framework/test_framework.py",
      "position" : null,
      "pull_request_review_id" : 25329734,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768",
      "updated_at" : "2017-03-06T19:12:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104489635",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104490017"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104490017"
         }
      },
      "body" : "I think DEBUG is good here. We shouldn't encourage people to log messages at custom levels (ie not one of debug, info, warning, error and critical), and we especially shouldn't encourage people to log at a level lower than DEBUG.",
      "commit_id" : "3b336aba4ef250868d6f3dc2bf741b0bbf621d39",
      "created_at" : "2017-03-06T18:46:31Z",
      "diff_hunk" : "@@ -183,12 +179,41 @@ def main(self):\n                     from collections import deque\n                     print(\"\".join(deque(open(f), MAX_LINES_TO_PRINT)))\n         if success:\n-            print(\"Tests successful\")\n+            self.log.info(\"Tests successful\")\n             sys.exit(0)\n         else:\n-            print(\"Failed\")\n+            self.log.warning(\"Failed\")\n             sys.exit(1)\n \n+    def start_logging(self):\n+        # Add logger and logging handlers\n+        self.log = logging.getLogger('TestFramework')\n+        self.log.setLevel(logging.DEBUG)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104490017",
      "id" : 104490017,
      "original_commit_id" : "a8e2ab2ed74d2f9837b56979b2fe6fa23c8c516e",
      "original_position" : 92,
      "path" : "qa/rpc-tests/test_framework/test_framework.py",
      "position" : 92,
      "pull_request_review_id" : 25330120,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768",
      "updated_at" : "2017-03-06T19:12:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104490017",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104490992"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104490992"
         }
      },
      "body" : "Agree. I was following the Python 'logging how to' guide here: https://docs.python.org/3/howto/logging.html#logging-to-a-file which uses getattr(). I guess that was written before 3.2, which is when setlevel() was updated to take a string argument.\r\n\r\nI've tested the logging module and:\r\n- we do need to use upper() to set the log levels to uppercase\r\n- calling with an invalid string causes logging to raise a helpful exception (I was worried that it might fail silently).\r\n\r\nSo calling setlevel directly with self.options.loglevel.upper() is better.",
      "commit_id" : "3b336aba4ef250868d6f3dc2bf741b0bbf621d39",
      "created_at" : "2017-03-06T18:50:16Z",
      "diff_hunk" : "@@ -183,12 +179,41 @@ def main(self):\n                     from collections import deque\n                     print(\"\".join(deque(open(f), MAX_LINES_TO_PRINT)))\n         if success:\n-            print(\"Tests successful\")\n+            self.log.info(\"Tests successful\")\n             sys.exit(0)\n         else:\n-            print(\"Failed\")\n+            self.log.warning(\"Failed\")\n             sys.exit(1)\n \n+    def start_logging(self):\n+        # Add logger and logging handlers\n+        self.log = logging.getLogger('TestFramework')\n+        self.log.setLevel(logging.DEBUG)\n+        # Create file handler to log all messages\n+        fh = logging.FileHandler(self.options.tmpdir + '/test_framework.log')\n+        fh.setLevel(logging.DEBUG)\n+        # Create console handler to log messages to stderr. By default this logs only error messages, but can be configured with --loglevel.\n+        ch = logging.StreamHandler()\n+        console_log_level = getattr(logging, self.options.loglevel.upper(), None)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104490992",
      "id" : 104490992,
      "original_commit_id" : "a8e2ab2ed74d2f9837b56979b2fe6fa23c8c516e",
      "original_position" : 98,
      "path" : "qa/rpc-tests/test_framework/test_framework.py",
      "position" : null,
      "pull_request_review_id" : 25331087,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768",
      "updated_at" : "2017-03-06T19:12:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104490992",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104491081"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104491081"
         }
      },
      "body" : "yes. Junk lines from when I was testing this. Thanks. Removed.",
      "commit_id" : "3b336aba4ef250868d6f3dc2bf741b0bbf621d39",
      "created_at" : "2017-03-06T18:50:38Z",
      "diff_hunk" : "@@ -183,12 +179,41 @@ def main(self):\n                     from collections import deque\n                     print(\"\".join(deque(open(f), MAX_LINES_TO_PRINT)))\n         if success:\n-            print(\"Tests successful\")\n+            self.log.info(\"Tests successful\")\n             sys.exit(0)\n         else:\n-            print(\"Failed\")\n+            self.log.warning(\"Failed\")\n             sys.exit(1)\n \n+    def start_logging(self):\n+        # Add logger and logging handlers\n+        self.log = logging.getLogger('TestFramework')\n+        self.log.setLevel(logging.DEBUG)\n+        # Create file handler to log all messages\n+        fh = logging.FileHandler(self.options.tmpdir + '/test_framework.log')\n+        fh.setLevel(logging.DEBUG)\n+        # Create console handler to log messages to stderr. By default this logs only error messages, but can be configured with --loglevel.\n+        ch = logging.StreamHandler()\n+        console_log_level = getattr(logging, self.options.loglevel.upper(), None)\n+        if not isinstance(console_log_level, int):\n+            raise ValueError('Invalid log level: %s' % loglevel)\n+        ch.setLevel(console_log_level)\n+        # Format logs the same as bitcoind's debug.log (so log files can be concatenated and sorted)\n+        formatter = logging.Formatter(fmt = '%(asctime)s %(name)s (%(levelname)s): %(message)s', datefmt='%Y-%m-%d %H:%M:%S')\n+        fh.setFormatter(formatter)\n+        ch.setFormatter(formatter)\n+        # add the handlers to the logger\n+        self.log.addHandler(fh)\n+        self.log.addHandler(ch)\n+\n+        if self.options.trace_rpc:\n+            rpc_logger = logging.getLogger(\"BitcoinRPC\")\n+            rpc_logger.setLevel(logging.DEBUG)\n+            rpc_handler = logging.StreamHandler()\n+            rpc_handler.setLevel(logging.DEBUG)\n+            rpc_logger.addHandler(rpc_handler)\n+            rpc_logger.debug(\"debug\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#discussion_r104491081",
      "id" : 104491081,
      "original_commit_id" : "a8e2ab2ed74d2f9837b56979b2fe6fa23c8c516e",
      "original_position" : 116,
      "path" : "qa/rpc-tests/test_framework/test_framework.py",
      "position" : null,
      "pull_request_review_id" : 25331182,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9768",
      "updated_at" : "2017-03-06T19:12:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104491081",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "I've addressed @ryanofsky's review comments and repushed. A few updates since I opened this PR:\r\n\r\n- microsecond debug logging is now set by default on all test nodes. I've removed all places in the test code where debugging is set manually, since there's no reason not to use debug logging in these test cases.\r\n- I've added logging to the test_framework submodules\r\n- I've replaced print functions in the individual test-cases with logging calls\r\n\r\nI've been running with this patch set locally for some time, together with a tool to interleave test_framwork logs with individual node logs. It makes troubleshooting testcases a lot easier since I have a global view of everything that's happening in the test case (ie I can see messages being sent in by the test framework and then received by the node).\r\n\r\nI believe this is ready for merge, but any further review comments are welcomed.",
      "created_at" : "2017-03-06T19:13:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9768#issuecomment-284500285",
      "id" : 284500285,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9768",
      "updated_at" : "2017-03-06T19:13:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/284500285",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
