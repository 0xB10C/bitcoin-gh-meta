[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22006#discussion_r636317357"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22006"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636317357"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\nShowing recent P2P messages between our node and their node for a selected peer.\r\n```",
      "commit_id" : "92dc3a6fcdede09ea21d089ab7f89114d1e105aa",
      "created_at" : "2021-05-20T17:34:58Z",
      "diff_hunk" : "@@ -0,0 +1,206 @@\n+Example scripts for User-space, Statically Defined Tracing (USDT)\n+=================================================================\n+\n+This directory contains scripts showcasing User-space, Statically Defined\n+Tracing (USDT) support for Bitcoin Core on Linux using. For more information on\n+USDT support in Bitcoin Core see the [USDT documentation].\n+\n+[USDT documentation]: ../doc/tracing.md\n+\n+\n+Examples for the two main eBPF front-ends, [bpftrace] and\n+[BPF Compiler Collection (BCC)], with support for USDT, are listed. BCC is used\n+for complex tools and daemons and `bpftrace` is preferred for one-liners and\n+shorter scripts.\n+\n+[bpftrace]: https://github.com/iovisor/bpftrace\n+[BPF Compiler Collection (BCC)]: https://github.com/iovisor/bcc\n+\n+\n+To develop and run bpftrace and BCC scripts you need to install the\n+corresponding packages. See [installing bpftrace] and [installing BCC] for more\n+information. For development there exist a [bpftrace Reference Guide], a\n+[BCC Reference Guide], and a [bcc Python Developer Tutorial].\n+\n+[installing bpftrace]: https://github.com/iovisor/bpftrace/blob/master/INSTALL.md\n+[installing BCC]: https://github.com/iovisor/bcc/blob/master/INSTALL.md\n+[bpftrace Reference Guide]: https://github.com/iovisor/bpftrace/blob/master/docs/reference_guide.md\n+[BCC Reference Guide]: https://github.com/iovisor/bcc/blob/master/docs/reference_guide.md\n+[bcc Python Developer Tutorial]: https://github.com/iovisor/bcc/blob/master/docs/tutorial_bcc_python_developer.md\n+\n+## Examples\n+\n+The bpftrace examples contain a relative path to the `bitcoind` binary. By\n+default, the scripts should be run from the repository-root and assume a\n+self-compiled `bitcoind` binary. The paths in the examples can be changed, for\n+example, to point to release builds if needed. See the\n+[Bitcoin Core USDT documentation] on how to list available tracepoints in your\n+`bitcoind` binary.\n+\n+[Bitcoin Core USDT documentation]: ../../doc/tracing.md#listing-available-tracepoints\n+\n+**WARNING: eBPF programs require root privileges to be loaded into a Linux\n+kernel VM. This means the bpftrace and BCC examples must be executed with root\n+privileges. Make sure to carefully review any scripts that you run with root\n+privileges first!**\n+\n+### log_p2p_traffic.bt\n+\n+A bpftrace script logging information about inbound and outbound P2P network\n+messages. Based on the `net:inbound_message` and `net:outbound_message`\n+tracepoints.\n+\n+By default, `bpftrace` limits strings to 64 bytes due to the limited stack size\n+in the eBPF VM. For example, Tor v3 addresses exceed the string size limit which\n+results in the port being cut off during logging. The string size limit can be\n+increased with the `BPFTRACE_STRLEN` environment variable (`BPFTRACE_STRLEN=70`\n+works fine).\n+\n+```\n+$ bpftrace contrib/tracing/log_p2p_traffic.bt\n+```\n+\n+Output\n+```\n+outbound 'ping' msg to peer 11 (outbound-full-relay, [2a02:b10c:f747:1:ef:fake:ipv6:addr]:8333) with 8 bytes\n+inbound 'pong' msg from peer 11 (outbound-full-relay, [2a02:b10c:f747:1:ef:fake:ipv6:addr]:8333) with 8 bytes\n+inbound 'inv' msg from peer 16 (outbound-full-relay, XX.XX.XXX.121:8333) with 37 bytes\n+outbound 'getdata' msg to peer 16 (outbound-full-relay, XX.XX.XXX.121:8333) with 37 bytes\n+inbound 'tx' msg from peer 16 (outbound-full-relay, XX.XX.XXX.121:8333) with 222 bytes\n+outbound 'inv' msg to peer 9 (outbound-full-relay, faketorv3addressa2ufa6odvoi3s77j4uegey0xb10csyfyve2t33curbyd.onion:8333) with 37 bytes\n+outbound 'inv' msg to peer 7 (outbound-full-relay, XX.XX.XXX.242:8333) with 37 bytes\n+â¦\n+```\n+\n+### p2p_monitor.py\n+\n+A Python script using the wrapper around BCC and curses for an interactive P2P\n+message monitor. Based on the `net:inbound_message` and `net:outbound_message`\n+tracepoints.\n+\n+Inbound and outbound traffic is listed for each peer together with information\n+about the connection. Peers can be selected individually to view recent P2P\n+messages.\n+\n+```\n+$ python3 contrib/tracing/p2p_monitor.py ./src/bitcoind\n+```\n+\n+Lists selectable peers and traffic and connection information.\n+```\n+ P2P Message Monitor\n+ navigatate with UP/DOWN or J/K and select a peer with ENTER or SPACE to see individual P2P messages\n+\n+ PEER  OUTBOUND              INBOUND               TYPE                   ADDR\n+    0  46          398 byte  61      1407590 byte  block-relay-only       XX.XX.XXX.196:8333\n+   11  1156     253570 byte  3431    2394924 byte  outbound-full-relay    XXX.X.XX.179:8333\n+   13  3425    1809620 byte  1236     305458 byte  inbound                XXX.X.X.X:60380\n+   16  1046     241633 byte  1589    1199220 byte  outbound-full-relay    4faketorv2pbfu7x.onion:8333\n+   19  577      181679 byte  390      148951 byte  outbound-full-relay    kfake4vctorjv2o2.onion:8333\n+   20  11         1248 byte  13         1283 byte  block-relay-only       [2600:fake:64d9:b10c:4436:aaaa:fe:bb]:8333\n+   21  11         1248 byte  13         1299 byte  block-relay-only       XX.XXX.X.155:8333\n+   22  5           103 byte  1           102 byte  feeler                 XX.XX.XXX.173:8333\n+   23  11         1248 byte  12         1255 byte  block-relay-only       XX.XXX.XXX.220:8333\n+   24  3           103 byte  1           102 byte  feeler                 XXX.XXX.XXX.64:8333\n+â¦\n+```\n+\n+Showing recent P2P messages between our onde and their node for a selected peer.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22006#discussion_r636317357",
      "id" : 636317357,
      "line" : 108,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNjMxNzM1Nw==",
      "original_commit_id" : "92dc3a6fcdede09ea21d089ab7f89114d1e105aa",
      "original_line" : 108,
      "original_position" : 108,
      "original_start_line" : null,
      "path" : "contrib/tracing/README.md",
      "position" : 108,
      "pull_request_review_id" : 664681203,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22006",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-20T17:34:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636317357",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\n\r\nExcellent work! :)",
      "created_at" : "2021-05-20T19:36:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22006#issuecomment-845420275",
      "id" : 845420275,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22006",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0NTQyMDI3NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-20T19:36:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/845420275",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Nice work!",
      "created_at" : "2021-05-20T21:03:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22006#issuecomment-845475291",
      "id" : 845475291,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22006",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0NTQ3NTI5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-20T21:03:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/845475291",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Saw a live demo of this and it seems to be very cool.",
      "created_at" : "2021-05-21T09:21:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22006#issuecomment-845814113",
      "id" : 845814113,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22006",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0NTgxNDExMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-21T09:30:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/845814113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22006#discussion_r636773835"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22006"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636773835"
         }
      },
      "author_association" : "MEMBER",
      "body" : "perhaps omit \"their node for \"",
      "commit_id" : "92dc3a6fcdede09ea21d089ab7f89114d1e105aa",
      "created_at" : "2021-05-21T09:26:49Z",
      "diff_hunk" : "@@ -0,0 +1,206 @@\n+Example scripts for User-space, Statically Defined Tracing (USDT)\n+=================================================================\n+\n+This directory contains scripts showcasing User-space, Statically Defined\n+Tracing (USDT) support for Bitcoin Core on Linux using. For more information on\n+USDT support in Bitcoin Core see the [USDT documentation].\n+\n+[USDT documentation]: ../doc/tracing.md\n+\n+\n+Examples for the two main eBPF front-ends, [bpftrace] and\n+[BPF Compiler Collection (BCC)], with support for USDT, are listed. BCC is used\n+for complex tools and daemons and `bpftrace` is preferred for one-liners and\n+shorter scripts.\n+\n+[bpftrace]: https://github.com/iovisor/bpftrace\n+[BPF Compiler Collection (BCC)]: https://github.com/iovisor/bcc\n+\n+\n+To develop and run bpftrace and BCC scripts you need to install the\n+corresponding packages. See [installing bpftrace] and [installing BCC] for more\n+information. For development there exist a [bpftrace Reference Guide], a\n+[BCC Reference Guide], and a [bcc Python Developer Tutorial].\n+\n+[installing bpftrace]: https://github.com/iovisor/bpftrace/blob/master/INSTALL.md\n+[installing BCC]: https://github.com/iovisor/bcc/blob/master/INSTALL.md\n+[bpftrace Reference Guide]: https://github.com/iovisor/bpftrace/blob/master/docs/reference_guide.md\n+[BCC Reference Guide]: https://github.com/iovisor/bcc/blob/master/docs/reference_guide.md\n+[bcc Python Developer Tutorial]: https://github.com/iovisor/bcc/blob/master/docs/tutorial_bcc_python_developer.md\n+\n+## Examples\n+\n+The bpftrace examples contain a relative path to the `bitcoind` binary. By\n+default, the scripts should be run from the repository-root and assume a\n+self-compiled `bitcoind` binary. The paths in the examples can be changed, for\n+example, to point to release builds if needed. See the\n+[Bitcoin Core USDT documentation] on how to list available tracepoints in your\n+`bitcoind` binary.\n+\n+[Bitcoin Core USDT documentation]: ../../doc/tracing.md#listing-available-tracepoints\n+\n+**WARNING: eBPF programs require root privileges to be loaded into a Linux\n+kernel VM. This means the bpftrace and BCC examples must be executed with root\n+privileges. Make sure to carefully review any scripts that you run with root\n+privileges first!**\n+\n+### log_p2p_traffic.bt\n+\n+A bpftrace script logging information about inbound and outbound P2P network\n+messages. Based on the `net:inbound_message` and `net:outbound_message`\n+tracepoints.\n+\n+By default, `bpftrace` limits strings to 64 bytes due to the limited stack size\n+in the eBPF VM. For example, Tor v3 addresses exceed the string size limit which\n+results in the port being cut off during logging. The string size limit can be\n+increased with the `BPFTRACE_STRLEN` environment variable (`BPFTRACE_STRLEN=70`\n+works fine).\n+\n+```\n+$ bpftrace contrib/tracing/log_p2p_traffic.bt\n+```\n+\n+Output\n+```\n+outbound 'ping' msg to peer 11 (outbound-full-relay, [2a02:b10c:f747:1:ef:fake:ipv6:addr]:8333) with 8 bytes\n+inbound 'pong' msg from peer 11 (outbound-full-relay, [2a02:b10c:f747:1:ef:fake:ipv6:addr]:8333) with 8 bytes\n+inbound 'inv' msg from peer 16 (outbound-full-relay, XX.XX.XXX.121:8333) with 37 bytes\n+outbound 'getdata' msg to peer 16 (outbound-full-relay, XX.XX.XXX.121:8333) with 37 bytes\n+inbound 'tx' msg from peer 16 (outbound-full-relay, XX.XX.XXX.121:8333) with 222 bytes\n+outbound 'inv' msg to peer 9 (outbound-full-relay, faketorv3addressa2ufa6odvoi3s77j4uegey0xb10csyfyve2t33curbyd.onion:8333) with 37 bytes\n+outbound 'inv' msg to peer 7 (outbound-full-relay, XX.XX.XXX.242:8333) with 37 bytes\n+â¦\n+```\n+\n+### p2p_monitor.py\n+\n+A Python script using the wrapper around BCC and curses for an interactive P2P\n+message monitor. Based on the `net:inbound_message` and `net:outbound_message`\n+tracepoints.\n+\n+Inbound and outbound traffic is listed for each peer together with information\n+about the connection. Peers can be selected individually to view recent P2P\n+messages.\n+\n+```\n+$ python3 contrib/tracing/p2p_monitor.py ./src/bitcoind\n+```\n+\n+Lists selectable peers and traffic and connection information.\n+```\n+ P2P Message Monitor\n+ navigatate with UP/DOWN or J/K and select a peer with ENTER or SPACE to see individual P2P messages\n+\n+ PEER  OUTBOUND              INBOUND               TYPE                   ADDR\n+    0  46          398 byte  61      1407590 byte  block-relay-only       XX.XX.XXX.196:8333\n+   11  1156     253570 byte  3431    2394924 byte  outbound-full-relay    XXX.X.XX.179:8333\n+   13  3425    1809620 byte  1236     305458 byte  inbound                XXX.X.X.X:60380\n+   16  1046     241633 byte  1589    1199220 byte  outbound-full-relay    4faketorv2pbfu7x.onion:8333\n+   19  577      181679 byte  390      148951 byte  outbound-full-relay    kfake4vctorjv2o2.onion:8333\n+   20  11         1248 byte  13         1283 byte  block-relay-only       [2600:fake:64d9:b10c:4436:aaaa:fe:bb]:8333\n+   21  11         1248 byte  13         1299 byte  block-relay-only       XX.XXX.X.155:8333\n+   22  5           103 byte  1           102 byte  feeler                 XX.XX.XXX.173:8333\n+   23  11         1248 byte  12         1255 byte  block-relay-only       XX.XXX.XXX.220:8333\n+   24  3           103 byte  1           102 byte  feeler                 XXX.XXX.XXX.64:8333\n+â¦\n+```\n+\n+Showing recent P2P messages between our onde and their node for a selected peer.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22006#discussion_r636773835",
      "id" : 636773835,
      "in_reply_to_id" : 636317357,
      "line" : 108,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNjc3MzgzNQ==",
      "original_commit_id" : "92dc3a6fcdede09ea21d089ab7f89114d1e105aa",
      "original_line" : 108,
      "original_position" : 108,
      "original_start_line" : null,
      "path" : "contrib/tracing/README.md",
      "position" : 108,
      "pull_request_review_id" : 665268373,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22006",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-21T09:27:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636773835",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22006#discussion_r636774448"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22006"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636774448"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/THEIR NODE/PEER/",
      "commit_id" : "92dc3a6fcdede09ea21d089ab7f89114d1e105aa",
      "created_at" : "2021-05-21T09:27:46Z",
      "diff_hunk" : "@@ -43,3 +43,88 @@ example, to point to release builds if needed. See the\n kernel VM. This means the bpftrace and BCC examples must be executed with root\n privileges. Make sure to carefully review any scripts that you run with root\n privileges first!**\n+\n+### log_p2p_traffic.bt\n+\n+A bpftrace script logging information about inbound and outbound P2P network\n+messages. Based on the `net:inbound_message` and `net:outbound_message`\n+tracepoints.\n+\n+By default, `bpftrace` limits strings to 64 bytes due to the limited stack size\n+in the eBPF VM. For example, Tor v3 addresses exceed the string size limit which\n+results in the port being cut off during logging. The string size limit can be\n+increased with the `BPFTRACE_STRLEN` environment variable (`BPFTRACE_STRLEN=70`\n+works fine).\n+\n+```\n+$ bpftrace contrib/tracing/log_p2p_traffic.bt\n+```\n+\n+Output\n+```\n+outbound 'ping' msg to peer 11 (outbound-full-relay, [2a02:b10c:f747:1:ef:fake:ipv6:addr]:8333) with 8 bytes\n+inbound 'pong' msg from peer 11 (outbound-full-relay, [2a02:b10c:f747:1:ef:fake:ipv6:addr]:8333) with 8 bytes\n+inbound 'inv' msg from peer 16 (outbound-full-relay, XX.XX.XXX.121:8333) with 37 bytes\n+outbound 'getdata' msg to peer 16 (outbound-full-relay, XX.XX.XXX.121:8333) with 37 bytes\n+inbound 'tx' msg from peer 16 (outbound-full-relay, XX.XX.XXX.121:8333) with 222 bytes\n+outbound 'inv' msg to peer 9 (outbound-full-relay, faketorv3addressa2ufa6odvoi3s77j4uegey0xb10csyfyve2t33curbyd.onion:8333) with 37 bytes\n+outbound 'inv' msg to peer 7 (outbound-full-relay, XX.XX.XXX.242:8333) with 37 bytes\n+â¦\n+```\n+\n+### p2p_monitor.py\n+\n+A Python script using the wrapper around BCC and curses for an interactive P2P\n+message monitor. Based on the `net:inbound_message` and `net:outbound_message`\n+tracepoints.\n+\n+Inbound and outbound traffic is listed for each peer together with information\n+about the connection. Peers can be selected individually to view recent P2P\n+messages.\n+\n+```\n+$ python3 contrib/tracing/p2p_monitor.py ./src/bitcoind\n+```\n+\n+Lists selectable peers and traffic and connection information.\n+```\n+ P2P Message Monitor\n+ navigatate with UP/DOWN or J/K and select a peer with ENTER or SPACE to see individual P2P messages\n+\n+ PEER  OUTBOUND              INBOUND               TYPE                   ADDR\n+    0  46          398 byte  61      1407590 byte  block-relay-only       XX.XX.XXX.196:8333\n+   11  1156     253570 byte  3431    2394924 byte  outbound-full-relay    XXX.X.XX.179:8333\n+   13  3425    1809620 byte  1236     305458 byte  inbound                XXX.X.X.X:60380\n+   16  1046     241633 byte  1589    1199220 byte  outbound-full-relay    4faketorv2pbfu7x.onion:8333\n+   19  577      181679 byte  390      148951 byte  outbound-full-relay    kfake4vctorjv2o2.onion:8333\n+   20  11         1248 byte  13         1283 byte  block-relay-only       [2600:fake:64d9:b10c:4436:aaaa:fe:bb]:8333\n+   21  11         1248 byte  13         1299 byte  block-relay-only       XX.XXX.X.155:8333\n+   22  5           103 byte  1           102 byte  feeler                 XX.XX.XXX.173:8333\n+   23  11         1248 byte  12         1255 byte  block-relay-only       XX.XXX.XXX.220:8333\n+   24  3           103 byte  1           102 byte  feeler                 XXX.XXX.XXX.64:8333\n+â¦\n+```\n+\n+Showing recent P2P messages between our onde and their node for a selected peer.\n+\n+```\n+    ----------------------------------------------------------------------\n+    |                PEER 16 (4faketorv2pbfu7x.onion:8333)               |\n+    | OUR NODE              outbound-full-relay               THEIR NODE |",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22006#discussion_r636774448",
      "id" : 636774448,
      "line" : 113,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNjc3NDQ0OA==",
      "original_commit_id" : "3ca502d16c53717d6901d210d51e5e2e769c9f74",
      "original_line" : 113,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "contrib/tracing/README.md",
      "position" : 113,
      "pull_request_review_id" : 665269195,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22006",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-21T09:27:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636774448",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22006#discussion_r636775863"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22006"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636775863"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Wishlist: this for disconnection and eviction events, with the message, connection direction and type, peer id and address, network the peer connected through. ",
      "commit_id" : "cdb400564084c57130bed4edb80b8d6b7e786f0c",
      "created_at" : "2021-05-21T09:29:44Z",
      "diff_hunk" : "@@ -43,3 +43,88 @@ example, to point to release builds if needed. See the\n kernel VM. This means the bpftrace and BCC examples must be executed with root\n privileges. Make sure to carefully review any scripts that you run with root\n privileges first!**\n+\n+### log_p2p_traffic.bt\n+\n+A bpftrace script logging information about inbound and outbound P2P network\n+messages. Based on the `net:inbound_message` and `net:outbound_message`",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22006#discussion_r636775863",
      "id" : 636775863,
      "line" : 50,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNjc3NTg2Mw==",
      "original_commit_id" : "3ca502d16c53717d6901d210d51e5e2e769c9f74",
      "original_line" : 50,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "contrib/tracing/README.md",
      "position" : 50,
      "pull_request_review_id" : 665271067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22006",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-21T10:20:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636775863",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22006#discussion_r636791861"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22006"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636791861"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Agree! We discussed something similar in https://github.com/bitcoin/bitcoin/issues/20981#issuecomment-766096054 too. Thanks for the input on the arguments! I'll resolve this in favor of https://github.com/bitcoin/bitcoin/issues/20981#issuecomment-845833323 :)\r\n\r\n ",
      "commit_id" : "92dc3a6fcdede09ea21d089ab7f89114d1e105aa",
      "created_at" : "2021-05-21T09:54:30Z",
      "diff_hunk" : "@@ -43,3 +43,88 @@ example, to point to release builds if needed. See the\n kernel VM. This means the bpftrace and BCC examples must be executed with root\n privileges. Make sure to carefully review any scripts that you run with root\n privileges first!**\n+\n+### log_p2p_traffic.bt\n+\n+A bpftrace script logging information about inbound and outbound P2P network\n+messages. Based on the `net:inbound_message` and `net:outbound_message`",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22006#discussion_r636791861",
      "id" : 636791861,
      "in_reply_to_id" : 636775863,
      "line" : 50,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNjc5MTg2MQ==",
      "original_commit_id" : "3ca502d16c53717d6901d210d51e5e2e769c9f74",
      "original_line" : 50,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "contrib/tracing/README.md",
      "position" : 50,
      "pull_request_review_id" : 665292493,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22006",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-21T09:54:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636791861",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22006#discussion_r636805329"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22006"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636805329"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Do we need to sanitize this? the message types for all outgoing messages are hardcoded in our binary so should all be safe.",
      "commit_id" : "cdb400564084c57130bed4edb80b8d6b7e786f0c",
      "created_at" : "2021-05-21T10:16:38Z",
      "diff_hunk" : "@@ -2959,11 +2960,21 @@ bool CConnman::NodeFullyConnected(const CNode* pnode)\n void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n {\n     size_t nMessageSize = msg.data.size();\n-    LogPrint(BCLog::NET, \"sending %s (%d bytes) peer=%d\\n\",  SanitizeString(msg.m_type), nMessageSize, pnode->GetId());\n+    auto sanitizedType = SanitizeString(msg.m_type);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22006#discussion_r636805329",
      "id" : 636805329,
      "line" : 2963,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNjgwNTMyOQ==",
      "original_commit_id" : "92dc3a6fcdede09ea21d089ab7f89114d1e105aa",
      "original_line" : 2963,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 13,
      "pull_request_review_id" : 665310332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22006",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-21T10:17:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636805329",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22006#discussion_r636814198"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22006"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636814198"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done, thanks!",
      "commit_id" : "cdb400564084c57130bed4edb80b8d6b7e786f0c",
      "created_at" : "2021-05-21T10:32:12Z",
      "diff_hunk" : "@@ -43,3 +43,88 @@ example, to point to release builds if needed. See the\n kernel VM. This means the bpftrace and BCC examples must be executed with root\n privileges. Make sure to carefully review any scripts that you run with root\n privileges first!**\n+\n+### log_p2p_traffic.bt\n+\n+A bpftrace script logging information about inbound and outbound P2P network\n+messages. Based on the `net:inbound_message` and `net:outbound_message`\n+tracepoints.\n+\n+By default, `bpftrace` limits strings to 64 bytes due to the limited stack size\n+in the eBPF VM. For example, Tor v3 addresses exceed the string size limit which\n+results in the port being cut off during logging. The string size limit can be\n+increased with the `BPFTRACE_STRLEN` environment variable (`BPFTRACE_STRLEN=70`\n+works fine).\n+\n+```\n+$ bpftrace contrib/tracing/log_p2p_traffic.bt\n+```\n+\n+Output\n+```\n+outbound 'ping' msg to peer 11 (outbound-full-relay, [2a02:b10c:f747:1:ef:fake:ipv6:addr]:8333) with 8 bytes\n+inbound 'pong' msg from peer 11 (outbound-full-relay, [2a02:b10c:f747:1:ef:fake:ipv6:addr]:8333) with 8 bytes\n+inbound 'inv' msg from peer 16 (outbound-full-relay, XX.XX.XXX.121:8333) with 37 bytes\n+outbound 'getdata' msg to peer 16 (outbound-full-relay, XX.XX.XXX.121:8333) with 37 bytes\n+inbound 'tx' msg from peer 16 (outbound-full-relay, XX.XX.XXX.121:8333) with 222 bytes\n+outbound 'inv' msg to peer 9 (outbound-full-relay, faketorv3addressa2ufa6odvoi3s77j4uegey0xb10csyfyve2t33curbyd.onion:8333) with 37 bytes\n+outbound 'inv' msg to peer 7 (outbound-full-relay, XX.XX.XXX.242:8333) with 37 bytes\n+â¦\n+```\n+\n+### p2p_monitor.py\n+\n+A Python script using the wrapper around BCC and curses for an interactive P2P\n+message monitor. Based on the `net:inbound_message` and `net:outbound_message`\n+tracepoints.\n+\n+Inbound and outbound traffic is listed for each peer together with information\n+about the connection. Peers can be selected individually to view recent P2P\n+messages.\n+\n+```\n+$ python3 contrib/tracing/p2p_monitor.py ./src/bitcoind\n+```\n+\n+Lists selectable peers and traffic and connection information.\n+```\n+ P2P Message Monitor\n+ navigatate with UP/DOWN or J/K and select a peer with ENTER or SPACE to see individual P2P messages\n+\n+ PEER  OUTBOUND              INBOUND               TYPE                   ADDR\n+    0  46          398 byte  61      1407590 byte  block-relay-only       XX.XX.XXX.196:8333\n+   11  1156     253570 byte  3431    2394924 byte  outbound-full-relay    XXX.X.XX.179:8333\n+   13  3425    1809620 byte  1236     305458 byte  inbound                XXX.X.X.X:60380\n+   16  1046     241633 byte  1589    1199220 byte  outbound-full-relay    4faketorv2pbfu7x.onion:8333\n+   19  577      181679 byte  390      148951 byte  outbound-full-relay    kfake4vctorjv2o2.onion:8333\n+   20  11         1248 byte  13         1283 byte  block-relay-only       [2600:fake:64d9:b10c:4436:aaaa:fe:bb]:8333\n+   21  11         1248 byte  13         1299 byte  block-relay-only       XX.XXX.X.155:8333\n+   22  5           103 byte  1           102 byte  feeler                 XX.XX.XXX.173:8333\n+   23  11         1248 byte  12         1255 byte  block-relay-only       XX.XXX.XXX.220:8333\n+   24  3           103 byte  1           102 byte  feeler                 XXX.XXX.XXX.64:8333\n+â¦\n+```\n+\n+Showing recent P2P messages between our onde and their node for a selected peer.\n+\n+```\n+    ----------------------------------------------------------------------\n+    |                PEER 16 (4faketorv2pbfu7x.onion:8333)               |\n+    | OUR NODE              outbound-full-relay               THEIR NODE |",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22006#discussion_r636814198",
      "id" : 636814198,
      "in_reply_to_id" : 636774448,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNjgxNDE5OA==",
      "original_commit_id" : "3ca502d16c53717d6901d210d51e5e2e769c9f74",
      "original_line" : 113,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "contrib/tracing/README.md",
      "position" : null,
      "pull_request_review_id" : 665322214,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22006",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-21T10:32:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636814198",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22006#discussion_r636814363"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22006"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636814363"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done both, thanks!",
      "commit_id" : "cdb400564084c57130bed4edb80b8d6b7e786f0c",
      "created_at" : "2021-05-21T10:32:33Z",
      "diff_hunk" : "@@ -0,0 +1,206 @@\n+Example scripts for User-space, Statically Defined Tracing (USDT)\n+=================================================================\n+\n+This directory contains scripts showcasing User-space, Statically Defined\n+Tracing (USDT) support for Bitcoin Core on Linux using. For more information on\n+USDT support in Bitcoin Core see the [USDT documentation].\n+\n+[USDT documentation]: ../doc/tracing.md\n+\n+\n+Examples for the two main eBPF front-ends, [bpftrace] and\n+[BPF Compiler Collection (BCC)], with support for USDT, are listed. BCC is used\n+for complex tools and daemons and `bpftrace` is preferred for one-liners and\n+shorter scripts.\n+\n+[bpftrace]: https://github.com/iovisor/bpftrace\n+[BPF Compiler Collection (BCC)]: https://github.com/iovisor/bcc\n+\n+\n+To develop and run bpftrace and BCC scripts you need to install the\n+corresponding packages. See [installing bpftrace] and [installing BCC] for more\n+information. For development there exist a [bpftrace Reference Guide], a\n+[BCC Reference Guide], and a [bcc Python Developer Tutorial].\n+\n+[installing bpftrace]: https://github.com/iovisor/bpftrace/blob/master/INSTALL.md\n+[installing BCC]: https://github.com/iovisor/bcc/blob/master/INSTALL.md\n+[bpftrace Reference Guide]: https://github.com/iovisor/bpftrace/blob/master/docs/reference_guide.md\n+[BCC Reference Guide]: https://github.com/iovisor/bcc/blob/master/docs/reference_guide.md\n+[bcc Python Developer Tutorial]: https://github.com/iovisor/bcc/blob/master/docs/tutorial_bcc_python_developer.md\n+\n+## Examples\n+\n+The bpftrace examples contain a relative path to the `bitcoind` binary. By\n+default, the scripts should be run from the repository-root and assume a\n+self-compiled `bitcoind` binary. The paths in the examples can be changed, for\n+example, to point to release builds if needed. See the\n+[Bitcoin Core USDT documentation] on how to list available tracepoints in your\n+`bitcoind` binary.\n+\n+[Bitcoin Core USDT documentation]: ../../doc/tracing.md#listing-available-tracepoints\n+\n+**WARNING: eBPF programs require root privileges to be loaded into a Linux\n+kernel VM. This means the bpftrace and BCC examples must be executed with root\n+privileges. Make sure to carefully review any scripts that you run with root\n+privileges first!**\n+\n+### log_p2p_traffic.bt\n+\n+A bpftrace script logging information about inbound and outbound P2P network\n+messages. Based on the `net:inbound_message` and `net:outbound_message`\n+tracepoints.\n+\n+By default, `bpftrace` limits strings to 64 bytes due to the limited stack size\n+in the eBPF VM. For example, Tor v3 addresses exceed the string size limit which\n+results in the port being cut off during logging. The string size limit can be\n+increased with the `BPFTRACE_STRLEN` environment variable (`BPFTRACE_STRLEN=70`\n+works fine).\n+\n+```\n+$ bpftrace contrib/tracing/log_p2p_traffic.bt\n+```\n+\n+Output\n+```\n+outbound 'ping' msg to peer 11 (outbound-full-relay, [2a02:b10c:f747:1:ef:fake:ipv6:addr]:8333) with 8 bytes\n+inbound 'pong' msg from peer 11 (outbound-full-relay, [2a02:b10c:f747:1:ef:fake:ipv6:addr]:8333) with 8 bytes\n+inbound 'inv' msg from peer 16 (outbound-full-relay, XX.XX.XXX.121:8333) with 37 bytes\n+outbound 'getdata' msg to peer 16 (outbound-full-relay, XX.XX.XXX.121:8333) with 37 bytes\n+inbound 'tx' msg from peer 16 (outbound-full-relay, XX.XX.XXX.121:8333) with 222 bytes\n+outbound 'inv' msg to peer 9 (outbound-full-relay, faketorv3addressa2ufa6odvoi3s77j4uegey0xb10csyfyve2t33curbyd.onion:8333) with 37 bytes\n+outbound 'inv' msg to peer 7 (outbound-full-relay, XX.XX.XXX.242:8333) with 37 bytes\n+â¦\n+```\n+\n+### p2p_monitor.py\n+\n+A Python script using the wrapper around BCC and curses for an interactive P2P\n+message monitor. Based on the `net:inbound_message` and `net:outbound_message`\n+tracepoints.\n+\n+Inbound and outbound traffic is listed for each peer together with information\n+about the connection. Peers can be selected individually to view recent P2P\n+messages.\n+\n+```\n+$ python3 contrib/tracing/p2p_monitor.py ./src/bitcoind\n+```\n+\n+Lists selectable peers and traffic and connection information.\n+```\n+ P2P Message Monitor\n+ navigatate with UP/DOWN or J/K and select a peer with ENTER or SPACE to see individual P2P messages\n+\n+ PEER  OUTBOUND              INBOUND               TYPE                   ADDR\n+    0  46          398 byte  61      1407590 byte  block-relay-only       XX.XX.XXX.196:8333\n+   11  1156     253570 byte  3431    2394924 byte  outbound-full-relay    XXX.X.XX.179:8333\n+   13  3425    1809620 byte  1236     305458 byte  inbound                XXX.X.X.X:60380\n+   16  1046     241633 byte  1589    1199220 byte  outbound-full-relay    4faketorv2pbfu7x.onion:8333\n+   19  577      181679 byte  390      148951 byte  outbound-full-relay    kfake4vctorjv2o2.onion:8333\n+   20  11         1248 byte  13         1283 byte  block-relay-only       [2600:fake:64d9:b10c:4436:aaaa:fe:bb]:8333\n+   21  11         1248 byte  13         1299 byte  block-relay-only       XX.XXX.X.155:8333\n+   22  5           103 byte  1           102 byte  feeler                 XX.XX.XXX.173:8333\n+   23  11         1248 byte  12         1255 byte  block-relay-only       XX.XXX.XXX.220:8333\n+   24  3           103 byte  1           102 byte  feeler                 XXX.XXX.XXX.64:8333\n+â¦\n+```\n+\n+Showing recent P2P messages between our onde and their node for a selected peer.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22006#discussion_r636814363",
      "id" : 636814363,
      "in_reply_to_id" : 636317357,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNjgxNDM2Mw==",
      "original_commit_id" : "92dc3a6fcdede09ea21d089ab7f89114d1e105aa",
      "original_line" : 108,
      "original_position" : 108,
      "original_start_line" : null,
      "path" : "contrib/tracing/README.md",
      "position" : null,
      "pull_request_review_id" : 665322468,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22006",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-21T10:32:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636814363",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22006#discussion_r637377827"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22006"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637377827"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n1. The tracing script compiles the eBPF code and loads the eBFP program into a kernel VM\r\n```",
      "commit_id" : "cdb400564084c57130bed4edb80b8d6b7e786f0c",
      "created_at" : "2021-05-22T09:06:06Z",
      "diff_hunk" : "@@ -0,0 +1,263 @@\n+# User-space, Statically Defined Tracing (USDT) for Bitcoin Core\n+\n+Bitcoin Core includes statically defined tracepoints to allow for more\n+observability during development, debugging, code review, and production usage.\n+These tracepoints make it possible to keep track of custom statistics and\n+enable detailed monitoring of otherwise hidden internals. They have\n+little to no performance impact when unused.\n+\n+```\n+eBFP and USDT Overview\n+======================\n+\n+                ââââââââââââââââââââ            ââââââââââââââââ\n+                â tracing script   â            â bitcoind     â\n+                â==================â      2.    â==============â\n+                â  eBPF  â tracing â      hooks â              â\n+                â  code  â logic   â      intoâââ¤âºtracepoint 1ââ¼ââââ 3.\n+                ââââââ¬ââââ´âââ²âââââââ          âââ¤âºtracepoint 2 â   â pass args\n+            1.       â      â 4.              â â ...          â   â to eBPF\n+    User    compiles â      â pass data to    â ââââââââââââââââ   â program\n+    Space    & loads â      â tracing script  â                    â\n+    ââââââââââââââââââ¼âââââââ¼ââââââââââââââââââ¼âââââââââââââââââââââ¼âââ\n+    Kernel           â      â                 â                    â\n+    Space       ââââ¬ââ¼âââââââ´ââââââââââââââââââ´âââââââââââââ       â\n+                â  â  eBPF program                         âââââââââ\n+                â  âââââââââââââââââââââââââââââââââââââââââ¤\n+                â eBPF kernel Virtual Machine (sandboxed)  â\n+                ââââââââââââââââââââââââââââââââââââââââââââ\n+\n+1. The tracing script complies the eBPF code and loads the eBFP program into a kernel VM",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22006#discussion_r637377827",
      "id" : 637377827,
      "line" : 30,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNzM3NzgyNw==",
      "original_commit_id" : "cdb400564084c57130bed4edb80b8d6b7e786f0c",
      "original_line" : 30,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "doc/tracing.md",
      "position" : 30,
      "pull_request_review_id" : 666166119,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22006",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-22T09:06:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637377827",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   }
]
