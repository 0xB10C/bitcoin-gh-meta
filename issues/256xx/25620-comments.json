[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25297](https://github.com/bitcoin/bitcoin/pull/25297) (WIP, wallet: speedup transactions sync, rescan and load not flushing to db constantly by furszy)\n* [#24914](https://github.com/bitcoin/bitcoin/pull/24914) (wallet: Load database records in a particular order by achow101)\n* [#24897](https://github.com/bitcoin/bitcoin/pull/24897) ([Draft / POC] Silent Payments by w0xlt)\n* [#22693](https://github.com/bitcoin/bitcoin/pull/22693) (RPC/Wallet: Add \"use_txids\" to output of getaddressinfo by luke-jr)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-07-16T01:43:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25620#issuecomment-1186052486",
      "id" : 1186052486,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25620",
      "node_id" : "IC_kwDOABII585GsbmG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1186052486/reactions"
      },
      "updated_at" : "2022-07-16T01:43:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1186052486",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The first four commits seem fine and could stand alone, but I'm not sure that introducing an entire class for managing the address book is really necessary. I don't really see how it is more beneficial to have such a class vs just cleaning up existing address book access and making `m_address_book` private. I don't really foresee a situation where we would want to have different implementations of the address book.",
      "created_at" : "2022-07-18T20:13:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25620#issuecomment-1188256001",
      "id" : 1188256001,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25620",
      "node_id" : "IC_kwDOABII585G01kB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1188256001/reactions"
      },
      "updated_at" : "2022-07-18T20:13:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1188256001",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> The first four commits seem fine and could stand alone, but I'm not sure that introducing an entire class for managing the address book is really necessary. I don't really see how it is more beneficial to have such a class vs just cleaning up existing address book access and making `m_address_book` private. I don't really foresee a situation where we would want to have different implementations of the address book.\r\n\r\nThat point is more a \"plus\" than part of the short term benefits.\r\n\r\nThe manager decoupling could worth it mainly for three reasons:\r\n\r\n1) It's another extra responsibility removed from the wallet class. Class that, even with the spend/receive files decoupling, is still a long file that keeps growing. Handling more responsibilities that what should ideally handle.\r\n\r\n    The `CWallet` class description says: âCWallet maintains a set of transactions and balances, and provides the ability to create new transactions.â. And.. that is not even 1/10 of what the wallet class does (there is a good phrase that says something like: \"Try to sum up what a class does in a single phrase. If this phrase includes âANDâ itâs probably doing too much.\").\r\n\r\n    Plus, Iâm unsure about how many devs know all the current address book functionalities, the code was a bit spread across the wallet without a proper description.\r\n\r\n2) The new manager cuts the address book dependency on the wallet mutex. So, every walk-through the address book entries (which we do in several RPC commands and on the GUI too), single entry searches, the `isAddressUsed` and the payment requests retrieval can run **wallet mutex free**. Which, as we use the wallet mutex for practically everything that happens inside the wallet, seems to be an even nicer property.\r\nAn easy example is the RPC command Â´listlabelsÂ´, which will run `cs_wallet` lock free.\r\n\r\n3) Then a separated class let us add test coverage isolated from the whole wallet class. So, bugs like an unknown address book entry purpose, an entry purpose change from \"receive\" to \"send\" (which would be pretty bad), a removal of a âreceiveâ entry, among other negative test scenarios, could be guarded inside the class and test covered without requiring to setup an entire wallet, the signals etc.\r\nNote: the purpose field instead of be a hardcoded string on the caller side, could be an enum that internally (only inside the manager class) maps to the string value. Which will be less error prone.\r\n\r\n---------\r\n\r\nPD: we could still implement all of this inside the wallet class as well (including methods descriptions and what people shouldn't do), but.. I'm not sure that is the best for a maintainability point of view. Shouldn't the wallet class ideally act more as a flow dispatcher, calling the appropriate classes/functions based on the contextual information?\r\nSo each inner class contains few properly documented responsibilities and we prevent problems that classes with a large span of responsibilities and activities have (plus, we make the wallet sources more friendly to review).",
      "created_at" : "2022-07-19T21:37:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25620#issuecomment-1189575145",
      "id" : 1189575145,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25620",
      "node_id" : "IC_kwDOABII585G53np",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1189575145/reactions"
      },
      "updated_at" : "2022-07-19T21:37:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1189575145",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   }
]
