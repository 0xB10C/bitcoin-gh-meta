[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25665](https://github.com/bitcoin/bitcoin/pull/25665) (BResult improvements, allow returning separate value on failure by ryanofsky)\n* [#25564](https://github.com/bitcoin/bitcoin/pull/25564) (Move DEFAULT_MAX_ORPHAN_TRANSACTIONS to node/txorphanage.h by MarcoFalke)\n* [#25527](https://github.com/bitcoin/bitcoin/pull/25527) ([kernel 3c/n] Decouple validation cache initialization from `ArgsManager` by dongcarl)\n* [#25077](https://github.com/bitcoin/bitcoin/pull/25077) (Fix chain tip data race and corrupt rest response by MarcoFalke)\n* [#25038](https://github.com/bitcoin/bitcoin/pull/25038) (policy: nVersion=3 and Package RBF by glozow)\n* [#22663](https://github.com/bitcoin/bitcoin/pull/22663) (dbwrapper: properly destroy objects in case CDBWrapper ctor throws by Crypt-iQ)\n* [#19888](https://github.com/bitcoin/bitcoin/pull/19888) (rpc, test: Improve getblockstats for unspendables by fjahr)\n* [#17786](https://github.com/bitcoin/bitcoin/pull/17786) (refactor: Nuke policy/fees->mempool circular dependencies by hebasto)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-07-21T18:21:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25667#issuecomment-1191798486",
      "id" : 1191798486,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25667",
      "node_id" : "IC_kwDOABII585HCWbW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1191798486/reactions"
      },
      "updated_at" : "2022-07-21T18:21:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1191798486",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25667#discussion_r927693341"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25667"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/927693341"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"test: add testcases for snapshot initialization\" (15da925f2951eaadf81aea9d5b67ec1646581d30)\r\n\r\nMight be a little more robust to destroy the old chainman before creating a new one. I.e. add another blank `chainman.reset()` call before this.",
      "commit_id" : "15da925f2951eaadf81aea9d5b67ec1646581d30",
      "created_at" : "2022-07-22T14:11:53Z",
      "diff_hunk" : "@@ -328,6 +354,31 @@ struct SnapshotTestSetup : TestChain100Setup {\n             loaded_snapshot_blockhash);\n         return std::make_tuple(&validation_chainstate, &snapshot_chainstate);\n     }\n+\n+    // Simulate a restart of the node by flushing all state to disk, clearing the\n+    // existing ChainstateManager, and unloading the block index.\n+    //\n+    // @returns a reference to the \"restarted\" ChainstateManager\n+    ChainstateManager& SimulateNodeRestart()\n+    {\n+        ChainstateManager& chainman = *Assert(m_node.chainman);\n+\n+        BOOST_TEST_MESSAGE(\"Simulating node restart\");\n+        {\n+            LOCK(::cs_main);\n+            for (CChainState* cs : chainman.GetAll()) {\n+                cs->ForceFlushStateToDisk();\n+            }\n+            chainman.ResetChainstates();\n+            BOOST_CHECK_EQUAL(chainman.GetAll().size(), 0);\n+            const ChainstateManager::Options chainman_opts{\n+                ::Params(),\n+                static_cast<int64_t(*)()>(::GetTime),\n+            };\n+            m_node.chainman.reset(new ChainstateManager(chainman_opts));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25667#discussion_r927693341",
      "id" : 927693341,
      "line" : 378,
      "node_id" : "PRRC_kwDOABII5843S3od",
      "original_commit_id" : "15da925f2951eaadf81aea9d5b67ec1646581d30",
      "original_line" : 378,
      "original_position" : 90,
      "original_start_line" : null,
      "path" : "src/test/validation_chainstatemanager_tests.cpp",
      "position" : 90,
      "pull_request_review_id" : 1047965884,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25667",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/927693341/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-22T14:15:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/927693341",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
