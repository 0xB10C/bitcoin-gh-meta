[
   {
      "author_association" : "MEMBER",
      "body" : "Shuffled some things around to get rid of the circular dependency. Also fixed a typo",
      "created_at" : "2019-09-18T21:36:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16910#issuecomment-532876861",
      "id" : 532876861,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16910",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMjg3Njg2MQ==",
      "updated_at" : "2019-09-18T21:36:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/532876861",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, especially improvements targeting big wallets (either lots of keys or lots of transactions).",
      "created_at" : "2019-09-18T21:47:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16910#issuecomment-532880343",
      "id" : 532880343,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16910",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMjg4MDM0Mw==",
      "updated_at" : "2019-09-18T21:47:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/532880343",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "To benchmark this, I applied this commit: https://github.com/achow101/bitcoin/commit/16ebe1362eb8b35c42b61f73bf844bb29b29fdf5. It adds logging of the load time and also stops bitcoind after the wallet has been loaded in order to get more consistent results.\r\n\r\nHere are a couple graphs that may be interesting to people.\r\n\r\nFlame graph (svg hosted on my website, couldn't inline in this comment) of master: https://achow101.com/bitcoin-master-flame.svg\r\n\r\nFlame graph of this PR: https://achow101.com/bitcoin-reduce-wallet-load-flame.svg\r\n\r\nMassif (heap profiler) memory usage over time on master: \r\n![image](https://user-images.githubusercontent.com/3782274/65189418-e2d5ca00-da3e-11e9-8e6f-ae6e65c1fff6.png)\r\n\r\nMassif memory usage over time on this PR: \r\n![image](https://user-images.githubusercontent.com/3782274/65189439-f4b76d00-da3e-11e9-8574-d42bf33a2404.png)",
      "created_at" : "2019-09-18T22:09:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16910#issuecomment-532886444",
      "id" : 532886444,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16910",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMjg4NjQ0NA==",
      "updated_at" : "2019-09-18T22:09:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/532886444",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16910#discussion_r325934557"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325934557"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Looks like a bug here. Previously it would return true if any output was spent, now it will only return true if the first output was spent. Could fix pretty easily by passing const CTransaction& instead of txid, and looping over the outputs.",
      "commit_id" : "4ed9dd6ffb95d31404883bdd3b230c27929acfd9",
      "created_at" : "2019-09-18T23:27:34Z",
      "diff_hunk" : "@@ -749,7 +749,7 @@ std::set<uint256> CWallet::GetConflicts(const uint256& txid) const\n bool CWallet::HasWalletSpend(const uint256& txid) const\n {\n     AssertLockHeld(cs_wallet);\n-    auto iter = mapTxSpends.lower_bound(COutPoint(txid, 0));\n+    auto iter = mapTxSpends.find(COutPoint(txid, 0));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16910#discussion_r325934557",
      "id" : 325934557,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNTkzNDU1Nw==",
      "original_commit_id" : "4ed9dd6ffb95d31404883bdd3b230c27929acfd9",
      "original_position" : 23,
      "path" : "src/wallet/wallet.cpp",
      "position" : 23,
      "pull_request_review_id" : 290254536,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16910",
      "updated_at" : "2019-09-18T23:27:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325934557",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16910#discussion_r325947568"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325947568"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "4ed9dd6ffb95d31404883bdd3b230c27929acfd9",
      "created_at" : "2019-09-19T00:31:48Z",
      "diff_hunk" : "@@ -749,7 +749,7 @@ std::set<uint256> CWallet::GetConflicts(const uint256& txid) const\n bool CWallet::HasWalletSpend(const uint256& txid) const\n {\n     AssertLockHeld(cs_wallet);\n-    auto iter = mapTxSpends.lower_bound(COutPoint(txid, 0));\n+    auto iter = mapTxSpends.find(COutPoint(txid, 0));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16910#discussion_r325947568",
      "id" : 325947568,
      "in_reply_to_id" : 325934557,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNTk0NzU2OA==",
      "original_commit_id" : "4ed9dd6ffb95d31404883bdd3b230c27929acfd9",
      "original_position" : 23,
      "path" : "src/wallet/wallet.cpp",
      "position" : 23,
      "pull_request_review_id" : 290270474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16910",
      "updated_at" : "2019-09-19T00:31:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325947568",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
