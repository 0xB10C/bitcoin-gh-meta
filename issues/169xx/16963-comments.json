[
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky maybe you have a better approach?",
      "created_at" : "2019-09-25T10:17:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16963#issuecomment-534955357",
      "id" : 534955357,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16963",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDk1NTM1Nw==",
      "updated_at" : "2019-09-25T10:17:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534955357",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Good catch! But why exactly is the fix in #16955 incorrect? It seems like a reasonable workaround to me as long as the wallet still shows up in the GUI (which I would expect if `m_node.getWallets()` is called later). But if the wallet doesn't show up in the GUI then the bigger fix is needed.\r\n\r\nThis clone fix should work now, and is more elegant than the nullptr workaround, but wouldn't work great with #10102 unless I changed it to use shared_ptrs internally or complicate lifetime management some other way to support cloning.\r\n\r\nMore ideally, I would delete `uiInterface.LoadWallet` and `Chain::loadWallet` entirely and just not use boost signals for this callback. Instead I'd define a load wallet callback list (`std::list<LoadWalletFn> load_wallet_fns`) alongside the existing list of wallets (`std::vector<std::shared_ptr<CWallet>> vpwallets`), and push onto the list when `handleLoadWallet` is called, erase from the list when `Handler::disconnect` is called, and the replace existing line:\r\n\r\n```c++\r\nchain.loadWallet(interfaces::MakeWallet(walletInstance));\r\n```\r\n\r\nwith\r\n\r\n```c++\r\nfor (auto& load_wallet : load_wallet_fns) {\r\n    load_wallet(interfaces::MakeWallet(walletInstance));\r\n}\r\n```\r\n\r\nBut I'm ok with the nullptr fix or the clone fix or however you want to proceed here.",
      "created_at" : "2019-09-25T11:28:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16963#issuecomment-534978002",
      "id" : 534978002,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16963",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDk3ODAwMg==",
      "updated_at" : "2019-09-25T11:30:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534978002",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "IMO it's incorrect because it doesn't remove the invalid `std::move`.",
      "created_at" : "2019-09-25T11:48:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16963#issuecomment-534984001",
      "id" : 534984001,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16963",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDk4NDAwMQ==",
      "updated_at" : "2019-09-25T11:48:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534984001",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> which I would expect if m_node.getWallets() is called later\r\n\r\nThere's nothing guaranteeing it (I think?)",
      "created_at" : "2019-09-25T11:50:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16963#issuecomment-534984556",
      "id" : 534984556,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16963",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDk4NDU1Ng==",
      "updated_at" : "2019-09-25T11:50:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534984556",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "For reference, the bug was introduced in 1106a6fde4bfde31a16de45e4cc84ed5da05c5a4 #15288 - backport not required.",
      "created_at" : "2019-09-25T19:39:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16963#issuecomment-535179262",
      "id" : 535179262,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16963",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNTE3OTI2Mg==",
      "updated_at" : "2019-09-25T19:39:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/535179262",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Related discussion https://github.com/bitcoin/bitcoin/pull/15288#discussion_r261062566.",
      "created_at" : "2019-09-25T19:41:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16963#issuecomment-535180083",
      "id" : 535180083,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16963",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNTE4MDA4Mw==",
      "updated_at" : "2019-09-25T19:41:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/535180083",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I started playing around with this change (7162be2eb2698eeea1eaaca2159d830acca63a1e). Using the same approach as in #16937 I was able to (only once so far) end up with the same wallet loaded twice:\r\n\r\n<img width=\"328\" alt=\"duplicate_big\" src=\"https://user-images.githubusercontent.com/863730/65687090-e8648d00-e09a-11e9-8583-a694eae9626d.png\">\r\n\r\nMultiple times I've seen `bitcoin-qt` crash during load with:\r\n```bash\r\n(lldb) run\r\nProcess 20318 launched: '/Users/michael/github/bitcoin/src/qt/bitcoin-qt' (x86_64)\r\n2019-09-26 20:14:33.701294+0800 bitcoin-qt[20318:1442147] MessageTracer: Falling back to default whitelist\r\nProcess 20318 stopped\r\n* thread #1, name = 'bitcoin-main', queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x10)\r\n    frame #0: 0x000000010009182e bitcoin-qt`GUIUtil::TableViewLastColumnResizingFixer::disconnectViewHeadersSignals(this=0x0000000000000000) at guiutil.cpp:445:16\r\n   442 \t// We need to disconnect these while handling the resize events, otherwise we can enter infinite loops.\r\n   443 \tvoid TableViewLastColumnResizingFixer::disconnectViewHeadersSignals()\r\n   444 \t{\r\n-> 445 \t    disconnect(tableView->horizontalHeader(), &QHeaderView::sectionResized, this, &TableViewLastColumnResizingFixer::on_sectionResized);\r\n   446 \t    disconnect(tableView->horizontalHeader(), &QHeaderView::geometriesChanged, this, &TableViewLastColumnResizingFixer::on_geometriesChanged);\r\n   447 \t}\r\n   448 \t\r\nTarget 0: (bitcoin-qt) stopped.\r\n```\r\n\r\nRan out of time tonight, so will keep looking tomorrow.",
      "created_at" : "2019-09-26T12:21:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16963#issuecomment-535477305",
      "id" : 535477305,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16963",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNTQ3NzMwNQ==",
      "updated_at" : "2019-09-26T12:21:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/535477305",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16963#discussion_r328583218"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/328583218"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: s/implemantion/implementation ?",
      "commit_id" : "7162be2eb2698eeea1eaaca2159d830acca63a1e",
      "created_at" : "2019-09-26T12:26:27Z",
      "diff_hunk" : "@@ -49,6 +49,9 @@ class Wallet\n public:\n     virtual ~Wallet() {}\n \n+    //! Creates a copy of this interface implemantion.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16963#discussion_r328583218",
      "id" : 328583218,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyODU4MzIxOA==",
      "original_commit_id" : "7162be2eb2698eeea1eaaca2159d830acca63a1e",
      "original_position" : 4,
      "path" : "src/interfaces/wallet.h",
      "position" : 4,
      "pull_request_review_id" : 293681527,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16963",
      "updated_at" : "2019-09-26T12:26:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/328583218",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @fanquake!\r\n\r\n> I was able to (only once so far) end up with the same wallet loaded twice\r\n\r\nVery strange, I wonder if the \"big\" wallet has 2 `WalletModel` or not. I would suspect it is a bug on the `WalletView` creation, not on `WalletController::getOrCreateWallet` since it's guarded by a mutex.\r\n\r\nEdit: problem: 2 calls to `BitcoinGUI::addWallet` with the same wallet model are made because of:\r\nhttps://github.com/bitcoin/bitcoin/blob/6288f15f50ab98b336ab86804c4cbea3807dc1d3/src/qt/bitcoingui.cpp#L623-L627\r\nand if the dynamic loading happens after L623 and before L627.",
      "created_at" : "2019-09-26T13:06:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16963#issuecomment-535493582",
      "id" : 535493582,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16963",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNTQ5MzU4Mg==",
      "updated_at" : "2019-09-26T18:12:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/535493582",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Multiple times I've seen bitcoin-qt crash during load with:\r\n\r\n@fanquake that happens due to `loadwallet`? Or have you added other calls to the test script?",
      "created_at" : "2019-09-26T20:53:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16963#issuecomment-535681808",
      "id" : 535681808,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16963",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNTY4MTgwOA==",
      "updated_at" : "2019-09-26T20:53:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/535681808",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
