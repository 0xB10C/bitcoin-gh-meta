[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Somewhat follows the suggestions of [@luke-jr](https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-471239506) and [@jgarzik](https://github.com/bitcoin/bitcoin/pull/15558#issuecomment-471208937) in #15558",
      "created_at" : "2019-09-23T10:53:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#issuecomment-534049877",
      "id" : 534049877,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16939",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDA0OTg3Nw==",
      "updated_at" : "2019-09-23T10:53:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534049877",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Behaviour looks like:\r\n\r\n```\r\n2019-09-23T10:54:49Z dnsseed thread start\r\n2019-09-23T10:54:49Z Waiting 300 seconds before falling back to DNS seeds.\r\n2019-09-23T10:54:50Z trying connection XXX lastseen=662.4hrs\r\n2019-09-23T10:54:55Z connection to XXX timeout\r\n2019-09-23T10:54:55Z trying connection XXX lastseen=197.4hrs\r\n2019-09-23T10:54:56Z Added connection peer=0\r\n2019-09-23T10:54:56Z New outbound peer connected: ...\r\n2019-09-23T10:54:56Z trying connection XXX lastseen=469.4hrs\r\n```\r\n\r\nDNS thread would previously have decided to contact seeds here.\r\n```\r\n2019-09-23T10:55:01Z connection to XXX timeout\r\n2019-09-23T10:55:02Z trying connection XXX lastseen=685.1hrs\r\n2019-09-23T10:55:07Z connection to XXX timeout\r\n2019-09-23T10:55:07Z trying connection XXX lastseen=232.5hrs\r\n2019-09-23T10:55:12Z connection to XXX timeout\r\n2019-09-23T10:55:13Z trying connection XXX lastseen=388.0hrs\r\n```\r\n\r\nDNS thread checks for early exit here, but doesn't need one so keeps waiting.\r\n\r\n```\r\n2019-09-23T10:55:18Z connection to XXX timeout\r\n2019-09-23T10:55:18Z trying connection XXX lastseen=15.6hrs\r\n2019-09-23T10:55:19Z Added connection peer=1\r\n2019-09-23T10:55:19Z New outbound peer connected: ...\r\n2019-09-23T10:55:19Z trying connection XXX lastseen=36.8hrs\r\n2019-09-23T10:55:24Z connection to XXX timeout\r\n2019-09-23T10:55:25Z trying connection XXX lastseen=214.8hrs\r\n2019-09-23T10:55:30Z connection to XXX timeout\r\n2019-09-23T10:55:30Z trying connection XXX lastseen=524.4hrs\r\n2019-09-23T10:55:35Z connection to XXX timeout\r\n2019-09-23T10:55:36Z trying connection XXX lastseen=1705.3hrs\r\n```\r\n\r\nDNS thread checks again for early exit, and since there's two connections now, does:\r\n\r\n```\r\n2019-09-23T10:55:39Z P2P peers available. Skipped DNS seeding.\r\n2019-09-23T10:55:39Z dnsseed thread exit\r\n```",
      "created_at" : "2019-09-23T11:02:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#issuecomment-534052183",
      "id" : 534052183,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16939",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDA1MjE4Mw==",
      "updated_at" : "2019-09-23T11:02:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534052183",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK: seed querying should be kept to a minimum for obvious reasons",
      "created_at" : "2019-09-23T14:02:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#issuecomment-534113186",
      "id" : 534113186,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16939",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDExMzE4Ng==",
      "updated_at" : "2019-09-23T14:02:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534113186",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK.\r\n\r\nThis doesn't make us depend on a single seed, does it?\r\nAlso, perhaps move some of the magic numbers to constants?",
      "created_at" : "2019-09-23T15:53:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#issuecomment-534163054",
      "id" : 534163054,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16939",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDE2MzA1NA==",
      "updated_at" : "2019-09-23T15:53:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534163054",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed the logic to make it query in batches of 3 more sensibly, and bumped the delay for adding fixed seeds to 6 minutes from startup (fixed nodes are only added if addrman is empty, which will only happen if DNS seeds aren't replying -- but this may be due to the first one we try hanging, rather than all of them failing, so 6m is a compromise).\r\n\r\nBehaviour for empty peers.dat, but no ability to actually connect anywhere is to immediately query 3 random dns seeds, then wait 11 seconds and try the next 3, etc:\r\n\r\n```\r\n2019-09-23T18:02:46Z Loaded 0 addresses from peers.dat  0ms\r\n2019-09-23T18:02:46Z dnsseed thread start\r\n2019-09-23T18:02:46Z Loading addresses from DNS seed dnsseed.bluematt.me\r\n2019-09-23T18:02:47Z Loading addresses from DNS seed dnsseed.bitcoin.dashjr.org\r\n2019-09-23T18:02:52Z Loading addresses from DNS seed seed.bitcoin.jonasschnelli.ch\r\n2019-09-23T18:02:52Z Waiting 11 seconds before querying DNS seeds.\r\n2019-09-23T18:03:03Z Loading addresses from DNS seed dnsseed.emzy.de\r\n2019-09-23T18:03:03Z Loading addresses from DNS seed seed.bitcoin.sipa.be\r\n2019-09-23T18:03:03Z Loading addresses from DNS seed seed.bitcoin.sprovoost.nl\r\n2019-09-23T18:03:03Z Waiting 11 seconds before querying DNS seeds.\r\n2019-09-23T18:03:14Z Loading addresses from DNS seed seed.btc.petertodd.org\r\n2019-09-23T18:03:14Z 33 addresses found from DNS seeds\r\n2019-09-23T18:03:14Z dnsseed thread exit\r\n```\r\n\r\nSame deal if there's some but less than 1k entries in addrman, except it'll wait 11s first:\r\n\r\n```\r\n2019-09-23T18:23:15Z Loaded 33 addresses from peers.dat  0ms\r\n2019-09-23T18:23:15Z dnsseed thread start\r\n2019-09-23T18:23:15Z Waiting 11 seconds before querying DNS seeds.\r\n2019-09-23T18:23:26Z Loading addresses from DNS seed dnsseed.bitcoin.dashjr.org\r\n2019-09-23T18:23:26Z Loading addresses from DNS seed dnsseed.emzy.de\r\n2019-09-23T18:23:26Z Loading addresses from DNS seed dnsseed.bluematt.me\r\n2019-09-23T18:23:27Z Waiting 11 seconds before querying DNS seeds.\r\n2019-09-23T18:23:38Z Loading addresses from DNS seed seed.btc.petertodd.org\r\n2019-09-23T18:23:38Z Loading addresses from DNS seed seed.bitcoin.sipa.be\r\n2019-09-23T18:23:38Z Loading addresses from DNS seed seed.bitcoin.jonasschnelli.ch\r\n2019-09-23T18:23:38Z Waiting 11 seconds before querying DNS seeds.\r\n2019-09-23T18:23:49Z Loading addresses from DNS seed seed.bitcoin.sprovoost.nl\r\n2019-09-23T18:23:49Z 0 addresses found from DNS seeds\r\n2019-09-23T18:23:49Z dnsseed thread exit\r\n```\r\n\r\n(seed.bitcoinstats.com seems to hang for me, so I've dropped it from my chainparams, but that change isn't in this patch)",
      "created_at" : "2019-09-23T18:32:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#issuecomment-534226798",
      "id" : 534226798,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16939",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDIyNjc5OA==",
      "updated_at" : "2019-09-23T18:32:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534226798",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#15502](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15502.html) (p2p: Speed up initial connection to p2p network by ajtowns)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-09-23T20:03:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#issuecomment-534261214",
      "id" : 534261214,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16939",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzNDI2MTIxNA==",
      "updated_at" : "2019-09-23T20:03:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534261214",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r364966153"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/364966153"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: // 5 minutes, also move them to net.h ?",
      "commit_id" : "fe0c51f3bfd22d10d1c84a7fafc06b40b1a725bd",
      "created_at" : "2020-01-09T21:23:21Z",
      "diff_hunk" : "@@ -53,6 +53,15 @@ static constexpr int DUMP_PEERS_INTERVAL = 15 * 60;\n /** Number of DNS seeds to query when the number of connections is low. */\n static constexpr int DNSSEEDS_TO_QUERY_AT_ONCE = 3;\n \n+/** How long to delay before querying DNS seeds\n+ */\n+static constexpr std::chrono::seconds DNSSEEDS_DELAY_FEW_PEERS{11};\n+static constexpr std::chrono::seconds DNSSEEDS_DELAY_MANY_PEERS{300};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r364966153",
      "id" : 364966153,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk2NjE1Mw==",
      "original_commit_id" : "899d9f4097a3c23eb2dcb3fe186e9e90a5eb9d83",
      "original_position" : 7,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 340823054,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939",
      "updated_at" : "2020-02-11T16:32:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/364966153",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r364966899"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/364966899"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You can lay out trade-off further: \"Every new DNS seed queried increases the bar for eclipsing node but leaks more privacy.\"",
      "commit_id" : "fe0c51f3bfd22d10d1c84a7fafc06b40b1a725bd",
      "created_at" : "2020-01-09T21:25:28Z",
      "diff_hunk" : "@@ -1543,30 +1552,55 @@ void CConnman::ThreadDNSAddressSeed()\n     Shuffle(seeds.begin(), seeds.end(), rng);\n     int seeds_right_now = 0; // Number of seeds left before testing if we have enough connections\n     int found = 0;\n+    const std::chrono::seconds seeds_wait_time = (addrman.size() >= 1000 ? DNSSEEDS_DELAY_MANY_PEERS : DNSSEEDS_DELAY_FEW_PEERS);\n \n     if (gArgs.GetBoolArg(\"-forcednsseed\", DEFAULT_FORCEDNSSEED)) {\n         // When -forcednsseed is provided, query all.\n         seeds_right_now = seeds.size();\n     }\n \n+    // goal: only query DNS seed if address need is acute\n+    // * If we have a reasonable number of peers in addrman, spend\n+    //   some time trying them first. This improves user privacy by\n+    //   creating fewer identifying DNS requests, reduces trust by\n+    //   giving seeds less influence on the network topology, and\n+    //   reduces traffic to the seeds.\n+    // * When querying DNS seeds query a few at once, this ensures\n+    //   that we don't give DNS seeds the ability to eclipse nodes\n+    //   that query them.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r364966899",
      "id" : 364966899,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk2Njg5OQ==",
      "original_commit_id" : "899d9f4097a3c23eb2dcb3fe186e9e90a5eb9d83",
      "original_position" : 35,
      "path" : "src/net.cpp",
      "position" : 30,
      "pull_request_review_id" : 340823054,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939",
      "updated_at" : "2020-02-11T16:32:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/364966899",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r364970093"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/364970093"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What the logic for picking 1000 ? If we assume uniform address propagation, what's the ratio of reliable public nodes on others in addrman and what the probability of not connecting successfully to at least 3 outbound peers ? Based on that, I would say intuitively we may scale down number a bit to increase number of nodes who delay DNS query.",
      "commit_id" : "fe0c51f3bfd22d10d1c84a7fafc06b40b1a725bd",
      "created_at" : "2020-01-09T21:33:19Z",
      "diff_hunk" : "@@ -1543,30 +1552,55 @@ void CConnman::ThreadDNSAddressSeed()\n     Shuffle(seeds.begin(), seeds.end(), rng);\n     int seeds_right_now = 0; // Number of seeds left before testing if we have enough connections\n     int found = 0;\n+    const std::chrono::seconds seeds_wait_time = (addrman.size() >= 1000 ? DNSSEEDS_DELAY_MANY_PEERS : DNSSEEDS_DELAY_FEW_PEERS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r364970093",
      "id" : 364970093,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk3MDA5Mw==",
      "original_commit_id" : "899d9f4097a3c23eb2dcb3fe186e9e90a5eb9d83",
      "original_position" : 20,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 340823054,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939",
      "updated_at" : "2020-02-11T16:32:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/364970093",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r364971195"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/364971195"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "For fresh nodes, addrman can't be bigger than 1000 after querying 3 dns (because nMaxIPs == 256), but if we change DNSSEEDS_TO_QUERY_AT_ONCE, we may assign  seeds_wait_time before every time evaluation instead",
      "commit_id" : "fe0c51f3bfd22d10d1c84a7fafc06b40b1a725bd",
      "created_at" : "2020-01-09T21:36:10Z",
      "diff_hunk" : "@@ -1543,30 +1552,55 @@ void CConnman::ThreadDNSAddressSeed()\n     Shuffle(seeds.begin(), seeds.end(), rng);\n     int seeds_right_now = 0; // Number of seeds left before testing if we have enough connections\n     int found = 0;\n+    const std::chrono::seconds seeds_wait_time = (addrman.size() >= 1000 ? DNSSEEDS_DELAY_MANY_PEERS : DNSSEEDS_DELAY_FEW_PEERS);\n \n     if (gArgs.GetBoolArg(\"-forcednsseed\", DEFAULT_FORCEDNSSEED)) {\n         // When -forcednsseed is provided, query all.\n         seeds_right_now = seeds.size();\n     }\n \n+    // goal: only query DNS seed if address need is acute\n+    // * If we have a reasonable number of peers in addrman, spend\n+    //   some time trying them first. This improves user privacy by\n+    //   creating fewer identifying DNS requests, reduces trust by\n+    //   giving seeds less influence on the network topology, and\n+    //   reduces traffic to the seeds.\n+    // * When querying DNS seeds query a few at once, this ensures\n+    //   that we don't give DNS seeds the ability to eclipse nodes\n+    //   that query them.\n+    // * If we continue having problems, eventually query all the\n+    //   DNS seeds, and if that fails too, also try the fixed seeds.\n+    //   (done in ThreadOpenConnections)\n     for (const std::string& seed : seeds) {\n-        // goal: only query DNS seed if address need is acute\n-        // Avoiding DNS seeds when we don't need them improves user privacy by\n-        // creating fewer identifying DNS requests, reduces trust by giving seeds\n-        // less influence on the network topology, and reduces traffic to the seeds.\n         if (addrman.size() > 0 && seeds_right_now == 0) {\n-            if (!interruptNet.sleep_for(std::chrono::seconds(11))) return;\n-\n-            LOCK(cs_vNodes);\n-            int nRelevant = 0;\n-            for (const CNode* pnode : vNodes) {\n-                nRelevant += pnode->fSuccessfullyConnected && !pnode->fFeeler && !pnode->fOneShot && !pnode->m_manual_connection && !pnode->fInbound;\n-            }\n-            if (nRelevant >= 2) {\n-                LogPrintf(\"P2P peers available. Skipped DNS seeding.\\n\");\n-                return;\n+            LogPrintf(\"Waiting %d seconds before querying DNS seeds.\\n\", seeds_wait_time.count());\n+            std::chrono::seconds to_wait = seeds_wait_time;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r364971195",
      "id" : 364971195,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk3MTE5NQ==",
      "original_commit_id" : "899d9f4097a3c23eb2dcb3fe186e9e90a5eb9d83",
      "original_position" : 56,
      "path" : "src/net.cpp",
      "position" : 53,
      "pull_request_review_id" : 340823054,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939",
      "updated_at" : "2020-02-11T16:32:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/364971195",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r364972769"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/364972769"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not sure about this, I would say that's a behavior change. Previously node with  an empty addrman would have query all DNS seeds due to seeds_right_now == -1 as you noticed in #15558. Now you may exit early, if among DNSSEEDS_TO_QUERY_AT_ONCE you find at least 2 outbound peers but with final result of having less address origin diversity in your addrman..",
      "commit_id" : "fe0c51f3bfd22d10d1c84a7fafc06b40b1a725bd",
      "created_at" : "2020-01-09T21:39:55Z",
      "diff_hunk" : "@@ -1543,30 +1552,55 @@ void CConnman::ThreadDNSAddressSeed()\n     Shuffle(seeds.begin(), seeds.end(), rng);\n     int seeds_right_now = 0; // Number of seeds left before testing if we have enough connections\n     int found = 0;\n+    const std::chrono::seconds seeds_wait_time = (addrman.size() >= 1000 ? DNSSEEDS_DELAY_MANY_PEERS : DNSSEEDS_DELAY_FEW_PEERS);\n \n     if (gArgs.GetBoolArg(\"-forcednsseed\", DEFAULT_FORCEDNSSEED)) {\n         // When -forcednsseed is provided, query all.\n         seeds_right_now = seeds.size();\n     }\n \n+    // goal: only query DNS seed if address need is acute\n+    // * If we have a reasonable number of peers in addrman, spend\n+    //   some time trying them first. This improves user privacy by\n+    //   creating fewer identifying DNS requests, reduces trust by\n+    //   giving seeds less influence on the network topology, and\n+    //   reduces traffic to the seeds.\n+    // * When querying DNS seeds query a few at once, this ensures\n+    //   that we don't give DNS seeds the ability to eclipse nodes\n+    //   that query them.\n+    // * If we continue having problems, eventually query all the\n+    //   DNS seeds, and if that fails too, also try the fixed seeds.\n+    //   (done in ThreadOpenConnections)\n     for (const std::string& seed : seeds) {\n-        // goal: only query DNS seed if address need is acute\n-        // Avoiding DNS seeds when we don't need them improves user privacy by\n-        // creating fewer identifying DNS requests, reduces trust by giving seeds\n-        // less influence on the network topology, and reduces traffic to the seeds.\n         if (addrman.size() > 0 && seeds_right_now == 0) {\n-            if (!interruptNet.sleep_for(std::chrono::seconds(11))) return;\n-\n-            LOCK(cs_vNodes);\n-            int nRelevant = 0;\n-            for (const CNode* pnode : vNodes) {\n-                nRelevant += pnode->fSuccessfullyConnected && !pnode->fFeeler && !pnode->fOneShot && !pnode->m_manual_connection && !pnode->fInbound;\n-            }\n-            if (nRelevant >= 2) {\n-                LogPrintf(\"P2P peers available. Skipped DNS seeding.\\n\");\n-                return;\n+            LogPrintf(\"Waiting %d seconds before querying DNS seeds.\\n\", seeds_wait_time.count());\n+            std::chrono::seconds to_wait = seeds_wait_time;\n+            while (to_wait.count() > 0) {\n+                std::chrono::seconds w{25};\n+                if (w > to_wait) w = to_wait;\n+                if (!interruptNet.sleep_for(w)) return;\n+                to_wait -= w;\n+\n+                int nRelevant = 0;\n+                {\n+                    LOCK(cs_vNodes);\n+                    for (const CNode* pnode : vNodes) {\n+                        nRelevant += pnode->fSuccessfullyConnected && !pnode->fFeeler && !pnode->fOneShot && !pnode->m_manual_connection && !pnode->fInbound;\n+                    }\n+                }\n+                if (nRelevant >= 2) {\n+                    if (found > 0) {\n+                        LogPrintf(\"%d addresses found from DNS seeds\\n\", found);\n+                        LogPrintf(\"P2P peers available. Finished DNS seeding.\\n\");\n+                    } else {\n+                        LogPrintf(\"P2P peers available. Skipped DNS seeding.\\n\");\n+                    }\n+                    return;\n+                }\n             }\n             seeds_right_now += DNSSEEDS_TO_QUERY_AT_ONCE;\n+        } else if (seeds_right_now == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r364972769",
      "id" : 364972769,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk3Mjc2OQ==",
      "original_commit_id" : "899d9f4097a3c23eb2dcb3fe186e9e90a5eb9d83",
      "original_position" : 81,
      "path" : "src/net.cpp",
      "position" : 78,
      "pull_request_review_id" : 340823054,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939",
      "updated_at" : "2020-02-11T16:32:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/364972769",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r364973333"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/364973333"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is a behavior change too, I do understand the logic to increase privacy for fresh nodes if DNS  are busy but how did you pick up this number ?",
      "commit_id" : "fe0c51f3bfd22d10d1c84a7fafc06b40b1a725bd",
      "created_at" : "2020-01-09T21:41:20Z",
      "diff_hunk" : "@@ -1715,7 +1749,7 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             return;\n \n         // Add seed nodes if DNS seeds are all down (an infrastructure attack?).\n-        if (addrman.size() == 0 && (GetTime() - nStart > 60)) {\n+        if (addrman.size() == 0 && (GetTime() - nStart > FIXEDSEEDS_DELAY)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r364973333",
      "id" : 364973333,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk3MzMzMw==",
      "original_commit_id" : "899d9f4097a3c23eb2dcb3fe186e9e90a5eb9d83",
      "original_position" : 91,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 340823054,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939",
      "updated_at" : "2020-02-11T16:32:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/364973333",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This shouldn't run if the node is not currently making automatic connections (network disable or -noconnect).",
      "created_at" : "2020-01-09T22:14:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#issuecomment-572781406",
      "id" : 572781406,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16939",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3Mjc4MTQwNg==",
      "updated_at" : "2020-01-09T22:14:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/572781406",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r377420664"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377420664"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "They're not needed from other modules, so doesn't make sense to have them in net.h",
      "commit_id" : "fe0c51f3bfd22d10d1c84a7fafc06b40b1a725bd",
      "created_at" : "2020-02-11T02:16:40Z",
      "diff_hunk" : "@@ -53,6 +53,15 @@ static constexpr int DUMP_PEERS_INTERVAL = 15 * 60;\n /** Number of DNS seeds to query when the number of connections is low. */\n static constexpr int DNSSEEDS_TO_QUERY_AT_ONCE = 3;\n \n+/** How long to delay before querying DNS seeds\n+ */\n+static constexpr std::chrono::seconds DNSSEEDS_DELAY_FEW_PEERS{11};\n+static constexpr std::chrono::seconds DNSSEEDS_DELAY_MANY_PEERS{300};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r377420664",
      "id" : 377420664,
      "in_reply_to_id" : 364966153,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQyMDY2NA==",
      "original_commit_id" : "899d9f4097a3c23eb2dcb3fe186e9e90a5eb9d83",
      "original_position" : 7,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 356388476,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939",
      "updated_at" : "2020-02-11T16:32:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377420664",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r377426911"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377426911"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "1000 is the maximum number of entries the `addr` message can include, so seems a good threshold to indicate you've managed to pick up some live data from the p2p network about potential peers, rather than just some results from DNS lookups.",
      "commit_id" : "fe0c51f3bfd22d10d1c84a7fafc06b40b1a725bd",
      "created_at" : "2020-02-11T02:52:17Z",
      "diff_hunk" : "@@ -1543,30 +1552,55 @@ void CConnman::ThreadDNSAddressSeed()\n     Shuffle(seeds.begin(), seeds.end(), rng);\n     int seeds_right_now = 0; // Number of seeds left before testing if we have enough connections\n     int found = 0;\n+    const std::chrono::seconds seeds_wait_time = (addrman.size() >= 1000 ? DNSSEEDS_DELAY_MANY_PEERS : DNSSEEDS_DELAY_FEW_PEERS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r377426911",
      "id" : 377426911,
      "in_reply_to_id" : 364970093,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQyNjkxMQ==",
      "original_commit_id" : "899d9f4097a3c23eb2dcb3fe186e9e90a5eb9d83",
      "original_position" : 20,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 356395572,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939",
      "updated_at" : "2020-02-11T16:32:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377426911",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@gmaxwell\r\n\r\n> This shouldn't run if the node is not currently making automatic connections (network disable or -noconnect).\r\n\r\nFor `-noconnect` we already have \"parameter interaction: -connect set -> setting -dnsseed=0\" which prevents the dns thread from ever starting. Not sure what network disable means, should we not do dns seeding if `-onlynet=onion` or something?",
      "created_at" : "2020-02-11T03:06:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#issuecomment-584460820",
      "id" : 584460820,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16939",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NDQ2MDgyMA==",
      "updated_at" : "2020-02-11T03:06:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/584460820",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r377439532"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377439532"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This change isn't needed -- if addrman is going to end up empty, it will have been empty for each dns seed which means there would have been no delay in querying the seed.",
      "commit_id" : "fe0c51f3bfd22d10d1c84a7fafc06b40b1a725bd",
      "created_at" : "2020-02-11T04:10:03Z",
      "diff_hunk" : "@@ -1715,7 +1749,7 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             return;\n \n         // Add seed nodes if DNS seeds are all down (an infrastructure attack?).\n-        if (addrman.size() == 0 && (GetTime() - nStart > 60)) {\n+        if (addrman.size() == 0 && (GetTime() - nStart > FIXEDSEEDS_DELAY)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r377439532",
      "id" : 377439532,
      "in_reply_to_id" : 364973333,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQzOTUzMg==",
      "original_commit_id" : "899d9f4097a3c23eb2dcb3fe186e9e90a5eb9d83",
      "original_position" : 91,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 356409807,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939",
      "updated_at" : "2020-02-11T16:32:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377439532",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased, reverted delay for fixed seeds, and changed to explicitly query all dns seeds if we start up with an empty addrman.",
      "created_at" : "2020-02-11T04:39:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#issuecomment-584475372",
      "id" : 584475372,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16939",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NDQ3NTM3Mg==",
      "updated_at" : "2020-02-11T04:39:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/584475372",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Not sure what network disable means\r\n\r\nThere is a `setnetworkactive` RPC, which can disable the connman",
      "created_at" : "2020-02-11T13:09:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#issuecomment-584626477",
      "id" : 584626477,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16939",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NDYyNjQ3Nw==",
      "updated_at" : "2020-02-11T13:09:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/584626477",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Added patch to avoid querying DNS seeds while `setnetworkactive` is set to false.",
      "created_at" : "2020-02-11T16:35:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#issuecomment-584725738",
      "id" : 584725738,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16939",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NDcyNTczOA==",
      "updated_at" : "2020-02-11T16:35:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/584725738",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r377758118"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377758118"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "With the current code:\r\n\r\n * if addrman starts off at 0, it'll query all DNS seeds with no delay\r\n * if addrman starts off under 1000, it'll query all DNS seeds in groups of 3 after waiting 11 seconds before each group\r\n * if addrman starts off over 1000, it'll query all DNS seeds in groups of 3 after waiting 5 minutes before each group\r\n\r\nThat seems mostly fine to me?\r\n\r\n(The timeout for connecting to a peer is nConnectTimeout which is 5 seconds; so 11 seconds will pass if you happen to try three peers that timeout before getting two that succeed)",
      "commit_id" : "fe0c51f3bfd22d10d1c84a7fafc06b40b1a725bd",
      "created_at" : "2020-02-11T16:43:45Z",
      "diff_hunk" : "@@ -1543,30 +1552,55 @@ void CConnman::ThreadDNSAddressSeed()\n     Shuffle(seeds.begin(), seeds.end(), rng);\n     int seeds_right_now = 0; // Number of seeds left before testing if we have enough connections\n     int found = 0;\n+    const std::chrono::seconds seeds_wait_time = (addrman.size() >= 1000 ? DNSSEEDS_DELAY_MANY_PEERS : DNSSEEDS_DELAY_FEW_PEERS);\n \n     if (gArgs.GetBoolArg(\"-forcednsseed\", DEFAULT_FORCEDNSSEED)) {\n         // When -forcednsseed is provided, query all.\n         seeds_right_now = seeds.size();\n     }\n \n+    // goal: only query DNS seed if address need is acute\n+    // * If we have a reasonable number of peers in addrman, spend\n+    //   some time trying them first. This improves user privacy by\n+    //   creating fewer identifying DNS requests, reduces trust by\n+    //   giving seeds less influence on the network topology, and\n+    //   reduces traffic to the seeds.\n+    // * When querying DNS seeds query a few at once, this ensures\n+    //   that we don't give DNS seeds the ability to eclipse nodes\n+    //   that query them.\n+    // * If we continue having problems, eventually query all the\n+    //   DNS seeds, and if that fails too, also try the fixed seeds.\n+    //   (done in ThreadOpenConnections)\n     for (const std::string& seed : seeds) {\n-        // goal: only query DNS seed if address need is acute\n-        // Avoiding DNS seeds when we don't need them improves user privacy by\n-        // creating fewer identifying DNS requests, reduces trust by giving seeds\n-        // less influence on the network topology, and reduces traffic to the seeds.\n         if (addrman.size() > 0 && seeds_right_now == 0) {\n-            if (!interruptNet.sleep_for(std::chrono::seconds(11))) return;\n-\n-            LOCK(cs_vNodes);\n-            int nRelevant = 0;\n-            for (const CNode* pnode : vNodes) {\n-                nRelevant += pnode->fSuccessfullyConnected && !pnode->fFeeler && !pnode->fOneShot && !pnode->m_manual_connection && !pnode->fInbound;\n-            }\n-            if (nRelevant >= 2) {\n-                LogPrintf(\"P2P peers available. Skipped DNS seeding.\\n\");\n-                return;\n+            LogPrintf(\"Waiting %d seconds before querying DNS seeds.\\n\", seeds_wait_time.count());\n+            std::chrono::seconds to_wait = seeds_wait_time;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16939#discussion_r377758118",
      "id" : 377758118,
      "in_reply_to_id" : 364971195,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc1ODExOA==",
      "original_commit_id" : "899d9f4097a3c23eb2dcb3fe186e9e90a5eb9d83",
      "original_position" : 56,
      "path" : "src/net.cpp",
      "position" : 53,
      "pull_request_review_id" : 356816422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16939",
      "updated_at" : "2020-02-11T16:43:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377758118",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   }
]
