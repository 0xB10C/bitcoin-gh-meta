[
   {
      "body" : "To be clear: this happens only happens while syncing a **directory** handle in `SyncDirIfManifest()`, syncing normal fds must still succeed.\r\n\r\n> It is unclear how to implement that easily though since we don't have access to any logger here.\r\n\r\nI'd say we should warn *once* when this happens, that data syncing can not be guaranteed over network filesystems.\r\n\r\nEven if it succeeds all that fsync can (generally) guarantee with network filesystems is that the data has been written to the server, not that the server has written it to disk\r\n\r\nHowever if there is no access to a logger from there it becomes difficult...\r\n\r\nEdit: Likely we want to run this through https://github.com/bitcoin-core/leveldb (but it's fine to have the PR open here for visibility, it just shouldn't be merged directly).",
      "created_at" : "2017-03-15T10:16:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10000#issuecomment-286698857",
      "id" : 286698857,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10000",
      "updated_at" : "2017-03-15T10:17:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/286698857",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Shouldn't we at least log a warning in this case? Maybe even fail if pruning is enabled? (Presumably it means a crash is likely to corrupt the index?)",
      "created_at" : "2017-03-15T10:33:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10000#issuecomment-286702837",
      "id" : 286702837,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10000",
      "updated_at" : "2017-03-15T10:33:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/286702837",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "It should not crash. There is reasons to use shared folder, one is in my posted issue. \r\nIf there is a corruption, then the user need to reindex. This is strictly better than just preventing to run at all.\r\n\r\nI agree for a warning. We can attempt fsync into bitcoin code on a dummy folder to see if it is enabled, and if not, provide a warning.",
      "created_at" : "2017-03-15T10:40:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10000#issuecomment-286704506",
      "id" : 286704506,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10000",
      "updated_at" : "2017-03-15T10:40:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/286704506",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "body" : "Pruning nodes don't have data to reindex from. I know if I downloaded 100 GB, and then had to re-do the download due to this, I'd be pretty annoyed... Better to find out sooner so I can use a different filesystem and avoid the re-download.",
      "created_at" : "2017-03-15T10:44:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10000#issuecomment-286705433",
      "id" : 286705433,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10000",
      "updated_at" : "2017-03-15T10:44:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/286705433",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "No, it should never crash/fail on this. If people run a datadirectory on a network FS they take some extra risk. There's nothing that we can do in that case (apart from warn).",
      "created_at" : "2017-03-15T10:52:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10000#issuecomment-286707287",
      "id" : 286707287,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10000",
      "updated_at" : "2017-03-15T10:54:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/286707287",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "> I agree for a warning. We can attempt fsync into bitcoin code on a dummy folder to see if it is enabled, and if not, provide a warning.\r\n\r\nYeah - maybe just try fsync() on the data directory at startup? No need even to make a dummy dir.",
      "created_at" : "2017-03-15T10:55:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10000#issuecomment-286707837",
      "id" : 286707837,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10000",
      "updated_at" : "2017-03-15T10:55:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/286707837",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
