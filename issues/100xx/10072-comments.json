[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10072#discussion_r108487850"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10072"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/108487850"
         }
      },
      "body" : "Do we want the same behavior on L44?",
      "commit_id" : "baeecbbb087842b18fb085b0d8c7b736c367cfe0",
      "created_at" : "2017-03-28T17:43:08Z",
      "diff_hunk" : "@@ -200,16 +200,14 @@ def test_BIP(self, bipName, activated_version, invalidate, invalidatePostSignatu\n         yield TestInstance([[block, False]])\n \n         # Restart all\n-        self.test.block_store.close()\n+        self.test.clear_all_connections()\n         stop_nodes(self.nodes)\n-        shutil.rmtree(self.options.tmpdir)\n+        shutil.rmtree(self.options.tmpdir + \"/node0\")\n         self.setup_chain()\n         self.setup_network()\n-        self.test.block_store = BlockStore(self.options.tmpdir)\n-        self.test.clear_all_connections()\n         self.test.add_all_connections(self.nodes)\n-        NetworkThread().start() # Start up network handling in another thread\n-\n+        NetworkThread().start()\n+        self.test.test_nodes[0].wait_for_verack()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10072#discussion_r108487850",
      "id" : 108487850,
      "original_commit_id" : "baeecbbb087842b18fb085b0d8c7b736c367cfe0",
      "original_position" : 17,
      "path" : "test/functional/bip9-softforks.py",
      "position" : 17,
      "pull_request_review_id" : 29522081,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10072",
      "updated_at" : "2017-03-28T18:09:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/108487850",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10072#discussion_r108488077"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10072"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/108488077"
         }
      },
      "body" : "Is there any work we can do in-between this and the wait for verack?\r\n\r\nMaybe have a comment here about having to wait for verack rather than just deleting the comment.",
      "commit_id" : "baeecbbb087842b18fb085b0d8c7b736c367cfe0",
      "created_at" : "2017-03-28T17:44:08Z",
      "diff_hunk" : "@@ -200,16 +200,14 @@ def test_BIP(self, bipName, activated_version, invalidate, invalidatePostSignatu\n         yield TestInstance([[block, False]])\n \n         # Restart all\n-        self.test.block_store.close()\n+        self.test.clear_all_connections()\n         stop_nodes(self.nodes)\n-        shutil.rmtree(self.options.tmpdir)\n+        shutil.rmtree(self.options.tmpdir + \"/node0\")\n         self.setup_chain()\n         self.setup_network()\n-        self.test.block_store = BlockStore(self.options.tmpdir)\n-        self.test.clear_all_connections()\n         self.test.add_all_connections(self.nodes)\n-        NetworkThread().start() # Start up network handling in another thread\n-\n+        NetworkThread().start()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10072#discussion_r108488077",
      "id" : 108488077,
      "original_commit_id" : "baeecbbb087842b18fb085b0d8c7b736c367cfe0",
      "original_position" : 16,
      "path" : "test/functional/bip9-softforks.py",
      "position" : 16,
      "pull_request_review_id" : 29522081,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10072",
      "updated_at" : "2017-03-28T18:09:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/108488077",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10072#discussion_r108488136"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10072"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/108488136"
         }
      },
      "body" : "Is there a more idiomatic way to get the dirname?",
      "commit_id" : "baeecbbb087842b18fb085b0d8c7b736c367cfe0",
      "created_at" : "2017-03-28T17:44:22Z",
      "diff_hunk" : "@@ -200,16 +200,14 @@ def test_BIP(self, bipName, activated_version, invalidate, invalidatePostSignatu\n         yield TestInstance([[block, False]])\n \n         # Restart all\n-        self.test.block_store.close()\n+        self.test.clear_all_connections()\n         stop_nodes(self.nodes)\n-        shutil.rmtree(self.options.tmpdir)\n+        shutil.rmtree(self.options.tmpdir + \"/node0\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10072#discussion_r108488136",
      "id" : 108488136,
      "original_commit_id" : "baeecbbb087842b18fb085b0d8c7b736c367cfe0",
      "original_position" : 8,
      "path" : "test/functional/bip9-softforks.py",
      "position" : 8,
      "pull_request_review_id" : 29522081,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10072",
      "updated_at" : "2017-03-28T18:09:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/108488136",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10072#discussion_r108488637"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10072"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/108488637"
         }
      },
      "body" : "Maybe raise the error yourself rather than `assert`, unless you only want it in debug mode?",
      "commit_id" : "baeecbbb087842b18fb085b0d8c7b736c367cfe0",
      "created_at" : "2017-03-28T17:46:18Z",
      "diff_hunk" : "@@ -41,11 +42,17 @@ def run_test(self):\n         self.nodes[1].generate(1)\n         self.sync_all()\n \n-        with open(self.alert_filename, 'r', encoding='utf8') as f:\n-            alert_text = f.read()\n+        # Give bitcoind 10 seconds to write the alert notification\n+        timeout = 10\n+        while True:\n+            with open(self.alert_filename, 'r', encoding='utf8') as f:\n+                alert_text = f.read()\n+            if len(alert_text) > 0:\n+                break\n \n-        if len(alert_text) == 0:\n-            raise AssertionError(\"-alertnotify did not warn of up-version blocks\")\n+            assert timeout > 0, \"-alertnotify did not warn of up-version blocks\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10072#discussion_r108488637",
      "id" : 108488637,
      "original_commit_id" : "baeecbbb087842b18fb085b0d8c7b736c367cfe0",
      "original_position" : 24,
      "path" : "test/functional/forknotify.py",
      "position" : 24,
      "pull_request_review_id" : 29522081,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10072",
      "updated_at" : "2017-03-28T18:09:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/108488637",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10072#discussion_r108493763"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10072"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/108493763"
         }
      },
      "body" : "Maybe a bit cleaner to do something like (a couple of changes, feel free to pick and choose -- I was torn on the os.path.exists+getsize v.s. continual reading with open).\r\n\r\n```python\r\n        for t in xrange(100):\r\n            if os.path.exists(self.alert_filename) and os.path.getsize(self.alert_filename):\r\n                break\r\n            if t != 99: time.sleep(0.1) \r\n        else:\r\n            raise AssertionError(\"-alertnotify did not warn of up-version blocks\")\r\n        with open(self.alert_filename, 'r', encoding='utf8') as f:\r\n            alert_text = f.read()\r\n```",
      "commit_id" : "baeecbbb087842b18fb085b0d8c7b736c367cfe0",
      "created_at" : "2017-03-28T18:04:49Z",
      "diff_hunk" : "@@ -41,11 +42,17 @@ def run_test(self):\n         self.nodes[1].generate(1)\n         self.sync_all()\n \n-        with open(self.alert_filename, 'r', encoding='utf8') as f:\n-            alert_text = f.read()\n+        # Give bitcoind 10 seconds to write the alert notification\n+        timeout = 10\n+        while True:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10072#discussion_r108493763",
      "id" : 108493763,
      "original_commit_id" : "baeecbbb087842b18fb085b0d8c7b736c367cfe0",
      "original_position" : 16,
      "path" : "test/functional/forknotify.py",
      "position" : 16,
      "pull_request_review_id" : 29522081,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10072",
      "updated_at" : "2017-03-28T18:09:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/108493763",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10072#discussion_r108494509"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10072"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/108494509"
         }
      },
      "body" : "This should rarely actually take 10 seconds, if the code is correct, right? Maybe 1 second will be a bit better in the case where it is actually broken & you're trying to fix it.",
      "commit_id" : "baeecbbb087842b18fb085b0d8c7b736c367cfe0",
      "created_at" : "2017-03-28T18:07:35Z",
      "diff_hunk" : "@@ -41,11 +42,17 @@ def run_test(self):\n         self.nodes[1].generate(1)\n         self.sync_all()\n \n-        with open(self.alert_filename, 'r', encoding='utf8') as f:\n-            alert_text = f.read()\n+        # Give bitcoind 10 seconds to write the alert notification\n+        timeout = 10",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10072#discussion_r108494509",
      "id" : 108494509,
      "original_commit_id" : "baeecbbb087842b18fb085b0d8c7b736c367cfe0",
      "original_position" : 15,
      "path" : "test/functional/forknotify.py",
      "position" : 15,
      "pull_request_review_id" : 29522081,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10072",
      "updated_at" : "2017-03-28T18:09:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/108494509",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   }
]
