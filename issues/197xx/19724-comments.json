[
   {
      "author_association" : "MEMBER",
      "body" : "I'm not 100% convinced about replacing `IsAddrRelayPeer()` with `RelayAddrsWithConn()`  9345f9c9d47a88987606d1421823914a4c48dbf9. \r\n\r\nPros: \r\n- It is more direct to check the connection type instead of a (missing) data structure based on the connection type.\r\n- Easy to update logic in the future \r\n- Less mental overhead, less code touch points to glean intention. \r\n\r\nCons: \r\n- We are now checking the same conditional in two places- [[1](https://github.com/bitcoin/bitcoin/pull/19724/commits/9345f9c9d47a88987606d1421823914a4c48dbf9#diff-1a8b9d1ad0a6fda5e751286c73102fc2R867)] & [[2](https://github.com/bitcoin/bitcoin/blob/master/src/net.cpp#L2783)], and need to manually ensure they do not fall out of sync. \r\n\r\nCurious to hear what other reviewers think is preferable. ",
      "created_at" : "2020-08-14T22:32:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19724#issuecomment-674298044",
      "id" : 674298044,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19724",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDI5ODA0NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-14T22:59:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674298044",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@amitiuttarwar I think it makes sense to make the addr-relay decision depend on the connection type. That should be the most authoritative information about the connection. Sure, it's duplication, but if we accidentally forget to create the necessary data structures, test will fail; if we accidentally create them if they're not needed, at worst we've wasted a bit of memory we're already ok with for other nodes.",
      "created_at" : "2020-08-14T23:53:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19724#issuecomment-674314573",
      "id" : 674314573,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19724",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDMxNDU3Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-14T23:53:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674314573",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r470950246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470950246"
         }
      },
      "author_association" : "MEMBER",
      "body" : "style-nit:\r\n\r\n```suggestion\r\n                switch (pnode->m_conn_type) {\r\n```\r\n\r\nif you decide to do style-fixups, it would probably be good to do all of them in one go or not at all. Maybe with clang-format-diff?   https://github.com/bitcoin/bitcoin/tree/master/contrib/devtools#clang-format-diffpy ",
      "commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "created_at" : "2020-08-15T07:38:46Z",
      "diff_hunk" : "@@ -1841,11 +1841,11 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 // but inbound and manual peers do not use our outbound slots. Inbound peers\n                 // also have the added issue that they could be attacker controlled and used\n                 // to prevent us from connecting to particular hosts if we used them here.\n-                switch(pnode->m_conn_type){\n+                switch (pnode->m_conn_type){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r470950246",
      "id" : 470950246,
      "line" : 1844,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk1MDI0Ng==",
      "original_commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "original_line" : 1844,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 5,
      "pull_request_review_id" : 467955141,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-15T07:38:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470950246",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
