[
   {
      "author_association" : "MEMBER",
      "body" : "I'm not 100% convinced about replacing `IsAddrRelayPeer()` with `RelayAddrsWithConn()`  9345f9c9d47a88987606d1421823914a4c48dbf9. \r\n\r\nPros: \r\n- It is more direct to check the connection type instead of a (missing) data structure based on the connection type.\r\n- Easy to update logic in the future \r\n- Less mental overhead, less code touch points to glean intention. \r\n\r\nCons: \r\n- We are now checking the same conditional in two places- [[1](https://github.com/bitcoin/bitcoin/pull/19724/commits/9345f9c9d47a88987606d1421823914a4c48dbf9#diff-1a8b9d1ad0a6fda5e751286c73102fc2R867)] & [[2](https://github.com/bitcoin/bitcoin/blob/master/src/net.cpp#L2783)], and need to manually ensure they do not fall out of sync. \r\n\r\nCurious to hear what other reviewers think is preferable. ",
      "created_at" : "2020-08-14T22:32:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19724#issuecomment-674298044",
      "id" : 674298044,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19724",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDI5ODA0NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-14T22:59:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674298044",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@amitiuttarwar I think it makes sense to make the addr-relay decision depend on the connection type. That should be the most authoritative information about the connection. Sure, it's duplication, but if we accidentally forget to create the necessary data structures, test will fail; if we accidentally create them if they're not needed, at worst we've wasted a bit of memory we're already ok with for other nodes.",
      "created_at" : "2020-08-14T23:53:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19724#issuecomment-674314573",
      "id" : 674314573,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19724",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDMxNDU3Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-14T23:53:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674314573",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r470950246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470950246"
         }
      },
      "author_association" : "MEMBER",
      "body" : "style-nit:\r\n\r\n```suggestion\r\n                switch (pnode->m_conn_type) {\r\n```\r\n\r\nif you decide to do style-fixups, it would probably be good to do all of them in one go or not at all. Maybe with clang-format-diff?   https://github.com/bitcoin/bitcoin/tree/master/contrib/devtools#clang-format-diffpy ",
      "commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "created_at" : "2020-08-15T07:38:46Z",
      "diff_hunk" : "@@ -1841,11 +1841,11 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 // but inbound and manual peers do not use our outbound slots. Inbound peers\n                 // also have the added issue that they could be attacker controlled and used\n                 // to prevent us from connecting to particular hosts if we used them here.\n-                switch(pnode->m_conn_type){\n+                switch (pnode->m_conn_type){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r470950246",
      "id" : 470950246,
      "line" : 1844,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk1MDI0Ng==",
      "original_commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "original_line" : 1844,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 5,
      "pull_request_review_id" : 467955141,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-15T07:38:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470950246",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r470962473"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470962473"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If we're cleaning this up, we should really clean it up and move the `connman.MarkAddressGood()` out of this if statement, since it's not related to address advertising at all. Having it in the same conditional is a trap for developers to fall into.\r\n\r\n(specifically, a developer might think \"we don't need to advertise our address to FEELER connections, since we disconnect before we actually send the ADDR or GETADDR messages, so we can remove FEELER from AdvertiseAddressToConn\", but doing that breaks our FEELER connection logic, because `MarkAddressGood()` needs to be called to mark the address as good)\r\n\r\ncc @sdaftuar ",
      "commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "created_at" : "2020-08-15T10:16:06Z",
      "diff_hunk" : "@@ -2433,9 +2433,8 @@ void ProcessMessage(\n         UpdatePreferredDownload(pfrom, State(pfrom.GetId()));\n         }\n \n-        if (!pfrom.IsInboundConn() && pfrom.IsAddrRelayPeer())\n+        if (pfrom.AdvertiseAddressToConn())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r470962473",
      "id" : 470962473,
      "line" : 2436,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk2MjQ3Mw==",
      "original_commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "original_line" : 2436,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 32,
      "pull_request_review_id" : 467962627,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-15T10:16:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470962473",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Strong strong concept ACK.\r\n\r\nI think it'd be good to extract everything in the `while (!interruptNet)` in `ThreadOpenConnections()` into its own function since deeply nested while/for/if blocks obscure control flow and are very often the sources of bugs. Doing that might be scope creep for this PR though.",
      "created_at" : "2020-08-15T10:18:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19724#issuecomment-674379263",
      "id" : 674379263,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19724",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDM3OTI2Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-15T10:18:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674379263",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r471019849"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471019849"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was looking at this more and I believe we should leave the MarkAddressGood call in the if-block, though it needs an explanationâ the reason (I think) is that we donât want block-relay connections to leave a trace in the addrman that could be leaked by an attacker sniffing our addr responses.\r\n\r\nSo this just needs a comment explaining why itâs in here.\r\n",
      "commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "created_at" : "2020-08-15T18:08:07Z",
      "diff_hunk" : "@@ -2433,9 +2433,8 @@ void ProcessMessage(\n         UpdatePreferredDownload(pfrom, State(pfrom.GetId()));\n         }\n \n-        if (!pfrom.IsInboundConn() && pfrom.IsAddrRelayPeer())\n+        if (pfrom.AdvertiseAddressToConn())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r471019849",
      "id" : 471019849,
      "in_reply_to_id" : 470962473,
      "line" : 2436,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTAxOTg0OQ==",
      "original_commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "original_line" : 2436,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 32,
      "pull_request_review_id" : 468009053,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-15T18:08:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471019849",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r471090087"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471090087"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can you explain this a bit? I think you're saying that if we connect out to a peer that we use for block-relay-only we don't want to mark it as good (essentially move it from New to Tried and update the last successful connect time) because then another peer might be able to tell that we've connected to them?\r\n\r\nMy understanding of how we respond to `getaddr` messages is that we'll respond with (up to) 1000 records taken at random from all records, regardless of whether they're in New or Tried, so marking a peer as good won't change whether we include it in `addr` responses.",
      "commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "created_at" : "2020-08-16T09:38:35Z",
      "diff_hunk" : "@@ -2433,9 +2433,8 @@ void ProcessMessage(\n         UpdatePreferredDownload(pfrom, State(pfrom.GetId()));\n         }\n \n-        if (!pfrom.IsInboundConn() && pfrom.IsAddrRelayPeer())\n+        if (pfrom.AdvertiseAddressToConn())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r471090087",
      "id" : 471090087,
      "in_reply_to_id" : 470962473,
      "line" : 2436,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA5MDA4Nw==",
      "original_commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "original_line" : 2436,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 32,
      "pull_request_review_id" : 468049187,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-16T09:38:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471090087",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r471131850"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471131850"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't have a great understanding of the details of how addrman works or how we interact with it -- so possibly the fear was unfounded.  It used to be the case that you could trivially download a listening node's addrman though, and it also used to be the case (perhaps only long ago?) that we'd leak information about current connections based on time stamps stored in our addrman, so when I worked on #15759 I tried to [leave the addrman state unchanged](https://github.com/bitcoin/bitcoin/pull/15759#issuecomment-480398802) when making block-relay-only connections.\r\n\r\nI'm not sure that I fully succeeded in not leaking information, or that the concern is correct to begin with given how addrman already works.  So it's possible that with some analysis we could make improvements here.  Maybe not appropriate for this pr though...",
      "commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "created_at" : "2020-08-16T16:29:01Z",
      "diff_hunk" : "@@ -2433,9 +2433,8 @@ void ProcessMessage(\n         UpdatePreferredDownload(pfrom, State(pfrom.GetId()));\n         }\n \n-        if (!pfrom.IsInboundConn() && pfrom.IsAddrRelayPeer())\n+        if (pfrom.AdvertiseAddressToConn())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r471131850",
      "id" : 471131850,
      "in_reply_to_id" : 470962473,
      "line" : 2436,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTEzMTg1MA==",
      "original_commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "original_line" : 2436,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 32,
      "pull_request_review_id" : 468077363,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-16T16:29:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/471131850",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r472084750"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472084750"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I believe there are three ways that a peer's record is updated in addrman when we're connected to them:\r\n\r\n1. when we receive a `version` message from them, we'll mark their address good. That moves the address from the new table to the tried table, and updates the `nLastSuccess`/`nLastTry`/`nAttempts` fields. We only do this if the peer isn't inbound and isn't block-relay-only. I don't believe this change can easily be detected by a peer sending us `getaddr` messages.\r\n2. if a peer self-advertises to us, we'll call `AddAddressKnown()`, which could update the `nTime`, which is included in the address record that we send to a peer in response to a `getaddr` request.\r\n3. when we disconnect from the peer, we'll update the `nTime`, as long as the peer was marked as `fCurrentlyConnected`. That happens when we receive a `verack` from a peer which is not inbound. This doesn't include feeler peers, since we disconnect from them as soon as we receive a `version` message from them. The `nTime` is only updated during disconnection so spies can't find out who we're currently connected to (https://github.com/bitcoin/bitcoin/pull/5860#issuecomment-78397140).\r\n\r\nIn summary, I think block-relay-only peers _should_ have their address marked good when we connect to them (1). If we don't, then we'll update the `nLastTry` and `nAttempts` fields when we attempt to connect to them, but not update the `nLastSuccess`.\r\n\r\nThe reason it's important in this PR is that placing `MarkAddressGood()` behind a conditional `if (AdvertiseAddressToConn())` is very confusing for anyone reading the code, and makes it easy to introduce subtle bugs.",
      "commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "created_at" : "2020-08-18T10:42:50Z",
      "diff_hunk" : "@@ -2433,9 +2433,8 @@ void ProcessMessage(\n         UpdatePreferredDownload(pfrom, State(pfrom.GetId()));\n         }\n \n-        if (!pfrom.IsInboundConn() && pfrom.IsAddrRelayPeer())\n+        if (pfrom.AdvertiseAddressToConn())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r472084750",
      "id" : 472084750,
      "in_reply_to_id" : 470962473,
      "line" : 2436,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA4NDc1MA==",
      "original_commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "original_line" : 2436,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 32,
      "pull_request_review_id" : 469203968,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-18T10:42:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472084750",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r473793235"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473793235"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I really dislike these functions being inside `CNode` (same as https://github.com/bitcoin/bitcoin/pull/19316#discussion_r464526492). This is very specific net_processing logic, rather than a general property of the CNode. Having the logic inside net.h rather than at the point it's needed makes it less readable.",
      "commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "created_at" : "2020-08-20T09:06:51Z",
      "diff_hunk" : "@@ -838,37 +838,89 @@ class CNode\n         assert(false);\n     }\n \n+    /* These are the default connections that we use to connect with the\n+     * network. There is no restriction on the inventory relayed- by default we\n+     * relay blocks, addresses & transactions. We attempt to open\n+     * MAX_OUTBOUND_FULL_RELAY_CONNECTIONS using addresses from our AddrMan.\n+     */\n     bool IsFullOutboundConn() const {\n-        return m_conn_type == ConnectionType::OUTBOUND;\n+        return m_conn_type == ConnectionType::OUTBOUND_FULL_RELAY;\n     }\n \n+    /* We open manual connections to addresses that users explicitly inputted\n+     * via the addnode RPC, or the -connect command line argument. Even if a\n+     * manual connection is misbehaving, we do not automatically disconnect or\n+     * add it to our discouragement filter.\n+     */\n     bool IsManualConn() const {\n         return m_conn_type == ConnectionType::MANUAL;\n     }\n \n+    /* After meeting our quota for full outbound connections, we attempt to\n+     * open MAX_BLOCK_RELAY_ONLY_CONNECTIONS to help prevent against partition\n+     * attacks. By not relaying transactions or addresses, these connections\n+     * are harder to detect by a third party, thus helping obfuscate the\n+     * network topology.\n+     */\n     bool IsBlockOnlyConn() const {\n         return m_conn_type == ConnectionType::BLOCK_RELAY;\n     }\n \n+    /* Feeler connections are short lived connections used to increase the\n+     * number of connectable addresses in our AddrMan. Approximately every\n+     * FEELER_INTERVAL, we attempt to connect to a random address from the new\n+     * table. If successful, we add it to the tried table.\n+     */\n     bool IsFeelerConn() const {\n         return m_conn_type == ConnectionType::FEELER;\n     }\n \n+    /* AddrFetch connections are short lived connections used to solicit\n+     * addresses from peers. These are initiated to addresses submitted via the\n+     * -seednode command line argument, or under certain conditions when the\n+     * AddrMan is empty.\n+     */\n     bool IsAddrFetchConn() const {\n         return m_conn_type == ConnectionType::ADDR_FETCH;\n     }\n \n+    /* Inbound connections are those initiated by a peer. This is the only\n+     * property we know at the time of connection, until P2P messages are\n+     * exchanged.\n+     */\n     bool IsInboundConn() const {\n         return m_conn_type == ConnectionType::INBOUND;\n     }\n \n+    /* Whether we send addr messages over this connection */\n+    bool RelayAddrsWithConn() const {\n+        return m_conn_type != ConnectionType::BLOCK_RELAY;\n+    }\n+\n+    /* Whether we attempt to advertise our own address to the peer when\n+     * processing their VERSION message */\n+    bool AdvertiseAddressToConn() const {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r473793235",
      "id" : 473793235,
      "line" : 902,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzc5MzIzNQ==",
      "original_commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "original_line" : 902,
      "original_position" : 95,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 95,
      "pull_request_review_id" : 471403773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-20T09:26:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473793235",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r473802643"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473802643"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Format these as doxygen comments (start with `/**`) https://www.doxygen.nl/manual/docblocks.html",
      "commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "created_at" : "2020-08-20T09:18:16Z",
      "diff_hunk" : "@@ -838,37 +838,89 @@ class CNode\n         assert(false);\n     }\n \n+    /* These are the default connections that we use to connect with the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r473802643",
      "id" : 473802643,
      "line" : 841,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzgwMjY0Mw==",
      "original_commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "original_line" : 841,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 33,
      "pull_request_review_id" : 471403773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-20T09:26:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473802643",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r473805346"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473805346"
         }
      },
      "author_association" : "MEMBER",
      "body" : "These are great comments. Thank you! Should they be merged with the comments above on the enum members?",
      "commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "created_at" : "2020-08-20T09:21:36Z",
      "diff_hunk" : "@@ -838,37 +838,89 @@ class CNode\n         assert(false);\n     }\n \n+    /* These are the default connections that we use to connect with the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r473805346",
      "id" : 473805346,
      "line" : 841,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzgwNTM0Ng==",
      "original_commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "original_line" : 841,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 33,
      "pull_request_review_id" : 471403773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-20T09:26:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473805346",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r474161665"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474161665"
         }
      },
      "author_association" : "MEMBER",
      "body" : "yeah I felt very indecisive when trying to figure out the best spots for the comments. here what I've gone for is having the enum comments be a more concise description of the nature of the connection, and the function provide more context around design goals, capacity, etc. \r\n\r\nI don't think the split is super clear though, so yeah, maybe it would be more helpful to consolidate it all into the enum member comments. is that what you're advocating for? or just trying to weigh like me? âï¸  ð",
      "commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "created_at" : "2020-08-20T17:40:42Z",
      "diff_hunk" : "@@ -838,37 +838,89 @@ class CNode\n         assert(false);\n     }\n \n+    /* These are the default connections that we use to connect with the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19724#discussion_r474161665",
      "id" : 474161665,
      "in_reply_to_id" : 473805346,
      "line" : 841,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDE2MTY2NQ==",
      "original_commit_id" : "b672f8d84f8d4562fe8e228abd35c85a66bdbf4c",
      "original_line" : 841,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 33,
      "pull_request_review_id" : 471843142,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19724",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-20T17:40:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474161665",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19763 (net: don't try to relay to the address' originator by vasild)\n* #19725 ([RPC] Add connection type to getpeerinfo, improve logs by amitiuttarwar)\n* #19704 (Net processing: move ProcessMessage() to PeerLogicValidation by jnewbery)\n* #17194 (p2p: Avoid forwarding ADDR messages to SPV nodes by naumenkogs)\n* #15606 ([experimental] UTXO snapshots by jamesob)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-08-20T20:24:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19724#issuecomment-677884934",
      "id" : 677884934,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19724",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3Nzg4NDkzNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-20T20:24:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/677884934",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "thanks for the feedback! all comments should be addressed. \r\n\r\n@sipa \r\nI agree with this: \r\n> make the addr-relay decision depend on the connection type. That should be the most authoritative information about the connection.\r\n\r\nBut unfortunately I don't think this is true: \r\n>  but if we accidentally forget to create the necessary data structures, test will fail; \r\n\r\nI updated `RelayAddrsWithConn` to always return true, recompiled & ran `test_runner.py` & unit tests. Nothing failed. My concern would be addressed if it did :) I think with #19315, we should be able to add functional tests that would fail if a discrepancy occurs? \r\n\r\nCurrently I think the downside is probably acceptable, but want to highlight since I don't think we have any automatic protection in place. (unless I'm missing something?) \r\n\r\n---\r\n\r\n@jnewbery, RE: \r\n> I think it'd be good to extract everything in the while (!interruptNet) in ThreadOpenConnections() into its own function since deeply nested while/for/if blocks obscure control flow and are very often the sources of bugs. Doing that might be scope creep for this PR though.\r\n\r\nI 100% agree. I spent *so* many hours trying to interpret the exact logic around what types of connections are open, and have gotten very confused by the deeply nested logic flows & nuances of things like where a break / continue that's 4 levels deep will pop you back out to. I've taken a first pass at extracting the outer `while (!interruptNet)` loop here (yes, there are two levels nested): https://github.com/amitiuttarwar/bitcoin/commit/eecc5877c08744c55200846bb7b3b70c922b75ec. However, it needs to be done with great care and I would need to spend a lot more time / build a lot more confidence with these changes before I'd feel comfortable proposing them. Feel free to take a look or further the branch if you're interested :) ",
      "created_at" : "2020-08-21T03:40:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19724#issuecomment-678020419",
      "id" : 678020419,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19724",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3ODAyMDQxOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-21T03:55:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/678020419",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK c99b26010eaf4d446eb5118e38dbcc03fabba11c\r\n\r\n> have gotten very confused by the deeply nested logic flows & nuances of things like where a break / continue that's 4 levels deep will pop you back out to.\r\n\r\nYes, deeply nested if/while/switch statements hide bugs. If it's possible to factor them out to clarify control flow, we should aim to do that.\r\n\r\n> I've taken a first pass at extracting the outer while (!interruptNet) loop here\r\n\r\nI've had a very quick skim of that branch and it looks like the right direction to me.\r\n\r\n> I would need to spend a lot more time / build a lot more confidence with these changes before I'd feel comfortable proposing them. Feel free to take a look or further the branch if you're interested :)\r\n\r\nI think you're very well positioned to open this PR if you want to. You've already spent hours getting to grips with the logic here :slightly_smiling_face: . I've already got my quota of refactor PRs open, but I can definitely commit to reviewing a PR if you open it. (Equally, we don't need to fix this all at once. We can always leave this for another time).",
      "created_at" : "2020-08-21T10:43:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19724#issuecomment-678218813",
      "id" : 678218813,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19724",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3ODIxODgxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-21T10:43:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/678218813",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
