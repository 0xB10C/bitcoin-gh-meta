[
   {
      "author_association" : "MEMBER",
      "body" : "ACK 4deb2ef0e0c0571a15a8be44bd43fa42f99c089d",
      "created_at" : "2020-08-21T15:53:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19774#issuecomment-678363393",
      "id" : 678363393,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19774",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3ODM2MzM5Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-21T15:53:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/678363393",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19774#discussion_r476523716"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/476523716"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's erasing a spkm of the same output type because the user is importing an inactive descriptor of the same output type? Am I reading this right?",
      "commit_id" : "4deb2ef0e0c0571a15a8be44bd43fa42f99c089d",
      "created_at" : "2020-08-25T15:08:15Z",
      "diff_hunk" : "@@ -4485,6 +4485,21 @@ void CWallet::LoadActiveScriptPubKeyMan(uint256 id, OutputType type, bool intern\n     NotifyCanGetAddressesChanged();\n }\n \n+void CWallet::DeactivateScriptPubKeyMan(uint256 id, OutputType type, bool internal)\n+{\n+    WalletLogPrintf(\"Deactivate spkMan: id = %s, type = %d, internal = %d\\n\", id.ToString(), static_cast<int>(type), static_cast<int>(internal));\n+    WalletBatch batch(*database);\n+    if (!batch.EraseActiveScriptPubKeyMan(static_cast<uint8_t>(type), internal)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19774#discussion_r476523716",
      "id" : 476523716,
      "line" : 4492,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjUyMzcxNg==",
      "original_commit_id" : "4deb2ef0e0c0571a15a8be44bd43fa42f99c089d",
      "original_line" : 4492,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 8,
      "pull_request_review_id" : 474578369,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-25T15:08:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/476523716",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19774#discussion_r477186764"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19774"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/477186764"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ð¤¦ Yes, unfortunately, you are correct. Another issue is that I can't fix this PR on it's own. I was under impression it can be separate from #19651 but alas. I can't just move `EraseActiveScriptPubKeyMan` under `if (spk_mans[type] && spk_mans[type]->GetID() == id)` because the map of active spk managers has been cleared already by this point. So it's impossible to know whether we need to write anything to the disk.\r\n\r\nI'll fix this and combine with #19651 where I'm trying to make `importdescriptors` command do proper updates. Would you mind reviewing that instead?",
      "commit_id" : "4deb2ef0e0c0571a15a8be44bd43fa42f99c089d",
      "created_at" : "2020-08-26T10:05:01Z",
      "diff_hunk" : "@@ -4485,6 +4485,21 @@ void CWallet::LoadActiveScriptPubKeyMan(uint256 id, OutputType type, bool intern\n     NotifyCanGetAddressesChanged();\n }\n \n+void CWallet::DeactivateScriptPubKeyMan(uint256 id, OutputType type, bool internal)\n+{\n+    WalletLogPrintf(\"Deactivate spkMan: id = %s, type = %d, internal = %d\\n\", id.ToString(), static_cast<int>(type), static_cast<int>(internal));\n+    WalletBatch batch(*database);\n+    if (!batch.EraseActiveScriptPubKeyMan(static_cast<uint8_t>(type), internal)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19774#discussion_r477186764",
      "id" : 477186764,
      "in_reply_to_id" : 476523716,
      "line" : 4492,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE4Njc2NA==",
      "original_commit_id" : "4deb2ef0e0c0571a15a8be44bd43fa42f99c089d",
      "original_line" : 4492,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 8,
      "pull_request_review_id" : 475341739,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19774",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-26T10:05:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/477186764",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   }
]
