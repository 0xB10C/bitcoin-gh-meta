[
   {
      "body" : "Can you provide a description of how this bug can be triggered? (and have you seen this segfault?)",
      "created_at" : "2014-10-29T20:11:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5154#issuecomment-60995964",
      "id" : 60995964,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5154",
      "updated_at" : "2014-10-29T20:11:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/60995964",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "You'll see it on initializing the daemon, while scanning for better chains in the block chain database, that are not yet connected in the active best chain.\r\n\r\nWhen this does occur, ConnectTip in ActivateBestChainStep returns true. Hence, fInvalidFound remains false, CheckForkWarningConditions is entered instead of CheckForkWarningConditionsOnNewFork where pindexBestForkBase is set. Hence, subsequent refs to pindexBestForkBase fail. \r\n\r\nThe commit catches this, and produces a \"Warning: Found invalid chain at least ~6 blocks longer than our best chain. Chain state database corruption likely.\" Preferable to what otherwise results in a crash, and, in fact, informative, as reindex-ing does correct it.",
      "created_at" : "2014-10-30T03:02:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5154#issuecomment-61039623",
      "id" : 61039623,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5154",
      "updated_at" : "2014-10-30T03:02:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/61039623",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8286077?v=3",
         "events_url" : "https://api.github.com/users/21E14/events{/privacy}",
         "followers_url" : "https://api.github.com/users/21E14/followers",
         "following_url" : "https://api.github.com/users/21E14/following{/other_user}",
         "gists_url" : "https://api.github.com/users/21E14/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/21E14",
         "id" : 8286077,
         "login" : "21E14",
         "organizations_url" : "https://api.github.com/users/21E14/orgs",
         "received_events_url" : "https://api.github.com/users/21E14/received_events",
         "repos_url" : "https://api.github.com/users/21E14/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/21E14/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/21E14/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/21E14"
      }
   },
   {
      "body" : "Huh? The way I read this pull, the only thing it will do is fix a SEGFAULT, not a logic error?",
      "created_at" : "2014-10-30T05:10:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5154#issuecomment-61046465",
      "id" : 61046465,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5154",
      "updated_at" : "2014-10-30T05:10:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/61046465",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "The description is that of the functional impact of the PR.",
      "created_at" : "2014-10-30T12:13:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5154#issuecomment-61082203",
      "id" : 61082203,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5154",
      "updated_at" : "2014-10-30T12:13:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/61082203",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8286077?v=3",
         "events_url" : "https://api.github.com/users/21E14/events{/privacy}",
         "followers_url" : "https://api.github.com/users/21E14/followers",
         "following_url" : "https://api.github.com/users/21E14/following{/other_user}",
         "gists_url" : "https://api.github.com/users/21E14/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/21E14",
         "id" : 8286077,
         "login" : "21E14",
         "organizations_url" : "https://api.github.com/users/21E14/orgs",
         "received_events_url" : "https://api.github.com/users/21E14/received_events",
         "repos_url" : "https://api.github.com/users/21E14/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/21E14/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/21E14/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/21E14"
      }
   },
   {
      "body" : "I'm pretty sure this is actually triggerable exactly as 21E14 describes, e.g. when restarting a node which is had previously had an invalid block in the last execution.  It's easily triggerable with Pieter's invalidate block patch.\r\n\r\nThe fix given here does not appear to be sufficient as pindexBestForkBase is also dereferenced in the next block below, so I cannot ACK.  I would bludgeon Matt to clean the whole thing up, but he's travling and a minimal change for 0.10 would be preferable.\r\n\r\n21E14, can you please extend the guards so that all the deferences in this function are protected? I think that would be the simple and conservative move right now rather than trying to reason about what invarients hold for these globals. Having potential crash bugs for a corner case nag message isn't something that excites me.",
      "created_at" : "2014-11-21T09:55:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5154#issuecomment-63948366",
      "id" : 63948366,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5154",
      "updated_at" : "2014-11-21T09:55:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/63948366",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Updated as suggested. Please note that, unlike the first block, I have not observed the second block being entered in this instance. Nevertheless, extending the guards seems prudent until the globals are reconsidered more systematically.",
      "created_at" : "2014-11-22T05:46:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5154#issuecomment-64070319",
      "id" : 64070319,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5154",
      "updated_at" : "2014-11-22T05:46:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64070319",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8286077?v=3",
         "events_url" : "https://api.github.com/users/21E14/events{/privacy}",
         "followers_url" : "https://api.github.com/users/21E14/followers",
         "following_url" : "https://api.github.com/users/21E14/following{/other_user}",
         "gists_url" : "https://api.github.com/users/21E14/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/21E14",
         "id" : 8286077,
         "login" : "21E14",
         "organizations_url" : "https://api.github.com/users/21E14/orgs",
         "received_events_url" : "https://api.github.com/users/21E14/received_events",
         "repos_url" : "https://api.github.com/users/21E14/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/21E14/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/21E14/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/21E14"
      }
   },
   {
      "body" : "Thanks. ACK.",
      "created_at" : "2014-11-22T08:26:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5154#issuecomment-64073417",
      "id" : 64073417,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5154",
      "updated_at" : "2014-11-22T08:26:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64073417",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "utACK",
      "created_at" : "2014-11-23T18:12:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5154#issuecomment-64127918",
      "id" : 64127918,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5154",
      "updated_at" : "2014-11-23T18:12:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64127918",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Wouldn't we want warnings even if !pindexBestForkBase? Or am I missing something?",
      "created_at" : "2014-11-23T20:23:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5154#issuecomment-64132987",
      "id" : 64132987,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5154",
      "updated_at" : "2014-11-23T20:23:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64132987",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "@luke-jr It still gives a warning, just a less specific one, see the other prints in that block.",
      "created_at" : "2014-11-23T20:29:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5154#issuecomment-64133255",
      "id" : 64133255,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5154",
      "updated_at" : "2014-11-23T20:30:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64133255",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   }
]
