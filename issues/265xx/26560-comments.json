[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [S3RK](https://github.com/bitcoin/bitcoin/pull/26560#pullrequestreview-1194885937) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26573](https://github.com/bitcoin/bitcoin/pull/26573) (Wallet: don't underestimate the fees when spending a Taproot output by darosior)\n* [#26567](https://github.com/bitcoin/bitcoin/pull/26567) (Wallet: estimate the size of signed inputs using descriptors by darosior)\n* [#26152](https://github.com/bitcoin/bitcoin/pull/26152) (Bump unconfirmed ancestor transactions to target feerate by Xekyo)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-11-23T15:13:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1325231872",
      "id" : 1325231872,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26560",
      "node_id" : "IC_kwDOABII585O_W8A",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1325231872/reactions"
      },
      "updated_at" : "2022-11-28T13:54:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1325231872",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1030669464"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030669464"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 7f6abb39159cd55b6c9193630ca4c3d9ae551be6 \"wallet: bugfix, 'CoinsResult::Erase' is erasing only one output of the set\"\r\n\r\nHow come we need to have `coins_to_remove` and erase the removed coins from it? `coins_to_remove` isn't being used anywhere else so this doesn't seem to be doing anything?",
      "commit_id" : "0fd9be14af28a5c707f2d5be03d252d2b5cb7ad7",
      "created_at" : "2022-11-23T16:39:27Z",
      "diff_hunk" : "@@ -102,15 +102,19 @@ void CoinsResult::Clear() {\n     coins.clear();\n }\n \n-void CoinsResult::Erase(std::set<COutPoint>& preset_coins)\n+void CoinsResult::Erase(const std::set<COutPoint>& outs)\n {\n-    for (auto& it : coins) {\n-        auto& vec = it.second;\n-        auto i = std::find_if(vec.begin(), vec.end(), [&](const COutput &c) { return preset_coins.count(c.outpoint);});\n-        if (i != vec.end()) {\n-            vec.erase(i);\n-            break;\n-        }\n+    std::set<COutPoint> coins_to_remove = outs;\n+    for (auto& [type, vec] : coins) {\n+        auto remove_it = std::remove_if(vec.begin(), vec.end(), [&](const COutput& coin) {\n+            auto it = coins_to_remove.find(coin.outpoint);\n+            if (it == coins_to_remove.end()) return false;\n+\n+            // remove coin\n+            coins_to_remove.erase(it);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1030669464",
      "id" : 1030669464,
      "line" : 114,
      "node_id" : "PRRC_kwDOABII5849bsSY",
      "original_commit_id" : "7f6abb39159cd55b6c9193630ca4c3d9ae551be6",
      "original_line" : 114,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 21,
      "pull_request_review_id" : 1191984507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030669464/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-23T16:39:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030669464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1030884532"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030884532"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's to decrease the search time while moving across the `CoinsResult` vectors.\r\n\r\n`Erase` receives a const set with all the coins that needs to be removed from the `CoinsResult` internal vectors. So, what we do is loop across each coins vector and, for each coin inside them, **we test whether the coin is inside the set of coins provided by the caller**, if it's there, then we update the internal state and return true so `std:.remove_if` does its magic.\r\n(bolded the important part)\r\n\r\nSo, if we remove coins as we find them on the `CoinsResult` vectors from the to_remove set, we will continually search inside a container with less elements up until there is none and we can stop the search earlier.",
      "commit_id" : "0fd9be14af28a5c707f2d5be03d252d2b5cb7ad7",
      "created_at" : "2022-11-23T21:30:33Z",
      "diff_hunk" : "@@ -102,15 +102,19 @@ void CoinsResult::Clear() {\n     coins.clear();\n }\n \n-void CoinsResult::Erase(std::set<COutPoint>& preset_coins)\n+void CoinsResult::Erase(const std::set<COutPoint>& outs)\n {\n-    for (auto& it : coins) {\n-        auto& vec = it.second;\n-        auto i = std::find_if(vec.begin(), vec.end(), [&](const COutput &c) { return preset_coins.count(c.outpoint);});\n-        if (i != vec.end()) {\n-            vec.erase(i);\n-            break;\n-        }\n+    std::set<COutPoint> coins_to_remove = outs;\n+    for (auto& [type, vec] : coins) {\n+        auto remove_it = std::remove_if(vec.begin(), vec.end(), [&](const COutput& coin) {\n+            auto it = coins_to_remove.find(coin.outpoint);\n+            if (it == coins_to_remove.end()) return false;\n+\n+            // remove coin\n+            coins_to_remove.erase(it);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1030884532",
      "id" : 1030884532,
      "in_reply_to_id" : 1030669464,
      "line" : 114,
      "node_id" : "PRRC_kwDOABII5849cgy0",
      "original_commit_id" : "7f6abb39159cd55b6c9193630ca4c3d9ae551be6",
      "original_line" : 114,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 21,
      "pull_request_review_id" : 1192284295,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030884532/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-23T21:30:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030884532",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1030894873"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030894873"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think that's really a useful optimization since `outs` is likely to be very small. If we are concerned about the complexity of `find`, then I think it would be better to use an `unordered_set` rather than erasing after each removal.\r\n\r\nThis isn't really a blocking comment, I just found it a bit confusing.",
      "commit_id" : "0fd9be14af28a5c707f2d5be03d252d2b5cb7ad7",
      "created_at" : "2022-11-23T21:50:56Z",
      "diff_hunk" : "@@ -102,15 +102,19 @@ void CoinsResult::Clear() {\n     coins.clear();\n }\n \n-void CoinsResult::Erase(std::set<COutPoint>& preset_coins)\n+void CoinsResult::Erase(const std::set<COutPoint>& outs)\n {\n-    for (auto& it : coins) {\n-        auto& vec = it.second;\n-        auto i = std::find_if(vec.begin(), vec.end(), [&](const COutput &c) { return preset_coins.count(c.outpoint);});\n-        if (i != vec.end()) {\n-            vec.erase(i);\n-            break;\n-        }\n+    std::set<COutPoint> coins_to_remove = outs;\n+    for (auto& [type, vec] : coins) {\n+        auto remove_it = std::remove_if(vec.begin(), vec.end(), [&](const COutput& coin) {\n+            auto it = coins_to_remove.find(coin.outpoint);\n+            if (it == coins_to_remove.end()) return false;\n+\n+            // remove coin\n+            coins_to_remove.erase(it);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1030894873",
      "id" : 1030894873,
      "in_reply_to_id" : 1030669464,
      "line" : 114,
      "node_id" : "PRRC_kwDOABII5849cjUZ",
      "original_commit_id" : "7f6abb39159cd55b6c9193630ca4c3d9ae551be6",
      "original_line" : 114,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 21,
      "pull_request_review_id" : 1192298629,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030894873/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-23T21:50:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030894873",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1030960317"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030960317"
         }
      },
      "author_association" : "MEMBER",
      "body" : "yeah, an `unordered_set` sounds good too.\r\n\r\nstill, what I wanted to add (and I actually didn't add it for some reason..) is the capability to stop early if the set has no elements. E.g. if the wallet has 100k UTXO inside, the preset inputs set is small, and the coins appear early in the loop: the process could stop right away (no need to keep traversing the entire available coins vector if we already found them).\r\n\r\nbut.. as this is primarily to solve the dangerous bug in v24. Could go ahead with the `unordered_set`, make the code simpler, and leave any optimization for later.",
      "commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "created_at" : "2022-11-24T00:27:15Z",
      "diff_hunk" : "@@ -102,15 +102,19 @@ void CoinsResult::Clear() {\n     coins.clear();\n }\n \n-void CoinsResult::Erase(std::set<COutPoint>& preset_coins)\n+void CoinsResult::Erase(const std::set<COutPoint>& outs)\n {\n-    for (auto& it : coins) {\n-        auto& vec = it.second;\n-        auto i = std::find_if(vec.begin(), vec.end(), [&](const COutput &c) { return preset_coins.count(c.outpoint);});\n-        if (i != vec.end()) {\n-            vec.erase(i);\n-            break;\n-        }\n+    std::set<COutPoint> coins_to_remove = outs;\n+    for (auto& [type, vec] : coins) {\n+        auto remove_it = std::remove_if(vec.begin(), vec.end(), [&](const COutput& coin) {\n+            auto it = coins_to_remove.find(coin.outpoint);\n+            if (it == coins_to_remove.end()) return false;\n+\n+            // remove coin\n+            coins_to_remove.erase(it);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1030960317",
      "id" : 1030960317,
      "in_reply_to_id" : 1030669464,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849czS9",
      "original_commit_id" : "7f6abb39159cd55b6c9193630ca4c3d9ae551be6",
      "original_line" : 114,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1192391348,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030960317/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-24T00:33:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030960317",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1032802753"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032802753"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Is locking here necessary? Can we just fund the wallets with 2 coins instead of 10?",
      "commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "created_at" : "2022-11-26T15:45:22Z",
      "diff_hunk" : "@@ -1200,6 +1201,63 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # Here will confuse the wallet to make it select the\n+        # preset inputs twice during the coin selection process (on v24.0).\n+        #\n+        # Making it think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in fee!\n+\n+        # Create and fund the wallet with 10 UTXO of 5 BTC each\n+        self.nodes[2].createwallet(\"test_preset_inputs_selection\")\n+        wallet = self.nodes[2].get_wallet_rpc(\"test_preset_inputs_selection\")\n+        outputs = {}\n+        for _ in range(10):\n+            outputs[wallet.getnewaddress(address_type=\"bech32\")] = 5\n+        self.nodes[0].sendmany(\"\", outputs)\n+        self.generate(self.nodes[0], 1)\n+\n+        # Select the preset inputs and lock the rest of the coins",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1032802753",
      "id" : 1032802753,
      "line" : 1227,
      "node_id" : "PRRC_kwDOABII5849j1HB",
      "original_commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "original_line" : 1227,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : 35,
      "pull_request_review_id" : 1194885937,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032802753/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-26T17:33:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032802753",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1032807770"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032807770"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Same question here. Do we really need to lock the coins? ",
      "commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "created_at" : "2022-11-26T16:33:35Z",
      "diff_hunk" : "@@ -112,5 +112,38 @@ BOOST_FIXTURE_TEST_CASE(FillInputToWeightTest, BasicTestingSetup)\n     // Note: We don't test the next boundary because of memory allocation constraints.\n }\n \n+BOOST_FIXTURE_TEST_CASE(wallet_duplicated_preset_inputs_test, TestChain100Setup)\n+{\n+    // Verifies that the wallet's Coin Selection process does not include pre-selected inputs twice in a transaction.\n+    for (int i = 0; i < 10; i++) CreateAndProcessBlock({}, GetScriptForRawPubKey(coinbaseKey.GetPubKey()));\n+    auto wallet = CreateSyncedWallet(*m_node.chain, WITH_LOCK(Assert(m_node.chainman)->GetMutex(), return m_node.chainman->ActiveChain()), m_args, coinbaseKey);\n+\n+    LOCK(wallet->cs_wallet);\n+    auto available_coins = AvailableCoins(*wallet);\n+    std::vector<COutput> coins = available_coins.All();\n+    std::set<COutPoint> preset_inputs = {coins[0].outpoint, coins[1].outpoint};\n+    // Lock the rest of the coins",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1032807770",
      "id" : 1032807770,
      "line" : 125,
      "node_id" : "PRRC_kwDOABII5849j2Va",
      "original_commit_id" : "d8e195bc3d1ec46b874e70374b0d68698d442683",
      "original_line" : 125,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/test/spend_tests.cpp",
      "position" : 14,
      "pull_request_review_id" : 1194885937,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032807770/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-26T17:33:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032807770",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1032808028"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032808028"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I'm not sure having second test provides enough extra value. I'd rather keep one, but ultimately up to you.",
      "commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "created_at" : "2022-11-26T16:36:00Z",
      "diff_hunk" : "@@ -112,5 +112,38 @@ BOOST_FIXTURE_TEST_CASE(FillInputToWeightTest, BasicTestingSetup)\n     // Note: We don't test the next boundary because of memory allocation constraints.\n }\n \n+BOOST_FIXTURE_TEST_CASE(wallet_duplicated_preset_inputs_test, TestChain100Setup)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1032808028",
      "id" : 1032808028,
      "line" : 115,
      "node_id" : "PRRC_kwDOABII5849j2Zc",
      "original_commit_id" : "d8e195bc3d1ec46b874e70374b0d68698d442683",
      "original_line" : 115,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/test/spend_tests.cpp",
      "position" : 4,
      "pull_request_review_id" : 1194885937,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032808028/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-26T17:33:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032808028",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1032811592"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032811592"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think it's correct to fallback on `available_coins.total_amount` when we don't do SFFO.\r\n\r\nwith SFFO we must have effective amount, if we don't - something went wrong.",
      "commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "created_at" : "2022-11-26T17:09:24Z",
      "diff_hunk" : "@@ -575,6 +584,14 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& a\n         return result;\n     }\n \n+    // Return early if we cannot cover the target with the wallet's UTXO.\n+    // We use the total effective value if we are not subtracting fee from outputs and 'available_coins' contains the data.\n+    CAmount available_coins_total_amount = coin_selection_params.m_subtract_fee_outputs ? available_coins.total_amount :\n+            (available_coins.total_effective_amount.has_value() ? *available_coins.total_effective_amount : available_coins.total_amount);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1032811592",
      "id" : 1032811592,
      "line" : 590,
      "node_id" : "PRRC_kwDOABII5849j3RI",
      "original_commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "original_line" : 590,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 43,
      "pull_request_review_id" : 1194885937,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032811592/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-26T17:33:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032811592",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1032813025"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032813025"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "note to self: not a huge fan of how this looks like with `optional`. The code would look much simpler if we can just always pass a fee rate to `AvailableCoins` (we can set it 0 by default). Can't make my mind which way is better...",
      "commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "created_at" : "2022-11-26T17:24:38Z",
      "diff_hunk" : "@@ -51,8 +51,10 @@ struct CoinsResult {\n     void Shuffle(FastRandomContext& rng_fast);\n     void Add(OutputType type, const COutput& out);\n \n-    /** Sum of all available coins */\n+    /** Sum of all available coins raw value */\n     CAmount total_amount{0};\n+    /** Sum of all available coins effective value (each output value minus fees required to spend it) */\n+    std::optional<CAmount> total_effective_amount{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1032813025",
      "id" : 1032813025,
      "line" : 57,
      "node_id" : "PRRC_kwDOABII5849j3nh",
      "original_commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "original_line" : 57,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : 8,
      "pull_request_review_id" : 1194885937,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032813025/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-26T17:33:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032813025",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Asking here instead of in the backport: is this only in v24 or also earlier versions?",
      "created_at" : "2022-11-28T13:54:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1329146984",
      "id" : 1329146984,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26560",
      "node_id" : "IC_kwDOABII585POSxo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329146984/reactions"
      },
      "updated_at" : "2022-11-28T13:54:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329146984",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Asking here instead of in the backport: is this only in v24 or also earlier versions?\r\n\r\nMy understanding is only v24.x. Seems like the buggy behaviour was introduced in #24584 + #25734?",
      "created_at" : "2022-11-28T14:03:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1329161687",
      "id" : 1329161687,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26560",
      "node_id" : "IC_kwDOABII585POWXX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329161687/reactions"
      },
      "updated_at" : "2022-11-28T14:03:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329161687",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Asking here instead of in the backport: is this only in v24 or also earlier versions?\r\n\r\nYeah. @Sjors only for v24. The dangerous bug was introduced in #25734 which is only on v24, and after branching off, we merged #25685 which fixed it without noticing it.",
      "created_at" : "2022-11-28T14:04:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1329163697",
      "id" : 1329163697,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26560",
      "node_id" : "IC_kwDOABII585POW2x",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329163697/reactions"
      },
      "updated_at" : "2022-11-28T14:28:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329163697",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033634941"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033634941"
         }
      },
      "author_association" : "MEMBER",
      "body" : "let me double check it, IIRC I added it to make the wallet have enough funds in case we have an early balance check in the flow.",
      "commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "created_at" : "2022-11-28T14:46:30Z",
      "diff_hunk" : "@@ -1200,6 +1201,63 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # Here will confuse the wallet to make it select the\n+        # preset inputs twice during the coin selection process (on v24.0).\n+        #\n+        # Making it think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in fee!\n+\n+        # Create and fund the wallet with 10 UTXO of 5 BTC each\n+        self.nodes[2].createwallet(\"test_preset_inputs_selection\")\n+        wallet = self.nodes[2].get_wallet_rpc(\"test_preset_inputs_selection\")\n+        outputs = {}\n+        for _ in range(10):\n+            outputs[wallet.getnewaddress(address_type=\"bech32\")] = 5\n+        self.nodes[0].sendmany(\"\", outputs)\n+        self.generate(self.nodes[0], 1)\n+\n+        # Select the preset inputs and lock the rest of the coins",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033634941",
      "id" : 1033634941,
      "in_reply_to_id" : 1032802753,
      "line" : 1227,
      "node_id" : "PRRC_kwDOABII5849nAR9",
      "original_commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "original_line" : 1227,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : 35,
      "pull_request_review_id" : 1195944592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033634941/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-28T14:46:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033634941",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033644437"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033644437"
         }
      },
      "author_association" : "MEMBER",
      "body" : "yeah. I almost remove it but.. ended up leaving because (1) the severity of the bug and (2) because it's easier to debug and assert that the code is failing where is supposed to be failing (in the functional test case, as we use the `send` RPC command, we do have other stuff involved).\r\n\r\nI'm fine either way, if this still doesn't convince you and more people don't see it useful, can remove it for sure.",
      "commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "created_at" : "2022-11-28T14:53:59Z",
      "diff_hunk" : "@@ -112,5 +112,38 @@ BOOST_FIXTURE_TEST_CASE(FillInputToWeightTest, BasicTestingSetup)\n     // Note: We don't test the next boundary because of memory allocation constraints.\n }\n \n+BOOST_FIXTURE_TEST_CASE(wallet_duplicated_preset_inputs_test, TestChain100Setup)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033644437",
      "id" : 1033644437,
      "in_reply_to_id" : 1032808028,
      "line" : 115,
      "node_id" : "PRRC_kwDOABII5849nCmV",
      "original_commit_id" : "d8e195bc3d1ec46b874e70374b0d68698d442683",
      "original_line" : 115,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/test/spend_tests.cpp",
      "position" : 4,
      "pull_request_review_id" : 1195958121,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033644437/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-28T14:53:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033644437",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033752353"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033752353"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmm, need a bit of context here.\r\nGuess that you are saying that because, with SFFO, the wallet needs to select a group of UTXOs that will be able to pay for themselves? So, the entire coin selection relies on the effective value existence so.. if it's not there there is a bug?",
      "commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "created_at" : "2022-11-28T16:18:46Z",
      "diff_hunk" : "@@ -575,6 +584,14 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& a\n         return result;\n     }\n \n+    // Return early if we cannot cover the target with the wallet's UTXO.\n+    // We use the total effective value if we are not subtracting fee from outputs and 'available_coins' contains the data.\n+    CAmount available_coins_total_amount = coin_selection_params.m_subtract_fee_outputs ? available_coins.total_amount :\n+            (available_coins.total_effective_amount.has_value() ? *available_coins.total_effective_amount : available_coins.total_amount);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033752353",
      "id" : 1033752353,
      "in_reply_to_id" : 1032811592,
      "line" : 590,
      "node_id" : "PRRC_kwDOABII5849nc8h",
      "original_commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "original_line" : 590,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 43,
      "pull_request_review_id" : 1196113714,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033752353/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-28T16:18:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033752353",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033815954"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033815954"
         }
      },
      "author_association" : "MEMBER",
      "body" : "By the time we get here, if `total_effective_amount` doesn't have a value, that means that none of the UTXOs in this wallet were solvable, so we can't do any coin selection here in that case. So I think it would be better to always return early in that case.",
      "commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "created_at" : "2022-11-28T17:08:23Z",
      "diff_hunk" : "@@ -575,6 +584,14 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& a\n         return result;\n     }\n \n+    // Return early if we cannot cover the target with the wallet's UTXO.\n+    // We use the total effective value if we are not subtracting fee from outputs and 'available_coins' contains the data.\n+    CAmount available_coins_total_amount = coin_selection_params.m_subtract_fee_outputs ? available_coins.total_amount :\n+            (available_coins.total_effective_amount.has_value() ? *available_coins.total_effective_amount : available_coins.total_amount);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033815954",
      "id" : 1033815954,
      "in_reply_to_id" : 1032811592,
      "line" : 590,
      "node_id" : "PRRC_kwDOABII5849nseS",
      "original_commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "original_line" : 590,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 43,
      "pull_request_review_id" : 1196209044,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033815954/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-28T17:08:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033815954",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033924509"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033924509"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> By the time we get here, if total_effective_amount doesn't have a value, that means that none of the UTXOs in this wallet were solvable, so we can't do any coin selection here in that case\r\n\r\nHmm, code wise, that doesn't seems to be what is happening.\r\n\r\nAt the `COutput` constructor, if the coin isn't solvable then `effective_value` will be equal to the nominal output value. So it will always have an effective value during the tx creation process.\r\n\r\nThe only way that a `COutput` has no `effective_value` is when we don't provide the feerate param to `AvailableCoins` (which happens on all the flows that uses `AvailableCoins` that are not part of the tx creation process).",
      "commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "created_at" : "2022-11-28T18:43:04Z",
      "diff_hunk" : "@@ -575,6 +584,14 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& a\n         return result;\n     }\n \n+    // Return early if we cannot cover the target with the wallet's UTXO.\n+    // We use the total effective value if we are not subtracting fee from outputs and 'available_coins' contains the data.\n+    CAmount available_coins_total_amount = coin_selection_params.m_subtract_fee_outputs ? available_coins.total_amount :\n+            (available_coins.total_effective_amount.has_value() ? *available_coins.total_effective_amount : available_coins.total_amount);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033924509",
      "id" : 1033924509,
      "in_reply_to_id" : 1032811592,
      "line" : 590,
      "node_id" : "PRRC_kwDOABII5849oG-d",
      "original_commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "original_line" : 590,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 43,
      "pull_request_review_id" : 1196363778,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033924509/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-28T18:43:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033924509",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033935017"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033935017"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, hmm, I thought it checked `input_bytes` as well.\r\n\r\nIn that case, `total_effective_amount` should always have a value if we have any coins. If it isn't set, then we don't have any coins and we can still return early.",
      "commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "created_at" : "2022-11-28T18:54:30Z",
      "diff_hunk" : "@@ -575,6 +584,14 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& a\n         return result;\n     }\n \n+    // Return early if we cannot cover the target with the wallet's UTXO.\n+    // We use the total effective value if we are not subtracting fee from outputs and 'available_coins' contains the data.\n+    CAmount available_coins_total_amount = coin_selection_params.m_subtract_fee_outputs ? available_coins.total_amount :\n+            (available_coins.total_effective_amount.has_value() ? *available_coins.total_effective_amount : available_coins.total_amount);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033935017",
      "id" : 1033935017,
      "in_reply_to_id" : 1032811592,
      "line" : 590,
      "node_id" : "PRRC_kwDOABII5849oJip",
      "original_commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "original_line" : 590,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 43,
      "pull_request_review_id" : 1196378617,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033935017/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-28T18:54:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033935017",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033936642"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033936642"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I would agree on always passing the fee rate to `AvailableCoins` if we were using the function only for the tx creation process, but we are using the function for other processes that don't require to calculate the effective value nor the output spending fee.\r\n\r\nWe definitely can improve it but I don't think that this PR is the best place to do it.\r\n\r\nSide from that, from my side, have some plans to re-write the `AvailableCoins` functionality differently post #25806 (because, after it, will be able to continually connect outputs to existent output groups, outside of the coin selection process which is currently forcing us to do the whole calculation on-demand).",
      "commit_id" : "1b14bd7ac77027351a1e5b3ef21fb2d1de659efd",
      "created_at" : "2022-11-28T18:56:14Z",
      "diff_hunk" : "@@ -51,8 +51,10 @@ struct CoinsResult {\n     void Shuffle(FastRandomContext& rng_fast);\n     void Add(OutputType type, const COutput& out);\n \n-    /** Sum of all available coins */\n+    /** Sum of all available coins raw value */\n     CAmount total_amount{0};\n+    /** Sum of all available coins effective value (each output value minus fees required to spend it) */\n+    std::optional<CAmount> total_effective_amount{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033936642",
      "id" : 1033936642,
      "in_reply_to_id" : 1032813025,
      "line" : 57,
      "node_id" : "PRRC_kwDOABII5849oJ8C",
      "original_commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "original_line" : 57,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : 13,
      "pull_request_review_id" : 1196380793,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033936642/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-28T19:01:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033936642",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033971497"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033971497"
         }
      },
      "author_association" : "MEMBER",
      "body" : "All good, just removed it. Seems that I was just over-thinking it.",
      "commit_id" : "1b14bd7ac77027351a1e5b3ef21fb2d1de659efd",
      "created_at" : "2022-11-28T19:32:58Z",
      "diff_hunk" : "@@ -1200,6 +1201,63 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # Here will confuse the wallet to make it select the\n+        # preset inputs twice during the coin selection process (on v24.0).\n+        #\n+        # Making it think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in fee!\n+\n+        # Create and fund the wallet with 10 UTXO of 5 BTC each\n+        self.nodes[2].createwallet(\"test_preset_inputs_selection\")\n+        wallet = self.nodes[2].get_wallet_rpc(\"test_preset_inputs_selection\")\n+        outputs = {}\n+        for _ in range(10):\n+            outputs[wallet.getnewaddress(address_type=\"bech32\")] = 5\n+        self.nodes[0].sendmany(\"\", outputs)\n+        self.generate(self.nodes[0], 1)\n+\n+        # Select the preset inputs and lock the rest of the coins",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033971497",
      "id" : 1033971497,
      "in_reply_to_id" : 1032802753,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849oScp",
      "original_commit_id" : "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "original_line" : 1227,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : null,
      "pull_request_review_id" : 1196436608,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033971497/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-28T19:32:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033971497",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033971966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033971966"
         }
      },
      "author_association" : "MEMBER",
      "body" : "not really, removed it. Thanks",
      "commit_id" : "1b14bd7ac77027351a1e5b3ef21fb2d1de659efd",
      "created_at" : "2022-11-28T19:33:26Z",
      "diff_hunk" : "@@ -112,5 +112,38 @@ BOOST_FIXTURE_TEST_CASE(FillInputToWeightTest, BasicTestingSetup)\n     // Note: We don't test the next boundary because of memory allocation constraints.\n }\n \n+BOOST_FIXTURE_TEST_CASE(wallet_duplicated_preset_inputs_test, TestChain100Setup)\n+{\n+    // Verifies that the wallet's Coin Selection process does not include pre-selected inputs twice in a transaction.\n+    for (int i = 0; i < 10; i++) CreateAndProcessBlock({}, GetScriptForRawPubKey(coinbaseKey.GetPubKey()));\n+    auto wallet = CreateSyncedWallet(*m_node.chain, WITH_LOCK(Assert(m_node.chainman)->GetMutex(), return m_node.chainman->ActiveChain()), m_args, coinbaseKey);\n+\n+    LOCK(wallet->cs_wallet);\n+    auto available_coins = AvailableCoins(*wallet);\n+    std::vector<COutput> coins = available_coins.All();\n+    std::set<COutPoint> preset_inputs = {coins[0].outpoint, coins[1].outpoint};\n+    // Lock the rest of the coins",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033971966",
      "id" : 1033971966,
      "in_reply_to_id" : 1032807770,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849oSj-",
      "original_commit_id" : "d8e195bc3d1ec46b874e70374b0d68698d442683",
      "original_line" : 125,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/test/spend_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1196437167,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033971966/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-28T19:33:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033971966",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Feedback tackled, thanks @S3RK and @achow101.\r\n\r\nChanges:\r\n1) In the tests, removed the unneeded coins lock.\r\n2) Now `SelectCoins` returns early if the wallet's available coins `total_effective_amount` is not available (it does not fallback to use the raw total amount anymore).",
      "created_at" : "2022-11-28T19:48:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1329665367",
      "id" : 1329665367,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26560",
      "node_id" : "IC_kwDOABII585PQRVX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329665367/reactions"
      },
      "updated_at" : "2022-11-28T19:48:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329665367",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think probably `CoinsResult::coins` should be a `std::map<OutputType, std::unordered_set<COutput>>` instead of [map of] vectors. It's too strange that we could end up with the same output in there twice. Maybe even an assert failure if we try to add the same ones twice?",
      "created_at" : "2022-11-29T04:10:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1330050199",
      "id" : 1330050199,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26560",
      "node_id" : "IC_kwDOABII585PRvSX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1330050199/reactions"
      },
      "updated_at" : "2022-11-29T04:10:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1330050199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   }
]
