[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [glozow](https://github.com/bitcoin/bitcoin/pull/26551#pullrequestreview-1195591526), [naumenkogs](https://github.com/bitcoin/bitcoin/pull/26551#issuecomment-1361131400) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n",
      "created_at" : "2022-11-21T19:44:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#issuecomment-1322561699",
      "id" : 1322561699,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26551",
      "node_id" : "IC_kwDOABII585O1LCj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1322561699/reactions"
      },
      "updated_at" : "2022-12-21T10:25:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1322561699",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2022-11-28T13:09:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#issuecomment-1329064833",
      "id" : 1329064833,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26551",
      "node_id" : "IC_kwDOABII585PN-uB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329064833/reactions"
      },
      "updated_at" : "2022-11-28T13:09:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329064833",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Some previous discussion at https://github.com/bitcoin/bitcoin/pull/21527#discussion_r601221165",
      "created_at" : "2022-12-08T03:25:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#issuecomment-1341936477",
      "id" : 1341936477,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26551",
      "node_id" : "IC_kwDOABII585P_FNd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1341936477/reactions"
      },
      "updated_at" : "2022-12-08T03:25:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1341936477",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1054210259"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054210259"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should become AssertLockNotHeld? :)",
      "commit_id" : "0a32d4f3c4d8b57690036b0447837afe5f9a0eb3",
      "created_at" : "2022-12-21T10:12:17Z",
      "diff_hunk" : "@@ -2889,7 +2889,7 @@ void PeerManagerImpl::ProcessHeadersMessage(CNode& pfrom, Peer& peer,\n bool PeerManagerImpl::ProcessOrphanTx(Peer& peer)\n {\n     AssertLockHeld(g_msgproc_mutex);\n-    AssertLockHeld(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1054210259",
      "id" : 1054210259,
      "line" : 2892,
      "node_id" : "PRRC_kwDOABII584-1fjT",
      "original_commit_id" : "75b6f8213692f7db5435cdcf15392466dcb92ec9",
      "original_line" : 2892,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 13,
      "pull_request_review_id" : 1225815078,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054210259/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-21T10:12:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054210259",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1054223525"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054223525"
         }
      },
      "author_association" : "MEMBER",
      "body" : "1. I think it should say \"Creates more work if\", as it's less ambiguous (I actually spent time figuring the difference out...).\r\n2. So now `bool fMoreNodeWork = m_msgproc->ProcessMessages(pnode, flagInterruptMsgProc);` should be renamed to `may_have_more_work` right?\r\n",
      "commit_id" : "0a32d4f3c4d8b57690036b0447837afe5f9a0eb3",
      "created_at" : "2022-12-21T10:25:27Z",
      "diff_hunk" : "@@ -585,10 +585,10 @@ class PeerManagerImpl final : public PeerManager\n      * Reconsider orphan transactions after a parent has been accepted to the mempool.\n      *\n      * @peer[in]  peer     The peer whose orphan transactions we will reconsider. Generally only one\n-     *                     orphan will be reconsidered on each call of this function. This set\n-     *                     may be added to if accepting an orphan causes its children to be\n+     *                     orphan will be reconsidered on each call of this function. May",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1054223525",
      "id" : 1054223525,
      "line" : 588,
      "node_id" : "PRRC_kwDOABII584-1iyl",
      "original_commit_id" : "0a32d4f3c4d8b57690036b0447837afe5f9a0eb3",
      "original_line" : 588,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 6,
      "pull_request_review_id" : 1225834248,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054223525/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-21T10:25:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054223525",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2022-12-21T10:25:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#issuecomment-1361131400",
      "id" : 1361131400,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26551",
      "node_id" : "IC_kwDOABII585RITeI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1361131400/reactions"
      },
      "updated_at" : "2022-12-21T10:25:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1361131400",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1054345381"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054345381"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Seems more reasonable to continue to allow invoking `ProcessOrphanTx` with `cs_main` held, even though we could forbid it. (Before the \"only process orphans before messages\" commit, `ProcessOrphanTx()` was called from `ProcessMessage()` with `cs_main` held)",
      "commit_id" : "0a32d4f3c4d8b57690036b0447837afe5f9a0eb3",
      "created_at" : "2022-12-21T12:43:22Z",
      "diff_hunk" : "@@ -2889,7 +2889,7 @@ void PeerManagerImpl::ProcessHeadersMessage(CNode& pfrom, Peer& peer,\n bool PeerManagerImpl::ProcessOrphanTx(Peer& peer)\n {\n     AssertLockHeld(g_msgproc_mutex);\n-    AssertLockHeld(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1054345381",
      "id" : 1054345381,
      "in_reply_to_id" : 1054210259,
      "line" : 2892,
      "node_id" : "PRRC_kwDOABII584-2Ail",
      "original_commit_id" : "75b6f8213692f7db5435cdcf15392466dcb92ec9",
      "original_line" : 2892,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 13,
      "pull_request_review_id" : 1226016378,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054345381/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-21T12:43:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1054345381",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1055459343"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055459343"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think this PR changes whether `fMoreNodeWork` should be renamed -- the bool should have the same properties both before and after this PR.\r\n\r\nBut... I think its current behaviour is technically not quite right? If we process a TX message in `ProcessMessage` now, we'll set `fMoreWork = true` only when `m_getdata_requests` has entries, but I think we should also be doing it if the peer's orphanage work queue isn't empty, as `ProcessMessage` may have added to it. I think this is technically a bug introduced in #15644 -- there should have been an `if (!pfrom->orphan_work_set.empty()) fMoreWork = true;`  added after the `ProcessMessage()` call, as well as after the `// this maintains the order of responses` comment.\r\n\r\nThe only result of the bug is that when a parent comes in, processing its orphaned children will be delayed by 100ms rather than occurring essentially immediately.",
      "commit_id" : "8f9d9ab943c291bdd77ed980adfe14c3a23e04c2",
      "created_at" : "2022-12-22T13:29:02Z",
      "diff_hunk" : "@@ -585,10 +585,10 @@ class PeerManagerImpl final : public PeerManager\n      * Reconsider orphan transactions after a parent has been accepted to the mempool.\n      *\n      * @peer[in]  peer     The peer whose orphan transactions we will reconsider. Generally only one\n-     *                     orphan will be reconsidered on each call of this function. This set\n-     *                     may be added to if accepting an orphan causes its children to be\n+     *                     orphan will be reconsidered on each call of this function. May",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1055459343",
      "id" : 1055459343,
      "in_reply_to_id" : 1054223525,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-6QgP",
      "original_commit_id" : "0a32d4f3c4d8b57690036b0447837afe5f9a0eb3",
      "original_line" : 588,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1227668440,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055459343/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-22T13:29:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055459343",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1055527867"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055527867"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe it would be better to write:\r\n\r\n```c++\r\nwhile (true) {\r\n    bool all_nodes_finished_processing = true;\r\n    for (pnode : nodes) {\r\n        if (m_msgproc->ProcessMessages(pnode)) all_nodes_finished_processing = false;\r\n        m_msgproc->SendMessages(pnode);\r\n    }\r\n    if (all_nodes_finished_processing) wait_for(100ms);\r\n}\r\n```\r\n\r\nThe idea (as I understand it) is just that `ProcessMessages()` returns true if it does some substantial work and exits early, without checking everything. If that's the case for any peer, then it doesn't wait before looping through all peers again. If `ProcessMessages()` completed for all peers, whether it did work or not, then it is okay to sleep briefly before looping over everything again.",
      "commit_id" : "8f9d9ab943c291bdd77ed980adfe14c3a23e04c2",
      "created_at" : "2022-12-22T14:36:44Z",
      "diff_hunk" : "@@ -585,10 +585,10 @@ class PeerManagerImpl final : public PeerManager\n      * Reconsider orphan transactions after a parent has been accepted to the mempool.\n      *\n      * @peer[in]  peer     The peer whose orphan transactions we will reconsider. Generally only one\n-     *                     orphan will be reconsidered on each call of this function. This set\n-     *                     may be added to if accepting an orphan causes its children to be\n+     *                     orphan will be reconsidered on each call of this function. May",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1055527867",
      "id" : 1055527867,
      "in_reply_to_id" : 1054223525,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-6hO7",
      "original_commit_id" : "0a32d4f3c4d8b57690036b0447837afe5f9a0eb3",
      "original_line" : 588,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1227770695,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055527867/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-22T14:36:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055527867",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1055956153"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055956153"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This doesn't work after the other changes in this PR -- you might be creating more work for some other peer, so should be checking if any peers have txs to reconsider, and only doing this once after looping through all the peers.",
      "commit_id" : "8f9d9ab943c291bdd77ed980adfe14c3a23e04c2",
      "created_at" : "2022-12-23T00:44:02Z",
      "diff_hunk" : "@@ -4907,6 +4907,7 @@ bool PeerManagerImpl::ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt\n             LOCK(peer->m_getdata_requests_mutex);\n             if (!peer->m_getdata_requests.empty()) fMoreWork = true;\n         }\n+        if (m_orphanage.HaveTxToReconsider(peer->m_id)) fMoreWork = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1055956153",
      "id" : 1055956153,
      "line" : 4905,
      "node_id" : "PRRC_kwDOABII584-8Jy5",
      "original_commit_id" : "10de619ba2bc48de6816b3940509576c575e9ff3",
      "original_line" : 4910,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 4,
      "pull_request_review_id" : 1228417281,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055956153/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-23T00:44:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055956153",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1056178024"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1056178024"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think you are right. Let's try applying these changes and see whether everything makes sense once again.\r\n\r\nPart of my confusion is that it's unclear whether `has_more_work` applies to a given peer, or to all peers... That variable rename could help. (`peer_has_more_work` vs `node_has_more_work` or something.)",
      "commit_id" : "8f9d9ab943c291bdd77ed980adfe14c3a23e04c2",
      "created_at" : "2022-12-23T09:30:09Z",
      "diff_hunk" : "@@ -585,10 +585,10 @@ class PeerManagerImpl final : public PeerManager\n      * Reconsider orphan transactions after a parent has been accepted to the mempool.\n      *\n      * @peer[in]  peer     The peer whose orphan transactions we will reconsider. Generally only one\n-     *                     orphan will be reconsidered on each call of this function. This set\n-     *                     may be added to if accepting an orphan causes its children to be\n+     *                     orphan will be reconsidered on each call of this function. May",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26551#discussion_r1056178024",
      "id" : 1056178024,
      "in_reply_to_id" : 1054223525,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-8_9o",
      "original_commit_id" : "0a32d4f3c4d8b57690036b0447837afe5f9a0eb3",
      "original_line" : 588,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1228729197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26551",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1056178024/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-23T09:30:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1056178024",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   }
]
