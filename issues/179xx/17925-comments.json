[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17925#discussion_r366586660"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17925"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366586660"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't see initializations for these variables anywhere?",
      "commit_id" : "bd5a02692853f7240a4fdc593d7d0123d7916e45",
      "created_at" : "2020-01-14T21:40:24Z",
      "diff_hunk" : "@@ -453,6 +454,8 @@ class CTxMemPool\n     mutable int64_t lastRollingFeeUpdate;\n     mutable bool blockSinceLastRollingFeeBump;\n     mutable double rollingMinimumFeeRate; //!< minimum fee to get into the pool, decreases exponentially\n+    mutable uint64_t m_epoch;\n+    mutable bool has_epoch_guard;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17925#discussion_r366586660",
      "id" : 366586660,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU4NjY2MA==",
      "original_commit_id" : "d63d1f3714d805574e23ca49402ed9a75691f0b3",
      "original_position" : 13,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 342856863,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17925",
      "updated_at" : "2020-01-15T03:30:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366586660",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17925#discussion_r366591661"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17925"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366591661"
         }
      },
      "author_association" : "MEMBER",
      "body" : "A bit confusing to have this comment (about a function) right before a class definition, I'm guessing it is leftover from something else (or should be moved a few lines down). \r\n\r\nActually I think it'd make sense to explain here a little bit about what these epochs are and why/how to use them?  (Also, as this would be the first introduction of epochs in the code, it'd be helpful for reviewers of the future PRs that will use it in more places to be able to remember/understand what this construction is.)  Perhaps something like:\r\n\r\n```\r\nEpochGuard: RAII-style guard for using epoch-based graph traversal algorithms\r\nWhen walking ancestors or descendants, we generally want to avoid visiting the \r\nsame transactions twice. In some places we use std::set (or setEntries) to deduplicate\r\n what we visit, but we can do (algorithmically) better by using a counter (\"epoch\") that \r\nwe set on each transaction and comparing against a global epoch to track whether \r\nwe've visited something already during a calculation.\r\n```\r\nOr something like that...",
      "commit_id" : "bd5a02692853f7240a4fdc593d7d0123d7916e45",
      "created_at" : "2020-01-14T21:52:02Z",
      "diff_hunk" : "@@ -736,6 +739,34 @@ class CTxMemPool\n      *  removal.\n      */\n     void removeUnchecked(txiter entry, MemPoolRemovalReason reason) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+public:\n+    // This function mutates mutable state!",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17925#discussion_r366591661",
      "id" : 366591661,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU5MTY2MQ==",
      "original_commit_id" : "d63d1f3714d805574e23ca49402ed9a75691f0b3",
      "original_position" : 22,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 342856863,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17925",
      "updated_at" : "2020-01-15T03:30:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366591661",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#17786](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17786.html) (refactor: Nuke policy/fees->mempool circular dependencies by hebasto)\n* [#16910](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16910.html) (wallet: reduce loading time by using unordered maps by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-01-14T22:27:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17925#issuecomment-574403928",
      "id" : 574403928,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17925",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NDQwMzkyOA==",
      "updated_at" : "2020-01-15T07:34:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/574403928",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17925#discussion_r366682083"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17925"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366682083"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "great comment; rewrote it slightly to a format I think is more clear & also to emphasize that replacement with epochs is ongoing work :)",
      "commit_id" : "bd5a02692853f7240a4fdc593d7d0123d7916e45",
      "created_at" : "2020-01-15T03:31:01Z",
      "diff_hunk" : "@@ -736,6 +739,34 @@ class CTxMemPool\n      *  removal.\n      */\n     void removeUnchecked(txiter entry, MemPoolRemovalReason reason) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+public:\n+    // This function mutates mutable state!",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17925#discussion_r366682083",
      "id" : 366682083,
      "in_reply_to_id" : 366591661,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY4MjA4Mw==",
      "original_commit_id" : "d63d1f3714d805574e23ca49402ed9a75691f0b3",
      "original_position" : 22,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 342972129,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17925",
      "updated_at" : "2020-01-15T03:31:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366682083",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't know what's up with the appveyor build but I think this code is correct, it passes all tests for me locally.  \r\n\r\nAs a sanity check, I verified that this code does give a speedup in a simple scenario where it would be expected to improve things: create a transaction with 2000 outputs that is confirmed in a block; then spend each of those outputs in a separate transaction in the mempool; then disconnect the block and measure the time spent in UpdateTransactionsFromBlock (which must visit each of those 2000 children).  I observed a roughly 12% improvement in runtime in this simple test.\r\n\r\nACK bd5a02692853f7240a4fdc593d7d0123d7916e45",
      "created_at" : "2020-01-16T15:32:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17925#issuecomment-575206318",
      "id" : 575206318,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17925",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NTIwNjMxOA==",
      "updated_at" : "2020-01-16T15:32:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/575206318",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   }
]
