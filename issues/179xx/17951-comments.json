[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#17477](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17477.html) (Remove the mempool's NotifyEntryAdded and NotifyEntryRemoved signals by jnewbery)\n* [#15606](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15606.html) ([experimental] UTXO snapshots by jamesob)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-01-17T17:28:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17951#issuecomment-575720638",
      "id" : 575720638,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17951",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NTcyMDYzOA==",
      "updated_at" : "2020-01-17T17:28:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/575720638",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17951#discussion_r368078174"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/368078174"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I presume this makes some kind of doc tools unhappy cause they will add docs to the cs and not the var.",
      "commit_id" : "1e9697bed83332f6aa1d2579dc7638fdb4785477",
      "created_at" : "2020-01-17T18:36:30Z",
      "diff_hunk" : "@@ -148,6 +148,14 @@ namespace {\n     std::unique_ptr<CRollingBloomFilter> recentRejects GUARDED_BY(cs_main);\n     uint256 hashRecentRejectsChainTip GUARDED_BY(cs_main);\n \n+    /**\n+     * Filter for transactions that have been recently confirmed.\n+     * We use this to avoid requesting transactions that have already been\n+     * confirnmed.\n+     */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17951#discussion_r368078174",
      "id" : 368078174,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODA3ODE3NA==",
      "original_commit_id" : "1e9697bed83332f6aa1d2579dc7638fdb4785477",
      "original_position" : 8,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 344765847,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17951",
      "updated_at" : "2020-01-17T18:59:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/368078174",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17951#discussion_r368246927"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/368246927"
         }
      },
      "author_association" : "NONE",
      "body" : "should the parameters to the bloom filter be tunnable with commandline args?",
      "commit_id" : "1e9697bed83332f6aa1d2579dc7638fdb4785477",
      "created_at" : "2020-01-18T20:30:01Z",
      "diff_hunk" : "@@ -1115,6 +1123,7 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn, BanMan* banman, CS\n {\n     // Initialize global variables that cannot be constructed at startup.\n     recentRejects.reset(new CRollingBloomFilter(120000, 0.000001));\n+    recent_confirmed_transactions.reset(new CRollingBloomFilter(24000, 0.000001));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17951#discussion_r368246927",
      "id" : 368246927,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI0NjkyNw==",
      "original_commit_id" : "1e9697bed83332f6aa1d2579dc7638fdb4785477",
      "original_position" : 19,
      "path" : "src/net_processing.cpp",
      "position" : 19,
      "pull_request_review_id" : 344961255,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17951",
      "updated_at" : "2020-01-18T20:33:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/368246927",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1986950?v=4",
         "events_url" : "https://api.github.com/users/paymog/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paymog/followers",
         "following_url" : "https://api.github.com/users/paymog/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paymog/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paymog",
         "id" : 1986950,
         "login" : "paymog",
         "node_id" : "MDQ6VXNlcjE5ODY5NTA=",
         "organizations_url" : "https://api.github.com/users/paymog/orgs",
         "received_events_url" : "https://api.github.com/users/paymog/received_events",
         "repos_url" : "https://api.github.com/users/paymog/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paymog/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paymog/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paymog"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17951#discussion_r368255598"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/368255598"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I can't imagine why anyone would need to customize this parameter (it's not like we offered the ability to customize how many outputs we'd check in the cache, or the ability to customize the recentRejects filter).",
      "commit_id" : "1e9697bed83332f6aa1d2579dc7638fdb4785477",
      "created_at" : "2020-01-19T00:01:52Z",
      "diff_hunk" : "@@ -1115,6 +1123,7 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn, BanMan* banman, CS\n {\n     // Initialize global variables that cannot be constructed at startup.\n     recentRejects.reset(new CRollingBloomFilter(120000, 0.000001));\n+    recent_confirmed_transactions.reset(new CRollingBloomFilter(24000, 0.000001));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17951#discussion_r368255598",
      "id" : 368255598,
      "in_reply_to_id" : 368246927,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI1NTU5OA==",
      "original_commit_id" : "1e9697bed83332f6aa1d2579dc7638fdb4785477",
      "original_position" : 19,
      "path" : "src/net_processing.cpp",
      "position" : 19,
      "pull_request_review_id" : 344968325,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17951",
      "updated_at" : "2020-01-19T00:01:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/368255598",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17951#discussion_r368259951"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/368259951"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Globals should start with `g_` otherwise it might incorrectly look like they live on the stack (as opposed to the heap)",
      "commit_id" : "1e9697bed83332f6aa1d2579dc7638fdb4785477",
      "created_at" : "2020-01-19T02:10:34Z",
      "diff_hunk" : "@@ -148,6 +148,14 @@ namespace {\n     std::unique_ptr<CRollingBloomFilter> recentRejects GUARDED_BY(cs_main);\n     uint256 hashRecentRejectsChainTip GUARDED_BY(cs_main);\n \n+    /**\n+     * Filter for transactions that have been recently confirmed.\n+     * We use this to avoid requesting transactions that have already been\n+     * confirnmed.\n+     */\n+    RecursiveMutex cs_recent_confirmed_transactions;\n+    std::unique_ptr<CRollingBloomFilter> recent_confirmed_transactions GUARDED_BY(cs_recent_confirmed_transactions);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17951#discussion_r368259951",
      "id" : 368259951,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI1OTk1MQ==",
      "original_commit_id" : "1e9697bed83332f6aa1d2579dc7638fdb4785477",
      "original_position" : 10,
      "path" : "src/net_processing.cpp",
      "position" : 10,
      "pull_request_review_id" : 344971755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17951",
      "updated_at" : "2020-01-19T02:11:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/368259951",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Is clearing when disconnecting necessary? The disconnected transactions are at least considered for re-inclusing into the mempool, so even if they don't make it in, wouldn't it make sense to keep considering them \"known\"?\r\n\r\nI agree that clearing when disconnecting is the safe bet if we're not entirely sure about this.",
      "created_at" : "2020-01-19T15:52:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17951#issuecomment-576018447",
      "id" : 576018447,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17951",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NjAxODQ0Nw==",
      "updated_at" : "2020-01-19T15:52:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576018447",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "A reorg might change MTP and some mempool checks might depend on that time. So if the reorg changes MTP and \"forgets\" to include a tx that was previously included in a block, it is now neither in the chain, nor in the mempool, nor can it be relayed.",
      "created_at" : "2020-01-19T16:37:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17951#issuecomment-576022423",
      "id" : 576022423,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17951",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NjAyMjQyMw==",
      "updated_at" : "2020-01-19T16:37:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576022423",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa Yes I think something like @MarcoFalke's example is right, or even for a simple example of something that is added back to the mempool as part of the reorg but then evicted when the mempool is trimmed (due to feerate).  Unlike the recentRejects filter which is cleared every block, the recent_confirmed_transactions is (otherwise) never cleared, so something that gets inadvertently stuck in it will interfere with relay for an extended period of time, depending on the size of the filter.\r\n\r\nIt's worth noting that if there is a false positive, it may persist for many blocks (unlike in the recentRejects filter).  My thought was that because this would not be a synchronized event over the network that this is ok...  But perhaps the choice of false positive rate is worth further thought?",
      "created_at" : "2020-01-19T17:08:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17951#issuecomment-576025217",
      "id" : 576025217,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17951",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NjAyNTIxNw==",
      "updated_at" : "2020-01-19T17:08:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576025217",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   }
]
