[
   {
      "author_association" : "MEMBER",
      "body" : "Not sure about disabling the limit.",
      "created_at" : "2018-05-24T14:15:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-391730865",
      "id" : 391730865,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13315",
      "updated_at" : "2018-05-24T14:15:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/391730865",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think a viable long term alternative is replacing ZMQ with a stateless longpolling similar to #13262.\r\nSomething like a `list_blocks_since_block` where it idles if the newest block was requested. Seems to be much saner then hoping ZMQ messages arrive.",
      "created_at" : "2018-05-24T14:18:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-391732108",
      "id" : 391732108,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13315",
      "updated_at" : "2018-05-24T14:18:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/391732108",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@promag I tried a 10000 limit first, and that also works (for now). But the default of 1000 seems too low.\r\n\r\nIn older versions of ZMQ the default was \"no limit\" anyway. \r\n\r\nThe queue is per SUBscriber, so if you have thousands of listeners to the node you might see some increase in memory usage.  I was not able to see an increase in memory usage on my system with 6 subscribers on different computers.\r\n\r\nUnfortunately the setting is not for a limit in MB , that would have made it easier to configure. \r\nevery value now seems somewhat arbitrary, and it highly depends on how many subscribers are connected \r\n-edit- I did some more testing and these peaks are about 3000messages and 3MB in size and happen when a block is found (or synced). So, in worst case scenario of a totally failing router or nic on your network the queue would grow at about 3MB per block. \r\nSo if I want to limit memory usage to 500B, the SNDHWM value should be 500000 / number of subscribers.\r\n\r\n\r\n\r\n\r\n ",
      "created_at" : "2018-05-24T14:19:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-391732229",
      "id" : 391732229,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13315",
      "updated_at" : "2018-05-25T13:51:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/391732229",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1678423?v=4",
         "events_url" : "https://api.github.com/users/FeedTheWeb/events{/privacy}",
         "followers_url" : "https://api.github.com/users/FeedTheWeb/followers",
         "following_url" : "https://api.github.com/users/FeedTheWeb/following{/other_user}",
         "gists_url" : "https://api.github.com/users/FeedTheWeb/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/FeedTheWeb",
         "id" : 1678423,
         "login" : "FeedTheWeb",
         "organizations_url" : "https://api.github.com/users/FeedTheWeb/orgs",
         "received_events_url" : "https://api.github.com/users/FeedTheWeb/received_events",
         "repos_url" : "https://api.github.com/users/FeedTheWeb/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/FeedTheWeb/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/FeedTheWeb/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/FeedTheWeb"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Make it an option?",
      "created_at" : "2018-05-24T14:24:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-391733964",
      "id" : 391733964,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13315",
      "updated_at" : "2018-05-24T14:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/391733964",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@FeedTheWeb Thanks for addressing this issue. Messages being dropped silently under normal circumstances when running with default settings sounds very confusing for the user.\r\n\r\nWould it make sense to bump the limit to say 2 * \"expected maximum under normal operations\" instead of removing the limit?\r\n\r\nThat way we won't drop messages under normal circumstances while still getting the \"avoid going berserk\" safety that the hard upper limit is meant to provide.",
      "created_at" : "2018-05-24T14:53:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-391744440",
      "id" : 391744440,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13315",
      "updated_at" : "2018-05-24T14:59:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/391744440",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "What is the \"expected maximum under normal operations\"?",
      "created_at" : "2018-05-24T15:00:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-391747047",
      "id" : 391747047,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13315",
      "updated_at" : "2018-05-24T15:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/391747047",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@promag Sorry for being vague. I meant the maximum number of buffered messages that can be expected under normal operations :-)",
      "created_at" : "2018-05-24T15:25:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-391756107",
      "id" : 391756107,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13315",
      "updated_at" : "2018-05-24T15:25:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/391756107",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@practicalswift reorgs and rescans will trigger the notifiers so I don't know if we should go that way. \r\n\r\nAlso, from the docs:\r\n> If this limit has been reached the socket shall enter an exceptional state and\r\n> depending on the socket type, 0MQ shall take appropriate action such as\r\n> blocking or dropping sent messages\r\n\r\nIMO making this configurable is the best bet and ideally should be different per notifier.",
      "created_at" : "2018-05-24T15:34:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-391759396",
      "id" : 391759396,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13315",
      "updated_at" : "2018-05-24T15:34:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/391759396",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Agree, making it configurable would be best. \r\nBut also an increased for the default value, I propose 100000 (~100MB). \r\n\r\n\r\n\r\n\r\n\r\n",
      "created_at" : "2018-05-25T16:27:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-392111185",
      "id" : 392111185,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13315",
      "updated_at" : "2018-05-25T16:27:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/392111185",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1678423?v=4",
         "events_url" : "https://api.github.com/users/FeedTheWeb/events{/privacy}",
         "followers_url" : "https://api.github.com/users/FeedTheWeb/followers",
         "following_url" : "https://api.github.com/users/FeedTheWeb/following{/other_user}",
         "gists_url" : "https://api.github.com/users/FeedTheWeb/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/FeedTheWeb",
         "id" : 1678423,
         "login" : "FeedTheWeb",
         "organizations_url" : "https://api.github.com/users/FeedTheWeb/orgs",
         "received_events_url" : "https://api.github.com/users/FeedTheWeb/received_events",
         "repos_url" : "https://api.github.com/users/FeedTheWeb/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/FeedTheWeb/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/FeedTheWeb/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/FeedTheWeb"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ping @jmcorgan ",
      "created_at" : "2018-05-31T06:54:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-393427478",
      "id" : 393427478,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13315",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5MzQyNzQ3OA==",
      "updated_at" : "2018-05-31T06:54:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/393427478",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@promag, it could only be made configurable per socket (not per notifier), but tbh I don't see why that would be useful. \r\n\r\n@practicalswift the 'normal circumstances' is not relevant here, this is only about peaks (with a duration of usually a few ms). In normal situations there never is a queue; the queue grows only when bitcoind pushes the messages faster then your network can handle (note: 'network', not client software - the receiving zmq-socket has its own buffer).   \r\n\r\n\r\n",
      "created_at" : "2018-06-06T09:05:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-394999110",
      "id" : 394999110,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13315",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NDk5OTExMA==",
      "updated_at" : "2018-06-06T09:05:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/394999110",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1678423?v=4",
         "events_url" : "https://api.github.com/users/FeedTheWeb/events{/privacy}",
         "followers_url" : "https://api.github.com/users/FeedTheWeb/followers",
         "following_url" : "https://api.github.com/users/FeedTheWeb/following{/other_user}",
         "gists_url" : "https://api.github.com/users/FeedTheWeb/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/FeedTheWeb",
         "id" : 1678423,
         "login" : "FeedTheWeb",
         "node_id" : "MDQ6VXNlcjE2Nzg0MjM=",
         "organizations_url" : "https://api.github.com/users/FeedTheWeb/orgs",
         "received_events_url" : "https://api.github.com/users/FeedTheWeb/received_events",
         "repos_url" : "https://api.github.com/users/FeedTheWeb/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/FeedTheWeb/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/FeedTheWeb/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/FeedTheWeb"
      }
   }
]
