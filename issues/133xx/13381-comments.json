[
   {
      "author_association" : "MEMBER",
      "body" : "There is no need for a new parameter, check if label is null instead - this means that the default is to preserve if it exists otherwise \"\".",
      "created_at" : "2018-06-03T16:30:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#issuecomment-394174008",
      "id" : 394174008,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NDE3NDAwOA==",
      "updated_at" : "2018-06-03T16:32:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/394174008",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, a test would be nice.",
      "created_at" : "2018-06-03T17:29:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#issuecomment-394177666",
      "id" : 394177666,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NDE3NzY2Ng==",
      "updated_at" : "2018-06-03T17:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/394177666",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you, @promag.\r\nI added some functional tests for this specific behavior between importaddress and importprivkey.\r\nIf everything is alright, I'll squash and rebase as necessary.",
      "created_at" : "2018-06-03T21:16:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#issuecomment-394192050",
      "id" : 394192050,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NDE5MjA1MA==",
      "updated_at" : "2018-06-03T21:16:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/394192050",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5016303?v=4",
         "events_url" : "https://api.github.com/users/marcoagner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/marcoagner/followers",
         "following_url" : "https://api.github.com/users/marcoagner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/marcoagner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/marcoagner",
         "id" : 5016303,
         "login" : "marcoagner",
         "node_id" : "MDQ6VXNlcjUwMTYzMDM=",
         "organizations_url" : "https://api.github.com/users/marcoagner/orgs",
         "received_events_url" : "https://api.github.com/users/marcoagner/received_events",
         "repos_url" : "https://api.github.com/users/marcoagner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/marcoagner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/marcoagner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/marcoagner"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r192603399"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192603399"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was thinking in something like\r\n```cpp\r\nif (request.params[1].isNull()) {\r\n    const auto& it = pwallet->mapAddressBook.find(dest);\r\n    if (it != pwallet->mapAddressBook.end()) strLabel = it->second;\r\n}\r\npwallet->SetAddressBook(dest, strLabel, \"receive\");\r\n```",
      "commit_id" : "74877f3b10072e1975c931bb296212e008cd8c58",
      "created_at" : "2018-06-03T21:42:00Z",
      "diff_hunk" : "@@ -151,9 +151,12 @@ UniValue importprivkey(const JSONRPCRequest& request)\n         CKeyID vchAddress = pubkey.GetID();\n         {\n             pwallet->MarkDirty();\n-            // We don't know which corresponding address will be used; label them all\n+\n+            // We don't know which corresponding address will be used; label all new addresses and preserve the rest\n             for (const auto& dest : GetAllDestinationsForKey(pubkey)) {\n-                pwallet->SetAddressBook(dest, strLabel, \"receive\");\n+                bool has_label = pwallet->mapAddressBook.find(dest) != pwallet->mapAddressBook.end() && !pwallet->mapAddressBook[dest].name.empty();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r192603399",
      "id" : 192603399,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5MjYwMzM5OQ==",
      "original_commit_id" : "c74740701d5b3d99380b9bf4fe329cdb4f6c235b",
      "original_position" : 18,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 125409144,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381",
      "updated_at" : "2018-06-04T10:07:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192603399",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r192606863"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192606863"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hm, I see. Yeah.. this behavior seems better. Thanks!\r\nUpdating this and the test.",
      "commit_id" : "74877f3b10072e1975c931bb296212e008cd8c58",
      "created_at" : "2018-06-03T23:52:55Z",
      "diff_hunk" : "@@ -151,9 +151,12 @@ UniValue importprivkey(const JSONRPCRequest& request)\n         CKeyID vchAddress = pubkey.GetID();\n         {\n             pwallet->MarkDirty();\n-            // We don't know which corresponding address will be used; label them all\n+\n+            // We don't know which corresponding address will be used; label all new addresses and preserve the rest\n             for (const auto& dest : GetAllDestinationsForKey(pubkey)) {\n-                pwallet->SetAddressBook(dest, strLabel, \"receive\");\n+                bool has_label = pwallet->mapAddressBook.find(dest) != pwallet->mapAddressBook.end() && !pwallet->mapAddressBook[dest].name.empty();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r192606863",
      "id" : 192606863,
      "in_reply_to_id" : 192603399,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5MjYwNjg2Mw==",
      "original_commit_id" : "c74740701d5b3d99380b9bf4fe329cdb4f6c235b",
      "original_position" : 18,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 125412914,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381",
      "updated_at" : "2018-06-04T10:07:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192606863",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5016303?v=4",
         "events_url" : "https://api.github.com/users/marcoagner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/marcoagner/followers",
         "following_url" : "https://api.github.com/users/marcoagner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/marcoagner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/marcoagner",
         "id" : 5016303,
         "login" : "marcoagner",
         "node_id" : "MDQ6VXNlcjUwMTYzMDM=",
         "organizations_url" : "https://api.github.com/users/marcoagner/orgs",
         "received_events_url" : "https://api.github.com/users/marcoagner/received_events",
         "repos_url" : "https://api.github.com/users/marcoagner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/marcoagner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/marcoagner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/marcoagner"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated with the right behavior.\r\nI will squash and rebase it as necessary in the morning, thanks.",
      "created_at" : "2018-06-03T23:57:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#issuecomment-394202360",
      "id" : 394202360,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NDIwMjM2MA==",
      "updated_at" : "2018-06-03T23:57:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/394202360",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5016303?v=4",
         "events_url" : "https://api.github.com/users/marcoagner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/marcoagner/followers",
         "following_url" : "https://api.github.com/users/marcoagner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/marcoagner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/marcoagner",
         "id" : 5016303,
         "login" : "marcoagner",
         "node_id" : "MDQ6VXNlcjUwMTYzMDM=",
         "organizations_url" : "https://api.github.com/users/marcoagner/orgs",
         "received_events_url" : "https://api.github.com/users/marcoagner/received_events",
         "repos_url" : "https://api.github.com/users/marcoagner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/marcoagner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/marcoagner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/marcoagner"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r192607435"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192607435"
         }
      },
      "author_association" : "MEMBER",
      "body" : "2018",
      "commit_id" : "74877f3b10072e1975c931bb296212e008cd8c58",
      "created_at" : "2018-06-04T00:12:03Z",
      "diff_hunk" : "@@ -0,0 +1,93 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r192607435",
      "id" : 192607435,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5MjYwNzQzNQ==",
      "original_commit_id" : "75e46d2c2dbefce328e775c4e75d506503ffc585",
      "original_position" : 2,
      "path" : "test/functional/wallet_import_with_label.py",
      "position" : null,
      "pull_request_review_id" : 125413567,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381",
      "updated_at" : "2018-06-04T10:07:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192607435",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r192607614"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192607614"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Comment is inacurate.",
      "commit_id" : "74877f3b10072e1975c931bb296212e008cd8c58",
      "created_at" : "2018-06-04T00:17:48Z",
      "diff_hunk" : "@@ -151,8 +151,13 @@ UniValue importprivkey(const JSONRPCRequest& request)\n         CKeyID vchAddress = pubkey.GetID();\n         {\n             pwallet->MarkDirty();\n-            // We don't know which corresponding address will be used; label them all\n+\n+            // We don't know which corresponding address will be used; label all new addresses and preserve the rest",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r192607614",
      "id" : 192607614,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5MjYwNzYxNA==",
      "original_commit_id" : "75e46d2c2dbefce328e775c4e75d506503ffc585",
      "original_position" : 15,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 125413567,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381",
      "updated_at" : "2018-06-04T10:07:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192607614",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested ACK 74877f3b10072e1975c931bb296212e008cd8c58 .  This is exactly the behavior I desired, thanks @marcoagner!",
      "created_at" : "2018-06-04T17:58:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#issuecomment-394443740",
      "id" : 394443740,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NDQ0Mzc0MA==",
      "updated_at" : "2018-06-04T17:58:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/394443740",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/61096?v=4",
         "events_url" : "https://api.github.com/users/harding/events{/privacy}",
         "followers_url" : "https://api.github.com/users/harding/followers",
         "following_url" : "https://api.github.com/users/harding/following{/other_user}",
         "gists_url" : "https://api.github.com/users/harding/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/harding",
         "id" : 61096,
         "login" : "harding",
         "node_id" : "MDQ6VXNlcjYxMDk2",
         "organizations_url" : "https://api.github.com/users/harding/orgs",
         "received_events_url" : "https://api.github.com/users/harding/received_events",
         "repos_url" : "https://api.github.com/users/harding/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/harding/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/harding/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/harding"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r193972817"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/193972817"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is it problematic that this will apply the label for a given destination over all following destinations, provided they aren't found on lookup? I suspect you'll want another destination-specific local to prevent that.",
      "commit_id" : "74877f3b10072e1975c931bb296212e008cd8c58",
      "created_at" : "2018-06-08T07:24:13Z",
      "diff_hunk" : "@@ -151,8 +151,15 @@ UniValue importprivkey(const JSONRPCRequest& request)\n         CKeyID vchAddress = pubkey.GetID();\n         {\n             pwallet->MarkDirty();\n-            // We don't know which corresponding address will be used; label them all\n+\n+            // We don't know which corresponding address will be used;\n+            // label all new addresses, and label existing addresses if a\n+            // label was passed.\n             for (const auto& dest : GetAllDestinationsForKey(pubkey)) {\n+                if (request.params[1].isNull()) {\n+                    const auto& it = pwallet->mapAddressBook.find(dest);\n+                    if (it != pwallet->mapAddressBook.end()) strLabel = it->second.name;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r193972817",
      "id" : 193972817,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5Mzk3MjgxNw==",
      "original_commit_id" : "74877f3b10072e1975c931bb296212e008cd8c58",
      "original_position" : 21,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 21,
      "pull_request_review_id" : 127055872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381",
      "updated_at" : "2018-06-08T07:24:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/193972817",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r194039082"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194039082"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good catch! Suggestion:\r\n```cpp\r\nif (it == pwallet->mapAddressBook.end() || !request.params[1].isNull()) {\r\n    pwallet->SetAddressBook(dest, strLabel, \"receive\")\r\n}\r\n```",
      "commit_id" : "74877f3b10072e1975c931bb296212e008cd8c58",
      "created_at" : "2018-06-08T12:18:56Z",
      "diff_hunk" : "@@ -151,8 +151,15 @@ UniValue importprivkey(const JSONRPCRequest& request)\n         CKeyID vchAddress = pubkey.GetID();\n         {\n             pwallet->MarkDirty();\n-            // We don't know which corresponding address will be used; label them all\n+\n+            // We don't know which corresponding address will be used;\n+            // label all new addresses, and label existing addresses if a\n+            // label was passed.\n             for (const auto& dest : GetAllDestinationsForKey(pubkey)) {\n+                if (request.params[1].isNull()) {\n+                    const auto& it = pwallet->mapAddressBook.find(dest);\n+                    if (it != pwallet->mapAddressBook.end()) strLabel = it->second.name;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r194039082",
      "id" : 194039082,
      "in_reply_to_id" : 193972817,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDAzOTA4Mg==",
      "original_commit_id" : "74877f3b10072e1975c931bb296212e008cd8c58",
      "original_position" : 21,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 21,
      "pull_request_review_id" : 127138590,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381",
      "updated_at" : "2018-06-08T12:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194039082",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r194039235"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194039235"
         }
      },
      "author_association" : "MEMBER",
      "body" : "There should be a test ensuring the correct behaviour.",
      "commit_id" : "74877f3b10072e1975c931bb296212e008cd8c58",
      "created_at" : "2018-06-08T12:19:46Z",
      "diff_hunk" : "@@ -151,8 +151,15 @@ UniValue importprivkey(const JSONRPCRequest& request)\n         CKeyID vchAddress = pubkey.GetID();\n         {\n             pwallet->MarkDirty();\n-            // We don't know which corresponding address will be used; label them all\n+\n+            // We don't know which corresponding address will be used;\n+            // label all new addresses, and label existing addresses if a\n+            // label was passed.\n             for (const auto& dest : GetAllDestinationsForKey(pubkey)) {\n+                if (request.params[1].isNull()) {\n+                    const auto& it = pwallet->mapAddressBook.find(dest);\n+                    if (it != pwallet->mapAddressBook.end()) strLabel = it->second.name;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r194039235",
      "id" : 194039235,
      "in_reply_to_id" : 193972817,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDAzOTIzNQ==",
      "original_commit_id" : "74877f3b10072e1975c931bb296212e008cd8c58",
      "original_position" : 21,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 21,
      "pull_request_review_id" : 127138801,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381",
      "updated_at" : "2018-06-08T12:19:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194039235",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r194046271"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194046271"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, makes sense. I will update it and add a test for the correct behaviour as soon as I can.",
      "commit_id" : "74877f3b10072e1975c931bb296212e008cd8c58",
      "created_at" : "2018-06-08T12:48:55Z",
      "diff_hunk" : "@@ -151,8 +151,15 @@ UniValue importprivkey(const JSONRPCRequest& request)\n         CKeyID vchAddress = pubkey.GetID();\n         {\n             pwallet->MarkDirty();\n-            // We don't know which corresponding address will be used; label them all\n+\n+            // We don't know which corresponding address will be used;\n+            // label all new addresses, and label existing addresses if a\n+            // label was passed.\n             for (const auto& dest : GetAllDestinationsForKey(pubkey)) {\n+                if (request.params[1].isNull()) {\n+                    const auto& it = pwallet->mapAddressBook.find(dest);\n+                    if (it != pwallet->mapAddressBook.end()) strLabel = it->second.name;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r194046271",
      "id" : 194046271,
      "in_reply_to_id" : 193972817,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDA0NjI3MQ==",
      "original_commit_id" : "74877f3b10072e1975c931bb296212e008cd8c58",
      "original_position" : 21,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 21,
      "pull_request_review_id" : 127147334,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381",
      "updated_at" : "2018-06-08T12:48:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194046271",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5016303?v=4",
         "events_url" : "https://api.github.com/users/marcoagner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/marcoagner/followers",
         "following_url" : "https://api.github.com/users/marcoagner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/marcoagner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/marcoagner",
         "id" : 5016303,
         "login" : "marcoagner",
         "node_id" : "MDQ6VXNlcjUwMTYzMDM=",
         "organizations_url" : "https://api.github.com/users/marcoagner/orgs",
         "received_events_url" : "https://api.github.com/users/marcoagner/received_events",
         "repos_url" : "https://api.github.com/users/marcoagner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/marcoagner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/marcoagner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/marcoagner"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm back to this. The new commit keeps the already tested behaviour (passing tests added on this PR et al) and passes new test for the multiple destinations bug spotted by @Empact.",
      "created_at" : "2018-06-10T11:16:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#issuecomment-396040933",
      "id" : 396040933,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NjA0MDkzMw==",
      "updated_at" : "2018-06-10T11:18:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/396040933",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5016303?v=4",
         "events_url" : "https://api.github.com/users/marcoagner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/marcoagner/followers",
         "following_url" : "https://api.github.com/users/marcoagner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/marcoagner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/marcoagner",
         "id" : 5016303,
         "login" : "marcoagner",
         "node_id" : "MDQ6VXNlcjUwMTYzMDM=",
         "organizations_url" : "https://api.github.com/users/marcoagner/orgs",
         "received_events_url" : "https://api.github.com/users/marcoagner/received_events",
         "repos_url" : "https://api.github.com/users/marcoagner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/marcoagner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/marcoagner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/marcoagner"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This still changes behaviour: the default is now `null` (ie, current label) instead of `\"\"`.\r\n\r\nI don't particularly care what the default is (`null` makes more sense), but the change should be documented and noted in release notes.",
      "created_at" : "2018-06-12T21:44:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#issuecomment-396744773",
      "id" : 396744773,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5Njc0NDc3Mw==",
      "updated_at" : "2018-06-12T21:44:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/396744773",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Agree with @luke-jr regarding the behaviour change.",
      "created_at" : "2018-06-13T00:01:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#issuecomment-396771581",
      "id" : 396771581,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5Njc3MTU4MQ==",
      "updated_at" : "2018-06-13T00:01:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/396771581",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
