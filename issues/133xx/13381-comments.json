[
   {
      "author_association" : "MEMBER",
      "body" : "There is no need for a new parameter, check if label is null instead - this means that the default is to preserve if it exists otherwise \"\".",
      "created_at" : "2018-06-03T16:30:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#issuecomment-394174008",
      "id" : 394174008,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NDE3NDAwOA==",
      "updated_at" : "2018-06-03T16:32:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/394174008",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, a test would be nice.",
      "created_at" : "2018-06-03T17:29:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#issuecomment-394177666",
      "id" : 394177666,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NDE3NzY2Ng==",
      "updated_at" : "2018-06-03T17:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/394177666",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you, @promag.\r\nI added some functional tests for this specific behavior between importaddress and importprivkey.\r\nIf everything is alright, I'll squash and rebase as necessary.",
      "created_at" : "2018-06-03T21:16:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#issuecomment-394192050",
      "id" : 394192050,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NDE5MjA1MA==",
      "updated_at" : "2018-06-03T21:16:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/394192050",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5016303?v=4",
         "events_url" : "https://api.github.com/users/marcoagner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/marcoagner/followers",
         "following_url" : "https://api.github.com/users/marcoagner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/marcoagner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/marcoagner",
         "id" : 5016303,
         "login" : "marcoagner",
         "node_id" : "MDQ6VXNlcjUwMTYzMDM=",
         "organizations_url" : "https://api.github.com/users/marcoagner/orgs",
         "received_events_url" : "https://api.github.com/users/marcoagner/received_events",
         "repos_url" : "https://api.github.com/users/marcoagner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/marcoagner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/marcoagner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/marcoagner"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r192603399"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192603399"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was thinking in something like\r\n```cpp\r\nif (request.params[1].isNull()) {\r\n    const auto& it = pwallet->mapAddressBook.find(dest);\r\n    if (it != pwallet->mapAddressBook.end()) strLabel = it->second;\r\n}\r\npwallet->SetAddressBook(dest, strLabel, \"receive\");\r\n```",
      "commit_id" : "75e46d2c2dbefce328e775c4e75d506503ffc585",
      "created_at" : "2018-06-03T21:42:00Z",
      "diff_hunk" : "@@ -151,9 +151,12 @@ UniValue importprivkey(const JSONRPCRequest& request)\n         CKeyID vchAddress = pubkey.GetID();\n         {\n             pwallet->MarkDirty();\n-            // We don't know which corresponding address will be used; label them all\n+\n+            // We don't know which corresponding address will be used; label all new addresses and preserve the rest\n             for (const auto& dest : GetAllDestinationsForKey(pubkey)) {\n-                pwallet->SetAddressBook(dest, strLabel, \"receive\");\n+                bool has_label = pwallet->mapAddressBook.find(dest) != pwallet->mapAddressBook.end() && !pwallet->mapAddressBook[dest].name.empty();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r192603399",
      "id" : 192603399,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5MjYwMzM5OQ==",
      "original_commit_id" : "c74740701d5b3d99380b9bf4fe329cdb4f6c235b",
      "original_position" : 18,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 125409144,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381",
      "updated_at" : "2018-06-03T23:52:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192603399",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r192606863"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192606863"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hm, I see. Yeah.. this behavior seems better. Thanks!\r\nUpdating this and the test.",
      "commit_id" : "75e46d2c2dbefce328e775c4e75d506503ffc585",
      "created_at" : "2018-06-03T23:52:55Z",
      "diff_hunk" : "@@ -151,9 +151,12 @@ UniValue importprivkey(const JSONRPCRequest& request)\n         CKeyID vchAddress = pubkey.GetID();\n         {\n             pwallet->MarkDirty();\n-            // We don't know which corresponding address will be used; label them all\n+\n+            // We don't know which corresponding address will be used; label all new addresses and preserve the rest\n             for (const auto& dest : GetAllDestinationsForKey(pubkey)) {\n-                pwallet->SetAddressBook(dest, strLabel, \"receive\");\n+                bool has_label = pwallet->mapAddressBook.find(dest) != pwallet->mapAddressBook.end() && !pwallet->mapAddressBook[dest].name.empty();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#discussion_r192606863",
      "id" : 192606863,
      "in_reply_to_id" : 192603399,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5MjYwNjg2Mw==",
      "original_commit_id" : "c74740701d5b3d99380b9bf4fe329cdb4f6c235b",
      "original_position" : 18,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 125412914,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13381",
      "updated_at" : "2018-06-03T23:52:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/192606863",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5016303?v=4",
         "events_url" : "https://api.github.com/users/marcoagner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/marcoagner/followers",
         "following_url" : "https://api.github.com/users/marcoagner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/marcoagner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/marcoagner",
         "id" : 5016303,
         "login" : "marcoagner",
         "node_id" : "MDQ6VXNlcjUwMTYzMDM=",
         "organizations_url" : "https://api.github.com/users/marcoagner/orgs",
         "received_events_url" : "https://api.github.com/users/marcoagner/received_events",
         "repos_url" : "https://api.github.com/users/marcoagner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/marcoagner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/marcoagner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/marcoagner"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated with the right behavior.\r\nI will squash and rebase it as necessary in the morning, thanks.",
      "created_at" : "2018-06-03T23:57:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13381#issuecomment-394202360",
      "id" : 394202360,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13381",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NDIwMjM2MA==",
      "updated_at" : "2018-06-03T23:57:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/394202360",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5016303?v=4",
         "events_url" : "https://api.github.com/users/marcoagner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/marcoagner/followers",
         "following_url" : "https://api.github.com/users/marcoagner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/marcoagner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/marcoagner",
         "id" : 5016303,
         "login" : "marcoagner",
         "node_id" : "MDQ6VXNlcjUwMTYzMDM=",
         "organizations_url" : "https://api.github.com/users/marcoagner/orgs",
         "received_events_url" : "https://api.github.com/users/marcoagner/received_events",
         "repos_url" : "https://api.github.com/users/marcoagner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/marcoagner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/marcoagner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/marcoagner"
      }
   }
]
