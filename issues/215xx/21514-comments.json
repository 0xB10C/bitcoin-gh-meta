[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20018 (p2p: ProcessAddrFetch(-seednode) is unnecessary if -connect is specified by dhruv)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-03-23T21:57:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21514#issuecomment-805293720",
      "id" : 805293720,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21514",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwNTI5MzcyMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-23T21:57:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/805293720",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nI think it would be a useful abstraction to introduce `CService::HasPort` or something like that. There are more protocols that do not have multi-port endpoints (UNIX sockets come to mind as an important one) and it would be slightly clearer than special-casing I2P.",
      "created_at" : "2021-03-25T10:00:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21514#issuecomment-806517937",
      "id" : 806517937,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21514",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwNjUxNzkzNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-25T10:00:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/806517937",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`5c3eaea36...f30e489c3`: added an abstraction to check if a given network is using ports, making this not I2P specific.\r\n\r\n\"uses ports or not\" is a per-network property (like IPv4 uses ports, I2P does not use ports), so I added a standalone function that takes an `enum Network` argument to check for that instead of adding a `CNetAddr` or `CService` method. It is not required to have a `CNetAddr` or `CService` object in order to check the uses-ports property of a given network.",
      "created_at" : "2021-03-30T10:44:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21514#issuecomment-810118195",
      "id" : 810118195,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21514",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMDExODE5NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-30T10:44:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/810118195",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for working on this! Will review soon.",
      "created_at" : "2021-03-30T13:36:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21514#issuecomment-810251498",
      "id" : 810251498,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21514",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMDI1MTQ5OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-30T13:36:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/810251498",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21514#discussion_r604922210"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/604922210"
         }
      },
      "author_association" : "MEMBER",
      "body" : "44cf17a maybe add a unit test assertion",
      "commit_id" : "f30e489c3882cd58e382c203e5e4722fbe70f58e",
      "created_at" : "2021-03-31T13:58:03Z",
      "diff_hunk" : "@@ -563,7 +563,13 @@ class CService : public CNetAddr\n         bool SetSockAddr(const struct sockaddr* paddr);\n         friend bool operator==(const CService& a, const CService& b);\n         friend bool operator!=(const CService& a, const CService& b) { return !(a == b); }\n-        friend bool operator<(const CService& a, const CService& b);\n+\n+        /**\n+         * Avoid silently, unintentionally falling back to comparing CService objects as\n+         * CNetAddr objects.\n+         */\n+        bool operator<(const CService&) = delete;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21514#discussion_r604922210",
      "id" : 604922210,
      "line" : 571,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNDkyMjIxMA==",
      "original_commit_id" : "f30e489c3882cd58e382c203e5e4722fbe70f58e",
      "original_line" : 571,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/netaddress.h",
      "position" : 10,
      "pull_request_review_id" : 625322551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21514",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-31T15:01:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/604922210",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21514#discussion_r604941036"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/604941036"
         }
      },
      "author_association" : "MEMBER",
      "body" : "987d372 Verified that these new assertions fail without the change to `ToStringIPPort()` in the same commit.",
      "commit_id" : "f30e489c3882cd58e382c203e5e4722fbe70f58e",
      "created_at" : "2021-03-31T14:20:03Z",
      "diff_hunk" : "@@ -131,6 +131,11 @@ BOOST_AUTO_TEST_CASE(netbase_lookupnumeric)\n     BOOST_CHECK(TestParse(\"[fd6b:88c0:8724:1:2:3:4:5]\", \"[::]:0\"));\n     // and that a one-off resolves correctly\n     BOOST_CHECK(TestParse(\"[fd6c:88c0:8724:1:2:3:4:5]\", \"[fd6c:88c0:8724:1:2:3:4:5]:65535\"));\n+\n+    // I2P skips the port.\n+    const std::string i2p_addr{\"ukeu3k5oycgaauneqgtnvselmt4yemvoilkln7jpvamvfx7dnkdq.b32.i2p\"};\n+    BOOST_CHECK(TestParse(i2p_addr, i2p_addr));\n+    BOOST_CHECK(TestParse(i2p_addr + \":8333\", i2p_addr));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21514#discussion_r604941036",
      "id" : 604941036,
      "line" : 138,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNDk0MTAzNg==",
      "original_commit_id" : "f30e489c3882cd58e382c203e5e4722fbe70f58e",
      "original_line" : 138,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/test/netbase_tests.cpp",
      "position" : 8,
      "pull_request_review_id" : 625322551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21514",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-31T15:01:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/604941036",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21514#discussion_r604943949"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/604943949"
         }
      },
      "author_association" : "MEMBER",
      "body" : "8f4bd325 This I2P address string is created 4 times in this test file now; perhaps hoist to a constant.",
      "commit_id" : "f30e489c3882cd58e382c203e5e4722fbe70f58e",
      "created_at" : "2021-03-31T14:23:14Z",
      "diff_hunk" : "@@ -564,4 +569,32 @@ BOOST_AUTO_TEST_CASE(caddress_unserialize_v2)\n     BOOST_CHECK(fixture_addresses == addresses_unserialized);\n }\n \n+BOOST_AUTO_TEST_CASE(cservice_compare)\n+{\n+    BOOST_CHECK(LookupNumeric(\"1.1.1.1:555\") == LookupNumeric(\"1.1.1.1:555\"));\n+    BOOST_CHECK(LookupNumeric(\"1.1.1.1:555\") != LookupNumeric(\"1.1.1.1:666\"));\n+    BOOST_CHECK(LookupNumeric(\"1.1.1.1:555\") != LookupNumeric(\"2.2.2.2:555\"));\n+\n+    const std::string i2p_addr{\"ukeu3k5oycgaauneqgtnvselmt4yemvoilkln7jpvamvfx7dnkdq.b32.i2p\"};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21514#discussion_r604943949",
      "id" : 604943949,
      "line" : 578,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNDk0Mzk0OQ==",
      "original_commit_id" : "f30e489c3882cd58e382c203e5e4722fbe70f58e",
      "original_line" : 578,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/test/netbase_tests.cpp",
      "position" : 22,
      "pull_request_review_id" : 625322551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21514",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-31T15:01:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/604943949",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21514#discussion_r604952955"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/604952955"
         }
      },
      "author_association" : "MEMBER",
      "body" : "8f4bd325 can also test passing `RemovePortIfIrrelevant()` a vector of addresses",
      "commit_id" : "f30e489c3882cd58e382c203e5e4722fbe70f58e",
      "created_at" : "2021-03-31T14:33:25Z",
      "diff_hunk" : "@@ -564,4 +569,32 @@ BOOST_AUTO_TEST_CASE(caddress_unserialize_v2)\n     BOOST_CHECK(fixture_addresses == addresses_unserialized);\n }\n \n+BOOST_AUTO_TEST_CASE(cservice_compare)\n+{\n+    BOOST_CHECK(LookupNumeric(\"1.1.1.1:555\") == LookupNumeric(\"1.1.1.1:555\"));\n+    BOOST_CHECK(LookupNumeric(\"1.1.1.1:555\") != LookupNumeric(\"1.1.1.1:666\"));\n+    BOOST_CHECK(LookupNumeric(\"1.1.1.1:555\") != LookupNumeric(\"2.2.2.2:555\"));\n+\n+    const std::string i2p_addr{\"ukeu3k5oycgaauneqgtnvselmt4yemvoilkln7jpvamvfx7dnkdq.b32.i2p\"};\n+    BOOST_CHECK(LookupNumeric(i2p_addr + \":555\") == LookupNumeric(i2p_addr + \":555\"));\n+    BOOST_CHECK(LookupNumeric(i2p_addr + \":555\") == LookupNumeric(i2p_addr + \":666\"));\n+}\n+\n+BOOST_AUTO_TEST_CASE(remove_port_if_irrelevant)\n+{\n+    const std::string i2p_addr{\"ukeu3k5oycgaauneqgtnvselmt4yemvoilkln7jpvamvfx7dnkdq.b32.i2p\"};\n+    BOOST_CHECK_EQUAL(RemovePortIfIrrelevant(i2p_addr + \":4444\"), i2p_addr);\n+\n+    for (const std::string addr : {\n+             \"1.2.3.4\",\n+             \"1.2.3.4:5678\",\n+             \"[1:2::3:4]:5678\",\n+             \"pg6mmjiyjmcrsslvykfwnntlaru7p5svn6y2ymmju6nubxndf4pscryd.onion\",\n+             \"pg6mmjiyjmcrsslvykfwnntlaru7p5svn6y2ymmju6nubxndf4pscryd.onion:1111\",\n+             \"ukeu3k5oycgaauneqgtnvselmt4yemvoilkln7jpvamvfx7dnkdq.b32.i2p\",\n+         }) {\n+        BOOST_CHECK_EQUAL(RemovePortIfIrrelevant(addr), addr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21514#discussion_r604952955",
      "id" : 604952955,
      "line" : 596,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNDk1Mjk1NQ==",
      "original_commit_id" : "f30e489c3882cd58e382c203e5e4722fbe70f58e",
      "original_line" : 596,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/test/netbase_tests.cpp",
      "position" : 40,
      "pull_request_review_id" : 625322551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21514",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-31T15:01:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/604952955",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21514#discussion_r604964280"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/604964280"
         }
      },
      "author_association" : "MEMBER",
      "body" : "6f19e34 suggested simplification\r\n```diff\r\n     def test_addnode_and_connect_i2p(self):\r\n-        self.log.info('Test that ports are removed from -addnode= and -connect= I2P addresses')\r\n-\r\n+        self.log.info(\"Test ports are removed from I2P addresses passed to -addnode/-connect\")\r\n         i2p_addr = \"ukeu3k5oycgaauneqgtnvselmt4yemvoilkln7jpvamvfx7dnkdq.b32.i2p\"\r\n         i2p_addr_with_port = i2p_addr + \":3333\"\r\n-\r\n-        self.stop_node(0)\r\n-        with self.nodes[0].assert_debug_log(expected_msgs=[\r\n-                f\"trying connection {i2p_addr} lastseen=\",\r\n-        ]):\r\n-            self.start_node(0, extra_args=[f\"-addnode={i2p_addr_with_port}\"])\r\n-\r\n-        self.stop_node(0)\r\n-        with self.nodes[0].assert_debug_log(expected_msgs=[\r\n-                f\"trying connection {i2p_addr} lastseen=\",\r\n-        ]):\r\n-            self.start_node(0, extra_args=[f\"-connect={i2p_addr_with_port}\"])\r\n+        msg = [f\"trying connection {i2p_addr} lastseen=\"]\r\n+        for option in {\"addnode\", \"connect\"}:\r\n+            with self.nodes[0].assert_debug_log(expected_msgs=msg):\r\n+                self.restart_node(0, extra_args=[f\"-{option}={i2p_addr_with_port}\"])\r\n \r\n     def run_test(self):\r\n```\r\n",
      "commit_id" : "f30e489c3882cd58e382c203e5e4722fbe70f58e",
      "created_at" : "2021-03-31T14:46:30Z",
      "diff_hunk" : "@@ -213,11 +213,30 @@ def test_seed_peers(self):\n         ]):\n             self.nodes[0].setmocktime(start + 65)\n \n+    def test_addnode_and_connect_i2p(self):\n+        self.log.info('Test that ports are removed from -addnode= and -connect= I2P addresses')\n+\n+        i2p_addr = \"ukeu3k5oycgaauneqgtnvselmt4yemvoilkln7jpvamvfx7dnkdq.b32.i2p\"\n+        i2p_addr_with_port = i2p_addr + \":3333\"\n+\n+        self.stop_node(0)\n+        with self.nodes[0].assert_debug_log(expected_msgs=[\n+                f\"trying connection {i2p_addr} lastseen=\",\n+        ]):\n+            self.start_node(0, extra_args=[f\"-addnode={i2p_addr_with_port}\"])\n+\n+        self.stop_node(0)\n+        with self.nodes[0].assert_debug_log(expected_msgs=[\n+                f\"trying connection {i2p_addr} lastseen=\",\n+        ]):\n+            self.start_node(0, extra_args=[f\"-connect={i2p_addr_with_port}\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21514#discussion_r604964280",
      "id" : 604964280,
      "line" : 232,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNDk2NDI4MA==",
      "original_commit_id" : "f30e489c3882cd58e382c203e5e4722fbe70f58e",
      "original_line" : 232,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "test/functional/feature_config_args.py",
      "position" : 20,
      "pull_request_review_id" : 625322551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21514",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-31T15:01:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/604964280",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21514#discussion_r604982203"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/604982203"
         }
      },
      "author_association" : "MEMBER",
      "body" : "While here, maybe sneak this minor fixup into the commit\r\n```diff\r\n-bool static TestParse(std::string src, std::string canon)\r\n+bool static TestParse(const std::string& src, const std::string& canon)\r\n {\r\n-    CService addr(LookupNumeric(src, 65535));\r\n+    CService addr{LookupNumeric(src, 65535)};\r\n```\r\n",
      "commit_id" : "f30e489c3882cd58e382c203e5e4722fbe70f58e",
      "created_at" : "2021-03-31T15:07:59Z",
      "diff_hunk" : "@@ -131,6 +131,11 @@ BOOST_AUTO_TEST_CASE(netbase_lookupnumeric)\n     BOOST_CHECK(TestParse(\"[fd6b:88c0:8724:1:2:3:4:5]\", \"[::]:0\"));\n     // and that a one-off resolves correctly\n     BOOST_CHECK(TestParse(\"[fd6c:88c0:8724:1:2:3:4:5]\", \"[fd6c:88c0:8724:1:2:3:4:5]:65535\"));\n+\n+    // I2P skips the port.\n+    const std::string i2p_addr{\"ukeu3k5oycgaauneqgtnvselmt4yemvoilkln7jpvamvfx7dnkdq.b32.i2p\"};\n+    BOOST_CHECK(TestParse(i2p_addr, i2p_addr));\n+    BOOST_CHECK(TestParse(i2p_addr + \":8333\", i2p_addr));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21514#discussion_r604982203",
      "id" : 604982203,
      "in_reply_to_id" : 604941036,
      "line" : 138,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNDk4MjIwMw==",
      "original_commit_id" : "f30e489c3882cd58e382c203e5e4722fbe70f58e",
      "original_line" : 138,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/test/netbase_tests.cpp",
      "position" : 8,
      "pull_request_review_id" : 625405223,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21514",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-31T15:08:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/604982203",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21514#discussion_r605696588"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605696588"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Trying to order `CService` objects wouldn't compile.",
      "commit_id" : "f30e489c3882cd58e382c203e5e4722fbe70f58e",
      "created_at" : "2021-04-01T14:20:16Z",
      "diff_hunk" : "@@ -563,7 +563,13 @@ class CService : public CNetAddr\n         bool SetSockAddr(const struct sockaddr* paddr);\n         friend bool operator==(const CService& a, const CService& b);\n         friend bool operator!=(const CService& a, const CService& b) { return !(a == b); }\n-        friend bool operator<(const CService& a, const CService& b);\n+\n+        /**\n+         * Avoid silently, unintentionally falling back to comparing CService objects as\n+         * CNetAddr objects.\n+         */\n+        bool operator<(const CService&) = delete;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21514#discussion_r605696588",
      "id" : 605696588,
      "in_reply_to_id" : 604922210,
      "line" : 571,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNTY5NjU4OA==",
      "original_commit_id" : "f30e489c3882cd58e382c203e5e4722fbe70f58e",
      "original_line" : 571,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/netaddress.h",
      "position" : 10,
      "pull_request_review_id" : 626320217,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21514",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-01T14:20:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605696588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21514#discussion_r605709093"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605709093"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I prefer to keep it local to each test. It is just a random address, does not need to be equal in all test cases.",
      "commit_id" : "f30e489c3882cd58e382c203e5e4722fbe70f58e",
      "created_at" : "2021-04-01T14:36:30Z",
      "diff_hunk" : "@@ -564,4 +569,32 @@ BOOST_AUTO_TEST_CASE(caddress_unserialize_v2)\n     BOOST_CHECK(fixture_addresses == addresses_unserialized);\n }\n \n+BOOST_AUTO_TEST_CASE(cservice_compare)\n+{\n+    BOOST_CHECK(LookupNumeric(\"1.1.1.1:555\") == LookupNumeric(\"1.1.1.1:555\"));\n+    BOOST_CHECK(LookupNumeric(\"1.1.1.1:555\") != LookupNumeric(\"1.1.1.1:666\"));\n+    BOOST_CHECK(LookupNumeric(\"1.1.1.1:555\") != LookupNumeric(\"2.2.2.2:555\"));\n+\n+    const std::string i2p_addr{\"ukeu3k5oycgaauneqgtnvselmt4yemvoilkln7jpvamvfx7dnkdq.b32.i2p\"};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21514#discussion_r605709093",
      "id" : 605709093,
      "in_reply_to_id" : 604943949,
      "line" : 578,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNTcwOTA5Mw==",
      "original_commit_id" : "f30e489c3882cd58e382c203e5e4722fbe70f58e",
      "original_line" : 578,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/test/netbase_tests.cpp",
      "position" : 22,
      "pull_request_review_id" : 626337381,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21514",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-01T14:36:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605709093",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
