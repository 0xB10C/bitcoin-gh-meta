[
   {
      "body" : "Super mega concept ACK.  FWIW, I tested something functionally like this before (eliminating the signals with a direct function call) and saw a measurable performance improvement, I assume because there is synchronization inside the signals stuff (plus a super deep call stack).",
      "created_at" : "2017-07-09T11:35:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#issuecomment-313914683",
      "id" : 313914683,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10756",
      "updated_at" : "2017-07-09T11:36:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/313914683",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "This is awesome. Lots of future work to do, but good first step. Will circle back around post-15.",
      "created_at" : "2017-07-10T00:22:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#issuecomment-313975394",
      "id" : 313975394,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10756",
      "updated_at" : "2017-07-10T00:22:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/313975394",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@gmaxwell \r\n\r\n> tested something functionally like this before (eliminating the signals with a direct function call) and saw a measurable performance improvement\r\n\r\nHow did you test that? It'd be good to benchmark whether this gives us a performance improvement.",
      "created_at" : "2017-07-10T13:59:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#issuecomment-314113978",
      "id" : 314113978,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10756",
      "updated_at" : "2017-07-10T13:59:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314113978",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r126431076"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126431076"
         }
      },
      "body" : "Nit: move `Receive messages` comment into the if block (the block covers both receiving and sending messages. Having the comment outside the block suggests it's just for receiving messages)",
      "commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "created_at" : "2017-07-10T14:07:10Z",
      "diff_hunk" : "@@ -1996,15 +1996,16 @@ void CConnman::ThreadMessageHandler()\n                 continue;\n \n             // Receive messages",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r126431076",
      "id" : 126431076,
      "original_commit_id" : "f785e8479a8ffca6c89d71f9dd6f1c1b455c2671",
      "original_position" : 36,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 48913621,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756",
      "updated_at" : "2017-07-11T16:36:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126431076",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r126432093"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126432093"
         }
      },
      "body" : "Change comment to `Interface for message handling`",
      "commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "created_at" : "2017-07-10T14:11:03Z",
      "diff_hunk" : "@@ -422,18 +423,18 @@ struct CombinerAll\n };\n \n // Signals for message handling",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r126432093",
      "id" : 126432093,
      "original_commit_id" : "f785e8479a8ffca6c89d71f9dd6f1c1b455c2671",
      "original_position" : 36,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 48913621,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756",
      "updated_at" : "2017-07-11T16:36:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126432093",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r126434185"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126434185"
         }
      },
      "body" : "remove this line. connman is no longer a param for this function.",
      "commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "created_at" : "2017-07-10T14:18:43Z",
      "diff_hunk" : "@@ -22,22 +22,32 @@ static const unsigned int DEFAULT_BLOCK_RECONSTRUCTION_EXTRA_TXN = 100;\n static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_BASE = 15 * 60 * 1000000; // 15 minutes\n static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER = 1000; // 1ms/header\n \n-/** Register with a network node to receive its signals */\n-void RegisterNodeSignals(CNodeSignals& nodeSignals);\n-/** Unregister a network node */\n-void UnregisterNodeSignals(CNodeSignals& nodeSignals);\n-\n-class PeerLogicValidation : public CValidationInterface {\n+class PeerLogicValidation : public CValidationInterface, public NetEventsInterface {\n private:\n     CConnman* connman;\n \n public:\n-    PeerLogicValidation(CConnman* connmanIn);\n+    PeerLogicValidation(CConnman* connman);\n \n     void BlockConnected(const std::shared_ptr<const CBlock>& pblock, const CBlockIndex* pindexConnected, const std::vector<CTransactionRef>& vtxConflicted) override;\n     void UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockIndex *pindexFork, bool fInitialDownload) override;\n     void BlockChecked(const CBlock& block, const CValidationState& state) override;\n     void NewPoWValidBlock(const CBlockIndex *pindex, const std::shared_ptr<const CBlock>& pblock) override;\n+\n+\n+    void InitializeNode(CNode* pnode) override;\n+    void FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) override;\n+    /** Process protocol messages received from a given node */\n+    bool ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt) override;\n+    /**\n+    * Send queued protocol messages to be sent to a give node.\n+    *\n+    * @param[in]   pto             The node which we are sending messages to.\n+    * @param[in]   connman         The connection manager for that node.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r126434185",
      "id" : 126434185,
      "original_commit_id" : "f785e8479a8ffca6c89d71f9dd6f1c1b455c2671",
      "original_position" : 32,
      "path" : "src/net_processing.h",
      "position" : null,
      "pull_request_review_id" : 48913621,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756",
      "updated_at" : "2017-07-11T16:36:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126434185",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "Remembering @gmaxwell's mention of it before, I was hoping to see a slight speedup here, but I haven't been able to observe anything substantial either. No test varies more than 1% from any other.\r\n\r\n@jnewbery my test was to do a sync to block 150000 between two localhost nodes running from ramdisk datadirs. I believe that focuses on the hot-spot well enough.",
      "created_at" : "2017-07-11T00:19:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#issuecomment-314286460",
      "id" : 314286460,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10756",
      "updated_at" : "2017-07-11T00:19:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314286460",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "Needed rebase after #10179, so I went ahead and squashed it down too.",
      "created_at" : "2017-07-11T16:37:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#issuecomment-314501830",
      "id" : 314501830,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10756",
      "updated_at" : "2017-07-11T16:37:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314501830",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "@jnewbery GBE connected hosts running a patch like this, out of ram, may have also required turning up our networking buffers. maybe that other locking changes we made mooted the improvement. I'll go see if I can find the relevant chat logs.",
      "created_at" : "2017-07-11T19:17:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#issuecomment-314544580",
      "id" : 314544580,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10756",
      "updated_at" : "2017-07-11T19:17:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314544580",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130960169"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130960169"
         }
      },
      "body" : "Can you drop cs_sendProcessing while you're here? Its literally entirely unused except for this lock here.",
      "commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "created_at" : "2017-08-02T18:37:31Z",
      "diff_hunk" : "@@ -1995,16 +1995,17 @@ void CConnman::ThreadMessageHandler()\n             if (pnode->fDisconnect)\n                 continue;\n \n-            // Receive messages\n-            bool fMoreNodeWork = GetNodeSignals().ProcessMessages(pnode, *this, flagInterruptMsgProc);\n-            fMoreWork |= (fMoreNodeWork && !pnode->fPauseSend);\n-            if (flagInterruptMsgProc)\n-                return;\n-\n-            // Send messages\n-            {\n-                LOCK(pnode->cs_sendProcessing);\n-                GetNodeSignals().SendMessages(pnode, *this, flagInterruptMsgProc);\n+            if (messageInterface) {\n+                // Receive messages\n+                bool fMoreNodeWork = messageInterface->ProcessMessages(pnode, flagInterruptMsgProc);\n+                fMoreWork |= (fMoreNodeWork && !pnode->fPauseSend);\n+                if (flagInterruptMsgProc)\n+                    return;\n+                // Send messages\n+                {\n+                    LOCK(pnode->cs_sendProcessing);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130960169",
      "id" : 130960169,
      "original_commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "original_position" : 55,
      "path" : "src/net.cpp",
      "position" : 55,
      "pull_request_review_id" : 53892618,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756",
      "updated_at" : "2017-08-02T19:03:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130960169",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130966042"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130966042"
         }
      },
      "body" : "I believe we're nullptr'ing now?",
      "commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "created_at" : "2017-08-02T18:58:36Z",
      "diff_hunk" : "@@ -2212,6 +2213,7 @@ CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In) : nSeed0(nSeed0In), nSe\n     nMaxAddnode = 0;\n     nBestHeight = 0;\n     clientInterface = NULL;\n+    messageInterface = NULL;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130966042",
      "id" : 130966042,
      "original_commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "original_position" : 65,
      "path" : "src/net.cpp",
      "position" : 65,
      "pull_request_review_id" : 53892618,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756",
      "updated_at" : "2017-08-02T19:03:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130966042",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130966566"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130966566"
         }
      },
      "body" : "I feel like we should just go for the direct deref here. A CConnman without a messageInterface feels like a client-of-the-API failure. Maybe just assert(messageInterface) in ::Start?",
      "commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "created_at" : "2017-08-02T19:00:39Z",
      "diff_hunk" : "@@ -1966,7 +1964,9 @@ bool CConnman::OpenNetworkConnection(const CAddress& addrConnect, bool fCountFai\n     if (fAddnode)\n         pnode->fAddnode = true;\n \n-    GetNodeSignals().InitializeNode(pnode, *this);\n+    if (messageInterface) {\n+        messageInterface->InitializeNode(pnode);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130966566",
      "id" : 130966566,
      "original_commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "original_position" : 28,
      "path" : "src/net.cpp",
      "position" : 28,
      "pull_request_review_id" : 53892618,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756",
      "updated_at" : "2017-08-02T19:03:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130966566",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130966827"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130966827"
         }
      },
      "body" : "Why did you define the constructor here?",
      "commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "created_at" : "2017-08-02T19:01:39Z",
      "diff_hunk" : "@@ -421,19 +422,19 @@ struct CombinerAll\n     }\n };\n \n-// Signals for message handling\n-struct CNodeSignals\n+// Interface for message handling\n+class NetEventsInterface\n {\n-    boost::signals2::signal<bool (CNode*, CConnman&, std::atomic<bool>&), CombinerAll> ProcessMessages;\n-    boost::signals2::signal<bool (CNode*, CConnman&, std::atomic<bool>&), CombinerAll> SendMessages;\n-    boost::signals2::signal<void (CNode*, CConnman&)> InitializeNode;\n-    boost::signals2::signal<void (NodeId, bool&)> FinalizeNode;\n+protected:\n+    NetEventsInterface() = default;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130966827",
      "id" : 130966827,
      "original_commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "original_position" : 47,
      "path" : "src/net.h",
      "position" : 47,
      "pull_request_review_id" : 53892618,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756",
      "updated_at" : "2017-08-02T19:03:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130966827",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130966942"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130966942"
         }
      },
      "body" : "Why do we need to make the destructor virtual? CConnman doesn't care about construction/destruction, it just takes a ptr.",
      "commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "created_at" : "2017-08-02T19:02:11Z",
      "diff_hunk" : "@@ -421,19 +422,19 @@ struct CombinerAll\n     }\n };\n \n-// Signals for message handling\n-struct CNodeSignals\n+// Interface for message handling\n+class NetEventsInterface\n {\n-    boost::signals2::signal<bool (CNode*, CConnman&, std::atomic<bool>&), CombinerAll> ProcessMessages;\n-    boost::signals2::signal<bool (CNode*, CConnman&, std::atomic<bool>&), CombinerAll> SendMessages;\n-    boost::signals2::signal<void (CNode*, CConnman&)> InitializeNode;\n-    boost::signals2::signal<void (NodeId, bool&)> FinalizeNode;\n+protected:\n+    NetEventsInterface() = default;\n+public:\n+    virtual ~NetEventsInterface() = default;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130966942",
      "id" : 130966942,
      "original_commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "original_position" : 49,
      "path" : "src/net.h",
      "position" : 49,
      "pull_request_review_id" : 53892618,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756",
      "updated_at" : "2017-08-02T19:03:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130966942",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130988967"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130988967"
         }
      },
      "body" : "Sure. It's safe to drop it now, but we'd need to put it back for parallel processing.",
      "commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "created_at" : "2017-08-02T20:35:04Z",
      "diff_hunk" : "@@ -1995,16 +1995,17 @@ void CConnman::ThreadMessageHandler()\n             if (pnode->fDisconnect)\n                 continue;\n \n-            // Receive messages\n-            bool fMoreNodeWork = GetNodeSignals().ProcessMessages(pnode, *this, flagInterruptMsgProc);\n-            fMoreWork |= (fMoreNodeWork && !pnode->fPauseSend);\n-            if (flagInterruptMsgProc)\n-                return;\n-\n-            // Send messages\n-            {\n-                LOCK(pnode->cs_sendProcessing);\n-                GetNodeSignals().SendMessages(pnode, *this, flagInterruptMsgProc);\n+            if (messageInterface) {\n+                // Receive messages\n+                bool fMoreNodeWork = messageInterface->ProcessMessages(pnode, flagInterruptMsgProc);\n+                fMoreWork |= (fMoreNodeWork && !pnode->fPauseSend);\n+                if (flagInterruptMsgProc)\n+                    return;\n+                // Send messages\n+                {\n+                    LOCK(pnode->cs_sendProcessing);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130988967",
      "id" : 130988967,
      "original_commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "original_position" : 55,
      "path" : "src/net.cpp",
      "position" : 55,
      "pull_request_review_id" : 53924388,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756",
      "updated_at" : "2017-08-02T20:35:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130988967",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130989034"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130989034"
         }
      },
      "body" : "ok",
      "commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "created_at" : "2017-08-02T20:35:20Z",
      "diff_hunk" : "@@ -2212,6 +2213,7 @@ CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In) : nSeed0(nSeed0In), nSe\n     nMaxAddnode = 0;\n     nBestHeight = 0;\n     clientInterface = NULL;\n+    messageInterface = NULL;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130989034",
      "id" : 130989034,
      "original_commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "original_position" : 65,
      "path" : "src/net.cpp",
      "position" : 65,
      "pull_request_review_id" : 53924472,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756",
      "updated_at" : "2017-08-02T20:35:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130989034",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130989951"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130989951"
         }
      },
      "body" : "Just a habit of mine to declare the ctor as protected for classes that should be inherited from. Since there are pure virtuals here, it's not really necessary.",
      "commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "created_at" : "2017-08-02T20:39:11Z",
      "diff_hunk" : "@@ -421,19 +422,19 @@ struct CombinerAll\n     }\n };\n \n-// Signals for message handling\n-struct CNodeSignals\n+// Interface for message handling\n+class NetEventsInterface\n {\n-    boost::signals2::signal<bool (CNode*, CConnman&, std::atomic<bool>&), CombinerAll> ProcessMessages;\n-    boost::signals2::signal<bool (CNode*, CConnman&, std::atomic<bool>&), CombinerAll> SendMessages;\n-    boost::signals2::signal<void (CNode*, CConnman&)> InitializeNode;\n-    boost::signals2::signal<void (NodeId, bool&)> FinalizeNode;\n+protected:\n+    NetEventsInterface() = default;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130989951",
      "id" : 130989951,
      "original_commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "original_position" : 47,
      "path" : "src/net.h",
      "position" : 47,
      "pull_request_review_id" : 53925505,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756",
      "updated_at" : "2017-08-02T20:39:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130989951",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130991719"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130991719"
         }
      },
      "body" : "To make sure that the base gets cleaned up if, for example, it's stored as an abstract std::unique_ptr<NetEventsInterface>",
      "commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "created_at" : "2017-08-02T20:46:26Z",
      "diff_hunk" : "@@ -421,19 +422,19 @@ struct CombinerAll\n     }\n };\n \n-// Signals for message handling\n-struct CNodeSignals\n+// Interface for message handling\n+class NetEventsInterface\n {\n-    boost::signals2::signal<bool (CNode*, CConnman&, std::atomic<bool>&), CombinerAll> ProcessMessages;\n-    boost::signals2::signal<bool (CNode*, CConnman&, std::atomic<bool>&), CombinerAll> SendMessages;\n-    boost::signals2::signal<void (CNode*, CConnman&)> InitializeNode;\n-    boost::signals2::signal<void (NodeId, bool&)> FinalizeNode;\n+protected:\n+    NetEventsInterface() = default;\n+public:\n+    virtual ~NetEventsInterface() = default;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130991719",
      "id" : 130991719,
      "original_commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "original_position" : 49,
      "path" : "src/net.h",
      "position" : 49,
      "pull_request_review_id" : 53927543,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756",
      "updated_at" : "2017-08-02T20:46:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130991719",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130992477"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130992477"
         }
      },
      "body" : "Heh, I went back and forth on this. Was waiting for someone to complain. Agreed.",
      "commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "created_at" : "2017-08-02T20:49:26Z",
      "diff_hunk" : "@@ -1966,7 +1964,9 @@ bool CConnman::OpenNetworkConnection(const CAddress& addrConnect, bool fCountFai\n     if (fAddnode)\n         pnode->fAddnode = true;\n \n-    GetNodeSignals().InitializeNode(pnode, *this);\n+    if (messageInterface) {\n+        messageInterface->InitializeNode(pnode);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r130992477",
      "id" : 130992477,
      "original_commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "original_position" : 28,
      "path" : "src/net.cpp",
      "position" : 28,
      "pull_request_review_id" : 53928334,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756",
      "updated_at" : "2017-08-02T20:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130992477",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r131021473"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/131021473"
         }
      },
      "body" : "Well my point was the CConnman (and related net stuff), which \"owns\" this interface explicitly does not do so (and does not have any desire to ever own the object), so adding anything additional to the interface feels strange to me.",
      "commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "created_at" : "2017-08-02T23:22:24Z",
      "diff_hunk" : "@@ -421,19 +422,19 @@ struct CombinerAll\n     }\n };\n \n-// Signals for message handling\n-struct CNodeSignals\n+// Interface for message handling\n+class NetEventsInterface\n {\n-    boost::signals2::signal<bool (CNode*, CConnman&, std::atomic<bool>&), CombinerAll> ProcessMessages;\n-    boost::signals2::signal<bool (CNode*, CConnman&, std::atomic<bool>&), CombinerAll> SendMessages;\n-    boost::signals2::signal<void (CNode*, CConnman&)> InitializeNode;\n-    boost::signals2::signal<void (NodeId, bool&)> FinalizeNode;\n+protected:\n+    NetEventsInterface() = default;\n+public:\n+    virtual ~NetEventsInterface() = default;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r131021473",
      "id" : 131021473,
      "original_commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "original_position" : 49,
      "path" : "src/net.h",
      "position" : 49,
      "pull_request_review_id" : 53959929,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756",
      "updated_at" : "2017-08-02T23:22:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/131021473",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Note that some of the Process functions are likely to move again into CNodeState or so, I believe, but this is an obviously good step.",
      "created_at" : "2017-08-02T23:22:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#issuecomment-319825474",
      "id" : 319825474,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10756",
      "updated_at" : "2017-08-02T23:22:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/319825474",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r131278418"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/131278418"
         }
      },
      "body" : "I must be missing your point. This is just a safety precaution in case anything ever wants to hold an abstract pointer. This may be the case if, for example, we create a vector of message processors in order to run them against each-other.\r\n\r\nI can remove it if you'd like, but I'm not understanding the objection to being cautious.",
      "commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "created_at" : "2017-08-03T22:49:19Z",
      "diff_hunk" : "@@ -421,19 +422,19 @@ struct CombinerAll\n     }\n };\n \n-// Signals for message handling\n-struct CNodeSignals\n+// Interface for message handling\n+class NetEventsInterface\n {\n-    boost::signals2::signal<bool (CNode*, CConnman&, std::atomic<bool>&), CombinerAll> ProcessMessages;\n-    boost::signals2::signal<bool (CNode*, CConnman&, std::atomic<bool>&), CombinerAll> SendMessages;\n-    boost::signals2::signal<void (CNode*, CConnman&)> InitializeNode;\n-    boost::signals2::signal<void (NodeId, bool&)> FinalizeNode;\n+protected:\n+    NetEventsInterface() = default;\n+public:\n+    virtual ~NetEventsInterface() = default;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10756#discussion_r131278418",
      "id" : 131278418,
      "original_commit_id" : "1f166fd63e895682f62c149825c4ee9165167a39",
      "original_position" : 49,
      "path" : "src/net.h",
      "position" : 49,
      "pull_request_review_id" : 54243775,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10756",
      "updated_at" : "2017-08-03T22:49:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/131278418",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   }
]
