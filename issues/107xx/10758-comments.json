[
   {
      "body" : "Note that the two generic \"Error initializing block database\" strings really should be changed, but as we are already in string freeze for 0.15, they will have to stay as-is for now :(.",
      "created_at" : "2017-07-07T00:07:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10758#issuecomment-313552143",
      "id" : 313552143,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10758",
      "updated_at" : "2017-07-07T00:07:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/313552143",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "More explicitly fixed the bug that I accidentally fixed by being more explicit - RewindBlockIndex MUST be called even if we start with -reindex-chainstate.",
      "created_at" : "2017-07-07T01:33:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10758#issuecomment-313563496",
      "id" : 313563496,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10758",
      "updated_at" : "2017-07-07T01:33:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/313563496",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "This needs an 0.15 tag as it fixes some bugs.",
      "created_at" : "2017-07-10T17:45:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10758#issuecomment-314181608",
      "id" : 314181608,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10758",
      "updated_at" : "2017-07-10T17:45:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314181608",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Rebased and added a fix for the issue @sipa pointed out at https://github.com/bitcoin/bitcoin/pull/10770#issuecomment-315558931",
      "created_at" : "2017-07-16T00:05:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10758#issuecomment-315571715",
      "id" : 315571715,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10758",
      "updated_at" : "2017-07-16T00:05:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/315571715",
      "user" : {
         "avatar_url" : "https://avatars4.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10758#discussion_r127596033"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10758"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127596033"
         }
      },
      "body" : "I have difficulty parsing this sentence. Can you split it up?",
      "commit_id" : "c93db429f909e75fbeacd2419fb8434350e3b674",
      "created_at" : "2017-07-16T00:42:53Z",
      "diff_hunk" : "@@ -3864,42 +3864,53 @@ void UnloadBlockIndex()\n bool LoadBlockIndex(const CChainParams& chainparams)\n {\n     // Load block index from databases\n-    if (!fReindex && !LoadBlockIndexDB(chainparams))\n-        return false;\n+    bool needs_init = fReindex;\n+    if (!fReindex) {\n+        bool ret = LoadBlockIndexDB(chainparams);\n+        if (!ret) return false;\n+        needs_init = mapBlockIndex.empty();\n+    }\n+\n+    if (needs_init) {\n+        // Note that LoadBlockIndexDB may have set fReindex if we shut down",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10758#discussion_r127596033",
      "id" : 127596033,
      "original_commit_id" : "ccc35ffdc0e5a47976b9f842bdbb9ad6a5a470e6",
      "original_position" : 14,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 50200445,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10758",
      "updated_at" : "2017-07-16T22:43:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127596033",
      "user" : {
         "avatar_url" : "https://avatars5.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@TheBlueMatt When starting with `-reindex`, and then restart before completing without `-reindex`, it seems to start over from scratch.",
      "created_at" : "2017-07-16T02:22:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10758#issuecomment-315576849",
      "id" : 315576849,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10758",
      "updated_at" : "2017-07-16T02:22:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/315576849",
      "user" : {
         "avatar_url" : "https://avatars5.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10758#discussion_r127618896"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10758"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127618896"
         }
      },
      "body" : "OK, rewrote the comment.",
      "commit_id" : "c93db429f909e75fbeacd2419fb8434350e3b674",
      "created_at" : "2017-07-16T22:44:06Z",
      "diff_hunk" : "@@ -3864,42 +3864,53 @@ void UnloadBlockIndex()\n bool LoadBlockIndex(const CChainParams& chainparams)\n {\n     // Load block index from databases\n-    if (!fReindex && !LoadBlockIndexDB(chainparams))\n-        return false;\n+    bool needs_init = fReindex;\n+    if (!fReindex) {\n+        bool ret = LoadBlockIndexDB(chainparams);\n+        if (!ret) return false;\n+        needs_init = mapBlockIndex.empty();\n+    }\n+\n+    if (needs_init) {\n+        // Note that LoadBlockIndexDB may have set fReindex if we shut down",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10758#discussion_r127618896",
      "id" : 127618896,
      "original_commit_id" : "ccc35ffdc0e5a47976b9f842bdbb9ad6a5a470e6",
      "original_position" : 14,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 50222368,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10758",
      "updated_at" : "2017-07-16T22:44:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127618896",
      "user" : {
         "avatar_url" : "https://avatars4.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "ACK \r\n\r\n@TheBlueMatt I retract my comment, everything seems to be working like before.\r\n",
      "created_at" : "2017-07-17T05:18:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10758#issuecomment-315669990",
      "id" : 315669990,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10758",
      "updated_at" : "2017-07-17T05:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/315669990",
      "user" : {
         "avatar_url" : "https://avatars5.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I'd like to see this in 0.15 as it at least turns an assert into an error message, in case your chainstate is out of sync with the block chain.",
      "created_at" : "2017-07-17T17:48:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10758#issuecomment-315828971",
      "id" : 315828971,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10758",
      "updated_at" : "2017-07-17T17:48:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/315828971",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "This (or some subset of it) absolutely has to land for 15, it fixes several regressions currently on master, but its a bugfix, so doesn't need to land today (but isnt small, so should go sooner rather than later).",
      "created_at" : "2017-07-17T17:49:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10758#issuecomment-315829317",
      "id" : 315829317,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10758",
      "updated_at" : "2017-07-17T17:49:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/315829317",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   }
]
