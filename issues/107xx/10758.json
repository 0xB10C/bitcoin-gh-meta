{
   "assignee" : null,
   "assignees" : [],
   "body" : "This does a number of things to clean up chainstate init order,\r\nfixing some issues as it goes:\r\n\r\n* Order chainstate init more logically - first all of the\r\n  blocktree-related loading, then coinsdb, then\r\n  pcoinsTip/chainActive. Only create objects as needed.\r\n\r\n* More clearly document exactly what is and isn't called in\r\n  -reindex and -reindex-chainstate both with comments noting\r\n  calls as no-ops and by adding if guards.\r\n\r\n* Move the writing of fTxIndex to LoadBlockIndex - this fixes a\r\n  bug introduced in d6af06d68aae985436cbc942f0d11078041d121b where\r\n  InitBlockIndex was writing to fTxIndex which had not yet been\r\n  checked (because LoadChainTip hadn't yet initialized the\r\n  chainActive, which would otherwise have resulted in\r\n  InitBlockIndex being a NOP), allowing you to modify -txindex\r\n  without reindex, potentially corrupting your chainstate!\r\n\r\n* Rename InitBlockIndex to LoadGenesisBlock, which is now a more\r\n  natural name for it. Also check mapBlockIndex instead of\r\n  chainActive, fixing a bug where we'd write the genesis block out\r\n  on every start.\r\n\r\n* Move LoadGenesisBlock further down in init. This is a more logical\r\n  location for it, as it is after all of the blockindex-related\r\n  loading and checking, but before any of the UTXO-related loading\r\n  and checking.\r\n\r\n* Give LoadChainTip a return value - allowing it to indicate that\r\n  the UTXO DB ran ahead of the block DB. This just provides a nicer\r\n  error message instead of the previous mysterious\r\n  assert(!setBlockIndexCandidates.empty()) error.\r\n\r\n* Calls ActivateBestChain in case we just loaded the genesis\r\n  block in LoadChainTip, avoiding relying on the ActivateBestChain\r\n  in ThreadImport before continuing init process.\r\n\r\n* Move all of the VerifyDB()-related stuff into a -reindex +\r\n  -reindex-chainstate if guard. It couldn't do anything useful\r\n  as chainActive.Tip() would be null at this point anyway.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 2,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10758/comments",
   "created_at" : "2017-07-07T00:06:29Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10758/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/10758",
   "id" : 241120858,
   "labels" : [
      {
         "color" : "E6F6D6",
         "default" : false,
         "id" : 135961,
         "name" : "Refactoring",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10758/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 10758,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/10758.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10758",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/10758.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10758"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Fix some chainstate-init-order bugs.",
   "updated_at" : "2017-07-07T01:33:28Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10758",
   "user" : {
      "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
      "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
      "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/TheBlueMatt",
      "id" : 649246,
      "login" : "TheBlueMatt",
      "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
      "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
      "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/TheBlueMatt"
   }
}
