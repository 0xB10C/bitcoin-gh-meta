[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26365](https://github.com/bitcoin/bitcoin/pull/26365) (wallet: GetEffectiveBalance by willcl-ark)\n* [#25659](https://github.com/bitcoin/bitcoin/pull/25659) (wallet: simplify ListCoins implementation by furszy)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-12-14T14:07:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26699#issuecomment-1351420865",
      "id" : 1351420865,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26699",
      "node_id" : "IC_kwDOABII585QjQvB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1351420865/reactions"
      },
      "updated_at" : "2022-12-15T00:43:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1351420865",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "While you're in this function, can you also fix #26687. It's a similar issue - we're now filtering for only spendable coins which excludes watch-only coins.",
      "created_at" : "2022-12-14T17:45:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26699#issuecomment-1351842161",
      "id" : 1351842161,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26699",
      "node_id" : "IC_kwDOABII585Qk3lx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1351842161/reactions"
      },
      "updated_at" : "2022-12-14T17:45:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1351842161",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> While you're in this function, can you also fix #26687. It's a similar issue - we're now filtering for only spendable coins which excludes watch-only coins.\r\n\r\nsure @achow101, will check it. Feel free to cc me for other similar stuff next time.",
      "created_at" : "2022-12-14T20:25:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26699#issuecomment-1352115123",
      "id" : 1352115123,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26699",
      "node_id" : "IC_kwDOABII585Ql6Oz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1352115123/reactions"
      },
      "updated_at" : "2022-12-14T20:25:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1352115123",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Added fixes for https://github.com/bitcoin/bitcoin/issues/26687.\r\n\r\n1) As we are using a cached balance on `WalletModel::getAvailableBalance`,\r\nthe function needs to include into the response the watch-only available\r\nbalance on wallets with private keys disabled.\r\n\r\n2) Inside the transaction creation process, the wallet needs to include the\r\nnon-spendable coins if private keys are disabled to allow the creation of\r\nPSBTs.\r\n\r\nNote:\r\nLet me know if want me to decouple this two fixes into a new PR.",
      "created_at" : "2022-12-15T01:55:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26699#issuecomment-1352454494",
      "id" : 1352454494,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26699",
      "node_id" : "IC_kwDOABII585QnNFe",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1352454494/reactions"
      },
      "updated_at" : "2022-12-15T01:59:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1352454494",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26699#discussion_r1051162240"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26699"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1051162240"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can we test for this?",
      "commit_id" : "30785b280e52edde67779b99903ad71298cfcb3f",
      "created_at" : "2022-12-16T21:06:26Z",
      "diff_hunk" : "@@ -897,7 +897,9 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n     // allowed (coins automatically selected by the wallet)\n     CoinsResult available_coins;\n     if (coin_control.m_allow_other_inputs) {\n-        available_coins = AvailableCoins(wallet, &coin_control, coin_selection_params.m_effective_feerate);\n+        CoinFilterParams params; // include non-spendable coins if this is a watch-only wallet\n+        params.only_spendable = !wallet.IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26699#discussion_r1051162240",
      "id" : 1051162240,
      "line" : 901,
      "node_id" : "PRRC_kwDOABII584-p3aA",
      "original_commit_id" : "30785b280e52edde67779b99903ad71298cfcb3f",
      "original_line" : 901,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 6,
      "pull_request_review_id" : 1221470050,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26699",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1051162240/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-16T21:06:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1051162240",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26699#discussion_r1051202175"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26699"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1051202175"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Actually, this change is not needed here. Will just drop it.\r\nI was using it to add support for creating PSBTs on legacy wallets that only know the pubkey hash and not the pubkey (in other terms, use `importaddress` instead of `importpubkey`). Which has never being possible.",
      "commit_id" : "30785b280e52edde67779b99903ad71298cfcb3f",
      "created_at" : "2022-12-16T22:12:54Z",
      "diff_hunk" : "@@ -897,7 +897,9 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n     // allowed (coins automatically selected by the wallet)\n     CoinsResult available_coins;\n     if (coin_control.m_allow_other_inputs) {\n-        available_coins = AvailableCoins(wallet, &coin_control, coin_selection_params.m_effective_feerate);\n+        CoinFilterParams params; // include non-spendable coins if this is a watch-only wallet\n+        params.only_spendable = !wallet.IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26699#discussion_r1051202175",
      "id" : 1051202175,
      "in_reply_to_id" : 1051162240,
      "line" : 901,
      "node_id" : "PRRC_kwDOABII584-qBJ_",
      "original_commit_id" : "30785b280e52edde67779b99903ad71298cfcb3f",
      "original_line" : 901,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 6,
      "pull_request_review_id" : 1221524223,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26699",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1051202175/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-16T22:12:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1051202175",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   }
]
