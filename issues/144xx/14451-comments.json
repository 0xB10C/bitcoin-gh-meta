[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->Reviewers, this pull request conflicts with the following ones:\n\n* #13100 (gui: Add dynamic wallets support by promag)\n* #11625 (Add BitcoinApplication & RPCConsole tests by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-10-10T00:17:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14451#issuecomment-428395698",
      "id" : 428395698,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14451",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyODM5NTY5OA==",
      "updated_at" : "2018-10-10T00:17:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/428395698",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2018-10-10T00:42:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14451#issuecomment-428399569",
      "id" : 428399569,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14451",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyODM5OTU2OQ==",
      "updated_at" : "2018-10-10T00:42:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/428399569",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2018-10-10T00:43:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14451#issuecomment-428399744",
      "id" : 428399744,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14451",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyODM5OTc0NA==",
      "updated_at" : "2018-10-10T00:43:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/428399744",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14451#discussion_r223907854"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14451"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223907854"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can drop the Qt 5 check here, master now requires > 5.0",
      "commit_id" : "3a093dd3296105e5770d3d334300981f4b184c8a",
      "created_at" : "2018-10-10T00:48:28Z",
      "diff_hunk" : "@@ -481,6 +382,145 @@ void PaymentServer::handleURIConnection()\n     handleURIOrFile(msg);\n }\n \n+void PaymentServer::setOptionsModel(OptionsModel *_optionsModel)\n+{\n+    this->optionsModel = _optionsModel;\n+}\n+\n+#ifdef ENABLE_BIP70\n+struct X509StoreDeleter {\n+      void operator()(X509_STORE* b) {\n+          X509_STORE_free(b);\n+      }\n+};\n+\n+struct X509Deleter {\n+      void operator()(X509* b) { X509_free(b); }\n+};\n+\n+namespace // Anon namespace\n+{\n+    std::unique_ptr<X509_STORE, X509StoreDeleter> certStore;\n+}\n+\n+static void ReportInvalidCertificate(const QSslCertificate& cert)\n+{\n+#if QT_VERSION < 0x050000",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14451#discussion_r223907854",
      "id" : 223907854,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMzkwNzg1NA==",
      "original_commit_id" : "5280b2949565dd42e84c77da7dbf47e15cfcb520",
      "original_position" : 293,
      "path" : "src/qt/paymentserver.cpp",
      "position" : null,
      "pull_request_review_id" : 163150853,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14451",
      "updated_at" : "2018-10-10T01:08:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223907854",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14451#discussion_r223907935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14451"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223907935"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can also remove the version check here",
      "commit_id" : "3a093dd3296105e5770d3d334300981f4b184c8a",
      "created_at" : "2018-10-10T00:48:53Z",
      "diff_hunk" : "@@ -481,6 +382,145 @@ void PaymentServer::handleURIConnection()\n     handleURIOrFile(msg);\n }\n \n+void PaymentServer::setOptionsModel(OptionsModel *_optionsModel)\n+{\n+    this->optionsModel = _optionsModel;\n+}\n+\n+#ifdef ENABLE_BIP70\n+struct X509StoreDeleter {\n+      void operator()(X509_STORE* b) {\n+          X509_STORE_free(b);\n+      }\n+};\n+\n+struct X509Deleter {\n+      void operator()(X509* b) { X509_free(b); }\n+};\n+\n+namespace // Anon namespace\n+{\n+    std::unique_ptr<X509_STORE, X509StoreDeleter> certStore;\n+}\n+\n+static void ReportInvalidCertificate(const QSslCertificate& cert)\n+{\n+#if QT_VERSION < 0x050000\n+    qDebug() << QString(\"%1: Payment server found an invalid certificate: \").arg(__func__) << cert.serialNumber() << cert.subjectInfo(QSslCertificate::CommonName) << cert.subjectInfo(QSslCertificate::OrganizationalUnitName);\n+#else\n+    qDebug() << QString(\"%1: Payment server found an invalid certificate: \").arg(__func__) << cert.serialNumber() << cert.subjectInfo(QSslCertificate::CommonName) << cert.subjectInfo(QSslCertificate::DistinguishedNameQualifier) << cert.subjectInfo(QSslCertificate::OrganizationalUnitName);\n+#endif\n+}\n+\n+//\n+// Load OpenSSL's list of root certificate authorities\n+//\n+void PaymentServer::LoadRootCAs(X509_STORE* _store)\n+{\n+    // Unit tests mostly use this, to pass in fake root CAs:\n+    if (_store)\n+    {\n+        certStore.reset(_store);\n+        return;\n+    }\n+\n+    // Normal execution, use either -rootcertificates or system certs:\n+    certStore.reset(X509_STORE_new());\n+\n+    // Note: use \"-system-\" default here so that users can pass -rootcertificates=\"\"\n+    // and get 'I don't like X.509 certificates, don't trust anybody' behavior:\n+    QString certFile = QString::fromStdString(gArgs.GetArg(\"-rootcertificates\", \"-system-\"));\n+\n+    // Empty store\n+    if (certFile.isEmpty()) {\n+        qDebug() << QString(\"PaymentServer::%1: Payment request authentication via X.509 certificates disabled.\").arg(__func__);\n+        return;\n+    }\n+\n+    QList<QSslCertificate> certList;\n+\n+    if (certFile != \"-system-\") {\n+            qDebug() << QString(\"PaymentServer::%1: Using \\\"%2\\\" as trusted root certificate.\").arg(__func__).arg(certFile);\n+\n+        certList = QSslCertificate::fromPath(certFile);\n+        // Use those certificates when fetching payment requests, too:\n+        QSslSocket::setDefaultCaCertificates(certList);\n+    } else\n+        certList = QSslSocket::systemCaCertificates();\n+\n+    int nRootCerts = 0;\n+    const QDateTime currentTime = QDateTime::currentDateTime();\n+\n+    for (const QSslCertificate& cert : certList) {\n+        // Don't log NULL certificates\n+        if (cert.isNull())\n+            continue;\n+\n+        // Not yet active/valid, or expired certificate\n+        if (currentTime < cert.effectiveDate() || currentTime > cert.expiryDate()) {\n+            ReportInvalidCertificate(cert);\n+            continue;\n+        }\n+\n+#if QT_VERSION >= 0x050000",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14451#discussion_r223907935",
      "id" : 223907935,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMzkwNzkzNQ==",
      "original_commit_id" : "5280b2949565dd42e84c77da7dbf47e15cfcb520",
      "original_position" : 350,
      "path" : "src/qt/paymentserver.cpp",
      "position" : null,
      "pull_request_review_id" : 163150916,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14451",
      "updated_at" : "2018-10-10T01:08:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223907935",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   }
]
