[
   {
      "body" : "Have you measured that this improves your propagation time more than just\nconnecting to a few fast peers? By the time you have sent out your block to\n100 well-connected peers, the last ones to get it likely could have already\ngotten it from eachother faster than from you, as more fast peers means you\nsuddenly need to do a lot more work to keep up with the sudden burst of\nnetwork packets to broadcast the block.\n\nIn any case, I do not think this serves the best interests of users of the\nsoftware. We have had several cases of people thinking that more\nconnections means faster confirmations of their transactions, or \"better\nvalidated\" blocks.\n\nIn the past we have also seen problems with the network running out of\nconnectable slots, so we have actively avoided options for people to\noverwelm the network with connections. I'm very aware an attacker could do\nthis anyhow, but this is more about preventing people from hurting the\nnetwork while incorrectly believing it benefits them (for non-miners, a\nsingle connection to a non-compromised is as good as any higher number).\n\nI believe this equally would not actually benefit you.\n",
      "created_at" : "2015-04-15T04:40:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93185470",
      "id" : 93185470,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6014",
      "updated_at" : "2015-04-15T04:40:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/93185470",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Pool servers typically are run from datacenter grade gigabit connections or better so I don't think bandwidth is that big of an issue most of the time. My pool server with nearly 6000 active miner connections is normally running at under 5% CPU usage total for all applications at nearly any time, this includes bitcoind, stratum server, database, web front end and relay node. I don't really see what type of resource bottleneck I would be running into.\r\n\r\nUnless a pool server is expected to run with 8 or less connections total I think that increasing the max outbound to match the max connections would help ensure that the pool is only connecting to well connected nodes rather than nodes behind NAT that would propagate slower(more hops required). The other issue is that even when allowing inbound connections it is difficult to reach the the default max of 125. I haven't been able to test this myself but I don't see why this change wouldn't help. When starting up a pool server it takes a long time to start getting more connections than the initial 8.\r\n\r\nI agree this option could cause problems if too many people enabled it, but I think we need a better solution than just hard coding the outbound connection count to be 8(I think hard-coding arbitrary variables is a bad idea). Do you have any ideas on how one might go about making this option hard for people not running pools to enable? I don't want to maintain a fork of bitcoin just because someone decided to hard code one variable. Maybe force the user to add \"-isweariamactuallyrunningaminingpool\" to their config in order to enable this option.",
      "created_at" : "2015-04-15T05:13:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93191485",
      "id" : 93191485,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6014",
      "updated_at" : "2015-04-15T05:13:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/93191485",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3298484?v=3",
         "events_url" : "https://api.github.com/users/jameshilliard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jameshilliard/followers",
         "following_url" : "https://api.github.com/users/jameshilliard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jameshilliard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jameshilliard",
         "id" : 3298484,
         "login" : "jameshilliard",
         "organizations_url" : "https://api.github.com/users/jameshilliard/orgs",
         "received_events_url" : "https://api.github.com/users/jameshilliard/received_events",
         "repos_url" : "https://api.github.com/users/jameshilliard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jameshilliard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jameshilliard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jameshilliard"
      }
   },
   {
      "body" : "Making it easily possible to increase the default outgoing connections above 8 would put undue load on the network. See the discussion in #4687 as well as many previous discussions.\r\n\r\nIf you want lots of connections, raise the maximum number of incoming connections instead. I have no trouble on my longer running nodes to get lots of incoming connections. \"NAT restricted\" doesn't change much, I'd hope that the larger pool servers won't be running on someone's home network (but even on my home network the router's port forwarding doesn't seem to impose a low connection limit).",
      "created_at" : "2015-04-15T08:08:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93253349",
      "id" : 93253349,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6014",
      "updated_at" : "2015-04-15T08:14:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/93253349",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Would it really cause an issue if it was only pool servers that were increasing this limit? It seems this option can be beneficial to pool operators but its not being considered because nobody trusts the users. I'm not a fan of crippling software because someone *might* abuse a feature. The comment in that discussion is only talking about regular users and regular nodes and doesn't seem apply to this use case. \r\n\r\nFrom what I've been reading its been historically common for pool operators to override this option in order to improve connectivity. I'm also wondering who came up with 8 as the default for outbound connections and 125 as the default max connection limit? 8 and 125 are pretty specific numbers and it would be good to know how people came up with them. \r\n\r\nOne other thing I'm wondering is why bitcoind can't just establish thousands of connections like other p2p protocols can? Is the core networking code just in really bad shape or is it something else?",
      "created_at" : "2015-04-15T08:35:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93261239",
      "id" : 93261239,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6014",
      "updated_at" : "2015-04-15T08:35:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/93261239",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3298484?v=3",
         "events_url" : "https://api.github.com/users/jameshilliard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jameshilliard/followers",
         "following_url" : "https://api.github.com/users/jameshilliard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jameshilliard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jameshilliard",
         "id" : 3298484,
         "login" : "jameshilliard",
         "organizations_url" : "https://api.github.com/users/jameshilliard/orgs",
         "received_events_url" : "https://api.github.com/users/jameshilliard/received_events",
         "repos_url" : "https://api.github.com/users/jameshilliard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jameshilliard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jameshilliard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jameshilliard"
      }
   },
   {
      "body" : "bitcoind's network code can deal with around 1000 connections, due to the file descriptor limits of select().\r\n",
      "created_at" : "2015-04-15T10:14:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93303190",
      "id" : 93303190,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6014",
      "updated_at" : "2015-04-15T10:14:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/93303190",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "The reason for the default restriction of 125 is to \r\n- cope with shitty routers that crash with lots of connections\r\n- bound the memory usage; every active connection will have send/receive buffers and some other associated data\r\n\r\nIf these are not concerns for you, you can increase the number of incoming connections up to the select limit (as @sipa mentions).",
      "created_at" : "2015-04-15T11:43:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93344202",
      "id" : 93344202,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6014",
      "updated_at" : "2015-04-15T11:43:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/93344202",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Anyhow, if you trust yourself enough to not abuse this feature you can remove the cap in your local builds. This is open source and there's nothing 'we' can do to prevent you from that (although there are some ideas with regard to banning mass connectors*) . But this can not be merged unless you cap the maximum to 8.\r\n\r\n*: not because of you, but the other, malicious use case for mass connecting are 'listening nodes' that try to subvert privacy by correlation of transaction origins (see #3828)\r\n",
      "created_at" : "2015-04-15T11:46:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93346755",
      "id" : 93346755,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6014",
      "updated_at" : "2015-04-15T11:53:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/93346755",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@sipa it is common for pool servers and other servers with lots of connections to override the OS file descriptor limitation, maybe moving to something libevent based for networking would help scalability.\r\n\r\n@laanwj so that more or less explains why 125 is set as the default for inbound but I have yet to hear where the number 8 comes from and why it is hard coded.\r\n\r\nOne other use case may be for pools that are NAT restricted for reasons outside of their control such as being on farm sites where only wireless internet is available in countries with unreliable backbones. If a pool gets NAT restricted then it gets stuck at the 8 outbound connection limitation which seems far less than ideal. In addition during start-up incoming connections can take a very long time to get anywhere close to 125 even on pools without NAT restrictions.",
      "created_at" : "2015-04-15T22:35:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93588268",
      "id" : 93588268,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6014",
      "updated_at" : "2015-04-15T22:35:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/93588268",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3298484?v=3",
         "events_url" : "https://api.github.com/users/jameshilliard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jameshilliard/followers",
         "following_url" : "https://api.github.com/users/jameshilliard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jameshilliard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jameshilliard",
         "id" : 3298484,
         "login" : "jameshilliard",
         "organizations_url" : "https://api.github.com/users/jameshilliard/orgs",
         "received_events_url" : "https://api.github.com/users/jameshilliard/received_events",
         "repos_url" : "https://api.github.com/users/jameshilliard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jameshilliard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jameshilliard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jameshilliard"
      }
   },
   {
      "body" : "There was a long discussion on IRC yesterday about why its probably bad even for a pool server to increase the limit significantly. I'm assuming that was you? If not, you should go read it. http://bitcoinstats.com/irc/bitcoin-dev/logs/2015/04/14#l1429040973",
      "created_at" : "2015-04-15T23:10:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93593735",
      "id" : 93593735,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6014",
      "updated_at" : "2015-04-15T23:10:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/93593735",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@TheBlueMatt Yes that was me, how would you go about calculating the ideal number of connections a pool server should make in cases where manually establishing connections to trusted nodes is not possible?",
      "created_at" : "2015-04-15T23:14:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93594599",
      "id" : 93594599,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6014",
      "updated_at" : "2015-04-15T23:14:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/93594599",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3298484?v=3",
         "events_url" : "https://api.github.com/users/jameshilliard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jameshilliard/followers",
         "following_url" : "https://api.github.com/users/jameshilliard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jameshilliard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jameshilliard",
         "id" : 3298484,
         "login" : "jameshilliard",
         "organizations_url" : "https://api.github.com/users/jameshilliard/orgs",
         "received_events_url" : "https://api.github.com/users/jameshilliard/received_events",
         "repos_url" : "https://api.github.com/users/jameshilliard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jameshilliard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jameshilliard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jameshilliard"
      }
   },
   {
      "body" : "A pool server should run its mining bitcoind behind a firewall with only connections to other bitcoinds, which are making 8 outgoing connections and accepting other connections, as well as a connection to the relay network (and maybe other similar networks...if someone set them up). But, really, this is not the place to discuss pool architecture.",
      "created_at" : "2015-04-15T23:19:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93595340",
      "id" : 93595340,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6014",
      "updated_at" : "2015-04-15T23:19:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/93595340",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@TheBlueMatt In areas with poor internet connectivity such as China where mining sites and operators aren't able to reliably set up their own offsite nodes I think a better solution such as this is often needed. The outbound connection limit of 8 just seems very arbitrary. Your suggestion of running multiple nodes seems to itself be a workaround to getting more than 8 outbound connections to the bitcoin network since its basically running more nodes as a way to increase bitcoind's arbitrary connection limitation. \r\n\r\nFor example I don't see how running 5 nodes with the default limitations of 8 outbound connections each and 125 inbound connections each for a total of 40 outbound and 625 inbound connections would be all that different from just running a single node with 40 outbound and 625 inbound connections allowed. The current bitcoind design encourages people to run a whole lot of small nodes on low resource systems instead of using larger more powerful systems that could perform much better by providing a high performance backbone for the bitcoin network.",
      "created_at" : "2015-04-16T00:12:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6014#issuecomment-93603754",
      "id" : 93603754,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6014",
      "updated_at" : "2015-04-16T00:12:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/93603754",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3298484?v=3",
         "events_url" : "https://api.github.com/users/jameshilliard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jameshilliard/followers",
         "following_url" : "https://api.github.com/users/jameshilliard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jameshilliard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jameshilliard",
         "id" : 3298484,
         "login" : "jameshilliard",
         "organizations_url" : "https://api.github.com/users/jameshilliard/orgs",
         "received_events_url" : "https://api.github.com/users/jameshilliard/received_events",
         "repos_url" : "https://api.github.com/users/jameshilliard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jameshilliard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jameshilliard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jameshilliard"
      }
   }
]
