[
   {
      "body" : "It should only notify for transactions for the address(es) that you `importaddress`ed.\r\n\r\nCan you add concrete steps to reproduce?",
      "created_at" : "2015-05-04T09:25:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6095#issuecomment-98649214",
      "id" : 98649214,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6095",
      "updated_at" : "2015-05-04T09:25:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/98649214",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I did this in -regtest mode. So, run bitcoind -regtest -daemon. Generate a few blocks:\r\n\r\n  `bitcoin-cli -regtest setgenerate true 50`\r\n\r\nGenerate a random address and import it:\r\n\r\n `bitcoin-cli -regtest importaddress mo7W7FBZqg4frF5XtchSJUNVhjkbNr9aWB`\r\n\r\nAnd now you get a flurry of transactions being notified. Sometimes it exhausts all memory in my laptop and crashes it.",
      "created_at" : "2015-05-04T12:48:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6095#issuecomment-98697834",
      "id" : 98697834,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6095",
      "updated_at" : "2015-05-04T12:48:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/98697834",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/528489?v=3",
         "events_url" : "https://api.github.com/users/eriksank/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eriksank/followers",
         "following_url" : "https://api.github.com/users/eriksank/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eriksank/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eriksank",
         "id" : 528489,
         "login" : "eriksank",
         "organizations_url" : "https://api.github.com/users/eriksank/orgs",
         "received_events_url" : "https://api.github.com/users/eriksank/received_events",
         "repos_url" : "https://api.github.com/users/eriksank/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eriksank/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eriksank/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eriksank"
      }
   },
   {
      "body" : "~~This is technically not a bug of bitcoind.  The example you cite is entirely legitimate to rapid fire all the unique txid's as separate walletnotify events.~~\r\n\r\nExhausting all memory and crashing is the fault of your implementation.  walletnotify is firing off many near-simultaneous processes, each of which is probably doing a RPC query in return to bitcoind.  bitcoind services only 4 simultaneous RPC connections (almost true), certain things can cause all the queries to stall, and the responses can be fairly slow.\r\n\r\nIncreasing your resource limits wouldn't hurt but doing so won't fix the real problem.\r\n\r\nResponding to every walletnotify in parallel might be a bad idea.  Maybe you need whatever walletnotify is doing to finish instantly after adding the txid to an queue, and have a separate event loop that processes them one at a time.",
      "created_at" : "2015-05-13T09:30:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6095#issuecomment-101592126",
      "id" : 101592126,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6095",
      "updated_at" : "2015-05-13T10:02:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/101592126",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/93665?v=3",
         "events_url" : "https://api.github.com/users/wtogami/events{/privacy}",
         "followers_url" : "https://api.github.com/users/wtogami/followers",
         "following_url" : "https://api.github.com/users/wtogami/following{/other_user}",
         "gists_url" : "https://api.github.com/users/wtogami/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/wtogami",
         "id" : 93665,
         "login" : "wtogami",
         "organizations_url" : "https://api.github.com/users/wtogami/orgs",
         "received_events_url" : "https://api.github.com/users/wtogami/received_events",
         "repos_url" : "https://api.github.com/users/wtogami/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/wtogami/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/wtogami/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/wtogami"
      }
   },
   {
      "body" : "Here's another way to understand it ... `importaddress` is not at fault.  The very same failure of your system could happen if a lot of transactions hit your wallet fast enough.",
      "created_at" : "2015-05-13T09:36:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6095#issuecomment-101594566",
      "id" : 101594566,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6095",
      "updated_at" : "2015-05-13T09:40:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/101594566",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/93665?v=3",
         "events_url" : "https://api.github.com/users/wtogami/events{/privacy}",
         "followers_url" : "https://api.github.com/users/wtogami/followers",
         "following_url" : "https://api.github.com/users/wtogami/following{/other_user}",
         "gists_url" : "https://api.github.com/users/wtogami/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/wtogami",
         "id" : 93665,
         "login" : "wtogami",
         "organizations_url" : "https://api.github.com/users/wtogami/orgs",
         "received_events_url" : "https://api.github.com/users/wtogami/received_events",
         "repos_url" : "https://api.github.com/users/wtogami/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/wtogami/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/wtogami/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/wtogami"
      }
   },
   {
      "body" : "Oh wait ... if #6084 ~~is a real bug~~, then `importaddress` could be hitting the same problem.\r\n\r\nIf your system is running out of memory and crashing from your regtest example of only 50 transactions, it is entirely possible it could die during normal operation if hit quickly enough.",
      "created_at" : "2015-05-13T10:00:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6095#issuecomment-101605108",
      "id" : 101605108,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6095",
      "updated_at" : "2015-05-13T10:40:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/101605108",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/93665?v=3",
         "events_url" : "https://api.github.com/users/wtogami/events{/privacy}",
         "followers_url" : "https://api.github.com/users/wtogami/followers",
         "following_url" : "https://api.github.com/users/wtogami/following{/other_user}",
         "gists_url" : "https://api.github.com/users/wtogami/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/wtogami",
         "id" : 93665,
         "login" : "wtogami",
         "organizations_url" : "https://api.github.com/users/wtogami/orgs",
         "received_events_url" : "https://api.github.com/users/wtogami/received_events",
         "repos_url" : "https://api.github.com/users/wtogami/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/wtogami/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/wtogami/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/wtogami"
      }
   },
   {
      "body" : "RPC might be stuck entirely during the importaddress rescan, thereby guaranteeing all the walletnotify processes will be stuck if they are waiting for RPC to respond.  Queuing the RPC commands for one at a time execution would safely handle this.",
      "created_at" : "2015-05-13T10:04:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6095#issuecomment-101606853",
      "id" : 101606853,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6095",
      "updated_at" : "2015-05-13T10:39:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/101606853",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/93665?v=3",
         "events_url" : "https://api.github.com/users/wtogami/events{/privacy}",
         "followers_url" : "https://api.github.com/users/wtogami/followers",
         "following_url" : "https://api.github.com/users/wtogami/following{/other_user}",
         "gists_url" : "https://api.github.com/users/wtogami/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/wtogami",
         "id" : 93665,
         "login" : "wtogami",
         "organizations_url" : "https://api.github.com/users/wtogami/orgs",
         "received_events_url" : "https://api.github.com/users/wtogami/received_events",
         "repos_url" : "https://api.github.com/users/wtogami/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/wtogami/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/wtogami/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/wtogami"
      }
   },
   {
      "body" : "If the complaint in #6084 for `importprivkey` and here for `importaddress` is the unrelated transactions causing walletnotify, then the real complaint is both commands causing a full rescan instead of looking at only a particular privkey or address.",
      "created_at" : "2015-05-13T10:38:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6095#issuecomment-101619439",
      "id" : 101619439,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6095",
      "updated_at" : "2015-05-13T10:38:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/101619439",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/93665?v=3",
         "events_url" : "https://api.github.com/users/wtogami/events{/privacy}",
         "followers_url" : "https://api.github.com/users/wtogami/followers",
         "following_url" : "https://api.github.com/users/wtogami/following{/other_user}",
         "gists_url" : "https://api.github.com/users/wtogami/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/wtogami",
         "id" : 93665,
         "login" : "wtogami",
         "organizations_url" : "https://api.github.com/users/wtogami/orgs",
         "received_events_url" : "https://api.github.com/users/wtogami/received_events",
         "repos_url" : "https://api.github.com/users/wtogami/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/wtogami/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/wtogami/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/wtogami"
      }
   }
]
