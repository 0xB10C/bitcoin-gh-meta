[
   {
      "body" : "The HMAC for address inventory hashing is absolute overkill, but was easy to write. I doubt the performance matters.",
      "created_at" : "2015-04-25T16:41:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#issuecomment-96234859",
      "id" : 96234859,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6064",
      "updated_at" : "2015-04-25T16:41:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/96234859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Rebased on top of @gavinandresen's #6066 (so that I don't need the address hasher here).\r\n\r\nRemoved the boost::unordered_set usage for now, as it is incompatible with older boost versions (which don't have unordered_set::reserve).",
      "created_at" : "2015-04-25T21:47:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#issuecomment-96284019",
      "id" : 96284019,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6064",
      "updated_at" : "2015-04-25T21:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/96284019",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29112655"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29112655"
         }
      },
      "body" : "I'm probably just an old fuddy-duddy...\r\n... but I find the \"use swap to assign\" idiom hard to review.\r\nWhy not just:\r\norder.assign(nMaxSizeIn, set.end());\r\n",
      "commit_id" : "1d0997a32370b7a6a1012651f98e7ede1b5bae1f",
      "created_at" : "2015-04-26T18:58:34Z",
      "diff_hunk" : "@@ -22,21 +22,26 @@ class mruset\n \n protected:\n     std::set<T> set;\n-    std::deque<T> queue;\n+    std::vector<iterator> order;\n+    size_type first_used;\n+    size_type first_unused;\n     size_type nMaxSize;\n \n public:\n-    mruset(size_type nMaxSizeIn = 0) { nMaxSize = nMaxSizeIn; }\n+    mruset(size_type nMaxSizeIn = 1) { clear(nMaxSizeIn); }\n     iterator begin() const { return set.begin(); }\n     iterator end() const { return set.end(); }\n     size_type size() const { return set.size(); }\n     bool empty() const { return set.empty(); }\n     iterator find(const key_type& k) const { return set.find(k); }\n     size_type count(const key_type& k) const { return set.count(k); }\n-    void clear()\n+    void clear(size_type nMaxSizeIn = 1)\n     {\n         set.clear();\n-        queue.clear();\n+        std::vector<iterator>(nMaxSizeIn, set.end()).swap(order);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29112655",
      "id" : 29112655,
      "original_commit_id" : "8ba847459421e9786fd8c25c9303027df6b9f3d7",
      "original_position" : 39,
      "path" : "src/mruset.h",
      "position" : 39,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064",
      "updated_at" : "2015-04-26T20:57:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29112655",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29112682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29112682"
         }
      },
      "body" : "Save a line of code with:\r\nfirst_used = (first_used+1)%nMaxSize;",
      "commit_id" : "1d0997a32370b7a6a1012651f98e7ede1b5bae1f",
      "created_at" : "2015-04-26T19:03:01Z",
      "diff_hunk" : "@@ -45,25 +50,19 @@ class mruset\n     {\n         std::pair<iterator, bool> ret = set.insert(x);\n         if (ret.second) {\n-            if (nMaxSize && queue.size() == nMaxSize) {\n-                set.erase(queue.front());\n-                queue.pop_front();\n+            if (set.size() == nMaxSize + 1) {\n+                set.erase(order[first_used]);\n+                order[first_used] = set.end();\n+                first_used++;\n+                if (first_used == nMaxSize) { first_used = 0; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29112682",
      "id" : 29112682,
      "original_commit_id" : "8ba847459421e9786fd8c25c9303027df6b9f3d7",
      "original_position" : 57,
      "path" : "src/mruset.h",
      "position" : 57,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064",
      "updated_at" : "2015-04-26T20:57:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29112682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "Code review ACK-- note I changed the CRollingBloomFilter implementation commit in #6066 .\r\n\r\nMeasured heap usage on OSX for a 1,000-entry mruset<CInv> : 72,192 bytes.\r\n(before this change: 100,992 bytes).\r\n\r\nI'm running a node with these changes now.\r\n",
      "created_at" : "2015-04-26T19:24:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#issuecomment-96422464",
      "id" : 96422464,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6064",
      "updated_at" : "2015-04-26T19:24:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/96422464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29113580"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29113580"
         }
      },
      "body" : "It's horrible, but it's the only way to make a vector release its memory, afaik.",
      "commit_id" : "1d0997a32370b7a6a1012651f98e7ede1b5bae1f",
      "created_at" : "2015-04-26T20:39:45Z",
      "diff_hunk" : "@@ -22,21 +22,26 @@ class mruset\n \n protected:\n     std::set<T> set;\n-    std::deque<T> queue;\n+    std::vector<iterator> order;\n+    size_type first_used;\n+    size_type first_unused;\n     size_type nMaxSize;\n \n public:\n-    mruset(size_type nMaxSizeIn = 0) { nMaxSize = nMaxSizeIn; }\n+    mruset(size_type nMaxSizeIn = 1) { clear(nMaxSizeIn); }\n     iterator begin() const { return set.begin(); }\n     iterator end() const { return set.end(); }\n     size_type size() const { return set.size(); }\n     bool empty() const { return set.empty(); }\n     iterator find(const key_type& k) const { return set.find(k); }\n     size_type count(const key_type& k) const { return set.count(k); }\n-    void clear()\n+    void clear(size_type nMaxSizeIn = 1)\n     {\n         set.clear();\n-        queue.clear();\n+        std::vector<iterator>(nMaxSizeIn, set.end()).swap(order);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29113580",
      "id" : 29113580,
      "original_commit_id" : "8ba847459421e9786fd8c25c9303027df6b9f3d7",
      "original_position" : 39,
      "path" : "src/mruset.h",
      "position" : 39,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064",
      "updated_at" : "2015-04-26T20:57:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29113580",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29113583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29113583"
         }
      },
      "body" : "Modulo operator is slow, if it's not a compile-time known power-of-two constant.",
      "commit_id" : "1d0997a32370b7a6a1012651f98e7ede1b5bae1f",
      "created_at" : "2015-04-26T20:40:23Z",
      "diff_hunk" : "@@ -45,25 +50,19 @@ class mruset\n     {\n         std::pair<iterator, bool> ret = set.insert(x);\n         if (ret.second) {\n-            if (nMaxSize && queue.size() == nMaxSize) {\n-                set.erase(queue.front());\n-                queue.pop_front();\n+            if (set.size() == nMaxSize + 1) {\n+                set.erase(order[first_used]);\n+                order[first_used] = set.end();\n+                first_used++;\n+                if (first_used == nMaxSize) { first_used = 0; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29113583",
      "id" : 29113583,
      "original_commit_id" : "8ba847459421e9786fd8c25c9303027df6b9f3d7",
      "original_position" : 57,
      "path" : "src/mruset.h",
      "position" : 57,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064",
      "updated_at" : "2015-04-26T20:57:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29113583",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29113708"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29113708"
         }
      },
      "body" : "Updated to use another one-line construct.",
      "commit_id" : "1d0997a32370b7a6a1012651f98e7ede1b5bae1f",
      "created_at" : "2015-04-26T20:58:11Z",
      "diff_hunk" : "@@ -45,25 +50,19 @@ class mruset\n     {\n         std::pair<iterator, bool> ret = set.insert(x);\n         if (ret.second) {\n-            if (nMaxSize && queue.size() == nMaxSize) {\n-                set.erase(queue.front());\n-                queue.pop_front();\n+            if (set.size() == nMaxSize + 1) {\n+                set.erase(order[first_used]);\n+                order[first_used] = set.end();\n+                first_used++;\n+                if (first_used == nMaxSize) { first_used = 0; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29113708",
      "id" : 29113708,
      "original_commit_id" : "8ba847459421e9786fd8c25c9303027df6b9f3d7",
      "original_position" : 57,
      "path" : "src/mruset.h",
      "position" : 57,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064",
      "updated_at" : "2015-04-26T20:58:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29113708",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Rebased on updated #6066, and addressed a nit.",
      "created_at" : "2015-04-26T20:59:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#issuecomment-96434748",
      "id" : 96434748,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6064",
      "updated_at" : "2015-04-26T20:59:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/96434748",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@gavinandresen I measure around a 50 byte overhead per mruset entry now. Before, it was 50 bytes + double storage of the elements.",
      "created_at" : "2015-04-26T21:04:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#issuecomment-96435183",
      "id" : 96435183,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6064",
      "updated_at" : "2015-04-26T21:13:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/96435183",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
