[
   {
      "author_association" : "MEMBER",
      "body" : "Nice observation.\r\n\r\n(Brainstorm idea) How about something like doubling the timeout every time it causes a disconnection. And then reducing/resetting it when the window actually moves?",
      "created_at" : "2022-08-19T19:51:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25880#issuecomment-1221043636",
      "id" : 1221043636,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25880",
      "node_id" : "IC_kwDOABII585Ix6W0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1221043636/reactions"
      },
      "updated_at" : "2022-08-19T19:51:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1221043636",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">Collect statistics from recent block download times during IBD and have a dynamic timeout based on this. (Introduces more complexity, but might be better in certain situations, e.g. when 6s aren't sufficient either).\r\n\r\nRather than this, it might be better to track download speeds from each peer, and check the speeds of this peer after 2 seconds.\r\n\r\nFor an immediate fix, though, maybe just making the timeout configurable would be a good idea?\r\n\r\nPerhaps as an interim between these two ideas, if we disconnect N stalling peers, start increasing the timeout.",
      "created_at" : "2022-08-20T20:40:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25880#issuecomment-1221405113",
      "id" : 1221405113,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25880",
      "node_id" : "IC_kwDOABII585IzSm5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1221405113/reactions"
      },
      "updated_at" : "2022-08-20T20:40:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1221405113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Rather than this, it might be better to track download speeds from each peer, and check the speeds of this peer after 2 seconds.\r\n\r\nWe would also have to compare it to the speed of others and have some criterion what deviation would be enough to disconnect.\r\n\r\n>How about something like doubling the timeout every time it causes a disconnection. And then reducing/resetting it when the window actually moves?\r\n\r\n> Perhaps as an interim between these two ideas, if we disconnect N stalling peers, start increasing the timeout.\r\n\r\nThanks! These suggestions are similar, make a lot of sense to me, and don't look very invasive to implement, planning to change to this approach and update soon.",
      "created_at" : "2022-08-22T14:21:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25880#issuecomment-1222432129",
      "id" : 1222432129,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25880",
      "node_id" : "IC_kwDOABII585I3NWB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1222432129/reactions"
      },
      "updated_at" : "2022-08-22T14:21:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1222432129",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I now implemented the suggestion by @sipa to double the timeout and updated the OP.\r\n\r\nI tested this manually by catching up to the best chain with an ~1 month old datadir with `-onlynet=tor` (slow, blocks take ~10s to download), while reducing `BLOCK_DOWNLOAD_WINDOW` and `MAX_BLOCKS_IN_TRANSIT_PER_PEER` to make stalling situations happen more quickly. ",
      "created_at" : "2022-08-24T15:06:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25880#issuecomment-1225853199",
      "id" : 1225853199,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25880",
      "node_id" : "IC_kwDOABII585JEQkP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1225853199/reactions"
      },
      "updated_at" : "2022-08-24T15:08:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1225853199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   }
]
