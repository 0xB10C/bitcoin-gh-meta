[
   {
      "author_association" : "NONE",
      "body" : "Note: I tried to locate the message \"ignoring getheaders from peer=0 because node is in initial block download\" emitted in [net_processing.cpp:3223] [ProcessMessage], but this is not what we have in the sources here. I see this message only in very old versions of Bitcoin sources.\r\n\r\nSo Bitcoin v23 was compiled from some sources that were out of sync (probably on another test branch, not meant to be part of the release).\r\n\r\nIt seems also that the test for seeing if some lock must be released is inverted (so this can explain the 100% CPU use seen on one CPU core by a thread runing the tight loop almost forever, of waiting for some exception or event which will come only when we shut down)",
      "created_at" : "2022-08-07T13:56:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25800#issuecomment-1207414185",
      "id" : 1207414185,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25800",
      "node_id" : "IC_kwDOABII585H962p",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207414185/reactions"
      },
      "updated_at" : "2022-08-07T14:00:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207414185",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1387035?v=4",
         "events_url" : "https://api.github.com/users/verdy-p/events{/privacy}",
         "followers_url" : "https://api.github.com/users/verdy-p/followers",
         "following_url" : "https://api.github.com/users/verdy-p/following{/other_user}",
         "gists_url" : "https://api.github.com/users/verdy-p/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/verdy-p",
         "id" : 1387035,
         "login" : "verdy-p",
         "node_id" : "MDQ6VXNlcjEzODcwMzU=",
         "organizations_url" : "https://api.github.com/users/verdy-p/orgs",
         "received_events_url" : "https://api.github.com/users/verdy-p/received_events",
         "repos_url" : "https://api.github.com/users/verdy-p/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/verdy-p/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/verdy-p/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/verdy-p"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "https://github.com/bitcoin/bitcoin/blob/v23.0/src/net_processing.cpp#L3223",
      "created_at" : "2022-08-07T13:59:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25800#issuecomment-1207414742",
      "id" : 1207414742,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25800",
      "node_id" : "IC_kwDOABII585H96_W",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207414742/reactions"
      },
      "updated_at" : "2022-08-07T13:59:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207414742",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "It seems that the way that ```LOCK(cs_main)``` are called is faulty, this is a real mess in a giant function containing many successive but exclusive if() that should be a switch to smaller functions. How are locks released when you return early without processing a message?",
      "created_at" : "2022-08-07T14:13:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25800#issuecomment-1207417692",
      "id" : 1207417692,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25800",
      "node_id" : "IC_kwDOABII585H97tc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207417692/reactions"
      },
      "updated_at" : "2022-08-07T14:13:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207417692",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1387035?v=4",
         "events_url" : "https://api.github.com/users/verdy-p/events{/privacy}",
         "followers_url" : "https://api.github.com/users/verdy-p/followers",
         "following_url" : "https://api.github.com/users/verdy-p/following{/other_user}",
         "gists_url" : "https://api.github.com/users/verdy-p/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/verdy-p",
         "id" : 1387035,
         "login" : "verdy-p",
         "node_id" : "MDQ6VXNlcjEzODcwMzU=",
         "organizations_url" : "https://api.github.com/users/verdy-p/orgs",
         "received_events_url" : "https://api.github.com/users/verdy-p/received_events",
         "repos_url" : "https://api.github.com/users/verdy-p/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/verdy-p/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/verdy-p/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/verdy-p"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Anyway I do not understand why a node A in IBD (having for example here 300K blocks synchronized) that is connecting to a full node B (which is fully in sync with 760K blocks for now) and requests it a set of headers, gets these headers, but then node B needs to request headers to node A: how can a full node in sync request any headers (in the 760K blocks) to a node in IBD which does not have them, when node B ***knows*** that node A was just syncing (in the 300K blocks, several years behind)?\r\n\r\nNote that my node and the remote node were both using the v23 version of Bitcoin core... v23 seems to work OK only for a node that is already in sync (or not too far behind, so that a single headers request at most would allow them to know they are in sync). I've also seen in Bitcoin.io that v23 nodes seem now to be frequently stalling near the best tip. They apparently need to be regularly shut down and restarted to resync them.\r\n\r\nIn other words the logic for sync'ing nodes (even those that are not in IBD) is broken now in v23.",
      "created_at" : "2022-08-07T15:40:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25800#issuecomment-1207433696",
      "id" : 1207433696,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25800",
      "node_id" : "IC_kwDOABII585H9_ng",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207433696/reactions"
      },
      "updated_at" : "2022-08-07T15:44:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207433696",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1387035?v=4",
         "events_url" : "https://api.github.com/users/verdy-p/events{/privacy}",
         "followers_url" : "https://api.github.com/users/verdy-p/followers",
         "following_url" : "https://api.github.com/users/verdy-p/following{/other_user}",
         "gists_url" : "https://api.github.com/users/verdy-p/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/verdy-p",
         "id" : 1387035,
         "login" : "verdy-p",
         "node_id" : "MDQ6VXNlcjEzODcwMzU=",
         "organizations_url" : "https://api.github.com/users/verdy-p/orgs",
         "received_events_url" : "https://api.github.com/users/verdy-p/received_events",
         "repos_url" : "https://api.github.com/users/verdy-p/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/verdy-p/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/verdy-p/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/verdy-p"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Note also that even if downloading headers stalls (only advanced by about 1000 blocks at each run), the number of fully downloaded blocks NEVER progresses; all the available ones are already indexed, have their \"rev*dat\" file ready, the transaction indexi and coinbase indexes seem to progress (but only according to logs: in fact, some of them are merged to regenerate a new top index while the previous top index is deleted; there remains only indexes for the very old blocks); but according to statistics we are froen always to the same full block.\r\n\r\nI've enabled all documented \"check*\" options and validations, no probelm or corruption is ever detected.\r\nHave you tried to resync any FRESH full node recently (with no other data)?\r\nIs it likelty that some parts of full data for some blocks are ONLY available via Tor and not from any other node in the P2P network (via IPv4, IPVv6, or I2P), and not available even in so called \"full nodes\"? Or that I'm stuck in a dead branch of the network each time I try (note that my node is reachable via both IPv4 and IPv6, it uses UPnP for NAT over IPv4, but IPv6 is direct), and that my IPs are not reachable from some parts of the Internet, so that I need to use proxies?\r\n",
      "created_at" : "2022-08-07T17:12:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25800#issuecomment-1207448708",
      "id" : 1207448708,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25800",
      "node_id" : "IC_kwDOABII585H-DSE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207448708/reactions"
      },
      "updated_at" : "2022-08-07T17:12:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207448708",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1387035?v=4",
         "events_url" : "https://api.github.com/users/verdy-p/events{/privacy}",
         "followers_url" : "https://api.github.com/users/verdy-p/followers",
         "following_url" : "https://api.github.com/users/verdy-p/following{/other_user}",
         "gists_url" : "https://api.github.com/users/verdy-p/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/verdy-p",
         "id" : 1387035,
         "login" : "verdy-p",
         "node_id" : "MDQ6VXNlcjEzODcwMzU=",
         "organizations_url" : "https://api.github.com/users/verdy-p/orgs",
         "received_events_url" : "https://api.github.com/users/verdy-p/received_events",
         "repos_url" : "https://api.github.com/users/verdy-p/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/verdy-p/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/verdy-p/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/verdy-p"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "After (too many) tests, I just figured out what to do: STOPPING using the QT UI for the IBD.\r\n\r\nYou may use te QT Interface just to start and try the configuration, but for the IBD it is unreliable.\r\n\r\nThis bug seems to be caused by Qt's own internal threads for its UI, adding it own unsynchronized locks or managing other condurrent threads used by Bitcoin incorrectly, or it could be a bug in the Qt integration inside the BitCoin Core UI.\r\n\r\nAlso I note that bitcointd is much faster than bitcoin-qt to progress in the IBD phase.\r\n\r\nOnce the IBD phase is complete. you can interrupt bitcoind (CTRL+C is safe, and it terminates much faster), if you want to continue with the QT UI (which will not consume a lot of CPU/disk/net resources). However I've noted frequently that the QT version can corrupt some indexes. The Qt integrationis not completely thread safe and has race isues.\r\n\r\nIMHO, the QT version should run the daemon only in a separate process (which could be registered in Windows as a standard \"service\", without any attached console), and control it with its RPC/IPC interface. Stopping the QT interface should not stop the daemon, unless we click a button to stop the daemon by its RPC/IPC interface (or via Windows services API).\r\n\r\nAs well there should be an option to send logs not in a flat file, but to Windows Events, where they could be compressed and managed automatically with a circular buffer (internally Windows Events will be packed in *.evtx or *.etl files and have a type handler managing common strings and formaters): this also saves a lot of I/O; Windows provides tools to dump these events into a flat file if needed, and to also filter them by sources, event type IDs, or sort them in different order. This would be mostly useful for log events generated by the daemon (debug logs for the QT interface can remain in flat files, or could be sent to a different source category in Windows Events).\r\n\r\n----\r\n\r\nNote also that I use a dedicated storage partition only for the /Bitcoin data files and NOT the main system partition.\r\n\r\nI have also formatted it not with the default cluster sizes (4KB) but increased it to clusters of 256KB (because most files are very large): this significantly improves the I/O, reduces the filesystem overhead in terms of I/O and memory for the filesystem structures (allocation bitmaps are smaller and modified much less often, because database files, undo files, index files, redo-logs, and debug log files are all allocated incrementally and in parallel), it improves the filesystem cache, reduces the fragmentation a lot (when the store is on harddisks, even on a fast array), so we also get reduced latency.\r\n\r\nThis also greatly facilitates maintenance.",
      "created_at" : "2022-08-07T20:08:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25800#issuecomment-1207476578",
      "id" : 1207476578,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25800",
      "node_id" : "IC_kwDOABII585H-KFi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207476578/reactions"
      },
      "updated_at" : "2022-08-07T20:25:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207476578",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1387035?v=4",
         "events_url" : "https://api.github.com/users/verdy-p/events{/privacy}",
         "followers_url" : "https://api.github.com/users/verdy-p/followers",
         "following_url" : "https://api.github.com/users/verdy-p/following{/other_user}",
         "gists_url" : "https://api.github.com/users/verdy-p/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/verdy-p",
         "id" : 1387035,
         "login" : "verdy-p",
         "node_id" : "MDQ6VXNlcjEzODcwMzU=",
         "organizations_url" : "https://api.github.com/users/verdy-p/orgs",
         "received_events_url" : "https://api.github.com/users/verdy-p/received_events",
         "repos_url" : "https://api.github.com/users/verdy-p/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/verdy-p/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/verdy-p/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/verdy-p"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Permanent solution is to downgrade to 22.0",
      "created_at" : "2022-08-07T21:09:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25800#issuecomment-1207485817",
      "id" : 1207485817,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25800",
      "node_id" : "IC_kwDOABII585H-MV5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207485817/reactions"
      },
      "updated_at" : "2022-08-07T21:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207485817",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/98498676?v=4",
         "events_url" : "https://api.github.com/users/memz13155n/events{/privacy}",
         "followers_url" : "https://api.github.com/users/memz13155n/followers",
         "following_url" : "https://api.github.com/users/memz13155n/following{/other_user}",
         "gists_url" : "https://api.github.com/users/memz13155n/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/memz13155n",
         "id" : 98498676,
         "login" : "memz13155n",
         "node_id" : "U_kgDOBd74dA",
         "organizations_url" : "https://api.github.com/users/memz13155n/orgs",
         "received_events_url" : "https://api.github.com/users/memz13155n/received_events",
         "repos_url" : "https://api.github.com/users/memz13155n/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/memz13155n/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/memz13155n/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/memz13155n"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "No, version 22.0 has the same issue (though it does not have the bug present in the EXE installer for Windows caused by ASLR, due to a bug in MAKENSIS which creates an invalid EXE by when it appends the \"pcode\" compiled from the nsis.ini script, and then appends the compressed files, because it does not correctly manages the relations that are placed after them, but forgets to update the PE EXE header to the new placement of the relocation section in the EXE file)\r\n\r\nv22 tools has the same issue with the IBD which stalls as well if you use the QT interface (in addition, the bitcoin-qt.exe also corrupts the indexes; Qt is unsafe as it silently changes some global settings in the C runtime environment, and the LevelDB is also affected; it seems that Qt temporarily changes the current working directory, and files accessed by LeevlDB do not seem to specify the absolute path, so there are race conditions where some Qt threads may affect concurrent LevelDB threads.\r\n\r\nIF you use only the CLI daemon (v22 or v23), there's no such conflict and race conditions; it is faster in both cases than their QT version; but the v23 includes many fixes (multiple ones being critical) still not present in the v22 binaries (and not backported in the v22 sources).\r\n\r\nI just hope that a new v23 will be recreated soon (and there are other bugs pending to be solved, already present in the sources, but not in the precompiled binaries).\r\n\r\nIn my opinon the QT version of the daemon has not been seriously tested. And trying to link the daemon with the QT interface is an error; the QT interface should spawn or control the regular CLI daemon",
      "created_at" : "2022-08-07T23:58:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25800#issuecomment-1207512664",
      "id" : 1207512664,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25800",
      "node_id" : "IC_kwDOABII585H-S5Y",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207512664/reactions"
      },
      "updated_at" : "2022-08-07T23:58:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207512664",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1387035?v=4",
         "events_url" : "https://api.github.com/users/verdy-p/events{/privacy}",
         "followers_url" : "https://api.github.com/users/verdy-p/followers",
         "following_url" : "https://api.github.com/users/verdy-p/following{/other_user}",
         "gists_url" : "https://api.github.com/users/verdy-p/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/verdy-p",
         "id" : 1387035,
         "login" : "verdy-p",
         "node_id" : "MDQ6VXNlcjEzODcwMzU=",
         "organizations_url" : "https://api.github.com/users/verdy-p/orgs",
         "received_events_url" : "https://api.github.com/users/verdy-p/received_events",
         "repos_url" : "https://api.github.com/users/verdy-p/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/verdy-p/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/verdy-p/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/verdy-p"
      }
   }
]
