[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r947257780"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/947257780"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    bool HasScripts() const { return !m_branch.empty(); }\r\n```",
      "commit_id" : "9e74569c8130c5fb232cc877a47164dcf2e906ec",
      "created_at" : "2022-08-16T21:17:16Z",
      "diff_hunk" : "@@ -315,6 +315,8 @@ class TaprootBuilder\n     TaprootSpendData GetSpendData() const;\n     /** Returns a vector of tuples representing the depth, leaf version, and script */\n     std::vector<std::tuple<uint8_t, uint8_t, CScript>> GetTreeTuples() const;\n+    /** Returns true if there are any tapscripts */\n+    bool HasScripts() const { return m_branch.size() > 0; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r947257780",
      "id" : 947257780,
      "line" : 319,
      "node_id" : "PRRC_kwDOABII5844dgG0",
      "original_commit_id" : "bac92f9c056431c32c3fb01dd8d3a5032de15026",
      "original_line" : 319,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/script/standard.h",
      "position" : 5,
      "pull_request_review_id" : 1074787691,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/947257780/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-13T09:51:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/947257780",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Either approach should work.\r\n\r\nNot as big a fan of this approach because we may, in the future, wish to have access to the TaprootBuilder even HasScripts is false. E.g., were the TaprootBuilder to be extended to contain information about MuSig derivations, in which case the changes would be more straightforward IMO.\r\n\r\nOf course, it's silly to predict how future changes might be made, but I just personally find it conceptually cleaner to hang onto whatever data the sigdata passed us, and to use it correctly on output.",
      "created_at" : "2022-08-17T00:46:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25858#issuecomment-1217315017",
      "id" : 1217315017,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25858",
      "node_id" : "IC_kwDOABII585IjsDJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1217315017/reactions"
      },
      "updated_at" : "2022-08-17T00:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1217315017",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Not as big a fan of this approach because we may, in the future, wish to have access to the TaprootBuilder even HasScripts is false. E.g., were the TaprootBuilder to be extended to contain information about MuSig derivations, in which case the changes would be more straightforward IMO.\r\n\r\nI highly doubt that would be the case. And if it were, it's not particularly difficult to deal with it then. Furthermore, the general structure of the PSBT implementation is that each field has its own explicit member inside its struct, so any future things would get their own fields, which will then be un/packed from TaprootBuilder as needed.\r\n\r\nPerhaps the more correct way to implement `m_tap_tree` is to make it the vector of tuples rather than a TaprootBuilder.",
      "created_at" : "2022-08-17T00:52:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25858#issuecomment-1217325064",
      "id" : 1217325064,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25858",
      "node_id" : "IC_kwDOABII585IjugI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1217325064/reactions"
      },
      "updated_at" : "2022-08-17T00:52:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1217325064",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Perhaps the more correct way to implement `m_tap_tree` is to make it the vector of tuples rather than a TaprootBuilder.\r\n\r\nAdded a commit that does this.",
      "created_at" : "2022-08-17T01:20:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25858#issuecomment-1217348973",
      "id" : 1217348973,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25858",
      "node_id" : "IC_kwDOABII585Ij0Vt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1217348973/reactions"
      },
      "updated_at" : "2022-08-17T01:20:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1217348973",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25877](https://github.com/bitcoin/bitcoin/pull/25877) (refactor: Do not use CScript for tapleaf scripts until the tapleaf version is known by roconnor-blockstream)\n* [#25856](https://github.com/bitcoin/bitcoin/pull/25856) ([BugFix] Make PSBT serializations 174 compliant by excluding empty taptree from serialization by JeremyRubin)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-08-17T07:47:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25858#issuecomment-1217613808",
      "id" : 1217613808,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25858",
      "node_id" : "IC_kwDOABII585Ik0_w",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1217613808/reactions"
      },
      "updated_at" : "2022-08-20T20:50:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1217613808",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r948055083"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948055083"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "maybe this should just be a function in TaprootBuilder?",
      "commit_id" : "9e74569c8130c5fb232cc877a47164dcf2e906ec",
      "created_at" : "2022-08-17T14:58:59Z",
      "diff_hunk" : "@@ -219,7 +219,16 @@ void PSBTOutput::FillSignatureData(SignatureData& sigdata) const\n         sigdata.misc_pubkeys.emplace(key_pair.first.GetID(), key_pair);\n     }\n     if (m_tap_tree.has_value() && m_tap_internal_key.IsFullyValid()) {\n-        TaprootSpendData spenddata = m_tap_tree->GetSpendData();\n+        TaprootBuilder builder;\n+        for (const auto& tuple : m_tap_tree.value()) {\n+            uint8_t depth = std::get<0>(tuple);\n+            uint8_t leaf_ver = std::get<1>(tuple);\n+            CScript script = std::get<2>(tuple);\n+            builder.Add((int)depth, script, (int)leaf_ver, /*track=*/true);\n+        }\n+        assert(builder.IsComplete());\n+        builder.Finalize(m_tap_internal_key);\n+        TaprootSpendData spenddata = builder.GetSpendData();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r948055083",
      "id" : 948055083,
      "line" : 231,
      "node_id" : "PRRC_kwDOABII5844giwr",
      "original_commit_id" : "9e74569c8130c5fb232cc877a47164dcf2e906ec",
      "original_line" : 231,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/psbt.cpp",
      "position" : 14,
      "pull_request_review_id" : 1075905217,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948055083/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-17T14:58:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/948055083",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "approach ACK, this seems OK.",
      "created_at" : "2022-08-17T14:59:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25858#issuecomment-1218128338",
      "id" : 1218128338,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25858",
      "node_id" : "IC_kwDOABII585ImynS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1218128338/reactions"
      },
      "updated_at" : "2022-08-17T14:59:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1218128338",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969354313"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969354313"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: What's the reason for keeping it optional now it's a vector?",
      "commit_id" : "9e74569c8130c5fb232cc877a47164dcf2e906ec",
      "created_at" : "2022-09-13T09:07:43Z",
      "diff_hunk" : "@@ -713,7 +713,7 @@ struct PSBTOutput\n     CScript witness_script;\n     std::map<CPubKey, KeyOriginInfo> hd_keypaths;\n     XOnlyPubKey m_tap_internal_key;\n-    std::optional<TaprootBuilder> m_tap_tree;\n+    std::optional<std::vector<std::tuple<uint8_t, uint8_t, CScript>>> m_tap_tree;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969354313",
      "id" : 969354313,
      "line" : 716,
      "node_id" : "PRRC_kwDOABII5845xyxJ",
      "original_commit_id" : "a94fe72b507664a707caf6d80b07a177ff1283ab",
      "original_line" : 716,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/psbt.h",
      "position" : 5,
      "pull_request_review_id" : 1105416686,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969354313/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-13T09:15:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969354313",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969361674"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969361674"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Looks like you actually didn't commit this test?",
      "commit_id" : "9e74569c8130c5fb232cc877a47164dcf2e906ec",
      "created_at" : "2022-09-13T09:13:40Z",
      "diff_hunk" : "@@ -834,6 +847,9 @@ def test_psbt_input_keys(psbt_input, keys):\n         assert_raises_rpc_error(-8, \"PSBTs not compatible (different transactions)\", self.nodes[0].combinepsbt, [psbt1, psbt2])\n         assert_equal(self.nodes[0].combinepsbt([psbt1, psbt1]), psbt1)\n \n+        if self.options.descriptors:\n+            self.log.info(\"Test that PSBT_OUT_TAPROOT_TREE is only present for Taproot outputs that have script paths\")\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969361674",
      "id" : 969361674,
      "line" : 852,
      "node_id" : "PRRC_kwDOABII5845x0kK",
      "original_commit_id" : "9e74569c8130c5fb232cc877a47164dcf2e906ec",
      "original_line" : 852,
      "original_position" : 45,
      "original_start_line" : 850,
      "path" : "test/functional/rpc_psbt.py",
      "position" : 45,
      "pull_request_review_id" : 1105416686,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969361674/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 850,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-13T09:15:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969361674",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969404051"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969404051"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n        for (const auto& [depth, leaf_ver, script] : m_tap_tree.value()) {\r\n```",
      "commit_id" : "9e74569c8130c5fb232cc877a47164dcf2e906ec",
      "created_at" : "2022-09-13T09:49:10Z",
      "diff_hunk" : "@@ -219,7 +219,16 @@ void PSBTOutput::FillSignatureData(SignatureData& sigdata) const\n         sigdata.misc_pubkeys.emplace(key_pair.first.GetID(), key_pair);\n     }\n     if (m_tap_tree.has_value() && m_tap_internal_key.IsFullyValid()) {\n-        TaprootSpendData spenddata = m_tap_tree->GetSpendData();\n+        TaprootBuilder builder;\n+        for (const auto& tuple : m_tap_tree.value()) {\n+            uint8_t depth = std::get<0>(tuple);\n+            uint8_t leaf_ver = std::get<1>(tuple);\n+            CScript script = std::get<2>(tuple);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969404051",
      "id" : 969404051,
      "line" : 226,
      "node_id" : "PRRC_kwDOABII5845x-6T",
      "original_commit_id" : "9e74569c8130c5fb232cc877a47164dcf2e906ec",
      "original_line" : 226,
      "original_position" : 9,
      "original_start_line" : 223,
      "path" : "src/psbt.cpp",
      "position" : 9,
      "pull_request_review_id" : 1074787691,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969404051/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 223,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-13T09:51:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969404051",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969404955"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969404955"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n            for (const auto& [depth, leaf_ver, script] : m_tap_tree.value()) {\r\n```",
      "commit_id" : "9e74569c8130c5fb232cc877a47164dcf2e906ec",
      "created_at" : "2022-09-13T09:49:53Z",
      "diff_hunk" : "@@ -758,8 +758,7 @@ struct PSBTOutput\n             SerializeToVector(s, PSBT_OUT_TAP_TREE);\n             std::vector<unsigned char> value;\n             CVectorWriter s_value(s.GetType(), s.GetVersion(), value, 0);\n-            const auto& tuples = m_tap_tree->GetTreeTuples();\n-            for (const auto& tuple : tuples) {\n+            for (const auto& tuple : m_tap_tree.value()) {\n                 uint8_t depth = std::get<0>(tuple);\n                 uint8_t leaf_ver = std::get<1>(tuple);\n                 CScript script = std::get<2>(tuple);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969404955",
      "id" : 969404955,
      "line" : 764,
      "node_id" : "PRRC_kwDOABII5845x_Ib",
      "original_commit_id" : "9e74569c8130c5fb232cc877a47164dcf2e906ec",
      "original_line" : 764,
      "original_position" : 18,
      "original_start_line" : 761,
      "path" : "src/psbt.h",
      "position" : 18,
      "pull_request_review_id" : 1074787691,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969404955/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 761,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-13T09:51:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969404955",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969405515"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969405515"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n            for (const auto& [depth, leaf_ver, script] : output.m_tap_tree.value()) {\r\n```",
      "commit_id" : "9e74569c8130c5fb232cc877a47164dcf2e906ec",
      "created_at" : "2022-09-13T09:50:25Z",
      "diff_hunk" : "@@ -1243,8 +1243,7 @@ static RPCHelpMan decodepsbt()\n         // Taproot tree\n         if (output.m_tap_tree.has_value()) {\n             UniValue tree(UniValue::VARR);\n-            const auto& tuples = output.m_tap_tree->GetTreeTuples();\n-            for (const auto& tuple : tuples) {\n+            for (const auto& tuple : output.m_tap_tree.value()) {\n                 uint8_t depth = std::get<0>(tuple);\n                 uint8_t leaf_ver = std::get<1>(tuple);\n                 CScript script = std::get<2>(tuple);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969405515",
      "id" : 969405515,
      "line" : 1249,
      "node_id" : "PRRC_kwDOABII5845x_RL",
      "original_commit_id" : "9e74569c8130c5fb232cc877a47164dcf2e906ec",
      "original_line" : 1249,
      "original_position" : 9,
      "original_start_line" : 1246,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 9,
      "pull_request_review_id" : 1074787691,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969405515/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1246,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-13T09:51:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969405515",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969842685"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969842685"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Dropped the optional",
      "commit_id" : "e04f5b93fb68c758898d22ba5b2cd95b938ff706",
      "created_at" : "2022-09-13T16:25:13Z",
      "diff_hunk" : "@@ -713,7 +713,7 @@ struct PSBTOutput\n     CScript witness_script;\n     std::map<CPubKey, KeyOriginInfo> hd_keypaths;\n     XOnlyPubKey m_tap_internal_key;\n-    std::optional<TaprootBuilder> m_tap_tree;\n+    std::optional<std::vector<std::tuple<uint8_t, uint8_t, CScript>>> m_tap_tree;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969842685",
      "id" : 969842685,
      "in_reply_to_id" : 969354313,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845zp_9",
      "original_commit_id" : "a94fe72b507664a707caf6d80b07a177ff1283ab",
      "original_line" : 716,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/psbt.h",
      "position" : null,
      "pull_request_review_id" : 1106110159,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969842685/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-13T16:25:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969842685",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969842988"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969842988"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed. I changed how I wanted to do the test and forgot to drop the log line.",
      "commit_id" : "e04f5b93fb68c758898d22ba5b2cd95b938ff706",
      "created_at" : "2022-09-13T16:25:32Z",
      "diff_hunk" : "@@ -834,6 +847,9 @@ def test_psbt_input_keys(psbt_input, keys):\n         assert_raises_rpc_error(-8, \"PSBTs not compatible (different transactions)\", self.nodes[0].combinepsbt, [psbt1, psbt2])\n         assert_equal(self.nodes[0].combinepsbt([psbt1, psbt1]), psbt1)\n \n+        if self.options.descriptors:\n+            self.log.info(\"Test that PSBT_OUT_TAPROOT_TREE is only present for Taproot outputs that have script paths\")\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969842988",
      "id" : 969842988,
      "in_reply_to_id" : 969361674,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845zqEs",
      "original_commit_id" : "9e74569c8130c5fb232cc877a47164dcf2e906ec",
      "original_line" : 852,
      "original_position" : 45,
      "original_start_line" : 850,
      "path" : "test/functional/rpc_psbt.py",
      "position" : null,
      "pull_request_review_id" : 1106110552,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969842988/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-13T16:25:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969842988",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969843114"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969843114"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "e04f5b93fb68c758898d22ba5b2cd95b938ff706",
      "created_at" : "2022-09-13T16:25:40Z",
      "diff_hunk" : "@@ -315,6 +315,8 @@ class TaprootBuilder\n     TaprootSpendData GetSpendData() const;\n     /** Returns a vector of tuples representing the depth, leaf version, and script */\n     std::vector<std::tuple<uint8_t, uint8_t, CScript>> GetTreeTuples() const;\n+    /** Returns true if there are any tapscripts */\n+    bool HasScripts() const { return m_branch.size() > 0; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969843114",
      "id" : 969843114,
      "in_reply_to_id" : 947257780,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845zqGq",
      "original_commit_id" : "bac92f9c056431c32c3fb01dd8d3a5032de15026",
      "original_line" : 319,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/script/standard.h",
      "position" : null,
      "pull_request_review_id" : 1106110727,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969843114/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-13T16:25:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969843114",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969843163"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969843163"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "e04f5b93fb68c758898d22ba5b2cd95b938ff706",
      "created_at" : "2022-09-13T16:25:43Z",
      "diff_hunk" : "@@ -219,7 +219,16 @@ void PSBTOutput::FillSignatureData(SignatureData& sigdata) const\n         sigdata.misc_pubkeys.emplace(key_pair.first.GetID(), key_pair);\n     }\n     if (m_tap_tree.has_value() && m_tap_internal_key.IsFullyValid()) {\n-        TaprootSpendData spenddata = m_tap_tree->GetSpendData();\n+        TaprootBuilder builder;\n+        for (const auto& tuple : m_tap_tree.value()) {\n+            uint8_t depth = std::get<0>(tuple);\n+            uint8_t leaf_ver = std::get<1>(tuple);\n+            CScript script = std::get<2>(tuple);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969843163",
      "id" : 969843163,
      "in_reply_to_id" : 969404051,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845zqHb",
      "original_commit_id" : "9e74569c8130c5fb232cc877a47164dcf2e906ec",
      "original_line" : 226,
      "original_position" : 9,
      "original_start_line" : 223,
      "path" : "src/psbt.cpp",
      "position" : null,
      "pull_request_review_id" : 1106110805,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969843163/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-13T16:25:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969843163",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969843224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969843224"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "e04f5b93fb68c758898d22ba5b2cd95b938ff706",
      "created_at" : "2022-09-13T16:25:47Z",
      "diff_hunk" : "@@ -758,8 +758,7 @@ struct PSBTOutput\n             SerializeToVector(s, PSBT_OUT_TAP_TREE);\n             std::vector<unsigned char> value;\n             CVectorWriter s_value(s.GetType(), s.GetVersion(), value, 0);\n-            const auto& tuples = m_tap_tree->GetTreeTuples();\n-            for (const auto& tuple : tuples) {\n+            for (const auto& tuple : m_tap_tree.value()) {\n                 uint8_t depth = std::get<0>(tuple);\n                 uint8_t leaf_ver = std::get<1>(tuple);\n                 CScript script = std::get<2>(tuple);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969843224",
      "id" : 969843224,
      "in_reply_to_id" : 969404955,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845zqIY",
      "original_commit_id" : "9e74569c8130c5fb232cc877a47164dcf2e906ec",
      "original_line" : 764,
      "original_position" : 18,
      "original_start_line" : 761,
      "path" : "src/psbt.h",
      "position" : null,
      "pull_request_review_id" : 1106110880,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969843224/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-13T16:25:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969843224",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969843264"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969843264"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "e04f5b93fb68c758898d22ba5b2cd95b938ff706",
      "created_at" : "2022-09-13T16:25:50Z",
      "diff_hunk" : "@@ -1243,8 +1243,7 @@ static RPCHelpMan decodepsbt()\n         // Taproot tree\n         if (output.m_tap_tree.has_value()) {\n             UniValue tree(UniValue::VARR);\n-            const auto& tuples = output.m_tap_tree->GetTreeTuples();\n-            for (const auto& tuple : tuples) {\n+            for (const auto& tuple : output.m_tap_tree.value()) {\n                 uint8_t depth = std::get<0>(tuple);\n                 uint8_t leaf_ver = std::get<1>(tuple);\n                 CScript script = std::get<2>(tuple);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25858#discussion_r969843264",
      "id" : 969843264,
      "in_reply_to_id" : 969405515,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845zqJA",
      "original_commit_id" : "9e74569c8130c5fb232cc877a47164dcf2e906ec",
      "original_line" : 1249,
      "original_position" : 9,
      "original_start_line" : 1246,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 1106110955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969843264/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-13T16:25:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969843264",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2022-09-14T06:42:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25858#issuecomment-1246313158",
      "id" : 1246313158,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25858",
      "node_id" : "IC_kwDOABII585KSTrG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246313158/reactions"
      },
      "updated_at" : "2022-09-14T06:42:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246313158",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   }
]
