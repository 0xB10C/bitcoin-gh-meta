[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #22155 (wallet test: Add test for subtract fee from recipient behavior by ryanofsky)\n* #22019 (wallet: Introduce SelectionResult for encapsulating a coin selection solution by achow101)\n* #22009 (wallet: Decide which coin selection solution to use based on waste metric by achow101)\n* #22008 (wallet: Cleanup and refactor CreateTransactionInternal by achow101)\n* #21866 ([Bundle 7/7] validation: Farewell, global Chainstate! by dongcarl)\n* #21260 (wallet: indicate whether a transaction is in the mempool by danben)\n* #20591 (wallet, bugfix: fix ComputeTimeSmart function during rescanning process. by BitcoinTsunami)\n* #20205 (wallet: Properly support a wallet id by achow101)\n* #19101 (refactor: remove ::vpwallets and related global variables by ryanofsky)\n* #17526 (Use Single Random Draw In addition to knapsack as coin selection fallback by achow101)\n* #17355 (gui: grey out used address in address book by za-kk)\n* #17211 (Allow fundrawtransaction and walletcreatefundedpsbt to take external inputs by achow101)\n* #15719 (Wallet passive startup by ryanofsky)\n* #15129 (rpc: Added ability to remove watch only addresses by benthecarman)\n* #14707 ([RPC] Include coinbase transactions in receivedby RPCs by andrewtoth)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-02-17T10:25:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#issuecomment-780457746",
      "id" : 780457746,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4MDQ1Nzc0Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-08T01:15:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/780457746",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-02-19T02:43:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#issuecomment-781774874",
      "id" : 781774874,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4MTc3NDg3NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-19T02:43:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/781774874",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r579802970"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/579802970"
         }
      },
      "author_association" : "MEMBER",
      "body" : "7bc16a0b421380a1682ca9d97b7f7fc140fb1c5e\r\n\r\nnit, `CWalletTx(const CWallet*, CTransactionRef arg)` to make it clear wallet is unused.",
      "commit_id" : "3416ade015914ddeb84fad23d2455d974e9f4a74",
      "created_at" : "2021-02-21T12:52:18Z",
      "diff_hunk" : "@@ -140,8 +134,7 @@ class CWalletTx\n     mutable CAmount nChangeCached;\n \n     CWalletTx(const CWallet* wallet, CTransactionRef arg)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r579802970",
      "id" : 579802970,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTgwMjk3MA==",
      "original_commit_id" : "7bc16a0b421380a1682ca9d97b7f7fc140fb1c5e",
      "original_line" : 136,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : null,
      "pull_request_review_id" : 594838453,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T18:05:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/579802970",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r586915707"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/586915707"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r579802970\r\n\r\n> nit, `CWalletTx(const CWallet*, CTransactionRef arg)` to make it clear wallet is unused.\r\n\r\nGood catch! Removed unused argument in this commit instead of later commit",
      "commit_id" : "3416ade015914ddeb84fad23d2455d974e9f4a74",
      "created_at" : "2021-03-04T00:26:46Z",
      "diff_hunk" : "@@ -140,8 +134,7 @@ class CWalletTx\n     mutable CAmount nChangeCached;\n \n     CWalletTx(const CWallet* wallet, CTransactionRef arg)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r586915707",
      "id" : 586915707,
      "in_reply_to_id" : 579802970,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NjkxNTcwNw==",
      "original_commit_id" : "7bc16a0b421380a1682ca9d97b7f7fc140fb1c5e",
      "original_line" : 136,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : null,
      "pull_request_review_id" : 603528118,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T18:05:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/586915707",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-03-08T22:12:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#issuecomment-793119248",
      "id" : 793119248,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MzExOTI0OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-08T22:12:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/793119248",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-03-10T07:34:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#issuecomment-795023860",
      "id" : 795023860,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NTAyMzg2MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-10T07:34:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/795023860",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-03-12T07:41:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#issuecomment-797300526",
      "id" : 797300526,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NzMwMDUyNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-12T07:41:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/797300526",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-04-13T08:05:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#issuecomment-818535302",
      "id" : 818535302,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxODUzNTMwMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-13T08:05:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/818535302",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-04-14T02:53:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#issuecomment-819190763",
      "id" : 819190763,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTE5MDc2Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-14T02:53:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819190763",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620282305"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620282305"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4e11f88320b644b67db55fe737815451ca7d0681\r\n\r\nnit, refactor to `wtx.GetBlockHeight()` or similar.",
      "commit_id" : "3416ade015914ddeb84fad23d2455d974e9f4a74",
      "created_at" : "2021-04-26T13:12:19Z",
      "diff_hunk" : "@@ -81,7 +81,9 @@ WalletTx MakeWalletTx(CWallet& wallet, const CWalletTx& wtx)\n WalletTxStatus MakeWalletTxStatus(const CWallet& wallet, const CWalletTx& wtx)\n {\n     WalletTxStatus result;\n-    result.block_height = wtx.m_confirm.block_height > 0 ? wtx.m_confirm.block_height : std::numeric_limits<int>::max();\n+    int height = wtx.state<TxStateConfirmed>() ? wtx.state<TxStateConfirmed>()->confirmed_block_height :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620282305",
      "id" : 620282305,
      "line" : 84,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDI4MjMwNQ==",
      "original_commit_id" : "4e11f88320b644b67db55fe737815451ca7d0681",
      "original_line" : 84,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/interfaces.cpp",
      "position" : 39,
      "pull_request_review_id" : 644653488,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T18:05:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620282305",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620285572"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620285572"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4e11f88320b644b67db55fe737815451ca7d0681\r\n\r\nWhy the first check?",
      "commit_id" : "3416ade015914ddeb84fad23d2455d974e9f4a74",
      "created_at" : "2021-04-26T13:16:11Z",
      "diff_hunk" : "@@ -788,7 +788,9 @@ bool CWallet::MarkReplaced(const uint256& originalHash, const uint256& newHash)\n     // notification so the wallet is in an internally consistent state and\n     // immediately knows the old transaction should not be considered trusted\n     // and is eligible to be abandoned\n-    wtx.fInMempool = chain().isInMempool(originalHash);\n+    if (wtx.state<TxStateInMempool>() && !chain().isInMempool(originalHash)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620285572",
      "id" : 620285572,
      "line" : 793,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDI4NTU3Mg==",
      "original_commit_id" : "4e11f88320b644b67db55fe737815451ca7d0681",
      "original_line" : 793,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 35,
      "pull_request_review_id" : 644653488,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T18:05:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620285572",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620333051"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620333051"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4e11f88320b644b67db55fe737815451ca7d0681\r\n\r\nnit, `lookup_block` seems misleading, maybe `update_tx_state` or `mark_inactive`.",
      "commit_id" : "3416ade015914ddeb84fad23d2455d974e9f4a74",
      "created_at" : "2021-04-26T14:09:17Z",
      "diff_hunk" : "@@ -963,30 +960,29 @@ CWalletTx* CWallet::AddToWallet(CTransactionRef tx, const CWalletTx::Confirmatio\n \n bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& fill_wtx)\n {\n-    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr));\n+    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr, TxStateInactive{}));\n     CWalletTx& wtx = ins.first->second;\n     if (!fill_wtx(wtx, ins.second)) {\n         return false;\n     }\n     // If wallet doesn't have a chain (e.g wallet-tool), don't bother to update txn.\n     if (HaveChain()) {\n         bool active;\n-        int height;\n-        if (chain().findBlock(wtx.m_confirm.hashBlock, FoundBlock().inActiveChain(active).height(height)) && active) {\n-            // Update cached block height variable since it not stored in the\n-            // serialized transaction.\n-            wtx.m_confirm.block_height = height;\n-        } else if (wtx.isConflicted() || wtx.isConfirmed()) {\n+        auto lookup_block = [&](const uint256& hash, int& height, TxState& state) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620333051",
      "id" : 620333051,
      "line" : 973,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDMzMzA1MQ==",
      "original_commit_id" : "4e11f88320b644b67db55fe737815451ca7d0681",
      "original_line" : 973,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 118,
      "pull_request_review_id" : 644653488,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T18:05:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620333051",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620339834"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620339834"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4e11f88320b644b67db55fe737815451ca7d0681\r\n\r\nI've tested this removing one case in `TxStateSerializedBlockHash` and it failed to compile.",
      "commit_id" : "3416ade015914ddeb84fad23d2455d974e9f4a74",
      "created_at" : "2021-04-26T14:16:46Z",
      "diff_hunk" : "@@ -0,0 +1,21 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_OVERLOADED_H\n+#define BITCOIN_UTIL_OVERLOADED_H\n+\n+#include <optional>\n+#include <utility>\n+\n+//! Overloaded helper for std::visit, useful to write code that switches on a\n+//! variant type and triggers a compile error if there are any unhandled cases.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620339834",
      "id" : 620339834,
      "line" : 12,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDMzOTgzNA==",
      "original_commit_id" : "4e11f88320b644b67db55fe737815451ca7d0681",
      "original_line" : 12,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/util/overloaded.h",
      "position" : 12,
      "pull_request_review_id" : 644653488,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T18:05:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620339834",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620346512"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620346512"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4e11f88320b644b67db55fe737815451ca7d0681\r\n\r\nnit, space around `=`.",
      "commit_id" : "3416ade015914ddeb84fad23d2455d974e9f4a74",
      "created_at" : "2021-04-26T14:23:43Z",
      "diff_hunk" : "@@ -11,12 +11,99 @@\n #include <wallet/ismine.h>\n #include <threadsafety.h>\n #include <tinyformat.h>\n+#include <util/overloaded.h>\n #include <util/strencodings.h>\n #include <util/string.h>\n \n #include <list>\n+#include <variant>\n #include <vector>\n \n+//! State of transaction confirmed in a block.\n+struct TxStateConfirmed {\n+    uint256 confirmed_block_hash;\n+    int confirmed_block_height;\n+    int position_in_block;\n+\n+    explicit TxStateConfirmed(const uint256& block_hash, int height, int index) : confirmed_block_hash(block_hash), confirmed_block_height(height), position_in_block(index) {}\n+};\n+\n+//! State of transaction added to mempool.\n+struct TxStateInMempool {\n+};\n+\n+//! State of rejected transaction that conflicts with a confirmed block.\n+struct TxStateConflicted {\n+    uint256 conflicting_block_hash;\n+    int conflicting_block_height;\n+\n+    explicit TxStateConflicted(const uint256& block_hash, int height) : conflicting_block_hash(block_hash), conflicting_block_height(height) {}\n+};\n+\n+//! State of transaction not confirmed or conflicting with a known block and\n+//! not in the mempool. May conflict with the mempool, or with an unknown block,\n+//! or be abandoned, never broadcast, or rejected from the mempool for another\n+//! reason.\n+struct TxStateInactive {\n+    bool abandoned;\n+\n+    explicit TxStateInactive(bool abandoned=false) : abandoned(abandoned) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620346512",
      "id" : 620346512,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDM0NjUxMg==",
      "original_commit_id" : "4e11f88320b644b67db55fe737815451ca7d0681",
      "original_line" : 50,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : null,
      "pull_request_review_id" : 644653488,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T18:05:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620346512",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620348104"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620348104"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4e11f88320b644b67db55fe737815451ca7d0681\r\n\r\nMake local in lambda below?",
      "commit_id" : "3416ade015914ddeb84fad23d2455d974e9f4a74",
      "created_at" : "2021-04-26T14:25:24Z",
      "diff_hunk" : "@@ -963,30 +960,29 @@ CWalletTx* CWallet::AddToWallet(CTransactionRef tx, const CWalletTx::Confirmatio\n \n bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& fill_wtx)\n {\n-    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr));\n+    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr, TxStateInactive{}));\n     CWalletTx& wtx = ins.first->second;\n     if (!fill_wtx(wtx, ins.second)) {\n         return false;\n     }\n     // If wallet doesn't have a chain (e.g wallet-tool), don't bother to update txn.\n     if (HaveChain()) {\n         bool active;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620348104",
      "id" : 620348104,
      "line" : 972,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDM0ODEwNA==",
      "original_commit_id" : "4e11f88320b644b67db55fe737815451ca7d0681",
      "original_line" : 972,
      "original_position" : 81,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 111,
      "pull_request_review_id" : 644653488,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T18:05:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620348104",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-04-29T15:35:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#issuecomment-829342572",
      "id" : 829342572,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyOTM0MjU3Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-29T15:35:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/829342572",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623958342"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623958342"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620339834\r\n\r\n> [4e11f88](https://github.com/bitcoin/bitcoin/commit/4e11f88320b644b67db55fe737815451ca7d0681)\r\n> \r\n> I've tested this removing one case in `TxStateSerializedBlockHash` and it failed to compile.\r\n\r\nThanks for testing!",
      "commit_id" : "3416ade015914ddeb84fad23d2455d974e9f4a74",
      "created_at" : "2021-04-30T15:12:48Z",
      "diff_hunk" : "@@ -0,0 +1,21 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_OVERLOADED_H\n+#define BITCOIN_UTIL_OVERLOADED_H\n+\n+#include <optional>\n+#include <utility>\n+\n+//! Overloaded helper for std::visit, useful to write code that switches on a\n+//! variant type and triggers a compile error if there are any unhandled cases.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623958342",
      "id" : 623958342,
      "in_reply_to_id" : 620339834,
      "line" : 12,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzk1ODM0Mg==",
      "original_commit_id" : "4e11f88320b644b67db55fe737815451ca7d0681",
      "original_line" : 12,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/util/overloaded.h",
      "position" : 12,
      "pull_request_review_id" : 649322365,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T18:15:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623958342",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623964770"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623964770"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620282305\r\n\r\n> [4e11f88](https://github.com/bitcoin/bitcoin/commit/4e11f88320b644b67db55fe737815451ca7d0681)\r\n> \r\n> nit, refactor to `wtx.GetBlockHeight()` or similar.\r\n\r\nThe code does repeat  a few places but I think I'd still rather not have this. I think all these positive and negative height and magic height and depth values are bad and we should just pass the actual state information around. It would be good to clean up this code later (would avoid it for now to avoid expanding scope of pr), but I think the cleanup should more try to get rid of the magic height values than to try to construct them quietly.",
      "commit_id" : "3416ade015914ddeb84fad23d2455d974e9f4a74",
      "created_at" : "2021-04-30T15:22:14Z",
      "diff_hunk" : "@@ -81,7 +81,9 @@ WalletTx MakeWalletTx(CWallet& wallet, const CWalletTx& wtx)\n WalletTxStatus MakeWalletTxStatus(const CWallet& wallet, const CWalletTx& wtx)\n {\n     WalletTxStatus result;\n-    result.block_height = wtx.m_confirm.block_height > 0 ? wtx.m_confirm.block_height : std::numeric_limits<int>::max();\n+    int height = wtx.state<TxStateConfirmed>() ? wtx.state<TxStateConfirmed>()->confirmed_block_height :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623964770",
      "id" : 623964770,
      "in_reply_to_id" : 620282305,
      "line" : 84,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzk2NDc3MA==",
      "original_commit_id" : "4e11f88320b644b67db55fe737815451ca7d0681",
      "original_line" : 84,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/interfaces.cpp",
      "position" : 39,
      "pull_request_review_id" : 649322365,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T18:15:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623964770",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623977153"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623977153"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620346512\r\n\r\n> [4e11f88](https://github.com/bitcoin/bitcoin/commit/4e11f88320b644b67db55fe737815451ca7d0681)\r\n> \r\n> nit, space around `=`.\r\n\r\nThanks, ran clang-format-diff",
      "commit_id" : "3416ade015914ddeb84fad23d2455d974e9f4a74",
      "created_at" : "2021-04-30T15:40:46Z",
      "diff_hunk" : "@@ -11,12 +11,99 @@\n #include <wallet/ismine.h>\n #include <threadsafety.h>\n #include <tinyformat.h>\n+#include <util/overloaded.h>\n #include <util/strencodings.h>\n #include <util/string.h>\n \n #include <list>\n+#include <variant>\n #include <vector>\n \n+//! State of transaction confirmed in a block.\n+struct TxStateConfirmed {\n+    uint256 confirmed_block_hash;\n+    int confirmed_block_height;\n+    int position_in_block;\n+\n+    explicit TxStateConfirmed(const uint256& block_hash, int height, int index) : confirmed_block_hash(block_hash), confirmed_block_height(height), position_in_block(index) {}\n+};\n+\n+//! State of transaction added to mempool.\n+struct TxStateInMempool {\n+};\n+\n+//! State of rejected transaction that conflicts with a confirmed block.\n+struct TxStateConflicted {\n+    uint256 conflicting_block_hash;\n+    int conflicting_block_height;\n+\n+    explicit TxStateConflicted(const uint256& block_hash, int height) : conflicting_block_hash(block_hash), conflicting_block_height(height) {}\n+};\n+\n+//! State of transaction not confirmed or conflicting with a known block and\n+//! not in the mempool. May conflict with the mempool, or with an unknown block,\n+//! or be abandoned, never broadcast, or rejected from the mempool for another\n+//! reason.\n+struct TxStateInactive {\n+    bool abandoned;\n+\n+    explicit TxStateInactive(bool abandoned=false) : abandoned(abandoned) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623977153",
      "id" : 623977153,
      "in_reply_to_id" : 620346512,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzk3NzE1Mw==",
      "original_commit_id" : "4e11f88320b644b67db55fe737815451ca7d0681",
      "original_line" : 50,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : null,
      "pull_request_review_id" : 649322365,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T18:15:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623977153",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623987385"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623987385"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620285572\r\n\r\n> [4e11f88](https://github.com/bitcoin/bitcoin/commit/4e11f88320b644b67db55fe737815451ca7d0681)\r\n> \r\n> Why the first check?\r\n\r\nThe main reason is to be equivalent as possible to previous code. Previous code didn't change the transactions abandon/unconfirmed/conflicted state and this code isn't trying to do that either. Also, I think it makes the code more closely match the comment above. Maybe we can make the comment more clear though. It seems like it could be a little more specific but I'm not sure what extra explanation or details might be good to add.",
      "commit_id" : "3416ade015914ddeb84fad23d2455d974e9f4a74",
      "created_at" : "2021-04-30T15:55:59Z",
      "diff_hunk" : "@@ -788,7 +788,9 @@ bool CWallet::MarkReplaced(const uint256& originalHash, const uint256& newHash)\n     // notification so the wallet is in an internally consistent state and\n     // immediately knows the old transaction should not be considered trusted\n     // and is eligible to be abandoned\n-    wtx.fInMempool = chain().isInMempool(originalHash);\n+    if (wtx.state<TxStateInMempool>() && !chain().isInMempool(originalHash)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623987385",
      "id" : 623987385,
      "in_reply_to_id" : 620285572,
      "line" : 793,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzk4NzM4NQ==",
      "original_commit_id" : "4e11f88320b644b67db55fe737815451ca7d0681",
      "original_line" : 793,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 35,
      "pull_request_review_id" : 649322365,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T18:15:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623987385",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623989031"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623989031"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620348104\r\n\r\n> [4e11f88](https://github.com/bitcoin/bitcoin/commit/4e11f88320b644b67db55fe737815451ca7d0681)\r\n> \r\n> Make local in lambda below?\r\n\r\nCan do if another change is required. This line isn't changing, and I'm trying to minimize the diff. The variable scope is pretty small already too.",
      "commit_id" : "3416ade015914ddeb84fad23d2455d974e9f4a74",
      "created_at" : "2021-04-30T15:58:29Z",
      "diff_hunk" : "@@ -963,30 +960,29 @@ CWalletTx* CWallet::AddToWallet(CTransactionRef tx, const CWalletTx::Confirmatio\n \n bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& fill_wtx)\n {\n-    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr));\n+    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr, TxStateInactive{}));\n     CWalletTx& wtx = ins.first->second;\n     if (!fill_wtx(wtx, ins.second)) {\n         return false;\n     }\n     // If wallet doesn't have a chain (e.g wallet-tool), don't bother to update txn.\n     if (HaveChain()) {\n         bool active;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r623989031",
      "id" : 623989031,
      "in_reply_to_id" : 620348104,
      "line" : 972,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzk4OTAzMQ==",
      "original_commit_id" : "4e11f88320b644b67db55fe737815451ca7d0681",
      "original_line" : 972,
      "original_position" : 81,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 111,
      "pull_request_review_id" : 649322365,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T18:15:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623989031",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r624001448"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/624001448"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r620333051\r\n\r\n> [4e11f88](https://github.com/bitcoin/bitcoin/commit/4e11f88320b644b67db55fe737815451ca7d0681)\r\n> \r\n> nit, `lookup_block` seems misleading, maybe `update_tx_state` or `mark_inactive`.\r\n\r\nI guess it's not too important because the definition is a few lines away from the usage, but those names seem more misleading to me. The lambda is looking up a block hash and returning the block height in an output parameter. In the error case it also returns a txstate. I think it's reasonable to name a function after the main thing it does, even if the name doesn't encompass everything it does in all cases, especially in a local context like this where it's not going to be called by faraway code.\r\n\r\nThis code definitely sucks and there will be a lot of opportunities to improve it later (see\r\nhttps://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking). This commit is just trying to make a simple-as-possible global change to the state representation in order to be able to make local improvements in places like this more easy in the future.",
      "commit_id" : "3416ade015914ddeb84fad23d2455d974e9f4a74",
      "created_at" : "2021-04-30T16:18:14Z",
      "diff_hunk" : "@@ -963,30 +960,29 @@ CWalletTx* CWallet::AddToWallet(CTransactionRef tx, const CWalletTx::Confirmatio\n \n bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& fill_wtx)\n {\n-    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr));\n+    const auto& ins = mapWallet.emplace(std::piecewise_construct, std::forward_as_tuple(hash), std::forward_as_tuple(nullptr, TxStateInactive{}));\n     CWalletTx& wtx = ins.first->second;\n     if (!fill_wtx(wtx, ins.second)) {\n         return false;\n     }\n     // If wallet doesn't have a chain (e.g wallet-tool), don't bother to update txn.\n     if (HaveChain()) {\n         bool active;\n-        int height;\n-        if (chain().findBlock(wtx.m_confirm.hashBlock, FoundBlock().inActiveChain(active).height(height)) && active) {\n-            // Update cached block height variable since it not stored in the\n-            // serialized transaction.\n-            wtx.m_confirm.block_height = height;\n-        } else if (wtx.isConflicted() || wtx.isConfirmed()) {\n+        auto lookup_block = [&](const uint256& hash, int& height, TxState& state) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r624001448",
      "id" : 624001448,
      "in_reply_to_id" : 620333051,
      "line" : 973,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNDAwMTQ0OA==",
      "original_commit_id" : "4e11f88320b644b67db55fe737815451ca7d0681",
      "original_line" : 973,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 118,
      "pull_request_review_id" : 649322365,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T18:15:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/624001448",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r625576746"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625576746"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "No need to export `OutputGetChange` and `TxGetChange`  as they are not used outside of `receive.cpp`",
      "commit_id" : "3416ade015914ddeb84fad23d2455d974e9f4a74",
      "created_at" : "2021-05-04T07:50:36Z",
      "diff_hunk" : "@@ -10,11 +10,55 @@\n #include <wallet/transaction.h>\n #include <wallet/wallet.h>\n \n+isminetype InputIsMine(const CWallet& wallet, const CTxIn& txin) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+\n+/** Returns whether all of the inputs match the filter */\n+bool AllInputsMine(const CWallet& wallet, const CTransaction& tx, const isminefilter& filter);\n+\n+CAmount OutputGetCredit(const CWallet& wallet, const CTxOut& txout, const isminefilter& filter);\n+CAmount TxGetCredit(const CWallet& wallet, const CTransaction& tx, const isminefilter& filter);\n+\n+bool ScriptIsChange(const CWallet& wallet, const CScript& script) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+bool OutputIsChange(const CWallet& wallet, const CTxOut& txout) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+CAmount OutputGetChange(const CWallet& wallet, const CTxOut& txout) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+CAmount TxGetChange(const CWallet& wallet, const CTransaction& tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r625576746",
      "id" : 625576746,
      "line" : 24,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTU3Njc0Ng==",
      "original_commit_id" : "d1582cdc4e2312c213cf49131b4cd3e74636ae56",
      "original_line" : 24,
      "original_position" : 15,
      "original_start_line" : 23,
      "path" : "src/wallet/receive.h",
      "position" : 24,
      "pull_request_review_id" : 650967747,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
      "side" : "RIGHT",
      "start_line" : 23,
      "start_side" : "RIGHT",
      "updated_at" : "2021-05-19T06:33:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625576746",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-05-10T14:18:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#issuecomment-836758062",
      "id" : 836758062,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzNjc1ODA2Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-10T14:18:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/836758062",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r636513974"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636513974"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/21206#discussion_r625576746\r\n\r\n> No need to export `OutputGetChange` and `TxGetChange` as they are not used outside of `receive.cpp`\r\n\r\nI think in the future it might be good to move low-level code using `IsChange` logic inside `receive.cpp` so `IsChange` functions could be private. But for `GetChange` it seems most consistent to try to keeping exposing `Get{Credit,Debit,Change}` functions as a group. The fact that these two `GetChange` functions don't have callers I think is more a reflection of poor unit test coverage than that change amounts should be a private part of transaction accounting.",
      "commit_id" : "3416ade015914ddeb84fad23d2455d974e9f4a74",
      "created_at" : "2021-05-20T22:22:24Z",
      "diff_hunk" : "@@ -10,11 +10,55 @@\n #include <wallet/transaction.h>\n #include <wallet/wallet.h>\n \n+isminetype InputIsMine(const CWallet& wallet, const CTxIn& txin) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+\n+/** Returns whether all of the inputs match the filter */\n+bool AllInputsMine(const CWallet& wallet, const CTransaction& tx, const isminefilter& filter);\n+\n+CAmount OutputGetCredit(const CWallet& wallet, const CTxOut& txout, const isminefilter& filter);\n+CAmount TxGetCredit(const CWallet& wallet, const CTransaction& tx, const isminefilter& filter);\n+\n+bool ScriptIsChange(const CWallet& wallet, const CScript& script) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+bool OutputIsChange(const CWallet& wallet, const CTxOut& txout) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+CAmount OutputGetChange(const CWallet& wallet, const CTxOut& txout) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+CAmount TxGetChange(const CWallet& wallet, const CTransaction& tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#discussion_r636513974",
      "id" : 636513974,
      "in_reply_to_id" : 625576746,
      "line" : 24,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNjUxMzk3NA==",
      "original_commit_id" : "d1582cdc4e2312c213cf49131b4cd3e74636ae56",
      "original_line" : 24,
      "original_position" : 15,
      "original_start_line" : 23,
      "path" : "src/wallet/receive.h",
      "position" : 24,
      "pull_request_review_id" : 664950916,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21206",
      "side" : "RIGHT",
      "start_line" : 23,
      "start_side" : "RIGHT",
      "updated_at" : "2021-05-20T22:27:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/636513974",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-05-25T14:53:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#issuecomment-847938045",
      "id" : 847938045,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0NzkzODA0NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-25T14:53:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/847938045",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-05-26T07:50:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#issuecomment-848550173",
      "id" : 848550173,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0ODU1MDE3Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-26T07:50:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/848550173",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-06-09T12:01:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21206#issuecomment-857635058",
      "id" : 857635058,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1NzYzNTA1OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-09T12:01:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/857635058",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
