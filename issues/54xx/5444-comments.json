[
   {
      "body" : "Code looks good to me.\r\n\r\nHowever, it's still a lot of HTTP overhead, even with keep-alive, to request one header per HTTP request.  /rest/headers/ seems more appropriate, a la 'getutxos'.\r\n\r\nSuggestion:  GET /rest/headers/$hash.ext gets 2000 headers, unless a \"?limit=N\" qualifier is added.",
      "created_at" : "2014-12-08T13:01:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5444#issuecomment-66112787",
      "id" : 66112787,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5444",
      "updated_at" : "2014-12-08T13:01:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/66112787",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "@jgarzik Good idea. This was just some random thought that could be useful; I'll change it.",
      "created_at" : "2014-12-08T13:06:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5444#issuecomment-66113255",
      "id" : 66113255,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5444",
      "updated_at" : "2014-12-08T13:06:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/66113255",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "1)\r\nThe 2000 headers per request/response seems to be a good idea.\r\nI'm not sure about the limit parameter per query string. It might end up in different parameter injection. getutxos uses raw post data.\r\n/rest/headers/notxdetails/ uses flag/parameter in the URL?\r\n\r\nWould /rest/headers/limit/2000/<hash>.ext be a overkill?\r\n\r\nBut maybe the query string parameter is more clear.\r\n\r\n2)\r\nIs there a reason for no JSON support? If it's just your time/priority I will add it afterwards.",
      "created_at" : "2014-12-08T13:46:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5444#issuecomment-66117350",
      "id" : 66117350,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5444",
      "updated_at" : "2014-12-08T13:46:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/66117350",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5444#discussion_r21475952"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5444"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/21475952"
         }
      },
      "body" : "shouldn't `ssBlock` be `ssHeader`?",
      "commit_id" : "f676c80f437e15ab0ee190e93baea733a88db0f2",
      "created_at" : "2014-12-08T19:09:30Z",
      "diff_hunk" : "@@ -89,6 +89,52 @@ static bool ParseHashStr(const string& strReq, uint256& v)\n     return true;\n }\n \n+static bool rest_header(AcceptedConnection* conn,\n+                        string& strReq,\n+                        map<string, string>& mapHeaders,\n+                        bool fRun)\n+{\n+    vector<string> params;\n+    enum RetFormat rf = ParseDataFormat(params, strReq);\n+\n+    string hashStr = params[0];\n+    uint256 hash;\n+    if (!ParseHashStr(hashStr, hash))\n+        throw RESTERR(HTTP_BAD_REQUEST, \"Invalid hash: \" + hashStr);\n+\n+    CBlockHeader header;\n+    {\n+        LOCK(cs_main);\n+        if (mapBlockIndex.count(hash) == 0)\n+            throw RESTERR(HTTP_NOT_FOUND, hashStr + \" not found\");\n+        header = mapBlockIndex[hash]->GetBlockHeader();\n+    }\n+\n+    CDataStream ssHeader(SER_NETWORK, PROTOCOL_VERSION);\n+    ssBlock << header;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5444#discussion_r21475952",
      "id" : 21475952,
      "original_commit_id" : "176371c7ee1b9219d43ebb918d954398fb971ec2",
      "original_position" : 26,
      "path" : "src/rest.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5444",
      "updated_at" : "2014-12-12T15:37:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/21475952",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5444#discussion_r21475961"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5444"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/21475961"
         }
      },
      "body" : "shouldn't `binaryBlock` be `ssBlock`?",
      "commit_id" : "f676c80f437e15ab0ee190e93baea733a88db0f2",
      "created_at" : "2014-12-08T19:09:34Z",
      "diff_hunk" : "@@ -89,6 +89,52 @@ static bool ParseHashStr(const string& strReq, uint256& v)\n     return true;\n }\n \n+static bool rest_header(AcceptedConnection* conn,\n+                        string& strReq,\n+                        map<string, string>& mapHeaders,\n+                        bool fRun)\n+{\n+    vector<string> params;\n+    enum RetFormat rf = ParseDataFormat(params, strReq);\n+\n+    string hashStr = params[0];\n+    uint256 hash;\n+    if (!ParseHashStr(hashStr, hash))\n+        throw RESTERR(HTTP_BAD_REQUEST, \"Invalid hash: \" + hashStr);\n+\n+    CBlockHeader header;\n+    {\n+        LOCK(cs_main);\n+        if (mapBlockIndex.count(hash) == 0)\n+            throw RESTERR(HTTP_NOT_FOUND, hashStr + \" not found\");\n+        header = mapBlockIndex[hash]->GetBlockHeader();\n+    }\n+\n+    CDataStream ssHeader(SER_NETWORK, PROTOCOL_VERSION);\n+    ssBlock << header;\n+\n+    switch (rf) {\n+    case RF_BINARY: {\n+        string binaryHeader = ssHeader.str();\n+        conn->stream() << HTTPReplyHeader(HTTP_OK, fRun, binaryBlock.size(), \"application/octet-stream\") << binaryBlock << std::flush;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5444#discussion_r21475961",
      "id" : 21475961,
      "original_commit_id" : "176371c7ee1b9219d43ebb918d954398fb971ec2",
      "original_position" : 31,
      "path" : "src/rest.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5444",
      "updated_at" : "2014-12-12T15:37:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/21475961",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "- Concept looks good to me\r\n- I agree we don't really need a JSON format. If the purpose for this is to be a low-overhead API, we should stay away from JSON\r\n- As for parameters (such as start, limit), for a REST interface I'd prefer them to be all to be part of the query path instead of introducing `?=` parameters. `?=` parameters are non-canonical in that they can be provided in any order, which introduces a kind of aliasing that messes with caching\r\n",
      "created_at" : "2014-12-09T08:57:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5444#issuecomment-66251851",
      "id" : 66251851,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5444",
      "updated_at" : "2014-12-09T08:57:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/66251851",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Regarding JSON:\r\nIs there a reason to not support JSON? I think there are many potential REST users using script programming languages like Python or PHP. The unpacking of the byte array is somehow annoying in these languages and people might tend to have a overhead in the information transmission protocol (TCP/HTTP/JSON in this case) and save some development effort.\r\nWe could even say HTTP is a overhead (because its plaintext and line based). Then we would end up in a raw TCP socket and might be very close to the P2P protocol. IMO we should distinct both \"APIs\".\r\n\r\nI would find it a bad idea to have a potential JSON output format which does not support all possible methods.\r\n\r\nA feasible step would to drop JSON support completely for the REST API. But we might have to come out of our byte-optimized-land and see what others expect from a API.",
      "created_at" : "2014-12-09T12:25:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5444#issuecomment-66275012",
      "id" : 66275012,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5444",
      "updated_at" : "2014-12-09T12:25:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/66275012",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Packing/unpacking byte arrays is well-supported in Python, I do that all the time, that's a bit of a strawman. See also https://github.com/petertodd/python-bitcoinlib .\r\n\r\nAnyhow: headers have a well-defined format, and for hashing and such you really need the canonical, raw data. A \"cooked\" version would be much less useful. It could be added later but I doubt there is actual demand for it.",
      "created_at" : "2014-12-09T12:50:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5444#issuecomment-66277756",
      "id" : 66277756,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5444",
      "updated_at" : "2014-12-09T12:50:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/66277756",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Updated.",
      "created_at" : "2014-12-09T15:52:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5444#issuecomment-66304251",
      "id" : 66304251,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5444",
      "updated_at" : "2014-12-09T15:52:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/66304251",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "needs rebase",
      "created_at" : "2014-12-12T10:10:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5444#issuecomment-66754210",
      "id" : 66754210,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5444",
      "updated_at" : "2014-12-12T10:10:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/66754210",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "tested (rebase is trivial).\r\n\r\nACK",
      "created_at" : "2014-12-12T10:49:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5444#issuecomment-66757998",
      "id" : 66757998,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5444",
      "updated_at" : "2014-12-12T10:49:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/66757998",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   }
]
