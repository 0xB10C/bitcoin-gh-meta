[
   {
      "author_association" : "MEMBER",
      "body" : "Does the crash also happen in a python functional test? If yes, mind to add one?",
      "created_at" : "2020-06-17T10:11:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645283826",
      "id" : 645283826,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTI4MzgyNg==",
      "updated_at" : "2020-06-17T10:11:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645283826",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke haven't tried but I'd say it should - but it will be one of those loop-until-it-happens test. I'll give it a try.",
      "created_at" : "2020-06-17T10:14:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645285177",
      "id" : 645285177,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTI4NTE3Nw==",
      "updated_at" : "2020-06-17T10:14:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645285177",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "does this need backport to 0.19?",
      "created_at" : "2020-06-17T10:16:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645286264",
      "id" : 645286264,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTI4NjI2NA==",
      "updated_at" : "2020-06-17T10:16:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645286264",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke yes, and probably is a clean backport.",
      "created_at" : "2020-06-17T10:18:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645287165",
      "id" : 645287165,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTI4NzE2NQ==",
      "updated_at" : "2020-06-17T10:18:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645287165",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Hi, just tested the running of several background processes of the following script :\r\n\r\n```\r\n# Bitcoin Core RPC client version v0.20.0.0-ga62f0ed64f8bbbdfe6467ac5ce92ef5b5222d1bd\r\nwallet=xxxxxx\r\nfor i in {1..1000}\r\ndo\r\n  echo $i\r\n  bitcoin-cli loadwallet $wallet\r\n  bitcoin-cli unloadwallet $wallet\r\ndone\r\n\r\n```\r\nCrash is immediate. Here's valgrind output:\r\n\r\n```\r\nvalgrind /usr/local/bin/bitcoind -daemon -walletrbf -conf=/root/.bitcoin/bitcoin.conf -fallbackfee=0.00001 -rpcworkqueue=128\r\n==30964== Memcheck, a memory error detector\r\n==30964== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.\r\n==30964== Using Valgrind-3.15.0 and LibVEX; rerun with -h for copyright info\r\n==30964== Command: /usr/local/bin/bitcoind -daemon -walletrbf -conf=/root/.bitcoin/bitcoin.conf -fallbackfee=0.00001 -rpcworkqueue=128\r\n==30964==\r\nBitcoin Core starting\r\n==30964==\r\n==30964== HEAP SUMMARY:\r\n==30964==     in use at exit: 2,232,114 bytes in 2,271 blocks\r\n==30964==   total heap usage: 3,234 allocs, 963 frees, 2,462,760 bytes allocated\r\n==30964==\r\n==30964== LEAK SUMMARY:\r\n==30964==    definitely lost: 0 bytes in 0 blocks\r\n==30964==    indirectly lost: 0 bytes in 0 blocks\r\n==30964==      possibly lost: 0 bytes in 0 blocks\r\n==30964==    still reachable: 2,232,114 bytes in 2,271 blocks\r\n==30964==         suppressed: 0 bytes in 0 blocks\r\n==30964== Reachable blocks (those to which a pointer was found) are not shown.\r\n==30964== To see them, rerun with: --leak-check=full --show-leak-kinds=all\r\n==30964==\r\n==30964== For lists of detected and suppressed errors, rerun with: -s\r\n==30964== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)\r\nroot@backdev2:/home/psb/bin# ==30973== Syscall param pwrite64(buf) points to uninitialised byte(s)\r\n==30973==    at 0x507B983: ??? (syscall-template.S:84)\r\n==30973==    by 0x53CF188: __os_io (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x53BD04C: __memp_pgwrite.part.0 (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x53BD408: __memp_bhwrite (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x53BC31A: __memp_alloc (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x53BED27: __memp_fget (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x5348408: __db_verify (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x534A846: __db_verify_internal (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x52B9026: Db::verify(char const*, char const*, std::ostream*, unsigned int) (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x3DF7E5: BerkeleyEnvironment::Verify(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, bool (*)(boost::filesystem::path const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (db.cpp:277)\r\n==30973==    by 0x3DFB4A: BerkeleyBatch::VerifyDatabaseFile(boost::filesystem::path const&, std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > >&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, bool (*)(boost::filesystem::path const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)) (db.cpp:422)\r\n==30973==    by 0x472D48: CWallet::Verify(interfaces::Chain&, WalletLocation const&, bool, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > >&) (wallet.cpp:3778)\r\n==30973==  Address 0xd63ee08 is 120 bytes inside a block of size 1,112 alloc'd\r\n==30973==    at 0x402E7BD: malloc (vg_replace_malloc.c:309)\r\n==30973==    by 0x53CC964: __os_malloc (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x539B4F3: __env_alloc (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x53BBBC0: __memp_alloc (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x53BED27: __memp_fget (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x52D4063: __bam_new_file (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x5386387: __db_new_file (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x5386906: __db_open (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x534B2B8: __db_vrfy_pgset (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x534B4BE: __db_vrfy_dbinfo_create (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x5348056: __db_verify (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==    by 0x534A846: __db_verify_internal (in /usr/lib/libdb_cxx-4.8.so)\r\n==30973==\r\n==30973==\r\n==30973== Process terminating with default action of signal 6 (SIGABRT)\r\n==30973==    at 0x6350FFF: raise (raise.c:51)\r\n==30973==    by 0x6352429: abort (abort.c:89)\r\n==30973==    by 0x6349E66: __assert_fail_base (assert.c:92)\r\n==30973==    by 0x6349F11: __assert_fail (assert.c:101)\r\n==30973==    by 0x49085A: BerkeleyDatabase (db.h:125)\r\n==30973==    by 0x49085A: std::unique_ptr<BerkeleyDatabase, std::default_delete<BerkeleyDatabase> > MakeUnique<BerkeleyDatabase, std::shared_ptr<BerkeleyEnvironment>, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >(std::shared_ptr<BerkeleyEnvironment>&&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&&) (memory.h:16)\r\n==30973==    by 0x49091F: BerkeleyDatabase::Create(boost::filesystem::path const&) (db.h:139)\r\n==30973==    by 0x47E2C1: CWallet::CreateWalletFromFile(interfaces::Chain&, WalletLocation const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > >&, unsigned long) (wallet.cpp:3805)\r\n==30973==    by 0x4823E6: LoadWallet(interfaces::Chain&, WalletLocation const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > >&) (wallet.cpp:157)\r\n==30973==    by 0x40A7FD: loadwallet(JSONRPCRequest const&) (rpcwallet.cpp:2626)\r\n==30973==    by 0x22BFEB: operator() (server.h:104)\r\n==30973==    by 0x22BFEB: std::_Function_handler<bool (JSONRPCRequest const&, UniValue&, bool), CRPCCommand::CRPCCommand(char const*, char const*, UniValue (*)(JSONRPCRequest const&), std::initializer_list<char const*>)::{lambda(JSONRPCRequest const&, UniValue&, bool)#1}>::_M_invoke(std::_Any_data const&, JSONRPCRequest const&, UniValue&, bool&&) (functional:1717)\r\n==30973==    by 0x14A95E: operator() (functional:2127)\r\n==30973==    by 0x14A95E: operator() (chain.cpp:208)\r\n==30973==    by 0x14A95E: std::_Function_handler<bool (JSONRPCRequest const&, UniValue&, bool), interfaces::(anonymous namespace)::RpcHandlerImpl::RpcHandlerImpl(CRPCCommand const&)::{lambda(JSONRPCRequest const&, UniValue&, bool)#1}>::_M_invoke(std::_Any_data const&, JSONRPCRequest const&, UniValue&, bool&&) (functional:1717)\r\n==30973==    by 0x2B32DB: operator() (functional:2127)\r\n==30973==    by 0x2B32DB: ExecuteCommand (server.cpp:453)\r\n==30973==    by 0x2B32DB: CRPCTable::execute(JSONRPCRequest const&) const (server.cpp:436)\r\n==30973==\r\n==30973== HEAP SUMMARY:\r\n==30973==     in use at exit: 475,082,336 bytes in 3,760,553 blocks\r\n==30973==   total heap usage: 9,888,764 allocs, 6,128,211 frees, 1,385,505,603 bytes allocated\r\n==30973==\r\n\r\n```",
      "created_at" : "2020-06-17T11:56:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645329513",
      "id" : 645329513,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTMyOTUxMw==",
      "updated_at" : "2020-06-17T12:07:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645329513",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/47175970?v=4",
         "events_url" : "https://api.github.com/users/fscemama/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fscemama/followers",
         "following_url" : "https://api.github.com/users/fscemama/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fscemama/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fscemama",
         "id" : 47175970,
         "login" : "fscemama",
         "node_id" : "MDQ6VXNlcjQ3MTc1OTcw",
         "organizations_url" : "https://api.github.com/users/fscemama/orgs",
         "received_events_url" : "https://api.github.com/users/fscemama/received_events",
         "repos_url" : "https://api.github.com/users/fscemama/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fscemama/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fscemama/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fscemama"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke pushed 50b7e8216564d1e897f2f05b6d91abb5afd90f0c, I welcome any python ninja to make it more cool.",
      "created_at" : "2020-06-17T13:01:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645359186",
      "id" : 645359186,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTM1OTE4Ng==",
      "updated_at" : "2020-06-17T13:01:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645359186",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r441536261"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441536261"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think we can assert that a race happened. Races are only intermittent.",
      "commit_id" : "ca10f4e0ec13ac8961d7c01c2837091a08f63f98",
      "created_at" : "2020-06-17T13:16:51Z",
      "diff_hunk" : "@@ -212,6 +230,17 @@ def wallet_file(name):\n         w2 = node.get_wallet_rpc(wallet_names[1])\n         w2.getwalletinfo()\n \n+        self.log.info(\"Concurrent wallet loading\")\n+        threads = []\n+        for x in range(3):\n+            t = Thread(target=test_load_unload, args=(node, wallet_names[2], x, ))\n+            t.start()\n+            threads.append(t)\n+        for t in threads:\n+            t.join()\n+        global got_loading_error\n+        assert_equal(got_loading_error, True)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r441536261",
      "id" : 441536261,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTUzNjI2MQ==",
      "original_commit_id" : "50b7e8216564d1e897f2f05b6d91abb5afd90f0c",
      "original_line" : 242,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "test/functional/wallet_multiwallet.py",
      "position" : null,
      "pull_request_review_id" : 432389218,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-17T13:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441536261",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r441560325"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441560325"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this one is pretty much guaranteed, loading takes a bit.",
      "commit_id" : "ca10f4e0ec13ac8961d7c01c2837091a08f63f98",
      "created_at" : "2020-06-17T13:50:10Z",
      "diff_hunk" : "@@ -212,6 +230,17 @@ def wallet_file(name):\n         w2 = node.get_wallet_rpc(wallet_names[1])\n         w2.getwalletinfo()\n \n+        self.log.info(\"Concurrent wallet loading\")\n+        threads = []\n+        for x in range(3):\n+            t = Thread(target=test_load_unload, args=(node, wallet_names[2], x, ))\n+            t.start()\n+            threads.append(t)\n+        for t in threads:\n+            t.join()\n+        global got_loading_error\n+        assert_equal(got_loading_error, True)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r441560325",
      "id" : 441560325,
      "in_reply_to_id" : 441536261,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU2MDMyNQ==",
      "original_commit_id" : "50b7e8216564d1e897f2f05b6d91abb5afd90f0c",
      "original_line" : 242,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "test/functional/wallet_multiwallet.py",
      "position" : null,
      "pull_request_review_id" : 432421572,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-17T13:50:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441560325",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@fscemama if you can please repeat the test but using this branch.",
      "created_at" : "2020-06-17T13:51:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645386274",
      "id" : 645386274,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTM4NjI3NA==",
      "updated_at" : "2020-06-17T13:51:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645386274",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Sure. Can you confirm I must compile [this](https://github.com/promag/bitcoin/tree/2020-06-loadwallet) and re-test ?",
      "created_at" : "2020-06-17T14:00:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645391561",
      "id" : 645391561,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTM5MTU2MQ==",
      "updated_at" : "2020-06-17T14:00:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645391561",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/47175970?v=4",
         "events_url" : "https://api.github.com/users/fscemama/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fscemama/followers",
         "following_url" : "https://api.github.com/users/fscemama/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fscemama/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fscemama",
         "id" : 47175970,
         "login" : "fscemama",
         "node_id" : "MDQ6VXNlcjQ3MTc1OTcw",
         "organizations_url" : "https://api.github.com/users/fscemama/orgs",
         "received_events_url" : "https://api.github.com/users/fscemama/received_events",
         "repos_url" : "https://api.github.com/users/fscemama/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fscemama/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fscemama/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fscemama"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "**Successfull.** Will send these kind of normal messages:\r\n\r\n```\r\nerror code: -4\r\nerror message:\r\nWallet already being loading.\r\nerror code: -18\r\nerror message:\r\nRequested wallet does not exist or is not loaded\r\n```\r\n\r\nNo crash. Hourra!",
      "created_at" : "2020-06-17T14:32:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645411416",
      "id" : 645411416,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTQxMTQxNg==",
      "updated_at" : "2020-06-17T14:32:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645411416",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/47175970?v=4",
         "events_url" : "https://api.github.com/users/fscemama/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fscemama/followers",
         "following_url" : "https://api.github.com/users/fscemama/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fscemama/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fscemama",
         "id" : 47175970,
         "login" : "fscemama",
         "node_id" : "MDQ6VXNlcjQ3MTc1OTcw",
         "organizations_url" : "https://api.github.com/users/fscemama/orgs",
         "received_events_url" : "https://api.github.com/users/fscemama/received_events",
         "repos_url" : "https://api.github.com/users/fscemama/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fscemama/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fscemama/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fscemama"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19099 (refactor: Move wallet methods out of chain.h and node.h by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-06-17T23:28:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#issuecomment-645678498",
      "id" : 645678498,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19300",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTY3ODQ5OA==",
      "updated_at" : "2020-06-17T23:28:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645678498",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442256581"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442256581"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    auto result = WITH_LOCK(g_loading_wallet_mutex, return g_loading_wallet_set.insert(location.GetName()));\r\n    if (!result.second) {\r\n        error = Untranslated(\"Wallet already being loading.\");\r\n        return nullptr;\r\n    }\r\n```",
      "commit_id" : "ca10f4e0ec13ac8961d7c01c2837091a08f63f98",
      "created_at" : "2020-06-18T14:11:16Z",
      "diff_hunk" : "@@ -167,6 +169,25 @@ std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocati\n     }\n }\n \n+std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocation& location, bilingual_str& error, std::vector<bilingual_str>& warnings)\n+{\n+    std::pair<std::set<std::string>::iterator,bool> result;\n+    {\n+        LOCK(g_loading_wallet_mutex);\n+        result = g_loading_wallet_set.insert(location.GetName());\n+        if (!result.second) {\n+            error = Untranslated(\"Wallet already being loading.\");\n+            return nullptr;\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442256581",
      "id" : 442256581,
      "line" : 182,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI1NjU4MQ==",
      "original_commit_id" : "ca10f4e0ec13ac8961d7c01c2837091a08f63f98",
      "original_line" : 182,
      "original_position" : 36,
      "original_start_line" : 174,
      "path" : "src/wallet/wallet.cpp",
      "position" : 36,
      "pull_request_review_id" : 433323783,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300",
      "side" : "RIGHT",
      "start_line" : 174,
      "start_side" : "RIGHT",
      "updated_at" : "2020-06-18T14:32:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442256581",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442272308"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442272308"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: It seems using an unnamed namespace is preferable:\r\n- https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines.html#Rs-unnamed2\r\n- https://stackoverflow.com/questions/154469/unnamed-anonymous-namespaces-vs-static-functions\r\n- https://stackoverflow.com/questions/4422507/superiority-of-unnamed-namespace-over-static\r\n- https://stackoverflow.com/questions/4977252/why-an-unnamed-namespace-is-a-superior-alternative-to-static\r\n\r\nFrom the recent pull:\r\n- https://github.com/bitcoin/bitcoin/pull/19176#discussion_r435937252\r\n- https://github.com/bitcoin/bitcoin/pull/19176#issuecomment-641304921\r\n>  - Use anonymous namespace instead of static",
      "commit_id" : "ca10f4e0ec13ac8961d7c01c2837091a08f63f98",
      "created_at" : "2020-06-18T14:32:07Z",
      "diff_hunk" : "@@ -145,7 +147,7 @@ void UnloadWallet(std::shared_ptr<CWallet>&& wallet)\n     }\n }\n \n-std::shared_ptr<CWallet> LoadWallet(interfaces::Chain& chain, const WalletLocation& location, bilingual_str& error, std::vector<bilingual_str>& warnings)\n+static std::shared_ptr<CWallet> LoadWalletInternal(interfaces::Chain& chain, const WalletLocation& location, bilingual_str& error, std::vector<bilingual_str>& warnings)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19300#discussion_r442272308",
      "id" : 442272308,
      "line" : 150,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI3MjMwOA==",
      "original_commit_id" : "ca10f4e0ec13ac8961d7c01c2837091a08f63f98",
      "original_line" : 150,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 18,
      "pull_request_review_id" : 433323783,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19300",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T14:33:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442272308",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   }
]
