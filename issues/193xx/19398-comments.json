[
   {
      "author_association" : "MEMBER",
      "body" : "The cs_main split branch builds on top of https://github.com/bitcoin/bitcoin/pull/19219 (since the misbehavior/discouragement data members are moved to `Peer`). If you want to help with this effort, you can do so by reviewing that PR.",
      "created_at" : "2020-06-27T18:05:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19398#issuecomment-650593453",
      "id" : 650593453,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19398",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MDU5MzQ1Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-24T15:48:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/650593453",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The next PR to review is #19472. It reduces the scope of cs_main locking in misbehaviour logic with the goal of eventually moving misbehavior data to the `Peer` struct.",
      "created_at" : "2020-07-08T20:37:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19398#issuecomment-655743432",
      "id" : 655743432,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19398",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NTc0MzQzMg==",
      "updated_at" : "2020-07-08T20:37:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/655743432",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-07-10T20:44:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19398#issuecomment-656881729",
      "id" : 656881729,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19398",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1Njg4MTcyOQ==",
      "updated_at" : "2020-07-10T20:44:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/656881729",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "#19472 is merged. Next up is #19583.",
      "created_at" : "2020-07-24T15:46:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19398#issuecomment-663603802",
      "id" : 663603802,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19398",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2MzYwMzgwMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-24T15:46:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/663603802",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "#19583 is merged. Next is #19607.",
      "created_at" : "2020-07-28T09:17:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19398#issuecomment-664911114",
      "id" : 664911114,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19398",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NDkxMTExNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-28T09:17:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/664911114",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> One blocker to moving these is that the existing peer data structure in net processing is CNodeState, which is guarded by cs_main. Moving all application layer data into CNodeState would expand where we need to take and hold cs_main locks. Instead, we should create a new data structure in net processing called Peer which doesn't require a cs_main lock, and move the application layer data there.\r\n\r\nCould you explain why this is a blocker?  In practice, most of our net code is single-threaded anyway (one message processing thread), so my intuition is that there are limited places where it's actually problematic that we might hold cs_main longer.  Could you point me to those places where it'd be a concern?\r\n\r\nIt seems to me that there are two things going on here: one is moving application layer code to `net_processing` data structures and out of `net` data structures, which seems like an obvious win to me (adding some new p2p features can be tedious because of the current split).  The other is redoing the locking, which is less clear to me; I can imagine some potential use cases, but given our current architecture and behavior it's not clear to me that it's necessary to make changes here at the same time, as I don't expect there to be any real improvements until someone proposes more fundamental changes to our message processing logic.\r\n\r\nAlso, relating to the moving of data structures between `net` and `net_processing`, I think it'll be important to understand what you imagine the interface between those two modules to look like.  For instance I think we've run into implementation difficulties/complexity when writing code that is right at the intersection of those two things -- such as stale tip checking, block-relay-only peer negotiation, eviction logic for inbound peers, etc -- so it would be helpful in a new design to talk about how you envision that working.  \r\n\r\nI suppose understanding how you expect the locking/synchronization to work would make sense as well, as that might also show how tightly coupled these changes are?\r\n\r\n(A gist that explains all this at a high level would be very helpful.)",
      "created_at" : "2020-08-05T15:23:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19398#issuecomment-669257513",
      "id" : 669257513,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19398",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2OTI1NzUxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-05T15:25:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669257513",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   }
]
