[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19638 (Replace `hidden service` with `onion service` by RiccardoMasutti)\n* #15423 (torcontrol: Query Tor for correct -onion configuration by luke-jr)\n* #14729 (correct -onion default to -proxy behavior by qubenix)\n* #14425 (Net: Do not re-enable Onion network when it was disabled via onlynet by wodry)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-06-23T09:51:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-648036330",
      "id" : 648036330,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19358",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0ODAzNjMzMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-01T16:42:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/648036330",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19358#discussion_r446993600"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19358"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446993600"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this should also log when `SetProxy` fails, as It means there is a bug in the software. After all it tries to set a hardcoded value which *should* never fail.",
      "commit_id" : "463314b1271373c72f5bf7ea81c8ce66898e6d8f",
      "created_at" : "2020-06-29T13:59:52Z",
      "diff_hunk" : "@@ -524,11 +524,15 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n \n         // Now that we know Tor is running setup the proxy for onion addresses\n         // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Or if we have already an outbound proxy defined. we skip this footgun gracefully.\n+        proxyType addrOnion;\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && !GetProxy(NET_ONION, addrOnion)) {\n             CService resolved(LookupNumeric(\"127.0.0.1\", 9050));\n-            proxyType addrOnion = proxyType(resolved, true);\n-            SetProxy(NET_ONION, addrOnion);\n-            SetReachable(NET_ONION, true);\n+            addrOnion = proxyType(resolved, gArgs.GetBoolArg(\"-proxyrandomize\", true));\n+            if (SetProxy(NET_ONION, addrOnion)) {\n+                LogPrintf(\"tor: Default outbound tor .onion address proxy is set to 127.0.0.1:9050\\n\");\n+                SetReachable(NET_ONION, true);\n+            }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19358#discussion_r446993600",
      "id" : 446993600,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5MzYwMA==",
      "original_commit_id" : "e83815d1fbe3985aa68d9b913379861be5506734",
      "original_line" : 535,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : null,
      "pull_request_review_id" : 439172649,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19358",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-02T07:02:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446993600",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19358#discussion_r446994541"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19358"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446994541"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please log to the right category:\r\n```c++\r\nLogPrint(BCLog::TOR, \"tor: Default outbound tor .onion address proxy is set to 127.0.0.1:9050\\n\");\r\n```",
      "commit_id" : "463314b1271373c72f5bf7ea81c8ce66898e6d8f",
      "created_at" : "2020-06-29T14:01:11Z",
      "diff_hunk" : "@@ -524,11 +524,15 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n \n         // Now that we know Tor is running setup the proxy for onion addresses\n         // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Or if we have already an outbound proxy defined. we skip this footgun gracefully.\n+        proxyType addrOnion;\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && !GetProxy(NET_ONION, addrOnion)) {\n             CService resolved(LookupNumeric(\"127.0.0.1\", 9050));\n-            proxyType addrOnion = proxyType(resolved, true);\n-            SetProxy(NET_ONION, addrOnion);\n-            SetReachable(NET_ONION, true);\n+            addrOnion = proxyType(resolved, gArgs.GetBoolArg(\"-proxyrandomize\", true));\n+            if (SetProxy(NET_ONION, addrOnion)) {\n+                LogPrintf(\"tor: Default outbound tor .onion address proxy is set to 127.0.0.1:9050\\n\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19358#discussion_r446994541",
      "id" : 446994541,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5NDU0MQ==",
      "original_commit_id" : "e83815d1fbe3985aa68d9b913379861be5506734",
      "original_line" : 533,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : null,
      "pull_request_review_id" : 439173910,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19358",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-02T07:02:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446994541",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, good catch.\r\n\r\nConcept ACK on the doc change as well. Though I'd suggest not refering to \"nameproxy\" as that's an internal implementation detail. I think the gist is:\r\n```patch\r\n+                       Note: Only the -proxy option will set the proxy used for DNS requests.\r\n+                       With this option these will not route over Tor.\r\n+                       So please use -proxy if you have privacy concerns with this.\r\n```\r\nThis is the case because `-onion` is for multi-network nodes. You *only* want to use this option if you want your node to be able to connect to hidden services *as well*. Otherwise, always use `-proxy`.\r\n\r\nBTW: as you found, the go-to document for configuring bitcoin over tor is `doc/tor.md`. It suggests using `-proxy` to route everything over tor. At some point it might make sense to refer to that instead of trying to cram everything in the option help.\r\n\r\n> And indeed the -onlynet flags are clearly disregarded in respect to onions since #7553. \r\n\r\nLast time I checked,  `onlynet=onion` still works, in combination with `proxy=127.0.0.1:9050`, to only make outgoing connections to onion peers.\r\n",
      "created_at" : "2020-06-29T14:12:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-651148819",
      "id" : 651148819,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19358",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MTE0ODgxOQ==",
      "updated_at" : "2020-06-29T14:12:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/651148819",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Last time I checked, `onlynet=onion` still works, in combination with `proxy=127.0.0.1:9050`, to only make outgoing connections to onion peers.\r\n\r\nthx, hmm, lets put it that way. Suppose a user selects -onlynet=ipv4 selects -listen  and  -proxy or none. I guess the least thing a human would expect in that case, is that the node would use a forgotten open existing tor port, to kindly out and inbound route onion traffic.\r\nSo i vote for an additional PR in line with #14425.\r\n\r\nThe more elleborate tor,md change when merged including your suggestions, at least warn now the user off this implications with the options use, but honestly, would you expect\r\na pure` bitcoind -listen -onlynet=ipv4 ` node would ever connect outbound *automatic* to tor ? \r\n\r\nFact is, exactly that happens, a node that had an onion tor past and knows some onions, even later with a pure -onlynet=ipv4 conf, will open automatic outbound to those onions over tor, if a configed tor lingers forgotten or not  on that cruft.\r\n\r\n Ì¶IÌ¶tÌ¶sÌ¶ Ì¶nÌ¶oÌ¶tÌ¶ Ì¶eÌ¶aÌ¶sÌ¶yÌ¶ Ì¶tÌ¶oÌ¶ Ì¶cÌ¶rÌ¶aÌ¶fÌ¶tÌ¶ Ì¶nÌ¶oÌ¶dÌ¶eÌ¶sÌ¶ Ì¶tÌ¶oÌ¶ Ì¶dÌ¶oÌ¶ Ì¶tÌ¶hÌ¶iÌ¶sÌ¶ Ì¶iÌ¶nÌ¶ Ì¶aÌ¶ Ì¶oÌ¶nÌ¶eÌ¶ Ì¶sÌ¶hÌ¶oÌ¶tÌ¶ Ì¶tÌ¶eÌ¶sÌ¶tÌ¶ Ì¶sÌ¶eÌ¶tÌ¶uÌ¶pÌ¶,Ì¶ Ì¶IÌ¶ Ì¶tÌ¶rÌ¶yÌ¶ Ì¶tÌ¶oÌ¶ Ì¶pÌ¶oÌ¶sÌ¶tÌ¶ Ì¶hÌ¶eÌ¶rÌ¶eÌ¶ Ì¶aÌ¶ Ì¶bÌ¶aÌ¶sÌ¶hÌ¶ Ì¶sÌ¶cÌ¶rÌ¶iÌ¶pÌ¶tÌ¶ Ì¶tÌ¶hÌ¶aÌ¶tÌ¶ Ì¶dÌ¶oÌ¶eÌ¶sÌ¶ Ì¶tÌ¶hÌ¶eÌ¶ Ì¶sÌ¶tÌ¶eÌ¶pÌ¶sÌ¶,Ì¶ Ì¶sÌ¶iÌ¶nÌ¶cÌ¶eÌ¶ Ì¶tÌ¶hÌ¶aÌ¶tÌ¶ Ì¶iÌ¶sÌ¶ Ì¶aÌ¶ Ì¶bÌ¶iÌ¶tÌ¶ Ì¶rÌ¶eÌ¶lÌ¶aÌ¶tÌ¶eÌ¶dÌ¶ Ì¶tÌ¶oÌ¶ Ì¶wÌ¶hÌ¶aÌ¶tÌ¶ Ì¶wÌ¶eÌ¶ Ì¶fÌ¶iÌ¶xÌ¶ Ì¶hÌ¶eÌ¶rÌ¶eÌ¶,Ì¶ Ì¶mÌ¶iÌ¶gÌ¶hÌ¶tÌ¶ Ì¶bÌ¶eÌ¶ Ì¶tÌ¶hÌ¶eÌ¶ Ì¶rÌ¶iÌ¶gÌ¶hÌ¶tÌ¶ Ì¶pÌ¶lÌ¶aÌ¶cÌ¶eÌ¶?Ì¶   \r\n\r\nIts a *d-feature*?. although u need some patience i.e. if you do just ``` bitcoind -onlynet=ipv6 ```-listen on such node with forgotten working tor, that had fw or poor ipv6 outbound after some time since almost all hardcoded v2 onions are broken AFAICS only 3 of them work.the rng will roundabout 1 hours later have found a working one and _automatic_ outbound connect over tor, *what a magic.!*     \r\n ",
      "created_at" : "2020-06-30T16:09:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-651894425",
      "id" : 651894425,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19358",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MTg5NDQyNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-05T15:42:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/651894425",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19358#discussion_r457040394"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19358"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457040394"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/,ipv6/, ipv6/",
      "commit_id" : "463314b1271373c72f5bf7ea81c8ce66898e6d8f",
      "created_at" : "2020-07-20T04:34:15Z",
      "diff_hunk" : "@@ -29,8 +34,13 @@ outgoing connections, but more is possible.\n \n \t-onlynet=onion  Make outgoing connections only to .onion addresses. Incoming\n \t                connections are not affected by this option. This option can be\n-\t                specified multiple times to allow multiple network types, e.g.\n-\t                ipv4, ipv6, or onion.\n+\t                specified multiple times to define a set of general allowed network\n+\t                types, e.g. ipv4,ipv6 or onion. If you use this option",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19358#discussion_r457040394",
      "id" : 457040394,
      "line" : 38,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzA0MDM5NA==",
      "original_commit_id" : "463314b1271373c72f5bf7ea81c8ce66898e6d8f",
      "original_line" : 38,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "doc/tor.md",
      "position" : 29,
      "pull_request_review_id" : 451289717,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19358",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-20T04:55:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457040394",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19358#discussion_r457040991"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19358"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457040991"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: while here, can you please touch this up to add a missing comma and fix \"setup\", which is a noun but not a verb:\r\n\r\n`s/running setup/running, set up/`",
      "commit_id" : "463314b1271373c72f5bf7ea81c8ce66898e6d8f",
      "created_at" : "2020-07-20T04:35:42Z",
      "diff_hunk" : "@@ -524,11 +524,15 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n \n         // Now that we know Tor is running setup the proxy for onion addresses",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19358#discussion_r457040991",
      "id" : 457040991,
      "line" : 525,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzA0MDk5MQ==",
      "original_commit_id" : "463314b1271373c72f5bf7ea81c8ce66898e6d8f",
      "original_line" : 525,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : 2,
      "pull_request_review_id" : 451289717,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19358",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-20T04:55:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457040991",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19358#discussion_r457042473"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19358"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457042473"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        // Or if an outbound proxy is already defined, we can skip this gracefully.\r\n```",
      "commit_id" : "463314b1271373c72f5bf7ea81c8ce66898e6d8f",
      "created_at" : "2020-07-20T04:39:10Z",
      "diff_hunk" : "@@ -524,11 +524,15 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n \n         // Now that we know Tor is running setup the proxy for onion addresses\n         // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Or if we have already an outbound proxy defined. we skip this footgun gracefully.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19358#discussion_r457042473",
      "id" : 457042473,
      "line" : 527,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzA0MjQ3Mw==",
      "original_commit_id" : "463314b1271373c72f5bf7ea81c8ce66898e6d8f",
      "original_line" : 527,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : 5,
      "pull_request_review_id" : 451289717,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19358",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-20T04:58:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457042473",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19358#discussion_r457048910"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19358"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457048910"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            } else {\r\n                LogPrint(BCLog::TOR, \"tor: Failed to create default outbound tor .onion address proxy for 127.0.0.1:9050\\n\");\r\n            }\r\n```",
      "commit_id" : "463314b1271373c72f5bf7ea81c8ce66898e6d8f",
      "created_at" : "2020-07-20T04:53:59Z",
      "diff_hunk" : "@@ -524,11 +524,15 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n \n         // Now that we know Tor is running setup the proxy for onion addresses\n         // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Or if we have already an outbound proxy defined. we skip this footgun gracefully.\n+        proxyType addrOnion;\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && !GetProxy(NET_ONION, addrOnion)) {\n             CService resolved(LookupNumeric(\"127.0.0.1\", 9050));\n-            proxyType addrOnion = proxyType(resolved, true);\n-            SetProxy(NET_ONION, addrOnion);\n-            SetReachable(NET_ONION, true);\n+            addrOnion = proxyType(resolved, gArgs.GetBoolArg(\"-proxyrandomize\", true));\n+            if (SetProxy(NET_ONION, addrOnion)) {\n+                LogPrint(BCLog::TOR, \"tor: Default outbound tor .onion address proxy is set to 127.0.0.1:9050\\n\");\n+                SetReachable(NET_ONION, true);\n+            } else LogPrint(BCLog::TOR, \"tor: Error default outbound tor .onion address proxy for 127.0.0.1:9050 failed to create\\n\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19358#discussion_r457048910",
      "id" : 457048910,
      "line" : 535,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzA0ODkxMA==",
      "original_commit_id" : "463314b1271373c72f5bf7ea81c8ce66898e6d8f",
      "original_line" : 535,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : 16,
      "pull_request_review_id" : 451289717,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19358",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-20T04:55:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457048910",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19358#discussion_r457941757"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19358"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457941757"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "thx, had run it trough clang-format-diff and it also re-formated the net enum,  will come up with test and clang-diff fixup push that we that can autosquash ... , if you want to be co, i could commit the suggest as is, since i see it the same way, my while dev sarcasm comments must not be merged in the final version?",
      "commit_id" : "463314b1271373c72f5bf7ea81c8ce66898e6d8f",
      "created_at" : "2020-07-21T08:54:07Z",
      "diff_hunk" : "@@ -524,11 +524,15 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n \n         // Now that we know Tor is running setup the proxy for onion addresses\n         // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Or if we have already an outbound proxy defined. we skip this footgun gracefully.\n+        proxyType addrOnion;\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && !GetProxy(NET_ONION, addrOnion)) {\n             CService resolved(LookupNumeric(\"127.0.0.1\", 9050));\n-            proxyType addrOnion = proxyType(resolved, true);\n-            SetProxy(NET_ONION, addrOnion);\n-            SetReachable(NET_ONION, true);\n+            addrOnion = proxyType(resolved, gArgs.GetBoolArg(\"-proxyrandomize\", true));\n+            if (SetProxy(NET_ONION, addrOnion)) {\n+                LogPrint(BCLog::TOR, \"tor: Default outbound tor .onion address proxy is set to 127.0.0.1:9050\\n\");\n+                SetReachable(NET_ONION, true);\n+            } else LogPrint(BCLog::TOR, \"tor: Error default outbound tor .onion address proxy for 127.0.0.1:9050 failed to create\\n\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19358#discussion_r457941757",
      "id" : 457941757,
      "in_reply_to_id" : 457048910,
      "line" : 535,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk0MTc1Nw==",
      "original_commit_id" : "463314b1271373c72f5bf7ea81c8ce66898e6d8f",
      "original_line" : 535,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : 16,
      "pull_request_review_id" : 452257173,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19358",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-21T08:54:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457941757",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19358#discussion_r457944217"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19358"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457944217"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Also i think about, split the tor.md from this PR since wording yields always to intensive discussion. ",
      "commit_id" : "463314b1271373c72f5bf7ea81c8ce66898e6d8f",
      "created_at" : "2020-07-21T08:57:56Z",
      "diff_hunk" : "@@ -524,11 +524,15 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n \n         // Now that we know Tor is running setup the proxy for onion addresses\n         // if -onion isn't set to something else.\n-        if (gArgs.GetArg(\"-onion\", \"\") == \"\") {\n+        // Or if we have already an outbound proxy defined. we skip this footgun gracefully.\n+        proxyType addrOnion;\n+        if (gArgs.GetArg(\"-onion\", \"\") == \"\" && !GetProxy(NET_ONION, addrOnion)) {\n             CService resolved(LookupNumeric(\"127.0.0.1\", 9050));\n-            proxyType addrOnion = proxyType(resolved, true);\n-            SetProxy(NET_ONION, addrOnion);\n-            SetReachable(NET_ONION, true);\n+            addrOnion = proxyType(resolved, gArgs.GetBoolArg(\"-proxyrandomize\", true));\n+            if (SetProxy(NET_ONION, addrOnion)) {\n+                LogPrint(BCLog::TOR, \"tor: Default outbound tor .onion address proxy is set to 127.0.0.1:9050\\n\");\n+                SetReachable(NET_ONION, true);\n+            } else LogPrint(BCLog::TOR, \"tor: Error default outbound tor .onion address proxy for 127.0.0.1:9050 failed to create\\n\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19358#discussion_r457944217",
      "id" : 457944217,
      "in_reply_to_id" : 457048910,
      "line" : 535,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk0NDIxNw==",
      "original_commit_id" : "463314b1271373c72f5bf7ea81c8ce66898e6d8f",
      "original_line" : 535,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/torcontrol.cpp",
      "position" : 16,
      "pull_request_review_id" : 452260298,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19358",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-21T08:57:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457944217",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Concept NACK, I think... If we're using -torcontrol, it makes sense to override -proxy (which is primarily for non-onion connections, and only used as a default for onions if no other is specified).\r\n> \r\n> Perhaps a better alternative would be to disable -torcontrol (parameter interaction) if -proxy or -onion are set?\r\n\r\nI thought also about your suggestion, but dismissed that, since we have more problems that we should solve.\r\n\r\nIf you say pure -onion how to make sure the node does not dox the hidden service when the nameproxy is only selected by -proxy?  And -onlynet=onion had never worked for seeds since they use ipv4 connect and dns anyway in disregard of any conf and when you say -dns they resolve over tor and with 5 known correlated seeders on bootstrap you are doxed again.\r\nAnd then when you say -dnseed=0,  after one hour or so when you least expect it the random conman selects one of the 3 only active fixed seed onions, oops doxed again. What is build here is the prefect catch22.  \r\n\r\nPls look also at #14425 and the patch for -onlynet i posted there,\r\nThe status quo should change anyway and i am open for suggestions, But when -torcontrol would override -proxy in general that was introduced when tor was enabled to make outbound sock5 onion connections, i see not really why we should mix inbound -torcontrol configurations with outbound proxy that cloud be a remote tor cruft  not in any way related to the local tor service port. \r\n     \r\nAlso #19043 -tortarget should be seen in that whole tor setup logic it make from a privacy perspective prefect sense to add such an option as you can easy forward over tor the hidden service from an other cruft, what makes things even more interesting if you want to have tx and mempool fill,  uncorrelated to your normal node operations and somewhat quasi on the fly could enable this,.\r\n\r\nCloud you outline how you would see the tor implementation work?\r\nWant we have now is not in line with the documentation, so we have to change anyway.\r\nAnd since our implementation with the keys stored permanent is as ephemeral as the holy night.\r\nI would like to mention here that we have with the Tor browser a stress free on click way to generate new hidden true ephemeral services on the fly i.e. over 9150/51 for posting as temp 3D code for short inbound. I guess something you would like to have from an other PR of yours. What is a good idea and nice to have..\r\n.\r\nso hmm.. what now?. \r\n     \r\n\r\n",
      "created_at" : "2020-07-24T14:28:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-663566338",
      "id" : 663566338,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19358",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2MzU2NjMzOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-24T14:28:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/663566338",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-08-09T14:16:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-671057239",
      "id" : 671057239,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19358",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MTA1NzIzOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-09T14:16:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/671057239",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "changed hidden to onion and rebased https://github.com/bitcoin/bitcoin/pull/19358/commits/468c60c5ed908ca8029db241b75aa8f893866c74 https://github.com/bitcoin/bitcoin/pull/19358/commits/654dc04b67a44199352a1b25494c9d617cd090bc",
      "created_at" : "2020-08-15T12:42:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19358#issuecomment-674392034",
      "id" : 674392034,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19358",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDM5MjAzNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-15T12:42:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674392034",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   }
]
