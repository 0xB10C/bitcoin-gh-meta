[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19137 (wallettool: Add dump and createfromdump commands by achow101)\n* #19102 (wallet: Introduce and use DummyDatabase instead of dummy BerkeleyDatabase by achow101)\n* #19077 (wallet: Add sqlite as an alternative wallet database and use it for new descriptor wallets by achow101)\n* #18971 (wallet: Refactor the classes in wallet/db.{cpp/h} by achow101)\n* #18608 (refactor: Remove CAddressBookData::destdata by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-06-17T23:18:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#issuecomment-645675131",
      "id" : 645675131,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19308",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTY3NTEzMQ==",
      "updated_at" : "2020-06-17T23:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645675131",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442285323"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442285323"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: coding style `} else if (!ret) {`",
      "commit_id" : "cda86544ae9de430e4558b87945046d5612202ac",
      "created_at" : "2020-06-18T14:48:40Z",
      "diff_hunk" : "@@ -861,11 +863,15 @@ DBErrors WalletBatch::FindWalletTx(std::vector<uint256>& vTxHash, std::list<CWal\n             // Read next record\n             CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n             CDataStream ssValue(SER_DISK, CLIENT_VERSION);\n-            int ret = m_batch.ReadAtCursor(pcursor, ssKey, ssValue);\n-            if (ret == DB_NOTFOUND)\n+            bool complete;\n+            bool ret = m_batch.ReadAtCursor(ssKey, ssValue, complete);\n+            if (complete) {\n+                m_batch.CloseCursor();\n                 break;\n-            else if (ret != 0)\n+            }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442285323",
      "id" : 442285323,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI4NTMyMw==",
      "original_commit_id" : "40d31e31820bf2a6675d326d816e6da7b4dc714b",
      "original_line" : 871,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 433361872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T14:57:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442285323",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This does limit flexibility a bit, though I guess one cursor at a time is enough for all our current and future use cases.",
      "created_at" : "2020-06-18T14:49:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#issuecomment-646068957",
      "id" : 646068957,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19308",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjA2ODk1Nw==",
      "updated_at" : "2020-06-18T14:49:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646068957",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442290726"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442290726"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think `StartCursor` would be a better name, after all, the whole process (including details like whether something is created) is internal.",
      "commit_id" : "cda86544ae9de430e4558b87945046d5612202ac",
      "created_at" : "2020-06-18T14:55:50Z",
      "diff_hunk" : "@@ -738,27 +739,32 @@ void BerkeleyDatabase::ReloadDbEnv()\n     }\n }\n \n-Dbc* BerkeleyBatch::GetCursor()\n+bool BerkeleyBatch::CreateCursor()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442290726",
      "id" : 442290726,
      "line" : 742,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI5MDcyNg==",
      "original_commit_id" : "40d31e31820bf2a6675d326d816e6da7b4dc714b",
      "original_line" : 742,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : 47,
      "pull_request_review_id" : 433368972,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T14:57:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442290726",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442291942"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442291942"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "cda86544ae9de430e4558b87945046d5612202ac",
      "created_at" : "2020-06-18T14:57:28Z",
      "diff_hunk" : "@@ -861,11 +863,15 @@ DBErrors WalletBatch::FindWalletTx(std::vector<uint256>& vTxHash, std::list<CWal\n             // Read next record\n             CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n             CDataStream ssValue(SER_DISK, CLIENT_VERSION);\n-            int ret = m_batch.ReadAtCursor(pcursor, ssKey, ssValue);\n-            if (ret == DB_NOTFOUND)\n+            bool complete;\n+            bool ret = m_batch.ReadAtCursor(ssKey, ssValue, complete);\n+            if (complete) {\n+                m_batch.CloseCursor();\n                 break;\n-            else if (ret != 0)\n+            }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#discussion_r442291942",
      "id" : 442291942,
      "in_reply_to_id" : 442285323,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI5MTk0Mg==",
      "original_commit_id" : "40d31e31820bf2a6675d326d816e6da7b4dc714b",
      "original_line" : 871,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 433370582,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19308",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T14:57:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442291942",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> This does limit flexibility a bit, though I guess one cursor at a time is enough for all our current and future use cases.\r\n\r\nIf another cursor was needed, you could use another Batch object. But we barely use cursors, so one is enough for now.",
      "created_at" : "2020-06-18T14:58:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#issuecomment-646075489",
      "id" : 646075489,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19308",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjA3NTQ4OQ==",
      "updated_at" : "2020-06-18T14:58:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646075489",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> If another cursor was needed, you could use another Batch object. But we barely use cursors, so one is enough for now.\r\n\r\nOhh! I missed that it's on the batch, not on the database object.",
      "created_at" : "2020-06-18T15:03:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19308#issuecomment-646079286",
      "id" : 646079286,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19308",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjA3OTI4Ng==",
      "updated_at" : "2020-06-18T15:03:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646079286",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
