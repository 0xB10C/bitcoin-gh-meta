[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "signet/miner --poisson attempts to simulate the distribution of times you'd see on mainnet. My original reasoning for the 60 minute cap is that you only expect 0.25% of blocks to take that long, so what does it matter. With a lower cap it seems worthwhile checking what that effects. I think you can work out the expected average with a cap as follows:\r\n\r\n```py\r\ndef expected_times(tgt, N=100000):\r\n    return [tgt*-math.log(1-i*1.0/N) for i in range(N)]\r\n\r\ndef capped_average(seq, cap):\r\n    sum, cnt = 0,0\r\n    for v in seq:\r\n        sum += min(v, cap)\r\n        cnt += 1\r\n    return sum/cnt\r\n\r\ndef bisect(f, want, l=0, h=100000, prec=0.0005):\r\n    while l + prec < h:\r\n        m = (l + h)/2\r\n        if f(m) < want:\r\n            l = m\r\n        else:\r\n            h = m\r\n    return h\r\n\r\nfor cap in [11, 15, 16, 20, 25, 30, 45, 60]:\r\n    tgt = bisect(lambda t: capped_average(expected_times(t), cap*60), 600)\r\n    print(\"cap=%dmin, tgt=%.2fmin, average=%ds\" % (cap, tgt/60, capped_average(expected_times(tgt), cap*60)))\r\n\r\n# results:\r\n# cap=11min, tgt=56.78min, average=600.0s\r\n# cap=15min, tgt=17.16min, average=600.0s\r\n# cap=16min, tgt=15.58min, average=600.0s\r\n# cap=20min, tgt=12.55min, average=600.0s\r\n# cap=25min, tgt=11.20min, average=600.0s\r\n# cap=30min, tgt=10.63min, average=600.0s\r\n# cap=45min, tgt=10.12min, average=600.0s\r\n# cap=60min, tgt=10.03min, average=600.0s\r\n```\r\n\r\nThat is, if you have a cap of 30 minutes, you need to be trying to have blocks every 10.63 minutes instead of every ten minutes because after applying the cap, you actual average will be reduced by that much. Effectively, this means the actual difficulty will generally be somewhat above the `--nbits` target, causing the signet miner to attempt to reduce the difficulty by mining more slowly, but that reduction will be offset in practice by the cap.\r\n\r\nIt seems to me like 30 minutes is a nice round figure that doesn't cause anything to get too weird; and I've used 16minutes as a lower limit, since below that, you're targetting an average block interval that's higher than your maximum acceptable block interval, so it's probably better to just not use `--poisson` at all at that point, I think.",
      "created_at" : "2022-09-29T19:45:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26208#issuecomment-1262736176",
      "id" : 1262736176,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26208",
      "node_id" : "IC_kwDOABII585LQ9Mw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1262736176/reactions"
      },
      "updated_at" : "2022-09-29T19:45:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1262736176",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   }
]
