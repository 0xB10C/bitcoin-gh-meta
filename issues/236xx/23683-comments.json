[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "cc @MarcoFalke, thanks for catching my bug :bug:",
      "created_at" : "2021-12-06T11:27:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-986688016",
      "id" : 986688016,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23683",
      "node_id" : "IC_kwDOABII5846z6oQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986688016/reactions"
      },
      "updated_at" : "2021-12-06T11:27:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986688016",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762930383"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762930383"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Why is this needed? The `self.sync_all()` in the next line should take care of that already. I think it should be fine to remove either this line or the next.",
      "commit_id" : "bd716bf774d21956ec7ae616d06a2a896568ed18",
      "created_at" : "2021-12-06T11:39:47Z",
      "diff_hunk" : "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762930383",
      "id" : 762930383,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584teWTP",
      "original_commit_id" : "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "original_line" : 109,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/mempool_reorg.py",
      "position" : null,
      "pull_request_review_id" : 823847626,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762930383/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T11:43:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762930383",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762930557"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762930557"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Why is this needed? Are they not connected already?",
      "commit_id" : "bd716bf774d21956ec7ae616d06a2a896568ed18",
      "created_at" : "2021-12-06T11:40:05Z",
      "diff_hunk" : "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762930557",
      "id" : 762930557,
      "line" : 112,
      "node_id" : "PRRC_kwDOABII584teWV9",
      "original_commit_id" : "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "original_line" : 112,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/mempool_reorg.py",
      "position" : 5,
      "pull_request_review_id" : 823847626,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762930557/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T11:43:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762930557",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762931172"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931172"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Why are the asserts needed? The implicit `self.sync_all` in the next line should assert this already.",
      "commit_id" : "bd716bf774d21956ec7ae616d06a2a896568ed18",
      "created_at" : "2021-12-06T11:41:02Z",
      "diff_hunk" : "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)\n+        assert_equal(self.nodes[0].getblockcount(), self.nodes[1].getblockcount())\n+        assert_equal(set(self.nodes[0].getrawmempool()), set(self.nodes[0].getrawmempool()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762931172",
      "id" : 762931172,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584teWfk",
      "original_commit_id" : "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "original_line" : 116,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "test/functional/mempool_reorg.py",
      "position" : null,
      "pull_request_review_id" : 823847626,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931172/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T11:43:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931172",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762931588"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931588"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Why is this needed? The wallet will pick a utxo by itself.",
      "commit_id" : "bd716bf774d21956ec7ae616d06a2a896568ed18",
      "created_at" : "2021-12-06T11:41:37Z",
      "diff_hunk" : "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)\n+        assert_equal(self.nodes[0].getblockcount(), self.nodes[1].getblockcount())\n+        assert_equal(set(self.nodes[0].getrawmempool()), set(self.nodes[0].getrawmempool()))\n+        self.generate(self.nodes[0], 3)\n+        # Create another transaction which is time-locked to two blocks in the future\n+        utxo = wallet.get_utxo()\n+        timelock_tx_2 = wallet.create_self_transfer(\n+            from_node=self.nodes[0],\n+            utxo_to_spend=utxo,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762931588",
      "id" : 762931588,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584teWmE",
      "original_commit_id" : "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "original_line" : 122,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "test/functional/mempool_reorg.py",
      "position" : null,
      "pull_request_review_id" : 823847626,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931588/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T11:43:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762931929"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931929"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Why is this needed? You can use `self.no_op`",
      "commit_id" : "bd716bf774d21956ec7ae616d06a2a896568ed18",
      "created_at" : "2021-12-06T11:42:08Z",
      "diff_hunk" : "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)\n+        assert_equal(self.nodes[0].getblockcount(), self.nodes[1].getblockcount())\n+        assert_equal(set(self.nodes[0].getrawmempool()), set(self.nodes[0].getrawmempool()))\n+        self.generate(self.nodes[0], 3)\n+        # Create another transaction which is time-locked to two blocks in the future\n+        utxo = wallet.get_utxo()\n+        timelock_tx_2 = wallet.create_self_transfer(\n+            from_node=self.nodes[0],\n+            utxo_to_spend=utxo,\n+            mempool_valid=False,\n+            locktime=self.nodes[0].getblockcount() + 2\n+        )['hex']\n+        # Check that the time-locked transaction is too immature to spend\n+        assert_raises_rpc_error(-26, \"non-final\", self.nodes[0].sendrawtransaction, timelock_tx_2)\n+        assert_raises_rpc_error(-26, \"non-final\", self.nodes[1].sendrawtransaction, timelock_tx_2)\n+\n+        self.log.info(\"Disconnect nodes and mine separate forks\")\n+        self.disconnect_nodes(0, 1)\n+        # Don't try to sync nodes because they are disconnected\n+        no_sync_func = lambda: True",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762931929",
      "id" : 762931929,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584teWrZ",
      "original_commit_id" : "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "original_line" : 133,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "test/functional/mempool_reorg.py",
      "position" : null,
      "pull_request_review_id" : 823847626,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931929/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T11:43:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931929",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965682"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "They don't stay in sync if I don't call `connect_nodes` here... it also doesn't work if I call `connect_nodes(1, 0)` instead. So my guess is that this creation of a manual connection from node0 to node1 adds a permission that we need.",
      "commit_id" : "bd716bf774d21956ec7ae616d06a2a896568ed18",
      "created_at" : "2021-12-06T12:32:45Z",
      "diff_hunk" : "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965682",
      "id" : 762965682,
      "in_reply_to_id" : 762930557,
      "line" : 112,
      "node_id" : "PRRC_kwDOABII584tee6y",
      "original_commit_id" : "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "original_line" : 112,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/mempool_reorg.py",
      "position" : 5,
      "pull_request_review_id" : 823895457,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965682/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T12:32:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965737"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965737"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "removed",
      "commit_id" : "bd716bf774d21956ec7ae616d06a2a896568ed18",
      "created_at" : "2021-12-06T12:32:50Z",
      "diff_hunk" : "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)\n+        assert_equal(self.nodes[0].getblockcount(), self.nodes[1].getblockcount())\n+        assert_equal(set(self.nodes[0].getrawmempool()), set(self.nodes[0].getrawmempool()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965737",
      "id" : 762965737,
      "in_reply_to_id" : 762931172,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tee7p",
      "original_commit_id" : "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "original_line" : 116,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "test/functional/mempool_reorg.py",
      "position" : null,
      "pull_request_review_id" : 823895535,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965737/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T12:32:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965737",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965821"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965821"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "removed",
      "commit_id" : "bd716bf774d21956ec7ae616d06a2a896568ed18",
      "created_at" : "2021-12-06T12:32:57Z",
      "diff_hunk" : "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)\n+        assert_equal(self.nodes[0].getblockcount(), self.nodes[1].getblockcount())\n+        assert_equal(set(self.nodes[0].getrawmempool()), set(self.nodes[0].getrawmempool()))\n+        self.generate(self.nodes[0], 3)\n+        # Create another transaction which is time-locked to two blocks in the future\n+        utxo = wallet.get_utxo()\n+        timelock_tx_2 = wallet.create_self_transfer(\n+            from_node=self.nodes[0],\n+            utxo_to_spend=utxo,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965821",
      "id" : 762965821,
      "in_reply_to_id" : 762931588,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tee89",
      "original_commit_id" : "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "original_line" : 122,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "test/functional/mempool_reorg.py",
      "position" : null,
      "pull_request_review_id" : 823895638,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965821/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T12:32:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965821",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965966"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ahh, didn't know about that - fixed",
      "commit_id" : "bd716bf774d21956ec7ae616d06a2a896568ed18",
      "created_at" : "2021-12-06T12:33:11Z",
      "diff_hunk" : "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)\n+        assert_equal(self.nodes[0].getblockcount(), self.nodes[1].getblockcount())\n+        assert_equal(set(self.nodes[0].getrawmempool()), set(self.nodes[0].getrawmempool()))\n+        self.generate(self.nodes[0], 3)\n+        # Create another transaction which is time-locked to two blocks in the future\n+        utxo = wallet.get_utxo()\n+        timelock_tx_2 = wallet.create_self_transfer(\n+            from_node=self.nodes[0],\n+            utxo_to_spend=utxo,\n+            mempool_valid=False,\n+            locktime=self.nodes[0].getblockcount() + 2\n+        )['hex']\n+        # Check that the time-locked transaction is too immature to spend\n+        assert_raises_rpc_error(-26, \"non-final\", self.nodes[0].sendrawtransaction, timelock_tx_2)\n+        assert_raises_rpc_error(-26, \"non-final\", self.nodes[1].sendrawtransaction, timelock_tx_2)\n+\n+        self.log.info(\"Disconnect nodes and mine separate forks\")\n+        self.disconnect_nodes(0, 1)\n+        # Don't try to sync nodes because they are disconnected\n+        no_sync_func = lambda: True",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965966",
      "id" : 762965966,
      "in_reply_to_id" : 762931929,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tee_O",
      "original_commit_id" : "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "original_line" : 133,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "test/functional/mempool_reorg.py",
      "position" : null,
      "pull_request_review_id" : 823895859,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965966/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T12:33:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965966",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762966229"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762966229"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "removed",
      "commit_id" : "bd716bf774d21956ec7ae616d06a2a896568ed18",
      "created_at" : "2021-12-06T12:33:28Z",
      "diff_hunk" : "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762966229",
      "id" : 762966229,
      "in_reply_to_id" : 762930383,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tefDV",
      "original_commit_id" : "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "original_line" : 109,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/mempool_reorg.py",
      "position" : null,
      "pull_request_review_id" : 823896117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762966229/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T12:33:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762966229",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763013572"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763013572"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this comment can be removed. Mutable iterators in the mempool don't exist and the function name is self-explanatory.",
      "commit_id" : "bd716bf774d21956ec7ae616d06a2a896568ed18",
      "created_at" : "2021-12-06T13:38:44Z",
      "diff_hunk" : "@@ -312,6 +312,19 @@ class CompareTxMemPoolEntryByAncestorFee\n     }\n };\n \n+/**\n+ * Update LockPoints in a mempool entry for which the caller only has a const iterator to.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763013572",
      "id" : 763013572,
      "line" : 316,
      "node_id" : "PRRC_kwDOABII584teqnE",
      "original_commit_id" : "034f13a14a180ee5c060879b686972230d748a22",
      "original_line" : 316,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 5,
      "pull_request_review_id" : 823962604,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763013572/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T14:56:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763013572",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763015410"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763015410"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in the second commit: Maybe mention that the bug was introduces in commit  bedf246 ?",
      "commit_id" : "bd716bf774d21956ec7ae616d06a2a896568ed18",
      "created_at" : "2021-12-06T13:41:05Z",
      "diff_hunk" : "@@ -378,6 +378,8 @@ void CChainState::MaybeUpdateMempoolForReorg(\n                 }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763015410",
      "id" : 763015410,
      "line" : 378,
      "node_id" : "PRRC_kwDOABII584terDy",
      "original_commit_id" : "f1f3f19f84da6bc5a157d9bf2e5c0500f53ae614",
      "original_line" : 378,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 1,
      "pull_request_review_id" : 823962604,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763015410/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T14:56:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763015410",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763037472"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763037472"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: missing trailing `,`.",
      "commit_id" : "bd716bf774d21956ec7ae616d06a2a896568ed18",
      "created_at" : "2021-12-06T14:07:54Z",
      "diff_hunk" : "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase\n+        self.generate(self.nodes[0], 2)\n+        # Create another transaction which is time-locked to two blocks in the future\n+        timelock_tx_2 = wallet.create_self_transfer(\n+            from_node=self.nodes[0],\n+            mempool_valid=False,\n+            locktime=self.nodes[0].getblockcount() + 2",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763037472",
      "id" : 763037472,
      "line" : 119,
      "node_id" : "PRRC_kwDOABII584tewcg",
      "original_commit_id" : "bd716bf774d21956ec7ae616d06a2a896568ed18",
      "original_line" : 119,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "test/functional/mempool_reorg.py",
      "position" : 12,
      "pull_request_review_id" : 823962604,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763037472/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T14:56:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763037472",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763051867"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763051867"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah ok, it is not possible to use compact blocks during IBD",
      "commit_id" : "bd716bf774d21956ec7ae616d06a2a896568ed18",
      "created_at" : "2021-12-06T14:24:09Z",
      "diff_hunk" : "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763051867",
      "id" : 763051867,
      "in_reply_to_id" : 762930557,
      "line" : 112,
      "node_id" : "PRRC_kwDOABII584tez9b",
      "original_commit_id" : "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "original_line" : 112,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/mempool_reorg.py",
      "position" : 5,
      "pull_request_review_id" : 823962604,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763051867/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T14:56:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763051867",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763115678"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115678"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "added",
      "commit_id" : "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "created_at" : "2021-12-06T15:32:13Z",
      "diff_hunk" : "@@ -378,6 +378,8 @@ void CChainState::MaybeUpdateMempoolForReorg(\n                 }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763115678",
      "id" : 763115678,
      "in_reply_to_id" : 763015410,
      "line" : 378,
      "node_id" : "PRRC_kwDOABII584tfDie",
      "original_commit_id" : "f1f3f19f84da6bc5a157d9bf2e5c0500f53ae614",
      "original_line" : 378,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 1,
      "pull_request_review_id" : 824105584,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115678/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T15:32:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115678",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763115781"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115781"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "added",
      "commit_id" : "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "created_at" : "2021-12-06T15:32:20Z",
      "diff_hunk" : "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase\n+        self.generate(self.nodes[0], 2)\n+        # Create another transaction which is time-locked to two blocks in the future\n+        timelock_tx_2 = wallet.create_self_transfer(\n+            from_node=self.nodes[0],\n+            mempool_valid=False,\n+            locktime=self.nodes[0].getblockcount() + 2",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763115781",
      "id" : 763115781,
      "in_reply_to_id" : 763037472,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tfDkF",
      "original_commit_id" : "bd716bf774d21956ec7ae616d06a2a896568ed18",
      "original_line" : 119,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "test/functional/mempool_reorg.py",
      "position" : null,
      "pull_request_review_id" : 824105729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115781/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T15:32:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115781",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763115892"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115892"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "removed",
      "commit_id" : "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "created_at" : "2021-12-06T15:32:25Z",
      "diff_hunk" : "@@ -312,6 +312,19 @@ class CompareTxMemPoolEntryByAncestorFee\n     }\n };\n \n+/**\n+ * Update LockPoints in a mempool entry for which the caller only has a const iterator to.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763115892",
      "id" : 763115892,
      "in_reply_to_id" : 763013572,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tfDl0",
      "original_commit_id" : "034f13a14a180ee5c060879b686972230d748a22",
      "original_line" : 316,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 824105858,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115892/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T15:32:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115892",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763794040"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763794040"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was thinking \"what if we skip those transactions with `should_remove=true` here?\". I guess, we'll have the same original problem: they won't be cleared because we would mistakenly think they have valid `lp` in `removeForReorg`?\r\n\r\nPerhaps this deserves a comment extension, saying that txs to be removed must be updated here.",
      "commit_id" : "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "created_at" : "2021-12-07T09:21:39Z",
      "diff_hunk" : "@@ -378,6 +378,8 @@ void CChainState::MaybeUpdateMempoolForReorg(\n                 }\n             }\n         }\n+        // CheckSequenceLocks updates lp. Update the mempool entry LockPoints.\n+        if (!validLP) m_mempool->mapTx.modify(it, update_lock_points(lp));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763794040",
      "id" : 763794040,
      "line" : 382,
      "node_id" : "PRRC_kwDOABII584thpJ4",
      "original_commit_id" : "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_line" : 382,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 5,
      "pull_request_review_id" : 824999003,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763794040/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-07T09:22:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763794040",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763810771"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763810771"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "No, they'll still be cleared - `removeForReorg` just applies `check_final_and_mature` on all entries and removes them if it returns true, it doesn't check whether the `lp` is valid. I'm not 100% sure if we could skip the `should_remove=true` ones, but I think it would be fine. The `CheckSequenceLocks` function doesn't guarantee `lp` to be reliable if it returns false, and the function doesn't even get executed if `CheckFinalTx` returns false.",
      "commit_id" : "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "created_at" : "2021-12-07T09:41:07Z",
      "diff_hunk" : "@@ -378,6 +378,8 @@ void CChainState::MaybeUpdateMempoolForReorg(\n                 }\n             }\n         }\n+        // CheckSequenceLocks updates lp. Update the mempool entry LockPoints.\n+        if (!validLP) m_mempool->mapTx.modify(it, update_lock_points(lp));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763810771",
      "id" : 763810771,
      "in_reply_to_id" : 763794040,
      "line" : 382,
      "node_id" : "PRRC_kwDOABII584thtPT",
      "original_commit_id" : "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_line" : 382,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 5,
      "pull_request_review_id" : 825021997,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763810771/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-07T09:41:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763810771",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 28b60ce3122b29ffad2c60790d3bfe9a2ede2471\r\n\r\nThe bug is pretty scary, good thing we found it this soon, and the fix is straightforward.\r\nThe test looks correct.",
      "created_at" : "2021-12-07T09:53:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-987752880",
      "id" : 987752880,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23683",
      "node_id" : "IC_kwDOABII58463-mw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987752880/reactions"
      },
      "updated_at" : "2021-12-07T09:53:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987752880",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763836593"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763836593"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree that it is safe to skip if the tx will be removed anyway. When this was introduced in commit 14d6324a248df50cb79fbeb5b60a978687a3b64e it updates unconditionally.",
      "commit_id" : "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "created_at" : "2021-12-07T10:09:13Z",
      "diff_hunk" : "@@ -378,6 +378,8 @@ void CChainState::MaybeUpdateMempoolForReorg(\n                 }\n             }\n         }\n+        // CheckSequenceLocks updates lp. Update the mempool entry LockPoints.\n+        if (!validLP) m_mempool->mapTx.modify(it, update_lock_points(lp));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763836593",
      "id" : 763836593,
      "in_reply_to_id" : 763794040,
      "line" : 382,
      "node_id" : "PRRC_kwDOABII584thzix",
      "original_commit_id" : "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_line" : 382,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 5,
      "pull_request_review_id" : 825058969,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763836593/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-07T10:09:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763836593",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Too bad this can't properly be tested on regtest. I guess the only way is via a pre-mined main-chain?\r\n\r\nAh no. I don't think this is possible to test at all. The lockpoints are just a cache and if it is outdated, evaluating it will always return false, in which case the lockpoints are re-evaluated. So this is not fixing a behaviour bug, but potentially improving performance a bit?",
      "created_at" : "2021-12-07T10:13:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-987771707",
      "id" : 987771707,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23683",
      "node_id" : "IC_kwDOABII58464DM7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987771707/reactions"
      },
      "updated_at" : "2021-12-07T10:13:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987771707",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
