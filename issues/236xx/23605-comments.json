[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated from 46cdabc to 503359e\r\nAddressed @MarcoFalke comment\r\n\r\nChanges:\r\n1. Corrected Clang Formatting\r\n\r\n> Wouldn't it be better to return the error from StartTorControl? This way, other error conditions that are currently silently ignored are reported to the user.\r\n\r\nLet me take a look and try to figure it out.",
      "created_at" : "2021-11-26T13:44:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23605#issuecomment-979988602",
      "id" : 979988602,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23605",
      "node_id" : "IC_kwDOABII5846aXB6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/979988602/reactions"
      },
      "updated_at" : "2021-11-26T13:44:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/979988602",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/85434418?v=4",
         "events_url" : "https://api.github.com/users/shaavan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/shaavan/followers",
         "following_url" : "https://api.github.com/users/shaavan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/shaavan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/shaavan",
         "id" : 85434418,
         "login" : "shaavan",
         "node_id" : "MDQ6VXNlcjg1NDM0NDE4",
         "organizations_url" : "https://api.github.com/users/shaavan/orgs",
         "received_events_url" : "https://api.github.com/users/shaavan/received_events",
         "repos_url" : "https://api.github.com/users/shaavan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/shaavan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/shaavan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/shaavan"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Wouldn't it be better to return the error from StartTorControl? This way, other error conditions that are currently silently ignored are reported to the user.\r\n\r\nA drawback of this is that `TorControl` is called fairly late in the initialization process. To provide quick feedback to the user, I like the current early validation in that regard.\r\n(the implementation logic could still be moved to a function in `torcontrol.cpp` ofc).",
      "created_at" : "2021-11-26T14:25:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23605#issuecomment-980013210",
      "id" : 980013210,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23605",
      "node_id" : "IC_kwDOABII5846adCa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/980013210/reactions"
      },
      "updated_at" : "2021-11-26T14:25:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/980013210",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Sure, I am not against early sanity checks. Though, some errors can only be checked when the thread is started, so I don't think there is any way to avoid the delay (in general). Currently all errors are ignored, so anything that turns them into actual init errors is an improvement, regardless of when that happens.",
      "created_at" : "2021-11-26T14:36:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23605#issuecomment-980024581",
      "id" : 980024581,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23605",
      "node_id" : "IC_kwDOABII5846af0F",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/980024581/reactions"
      },
      "updated_at" : "2021-11-26T14:36:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/980024581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> the implementation logic could still be moved to a function in torcontrol.cpp ofc\r\n\r\nSo would you suggest I should move `isValidHostPort` under the torcontrol.cpp file?",
      "created_at" : "2021-11-26T14:51:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23605#issuecomment-980036359",
      "id" : 980036359,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23605",
      "node_id" : "IC_kwDOABII5846aisH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/980036359/reactions"
      },
      "updated_at" : "2021-11-26T14:51:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/980036359",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/85434418?v=4",
         "events_url" : "https://api.github.com/users/shaavan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/shaavan/followers",
         "following_url" : "https://api.github.com/users/shaavan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/shaavan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/shaavan",
         "id" : 85434418,
         "login" : "shaavan",
         "node_id" : "MDQ6VXNlcjg1NDM0NDE4",
         "organizations_url" : "https://api.github.com/users/shaavan/orgs",
         "received_events_url" : "https://api.github.com/users/shaavan/received_events",
         "repos_url" : "https://api.github.com/users/shaavan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/shaavan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/shaavan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/shaavan"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Though, some errors can only be checked when the thread is started, so I don't think there is any way to avoid the delay (in general)\r\n\r\nRight. I'm fine with moving the check there, to be clear.\r\n\r\n> So would you suggest I should move isValidHostPort under the torcontrol.cpp file?\r\n\r\nNo, not really. If it's a generally useful utility function it makes sense to put it under `util`. Though `utilstrencodings.cpp` is somewhat debatable, it's network utility functionality not general number/string parsing.\r\n\r\nIt was more of a question of where to put the argument checking logic itself, with regard to responsibilities. Init shouldn't \"know\" the implementation details of everything. It's already a big mess in that regard. So you could add a function, say, `TorControlArgumentChecks` that calls `IsValidHostPort`, logs a message and returns the status, and call that from Init.\r\n\r\nBut I agree with @MarcoFalke 's solution.",
      "created_at" : "2021-11-26T15:07:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23605#issuecomment-980045955",
      "id" : 980045955,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23605",
      "node_id" : "IC_kwDOABII5846alCD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/980045955/reactions"
      },
      "updated_at" : "2021-11-26T15:07:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/980045955",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Though utilstrencodings.cpp is somewhat debatable, it's network utility functionality not general number/string parsing.\r\n\r\nThat's true. I was not sure where to put the function since none of the `util/` files felt right for this function.\r\nSo what do you think would be the right place to move it to:\r\n1. Move it under `util/url.cpp`\r\n2. Create a new `util/network.cpp` file and move this fn under it.\r\n\r\n(p.s. I know I should try figuring out myself instead of asking. But I want to get this PR right, and a little expert's advice always helps)\r\n\r\n> So you could add a function, say, TorControlArgumentChecks, that calls IsValidHostPort\r\n\r\nI got your point here. Let me fix this while we think about the right place for the IsValidHostPort function.",
      "created_at" : "2021-11-26T15:50:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23605#issuecomment-980070991",
      "id" : 980070991,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23605",
      "node_id" : "IC_kwDOABII5846arJP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/980070991/reactions"
      },
      "updated_at" : "2021-11-26T15:50:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/980070991",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/85434418?v=4",
         "events_url" : "https://api.github.com/users/shaavan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/shaavan/followers",
         "following_url" : "https://api.github.com/users/shaavan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/shaavan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/shaavan",
         "id" : 85434418,
         "login" : "shaavan",
         "node_id" : "MDQ6VXNlcjg1NDM0NDE4",
         "organizations_url" : "https://api.github.com/users/shaavan/orgs",
         "received_events_url" : "https://api.github.com/users/shaavan/received_events",
         "repos_url" : "https://api.github.com/users/shaavan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/shaavan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/shaavan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/shaavan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\n\r\nTried experimenting with PR branch and use `-torcontrol`. Can't use domain anymore which was added in https://github.com/bitcoin/bitcoin/pull/22288\r\n\r\n```\r\nbitcoind -torcontrol=localhost:9051\r\n\r\nError: -torcontrol has to be in the form <host>:<port>\r\n```\r\n\r\nAlso not sure about use of `regex` or if this can be implemented without using it. However I will leave that for others to comment who understand C++ better. Its used in [`src/bench/bench.cpp`](https://github.com/bitcoin/bitcoin/blob/03cb2b480bd5e35cd6bafbca3ff6adcba52dab8b/) so maybe its okay if done correctly.",
      "created_at" : "2021-11-26T16:00:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23605#issuecomment-980076565",
      "id" : 980076565,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23605",
      "node_id" : "IC_kwDOABII5846asgV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/980076565/reactions"
      },
      "updated_at" : "2021-11-26T16:01:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/980076565",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@prayank23 Thanks for testing. Handling domains is a good point. We really need a test for this.\r\n\r\n> Also not sure about use of regex or if this can be implemented without using it. \r\n\r\nDoing it without introducing use of `regex` should definitely be possible. We already necessarily parse the host:port spec after all, the thing missing is error feedback.\r\n",
      "created_at" : "2021-11-29T10:15:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23605#issuecomment-981491687",
      "id" : 981491687,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23605",
      "node_id" : "IC_kwDOABII5846gF_n",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/981491687/reactions"
      },
      "updated_at" : "2021-11-29T10:15:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/981491687",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#22087](https://github.com/bitcoin/bitcoin/pull/22087) (Validate port numbers by amadeuszpawlik)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-12-02T00:52:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23605#issuecomment-984192460",
      "id" : 984192460,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23605",
      "node_id" : "IC_kwDOABII5846qZXM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/984192460/reactions"
      },
      "updated_at" : "2021-12-02T00:52:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/984192460",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
