[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-05-14T00:08:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#issuecomment-628309919",
      "id" : 628309919,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18971",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyODMwOTkxOQ==",
      "updated_at" : "2020-05-14T00:08:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/628309919",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18918 (wallet: Move salvagewallet into wallettool by achow101)\n* #18907 (walletdb: Don't remove database transaction logs and instead error by achow101)\n* #18904 (Don't call lsn_reset in periodic flush by bvbfan)\n* #18836 (wallet: upgradewallet fixes and additional tests by achow101)\n* #18792 (wallet: Remove boost from PeriodicFlush by MarcoFalke)\n* #18731 (refactor: Make CCheckQueue RAII-styled by hebasto)\n* #18710 (Add local thread pool to CCheckQueue by hebasto)\n* #18618 (gui: Drop RecentRequestsTableModel dependency to WalletModel by promag)\n* #18608 (refactor: Remove CAddressBookData::destdata by ryanofsky)\n* #18354 (Protect wallet by using shared pointers by bvbfan)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-05-14T03:06:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#issuecomment-628358883",
      "id" : 628358883,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18971",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyODM1ODg4Mw==",
      "updated_at" : "2020-05-23T06:57:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/628358883",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Strong concept ACK for the effort and end result, but I'm scared it looks like the intermediate commits here are moving and changing code at the same time instead of just leaving code where it is or moving it in trivial to review `--color-moved` MOVEONLY commits. This was previously a hurdle for me in https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-541330425, but maybe the problem is less severe here because it looks like the moves are happening in single commits, not in harder to reconcile add and remove commits.\r\n\r\nI would definitely appreciate it (can't speak for other reviewers) if this PR could be updated to use MOVEONLY commits (multiple small ones throughout or a big one at the beginning or end), but I'll give this a try and maybe the review will be easier than I'm expecting ð ",
      "created_at" : "2020-05-14T22:33:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#issuecomment-628920481",
      "id" : 628920481,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18971",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyODkyMDQ4MQ==",
      "updated_at" : "2020-05-14T22:33:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/628920481",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> but I'm scared it looks like the intermediate commits here are moving and changing code at the same time instead of just leaving code where it is or moving it in trivial to review\r\n\r\nI only found one commit which was moving and changing behavior at the same time. This was `wallet: Move cursor functions to WalletDatabase and handle internally` which I have now split into `walletdb: Handle cursor internally` (changes behavior) and `walletdb: Move cursor functions to WalletDatabase` (move).",
      "created_at" : "2020-05-15T01:39:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#issuecomment-628975249",
      "id" : 628975249,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18971",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyODk3NTI0OQ==",
      "updated_at" : "2020-05-15T01:39:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/628975249",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "The patch changes ref counting of db files. Now `Acquire` is called only in `Rewrite` since previous batch do it. Now ref count is always 0 (except you call Rewrite) which makes whole read/write racy.",
      "created_at" : "2020-05-15T13:01:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#issuecomment-629222719",
      "id" : 629222719,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18971",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyOTIyMjcxOQ==",
      "updated_at" : "2020-05-15T13:01:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/629222719",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/8323581?v=4",
         "events_url" : "https://api.github.com/users/bvbfan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bvbfan/followers",
         "following_url" : "https://api.github.com/users/bvbfan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bvbfan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bvbfan",
         "id" : 8323581,
         "login" : "bvbfan",
         "node_id" : "MDQ6VXNlcjgzMjM1ODE=",
         "organizations_url" : "https://api.github.com/users/bvbfan/orgs",
         "received_events_url" : "https://api.github.com/users/bvbfan/received_events",
         "repos_url" : "https://api.github.com/users/bvbfan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bvbfan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bvbfan"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> The patch changes ref counting of db files. Now `Acquire` is called only in `Rewrite` since previous batch do it. Now ref count is always 0 (except you call Rewrite) which makes whole read/write racy.\r\n\r\n`Acquire` is called by `WalletBatch`'s constructor so the ref count is still incremented every time the database is being used. And `Release` is called by `WalletBatch`'s destructor.",
      "created_at" : "2020-05-15T16:15:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#issuecomment-629349300",
      "id" : 629349300,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18971",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyOTM0OTMwMA==",
      "updated_at" : "2020-05-15T16:15:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/629349300",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18971#discussion_r426012118"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18971"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426012118"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `const fs::path&`\r\n\r\nin commit: d4a55140ea3e47ee6e4c93c484c7c72cfed741dd",
      "commit_id" : "f06619ecd41d08484e02e41fc06a840b9057fcb6",
      "created_at" : "2020-05-15T19:44:02Z",
      "diff_hunk" : "@@ -103,6 +105,207 @@ static void WalletShowInfo(CWallet* wallet_instance)\n     tfm::format(std::cout, \"Address Book: %zu\\n\", wallet_instance->m_address_book.size());\n }\n \n+/* End of headers, beginning of key/value data */\n+static const char *HEADER_END = \"HEADER=END\";\n+/* End of key/value data */\n+static const char *DATA_END = \"DATA=END\";\n+\n+static bool SalvageWallet(fs::path path)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#discussion_r426012118",
      "id" : 426012118,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjAxMjExOA==",
      "original_commit_id" : "0f991e733516fa26e1ceaca10a5b582093950e53",
      "original_line" : 113,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 412921503,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18971",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-28T20:48:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426012118",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18971#discussion_r426013423"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18971"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426013423"
         }
      },
      "author_association" : "MEMBER",
      "body" : "IMO \"Attempt to recover private keys from a corrupt wallet\" explains salvage more clearly than \"Perform salvage operations on a wallet file\". I understand that's specific to `RecoverKeysOnlyFilter`, but perhaps its possible to clarify the documentation?\r\n\r\n",
      "commit_id" : "f06619ecd41d08484e02e41fc06a840b9057fcb6",
      "created_at" : "2020-05-15T19:46:53Z",
      "diff_hunk" : "@@ -54,7 +54,6 @@ void WalletInit::AddWalletOptions() const\n     gArgs.AddArg(\"-paytxfee=<amt>\", strprintf(\"Fee (in %s/kB) to add to transactions you send (default: %s)\",\n                                                             CURRENCY_UNIT, FormatMoney(CFeeRate{DEFAULT_PAY_TX_FEE}.GetFeePerK())), ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);\n     gArgs.AddArg(\"-rescan\", \"Rescan the block chain for missing wallet transactions on startup\", ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);\n-    gArgs.AddArg(\"-salvagewallet\", \"Attempt to recover private keys from a corrupt wallet on startup\", ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#discussion_r426013423",
      "id" : 426013423,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjAxMzQyMw==",
      "original_commit_id" : "8ef1b45b4d3de71214da1a6bc6e09f6e9a14d7d4",
      "original_line" : 57,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/init.cpp",
      "position" : null,
      "pull_request_review_id" : 412923311,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18971",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-28T20:48:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426013423",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18971#discussion_r426067977"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18971"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426067977"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This commit is part of #18918 so comments should be left there.",
      "commit_id" : "f06619ecd41d08484e02e41fc06a840b9057fcb6",
      "created_at" : "2020-05-15T22:08:15Z",
      "diff_hunk" : "@@ -103,6 +105,207 @@ static void WalletShowInfo(CWallet* wallet_instance)\n     tfm::format(std::cout, \"Address Book: %zu\\n\", wallet_instance->m_address_book.size());\n }\n \n+/* End of headers, beginning of key/value data */\n+static const char *HEADER_END = \"HEADER=END\";\n+/* End of key/value data */\n+static const char *DATA_END = \"DATA=END\";\n+\n+static bool SalvageWallet(fs::path path)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#discussion_r426067977",
      "id" : 426067977,
      "in_reply_to_id" : 426012118,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjA2Nzk3Nw==",
      "original_commit_id" : "0f991e733516fa26e1ceaca10a5b582093950e53",
      "original_line" : 113,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 412994378,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18971",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-28T20:48:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426067977",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18971#discussion_r426067999"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18971"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426067999"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This commit is part of #18918 so comments should be left there.",
      "commit_id" : "f06619ecd41d08484e02e41fc06a840b9057fcb6",
      "created_at" : "2020-05-15T22:08:20Z",
      "diff_hunk" : "@@ -54,7 +54,6 @@ void WalletInit::AddWalletOptions() const\n     gArgs.AddArg(\"-paytxfee=<amt>\", strprintf(\"Fee (in %s/kB) to add to transactions you send (default: %s)\",\n                                                             CURRENCY_UNIT, FormatMoney(CFeeRate{DEFAULT_PAY_TX_FEE}.GetFeePerK())), ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);\n     gArgs.AddArg(\"-rescan\", \"Rescan the block chain for missing wallet transactions on startup\", ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);\n-    gArgs.AddArg(\"-salvagewallet\", \"Attempt to recover private keys from a corrupt wallet on startup\", ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#discussion_r426067999",
      "id" : 426067999,
      "in_reply_to_id" : 426013423,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjA2Nzk5OQ==",
      "original_commit_id" : "8ef1b45b4d3de71214da1a6bc6e09f6e9a14d7d4",
      "original_line" : 57,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/init.cpp",
      "position" : null,
      "pull_request_review_id" : 412994405,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18971",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-28T20:48:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426067999",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@achow101 re @ryanofsky's comment, I set out to expand and clarify https://github.com/bitcoin/bitcoin/pull/18971/commits/67e30b2b42b4d710739e6fe303cbca69be68032c into several simpler move-only commits. \r\n\r\nYou can use `git diff 67e30b2b42b4d710739e6fe303cbca69be68032c 125796d8e60b8e740857e427cbaad4aa23f74b52` to compare the results, as there are some changes I've left out, and slight difference, e.g. I took the approach of exposing `WalletBatch::ReadKeyValue`, but they don't affect the later commits.\r\n\r\nhttps://github.com/achow101/bitcoin/compare/refactor-storage...Empact:refactor-storage-moveonly",
      "created_at" : "2020-05-15T22:39:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#issuecomment-629535592",
      "id" : 629535592,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18971",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyOTUzNTU5Mg==",
      "updated_at" : "2020-05-15T22:39:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/629535592",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Empact Thanks for doing that! Unfortunately I worked out my own way of doing the separation before I saw your comment. My version was pushed to #18918.",
      "created_at" : "2020-05-15T23:55:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#issuecomment-629553130",
      "id" : 629553130,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18971",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyOTU1MzEzMA==",
      "updated_at" : "2020-05-15T23:55:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/629553130",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> `Acquire` is called by `WalletBatch`'s constructor so the ref count is still incremented every time the database is being used. And `Release` is called by `WalletBatch`'s destructor.\r\n\r\nGot'cha, sorry about that, i've not notice it. I still have concern about touching db env in multi threading. `BerkeleyDatabase` should guard every env usage, for example in contructor with shared env, the easiest test is to call `CreateWalletFromFile` from distinct threads with same db location, it will crash at \r\n`auto inserted = this->env->m_databases.emplace(strFile, std::ref(*this));`\r\nbefore actual assert in next line.",
      "created_at" : "2020-05-17T16:58:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#issuecomment-629828484",
      "id" : 629828484,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18971",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyOTgyODQ4NA==",
      "updated_at" : "2020-05-17T16:58:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/629828484",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/8323581?v=4",
         "events_url" : "https://api.github.com/users/bvbfan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bvbfan/followers",
         "following_url" : "https://api.github.com/users/bvbfan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bvbfan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bvbfan",
         "id" : 8323581,
         "login" : "bvbfan",
         "node_id" : "MDQ6VXNlcjgzMjM1ODE=",
         "organizations_url" : "https://api.github.com/users/bvbfan/orgs",
         "received_events_url" : "https://api.github.com/users/bvbfan/received_events",
         "repos_url" : "https://api.github.com/users/bvbfan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bvbfan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bvbfan"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-05-18T10:53:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#issuecomment-630104158",
      "id" : 630104158,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18971",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMDEwNDE1OA==",
      "updated_at" : "2020-05-18T10:53:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/630104158",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18971#discussion_r427420606"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18971"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427420606"
         }
      },
      "author_association" : "MEMBER",
      "body" : "When building with clang --enable-debug -Werror I'm seeing the following compiler error:\r\n\r\n```cpp\r\n./wallet/walletdb.h:322:112: error: member access into incomplete type 'CWallet'\r\n             CWalletScanState &wss, std::string& strType, std::string& strErr) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet);\r\n                                                                                                               ^\r\n./wallet/ismine.h:14:7: note: forward declaration of 'CWallet'\r\nclass CWallet;\r\n      ^\r\n1 error generated.\r\n```",
      "commit_id" : "f06619ecd41d08484e02e41fc06a840b9057fcb6",
      "created_at" : "2020-05-19T16:05:32Z",
      "diff_hunk" : "@@ -287,11 +290,47 @@ class WalletBatch\n     //! Abort current transaction\n     bool TxnAbort();\n private:\n-    BerkeleyBatch m_batch;\n     WalletDatabase& m_database;\n };\n \n //! Compacts BDB state so that wallet.dat is self-contained (if there are changes)\n void MaybeCompactWalletDB();\n \n+//! State of scanning the wallet during ReadKeyValue\n+class CWalletScanState {\n+public:\n+    unsigned int nKeys{0};\n+    unsigned int nCKeys{0};\n+    unsigned int nWatchKeys{0};\n+    unsigned int nKeyMeta{0};\n+    unsigned int m_unknown_records{0};\n+    bool fIsEncrypted{false};\n+    bool fAnyUnordered{false};\n+    std::vector<uint256> vWalletUpgrade;\n+    std::map<OutputType, uint256> m_active_external_spks;\n+    std::map<OutputType, uint256> m_active_internal_spks;\n+    std::map<uint256, DescriptorCache> m_descriptor_caches;\n+    std::map<std::pair<uint256, CKeyID>, CKey> m_descriptor_keys;\n+    std::map<std::pair<uint256, CKeyID>, std::pair<CPubKey, std::vector<unsigned char>>> m_descriptor_crypt_keys;\n+\n+    CWalletScanState() {\n+    }\n+};\n+\n+//! Unserialize a give Key-Value pair and load it into the wallet and wallet scan state\n+bool ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n+             CWalletScanState &wss, std::string& strType, std::string& strErr) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#discussion_r427420606",
      "id" : 427420606,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQyMDYwNg==",
      "original_commit_id" : "6c47d41779ec5b335acf75652228d541b7a5b67a",
      "original_line" : 322,
      "original_position" : 110,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.h",
      "position" : null,
      "pull_request_review_id" : 414600810,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18971",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-28T20:48:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427420606",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18971#discussion_r427423048"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18971"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427423048"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(It may not be directly related to this PR; saw a similar build error in another wallet PR today.)",
      "commit_id" : "f06619ecd41d08484e02e41fc06a840b9057fcb6",
      "created_at" : "2020-05-19T16:09:00Z",
      "diff_hunk" : "@@ -287,11 +290,47 @@ class WalletBatch\n     //! Abort current transaction\n     bool TxnAbort();\n private:\n-    BerkeleyBatch m_batch;\n     WalletDatabase& m_database;\n };\n \n //! Compacts BDB state so that wallet.dat is self-contained (if there are changes)\n void MaybeCompactWalletDB();\n \n+//! State of scanning the wallet during ReadKeyValue\n+class CWalletScanState {\n+public:\n+    unsigned int nKeys{0};\n+    unsigned int nCKeys{0};\n+    unsigned int nWatchKeys{0};\n+    unsigned int nKeyMeta{0};\n+    unsigned int m_unknown_records{0};\n+    bool fIsEncrypted{false};\n+    bool fAnyUnordered{false};\n+    std::vector<uint256> vWalletUpgrade;\n+    std::map<OutputType, uint256> m_active_external_spks;\n+    std::map<OutputType, uint256> m_active_internal_spks;\n+    std::map<uint256, DescriptorCache> m_descriptor_caches;\n+    std::map<std::pair<uint256, CKeyID>, CKey> m_descriptor_keys;\n+    std::map<std::pair<uint256, CKeyID>, std::pair<CPubKey, std::vector<unsigned char>>> m_descriptor_crypt_keys;\n+\n+    CWalletScanState() {\n+    }\n+};\n+\n+//! Unserialize a give Key-Value pair and load it into the wallet and wallet scan state\n+bool ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n+             CWalletScanState &wss, std::string& strType, std::string& strErr) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#discussion_r427423048",
      "id" : 427423048,
      "in_reply_to_id" : 427420606,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQyMzA0OA==",
      "original_commit_id" : "6c47d41779ec5b335acf75652228d541b7a5b67a",
      "original_line" : 322,
      "original_position" : 110,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.h",
      "position" : null,
      "pull_request_review_id" : 414603837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18971",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-28T20:48:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427423048",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Not sure what's causing the travis failure. It seems to be caused for a non-existent fileid when `get_fileid` is called, but I can't figure out why that would be the case nor can I replicate it locally.",
      "created_at" : "2020-05-21T17:19:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#issuecomment-632235166",
      "id" : 632235166,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18971",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjIzNTE2Ng==",
      "updated_at" : "2020-05-21T17:19:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632235166",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Not sure what's causing the travis failure. It seems to be caused for a non-existent fileid when `get_fileid` is called, but I can't figure out why that would be the case nor can I replicate it locally.\r\n\r\n`get_fileid` should not be called in mock db (some older bdb version in Travis?)",
      "created_at" : "2020-05-26T13:22:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#issuecomment-634021594",
      "id" : 634021594,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18971",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNDAyMTU5NA==",
      "updated_at" : "2020-05-26T13:23:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/634021594",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/8323581?v=4",
         "events_url" : "https://api.github.com/users/bvbfan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bvbfan/followers",
         "following_url" : "https://api.github.com/users/bvbfan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bvbfan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bvbfan",
         "id" : 8323581,
         "login" : "bvbfan",
         "node_id" : "MDQ6VXNlcjgzMjM1ODE=",
         "organizations_url" : "https://api.github.com/users/bvbfan/orgs",
         "received_events_url" : "https://api.github.com/users/bvbfan/received_events",
         "repos_url" : "https://api.github.com/users/bvbfan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bvbfan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bvbfan"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> `get_fileid` should not be called in mock db\r\n\r\nAh, that's probably it. Thanks. Odd that I can't get the error locally though.\r\n\r\n> (some older bdb version in Travis?)\r\n\r\nIt's actually newer. Travis typically uses BDB provided by Ubuntu which is 5.3. I have 4.8 installed on my system.",
      "created_at" : "2020-05-26T18:52:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#issuecomment-634211030",
      "id" : 634211030,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18971",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNDIxMTAzMA==",
      "updated_at" : "2020-05-26T18:52:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/634211030",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> It's actually newer. Travis typically uses BDB provided by Ubuntu which is 5.3. I have 4.8 installed on my system.\r\n\r\nI can't reproduce it either, bdb 5.3.28.",
      "created_at" : "2020-05-27T10:42:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#issuecomment-634578411",
      "id" : 634578411,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18971",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNDU3ODQxMQ==",
      "updated_at" : "2020-05-27T10:42:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/634578411",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/8323581?v=4",
         "events_url" : "https://api.github.com/users/bvbfan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bvbfan/followers",
         "following_url" : "https://api.github.com/users/bvbfan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bvbfan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bvbfan",
         "id" : 8323581,
         "login" : "bvbfan",
         "node_id" : "MDQ6VXNlcjgzMjM1ODE=",
         "organizations_url" : "https://api.github.com/users/bvbfan/orgs",
         "received_events_url" : "https://api.github.com/users/bvbfan/received_events",
         "repos_url" : "https://api.github.com/users/bvbfan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bvbfan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bvbfan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18971#discussion_r431230059"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18971"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431230059"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"walletdb: Combine VerifyDatabaseFile and VerifyEnvironment\" (289aa21c6a6c11ce172a92f878a3ede6652fc2e4)\r\n\r\nHere and below filesystem_error is no longer caught. Would suggest adding it back to preserve error handling behavior (I could be missing something but it looks like BerkeleyEnvironment::Open could still throw this error)",
      "commit_id" : "f06619ecd41d08484e02e41fc06a840b9057fcb6",
      "created_at" : "2020-05-27T15:26:21Z",
      "diff_hunk" : "@@ -3680,17 +3680,7 @@ bool CWallet::Verify(interfaces::Chain& chain, const WalletLocation& location, b\n \n     // Keep same database environment instance across Verify/Recover calls below.\n     std::unique_ptr<WalletDatabase> database = WalletDatabase::Create(wallet_path);\n-\n-    try {\n-        if (!WalletBatch::VerifyEnvironment(wallet_path, error_string)) {\n-            return false;\n-        }\n-    } catch (const fs::filesystem_error& e) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#discussion_r431230059",
      "id" : 431230059,
      "line" : 3688,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIzMDA1OQ==",
      "original_commit_id" : "289aa21c6a6c11ce172a92f878a3ede6652fc2e4",
      "original_line" : 3688,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 35,
      "pull_request_review_id" : 419340191,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18971",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-28T20:48:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431230059",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18971#discussion_r431245932"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18971"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431245932"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"walletdb: Move Db->open to BerkeleyDatabase::Open\" (d0ccd47c355319ec9709c52cdcdf0be78a26ac25)\r\n\r\nNote: seems like there two small changes to behavior here when IsDummy is true: CLIENT_VERSION is written and strFile member is set, but both changes seem good.",
      "commit_id" : "f06619ecd41d08484e02e41fc06a840b9057fcb6",
      "created_at" : "2020-05-27T15:46:34Z",
      "diff_hunk" : "@@ -351,13 +351,26 @@ void BerkeleyEnvironment::CheckpointLSN(const std::string& strFile)\n \n BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bool fFlushOnCloseIn) : pdb(nullptr), activeTxn(nullptr)\n {\n+    database.Open(pszMode);\n     fReadOnly = (!strchr(pszMode, '+') && !strchr(pszMode, 'w'));\n     fFlushOnClose = fFlushOnCloseIn;\n     env = database.env.get();\n-    if (database.IsDummy()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#discussion_r431245932",
      "id" : 431245932,
      "line" : 368,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI0NTkzMg==",
      "original_commit_id" : "d0ccd47c355319ec9709c52cdcdf0be78a26ac25",
      "original_line" : 368,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : 356,
      "pull_request_review_id" : 419340191,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18971",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-28T20:48:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431245932",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18971#discussion_r432114397"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18971"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432114397"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added it back.",
      "commit_id" : "f06619ecd41d08484e02e41fc06a840b9057fcb6",
      "created_at" : "2020-05-28T20:48:20Z",
      "diff_hunk" : "@@ -3680,17 +3680,7 @@ bool CWallet::Verify(interfaces::Chain& chain, const WalletLocation& location, b\n \n     // Keep same database environment instance across Verify/Recover calls below.\n     std::unique_ptr<WalletDatabase> database = WalletDatabase::Create(wallet_path);\n-\n-    try {\n-        if (!WalletBatch::VerifyEnvironment(wallet_path, error_string)) {\n-            return false;\n-        }\n-    } catch (const fs::filesystem_error& e) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18971#discussion_r432114397",
      "id" : 432114397,
      "in_reply_to_id" : 431230059,
      "line" : 3688,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjExNDM5Nw==",
      "original_commit_id" : "289aa21c6a6c11ce172a92f878a3ede6652fc2e4",
      "original_line" : 3688,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 35,
      "pull_request_review_id" : 420480068,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18971",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-28T20:48:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432114397",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
