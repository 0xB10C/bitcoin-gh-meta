[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Could you expand on which fuzzer hit that? is it fuzz/system.cpp?\r\n\r\nI Believe the problem is actually with the fuzzer, I think `ConsumeRandomLengthStringVector` can generate an empty string, which then `c_str()` returns NULL. \r\nbut the C++ standard[1] says that argv contain only valid non null pointers up to argc-1. \r\nSo I believe the fuzzer should actually be fixed, not the code here.\r\n\r\n[1] http://eel.is/c++draft/basic.start.main#2",
      "created_at" : "2020-05-07T19:13:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18908#issuecomment-625444947",
      "id" : 625444947,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18908",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNTQ0NDk0Nw==",
      "updated_at" : "2020-05-07T19:19:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/625444947",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Could you expand on which fuzzer hit that? is it fuzz/system.cpp?\r\n\r\nIt is the system.cpp fuzzer.\r\n\r\n```shell\r\nRun system with args ['/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/system', '-runs=1', '/home/travis/build/bitcoin/bitcoin/ci/scratch/qa-assets/fuzz_seed_corpus/system']INFO: Seed: 3656541697\r\nINFO: Loaded 1 modules   (407748 inline 8-bit counters): 407748 [0x563d4c439078, 0x563d4c49c93c), \r\nINFO: Loaded 1 PC tables (407748 PCs): 407748 [0x563d4c49c940,0x563d4cad5580), \r\nINFO:      942 files found in /home/travis/build/bitcoin/bitcoin/ci/scratch/qa-assets/fuzz_seed_corpus/system\r\nINFO: -max_len is not provided; libFuzzer will not generate inputs larger than 4096 bytes\r\nINFO: seed corpus: files: 942 min: 1b max: 4093b total: 407084b rss: 88Mb\r\n```",
      "created_at" : "2020-05-07T19:15:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18908#issuecomment-625445629",
      "id" : 625445629,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18908",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNTQ0NTYyOQ==",
      "updated_at" : "2020-05-07T19:15:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/625445629",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@elichai \r\n\r\nAnd now it throws no UB error anymore. Not sure if the fuzzer is the problem.\r\n\r\n```shell\r\nRun system with args ['/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/system', '-runs=1', '/home/travis/build/bitcoin/bitcoin/ci/scratch/qa-assets/fuzz_seed_corpus/system']INFO: Seed: 2965575158\r\nINFO: Loaded 1 modules   (406999 inline 8-bit counters): 406999 [0x55beda5d8e28, 0x55beda63c3ff), \r\nINFO: Loaded 1 PC tables (406999 PCs): 406999 [0x55beda63c400,0x55bedac72170), \r\nINFO:      942 files found in /home/travis/build/bitcoin/bitcoin/ci/scratch/qa-assets/fuzz_seed_corpus/system\r\nINFO: -max_len is not provided; libFuzzer will not generate inputs larger than 4096 bytes\r\nINFO: seed corpus: files: 942 min: 1b max: 4093b total: 407084b rss: 88Mb\r\n#512\tpulse  cov: 4127 ft: 16451 corp: 483/12995b exec/s: 256 rss: 112Mb\r\n#1009\tINITED cov: 4128 ft: 26595 corp: 905/382Kb exec/s: 100 rss: 161Mb\r\n#1009\tDONE   cov: 4128 ft: 26595 corp: 905/382Kb lim: 4093 exec/s: 100 rss: 161Mb\r\nDone 1009 runs in 10 second(s)\r\n```\r\n\r\nhttps://travis-ci.org/github/bitcoin/bitcoin/jobs/684399768\r\n\r\n--EDIT: also Undefined Behavior in C/C++ is actually a \"feature\", so compiler vendors can produce less complex compilers. But in any case, we should always test for nullptrs, regardless of current compiler implementation, fuzzer problems etc., imo.",
      "created_at" : "2020-05-07T19:16:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18908#issuecomment-625446458",
      "id" : 625446458,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18908",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNTQ0NjQ1OA==",
      "updated_at" : "2020-05-07T19:19:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/625446458",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   }
]
