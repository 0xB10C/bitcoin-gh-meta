[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Travis is stalling yet another time..",
      "created_at" : "2019-08-15T22:14:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16624#issuecomment-521816320",
      "id" : 521816320,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16624",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTgxNjMyMA==",
      "updated_at" : "2019-08-15T22:14:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521816320",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2019-08-15T23:17:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16624#issuecomment-521829833",
      "id" : 521829833,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16624",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTgyOTgzMw==",
      "updated_at" : "2019-08-15T23:17:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521829833",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16572](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16572.html) (wallet: Fix Char as Bool in Wallet by JeremyRubin)\n* [#15931](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15931.html) (Remove GetDepthInMainChain dependency on locked chain interface by ariard)\n* [#15129](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15129.html) (rpc: Added ability to remove watch only addresses by benthecarman)\n* [#9381](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/9381.html) (Remove CWalletTx merging logic from AddToWallet by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-08-16T00:26:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16624#issuecomment-521842286",
      "id" : 521842286,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16624",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTg0MjI4Ng==",
      "updated_at" : "2019-08-16T00:26:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521842286",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16624#discussion_r314647502"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16624"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314647502"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: why the trailing comma?",
      "commit_id" : "0e3212ae85c7cf1eb6a8d937ac67d6822f624175",
      "created_at" : "2019-08-16T09:28:10Z",
      "diff_hunk" : "@@ -396,7 +396,7 @@ class CWalletTx\n private:\n     const CWallet* pwallet;\n \n-  /** Constant used in hashBlock to indicate tx has been abandoned */\n+    /** Constant used in hashBlock to indicate tx has been abandoned, */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16624#discussion_r314647502",
      "id" : 314647502,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDY0NzUwMg==",
      "original_commit_id" : "7d2a5b39d6751743851957788d61c265eaaf4f36",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : 5,
      "pull_request_review_id" : 275855762,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16624",
      "updated_at" : "2019-08-16T10:43:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314647502",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16624#discussion_r314648430"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16624"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314648430"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why is the default initialization changed to 0?",
      "commit_id" : "0e3212ae85c7cf1eb6a8d937ac67d6822f624175",
      "created_at" : "2019-08-16T09:31:01Z",
      "diff_hunk" : "@@ -477,16 +475,46 @@ class CWalletTx\n         fInMempool = false;\n         nChangeCached = 0;\n         nOrderPos = -1;\n+        tx_state.hashBlock = uint256();\n+        tx_state.nIndex = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16624#discussion_r314648430",
      "id" : 314648430,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDY0ODQzMA==",
      "original_commit_id" : "7d2a5b39d6751743851957788d61c265eaaf4f36",
      "original_position" : 25,
      "path" : "src/wallet/wallet.h",
      "position" : 25,
      "pull_request_review_id" : 275855762,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16624",
      "updated_at" : "2019-08-16T10:43:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314648430",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16624#discussion_r314649394"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16624"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314649394"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can we move this backwards compatibility feature entirely to the serialization code, and then make `nIndex` a `uint` (for clarity)?",
      "commit_id" : "0e3212ae85c7cf1eb6a8d937ac67d6822f624175",
      "created_at" : "2019-08-16T09:34:00Z",
      "diff_hunk" : "@@ -477,16 +475,46 @@ class CWalletTx\n         fInMempool = false;\n         nChangeCached = 0;\n         nOrderPos = -1;\n+        tx_state.hashBlock = uint256();\n+        tx_state.nIndex = 0;\n+        setUnconfirmed();\n     }\n \n     CTransactionRef tx;\n-    uint256 hashBlock;\n-    /* An nIndex == -1 means that hashBlock (in nonzero) refers to the earliest\n-     * block in the chain we know this or any in-wallet dependency conflicts\n-     * with. Older clients interpret nIndex == -1 as unconfirmed for backward\n-     * compatibility.\n+\n+    /* New transactions start in the UNCONFIRMED. At BlockConnected,\n+     * they will transition to CONFIRMED. In case of reorg, at BlockDisconnected,\n+     * they rollback to UNCONFIRMED. If we detect a conflicting transaction at\n+     * block connection, we update conflited tx and its dependencies as CONFLICTED.\n+     * In tx isn't confirmed and outside of mempool, the user may switch it to ABANDONED\n+     * thanks to the abandontransaction call. This last state may be override by a CONFLICTED\n+     * or CONFIRMED transition.\n      */\n-    int nIndex;\n+    enum TxState {\n+        UNCONFIRMED,\n+        CONFIRMED,\n+        CONFLICTED,\n+        ABANDONED\n+    };\n+\n+    /* TxConfirmation includes tx state and a pair of block hash/block index at which tx has been confirmed.\n+     * This pair is both 0 if tx hasn't confirmed yet. Meaning of these fields changes with CONFLICTED state\n+     * where they instead point to block hash and index of the deepest conflicting tx.\n+     */\n+    struct TxConfirmation {\n+        uint256 hashBlock;\n+        /* At serialization/deserialization, an nIndex == -1 means that hashBlock refers to\n+         * the earliest block in the chain we know this or any in-wallet dependency conflicts\n+         * with, but if hashBlock is null it means transaction is abandoned. An nIndex >= 0\n+         * refers to a confirmed transaction (if hashBlock set) or unconfirmed one.\n+         * Older clients interpret nIndex == -1 as unconfirmed for backward\n+         * compatibility (pre-commit 9ac63d6).\n+         */\n+        int nIndex;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16624#discussion_r314649394",
      "id" : 314649394,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDY0OTM5NA==",
      "original_commit_id" : "7d2a5b39d6751743851957788d61c265eaaf4f36",
      "original_position" : 65,
      "path" : "src/wallet/wallet.h",
      "position" : 65,
      "pull_request_review_id" : 275855762,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16624",
      "updated_at" : "2019-08-16T10:56:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314649394",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16624#discussion_r314650144"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16624"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314650144"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Mention that `nIndex` is a block height?",
      "commit_id" : "0e3212ae85c7cf1eb6a8d937ac67d6822f624175",
      "created_at" : "2019-08-16T09:36:17Z",
      "diff_hunk" : "@@ -477,16 +475,46 @@ class CWalletTx\n         fInMempool = false;\n         nChangeCached = 0;\n         nOrderPos = -1;\n+        tx_state.hashBlock = uint256();\n+        tx_state.nIndex = 0;\n+        setUnconfirmed();\n     }\n \n     CTransactionRef tx;\n-    uint256 hashBlock;\n-    /* An nIndex == -1 means that hashBlock (in nonzero) refers to the earliest\n-     * block in the chain we know this or any in-wallet dependency conflicts\n-     * with. Older clients interpret nIndex == -1 as unconfirmed for backward\n-     * compatibility.\n+\n+    /* New transactions start in the UNCONFIRMED. At BlockConnected,\n+     * they will transition to CONFIRMED. In case of reorg, at BlockDisconnected,\n+     * they rollback to UNCONFIRMED. If we detect a conflicting transaction at\n+     * block connection, we update conflited tx and its dependencies as CONFLICTED.\n+     * In tx isn't confirmed and outside of mempool, the user may switch it to ABANDONED\n+     * thanks to the abandontransaction call. This last state may be override by a CONFLICTED\n+     * or CONFIRMED transition.\n      */\n-    int nIndex;\n+    enum TxState {\n+        UNCONFIRMED,\n+        CONFIRMED,\n+        CONFLICTED,\n+        ABANDONED\n+    };\n+\n+    /* TxConfirmation includes tx state and a pair of block hash/block index at which tx has been confirmed.\n+     * This pair is both 0 if tx hasn't confirmed yet. Meaning of these fields changes with CONFLICTED state\n+     * where they instead point to block hash and index of the deepest conflicting tx.\n+     */\n+    struct TxConfirmation {\n+        uint256 hashBlock;\n+        /* At serialization/deserialization, an nIndex == -1 means that hashBlock refers to\n+         * the earliest block in the chain we know this or any in-wallet dependency conflicts\n+         * with, but if hashBlock is null it means transaction is abandoned. An nIndex >= 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16624#discussion_r314650144",
      "id" : 314650144,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDY1MDE0NA==",
      "original_commit_id" : "7d2a5b39d6751743851957788d61c265eaaf4f36",
      "original_position" : 60,
      "path" : "src/wallet/wallet.h",
      "position" : 60,
      "pull_request_review_id" : 275855762,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16624",
      "updated_at" : "2019-08-16T10:43:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314650144",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. This overlaps (but is compatible) with #9381",
      "created_at" : "2019-08-16T10:39:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16624#issuecomment-521967025",
      "id" : 521967025,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16624",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTk2NzAyNQ==",
      "updated_at" : "2019-08-16T10:39:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521967025",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16624#discussion_r314683678"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16624"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314683678"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`isConfirmed()` does not seem to be tested as the others. Add a test? :-)",
      "commit_id" : "0e3212ae85c7cf1eb6a8d937ac67d6822f624175",
      "created_at" : "2019-08-16T11:34:29Z",
      "diff_hunk" : "@@ -607,10 +651,14 @@ class CWalletTx\n      * >0 : is a coinbase transaction which matures in this many blocks\n      */\n     int GetBlocksToMaturity(interfaces::Chain::Lock& locked_chain) const;\n-    bool hashUnset() const { return (hashBlock.IsNull() || hashBlock == ABANDON_HASH); }\n-    bool isAbandoned() const { return (hashBlock == ABANDON_HASH); }\n-    void setAbandoned() { hashBlock = ABANDON_HASH; }\n-\n+    bool isAbandoned() const { return tx_state.state == CWalletTx::ABANDONED; }\n+    void setAbandoned() { tx_state.state = CWalletTx::ABANDONED; }\n+    bool isConflicted() const { return tx_state.state == CWalletTx::CONFLICTED; }\n+    void setConflicted() { tx_state.state = CWalletTx::CONFLICTED; }\n+    bool isUnconfirmed() const { return tx_state.state == CWalletTx::UNCONFIRMED; }\n+    void setUnconfirmed() { tx_state.state = CWalletTx::UNCONFIRMED; }\n+    bool isConfirmed() const { return tx_state.state == CWalletTx::CONFIRMED; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16624#discussion_r314683678",
      "id" : 314683678,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDY4MzY3OA==",
      "original_commit_id" : "0e3212ae85c7cf1eb6a8d937ac67d6822f624175",
      "original_position" : 130,
      "path" : "src/wallet/wallet.h",
      "position" : 130,
      "pull_request_review_id" : 275902603,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16624",
      "updated_at" : "2019-08-16T11:34:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314683678",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16624#discussion_r314683814"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16624"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314683814"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should be \"conflicted\"? :-)",
      "commit_id" : "0e3212ae85c7cf1eb6a8d937ac67d6822f624175",
      "created_at" : "2019-08-16T11:34:49Z",
      "diff_hunk" : "@@ -477,16 +475,46 @@ class CWalletTx\n         fInMempool = false;\n         nChangeCached = 0;\n         nOrderPos = -1;\n+        tx_state.hashBlock = uint256();\n+        tx_state.nIndex = 0;\n+        setUnconfirmed();\n     }\n \n     CTransactionRef tx;\n-    uint256 hashBlock;\n-    /* An nIndex == -1 means that hashBlock (in nonzero) refers to the earliest\n-     * block in the chain we know this or any in-wallet dependency conflicts\n-     * with. Older clients interpret nIndex == -1 as unconfirmed for backward\n-     * compatibility.\n+\n+    /* New transactions start in the UNCONFIRMED. At BlockConnected,\n+     * they will transition to CONFIRMED. In case of reorg, at BlockDisconnected,\n+     * they rollback to UNCONFIRMED. If we detect a conflicting transaction at\n+     * block connection, we update conflited tx and its dependencies as CONFLICTED.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16624#discussion_r314683814",
      "id" : 314683814,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDY4MzgxNA==",
      "original_commit_id" : "0e3212ae85c7cf1eb6a8d937ac67d6822f624175",
      "original_position" : 39,
      "path" : "src/wallet/wallet.h",
      "position" : 39,
      "pull_request_review_id" : 275902757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16624",
      "updated_at" : "2019-08-16T11:34:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314683814",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
