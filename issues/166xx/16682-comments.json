[
   {
      "author_association" : "MEMBER",
      "body" : "Observed while testing #15759 and suggested by @ajtowns : https://github.com/bitcoin/bitcoin/pull/15759#issuecomment-523733587",
      "created_at" : "2019-08-22T15:36:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16682#issuecomment-523958559",
      "id" : 523958559,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16682",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMzk1ODU1OQ==",
      "updated_at" : "2019-08-22T15:36:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523958559",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "tACK 0e7bc2fba706a8b2483e030eff137c20a61f7eb4",
      "created_at" : "2019-08-22T15:45:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16682#issuecomment-523962338",
      "id" : 523962338,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16682",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMzk2MjMzOA==",
      "updated_at" : "2019-08-22T15:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523962338",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Can you check for the `PF_NOBAN` permissions so you don't ban whitelisted peer?",
      "created_at" : "2019-08-22T16:04:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16682#issuecomment-523969971",
      "id" : 523969971,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16682",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMzk2OTk3MQ==",
      "updated_at" : "2019-08-22T16:04:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523969971",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Can you check for the `PF_NOBAN` permissions so you don't ban whitelisted peer?\r\n\r\n`Misbehaving` sets `fShouldBan`, which is checked in `PeerLogicValidation::SendRejectsAndCheckIfBanned`, and `PF_NOBAN` is checked before applying the ban.",
      "created_at" : "2019-08-22T16:07:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16682#issuecomment-523970959",
      "id" : 523970959,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16682",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMzk3MDk1OQ==",
      "updated_at" : "2019-08-22T16:10:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523970959",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Why would spy nodes claim to be blocksonly? To not get asked for txs?",
      "created_at" : "2019-08-22T16:23:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16682#issuecomment-523977294",
      "id" : 523977294,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16682",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMzk3NzI5NA==",
      "updated_at" : "2019-08-22T16:23:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523977294",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Why would spy nodes claim to be blocksonly? To not get asked for txs?\r\n\r\nSorry, my explanation was unclear. Let me try again:\r\n\r\n1. I start my node in `-blocksonly`\r\n2. I make up to 8 outbound connections, with [fRelay](https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki#Extensions_to_existing_messages) set to False.\r\n3. Most peers (including most Satoshi:0.18.0 peers) honor that relay=False request and don't send me tx INVs. However, some of my outbound connections *do* send me tx INVs in violation of my request to not relay transactions. Those peers also have subver set to Satoshi:0.18.0. Even if I disconnect and reconnect to those peers, they continue to send me tx INVs.\r\n\r\nExplanations:\r\n- there's a bug in Bitcoin Core v0.18 that under some circumstances makes them disregard fRelay=False. I've looked at the VERSION deserialization and net_processing logic and find this unlikely.\r\n- they aren't really Bitcoin Core 0.18 nodes and are just masquerading as such. They haven't implemented the relay logic properly.\r\n\r\nThe peers that I found that do this are on the spylist here: https://people.xiph.org/~greg/banlist.cli.txt",
      "created_at" : "2019-08-22T16:32:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16682#issuecomment-523980420",
      "id" : 523980420,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16682",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMzk4MDQyMA==",
      "updated_at" : "2019-08-22T16:32:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523980420",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think the nomenclature is a bit messed up. The pull request title should probably read \"non-tx-relay\" instead of \"blocks-only\"?\r\n\r\nOr \"Disconnect peer that send us tx INVs when we opted out of tx relay\"",
      "created_at" : "2019-08-22T16:33:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16682#issuecomment-523980818",
      "id" : 523980818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16682",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMzk4MDgxOA==",
      "updated_at" : "2019-08-22T16:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523980818",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I have negative feelings about this as it violates the robustness principle. If at some point in the future there is a bug which causes us to relay an occasional tx, it ends up disconnecting blocks only peers.",
      "created_at" : "2019-08-22T17:10:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16682#issuecomment-523994184",
      "id" : 523994184,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16682",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMzk5NDE4NA==",
      "updated_at" : "2019-08-22T17:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523994184",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> If at some point in the future there is a bug which causes us to relay an occasional tx\r\n\r\nThe main reason to run `-blocksonly` is to reduce bandwidth usage. If adversaries can waste our bandwidth by sending us (what is to us) garbage, then we should disconnect them.\r\n\r\nI think your argument could be made against any disconnect behaviour: if at some point in the future there's a bug that makes us send a bad message to a peer, then we might get disconnected.",
      "created_at" : "2019-08-22T17:40:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16682#issuecomment-524005629",
      "id" : 524005629,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16682",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNDAwNTYyOQ==",
      "updated_at" : "2019-08-22T17:40:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/524005629",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't agree. The recent blocksonly changes as presented in https://github.com/bitcoin/bitcoin/pull/15759#issuecomment-523733587 is as a topology privacy benefit. Modifying this logic doesn't just affect nodes running with blocksonly with that change in mind, it affects all nodes. (I'm not sure if you intend this PR to be standalone from that one or not)\r\n\r\nI think the right thing to do would be, for example, to downgrade the connection to a non-blocksonly connection rather than disconnect and try finding a new blocksonly peer.\r\n\r\n\r\nDisagreement nonwithstanding, IIRC there is software which will send unsolicited TX messages as well, so you may want to look into handling peers who send those as well.",
      "created_at" : "2019-08-22T18:08:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16682#issuecomment-524015909",
      "id" : 524015909,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16682",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNDAxNTkwOQ==",
      "updated_at" : "2019-08-22T18:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/524015909",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Modifying this logic doesn't just affect nodes running with blocksonly with that change in mind, it affects all nodes. (I'm not sure if you intend this PR to be standalone from that one or not)\r\n\r\nCorrect, but it only affects the two outbound blocks-only peers in that PR. The new behaviour would be to disconnect those blocks-only peers that are misbehaving and make new blocks-only peers. Given that the part of the justification for that PR was that the additional blocks-only peers would not cause too much additional resource usage, I think it's reasonable to disconnect them if they're wasting our bandwidth\r\n\r\n> I think the right thing to do would be, for example, to downgrade the connection to a non-blocksonly connection rather than disconnect and try finding a new blocksonly peer.\r\n\r\nI disagree:\r\n- for a full `blocksonly` node, there are no non-blocksonly peers. Are you saying we should disregard the user's wishes and keep these connections as tx relay peers?\r\n- for 15759, the tx relay datastructures aren't initialized for blocks-only peers (to save memory). If we changed those blocks-only peers to be tx relay peers, we'd need to add those tx relay datastructures later. That makes the code more complex, and invalidates the resource-usage argument in that PR (since we might just end up with 10 full tx relay peers).\r\n\r\n> Disagreement nonwithstanding, IIRC there is software which will send unsolicited TX messages as well, so you may want to look into handling peers who send those as well.\r\n\r\nThanks! I've updated this PR to also ban peers which relay TX messages to us when we've set relay=False.",
      "created_at" : "2019-08-22T18:59:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16682#issuecomment-524033842",
      "id" : 524033842,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16682",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNDAzMzg0Mg==",
      "updated_at" : "2019-08-22T18:59:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/524033842",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
