[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Is this safe to do? What are the implications of connecting to a peer that would otherwise be banned?",
      "created_at" : "2019-08-15T10:34:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#issuecomment-521596921",
      "id" : 521596921,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16618",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTU5NjkyMQ==",
      "updated_at" : "2019-08-15T10:34:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521596921",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/42591821?v=4",
         "events_url" : "https://api.github.com/users/gapeman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gapeman/followers",
         "following_url" : "https://api.github.com/users/gapeman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gapeman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gapeman",
         "id" : 42591821,
         "login" : "gapeman",
         "node_id" : "MDQ6VXNlcjQyNTkxODIx",
         "organizations_url" : "https://api.github.com/users/gapeman/orgs",
         "received_events_url" : "https://api.github.com/users/gapeman/received_events",
         "repos_url" : "https://api.github.com/users/gapeman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gapeman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gapeman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gapeman"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@gapeman afaik that was the behavior before #16248 (which was not supposed to change existing behavior).\r\n\r\n@NicolasDorier would be nice to have a test for this.",
      "created_at" : "2019-08-15T10:52:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#issuecomment-521601527",
      "id" : 521601527,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16618",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTYwMTUyNw==",
      "updated_at" : "2019-08-15T10:53:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521601527",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@gapeman if your config specifically say that you don't want to ban a peer, then it should not be banned.\r\n\r\nAs @Sjors says, I just want to keep current behavior working as before.\r\n\r\nI can take a look to see if I can make a test for that.",
      "created_at" : "2019-08-15T13:12:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#issuecomment-521635542",
      "id" : 521635542,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16618",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTYzNTU0Mg==",
      "updated_at" : "2019-08-15T13:12:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521635542",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I refactored it to properly scope some variables. Writing a test so such regression can't happen.",
      "created_at" : "2019-08-15T13:28:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#issuecomment-521640563",
      "id" : 521640563,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16618",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTY0MDU2Mw==",
      "updated_at" : "2019-08-15T13:28:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521640563",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fixed the bug, and added an anti regression test for `setban`",
      "created_at" : "2019-08-15T14:02:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#issuecomment-521652289",
      "id" : 521652289,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16618",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTY1MjI4OQ==",
      "updated_at" : "2019-08-15T14:02:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521652289",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK a0d2e2b",
      "created_at" : "2019-08-15T14:08:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#issuecomment-521654132",
      "id" : 521654132,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16618",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTY1NDEzMg==",
      "updated_at" : "2019-08-15T14:08:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521654132",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314326784"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314326784"
         }
      },
      "author_association" : "MEMBER",
      "body" : "test/functional/rpc_setban.py:7:1: F401 'test_framework.test_node.ErrorMatch' imported but unused\r\n\r\ntest/functional/rpc_setban.py:39:78: F821 undefined name 'p'\r\n\r\ntest/functional/rpc_setban.py:41:75: F821 undefined name 'p'",
      "commit_id" : "b3e2a6e73eb2dab50e4bf9a1af966f03a4a14dad",
      "created_at" : "2019-08-15T14:14:26Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the setban rpc call.\"\"\"\n+\n+from test_framework.test_node import ErrorMatch",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314326784",
      "id" : 314326784,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDMyNjc4NA==",
      "original_commit_id" : "a0d2e2b1bd5d44f18eb3865e657c67efd0111a3f",
      "original_position" : 7,
      "path" : "test/functional/rpc_setban.py",
      "position" : null,
      "pull_request_review_id" : 275452633,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618",
      "updated_at" : "2019-08-15T15:16:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314326784",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314330783"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314330783"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe pass node in directly and split into `assert_has_permission(self, node, permission)` and `assert_has_no_permission(self, node, permission)` ",
      "commit_id" : "b3e2a6e73eb2dab50e4bf9a1af966f03a4a14dad",
      "created_at" : "2019-08-15T14:23:19Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the setban rpc call.\"\"\"\n+\n+from test_framework.test_node import ErrorMatch\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes\n+)\n+\n+class SetBanTests(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+        self.setup_clean_chain = True\n+        self.extra_args = [[],[]]\n+\n+    def run_test(self):\n+        # Node 0 connects to Node 1\n+        self.assert_has_permission('noban', False)\n+        # Node 0 get banned by Node 1\n+        self.nodes[1].setban(\"127.0.0.1\", \"add\")\n+        # Node 1 should not be able to reconnect\n+        self.restart_node(1, [])\n+        connect_nodes(self.nodes[0], 1)\n+        peerinfo = self.nodes[1].getpeerinfo()\n+        assert_equal(0, len(peerinfo))\n+        # Node 1 should be able to reconnect if it has noban permission\n+        self.restart_node(1, ['-whitelist=127.0.0.1'])\n+        connect_nodes(self.nodes[0], 1)\n+        self.assert_has_permission('noban', True)\n+\n+    def assert_has_permission(self, permission, contains):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314330783",
      "id" : 314330783,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDMzMDc4Mw==",
      "original_commit_id" : "a0d2e2b1bd5d44f18eb3865e657c67efd0111a3f",
      "original_position" : 35,
      "path" : "test/functional/rpc_setban.py",
      "position" : 34,
      "pull_request_review_id" : 275457822,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618",
      "updated_at" : "2019-08-15T15:16:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314330783",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314359274"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314359274"
         }
      },
      "author_association" : "MEMBER",
      "body" : "what about `assert_equal(True, self.hasPermision(...))` ?\r\n\r\nThat said, I don't think it should pass the nodes to this method. It is confusing (there is two nodes: the node that is permissioned, and the node on which we want to check permissions).",
      "commit_id" : "b3e2a6e73eb2dab50e4bf9a1af966f03a4a14dad",
      "created_at" : "2019-08-15T15:18:07Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the setban rpc call.\"\"\"\n+\n+from test_framework.test_node import ErrorMatch\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes\n+)\n+\n+class SetBanTests(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+        self.setup_clean_chain = True\n+        self.extra_args = [[],[]]\n+\n+    def run_test(self):\n+        # Node 0 connects to Node 1\n+        self.assert_has_permission('noban', False)\n+        # Node 0 get banned by Node 1\n+        self.nodes[1].setban(\"127.0.0.1\", \"add\")\n+        # Node 1 should not be able to reconnect\n+        self.restart_node(1, [])\n+        connect_nodes(self.nodes[0], 1)\n+        peerinfo = self.nodes[1].getpeerinfo()\n+        assert_equal(0, len(peerinfo))\n+        # Node 1 should be able to reconnect if it has noban permission\n+        self.restart_node(1, ['-whitelist=127.0.0.1'])\n+        connect_nodes(self.nodes[0], 1)\n+        self.assert_has_permission('noban', True)\n+\n+    def assert_has_permission(self, permission, contains):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314359274",
      "id" : 314359274,
      "in_reply_to_id" : 314330783,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDM1OTI3NA==",
      "original_commit_id" : "a0d2e2b1bd5d44f18eb3865e657c67efd0111a3f",
      "original_position" : 35,
      "path" : "test/functional/rpc_setban.py",
      "position" : 34,
      "pull_request_review_id" : 275493435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618",
      "updated_at" : "2019-08-15T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314359274",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314388627"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314388627"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`assert(self.hasPermision(...))` is even simpler.\r\n\r\nYou could pass both nodes. Or you could document at the top of the test file which hardcoded nodes do what.",
      "commit_id" : "b3e2a6e73eb2dab50e4bf9a1af966f03a4a14dad",
      "created_at" : "2019-08-15T16:19:54Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the setban rpc call.\"\"\"\n+\n+from test_framework.test_node import ErrorMatch\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes\n+)\n+\n+class SetBanTests(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+        self.setup_clean_chain = True\n+        self.extra_args = [[],[]]\n+\n+    def run_test(self):\n+        # Node 0 connects to Node 1\n+        self.assert_has_permission('noban', False)\n+        # Node 0 get banned by Node 1\n+        self.nodes[1].setban(\"127.0.0.1\", \"add\")\n+        # Node 1 should not be able to reconnect\n+        self.restart_node(1, [])\n+        connect_nodes(self.nodes[0], 1)\n+        peerinfo = self.nodes[1].getpeerinfo()\n+        assert_equal(0, len(peerinfo))\n+        # Node 1 should be able to reconnect if it has noban permission\n+        self.restart_node(1, ['-whitelist=127.0.0.1'])\n+        connect_nodes(self.nodes[0], 1)\n+        self.assert_has_permission('noban', True)\n+\n+    def assert_has_permission(self, permission, contains):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314388627",
      "id" : 314388627,
      "in_reply_to_id" : 314330783,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDM4ODYyNw==",
      "original_commit_id" : "a0d2e2b1bd5d44f18eb3865e657c67efd0111a3f",
      "original_position" : 35,
      "path" : "test/functional/rpc_setban.py",
      "position" : 34,
      "pull_request_review_id" : 275529668,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618",
      "updated_at" : "2019-08-15T16:19:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314388627",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314543190"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314543190"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sorry but I think you could just inline this - it's longer as it is with the `contains` arg.",
      "commit_id" : "b3e2a6e73eb2dab50e4bf9a1af966f03a4a14dad",
      "created_at" : "2019-08-16T00:02:39Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the setban rpc call.\"\"\"\n+\n+from test_framework.test_node import ErrorMatch\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes\n+)\n+\n+class SetBanTests(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+        self.setup_clean_chain = True\n+        self.extra_args = [[],[]]\n+\n+    def run_test(self):\n+        # Node 0 connects to Node 1\n+        self.assert_has_permission('noban', False)\n+        # Node 0 get banned by Node 1\n+        self.nodes[1].setban(\"127.0.0.1\", \"add\")\n+        # Node 1 should not be able to reconnect\n+        self.restart_node(1, [])\n+        connect_nodes(self.nodes[0], 1)\n+        peerinfo = self.nodes[1].getpeerinfo()\n+        assert_equal(0, len(peerinfo))\n+        # Node 1 should be able to reconnect if it has noban permission\n+        self.restart_node(1, ['-whitelist=127.0.0.1'])\n+        connect_nodes(self.nodes[0], 1)\n+        self.assert_has_permission('noban', True)\n+\n+    def assert_has_permission(self, permission, contains):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16618#discussion_r314543190",
      "id" : 314543190,
      "in_reply_to_id" : 314330783,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDU0MzE5MA==",
      "original_commit_id" : "a0d2e2b1bd5d44f18eb3865e657c67efd0111a3f",
      "original_position" : 35,
      "path" : "test/functional/rpc_setban.py",
      "position" : 34,
      "pull_request_review_id" : 275725446,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16618",
      "updated_at" : "2019-08-16T00:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314543190",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
