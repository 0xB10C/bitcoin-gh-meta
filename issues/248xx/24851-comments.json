[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24851#discussion_r850047077"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24851"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850047077"
         }
      },
      "author_association" : "NONE",
      "body" : "I'm still pretty new to Bitcoin terminology, so if there is a more precise way to describe the issue in this comment, I welcome the feedback.",
      "commit_id" : "511eb7fdeac36da9d6576c878a1c8d390b38f1bd",
      "created_at" : "2022-04-14T03:06:43Z",
      "diff_hunk" : "@@ -1837,6 +1837,15 @@ DisconnectResult CChainState::DisconnectBlock(const CBlock& block, const CBlockI\n         return DISCONNECT_FAILED;\n     }\n \n+    // Ignore blocks that contain transactions which are 'overwritten' by later transactions,\n+    // unless those are already completely spent.\n+    // See https://github.com/bitcoin/bitcoin/issues/22596 for additional information.\n+    // Note: the blocks specified here are different than the ones used in ConnectBlock because DisconnectBlock\n+    // unwinds the blocks in reverse. As a result, the inconsistency is not discovered until the earlier\n+    // blocks with the duplicate coinbase transactions are disconnected.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24851#discussion_r850047077",
      "id" : 850047077,
      "line" : 1845,
      "node_id" : "PRRC_kwDOABII584yqrBl",
      "original_commit_id" : "511eb7fdeac36da9d6576c878a1c8d390b38f1bd",
      "original_line" : 1845,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 9,
      "pull_request_review_id" : 941744419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24851",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850047077/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-14T03:24:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850047077",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/553936?v=4",
         "events_url" : "https://api.github.com/users/seejee/events{/privacy}",
         "followers_url" : "https://api.github.com/users/seejee/followers",
         "following_url" : "https://api.github.com/users/seejee/following{/other_user}",
         "gists_url" : "https://api.github.com/users/seejee/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/seejee",
         "id" : 553936,
         "login" : "seejee",
         "node_id" : "MDQ6VXNlcjU1MzkzNg==",
         "organizations_url" : "https://api.github.com/users/seejee/orgs",
         "received_events_url" : "https://api.github.com/users/seejee/received_events",
         "repos_url" : "https://api.github.com/users/seejee/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/seejee/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/seejee/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/seejee"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24851#discussion_r850048710"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24851"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850048710"
         }
      },
      "author_association" : "NONE",
      "body" : "At first I tried to mimic the behavior in [ConnectBlock](https://github.com/bitcoin/bitcoin/blob/b620b2d58a55a88ad21da70cb2000863ef17b651/src/validation.cpp#L1825-L1834) and the put the `fEnforceBIP30` guard around the entire loop that begins on line 1850, but that would still result in the verification failing later in the process. Moving the guard here allowed the verification process to complete successfully.\r\n\r\nI'm assuming that we need to call `SpendCoin` in both cases because we still need to update the view's state even if we ignore the `is_spent` result.",
      "commit_id" : "511eb7fdeac36da9d6576c878a1c8d390b38f1bd",
      "created_at" : "2022-04-14T03:11:07Z",
      "diff_hunk" : "@@ -1850,7 +1859,7 @@ DisconnectResult CChainState::DisconnectBlock(const CBlock& block, const CBlockI\n                 COutPoint out(hash, o);\n                 Coin coin;\n                 bool is_spent = view.SpendCoin(out, &coin);\n-                if (!is_spent || tx.vout[o] != coin.out || pindex->nHeight != coin.nHeight || is_coinbase != coin.fCoinBase) {\n+                if (fEnforceBIP30 && (!is_spent || tx.vout[o] != coin.out || pindex->nHeight != coin.nHeight || is_coinbase != coin.fCoinBase)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24851#discussion_r850048710",
      "id" : 850048710,
      "line" : 1862,
      "node_id" : "PRRC_kwDOABII584yqrbG",
      "original_commit_id" : "511eb7fdeac36da9d6576c878a1c8d390b38f1bd",
      "original_line" : 1862,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 21,
      "pull_request_review_id" : 941746200,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24851",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850048710/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-14T03:11:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850048710",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/553936?v=4",
         "events_url" : "https://api.github.com/users/seejee/events{/privacy}",
         "followers_url" : "https://api.github.com/users/seejee/followers",
         "following_url" : "https://api.github.com/users/seejee/following{/other_user}",
         "gists_url" : "https://api.github.com/users/seejee/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/seejee",
         "id" : 553936,
         "login" : "seejee",
         "node_id" : "MDQ6VXNlcjU1MzkzNg==",
         "organizations_url" : "https://api.github.com/users/seejee/orgs",
         "received_events_url" : "https://api.github.com/users/seejee/received_events",
         "repos_url" : "https://api.github.com/users/seejee/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/seejee/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/seejee/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/seejee"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@jamesob Thanks for the review and good idea to ensure that we're only allowing exceptions for coinbase transactions. I've included your suggested patch in the latest commit and retested to ensure things are working as expected. ð \r\n\r\nThanks again!",
      "created_at" : "2022-04-14T15:52:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24851#issuecomment-1099326605",
      "id" : 1099326605,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24851",
      "node_id" : "IC_kwDOABII585BhmSN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1099326605/reactions"
      },
      "updated_at" : "2022-04-14T15:52:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1099326605",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/553936?v=4",
         "events_url" : "https://api.github.com/users/seejee/events{/privacy}",
         "followers_url" : "https://api.github.com/users/seejee/followers",
         "following_url" : "https://api.github.com/users/seejee/following{/other_user}",
         "gists_url" : "https://api.github.com/users/seejee/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/seejee",
         "id" : 553936,
         "login" : "seejee",
         "node_id" : "MDQ6VXNlcjU1MzkzNg==",
         "organizations_url" : "https://api.github.com/users/seejee/orgs",
         "received_events_url" : "https://api.github.com/users/seejee/received_events",
         "repos_url" : "https://api.github.com/users/seejee/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/seejee/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/seejee/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/seejee"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@seejee great. FWIW, looks like there's a typo in your commit message (\"trxs\"); you can fix with `git commit --amend`. You can also add co-author credits by appending\r\n```\r\nCo-authored-by: James O'Beirne <james.obeirne@pm.me>\r\n```\r\nif you'd like.",
      "created_at" : "2022-04-14T16:02:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24851#issuecomment-1099340226",
      "id" : 1099340226,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24851",
      "node_id" : "IC_kwDOABII585BhpnC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1099340226/reactions"
      },
      "updated_at" : "2022-04-14T16:02:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1099340226",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@jamesob Fixed the typo, and I included your co-author credits. Sorry for not doing that in the first place! ð ",
      "created_at" : "2022-04-14T16:05:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24851#issuecomment-1099344934",
      "id" : 1099344934,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24851",
      "node_id" : "IC_kwDOABII585Bhqwm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1099344934/reactions"
      },
      "updated_at" : "2022-04-14T16:06:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1099344934",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/553936?v=4",
         "events_url" : "https://api.github.com/users/seejee/events{/privacy}",
         "followers_url" : "https://api.github.com/users/seejee/followers",
         "following_url" : "https://api.github.com/users/seejee/following{/other_user}",
         "gists_url" : "https://api.github.com/users/seejee/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/seejee",
         "id" : 553936,
         "login" : "seejee",
         "node_id" : "MDQ6VXNlcjU1MzkzNg==",
         "organizations_url" : "https://api.github.com/users/seejee/orgs",
         "received_events_url" : "https://api.github.com/users/seejee/received_events",
         "repos_url" : "https://api.github.com/users/seejee/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/seejee/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/seejee/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/seejee"
      }
   }
]
