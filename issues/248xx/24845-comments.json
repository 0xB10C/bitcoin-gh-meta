[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24811](https://github.com/bitcoin/bitcoin/pull/24811) (refactor: Prepare for moving ArgsManager out of util/system by Empact)\n* [#24752](https://github.com/bitcoin/bitcoin/pull/24752) (wallet: increase BnB upper limit by S3RK)\n* [#24699](https://github.com/bitcoin/bitcoin/pull/24699) (wallet: Improve AvailableCoins performance by reducing duplicated operations by achow101)\n* [#24649](https://github.com/bitcoin/bitcoin/pull/24649) (wallet: do not count wallet utxos as external by S3RK)\n* [#24644](https://github.com/bitcoin/bitcoin/pull/24644) (wallet: add tracepoints and algorithm information to coin selection by achow101)\n* [#24455](https://github.com/bitcoin/bitcoin/pull/24455) (refactor: Split ArgsManager out of util/system by Empact)\n* [#23829](https://github.com/bitcoin/bitcoin/pull/23829) (refactor: use braced init for integer literals instead of c style casts by PastaPastaPasta)\n* [#20640](https://github.com/bitcoin/bitcoin/pull/20640) (wallet, refactor: return out-params of CreateTransaction() as optional struct by theStack)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-04-14T11:32:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#issuecomment-1099093626",
      "id" : 1099093626,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24845",
      "node_id" : "IC_kwDOABII585BgtZ6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1099093626/reactions"
      },
      "updated_at" : "2022-04-14T11:32:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1099093626",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850797804"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850797804"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 7c9839d3a8aa3bbd0fc9ae46a726022cdb661fc8 \"introduce OperationResult and CallResult classes\"\r\n\r\nnit: missing newline",
      "commit_id" : "ba6dc81466e5dbb867bc054695a3c62db32ff449",
      "created_at" : "2022-04-14T20:55:31Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_OPERATIONRESULT_H\n+#define BITCOIN_OPERATIONRESULT_H\n+\n+#include <util/translation.h>\n+\n+class OperationResult\n+{\n+private:\n+    bool m_res{false};\n+    std::optional<bilingual_str> m_error{std::nullopt};\n+\n+public:\n+    OperationResult(bool _res, const bilingual_str& _error) : m_res(_res), m_error(_error) { }\n+    OperationResult(bool _res) : m_res(_res) { }\n+\n+    bilingual_str getError() const { return (m_error ? *m_error : bilingual_str()); }\n+    bool getRes() const { return m_res; }\n+    explicit operator bool() const { return m_res; }\n+};\n+\n+inline OperationResult errorOut(const bilingual_str& errorStr)\n+{\n+    return OperationResult(false, errorStr);\n+}\n+\n+\n+template <class T>\n+class CallResult : public OperationResult\n+{\n+private:\n+    std::optional<T> m_obj_res{std::nullopt};\n+public:\n+    CallResult() : OperationResult(false) {}\n+    CallResult(T _obj) : OperationResult(true), m_obj_res(_obj) { }\n+    CallResult(const bilingual_str& error) : OperationResult(false, error) { }\n+    const std::optional<T>& getObjResult() const { return m_obj_res; }\n+};\n+\n+\n+#endif // BITCOIN_OPERATIONRESULT_H",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850797804",
      "id" : 850797804,
      "line" : 44,
      "node_id" : "PRRC_kwDOABII584ytiTs",
      "original_commit_id" : "7c9839d3a8aa3bbd0fc9ae46a726022cdb661fc8",
      "original_line" : 44,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/operationresult.h",
      "position" : 44,
      "pull_request_review_id" : 942788501,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850797804/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-14T21:24:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850797804",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850799951"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850799951"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 7c9839d3a8aa3bbd0fc9ae46a726022cdb661fc8 \"introduce OperationResult and CallResult classes\"\r\n\r\nnit: We prefer to use UpperCamelCase for function names. (here and elsewhere)",
      "commit_id" : "ba6dc81466e5dbb867bc054695a3c62db32ff449",
      "created_at" : "2022-04-14T20:58:53Z",
      "diff_hunk" : "@@ -0,0 +1,44 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_OPERATIONRESULT_H\n+#define BITCOIN_OPERATIONRESULT_H\n+\n+#include <util/translation.h>\n+\n+class OperationResult\n+{\n+private:\n+    bool m_res{false};\n+    std::optional<bilingual_str> m_error{std::nullopt};\n+\n+public:\n+    OperationResult(bool _res, const bilingual_str& _error) : m_res(_res), m_error(_error) { }\n+    OperationResult(bool _res) : m_res(_res) { }\n+\n+    bilingual_str getError() const { return (m_error ? *m_error : bilingual_str()); }\n+    bool getRes() const { return m_res; }\n+    explicit operator bool() const { return m_res; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850799951",
      "id" : 850799951,
      "line" : 22,
      "node_id" : "PRRC_kwDOABII584yti1P",
      "original_commit_id" : "7c9839d3a8aa3bbd0fc9ae46a726022cdb661fc8",
      "original_line" : 22,
      "original_position" : 22,
      "original_start_line" : 20,
      "path" : "src/operationresult.h",
      "position" : 22,
      "pull_request_review_id" : 942788501,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850799951/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 20,
      "start_side" : "RIGHT",
      "updated_at" : "2022-04-14T21:24:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850799951",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850803298"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850803298"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In c2ec6661cbb70a388dc67d6b4b47f2ab49b99418 \"wallet: make SelectCoins return a CallResult.\"\r\n\r\nnit: We prefer snake_case for new variables. (here and elsewhere)",
      "commit_id" : "ba6dc81466e5dbb867bc054695a3c62db32ff449",
      "created_at" : "2022-04-14T21:04:23Z",
      "diff_hunk" : "@@ -566,15 +566,18 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, const std::vec\n             }\n         }\n         // Coin Selection failed.\n-        return std::optional<SelectionResult>();\n+        return CallResult<SelectionResult>();\n     }();\n \n-    if (!res) return std::nullopt;\n+    if (!res) {\n+        return res;\n+    }\n \n     // Add preset inputs to result\n-    res->AddInput(preset_inputs);\n+    auto resMerged = *res.getObjResult();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850803298",
      "id" : 850803298,
      "line" : 606,
      "node_id" : "PRRC_kwDOABII584ytjpi",
      "original_commit_id" : "c2ec6661cbb70a388dc67d6b4b47f2ab49b99418",
      "original_line" : 577,
      "original_position" : 95,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 95,
      "pull_request_review_id" : 942788501,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850803298/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-14T21:24:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850803298",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850813353"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850813353"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In c8a43eca7c4081f8ca87be1befbbcdbfdc798a10 \"send: return proper error message for too-long-mempool-chain failure.\"\r\n\r\nI'm not a huge fan of doing all of the coin selection computation just to immediately throw away the result. It seems like there should be a better way to do this, e.g. by changing how we fill `vCoins` to be guaranteed to have a solution at this point iff long chain utxos are included.",
      "commit_id" : "ba6dc81466e5dbb867bc054695a3c62db32ff449",
      "created_at" : "2022-04-14T21:21:52Z",
      "diff_hunk" : "@@ -557,12 +557,15 @@ CallResult<SelectionResult> SelectCoins(const CWallet& wallet, const std::vector\n             // Try with unlimited ancestors/descendants. The transaction will still need to meet\n             // mempool ancestor/descendant policy to be accepted to mempool and broadcasted, but\n             // OutputGroups use heuristics that may overestimate ancestor/descendant counts.\n-            if (!fRejectLongChains) {\n-                if (auto r8{AttemptSelection(wallet, value_to_select,\n-                                      CoinEligibilityFilter(0, 1, std::numeric_limits<uint64_t>::max(), std::numeric_limits<uint64_t>::max(), true /* include_partial_groups */),\n-                                      vCoins, coin_selection_params)}) {\n-                    return r8;\n+            if (auto r8{AttemptSelection(wallet, value_to_select,\n+                                         CoinEligibilityFilter(0, 1, std::numeric_limits<uint64_t>::max(), std::numeric_limits<uint64_t>::max(), true /* include_partial_groups */),\n+                                         vCoins, coin_selection_params)}) {\n+                if (fRejectLongChains) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850813353",
      "id" : 850813353,
      "line" : 589,
      "node_id" : "PRRC_kwDOABII584ytmGp",
      "original_commit_id" : "c8a43eca7c4081f8ca87be1befbbcdbfdc798a10",
      "original_line" : 563,
      "original_position" : 12,
      "original_start_line" : 560,
      "path" : "src/wallet/spend.cpp",
      "position" : 12,
      "pull_request_review_id" : 942788501,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850813353/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-04-14T21:24:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850813353",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850814403"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850814403"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 30feca7b374256ff62443b2e2f1c65dfa49bb083 \"send: move wallet CreateTransaction* flow to use OperationResult/CallResult.\"\r\n\r\nI don't think this needs to be an `OperationResult`. It really can be `CallResult<CTransactionRef>`. The original really should have just returned `CTransactionRef` anyways.",
      "commit_id" : "ba6dc81466e5dbb867bc054695a3c62db32ff449",
      "created_at" : "2022-04-14T21:23:51Z",
      "diff_hunk" : "@@ -651,13 +651,12 @@ static void DiscourageFeeSniping(CMutableTransaction& tx, FastRandomContext& rng\n     }\n }\n \n-static bool CreateTransactionInternal(\n+static OperationResult CreateTransactionInternal(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24845#discussion_r850814403",
      "id" : 850814403,
      "line" : 686,
      "node_id" : "PRRC_kwDOABII584ytmXD",
      "original_commit_id" : "30feca7b374256ff62443b2e2f1c65dfa49bb083",
      "original_line" : 654,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 5,
      "pull_request_review_id" : 942788501,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24845",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850814403/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-14T21:24:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850814403",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
