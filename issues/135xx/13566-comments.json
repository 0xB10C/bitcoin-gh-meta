[
   {
      "author_association" : "MEMBER",
      "body" : "Feedback to address from @ryanofsky\r\n\r\nSome thoughts looking at code:\r\n\r\n- It seems like it would be good to raise an error if `IsDeprecatedRPCEnabled(\"accounts\")` and the account argument is not null or \"*\". Otherwise the argument would be silently ignored.\r\n- Documentation seems to say default minconf is 1, while implementation uses 0 or 1.\r\n- Maybe could dedup caching code in `GetAvailableCredit` a little with something like\r\n\r\n```\r\nCAmount* cache = filter == ISMINE_SPENDABLE  ? nAvailableCreditCached : \r\n                 filter == ISMINE_WATCH_ONLY ? nAvailableWatchCreditCached :\r\n                 nullptr;\r\n```",
      "created_at" : "2018-06-28T19:06:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401140985",
      "id" : 401140985,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13566",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMTE0MDk4NQ==",
      "updated_at" : "2018-06-28T19:06:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/401140985",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I guess that would not work for min dept of 0 (unconfirmed).\r\n\r\nAre you saying that we also need to check `pcoin->InMempool()` for coins with 0 depth?",
      "created_at" : "2018-06-28T21:00:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401171720",
      "id" : 401171720,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13566",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMTE3MTcyMA==",
      "updated_at" : "2018-06-28T21:00:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/401171720",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I believe that I've addressed all of @ryanofsky's feedback. Russ - can you rereview and confirm?\r\n\r\nNeed to address @jonasschnelli's comment. Jonas - can you please confirm my question above? Thanks!",
      "created_at" : "2018-06-28T21:59:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401186338",
      "id" : 401186338,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13566",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMTE4NjMzOA==",
      "updated_at" : "2018-06-28T21:59:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/401186338",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199161775"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199161775"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"[RPC] [wallet] allow getbalance to use min_conf and watch_only\"\r\n\r\nI think the safest thing here would be to raise an error whenever accounts are deprecated and account is non-null, because previously `getbalance(null)`, `getbalance(\"*\")`, and `getbalance(\"\")` each did different things, and it doesn't seem good to silently ignore a requested behavior. Another slightly less safe but maybe acceptable option would be to change `\"\"` to `\"*\"` on this line, since `getbalance(\"*\")` and `getbalance(null)` at least were more similar than `getbalance(\"*\")` and `getbalance(\"\")`\r\n\r\nPreviously, and currently with the deprecated accounts feature enabled:\r\n\r\n- `getbalance(null)` would return total balance\r\n- `getbalance(\"*\")` would return total balance with legacy accounting method\r\n- `getbalance(\"account\")` would return balance associated with a named account\r\n- `getbalance(\"\")` would return leftover balance not associated with any named accounts",
      "commit_id" : "43937db46edab8c226ce190e185d7a3285b3b364",
      "created_at" : "2018-06-29T13:39:45Z",
      "diff_hunk" : "@@ -895,38 +905,35 @@ static UniValue getbalance(const JSONRPCRequest& request)\n \n     LOCK2(cs_main, pwallet->cs_wallet);\n \n-    if (IsDeprecatedRPCEnabled(\"accounts\")) {\n-        const UniValue& account_value = request.params[0];\n-        const UniValue& minconf = request.params[1];\n-        const UniValue& include_watchonly = request.params[2];\n+    const UniValue& account_value = request.params[0];\n \n-        if (account_value.isNull()) {\n-            if (!minconf.isNull()) {\n-                throw JSONRPCError(RPC_INVALID_PARAMETER,\n-                    \"getbalance minconf option is only currently supported if an account is specified\");\n-            }\n-            if (!include_watchonly.isNull()) {\n-                throw JSONRPCError(RPC_INVALID_PARAMETER,\n-                    \"getbalance include_watchonly option is only currently supported if an account is specified\");\n-            }\n-            return ValueFromAmount(pwallet->GetBalance());\n-        }\n+    int min_depth = 0;\n+    if (IsDeprecatedRPCEnabled(\"accounts\") && !account_value.isNull()) {\n+        // Default min_depth to 1 when an account is provided.\n+        min_depth = 1;\n+    }\n+    if (!request.params[1].isNull()) {\n+        min_depth = request.params[1].get_int();\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (!request.params[2].isNull() && request.params[2].get_bool()) {\n+        filter = filter | ISMINE_WATCH_ONLY;\n+    }\n+\n+    if (!account_value.isNull()) {\n \n         const std::string& account_param = account_value.get_str();\n         const std::string* account = account_param != \"*\" ? &account_param : nullptr;\n \n-        int nMinDepth = 1;\n-        if (!minconf.isNull())\n-            nMinDepth = minconf.get_int();\n-        isminefilter filter = ISMINE_SPENDABLE;\n-        if(!include_watchonly.isNull())\n-            if(include_watchonly.get_bool())\n-                filter = filter | ISMINE_WATCH_ONLY;\n-\n-        return ValueFromAmount(pwallet->GetLegacyBalance(filter, nMinDepth, account));\n+        if (!IsDeprecatedRPCEnabled(\"accounts\") && *account != \"\") {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199161775",
      "id" : 199161775,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5OTE2MTc3NQ==",
      "original_commit_id" : "c57f2009f65ffedc7531644243d5d7ddd786edde",
      "original_position" : 80,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 133229591,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566",
      "updated_at" : "2018-06-29T14:24:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199161775",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199175544"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199175544"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199161775\r\n\r\nAlso want to note that another approach we could take here would not be to deprecate the `account` argument at all, but instead just rename it to `label` and pass it down as an option to the GetBalance() and GetAvailableCredit methods where it could be used to filter txouts there by address label. This would be a simple code change, just adding `if (!label || *label == GetLabelName(txout.scriptPubKey))`.",
      "commit_id" : "43937db46edab8c226ce190e185d7a3285b3b364",
      "created_at" : "2018-06-29T14:23:03Z",
      "diff_hunk" : "@@ -895,38 +905,35 @@ static UniValue getbalance(const JSONRPCRequest& request)\n \n     LOCK2(cs_main, pwallet->cs_wallet);\n \n-    if (IsDeprecatedRPCEnabled(\"accounts\")) {\n-        const UniValue& account_value = request.params[0];\n-        const UniValue& minconf = request.params[1];\n-        const UniValue& include_watchonly = request.params[2];\n+    const UniValue& account_value = request.params[0];\n \n-        if (account_value.isNull()) {\n-            if (!minconf.isNull()) {\n-                throw JSONRPCError(RPC_INVALID_PARAMETER,\n-                    \"getbalance minconf option is only currently supported if an account is specified\");\n-            }\n-            if (!include_watchonly.isNull()) {\n-                throw JSONRPCError(RPC_INVALID_PARAMETER,\n-                    \"getbalance include_watchonly option is only currently supported if an account is specified\");\n-            }\n-            return ValueFromAmount(pwallet->GetBalance());\n-        }\n+    int min_depth = 0;\n+    if (IsDeprecatedRPCEnabled(\"accounts\") && !account_value.isNull()) {\n+        // Default min_depth to 1 when an account is provided.\n+        min_depth = 1;\n+    }\n+    if (!request.params[1].isNull()) {\n+        min_depth = request.params[1].get_int();\n+    }\n+\n+    isminefilter filter = ISMINE_SPENDABLE;\n+    if (!request.params[2].isNull() && request.params[2].get_bool()) {\n+        filter = filter | ISMINE_WATCH_ONLY;\n+    }\n+\n+    if (!account_value.isNull()) {\n \n         const std::string& account_param = account_value.get_str();\n         const std::string* account = account_param != \"*\" ? &account_param : nullptr;\n \n-        int nMinDepth = 1;\n-        if (!minconf.isNull())\n-            nMinDepth = minconf.get_int();\n-        isminefilter filter = ISMINE_SPENDABLE;\n-        if(!include_watchonly.isNull())\n-            if(include_watchonly.get_bool())\n-                filter = filter | ISMINE_WATCH_ONLY;\n-\n-        return ValueFromAmount(pwallet->GetLegacyBalance(filter, nMinDepth, account));\n+        if (!IsDeprecatedRPCEnabled(\"accounts\") && *account != \"\") {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199175544",
      "id" : 199175544,
      "in_reply_to_id" : 199161775,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5OTE3NTU0NA==",
      "original_commit_id" : "c57f2009f65ffedc7531644243d5d7ddd786edde",
      "original_position" : 80,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 133246916,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13566",
      "updated_at" : "2018-06-29T14:24:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/199175544",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @ryanofsky . Updated to treat `*` as an acceptable dummy argument.\r\n\r\nI don't think we want to entirely remove the possibility of calling this method with positional arguments.",
      "created_at" : "2018-06-29T14:25:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401370490",
      "id" : 401370490,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13566",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMTM3MDQ5MA==",
      "updated_at" : "2018-06-29T14:25:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/401370490",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review @ryanofsky !",
      "created_at" : "2018-06-29T15:48:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401395313",
      "id" : 401395313,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13566",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMTM5NTMxMw==",
      "updated_at" : "2018-06-29T15:48:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/401395313",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This calls for a test, no?",
      "created_at" : "2018-06-29T16:44:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401410116",
      "id" : 401410116,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13566",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwMTQxMDExNg==",
      "updated_at" : "2018-06-29T16:44:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/401410116",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   }
]
