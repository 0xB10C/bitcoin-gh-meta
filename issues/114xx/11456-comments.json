[
   {
      "author_association" : "MEMBER",
      "body" : "> In order to prevent this change from preventing connection to\r\n-connect= nodes which have !WITNESS, -connect nodes are now\r\ngiven the \"addnode\" flag.\r\n\r\nI really disliked that flag anyway, as it's not obvious who should care and why. This change makes sense imo. Mind renaming this to \"m_manual_connection\", or \"!m_from_addrman\" (or hopefully something better) ?",
      "created_at" : "2017-10-05T15:33:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#issuecomment-334503051",
      "id" : 334503051,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11456",
      "updated_at" : "2017-10-05T15:33:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334503051",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@theuni done in a new commit, that is much more descriptive, indeed.",
      "created_at" : "2017-10-05T15:50:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#issuecomment-334508259",
      "id" : 334508259,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11456",
      "updated_at" : "2017-10-05T15:50:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334508259",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r142984466"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142984466"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Can you document what the parameter represents? Hard to tell since it's unused. I assume it's for future compatibility.",
      "commit_id" : "989d2fe652199e367688d5323397930462688854",
      "created_at" : "2017-10-05T16:08:57Z",
      "diff_hunk" : "@@ -277,6 +277,35 @@ enum ServiceFlags : uint64_t {\n     // BIP process.\n };\n \n+/**\n+ * Gets the set of service flags which are \"relevant\" for a given peer.\n+ *\n+ * Generally, avoid calling with peerServices == NODE_NONE as we may have\n+ * service flags which are optionally relevant (eg NODE_NETWORK_LIMITED).\n+ *\n+ * If the peer is missing any of the returned service flags, they aren't\n+ * interesting to us - we probably shouldn't conenct outbound to them.\n+ */\n+static ServiceFlags GetRelevantServiceFlags(ServiceFlags services) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r142984466",
      "id" : 142984466,
      "original_commit_id" : "4c24f4ccc37acbc5d461198c33712a9aaa53e960",
      "original_position" : 13,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 67429582,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456",
      "updated_at" : "2017-10-06T21:54:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142984466",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r142989057"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142989057"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Indeed, its for use in #10387. Will it be clearer when the function reads\r\n```\r\nGetRelevantServiceFlags(services) {\r\n    if (services & NODE_NETWORK_LIMITED && !in_ibd) return NODE_NETWORK_LIMITED | NODE_WITNESS;\r\n    return NODE_NETWORK | NODE_WITNESS;\r\n```\r\nor should I document it further?",
      "commit_id" : "989d2fe652199e367688d5323397930462688854",
      "created_at" : "2017-10-05T16:27:57Z",
      "diff_hunk" : "@@ -277,6 +277,35 @@ enum ServiceFlags : uint64_t {\n     // BIP process.\n };\n \n+/**\n+ * Gets the set of service flags which are \"relevant\" for a given peer.\n+ *\n+ * Generally, avoid calling with peerServices == NODE_NONE as we may have\n+ * service flags which are optionally relevant (eg NODE_NETWORK_LIMITED).\n+ *\n+ * If the peer is missing any of the returned service flags, they aren't\n+ * interesting to us - we probably shouldn't conenct outbound to them.\n+ */\n+static ServiceFlags GetRelevantServiceFlags(ServiceFlags services) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r142989057",
      "id" : 142989057,
      "in_reply_to_id" : 142984466,
      "original_commit_id" : "4c24f4ccc37acbc5d461198c33712a9aaa53e960",
      "original_position" : 13,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 67435201,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456",
      "updated_at" : "2017-10-06T21:54:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142989057",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r142994437"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142994437"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, parameter documentation would be nice because I still find its purpose confusing. Especially since as a parameter of `HasAllRelevantServiceFlags` it represents both the service flags you want to test and a modifier on what you want to test against. Like, why is the future code not just:\r\n\r\n```c++\r\nGetRelevantServiceFlags() {\r\n    if (!in_ibd) return NODE_NETWORK_LIMITED | NODE_WITNESS;\r\n    else return NODE_NETWORK | NODE_WITNESS;\r\n``` ",
      "commit_id" : "989d2fe652199e367688d5323397930462688854",
      "created_at" : "2017-10-05T16:50:08Z",
      "diff_hunk" : "@@ -277,6 +277,35 @@ enum ServiceFlags : uint64_t {\n     // BIP process.\n };\n \n+/**\n+ * Gets the set of service flags which are \"relevant\" for a given peer.\n+ *\n+ * Generally, avoid calling with peerServices == NODE_NONE as we may have\n+ * service flags which are optionally relevant (eg NODE_NETWORK_LIMITED).\n+ *\n+ * If the peer is missing any of the returned service flags, they aren't\n+ * interesting to us - we probably shouldn't conenct outbound to them.\n+ */\n+static ServiceFlags GetRelevantServiceFlags(ServiceFlags services) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r142994437",
      "id" : 142994437,
      "in_reply_to_id" : 142984466,
      "original_commit_id" : "4c24f4ccc37acbc5d461198c33712a9aaa53e960",
      "original_position" : 13,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 67441332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456",
      "updated_at" : "2017-10-06T21:54:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142994437",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I was thinking of opening a PR soon to require WITNESS for outbounds in any case, so ACK on that.",
      "created_at" : "2017-10-05T17:06:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#issuecomment-334529534",
      "id" : 334529534,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11456",
      "updated_at" : "2017-10-05T17:06:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334529534",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rewrote the function description. Sufficiently descriptive, @jimpo?",
      "created_at" : "2017-10-05T22:06:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#issuecomment-334605613",
      "id" : 334605613,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11456",
      "updated_at" : "2017-10-05T22:06:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334605613",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143200547"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143200547"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I like jimpo's suggestion above for getting rid of the service argument, since this code seems more vague and confusing than it needs to be. Other suggestions for making it clearer could be:\r\n\r\n- Rename \"Relevant\" to \"Required\" or \"RequiredForOutbound.\" \"Relevant\" doesn't suggest what the return value will be used for, while \"Required\" does.\r\n- Rename \"services\" argument to \"peer_service_flags\" if it can't be eliminated so it is clearer where the argument value is coming from.",
      "commit_id" : "989d2fe652199e367688d5323397930462688854",
      "created_at" : "2017-10-06T14:13:59Z",
      "diff_hunk" : "@@ -277,6 +277,35 @@ enum ServiceFlags : uint64_t {\n     // BIP process.\n };\n \n+/**\n+ * Gets the set of service flags which are \"relevant\" for a given peer.\n+ *\n+ * Generally, avoid calling with peerServices == NODE_NONE as we may have\n+ * service flags which are optionally relevant (eg NODE_NETWORK_LIMITED).\n+ *\n+ * If the peer is missing any of the returned service flags, they aren't\n+ * interesting to us - we probably shouldn't conenct outbound to them.\n+ */\n+static ServiceFlags GetRelevantServiceFlags(ServiceFlags services) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143200547",
      "id" : 143200547,
      "in_reply_to_id" : 142984466,
      "original_commit_id" : "4c24f4ccc37acbc5d461198c33712a9aaa53e960",
      "original_position" : 13,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 67680888,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456",
      "updated_at" : "2017-10-06T21:54:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143200547",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143203308"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143203308"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "\"Relevant\" doesn't seem like the right word here either, because it doesn't imply anything about the addressdb. Maybe \"Robust\"? \"Good\"? \"Usable\"?",
      "commit_id" : "989d2fe652199e367688d5323397930462688854",
      "created_at" : "2017-10-06T14:24:31Z",
      "diff_hunk" : "@@ -277,6 +277,43 @@ enum ServiceFlags : uint64_t {\n     // BIP process.\n };\n \n+/**\n+ * Gets the set of service flags which are \"relevant\" for a given peer.\n+ *\n+ * These are the flags which are required for a peer to support for them\n+ * to be \"interesting\" to us, ie for us to wish to use one of our few\n+ * outbound connection slots for or for us to wish to prioritize keeping\n+ * their connection around.\n+ *\n+ * Relevant service flags may be peer- and state-specific in that the\n+ * version of the peer may determine which flags are required (eg in the\n+ * case of NODE_NETWORK_LIMITED where we seek out NODE_NETWORK peers\n+ * unless they set NODE_NETWORK_LIMITED and we our out of IBD, in which\n+ * case NODE_NETWORK_LIMITED suffices).\n+ *\n+ * Thus, generally, avoid calling with peerServices == NODE_NONE.\n+ */\n+static ServiceFlags GetRelevantServiceFlags(ServiceFlags services) {\n+    return ServiceFlags(NODE_NETWORK | NODE_WITNESS);\n+}\n+\n+/**\n+ * A shortcut for (services & GetRelevantServiceFlags(services))\n+ * == GetRelevantServiceFlags(services), ie determines whether the given\n+ * set of service flags are sufficient for a peer to be \"relevant\".\n+ */\n+static inline bool HasAllRelevantServiceFlags(ServiceFlags services) {\n+    return (GetRelevantServiceFlags(services) & services) == GetRelevantServiceFlags(services);\n+}\n+\n+/**\n+ * Checks if a peer with the given service flags may be capable of having a\n+ * robust address-storage DB. Currently an alias for checking NODE_NETWORK.\n+ */\n+static inline bool MayHaveRelevantAddressDB(ServiceFlags services) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143203308",
      "id" : 143203308,
      "original_commit_id" : "4641bb298e216dd44c7bc3995f76a313628d142d",
      "original_position" : 37,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 67680888,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456",
      "updated_at" : "2017-10-06T21:54:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143203308",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143206195"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143206195"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Again could consider \"Required\" / \"peer_service_flags\" renames suggested above.",
      "commit_id" : "989d2fe652199e367688d5323397930462688854",
      "created_at" : "2017-10-06T14:35:24Z",
      "diff_hunk" : "@@ -277,6 +277,43 @@ enum ServiceFlags : uint64_t {\n     // BIP process.\n };\n \n+/**\n+ * Gets the set of service flags which are \"relevant\" for a given peer.\n+ *\n+ * These are the flags which are required for a peer to support for them\n+ * to be \"interesting\" to us, ie for us to wish to use one of our few\n+ * outbound connection slots for or for us to wish to prioritize keeping\n+ * their connection around.\n+ *\n+ * Relevant service flags may be peer- and state-specific in that the\n+ * version of the peer may determine which flags are required (eg in the\n+ * case of NODE_NETWORK_LIMITED where we seek out NODE_NETWORK peers\n+ * unless they set NODE_NETWORK_LIMITED and we our out of IBD, in which\n+ * case NODE_NETWORK_LIMITED suffices).\n+ *\n+ * Thus, generally, avoid calling with peerServices == NODE_NONE.\n+ */\n+static ServiceFlags GetRelevantServiceFlags(ServiceFlags services) {\n+    return ServiceFlags(NODE_NETWORK | NODE_WITNESS);\n+}\n+\n+/**\n+ * A shortcut for (services & GetRelevantServiceFlags(services))\n+ * == GetRelevantServiceFlags(services), ie determines whether the given\n+ * set of service flags are sufficient for a peer to be \"relevant\".\n+ */\n+static inline bool HasAllRelevantServiceFlags(ServiceFlags services) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143206195",
      "id" : 143206195,
      "original_commit_id" : "4641bb298e216dd44c7bc3995f76a313628d142d",
      "original_position" : 29,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 67680888,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456",
      "updated_at" : "2017-10-06T21:54:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143206195",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143219778"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143219778"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You need the NODE_NETWORK_LIMITED check as a proxy for whether the node is new - eg if the node announces NODE_NETWORK_LIMITED (and you're out of IBD) then you're fine with NODE_NETWORK_LIMITED, but if the node only announces NODE_NETWORK they may be an 0.15.X node and you're perfectly OK with them having only NODE_NETWORK and not NODE_NETWORK_LIMITED.",
      "commit_id" : "989d2fe652199e367688d5323397930462688854",
      "created_at" : "2017-10-06T15:24:10Z",
      "diff_hunk" : "@@ -277,6 +277,35 @@ enum ServiceFlags : uint64_t {\n     // BIP process.\n };\n \n+/**\n+ * Gets the set of service flags which are \"relevant\" for a given peer.\n+ *\n+ * Generally, avoid calling with peerServices == NODE_NONE as we may have\n+ * service flags which are optionally relevant (eg NODE_NETWORK_LIMITED).\n+ *\n+ * If the peer is missing any of the returned service flags, they aren't\n+ * interesting to us - we probably shouldn't conenct outbound to them.\n+ */\n+static ServiceFlags GetRelevantServiceFlags(ServiceFlags services) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143219778",
      "id" : 143219778,
      "in_reply_to_id" : 142984466,
      "original_commit_id" : "4c24f4ccc37acbc5d461198c33712a9aaa53e960",
      "original_position" : 13,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 67704121,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456",
      "updated_at" : "2017-10-06T21:54:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143219778",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143221802"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143221802"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh, ok, I figured that would work because NODE_NETWORK would be a superset of NODE_NETWORK_LIMITED. But if NODE_NETWORK without NODE_NETWORK_LIMITED is a meaningful flag combination then it makes sense that you need the services argument.\r\n\r\nIn any case, I mostly wanted to suggest the renames here.",
      "commit_id" : "989d2fe652199e367688d5323397930462688854",
      "created_at" : "2017-10-06T15:31:30Z",
      "diff_hunk" : "@@ -277,6 +277,35 @@ enum ServiceFlags : uint64_t {\n     // BIP process.\n };\n \n+/**\n+ * Gets the set of service flags which are \"relevant\" for a given peer.\n+ *\n+ * Generally, avoid calling with peerServices == NODE_NONE as we may have\n+ * service flags which are optionally relevant (eg NODE_NETWORK_LIMITED).\n+ *\n+ * If the peer is missing any of the returned service flags, they aren't\n+ * interesting to us - we probably shouldn't conenct outbound to them.\n+ */\n+static ServiceFlags GetRelevantServiceFlags(ServiceFlags services) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143221802",
      "id" : 143221802,
      "in_reply_to_id" : 142984466,
      "original_commit_id" : "4c24f4ccc37acbc5d461198c33712a9aaa53e960",
      "original_position" : 13,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 67706462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456",
      "updated_at" : "2017-10-06T21:54:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143221802",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143229920"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143229920"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "NODE_NETWORK without NODE_NETWORK_LIMITED is not meaningful generally, but old nodes will (obviously) be using that, so it is important that we still treat it correctly.",
      "commit_id" : "989d2fe652199e367688d5323397930462688854",
      "created_at" : "2017-10-06T16:04:39Z",
      "diff_hunk" : "@@ -277,6 +277,35 @@ enum ServiceFlags : uint64_t {\n     // BIP process.\n };\n \n+/**\n+ * Gets the set of service flags which are \"relevant\" for a given peer.\n+ *\n+ * Generally, avoid calling with peerServices == NODE_NONE as we may have\n+ * service flags which are optionally relevant (eg NODE_NETWORK_LIMITED).\n+ *\n+ * If the peer is missing any of the returned service flags, they aren't\n+ * interesting to us - we probably shouldn't conenct outbound to them.\n+ */\n+static ServiceFlags GetRelevantServiceFlags(ServiceFlags services) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143229920",
      "id" : 143229920,
      "in_reply_to_id" : 142984466,
      "original_commit_id" : "4c24f4ccc37acbc5d461198c33712a9aaa53e960",
      "original_position" : 13,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 67716030,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456",
      "updated_at" : "2017-10-06T21:54:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143229920",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept Ack and a light CR-Ack. \r\n\r\nI agree with @ryanofsky about naming -- I didn't find the new function names you introduced to be particularly elucidating, so maybe you can pick something better.\r\n\r\nAlso, I don't think we want to introduce new hungarian notation member variables (unless the m_ stands for 'matt_' ;) ).",
      "created_at" : "2017-10-06T16:05:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#issuecomment-334798836",
      "id" : 334798836,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11456",
      "updated_at" : "2017-10-06T16:05:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334798836",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ryanofsky I'm not sure what your comment about -connect is about. The help text still reads correct to me (it still limits you to only that one connection), the only thing it changes is that previously we would disconnect-on-VERSION-message for -connect peers which do not set NODE_NETWORK, now we will keep it connected just the same as -addnode peers. If you think thats a critical change to document I'm happy to do so, but I think thats a rather esoteric case for -connect.",
      "created_at" : "2017-10-06T16:07:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#issuecomment-334799262",
      "id" : 334799262,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11456",
      "updated_at" : "2017-10-06T16:07:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334799262",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143247408"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143247408"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: we are*",
      "commit_id" : "989d2fe652199e367688d5323397930462688854",
      "created_at" : "2017-10-06T17:18:18Z",
      "diff_hunk" : "@@ -277,6 +277,43 @@ enum ServiceFlags : uint64_t {\n     // BIP process.\n };\n \n+/**\n+ * Gets the set of service flags which are \"relevant\" for a given peer.\n+ *\n+ * These are the flags which are required for a peer to support for them\n+ * to be \"interesting\" to us, ie for us to wish to use one of our few\n+ * outbound connection slots for or for us to wish to prioritize keeping\n+ * their connection around.\n+ *\n+ * Relevant service flags may be peer- and state-specific in that the\n+ * version of the peer may determine which flags are required (eg in the\n+ * case of NODE_NETWORK_LIMITED where we seek out NODE_NETWORK peers\n+ * unless they set NODE_NETWORK_LIMITED and we our out of IBD, in which",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143247408",
      "id" : 143247408,
      "original_commit_id" : "12524dd366306ea59ec8019e076b9a843d55bcf0",
      "original_position" : 15,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 67736637,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456",
      "updated_at" : "2017-10-06T21:54:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143247408",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, I wasn't saying the help text is incorrect, I was saying it was incomplete. Help text says `-connect` does one thing (limit which peers will be connected to) but actually `-connect` does two things (limit peers, and also loosen requirements for those peers). Feel free to leave it alone if you don't think it's worth mentioning, but it seemed like an omission.",
      "created_at" : "2017-10-06T17:37:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#issuecomment-334822166",
      "id" : 334822166,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11456",
      "updated_at" : "2017-10-06T17:37:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334822166",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143267453"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143267453"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think services are just acting as a proxy here. Since we enforce service checking for (non-manual) outgoing connections already, and should probably consider incoming nodes as insignificant for the sake of this check, don't we really just want to tally ```fSuccessfullyConnected && !fInbound && !m_manual_connection``` ?",
      "commit_id" : "989d2fe652199e367688d5323397930462688854",
      "created_at" : "2017-10-06T18:43:27Z",
      "diff_hunk" : "@@ -1602,7 +1601,7 @@ void CConnman::ThreadDNSAddressSeed()\n         LOCK(cs_vNodes);\n         int nRelevant = 0;\n         for (auto pnode : vNodes) {\n-            nRelevant += pnode->fSuccessfullyConnected && ((pnode->nServices & nRelevantServices) == nRelevantServices);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143267453",
      "id" : 143267453,
      "original_commit_id" : "12524dd366306ea59ec8019e076b9a843d55bcf0",
      "original_position" : 30,
      "path" : "src/net.cpp",
      "position" : 30,
      "pull_request_review_id" : 67760064,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456",
      "updated_at" : "2017-10-06T21:54:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143267453",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143290913"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143290913"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Agreed, though I went ahead and added OneShot and Feeler into the mix.",
      "commit_id" : "989d2fe652199e367688d5323397930462688854",
      "created_at" : "2017-10-06T20:47:37Z",
      "diff_hunk" : "@@ -1602,7 +1601,7 @@ void CConnman::ThreadDNSAddressSeed()\n         LOCK(cs_vNodes);\n         int nRelevant = 0;\n         for (auto pnode : vNodes) {\n-            nRelevant += pnode->fSuccessfullyConnected && ((pnode->nServices & nRelevantServices) == nRelevantServices);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143290913",
      "id" : 143290913,
      "in_reply_to_id" : 143267453,
      "original_commit_id" : "12524dd366306ea59ec8019e076b9a843d55bcf0",
      "original_position" : 30,
      "path" : "src/net.cpp",
      "position" : 30,
      "pull_request_review_id" : 67788728,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456",
      "updated_at" : "2017-10-06T21:54:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143290913",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "OK, addressed all the feedback except the desire to rename Relevant to something else. I'm not a fan of Required or RequiredForOutbound, as neither really caputures its full user (its also used in eviction logic). I admit Relevant isnt so descriptive either, but it also doesn't give a false impression (and is documented), so I'm open to other suggestions but not a fan of the current options.",
      "created_at" : "2017-10-06T21:31:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#issuecomment-334875155",
      "id" : 334875155,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11456",
      "updated_at" : "2017-10-06T21:31:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334875155",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143300105"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143300105"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "and are",
      "commit_id" : "989d2fe652199e367688d5323397930462688854",
      "created_at" : "2017-10-06T21:39:59Z",
      "diff_hunk" : "@@ -201,6 +201,8 @@ UniValue addnode(const JSONRPCRequest& request)\n             \"addnode \\\"node\\\" \\\"add|remove|onetry\\\"\\n\"\n             \"\\nAttempts to add or remove a node from the addnode list.\\n\"\n             \"Or try a connection to a node once.\\n\"\n+            \"Nodes added using addnode (or -connect) are protected from DoS disconnection andare not required to be\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143300105",
      "id" : 143300105,
      "original_commit_id" : "6eaa72dde08df54c632f0cc1e3485af5ec1b117c",
      "original_position" : 4,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 67799711,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456",
      "updated_at" : "2017-10-06T21:54:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143300105",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed to \"Desirable\" instead of \"Relevant\" at @JeremyRubin's suggestion.",
      "created_at" : "2017-10-06T21:57:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#issuecomment-334879999",
      "id" : 334879999,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11456",
      "updated_at" : "2017-10-06T21:57:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334879999",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143326023"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326023"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit, unused services, comment?",
      "commit_id" : "989d2fe652199e367688d5323397930462688854",
      "created_at" : "2017-10-07T08:26:57Z",
      "diff_hunk" : "@@ -277,6 +277,43 @@ enum ServiceFlags : uint64_t {\n     // BIP process.\n };\n \n+/**\n+ * Gets the set of service flags which are \"desirable\" for a given peer.\n+ *\n+ * These are the flags which are required for a peer to support for them\n+ * to be \"interesting\" to us, ie for us to wish to use one of our few\n+ * outbound connection slots for or for us to wish to prioritize keeping\n+ * their connection around.\n+ *\n+ * Relevant service flags may be peer- and state-specific in that the\n+ * version of the peer may determine which flags are required (eg in the\n+ * case of NODE_NETWORK_LIMITED where we seek out NODE_NETWORK peers\n+ * unless they set NODE_NETWORK_LIMITED and we are out of IBD, in which\n+ * case NODE_NETWORK_LIMITED suffices).\n+ *\n+ * Thus, generally, avoid calling with peerServices == NODE_NONE.\n+ */\n+static ServiceFlags GetDesirableServiceFlags(ServiceFlags services) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143326023",
      "id" : 143326023,
      "original_commit_id" : "989d2fe652199e367688d5323397930462688854",
      "original_position" : 20,
      "path" : "src/protocol.h",
      "position" : 20,
      "pull_request_review_id" : 67828507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456",
      "updated_at" : "2017-10-07T08:33:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326023",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143326070"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326070"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "inline?",
      "commit_id" : "989d2fe652199e367688d5323397930462688854",
      "created_at" : "2017-10-07T08:31:44Z",
      "diff_hunk" : "@@ -277,6 +277,43 @@ enum ServiceFlags : uint64_t {\n     // BIP process.\n };\n \n+/**\n+ * Gets the set of service flags which are \"desirable\" for a given peer.\n+ *\n+ * These are the flags which are required for a peer to support for them\n+ * to be \"interesting\" to us, ie for us to wish to use one of our few\n+ * outbound connection slots for or for us to wish to prioritize keeping\n+ * their connection around.\n+ *\n+ * Relevant service flags may be peer- and state-specific in that the\n+ * version of the peer may determine which flags are required (eg in the\n+ * case of NODE_NETWORK_LIMITED where we seek out NODE_NETWORK peers\n+ * unless they set NODE_NETWORK_LIMITED and we are out of IBD, in which\n+ * case NODE_NETWORK_LIMITED suffices).\n+ *\n+ * Thus, generally, avoid calling with peerServices == NODE_NONE.\n+ */\n+static ServiceFlags GetDesirableServiceFlags(ServiceFlags services) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143326070",
      "id" : 143326070,
      "in_reply_to_id" : 143326023,
      "original_commit_id" : "989d2fe652199e367688d5323397930462688854",
      "original_position" : 20,
      "path" : "src/protocol.h",
      "position" : 20,
      "pull_request_review_id" : 67828507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456",
      "updated_at" : "2017-10-07T08:33:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326070",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143345814"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143345814"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "See https://github.com/bitcoin/bitcoin/pull/11456#discussion_r142989057, this function should get much more complicated soon, and hopefully move out of protocol.h at the same time.",
      "commit_id" : "989d2fe652199e367688d5323397930462688854",
      "created_at" : "2017-10-08T04:04:14Z",
      "diff_hunk" : "@@ -277,6 +277,43 @@ enum ServiceFlags : uint64_t {\n     // BIP process.\n };\n \n+/**\n+ * Gets the set of service flags which are \"desirable\" for a given peer.\n+ *\n+ * These are the flags which are required for a peer to support for them\n+ * to be \"interesting\" to us, ie for us to wish to use one of our few\n+ * outbound connection slots for or for us to wish to prioritize keeping\n+ * their connection around.\n+ *\n+ * Relevant service flags may be peer- and state-specific in that the\n+ * version of the peer may determine which flags are required (eg in the\n+ * case of NODE_NETWORK_LIMITED where we seek out NODE_NETWORK peers\n+ * unless they set NODE_NETWORK_LIMITED and we are out of IBD, in which\n+ * case NODE_NETWORK_LIMITED suffices).\n+ *\n+ * Thus, generally, avoid calling with peerServices == NODE_NONE.\n+ */\n+static ServiceFlags GetDesirableServiceFlags(ServiceFlags services) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#discussion_r143345814",
      "id" : 143345814,
      "in_reply_to_id" : 143326023,
      "original_commit_id" : "989d2fe652199e367688d5323397930462688854",
      "original_position" : 20,
      "path" : "src/protocol.h",
      "position" : 20,
      "pull_request_review_id" : 67848337,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456",
      "updated_at" : "2017-10-08T04:04:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143345814",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Though, I believe that these lines demonstrate why \"Desirable\" is so awkward:\r\n```c++\r\nif (!fFeeler && !HasAllDesirableServiceFlags(addr.nServices)) {\r\n    continue;\r\n    } else if (fFeeler && !MayHaveUsefulAddressDB(addr.nServices)) {\r\n    continue;\r\n}\r\n```\r\n```MayHaveUsefulAddressDB()``` is explicit in what it's checking, but ```HasAllDesirableServiceFlags()``` is not.\r\n\r\nI'd be much more comfortable with this (and I think it'd be much more straightforward) if ```HasAllDesirableServiceFlags()``` was replaced with two or three different functions, each representing an explicit functionality check. e.g.: ```MayServeSomeWitnessBlocks()```, ```MayServeAllWitnessBlocks()```, etc.\r\n\r\nAfter all, that's what we're _really_ trying to figure out, right?\r\n\r\nThen the flag checks aren't dependent on app state, because those checks are done in a straightforward way by the caller instead:\r\n\r\n```c++\r\nif ((in_ibd && MayServeAllWitnessBlocks(services))\r\n  || (!in_ibd && MayServeSomeWitnessBlocks(services))) {\r\n    request()\r\n    ...\r\n}\r\n```\r\n\r\nThat also means that \"Desirable\" doesn't have to share the same meaning everywhere. The obvious example where that's useful is the eviction logic.\r\n\r\nSo... basically just a glorified version of the previous binary logic, except that the functions understand cases where multiple flags may be suitable.",
      "created_at" : "2017-10-10T19:02:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456#issuecomment-335575012",
      "id" : 335575012,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11456",
      "updated_at" : "2017-10-10T19:02:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/335575012",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   }
]
