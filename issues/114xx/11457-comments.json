[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143107886"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143107886"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What about adding `GUARDED_BY(Ã¢ÂÂ¦)` (see #10866 and #11226) annotations here?\r\n\r\nLike this:\r\n\r\n```\r\n    CCriticalSection m_cs_banned;\r\n    banmap_t m_banned GUARDED_BY(m_cs_banned);\r\n    bool m_is_dirty GUARDED_BY(m_cs_banned);\r\n```\r\n\r\nNit: The lock was renamed from `cs_setBanned` to `m_cs_banned`. All `CCriticalSection`:s in the code base except `m_cs_callbacks_pending` are named with the `cs_` prefix (as opposed to `m_cs_`). Is `m_cs_` the recommended prefix going forward? More specifically, what prefix is recommended for my work in #10866? :-)\r\n\r\nI think there is a point in having consistent naming for the locks in order to allow for easy grepping of the locks. Personally I use grepping frequently (e.g. `git grep ' cs_[a-zA-Z0-9]\\+;' -- \"*.h\" \"*.cpp\"`) in the scripts that keep tracks of the locks to cover in #10866).",
      "commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "created_at" : "2017-10-06T04:32:01Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_BANMAN_H\n+#define BITCOIN_BANMAN_H\n+\n+#include \"addrdb.h\"\n+#include \"fs.h\"\n+#include \"sync.h\"\n+\n+// NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n+static const unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24;  // Default 24-hour ban\n+\n+class CClientUIInterface;\n+class CNetAddr;\n+class CSubNet;\n+\n+class BanMan\n+{\n+public:\n+    // Denial-of-service detection/prevention\n+    // The idea is to detect peers that are behaving\n+    // badly and disconnect/ban them, but do it in a\n+    // one-coding-mistake-won't-shatter-the-entire-network\n+    // way.\n+    // IMPORTANT:  There should be nothing I can give a\n+    // node that it will forward on that will make that\n+    // node's peers drop it. If there is, an attacker\n+    // can isolate a node and/or try to split the network.\n+    // Dropping a node for sending stuff that is invalid\n+    // now but might be valid in a later version is also\n+    // dangerous, because it can cause a network split\n+    // between nodes running old code and nodes running\n+    // new code.\n+    ~BanMan();\n+    BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n+    void Ban(const CNetAddr& netAddr, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void Ban(const CSubNet& subNet, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void ClearBanned(); // needed for unit testing\n+    bool IsBanned(CNetAddr ip);\n+    bool IsBanned(CSubNet subnet);\n+    bool Unban(const CNetAddr &ip);\n+    bool Unban(const CSubNet &ip);\n+    void GetBanned(banmap_t &banmap);\n+    void DumpBanlist();\n+\n+private:\n+    void SetBanned(const banmap_t &banmap);\n+    bool BannedSetIsDirty();\n+    //!set the \"dirty\" flag for the banlist\n+    void SetBannedSetDirty(bool dirty=true);\n+    //!clean unused entries (if bantime has expired)\n+    void SweepBanned();\n+\n+    banmap_t m_banned;\n+    CCriticalSection m_cs_banned;\n+    bool m_is_dirty;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143107886",
      "id" : 143107886,
      "original_commit_id" : "a006ca20f20b776038e8562000ec8724d35ce607",
      "original_position" : 58,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 67570999,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457",
      "updated_at" : "2017-10-06T22:01:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143107886",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK modulo `GUARDED_BY(Ã¢ÂÂ¦)` addition :-)",
      "created_at" : "2017-10-06T04:33:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#issuecomment-334655782",
      "id" : 334655782,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11457",
      "updated_at" : "2017-10-06T04:33:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334655782",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept Ack!",
      "created_at" : "2017-10-06T14:59:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#issuecomment-334780169",
      "id" : 334780169,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11457",
      "updated_at" : "2017-10-06T14:59:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334780169",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143282072"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143282072"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Shouldnt these technically be in the opposite order? Isnt there otherwise a (supidly rare) race where a new connection can come in and slip behind the ban?",
      "commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "created_at" : "2017-10-06T19:57:37Z",
      "diff_hunk" : "@@ -541,7 +541,13 @@ UniValue setban(const JSONRPCRequest& request)\n         if (request.params[3].isTrue())\n             absolute = true;\n \n-        isSubnet ? g_connman->Ban(subNet, BanReasonManuallyAdded, banTime, absolute) : g_connman->Ban(netAddr, BanReasonManuallyAdded, banTime, absolute);\n+        if (isSubnet) {\n+            g_connman->DisconnectNode(subNet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143282072",
      "id" : 143282072,
      "original_commit_id" : "ac90cbc5c1faf76b9e9e2cb35c5b77319e10d146",
      "original_position" : 6,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 67777701,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457",
      "updated_at" : "2017-10-06T22:01:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143282072",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143282518"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143282518"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Make explicit?",
      "commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "created_at" : "2017-10-06T19:59:51Z",
      "diff_hunk" : "@@ -94,7 +94,7 @@ class CBanDB\n private:\n     fs::path pathBanlist;\n public:\n-    CBanDB();\n+    CBanDB(fs::path pathBanlist);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143282518",
      "id" : 143282518,
      "original_commit_id" : "a006ca20f20b776038e8562000ec8724d35ce607",
      "original_position" : 5,
      "path" : "src/addrdb.h",
      "position" : null,
      "pull_request_review_id" : 67778242,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457",
      "updated_at" : "2017-10-06T22:01:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143282518",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143282845"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143282845"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should this be a class-level comment? (Like placed right above `class BanMan`)",
      "commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "created_at" : "2017-10-06T20:01:30Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_BANMAN_H\n+#define BITCOIN_BANMAN_H\n+\n+#include \"addrdb.h\"\n+#include \"fs.h\"\n+#include \"sync.h\"\n+\n+// NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n+static const unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24;  // Default 24-hour ban\n+\n+class CClientUIInterface;\n+class CNetAddr;\n+class CSubNet;\n+\n+class BanMan\n+{\n+public:\n+    // Denial-of-service detection/prevention",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143282845",
      "id" : 143282845,
      "original_commit_id" : "a006ca20f20b776038e8562000ec8724d35ce607",
      "original_position" : 22,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 67778242,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457",
      "updated_at" : "2017-10-06T22:01:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143282845",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143285317"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143285317"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md:\r\n> Class member variables have a m_ prefix.\r\n\r\nSo yes, m_cs_foo is the recommended syntax going forward for member mutexes, I suppose.",
      "commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "created_at" : "2017-10-06T20:15:31Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_BANMAN_H\n+#define BITCOIN_BANMAN_H\n+\n+#include \"addrdb.h\"\n+#include \"fs.h\"\n+#include \"sync.h\"\n+\n+// NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n+static const unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24;  // Default 24-hour ban\n+\n+class CClientUIInterface;\n+class CNetAddr;\n+class CSubNet;\n+\n+class BanMan\n+{\n+public:\n+    // Denial-of-service detection/prevention\n+    // The idea is to detect peers that are behaving\n+    // badly and disconnect/ban them, but do it in a\n+    // one-coding-mistake-won't-shatter-the-entire-network\n+    // way.\n+    // IMPORTANT:  There should be nothing I can give a\n+    // node that it will forward on that will make that\n+    // node's peers drop it. If there is, an attacker\n+    // can isolate a node and/or try to split the network.\n+    // Dropping a node for sending stuff that is invalid\n+    // now but might be valid in a later version is also\n+    // dangerous, because it can cause a network split\n+    // between nodes running old code and nodes running\n+    // new code.\n+    ~BanMan();\n+    BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n+    void Ban(const CNetAddr& netAddr, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void Ban(const CSubNet& subNet, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void ClearBanned(); // needed for unit testing\n+    bool IsBanned(CNetAddr ip);\n+    bool IsBanned(CSubNet subnet);\n+    bool Unban(const CNetAddr &ip);\n+    bool Unban(const CSubNet &ip);\n+    void GetBanned(banmap_t &banmap);\n+    void DumpBanlist();\n+\n+private:\n+    void SetBanned(const banmap_t &banmap);\n+    bool BannedSetIsDirty();\n+    //!set the \"dirty\" flag for the banlist\n+    void SetBannedSetDirty(bool dirty=true);\n+    //!clean unused entries (if bantime has expired)\n+    void SweepBanned();\n+\n+    banmap_t m_banned;\n+    CCriticalSection m_cs_banned;\n+    bool m_is_dirty;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143285317",
      "id" : 143285317,
      "in_reply_to_id" : 143107886,
      "original_commit_id" : "a006ca20f20b776038e8562000ec8724d35ce607",
      "original_position" : 58,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 67781626,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457",
      "updated_at" : "2017-10-06T22:01:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143285317",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143285464"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143285464"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure",
      "commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "created_at" : "2017-10-06T20:16:22Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_BANMAN_H\n+#define BITCOIN_BANMAN_H\n+\n+#include \"addrdb.h\"\n+#include \"fs.h\"\n+#include \"sync.h\"\n+\n+// NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n+static const unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24;  // Default 24-hour ban\n+\n+class CClientUIInterface;\n+class CNetAddr;\n+class CSubNet;\n+\n+class BanMan\n+{\n+public:\n+    // Denial-of-service detection/prevention",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143285464",
      "id" : 143285464,
      "in_reply_to_id" : 143282845,
      "original_commit_id" : "a006ca20f20b776038e8562000ec8724d35ce607",
      "original_position" : 22,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 67781818,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457",
      "updated_at" : "2017-10-06T22:01:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143285464",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143285484"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143285484"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Will do.",
      "commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "created_at" : "2017-10-06T20:16:28Z",
      "diff_hunk" : "@@ -94,7 +94,7 @@ class CBanDB\n private:\n     fs::path pathBanlist;\n public:\n-    CBanDB();\n+    CBanDB(fs::path pathBanlist);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143285484",
      "id" : 143285484,
      "in_reply_to_id" : 143282518,
      "original_commit_id" : "a006ca20f20b776038e8562000ec8724d35ce607",
      "original_position" : 5,
      "path" : "src/addrdb.h",
      "position" : null,
      "pull_request_review_id" : 67781848,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457",
      "updated_at" : "2017-10-06T22:01:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143285484",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143287393"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143287393"
         }
      },
      "author_association" : "MEMBER",
      "body" : ">What about adding GUARDED_BY(Ã¢ÂÂ¦) (see #10866 and #11226) annotations here?\r\n\r\nWill do. Additionally, this actually needs another mutex for the db. I've been debating whether it should be fixed as part of this PR, but event-driven db flushes can actually collide with the one on a timer. addrman has the same issue, and that may be the cause of some addrman corruption we've seen lately (#11252, #11409, #11454).",
      "commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "created_at" : "2017-10-06T20:27:02Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_BANMAN_H\n+#define BITCOIN_BANMAN_H\n+\n+#include \"addrdb.h\"\n+#include \"fs.h\"\n+#include \"sync.h\"\n+\n+// NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n+static const unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24;  // Default 24-hour ban\n+\n+class CClientUIInterface;\n+class CNetAddr;\n+class CSubNet;\n+\n+class BanMan\n+{\n+public:\n+    // Denial-of-service detection/prevention\n+    // The idea is to detect peers that are behaving\n+    // badly and disconnect/ban them, but do it in a\n+    // one-coding-mistake-won't-shatter-the-entire-network\n+    // way.\n+    // IMPORTANT:  There should be nothing I can give a\n+    // node that it will forward on that will make that\n+    // node's peers drop it. If there is, an attacker\n+    // can isolate a node and/or try to split the network.\n+    // Dropping a node for sending stuff that is invalid\n+    // now but might be valid in a later version is also\n+    // dangerous, because it can cause a network split\n+    // between nodes running old code and nodes running\n+    // new code.\n+    ~BanMan();\n+    BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n+    void Ban(const CNetAddr& netAddr, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void Ban(const CSubNet& subNet, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void ClearBanned(); // needed for unit testing\n+    bool IsBanned(CNetAddr ip);\n+    bool IsBanned(CSubNet subnet);\n+    bool Unban(const CNetAddr &ip);\n+    bool Unban(const CSubNet &ip);\n+    void GetBanned(banmap_t &banmap);\n+    void DumpBanlist();\n+\n+private:\n+    void SetBanned(const banmap_t &banmap);\n+    bool BannedSetIsDirty();\n+    //!set the \"dirty\" flag for the banlist\n+    void SetBannedSetDirty(bool dirty=true);\n+    //!clean unused entries (if bantime has expired)\n+    void SweepBanned();\n+\n+    banmap_t m_banned;\n+    CCriticalSection m_cs_banned;\n+    bool m_is_dirty;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143287393",
      "id" : 143287393,
      "in_reply_to_id" : 143107886,
      "original_commit_id" : "a006ca20f20b776038e8562000ec8724d35ce607",
      "original_position" : 58,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 67784203,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457",
      "updated_at" : "2017-10-06T22:01:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143287393",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143291015"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143291015"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, good point. Will fix.",
      "commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "created_at" : "2017-10-06T20:48:15Z",
      "diff_hunk" : "@@ -541,7 +541,13 @@ UniValue setban(const JSONRPCRequest& request)\n         if (request.params[3].isTrue())\n             absolute = true;\n \n-        isSubnet ? g_connman->Ban(subNet, BanReasonManuallyAdded, banTime, absolute) : g_connman->Ban(netAddr, BanReasonManuallyAdded, banTime, absolute);\n+        if (isSubnet) {\n+            g_connman->DisconnectNode(subNet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143291015",
      "id" : 143291015,
      "in_reply_to_id" : 143282072,
      "original_commit_id" : "ac90cbc5c1faf76b9e9e2cb35c5b77319e10d146",
      "original_position" : 6,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 67788874,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457",
      "updated_at" : "2017-10-06T22:01:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143291015",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143301192"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143301192"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```c++\r\n#endif // BITCOIN_BANMAN_H\r\n```",
      "commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "created_at" : "2017-10-06T21:47:03Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_BANMAN_H\n+#define BITCOIN_BANMAN_H\n+\n+#include \"addrdb.h\"\n+#include \"fs.h\"\n+#include \"sync.h\"\n+\n+// NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n+static const unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24;  // Default 24-hour ban\n+\n+class CClientUIInterface;\n+class CNetAddr;\n+class CSubNet;\n+\n+class BanMan\n+{\n+public:\n+    // Denial-of-service detection/prevention\n+    // The idea is to detect peers that are behaving\n+    // badly and disconnect/ban them, but do it in a\n+    // one-coding-mistake-won't-shatter-the-entire-network\n+    // way.\n+    // IMPORTANT:  There should be nothing I can give a\n+    // node that it will forward on that will make that\n+    // node's peers drop it. If there is, an attacker\n+    // can isolate a node and/or try to split the network.\n+    // Dropping a node for sending stuff that is invalid\n+    // now but might be valid in a later version is also\n+    // dangerous, because it can cause a network split\n+    // between nodes running old code and nodes running\n+    // new code.\n+    ~BanMan();\n+    BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n+    void Ban(const CNetAddr& netAddr, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void Ban(const CSubNet& subNet, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void ClearBanned(); // needed for unit testing\n+    bool IsBanned(CNetAddr ip);\n+    bool IsBanned(CSubNet subnet);\n+    bool Unban(const CNetAddr &ip);\n+    bool Unban(const CSubNet &ip);\n+    void GetBanned(banmap_t &banmap);\n+    void DumpBanlist();\n+\n+private:\n+    void SetBanned(const banmap_t &banmap);\n+    bool BannedSetIsDirty();\n+    //!set the \"dirty\" flag for the banlist\n+    void SetBannedSetDirty(bool dirty=true);\n+    //!clean unused entries (if bantime has expired)\n+    void SweepBanned();\n+\n+    banmap_t m_banned;\n+    CCriticalSection m_cs_banned;\n+    bool m_is_dirty;\n+    CClientUIInterface* m_client_interface = nullptr;\n+    CBanDB m_ban_db;\n+    int64_t m_default_ban_time;\n+};\n+\n+extern std::unique_ptr<BanMan> g_banman;\n+#endif",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143301192",
      "id" : 143301192,
      "original_commit_id" : "a006ca20f20b776038e8562000ec8724d35ce607",
      "original_position" : 65,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 67801007,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457",
      "updated_at" : "2017-10-06T22:14:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143301192",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143301475"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143301475"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Use `std::make_unique`.",
      "commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "created_at" : "2017-10-06T21:49:13Z",
      "diff_hunk" : "@@ -1267,11 +1273,13 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n     // is not yet setup and may end up being set up twice if we\n     // need to reindex later.\n \n+    assert(!g_banman);\n+    g_banman = std::unique_ptr<BanMan>(new BanMan(GetDataDir() / \"banlist.dat\", &uiInterface, DEFAULT_MISBEHAVING_BANTIME));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143301475",
      "id" : 143301475,
      "original_commit_id" : "a006ca20f20b776038e8562000ec8724d35ce607",
      "original_position" : 34,
      "path" : "src/init.cpp",
      "position" : 34,
      "pull_request_review_id" : 67801007,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457",
      "updated_at" : "2017-10-06T22:14:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143301475",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143304316"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143304316"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Inverting opens another dumb case: ban -> (unban -> connect) -> disconnect Ã°ÂÂÂ Do you think `DisconnectNode()` should be called inside `Ban()` while the lock is held?",
      "commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "created_at" : "2017-10-06T22:09:14Z",
      "diff_hunk" : "@@ -541,7 +541,13 @@ UniValue setban(const JSONRPCRequest& request)\n         if (request.params[3].isTrue())\n             absolute = true;\n \n-        isSubnet ? g_connman->Ban(subNet, BanReasonManuallyAdded, banTime, absolute) : g_connman->Ban(netAddr, BanReasonManuallyAdded, banTime, absolute);\n+        if (isSubnet) {\n+            g_connman->DisconnectNode(subNet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143304316",
      "id" : 143304316,
      "in_reply_to_id" : 143282072,
      "original_commit_id" : "ac90cbc5c1faf76b9e9e2cb35c5b77319e10d146",
      "original_position" : 6,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 67801007,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457",
      "updated_at" : "2017-10-06T22:14:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143304316",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143304477"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143304477"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Use `std::make_unique`.",
      "commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "created_at" : "2017-10-06T22:10:28Z",
      "diff_hunk" : "@@ -44,6 +44,8 @@ BOOST_FIXTURE_TEST_SUITE(DoS_tests, TestingSetup)\n \n BOOST_AUTO_TEST_CASE(DoS_banning)\n {\n+    auto connman = std::unique_ptr<CConnman>(new CConnman(0x1337, 0x1337));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143304477",
      "id" : 143304477,
      "original_commit_id" : "027b8d391812740ed2c77b995d91ea7a9ba14340",
      "original_position" : 4,
      "path" : "src/test/DoS_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 67801007,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457",
      "updated_at" : "2017-10-06T22:14:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143304477",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143306698"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143306698"
         }
      },
      "author_association" : "MEMBER",
      "body" : "that's c++14 :(",
      "commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "created_at" : "2017-10-06T22:28:36Z",
      "diff_hunk" : "@@ -1267,11 +1273,13 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n     // is not yet setup and may end up being set up twice if we\n     // need to reindex later.\n \n+    assert(!g_banman);\n+    g_banman = std::unique_ptr<BanMan>(new BanMan(GetDataDir() / \"banlist.dat\", &uiInterface, DEFAULT_MISBEHAVING_BANTIME));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143306698",
      "id" : 143306698,
      "in_reply_to_id" : 143301475,
      "original_commit_id" : "a006ca20f20b776038e8562000ec8724d35ce607",
      "original_position" : 34,
      "path" : "src/init.cpp",
      "position" : 34,
      "pull_request_review_id" : 67807542,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457",
      "updated_at" : "2017-10-06T22:28:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143306698",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143308982"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143308982"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't see how this could reasonably happen. Anyway, it's not a departure from the current behavior.",
      "commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "created_at" : "2017-10-06T22:50:58Z",
      "diff_hunk" : "@@ -541,7 +541,13 @@ UniValue setban(const JSONRPCRequest& request)\n         if (request.params[3].isTrue())\n             absolute = true;\n \n-        isSubnet ? g_connman->Ban(subNet, BanReasonManuallyAdded, banTime, absolute) : g_connman->Ban(netAddr, BanReasonManuallyAdded, banTime, absolute);\n+        if (isSubnet) {\n+            g_connman->DisconnectNode(subNet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143308982",
      "id" : 143308982,
      "in_reply_to_id" : 143282072,
      "original_commit_id" : "ac90cbc5c1faf76b9e9e2cb35c5b77319e10d146",
      "original_position" : 6,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 67810130,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457",
      "updated_at" : "2017-10-06T22:50:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143308982",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Nice!\r\nConcept ACK,.. will review soon.",
      "created_at" : "2017-10-07T04:28:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#issuecomment-334909625",
      "id" : 334909625,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11457",
      "updated_at" : "2017-10-07T04:28:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334909625",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143327303"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143327303"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would it make sense to move `ClearBanned()` to a subclass that's only used by the test suite?",
      "commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "created_at" : "2017-10-07T09:50:54Z",
      "diff_hunk" : "@@ -0,0 +1,66 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_BANMAN_H\n+#define BITCOIN_BANMAN_H\n+\n+#include \"addrdb.h\"\n+#include \"fs.h\"\n+#include \"sync.h\"\n+\n+// NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n+static const unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24;  // Default 24-hour ban\n+\n+class CClientUIInterface;\n+class CNetAddr;\n+class CSubNet;\n+\n+// Denial-of-service detection/prevention\n+// The idea is to detect peers that are behaving\n+// badly and disconnect/ban them, but do it in a\n+// one-coding-mistake-won't-shatter-the-entire-network\n+// way.\n+// IMPORTANT:  There should be nothing I can give a\n+// node that it will forward on that will make that\n+// node's peers drop it. If there is, an attacker\n+// can isolate a node and/or try to split the network.\n+// Dropping a node for sending stuff that is invalid\n+// now but might be valid in a later version is also\n+// dangerous, because it can cause a network split\n+// between nodes running old code and nodes running\n+// new code.\n+\n+class BanMan\n+{\n+public:\n+    ~BanMan();\n+    BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n+    void Ban(const CNetAddr& netAddr, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void Ban(const CSubNet& subNet, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void ClearBanned(); // needed for unit testing",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143327303",
      "id" : 143327303,
      "original_commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "original_position" : 41,
      "path" : "src/banman.h",
      "position" : 41,
      "pull_request_review_id" : 67829712,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457",
      "updated_at" : "2017-10-07T09:50:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143327303",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143557085"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143557085"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "A substitute for C++14 `std::make_unique` in the form of `MakeUnique` is added to `util.h` as part of #11043 (see https://github.com/bitcoin/bitcoin/pull/11043/commits/27a54eacc07325e9a10cbea71ab03d87a96679b7) which will hopefully be merged soon :-)",
      "commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "created_at" : "2017-10-09T19:29:26Z",
      "diff_hunk" : "@@ -1267,11 +1273,13 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n     // is not yet setup and may end up being set up twice if we\n     // need to reindex later.\n \n+    assert(!g_banman);\n+    g_banman = std::unique_ptr<BanMan>(new BanMan(GetDataDir() / \"banlist.dat\", &uiInterface, DEFAULT_MISBEHAVING_BANTIME));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143557085",
      "id" : 143557085,
      "in_reply_to_id" : 143301475,
      "original_commit_id" : "a006ca20f20b776038e8562000ec8724d35ce607",
      "original_position" : 34,
      "path" : "src/init.cpp",
      "position" : 34,
      "pull_request_review_id" : 68085079,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457",
      "updated_at" : "2017-10-09T19:29:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143557085",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143563808"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143563808"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is a misleading comment that needs to be dropped. This is used by the ```clearbanned``` rpc as well.",
      "commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "created_at" : "2017-10-09T20:01:13Z",
      "diff_hunk" : "@@ -0,0 +1,66 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2017 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_BANMAN_H\n+#define BITCOIN_BANMAN_H\n+\n+#include \"addrdb.h\"\n+#include \"fs.h\"\n+#include \"sync.h\"\n+\n+// NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n+static const unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24;  // Default 24-hour ban\n+\n+class CClientUIInterface;\n+class CNetAddr;\n+class CSubNet;\n+\n+// Denial-of-service detection/prevention\n+// The idea is to detect peers that are behaving\n+// badly and disconnect/ban them, but do it in a\n+// one-coding-mistake-won't-shatter-the-entire-network\n+// way.\n+// IMPORTANT:  There should be nothing I can give a\n+// node that it will forward on that will make that\n+// node's peers drop it. If there is, an attacker\n+// can isolate a node and/or try to split the network.\n+// Dropping a node for sending stuff that is invalid\n+// now but might be valid in a later version is also\n+// dangerous, because it can cause a network split\n+// between nodes running old code and nodes running\n+// new code.\n+\n+class BanMan\n+{\n+public:\n+    ~BanMan();\n+    BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n+    void Ban(const CNetAddr& netAddr, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void Ban(const CSubNet& subNet, const BanReason& reason, int64_t bantimeoffset = 0, bool sinceUnixEpoch = false);\n+    void ClearBanned(); // needed for unit testing",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11457#discussion_r143563808",
      "id" : 143563808,
      "in_reply_to_id" : 143327303,
      "original_commit_id" : "7a574787c889a26d03af70a493210da5087935c7",
      "original_position" : 41,
      "path" : "src/banman.h",
      "position" : 41,
      "pull_request_review_id" : 68092372,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11457",
      "updated_at" : "2017-10-09T20:01:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143563808",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   }
]
