[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "As said in https://github.com/bitcoin/bitcoin/pull/11466#discussion_r143429735, a different interface is:\r\n```json\r\n{\r\n  \"wallets\": [\r\n    { \"name\": \"foo\", \"loaded\": true },\r\n    { \"name\": \"bar\", \"loaded\": false }\r\n  ]\r\n}\r\n```\r\nWhich has the advantage of allowing to add new attributes later.\r\n\r\nAnother option is to have a different RPC. So:\r\n - `listwallets` - returns a lists of active/loaded wallets\r\n - `findwallets` - returns a list of all possible/available wallets.\r\n\r\nThis has the advantage that each RPC has it's own purpose and implementation, which happen to be very different. For those that manage (keep record of) the wallets externally `findwallets` is of no interest, only `listwallets`.",
      "created_at" : "2017-10-11T13:40:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#issuecomment-335813034",
      "id" : 335813034,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11485",
      "updated_at" : "2017-10-11T13:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/335813034",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "concept ACK splitting this from #11466. And concept ACK using the BDB magic bytes rather than filename",
      "created_at" : "2017-10-11T14:14:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#issuecomment-335824684",
      "id" : 335824684,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11485",
      "updated_at" : "2017-10-11T14:14:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/335824684",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Removed WIP, now uses BDB magic bytes, although I haven't confirmed that this works on big endian or also potentially on old versions of BDB wallets if the magic bytes changed",
      "created_at" : "2017-10-13T09:10:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#issuecomment-336396297",
      "id" : 336396297,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11485",
      "updated_at" : "2017-10-13T09:11:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/336396297",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r144658805"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144658805"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please explicitly use `fs::is_regular_file()` (this only compiles because of Argument Dependant Lookups http://en.cppreference.com/w/cpp/language/adl which makes it difficult to understand where this function is coming from).\r\n\r\n`boost::filesystem::is_regular_file()` will return true if called on a symlink to a regular file. We don't want those to show up in the available list since they can't be loaded as a wallet, so you should extend this if test with `fs::is_symlink()`.",
      "commit_id" : "946b2ceb1a8c6702fc3412b63f42439bedbafe0c",
      "created_at" : "2017-10-13T21:17:01Z",
      "diff_hunk" : "@@ -2645,10 +2645,26 @@ UniValue listwallets(const JSONRPCRequest& request)\n \n         LOCK(pwallet->cs_wallet);\n \n-        obj.push_back(pwallet->GetName());\n+        loaded.push_back(pwallet->GetName());\n     }\n \n-    return obj;\n+    UniValue available(UniValue::VARR);\n+    fs::path walletdir = GetDataDir();\n+    const unsigned char bdb_magic[4] = {0x62, 0x31, 0x05, 0x00}; // Berkeley DB Btree magic bytes\n+    for (fs::directory_iterator it(walletdir); it != fs::directory_iterator(); ++it) {\n+        std::ifstream file(it->path().string(), std::ios::binary);\n+        file.seekg(12, std::ios::beg); // Magic bytes start at offset 12\n+        unsigned char fileBytes[4] = {0};\n+        file.read((char*)fileBytes, sizeof(fileBytes)); // Read 4 bytes of file to compare against magic\n+        if (is_regular_file(*it) && file.is_open() && memcmp(fileBytes, bdb_magic, sizeof(bdb_magic)) == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r144658805",
      "id" : 144658805,
      "original_commit_id" : "0e961a28a90f0149d8f885f3f74aa2c905e88e45",
      "original_position" : 39,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 69352878,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485",
      "updated_at" : "2017-11-29T00:17:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144658805",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I also tested manually that files show up as wallets when bytes 12-15 match the magic bdb bytes:\r\n\r\n```\r\nÃ¢ÂÂ bitcoin-cli listwallets\r\n{\r\n  \"loaded\": [\r\n    \"wallet.dat\"\r\n  ],\r\n  \"available\": [\r\n    \"wallet.dat\"\r\n  ]\r\n}\r\n[ubuntu] /home/ubuntu/.bitcoin/regtest\r\nÃ¢ÂÂ bitcoin-cli stop\r\nBitcoin server stopping\r\n[ubuntu] /home/ubuntu/.bitcoin/regtest\r\nÃ¢ÂÂ for i in {1..20}; do head wallet.dat -c $i > wallet_prefix_$i; done\r\n[ubuntu] /home/ubuntu/.bitcoin/regtest\r\nÃ¢ÂÂ bitcoind\r\nBitcoin server starting\r\n[ubuntu] /home/ubuntu/.bitcoin/regtest\r\nÃ¢ÂÂ bitcoin-cli listwallets\r\n{\r\n  \"loaded\": [\r\n    \"wallet.dat\"\r\n  ],\r\n  \"available\": [\r\n    \"wallet_prefix_20\",\r\n    \"wallet_prefix_19\",\r\n    \"wallet.dat\",\r\n    \"wallet_prefix_16\",\r\n    \"wallet_prefix_17\",\r\n    \"wallet_prefix_15\",\r\n    \"wallet_prefix_18\"\r\n  ]\r\n}\r\n```",
      "created_at" : "2017-10-13T21:34:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#issuecomment-336573123",
      "id" : 336573123,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11485",
      "updated_at" : "2017-10-13T21:34:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/336573123",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Addressed @jnewbery nits and made available list mutually exclusive to loaded list. Thanks for the review :-)",
      "created_at" : "2017-10-13T22:27:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#issuecomment-336582040",
      "id" : 336582040,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11485",
      "updated_at" : "2017-10-13T22:27:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/336582040",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r144670799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144670799"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Suggestion to remove loop below:\r\n```cpp\r\nstd::set<std::string> loaded_set;\r\n...\r\n    loaded.push_back(pwallet->GetName());\r\n    loaded_set.insert(pwallet->GetName())\r\n}\r\n...\r\nif (loaded_set.count(it->path().filename().string()) == 0) {\r\n    available.push_back(it->path().filename().string());\r\n}\r\n```",
      "commit_id" : "946b2ceb1a8c6702fc3412b63f42439bedbafe0c",
      "created_at" : "2017-10-13T22:40:40Z",
      "diff_hunk" : "@@ -2645,10 +2645,38 @@ UniValue listwallets(const JSONRPCRequest& request)\n \n         LOCK(pwallet->cs_wallet);\n \n-        obj.push_back(pwallet->GetName());\n+        loaded.push_back(pwallet->GetName());\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r144670799",
      "id" : 144670799,
      "original_commit_id" : "8f2df4ae01fd0908045082ce2a84a797309a56b4",
      "original_position" : 28,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 69366512,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485",
      "updated_at" : "2017-11-29T00:17:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144670799",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Good idea @promag, thanks :-)",
      "created_at" : "2017-10-13T22:54:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#issuecomment-336585784",
      "id" : 336585784,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11485",
      "updated_at" : "2017-10-13T22:54:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/336585784",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r146119173"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/146119173"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Some of these conditions can be moved before seekg (just `continue`. Only the compare is needed.\r\n\r\nCould use 64 bit int instead?",
      "commit_id" : "946b2ceb1a8c6702fc3412b63f42439bedbafe0c",
      "created_at" : "2017-10-22T00:59:14Z",
      "diff_hunk" : "@@ -2645,10 +2646,33 @@ UniValue listwallets(const JSONRPCRequest& request)\n \n         LOCK(pwallet->cs_wallet);\n \n-        obj.push_back(pwallet->GetName());\n+        loaded.push_back(pwallet->GetName());\n+        loaded_set.insert(pwallet->GetName());\n     }\n \n-    return obj;\n+    UniValue available(UniValue::VARR);\n+    fs::path walletdir = GetDataDir();\n+    const unsigned char bdb_magic[4] = {0x62, 0x31, 0x05, 0x00}; // Berkeley DB Btree magic bytes\n+\n+    for (fs::directory_iterator it(walletdir); it != fs::directory_iterator(); ++it) {\n+        std::ifstream file(it->path().string(), std::ios::binary);\n+        file.seekg(12, std::ios::beg); // Magic bytes start at offset 12\n+        unsigned char fileBytes[4] = {0};\n+\n+        file.read((char*)fileBytes, sizeof(fileBytes)); // Read 4 bytes of file to compare against magic\n+\n+        if (fs::is_regular_file(*it) && !fs::is_symlink(*it) && file.is_open() && memcmp(fileBytes, bdb_magic, sizeof(bdb_magic)) == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r146119173",
      "id" : 146119173,
      "original_commit_id" : "95e108b17fdb94e7d45b9585492aed83682915c8",
      "original_position" : 44,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 71020843,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485",
      "updated_at" : "2017-11-29T00:17:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/146119173",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r146120578"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/146120578"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed the conditional, but IMO the char array is clearer and perhaps safer than using an int :)",
      "commit_id" : "946b2ceb1a8c6702fc3412b63f42439bedbafe0c",
      "created_at" : "2017-10-22T02:43:02Z",
      "diff_hunk" : "@@ -2645,10 +2646,33 @@ UniValue listwallets(const JSONRPCRequest& request)\n \n         LOCK(pwallet->cs_wallet);\n \n-        obj.push_back(pwallet->GetName());\n+        loaded.push_back(pwallet->GetName());\n+        loaded_set.insert(pwallet->GetName());\n     }\n \n-    return obj;\n+    UniValue available(UniValue::VARR);\n+    fs::path walletdir = GetDataDir();\n+    const unsigned char bdb_magic[4] = {0x62, 0x31, 0x05, 0x00}; // Berkeley DB Btree magic bytes\n+\n+    for (fs::directory_iterator it(walletdir); it != fs::directory_iterator(); ++it) {\n+        std::ifstream file(it->path().string(), std::ios::binary);\n+        file.seekg(12, std::ios::beg); // Magic bytes start at offset 12\n+        unsigned char fileBytes[4] = {0};\n+\n+        file.read((char*)fileBytes, sizeof(fileBytes)); // Read 4 bytes of file to compare against magic\n+\n+        if (fs::is_regular_file(*it) && !fs::is_symlink(*it) && file.is_open() && memcmp(fileBytes, bdb_magic, sizeof(bdb_magic)) == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r146120578",
      "id" : 146120578,
      "in_reply_to_id" : 146119173,
      "original_commit_id" : "95e108b17fdb94e7d45b9585492aed83682915c8",
      "original_position" : 44,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 71022212,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485",
      "updated_at" : "2017-11-29T00:17:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/146120578",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on master to fix travis failure due to multiwallet.py being modified",
      "created_at" : "2017-10-22T06:41:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#issuecomment-338455742",
      "id" : 338455742,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11485",
      "updated_at" : "2017-10-22T06:41:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/338455742",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r146391990"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/146391990"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Remove, see https://stackoverflow.com/a/748059.",
      "commit_id" : "946b2ceb1a8c6702fc3412b63f42439bedbafe0c",
      "created_at" : "2017-10-23T20:58:24Z",
      "diff_hunk" : "@@ -2645,10 +2646,39 @@ UniValue listwallets(const JSONRPCRequest& request)\n \n         LOCK(pwallet->cs_wallet);\n \n-        obj.push_back(pwallet->GetName());\n+        loaded.push_back(pwallet->GetName());\n+        loaded_set.insert(pwallet->GetName());\n     }\n \n-    return obj;\n+    UniValue available(UniValue::VARR);\n+    fs::path walletdir = GetDataDir();\n+    const unsigned char bdb_magic[4] = {0x62, 0x31, 0x05, 0x00}; // Berkeley DB Btree magic bytes\n+\n+    for (fs::directory_iterator it(walletdir); it != fs::directory_iterator(); ++it) {\n+\n+        if(!fs::is_regular_file(*it) || fs::is_symlink(*it)) continue;\n+\n+        std::ifstream file(it->path().string(), std::ios::binary);\n+        if(!file.is_open()) continue;\n+\n+        file.seekg(12, std::ios::beg); // Magic bytes start at offset 12\n+        unsigned char fileBytes[4] = {0};\n+        file.read((char*)fileBytes, sizeof(fileBytes)); // Read 4 bytes of file to compare against magic\n+\n+        if (memcmp(fileBytes, bdb_magic, sizeof(bdb_magic)) == 0) {\n+            // check if this wallet is already loaded\n+            if (loaded_set.count(it->path().filename().string()) == 0) {\n+                available.push_back(it->path().filename().string());\n+            }\n+        }\n+\n+        file.close();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r146391990",
      "id" : 146391990,
      "original_commit_id" : "da994d87ad39690547ac6afbf96c1395b334050c",
      "original_position" : 55,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 71327648,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485",
      "updated_at" : "2017-11-29T00:17:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/146391990",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r146393023"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/146393023"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Alternative, avoid nesting:\r\n```cpp\r\nif (memcmp(...) != 0) continue;\r\n\r\nif (loaded_set.count(filename) > 0) continue;\r\n\r\navailable.push_back(filename);\r\n```\r\nNote that close is automatically called, see comment below.",
      "commit_id" : "946b2ceb1a8c6702fc3412b63f42439bedbafe0c",
      "created_at" : "2017-10-23T21:02:20Z",
      "diff_hunk" : "@@ -2645,10 +2646,39 @@ UniValue listwallets(const JSONRPCRequest& request)\n \n         LOCK(pwallet->cs_wallet);\n \n-        obj.push_back(pwallet->GetName());\n+        loaded.push_back(pwallet->GetName());\n+        loaded_set.insert(pwallet->GetName());\n     }\n \n-    return obj;\n+    UniValue available(UniValue::VARR);\n+    fs::path walletdir = GetDataDir();\n+    const unsigned char bdb_magic[4] = {0x62, 0x31, 0x05, 0x00}; // Berkeley DB Btree magic bytes\n+\n+    for (fs::directory_iterator it(walletdir); it != fs::directory_iterator(); ++it) {\n+\n+        if(!fs::is_regular_file(*it) || fs::is_symlink(*it)) continue;\n+\n+        std::ifstream file(it->path().string(), std::ios::binary);\n+        if(!file.is_open()) continue;\n+\n+        file.seekg(12, std::ios::beg); // Magic bytes start at offset 12\n+        unsigned char fileBytes[4] = {0};\n+        file.read((char*)fileBytes, sizeof(fileBytes)); // Read 4 bytes of file to compare against magic\n+\n+        if (memcmp(fileBytes, bdb_magic, sizeof(bdb_magic)) == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r146393023",
      "id" : 146393023,
      "original_commit_id" : "da994d87ad39690547ac6afbf96c1395b334050c",
      "original_position" : 48,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 71327648,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485",
      "updated_at" : "2017-11-29T00:17:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/146393023",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r146393393"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/146393393"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit, add:\r\n```cpp\r\nconst std::string filename = it->path().filename().string();\r\n```",
      "commit_id" : "946b2ceb1a8c6702fc3412b63f42439bedbafe0c",
      "created_at" : "2017-10-23T21:03:49Z",
      "diff_hunk" : "@@ -2645,10 +2646,39 @@ UniValue listwallets(const JSONRPCRequest& request)\n \n         LOCK(pwallet->cs_wallet);\n \n-        obj.push_back(pwallet->GetName());\n+        loaded.push_back(pwallet->GetName());\n+        loaded_set.insert(pwallet->GetName());\n     }\n \n-    return obj;\n+    UniValue available(UniValue::VARR);\n+    fs::path walletdir = GetDataDir();\n+    const unsigned char bdb_magic[4] = {0x62, 0x31, 0x05, 0x00}; // Berkeley DB Btree magic bytes\n+\n+    for (fs::directory_iterator it(walletdir); it != fs::directory_iterator(); ++it) {\n+\n+        if(!fs::is_regular_file(*it) || fs::is_symlink(*it)) continue;\n+\n+        std::ifstream file(it->path().string(), std::ios::binary);\n+        if(!file.is_open()) continue;\n+\n+        file.seekg(12, std::ios::beg); // Magic bytes start at offset 12\n+        unsigned char fileBytes[4] = {0};\n+        file.read((char*)fileBytes, sizeof(fileBytes)); // Read 4 bytes of file to compare against magic\n+\n+        if (memcmp(fileBytes, bdb_magic, sizeof(bdb_magic)) == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r146393393",
      "id" : 146393393,
      "in_reply_to_id" : 146393023,
      "original_commit_id" : "da994d87ad39690547ac6afbf96c1395b334050c",
      "original_position" : 48,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 71327648,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485",
      "updated_at" : "2017-11-29T00:17:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/146393393",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r146393611"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/146393611"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: `file_bytes`.",
      "commit_id" : "946b2ceb1a8c6702fc3412b63f42439bedbafe0c",
      "created_at" : "2017-10-23T21:04:47Z",
      "diff_hunk" : "@@ -2645,10 +2646,39 @@ UniValue listwallets(const JSONRPCRequest& request)\n \n         LOCK(pwallet->cs_wallet);\n \n-        obj.push_back(pwallet->GetName());\n+        loaded.push_back(pwallet->GetName());\n+        loaded_set.insert(pwallet->GetName());\n     }\n \n-    return obj;\n+    UniValue available(UniValue::VARR);\n+    fs::path walletdir = GetDataDir();\n+    const unsigned char bdb_magic[4] = {0x62, 0x31, 0x05, 0x00}; // Berkeley DB Btree magic bytes\n+\n+    for (fs::directory_iterator it(walletdir); it != fs::directory_iterator(); ++it) {\n+\n+        if(!fs::is_regular_file(*it) || fs::is_symlink(*it)) continue;\n+\n+        std::ifstream file(it->path().string(), std::ios::binary);\n+        if(!file.is_open()) continue;\n+\n+        file.seekg(12, std::ios::beg); // Magic bytes start at offset 12\n+        unsigned char fileBytes[4] = {0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r146393611",
      "id" : 146393611,
      "original_commit_id" : "da994d87ad39690547ac6afbf96c1395b334050c",
      "original_position" : 45,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 71327648,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485",
      "updated_at" : "2017-11-29T00:17:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/146393611",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r146393661"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/146393661"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit, remove empty line.",
      "commit_id" : "946b2ceb1a8c6702fc3412b63f42439bedbafe0c",
      "created_at" : "2017-10-23T21:04:57Z",
      "diff_hunk" : "@@ -2645,10 +2646,39 @@ UniValue listwallets(const JSONRPCRequest& request)\n \n         LOCK(pwallet->cs_wallet);\n \n-        obj.push_back(pwallet->GetName());\n+        loaded.push_back(pwallet->GetName());\n+        loaded_set.insert(pwallet->GetName());\n     }\n \n-    return obj;\n+    UniValue available(UniValue::VARR);\n+    fs::path walletdir = GetDataDir();\n+    const unsigned char bdb_magic[4] = {0x62, 0x31, 0x05, 0x00}; // Berkeley DB Btree magic bytes\n+\n+    for (fs::directory_iterator it(walletdir); it != fs::directory_iterator(); ++it) {\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r146393661",
      "id" : 146393661,
      "original_commit_id" : "da994d87ad39690547ac6afbf96c1395b334050c",
      "original_position" : 38,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 71327648,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485",
      "updated_at" : "2017-11-29T00:17:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/146393661",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r146394843"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/146394843"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Assert available is empty array?",
      "commit_id" : "946b2ceb1a8c6702fc3412b63f42439bedbafe0c",
      "created_at" : "2017-10-23T21:10:03Z",
      "diff_hunk" : "@@ -19,7 +19,7 @@ def set_test_params(self):\n         self.extra_args = [['-wallet=w1', '-wallet=w2', '-wallet=w3']]\n \n     def run_test(self):\n-        assert_equal(set(self.nodes[0].listwallets()), {\"w1\", \"w2\", \"w3\"})\n+        assert_equal(set(self.nodes[0].listwallets()['loaded']), {\"w1\", \"w2\", \"w3\"})\n ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r146394843",
      "id" : 146394843,
      "original_commit_id" : "da994d87ad39690547ac6afbf96c1395b334050c",
      "original_position" : 6,
      "path" : "test/functional/multiwallet.py",
      "position" : null,
      "pull_request_review_id" : 71327648,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485",
      "updated_at" : "2017-11-29T00:17:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/146394843",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fixed @promag's nits, thanks :)\r\n\r\nBTW it would be good to have #11466 reviewed first because this is only really useful with that IMO",
      "created_at" : "2017-10-24T00:31:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#issuecomment-338835360",
      "id" : 338835360,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11485",
      "updated_at" : "2017-10-24T00:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/338835360",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and updated to work with new wallets directory from #11466 ",
      "created_at" : "2017-11-19T02:49:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#issuecomment-345487647",
      "id" : 345487647,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11485",
      "updated_at" : "2017-11-19T02:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345487647",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Needs rebase, but I assume this won't work after  #11687 anyway?",
      "created_at" : "2017-11-27T16:55:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#issuecomment-347246631",
      "id" : 347246631,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11485",
      "updated_at" : "2017-11-27T16:55:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347246631",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> Needs rebase, but I assume this won't work afterÃÂ #11687ÃÂ anyway?\r\n\r\nIt won't work if someone uses external wallets, but it should still work if they have all wallets in the wallet directory? (which is the default)",
      "created_at" : "2017-11-28T08:10:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#issuecomment-347445120",
      "id" : 347445120,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11485",
      "updated_at" : "2017-11-28T08:10:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347445120",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've rebased. If https://github.com/bitcoin/bitcoin/pull/11687 defaults to creating directories for each wallet rather than individual BDB files, then this may need to be modified to list directories as well as BDB files? But yes should still work",
      "created_at" : "2017-11-29T00:21:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#issuecomment-347709994",
      "id" : 347709994,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11485",
      "updated_at" : "2017-11-29T00:21:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347709994",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r153889026"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153889026"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I like this new test, but I think it can be improved in a couple of ways:\r\n\r\n- test that a non-empty file without the magic bytes is excluded\r\n- there's an implicit assumption that the symlink and folder created earlier in the test are still around. You could explicitly assert that. If the earlier parts of this test get change, eg the file names are changed, then this check will continue to succeed but won't be testing anything.\r\n\r\nWhat do you think about:\r\n\r\n```\r\n--- a/test/functional/multiwallet.py\r\n+++ b/test/functional/multiwallet.py\r\n@@ -65,8 +65,20 @@ class MultiWalletTest(BitcoinTestFramework):\r\n         self.start_node(0, self.extra_args[0])\r\n \r\n         # ensure listwallets only names BDB files, not symlinks, other files or directories\r\n-        open(os.path.join(wallet_dir, 'w01.dat'), 'a').close()\r\n-        assert_equal(set(self.nodes[0].listwallets()['available']), {\"w22\"})\r\n+        with open(os.path.join(wallet_dir, 'w01.dat'), 'a') as wallet_file:\r\n+            # Create a file containing a long string\r\n+            print(\"a\" * 2000, file=wallet_file)\r\n+\r\n+        available_wallets = self.nodes[0].listwallets()['available']\r\n+\r\n+        assert os.path.islink(os.path.join(wallet_dir, 'w12'))\r\n+        assert 'w12' not in available_wallets\r\n+\r\n+        assert os.path.isdir(os.path.join(wallet_dir, 'w11'))\r\n+        assert 'w11' not in available_wallets\r\n+\r\n+        assert os.path.isfile(os.path.join(wallet_dir, 'w01.dat'))\r\n+        assert 'w01.dat' not in available_wallets\r\n```",
      "commit_id" : "946b2ceb1a8c6702fc3412b63f42439bedbafe0c",
      "created_at" : "2017-11-29T19:21:54Z",
      "diff_hunk" : "@@ -63,6 +64,10 @@ def run_test(self):\n \n         self.start_node(0, self.extra_args[0])\n \n+        # ensure listwallets only names BDB files, not symlinks, other files or directories",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11485#discussion_r153889026",
      "id" : 153889026,
      "original_commit_id" : "946b2ceb1a8c6702fc3412b63f42439bedbafe0c",
      "original_position" : 32,
      "path" : "test/functional/multiwallet.py",
      "position" : 32,
      "pull_request_review_id" : 79966380,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11485",
      "updated_at" : "2017-11-29T19:22:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153889026",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
