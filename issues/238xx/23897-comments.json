[
   {
      "author_association" : "MEMBER",
      "body" : "Rebased 154307c10b0d3c0e7dfbe463de7d040b2eb97c74 -> c4476a5ea787e3722d8c1e5fed5f0c6e2a554327 ([pr23897.01](https://github.com/hebasto/bitcoin/commits/pr23897.01) -> [pr23897.02](https://github.com/hebasto/bitcoin/commits/pr23897.02)) on top of the merged #23683.",
      "created_at" : "2022-01-03T14:47:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1004142158",
      "id" : 1004142158,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII58472f5O",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1004142158/reactions"
      },
      "updated_at" : "2022-01-03T14:47:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1004142158",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24804](https://github.com/bitcoin/bitcoin/pull/24804) (Sanity assert GetAncestor() != nullptr where appropriate by aureleoules)\n* [#24567](https://github.com/bitcoin/bitcoin/pull/24567) (Enforce BIP 68 from genesis by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-01-03T15:03:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1004152066",
      "id" : 1004152066,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII58472iUC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1004152066/reactions"
      },
      "updated_at" : "2022-04-29T19:34:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1004152066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-01-19T15:01:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1016552290",
      "id" : 1016552290,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII5848l1ti",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016552290/reactions"
      },
      "updated_at" : "2022-01-19T15:01:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016552290",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased c4476a5ea787e3722d8c1e5fed5f0c6e2a554327 -> 220475bdbca0598c6f5158e870b89ff9503a7258 ([pr23897.02](https://github.com/hebasto/bitcoin/commits/pr23897.02) -> [pr23897.03](https://github.com/hebasto/bitcoin/commits/pr23897.03)) on top of the merged #23976.",
      "created_at" : "2022-01-19T21:53:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1016901169",
      "id" : 1016901169,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII5848nK4x",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016901169/reactions"
      },
      "updated_at" : "2022-01-19T21:53:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1016901169",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r792573355"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792573355"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It would be nice to remove the raw pointers while we're changing the interface anyway. I think a better interface is to have `CalculateLockPoints()` return a `std::optional<LockPoints>` which encodes the same information as the bool.",
      "commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "created_at" : "2022-01-26T12:08:36Z",
      "diff_hunk" : "@@ -211,14 +211,75 @@ bool CheckFinalTx(const CBlockIndex* active_chain_tip, const CTransaction &tx, i\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+bool CalculateLockPoints(\n+    CBlockIndex* tip,\n+    const CCoinsView& coins_view,\n+    const CTransaction& tx,\n+    int flags,\n+    LockPoints* lp)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r792573355",
      "id" : 792573355,
      "line" : 219,
      "node_id" : "PRRC_kwDOABII584vPbWr",
      "original_commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "original_line" : 219,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 9,
      "pull_request_review_id" : 863454325,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792573355/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-26T12:20:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792573355",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r792573702"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792573702"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can be replaced with a `LogPrintf` and `return std::nullopt`. Also seems like this log could be improved by adding the transaction id and/or prevout that is missing.",
      "commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "created_at" : "2022-01-26T12:09:03Z",
      "diff_hunk" : "@@ -211,14 +211,75 @@ bool CheckFinalTx(const CBlockIndex* active_chain_tip, const CTransaction &tx, i\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+bool CalculateLockPoints(\n+    CBlockIndex* tip,\n+    const CCoinsView& coins_view,\n+    const CTransaction& tx,\n+    int flags,\n+    LockPoints* lp)\n+{\n+    assert(tip);\n+    assert(lp);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // CheckSequenceLocks() uses active_chainstate.m_chain.Height()+1 to evaluate\n+    // height based locks because when SequenceLocks() is called within\n+    // ConnectBlock(), the height of the block *being*\n+    // evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            return error(\"%s: Missing input\", __func__);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r792573702",
      "id" : 792573702,
      "line" : 240,
      "node_id" : "PRRC_kwDOABII584vPbcG",
      "original_commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "original_line" : 240,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 30,
      "pull_request_review_id" : 863454325,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792573702/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-26T12:20:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792573702",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r792574579"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792574579"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same here, would be nice to remove the raw pointer and make this parameter a `const LockPoints& lp`. It doesn't make sense to allow a nullptr `lp` to be passed in anymore, since we can't check sequence locks on empty lockpoints anyway.",
      "commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "created_at" : "2022-01-26T12:10:21Z",
      "diff_hunk" : "@@ -211,14 +211,75 @@ bool CheckFinalTx(const CBlockIndex* active_chain_tip, const CTransaction &tx, i\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+bool CalculateLockPoints(\n+    CBlockIndex* tip,\n+    const CCoinsView& coins_view,\n+    const CTransaction& tx,\n+    int flags,\n+    LockPoints* lp)\n+{\n+    assert(tip);\n+    assert(lp);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // CheckSequenceLocks() uses active_chainstate.m_chain.Height()+1 to evaluate\n+    // height based locks because when SequenceLocks() is called within\n+    // ConnectBlock(), the height of the block *being*\n+    // evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            return error(\"%s: Missing input\", __func__);\n+        }\n+        if (coin.nHeight == MEMPOOL_HEIGHT) {\n+            // Assume all mempool transaction confirm in the next block\n+            prevheights[txinIndex] = tip->nHeight + 1;\n+        } else {\n+            prevheights[txinIndex] = coin.nHeight;\n+        }\n+    }\n+\n+    const std::pair<int, int64_t> lock_pair{CalculateSequenceLocks(tx, flags, prevheights, index)};\n+    lp->height = lock_pair.first;\n+    lp->time = lock_pair.second;\n+    // Also store the hash of the block with the highest height of\n+    // all the blocks which have sequence locked prevouts.\n+    // This hash needs to still be on the chain\n+    // for these LockPoint calculations to be valid\n+    // Note: It is impossible to correctly calculate a maxInputBlock\n+    // if any of the sequence locked inputs depend on unconfirmed txs,\n+    // except in the special case where the relative lock time/height\n+    // is 0, which is equivalent to no sequence lock. Since we assume\n+    // input height of tip+1 for mempool txs and test the resulting\n+    // lock_pair from CalculateSequenceLocks against tip+1.  We know\n+    // EvaluateSequenceLocks will fail if there was a non-zero sequence\n+    // lock on a mempool input, so we can use the return value of\n+    // CheckSequenceLocks to indicate the LockPoints validity\n+    int max_input_height{0};\n+    for (const int height : prevheights) {\n+        // Can ignore mempool inputs since we'll fail if they had non-zero locks\n+        if (height != tip->nHeight + 1) {\n+            max_input_height = std::max(max_input_height, height);\n+        }\n+    }\n+    lp->maxInputBlock = tip->GetAncestor(max_input_height);\n+\n+    return true;\n+}\n+\n bool CheckSequenceLocks(CBlockIndex* tip,\n-                        const CCoinsView& coins_view,\n-                        const CTransaction& tx,\n-                        int flags,\n-                        LockPoints* lp,\n-                        bool useExistingLockPoints)\n+                        const LockPoints* lp)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r792574579",
      "id" : 792574579,
      "line" : 279,
      "node_id" : "PRRC_kwDOABII584vPbpz",
      "original_commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "original_line" : 279,
      "original_position" : 74,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 74,
      "pull_request_review_id" : 863454325,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792574579/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-26T12:20:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792574579",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r792578100"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792578100"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note that we do have a bit of a behavior change here: we now update the mempool entry LockPoints even if we're going to remove the entry later. I'm not sure if this is desirable.\r\n\r\nI suggest adding documentation as well, e.g. \"If the cached LockPoints are now invalid, recalculate them and update the mempool entry before calling `CheckSequenceLocks()`.",
      "commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "created_at" : "2022-01-26T12:15:23Z",
      "diff_hunk" : "@@ -365,18 +377,13 @@ void CChainState::MaybeUpdateMempoolForReorg(\n         LockPoints lp = it->GetLockPoints();\n         const bool validLP{TestLockPointValidity(m_chain, lp)};\n         CCoinsViewMemPool view_mempool(&CoinsTip(), *m_mempool);\n-        // CheckSequenceLocks checks if the transaction will be final in the next block to be\n-        // created on top of the new chain. We use useExistingLockPoints=false so that, instead of\n-        // using the information in lp (which might now refer to a block that no longer exists in\n-        // the chain), it will update lp to contain LockPoints relevant to the new chain.\n-        if (!CheckSequenceLocks(m_chain.Tip(), view_mempool, tx, flags, &lp, validLP)) {\n-            // If CheckSequenceLocks fails, remove the tx and don't depend on the LockPoints.\n-            return true;\n-        } else if (!validLP) {\n-            // If CheckSequenceLocks succeeded, it also updated the LockPoints.\n-            // Now update the mempool entry lockpoints as well.\n+        if (!validLP) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r792578100",
      "id" : 792578100,
      "line" : 380,
      "node_id" : "PRRC_kwDOABII584vPcg0",
      "original_commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "original_line" : 380,
      "original_position" : 153,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 153,
      "pull_request_review_id" : 863454325,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792578100/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-26T12:20:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792578100",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-03-14T16:37:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1067041024",
      "id" : 1067041024,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII584_mcEA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1067041024/reactions"
      },
      "updated_at" : "2022-03-14T16:37:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1067041024",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated 220475bdbca0598c6f5158e870b89ff9503a7258 -> aa8f68b2352dd37cae59867276b38127d7041685 ([pr23897.03](https://github.com/hebasto/bitcoin/commits/pr23897.03) -> [pr23897.04](https://github.com/hebasto/bitcoin/commits/pr23897.04)):\r\n- rebased\r\n- addressed @glozow's comments\r\n\r\n\r\nAlso the PR description has been updated.",
      "created_at" : "2022-04-19T16:06:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1102831191",
      "id" : 1102831191,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII585Bu95X",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1102831191/reactions"
      },
      "updated_at" : "2022-04-19T16:06:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1102831191",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r853248533"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853248533"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1102831191).",
      "commit_id" : "aa8f68b2352dd37cae59867276b38127d7041685",
      "created_at" : "2022-04-19T16:06:53Z",
      "diff_hunk" : "@@ -211,14 +211,75 @@ bool CheckFinalTx(const CBlockIndex* active_chain_tip, const CTransaction &tx, i\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+bool CalculateLockPoints(\n+    CBlockIndex* tip,\n+    const CCoinsView& coins_view,\n+    const CTransaction& tx,\n+    int flags,\n+    LockPoints* lp)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r853248533",
      "id" : 853248533,
      "in_reply_to_id" : 792573355,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584y24oV",
      "original_commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "original_line" : 219,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 945961661,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853248533/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-19T16:06:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853248533",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r853248890"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853248890"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1102831191).",
      "commit_id" : "aa8f68b2352dd37cae59867276b38127d7041685",
      "created_at" : "2022-04-19T16:07:12Z",
      "diff_hunk" : "@@ -211,14 +211,75 @@ bool CheckFinalTx(const CBlockIndex* active_chain_tip, const CTransaction &tx, i\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+bool CalculateLockPoints(\n+    CBlockIndex* tip,\n+    const CCoinsView& coins_view,\n+    const CTransaction& tx,\n+    int flags,\n+    LockPoints* lp)\n+{\n+    assert(tip);\n+    assert(lp);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // CheckSequenceLocks() uses active_chainstate.m_chain.Height()+1 to evaluate\n+    // height based locks because when SequenceLocks() is called within\n+    // ConnectBlock(), the height of the block *being*\n+    // evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            return error(\"%s: Missing input\", __func__);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r853248890",
      "id" : 853248890,
      "in_reply_to_id" : 792573702,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584y24t6",
      "original_commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "original_line" : 240,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 945962159,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853248890/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-19T16:07:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853248890",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r853249200"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853249200"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1102831191).",
      "commit_id" : "aa8f68b2352dd37cae59867276b38127d7041685",
      "created_at" : "2022-04-19T16:07:30Z",
      "diff_hunk" : "@@ -211,14 +211,75 @@ bool CheckFinalTx(const CBlockIndex* active_chain_tip, const CTransaction &tx, i\n     return IsFinalTx(tx, nBlockHeight, nBlockTime);\n }\n \n+bool CalculateLockPoints(\n+    CBlockIndex* tip,\n+    const CCoinsView& coins_view,\n+    const CTransaction& tx,\n+    int flags,\n+    LockPoints* lp)\n+{\n+    assert(tip);\n+    assert(lp);\n+\n+    CBlockIndex index;\n+    index.pprev = tip;\n+    // CheckSequenceLocks() uses active_chainstate.m_chain.Height()+1 to evaluate\n+    // height based locks because when SequenceLocks() is called within\n+    // ConnectBlock(), the height of the block *being*\n+    // evaluated is what is used.\n+    // Thus if we want to know if a transaction can be part of the\n+    // *next* block, we need to use one more than active_chainstate.m_chain.Height()\n+    index.nHeight = tip->nHeight + 1;\n+\n+    std::vector<int> prevheights;\n+    prevheights.resize(tx.vin.size());\n+    for (size_t txinIndex = 0; txinIndex < tx.vin.size(); ++txinIndex) {\n+        const CTxIn& txin = tx.vin[txinIndex];\n+        Coin coin;\n+        if (!coins_view.GetCoin(txin.prevout, coin)) {\n+            return error(\"%s: Missing input\", __func__);\n+        }\n+        if (coin.nHeight == MEMPOOL_HEIGHT) {\n+            // Assume all mempool transaction confirm in the next block\n+            prevheights[txinIndex] = tip->nHeight + 1;\n+        } else {\n+            prevheights[txinIndex] = coin.nHeight;\n+        }\n+    }\n+\n+    const std::pair<int, int64_t> lock_pair{CalculateSequenceLocks(tx, flags, prevheights, index)};\n+    lp->height = lock_pair.first;\n+    lp->time = lock_pair.second;\n+    // Also store the hash of the block with the highest height of\n+    // all the blocks which have sequence locked prevouts.\n+    // This hash needs to still be on the chain\n+    // for these LockPoint calculations to be valid\n+    // Note: It is impossible to correctly calculate a maxInputBlock\n+    // if any of the sequence locked inputs depend on unconfirmed txs,\n+    // except in the special case where the relative lock time/height\n+    // is 0, which is equivalent to no sequence lock. Since we assume\n+    // input height of tip+1 for mempool txs and test the resulting\n+    // lock_pair from CalculateSequenceLocks against tip+1.  We know\n+    // EvaluateSequenceLocks will fail if there was a non-zero sequence\n+    // lock on a mempool input, so we can use the return value of\n+    // CheckSequenceLocks to indicate the LockPoints validity\n+    int max_input_height{0};\n+    for (const int height : prevheights) {\n+        // Can ignore mempool inputs since we'll fail if they had non-zero locks\n+        if (height != tip->nHeight + 1) {\n+            max_input_height = std::max(max_input_height, height);\n+        }\n+    }\n+    lp->maxInputBlock = tip->GetAncestor(max_input_height);\n+\n+    return true;\n+}\n+\n bool CheckSequenceLocks(CBlockIndex* tip,\n-                        const CCoinsView& coins_view,\n-                        const CTransaction& tx,\n-                        int flags,\n-                        LockPoints* lp,\n-                        bool useExistingLockPoints)\n+                        const LockPoints* lp)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r853249200",
      "id" : 853249200,
      "in_reply_to_id" : 792574579,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584y24yw",
      "original_commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "original_line" : 279,
      "original_position" : 74,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 945962568,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853249200/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-19T16:07:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853249200",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r853250889"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853250889"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Note that we do have a bit of a behavior change here...\r\n\r\nThank you!\r\n\r\nThe current behavior has been preserved in the recent [update](https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1102831191).",
      "commit_id" : "aa8f68b2352dd37cae59867276b38127d7041685",
      "created_at" : "2022-04-19T16:09:21Z",
      "diff_hunk" : "@@ -365,18 +377,13 @@ void CChainState::MaybeUpdateMempoolForReorg(\n         LockPoints lp = it->GetLockPoints();\n         const bool validLP{TestLockPointValidity(m_chain, lp)};\n         CCoinsViewMemPool view_mempool(&CoinsTip(), *m_mempool);\n-        // CheckSequenceLocks checks if the transaction will be final in the next block to be\n-        // created on top of the new chain. We use useExistingLockPoints=false so that, instead of\n-        // using the information in lp (which might now refer to a block that no longer exists in\n-        // the chain), it will update lp to contain LockPoints relevant to the new chain.\n-        if (!CheckSequenceLocks(m_chain.Tip(), view_mempool, tx, flags, &lp, validLP)) {\n-            // If CheckSequenceLocks fails, remove the tx and don't depend on the LockPoints.\n-            return true;\n-        } else if (!validLP) {\n-            // If CheckSequenceLocks succeeded, it also updated the LockPoints.\n-            // Now update the mempool entry lockpoints as well.\n+        if (!validLP) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#discussion_r853250889",
      "id" : 853250889,
      "in_reply_to_id" : 792578100,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584y25NJ",
      "original_commit_id" : "220475bdbca0598c6f5158e870b89ff9503a7258",
      "original_line" : 380,
      "original_position" : 153,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 945965000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23897",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853250889/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-19T16:09:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853250889",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-05-06T10:56:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23897#issuecomment-1119493952",
      "id" : 1119493952,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23897",
      "node_id" : "IC_kwDOABII585Cuh9A",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1119493952/reactions"
      },
      "updated_at" : "2022-05-06T10:56:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1119493952",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
