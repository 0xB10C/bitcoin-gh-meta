[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23927](https://github.com/bitcoin/bitcoin/pull/23927) (rpc: Pruning nodes can not fetch blocks before syncing past their height by fjahr)\n* [#23706](https://github.com/bitcoin/bitcoin/pull/23706) (rpc: getblockfrompeer followups by Sjors)\n* [#22932](https://github.com/bitcoin/bitcoin/pull/22932) (Add CBlockIndex lock annotations, guard nStatus/nFile/nDataPos/nUndoPos by cs_main by jonatack)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-12-18T16:24:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23813#issuecomment-997226154",
      "id" : 997226154,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23813",
      "node_id" : "IC_kwDOABII5847cHaq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/997226154/reactions"
      },
      "updated_at" : "2022-01-19T19:51:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/997226154",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-12-18T17:31:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23813#issuecomment-997235323",
      "id" : 997235323,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23813",
      "node_id" : "IC_kwDOABII5847cJp7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/997235323/reactions"
      },
      "updated_at" : "2021-12-18T17:31:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/997235323",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Can you rebase this on #23706? Otherwise it might get confusing...",
      "created_at" : "2021-12-20T02:39:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23813#issuecomment-997544082",
      "id" : 997544082,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23813",
      "node_id" : "IC_kwDOABII5847dVCS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/997544082/reactions"
      },
      "updated_at" : "2021-12-20T02:39:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/997544082",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Can you rebase this on #23706? Otherwise it might get confusing...\r\n\r\nDone",
      "created_at" : "2021-12-20T21:16:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23813#issuecomment-998275782",
      "id" : 998275782,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23813",
      "node_id" : "IC_kwDOABII5847gHrG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998275782/reactions"
      },
      "updated_at" : "2021-12-20T21:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998275782",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23813#discussion_r772792931"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23813"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772792931"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I dropped the `warnings` field in 6f2133d3e6a9df23ba7922f51bdc17acd049e2e6, so this `assert` can't fail anymore...",
      "commit_id" : "5ed8de7a2a36b640442ab2b2b6ed494db116a49c",
      "created_at" : "2021-12-21T02:51:48Z",
      "diff_hunk" : "@@ -60,11 +65,30 @@ def run_test(self):\n \n         self.log.info(\"Successful fetch\")\n         result = self.nodes[0].getblockfrompeer(short_tip, peer_0_peer_1_id)\n-        self.wait_until(lambda: self.check_for_block(short_tip), timeout=1)\n+        self.wait_until(lambda: self.check_for_block(self.nodes[0], short_tip), timeout=1)\n         assert_equal(result, {})\n \n         self.log.info(\"Don't fetch blocks we already have\")\n         assert_raises_rpc_error(-1, \"Block already downloaded\", self.nodes[0].getblockfrompeer, short_tip, peer_0_peer_1_id)\n \n+        self.log.info(\"Connect pruned node\")\n+        # We need to generate more blocks to be able to prune\n+        self.connect_nodes(0, 2)\n+        self.generate(self.nodes[0], 400)\n+        pruneheight = self.nodes[2].pruneblockchain(300)\n+        assert_equal(pruneheight, 248)\n+        # Ensure the block is actually pruned\n+        pruned_block = self.nodes[0].getblockhash(2)\n+        assert_raises_rpc_error(-1, \"Block not available (pruned data)\", self.nodes[2].getblock, pruned_block)\n+\n+        self.log.info(\"Fetch pruned block\")\n+        peers = self.nodes[2].getpeerinfo()\n+        assert_equal(len(peers), 1)\n+        peer_2_peer_0_id = peers[0][\"id\"]\n+        result = self.nodes[2].getblockfrompeer(pruned_block, peer_2_peer_0_id)\n+        self.wait_until(lambda: self.check_for_block(self.nodes[2], pruned_block), timeout=1)\n+        assert(not \"warnings\" in result)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23813#discussion_r772792931",
      "id" : 772792931,
      "line" : 90,
      "node_id" : "PRRC_kwDOABII584uD-Jj",
      "original_commit_id" : "5ed8de7a2a36b640442ab2b2b6ed494db116a49c",
      "original_line" : 90,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "test/functional/rpc_getblockfrompeer.py",
      "position" : 59,
      "pull_request_review_id" : 836973462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23813",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772792931/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-21T02:51:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772792931",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23813#discussion_r773433182"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23813"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/773433182"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed",
      "commit_id" : "809b2afa02e5ab8a839306562e82434c218f7632",
      "created_at" : "2021-12-21T20:45:52Z",
      "diff_hunk" : "@@ -60,11 +65,30 @@ def run_test(self):\n \n         self.log.info(\"Successful fetch\")\n         result = self.nodes[0].getblockfrompeer(short_tip, peer_0_peer_1_id)\n-        self.wait_until(lambda: self.check_for_block(short_tip), timeout=1)\n+        self.wait_until(lambda: self.check_for_block(self.nodes[0], short_tip), timeout=1)\n         assert_equal(result, {})\n \n         self.log.info(\"Don't fetch blocks we already have\")\n         assert_raises_rpc_error(-1, \"Block already downloaded\", self.nodes[0].getblockfrompeer, short_tip, peer_0_peer_1_id)\n \n+        self.log.info(\"Connect pruned node\")\n+        # We need to generate more blocks to be able to prune\n+        self.connect_nodes(0, 2)\n+        self.generate(self.nodes[0], 400)\n+        pruneheight = self.nodes[2].pruneblockchain(300)\n+        assert_equal(pruneheight, 248)\n+        # Ensure the block is actually pruned\n+        pruned_block = self.nodes[0].getblockhash(2)\n+        assert_raises_rpc_error(-1, \"Block not available (pruned data)\", self.nodes[2].getblock, pruned_block)\n+\n+        self.log.info(\"Fetch pruned block\")\n+        peers = self.nodes[2].getpeerinfo()\n+        assert_equal(len(peers), 1)\n+        peer_2_peer_0_id = peers[0][\"id\"]\n+        result = self.nodes[2].getblockfrompeer(pruned_block, peer_2_peer_0_id)\n+        self.wait_until(lambda: self.check_for_block(self.nodes[2], pruned_block), timeout=1)\n+        assert(not \"warnings\" in result)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23813#discussion_r773433182",
      "id" : 773433182,
      "in_reply_to_id" : 772792931,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584uGade",
      "original_commit_id" : "5ed8de7a2a36b640442ab2b2b6ed494db116a49c",
      "original_line" : 90,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "test/functional/rpc_getblockfrompeer.py",
      "position" : null,
      "pull_request_review_id" : 837856887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23813",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/773433182/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-21T20:45:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/773433182",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-01-25T19:35:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23813#issuecomment-1021538824",
      "id" : 1021538824,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23813",
      "node_id" : "IC_kwDOABII584843II",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1021538824/reactions"
      },
      "updated_at" : "2022-01-25T19:35:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1021538824",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased since #23706 was merged",
      "created_at" : "2022-01-25T19:56:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23813#issuecomment-1021555258",
      "id" : 1021555258,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23813",
      "node_id" : "IC_kwDOABII584847I6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1021555258/reactions"
      },
      "updated_at" : "2022-01-25T19:56:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1021555258",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23813#discussion_r792624849"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23813"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792624849"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What block does \"the block\" refer to? The most recent block that's being fetched as part of the regular activity?\r\n\r\nMaybe this can be a bit shorter: \"Previously pruned blocks are only preserved until the next pruning event.\" (afaik this is true as long as the user doesn't change `-prune`)",
      "commit_id" : "6946327b191a0b573658e098e1d470d8dd7dae37",
      "created_at" : "2022-01-26T13:17:32Z",
      "diff_hunk" : "@@ -793,7 +793,8 @@ static RPCHelpMan getblockfrompeer()\n         \"\\nAttempt to fetch block from a given peer.\\n\"\n         \"\\nWe must have the header for this block, e.g. using submitheader.\\n\"\n         \"Subsequent calls for the same block and a new peer will cause the response from the previous peer to be ignored.\\n\"\n-        \"\\nReturns an empty JSON object if the request was successfully scheduled.\",\n+        \"\\nReturns an empty JSON object if the request was successfully scheduled.\"\n+        \"\\nNote: On a pruned node this block might be pruned again as soon as the pruneheight surpasses the blockheight at the time of fetching the block.\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23813#discussion_r792624849",
      "id" : 792624849,
      "line" : 797,
      "node_id" : "PRRC_kwDOABII584vPn7R",
      "original_commit_id" : "11009c3a6055a254864ee4a63af89e2b930b7c92",
      "original_line" : 797,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 6,
      "pull_request_review_id" : 863523651,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23813",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792624849/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-26T13:20:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/792624849",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23813#discussion_r795084544"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23813"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/795084544"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "\"block\" both times refers to the block being fetched with `getblockfrompeer`. I see how it was not super clear so I revised the wording a bit.\r\n\r\nI think your shorter version is not necessarily correct. The block might be pruned with the next pruning event or not, it depends on the prune height requested if it is in a file that is otherwise ready to be pruned. So the block with the highest height in the same file is the deciding factor as far as I understand. Since the fetched blocked is usually appended in the file with the current tip, the next pruning event will often not allow that file to be pruned. The expanded test that you requested actually shows this well already and so I structured it in a way that this behavior is made explicit.",
      "commit_id" : "6946327b191a0b573658e098e1d470d8dd7dae37",
      "created_at" : "2022-01-29T19:11:35Z",
      "diff_hunk" : "@@ -793,7 +793,8 @@ static RPCHelpMan getblockfrompeer()\n         \"\\nAttempt to fetch block from a given peer.\\n\"\n         \"\\nWe must have the header for this block, e.g. using submitheader.\\n\"\n         \"Subsequent calls for the same block and a new peer will cause the response from the previous peer to be ignored.\\n\"\n-        \"\\nReturns an empty JSON object if the request was successfully scheduled.\",\n+        \"\\nReturns an empty JSON object if the request was successfully scheduled.\"\n+        \"\\nNote: On a pruned node this block might be pruned again as soon as the pruneheight surpasses the blockheight at the time of fetching the block.\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23813#discussion_r795084544",
      "id" : 795084544,
      "in_reply_to_id" : 792624849,
      "line" : 797,
      "node_id" : "PRRC_kwDOABII584vZAcA",
      "original_commit_id" : "11009c3a6055a254864ee4a63af89e2b930b7c92",
      "original_line" : 797,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 6,
      "pull_request_review_id" : 866999574,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23813",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/795084544/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-29T19:11:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/795084544",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23813#discussion_r795207138"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23813"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/795207138"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah I see. Then I think there should be a warning that this can temporarily cause pruning to be deferred? I.e. disk space may exceed `-prune`? Is there an upper limit of required extra free disk space that we can suggest?",
      "commit_id" : "6946327b191a0b573658e098e1d470d8dd7dae37",
      "created_at" : "2022-01-30T16:00:19Z",
      "diff_hunk" : "@@ -793,7 +793,8 @@ static RPCHelpMan getblockfrompeer()\n         \"\\nAttempt to fetch block from a given peer.\\n\"\n         \"\\nWe must have the header for this block, e.g. using submitheader.\\n\"\n         \"Subsequent calls for the same block and a new peer will cause the response from the previous peer to be ignored.\\n\"\n-        \"\\nReturns an empty JSON object if the request was successfully scheduled.\",\n+        \"\\nReturns an empty JSON object if the request was successfully scheduled.\"\n+        \"\\nNote: On a pruned node this block might be pruned again as soon as the pruneheight surpasses the blockheight at the time of fetching the block.\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23813#discussion_r795207138",
      "id" : 795207138,
      "in_reply_to_id" : 792624849,
      "line" : 797,
      "node_id" : "PRRC_kwDOABII584vZeXi",
      "original_commit_id" : "11009c3a6055a254864ee4a63af89e2b930b7c92",
      "original_line" : 797,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 6,
      "pull_request_review_id" : 867139230,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23813",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/795207138/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-30T16:01:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/795207138",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
