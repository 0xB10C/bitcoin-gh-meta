[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112709836"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112709836"
         }
      },
      "body" : "I think think you need to acquire cs_wallet lock here, otherwise this could return a partial sum if `GetBalance` got called from two threads at the same time and one thread returned `nBalanceCache` while the other thread was in the middle of the `nBalanceCache +=` loop.\r\n\r\nAlternately, you could bring back the nTotal local variable and just set `nBalanceCache = nTotal`  atomically.",
      "commit_id" : "a6903788aa105bd26dc6bd5a2784db5109467848",
      "created_at" : "2017-04-21T15:07:29Z",
      "diff_hunk" : "@@ -1902,95 +1909,123 @@ void CWallet::ResendWalletTransactions(int64_t nBestBlockTime, CConnman* connman\n  * @{\n  */\n \n+void CWallet::MarkBalancesDirty()\n+{\n+    fBalancesDirty = true;\n+    BalancesDidChange();\n+}\n \n CAmount CWallet::GetBalance() const\n {\n-    CAmount nTotal = 0;\n+    if (!fBalancesDirty) {\n+        return nBalanceCache;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112709836",
      "id" : 112709836,
      "original_commit_id" : "69b751bd3635b28bb40815d7e370cc201cb0c6c5",
      "original_position" : 87,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 34048237,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
      "updated_at" : "2017-05-04T07:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112709836",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112710662"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112710662"
         }
      },
      "body" : "I think you need to move this line after the `LOCK2(cs_main, cs_wallet);` line. Otherwise if this method is called from two different threads simultaneously, this line could zero out a balance which is in the middle of being added up by the other thread.\r\n\r\nOr alternately, delete this line and and set nBalanceCache = nTotal atomically after the loop.",
      "commit_id" : "a6903788aa105bd26dc6bd5a2784db5109467848",
      "created_at" : "2017-04-21T15:10:37Z",
      "diff_hunk" : "@@ -1902,95 +1909,123 @@ void CWallet::ResendWalletTransactions(int64_t nBestBlockTime, CConnman* connman\n  * @{\n  */\n \n+void CWallet::MarkBalancesDirty()\n+{\n+    fBalancesDirty = true;\n+    BalancesDidChange();\n+}\n \n CAmount CWallet::GetBalance() const\n {\n-    CAmount nTotal = 0;\n+    if (!fBalancesDirty) {\n+        return nBalanceCache;\n+    }\n+\n+    nBalanceCache = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112710662",
      "id" : 112710662,
      "original_commit_id" : "69b751bd3635b28bb40815d7e370cc201cb0c6c5",
      "original_position" : 90,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 34048237,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
      "updated_at" : "2017-05-04T07:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112710662",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Concept ACK, nice!",
      "created_at" : "2017-04-21T15:11:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-296218058",
      "id" : 296218058,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
      "updated_at" : "2017-04-21T15:11:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/296218058",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112713347"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112713347"
         }
      },
      "body" : "Maybe call it `BalancesChanged` instead of `BalancesDidChange` to be consistent with the naming of other signals (`StatusChanged`, `AddressBookChanged`, etc).",
      "commit_id" : "a6903788aa105bd26dc6bd5a2784db5109467848",
      "created_at" : "2017-04-21T15:21:59Z",
      "diff_hunk" : "@@ -898,13 +899,26 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n     void ReacceptWalletTransactions();\n     void ResendWalletTransactions(int64_t nBestBlockTime, CConnman* connman) override;\n     std::vector<uint256> ResendWalletTransactionsBefore(int64_t nTime, CConnman* connman);\n+\n+    void MarkBalancesDirty();\n     CAmount GetBalance() const;\n     CAmount GetUnconfirmedBalance() const;\n     CAmount GetImmatureBalance() const;\n     CAmount GetWatchOnlyBalance() const;\n     CAmount GetUnconfirmedWatchOnlyBalance() const;\n     CAmount GetImmatureWatchOnlyBalance() const;\n \n+    mutable std::atomic<CAmount> nBalanceCache;\n+    mutable std::atomic<CAmount> nUnconfirmedBalanceCache;\n+    mutable std::atomic<CAmount> nImmatureBalanceCache;\n+    mutable std::atomic<CAmount> nWatchOnlyBalanceCache;\n+    mutable std::atomic<CAmount> nUnconfirmedWatchOnlyBalanceCache;\n+    mutable std::atomic<CAmount> nImmatureWatchOnlyBalanceCache;\n+    std::atomic<bool> fBalancesDirty;\n+\n+    /** Notification for balance changes */\n+    boost::signals2::signal<void ()> BalancesDidChange;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112713347",
      "id" : 112713347,
      "original_commit_id" : "69b751bd3635b28bb40815d7e370cc201cb0c6c5",
      "original_position" : 30,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 34048237,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
      "updated_at" : "2017-05-04T07:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112713347",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112721119"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112721119"
         }
      },
      "body" : "Oh.. good point.\r\nI'll re-add the temp variable then.",
      "commit_id" : "a6903788aa105bd26dc6bd5a2784db5109467848",
      "created_at" : "2017-04-21T15:56:43Z",
      "diff_hunk" : "@@ -1902,95 +1909,123 @@ void CWallet::ResendWalletTransactions(int64_t nBestBlockTime, CConnman* connman\n  * @{\n  */\n \n+void CWallet::MarkBalancesDirty()\n+{\n+    fBalancesDirty = true;\n+    BalancesDidChange();\n+}\n \n CAmount CWallet::GetBalance() const\n {\n-    CAmount nTotal = 0;\n+    if (!fBalancesDirty) {\n+        return nBalanceCache;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112721119",
      "id" : 112721119,
      "original_commit_id" : "69b751bd3635b28bb40815d7e370cc201cb0c6c5",
      "original_position" : 87,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 34061013,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
      "updated_at" : "2017-05-04T07:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112721119",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112721851"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112721851"
         }
      },
      "body" : "Yes. I can do that. I kinda like the signal naming convention from apple. XYWillChange, XYDidChange, etc.: because it allows the listener to know (without reading to much code) if the event was synchronous or has triggered a process with a later update. But lets not overdo it here,.. will change therefore.",
      "commit_id" : "a6903788aa105bd26dc6bd5a2784db5109467848",
      "created_at" : "2017-04-21T15:59:57Z",
      "diff_hunk" : "@@ -898,13 +899,26 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n     void ReacceptWalletTransactions();\n     void ResendWalletTransactions(int64_t nBestBlockTime, CConnman* connman) override;\n     std::vector<uint256> ResendWalletTransactionsBefore(int64_t nTime, CConnman* connman);\n+\n+    void MarkBalancesDirty();\n     CAmount GetBalance() const;\n     CAmount GetUnconfirmedBalance() const;\n     CAmount GetImmatureBalance() const;\n     CAmount GetWatchOnlyBalance() const;\n     CAmount GetUnconfirmedWatchOnlyBalance() const;\n     CAmount GetImmatureWatchOnlyBalance() const;\n \n+    mutable std::atomic<CAmount> nBalanceCache;\n+    mutable std::atomic<CAmount> nUnconfirmedBalanceCache;\n+    mutable std::atomic<CAmount> nImmatureBalanceCache;\n+    mutable std::atomic<CAmount> nWatchOnlyBalanceCache;\n+    mutable std::atomic<CAmount> nUnconfirmedWatchOnlyBalanceCache;\n+    mutable std::atomic<CAmount> nImmatureWatchOnlyBalanceCache;\n+    std::atomic<bool> fBalancesDirty;\n+\n+    /** Notification for balance changes */\n+    boost::signals2::signal<void ()> BalancesDidChange;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r112721851",
      "id" : 112721851,
      "original_commit_id" : "69b751bd3635b28bb40815d7e370cc201cb0c6c5",
      "original_position" : 30,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 34061812,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
      "updated_at" : "2017-05-04T07:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112721851",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Force pushed fixes for issues found by @ryanofsky.",
      "created_at" : "2017-04-21T16:12:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-296234383",
      "id" : 296234383,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
      "updated_at" : "2017-04-21T16:12:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/296234383",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114147182"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114147182"
         }
      },
      "body" : "In commit \"Add atomic cache for balances\"\r\n\r\nThe whole caching portion of this PR actually seems broken because `fBalancesDirty` is initialized to true but never set to false anywhere. I think this can be fixed, but maybe simplest thing to do would be to drop the caching, and just keep the signalling part of this PR.",
      "commit_id" : "a6903788aa105bd26dc6bd5a2784db5109467848",
      "created_at" : "2017-05-01T16:09:11Z",
      "diff_hunk" : "@@ -780,6 +780,7 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n         nRelockTime = 0;\n         fAbortRescan = false;\n         fScanningWallet = false;\n+        fBalancesDirty = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114147182",
      "id" : 114147182,
      "original_commit_id" : "b18f6765c5f919de18562253f2f03f83e2ba9dcd",
      "original_position" : 4,
      "path" : "src/wallet/wallet.h",
      "position" : 4,
      "pull_request_review_id" : 35590164,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
      "updated_at" : "2017-05-04T07:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114147182",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114156091"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114156091"
         }
      },
      "body" : "In commit \"[Qt] remove unused polling code\"\r\n\r\nI think it would be good to squash this commit into \"[Qt] use the BalancesChanged signal instead of a 250ms poll timer.\" It's confusing to see code that checks the `fForceCheckBalanceChanged` variable and some code that sets it removed, while other code that sets it sticks around.",
      "commit_id" : "a6903788aa105bd26dc6bd5a2784db5109467848",
      "created_at" : "2017-05-01T17:05:22Z",
      "diff_hunk" : "@@ -137,12 +136,6 @@ void WalletModel::updateBalance()\n     }\n }\n \n-void WalletModel::updateTransaction()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114156091",
      "id" : 114156091,
      "original_commit_id" : "e63ab9be56827166cc40f890bf252361ef27808b",
      "original_position" : 12,
      "path" : "src/qt/walletmodel.cpp",
      "position" : 64,
      "pull_request_review_id" : 35590164,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
      "updated_at" : "2017-05-04T07:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114156091",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114711533"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114711533"
         }
      },
      "body" : "Oh. Yes indeed. I now switched to a cache-invalidation-atomic per balance type and set it to `false` once the cache has been built.",
      "commit_id" : "a6903788aa105bd26dc6bd5a2784db5109467848",
      "created_at" : "2017-05-04T07:19:24Z",
      "diff_hunk" : "@@ -780,6 +780,7 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n         nRelockTime = 0;\n         fAbortRescan = false;\n         fScanningWallet = false;\n+        fBalancesDirty = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114711533",
      "id" : 114711533,
      "original_commit_id" : "b18f6765c5f919de18562253f2f03f83e2ba9dcd",
      "original_position" : 4,
      "path" : "src/wallet/wallet.h",
      "position" : 4,
      "pull_request_review_id" : 36199012,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
      "updated_at" : "2017-05-04T07:19:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114711533",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114711567"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114711567"
         }
      },
      "body" : "Good point. Squashed those two commits together.",
      "commit_id" : "a6903788aa105bd26dc6bd5a2784db5109467848",
      "created_at" : "2017-05-04T07:19:39Z",
      "diff_hunk" : "@@ -137,12 +136,6 @@ void WalletModel::updateBalance()\n     }\n }\n \n-void WalletModel::updateTransaction()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114711567",
      "id" : 114711567,
      "original_commit_id" : "e63ab9be56827166cc40f890bf252361ef27808b",
      "original_position" : 12,
      "path" : "src/qt/walletmodel.cpp",
      "position" : 64,
      "pull_request_review_id" : 36199047,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
      "updated_at" : "2017-05-04T07:19:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114711567",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Force push fixed @ryanofsky points.",
      "created_at" : "2017-05-04T07:20:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10251#issuecomment-299113394",
      "id" : 299113394,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10251",
      "updated_at" : "2017-05-04T07:20:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/299113394",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114810109"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114810109"
         }
      },
      "body" : "In commit \"Add atomic cache for balances\"\r\n\r\nMaybe rename `fBalancesDirty` to `fBalanceDirty` since this only applies to the balance returned from CWallet::GetBalance and not the other balances.",
      "commit_id" : "a6903788aa105bd26dc6bd5a2784db5109467848",
      "created_at" : "2017-05-04T15:22:15Z",
      "diff_hunk" : "@@ -1914,13 +1935,18 @@ CAmount CWallet::GetBalance() const\n             if (pcoin->IsTrusted())\n                 nTotal += pcoin->GetAvailableCredit();\n         }\n+        nBalanceCache = nTotal;\n+        fBalancesDirty = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10251#discussion_r114810109",
      "id" : 114810109,
      "original_commit_id" : "28637b62546a37bdf8e7502e3247413fb92c6ec3",
      "original_position" : 102,
      "path" : "src/wallet/wallet.cpp",
      "position" : 102,
      "pull_request_review_id" : 36301148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10251",
      "updated_at" : "2017-05-04T15:22:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114810109",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
