[
   {
      "body" : "Obviously the end goal here is to take revenge for #771 :)",
      "created_at" : "2017-04-26T01:53:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#issuecomment-297214943",
      "id" : 297214943,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10279",
      "updated_at" : "2017-04-26T01:53:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/297214943",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113708480"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113708480"
         }
      },
      "body" : "The CChainParams are still needed (or at least Consensus::Params) see https://github.com/bitcoin/bitcoin/pull/9176",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T14:23:18Z",
      "diff_hunk" : "@@ -3511,9 +3538,9 @@ CBlockIndex * InsertBlockIndex(uint256 hash)\n     return pindexNew;\n }\n \n-bool static LoadBlockIndexDB(const CChainParams& chainparams)\n+bool CChainState::Load(CBlockTreeDB& blocktree)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113708480",
      "id" : 113708480,
      "original_commit_id" : "20aa3811df65e39d60572876ab2850eea6194429",
      "original_position" : 121,
      "path" : "src/validation.cpp",
      "position" : 653,
      "pull_request_review_id" : 35120146,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:37:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113708480",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113709236"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113709236"
         }
      },
      "body" : "If this is the only use of chainparams, perhaps it is better to just pass chainparams.MessageStart() directly instead.",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T14:26:16Z",
      "diff_hunk" : "@@ -3160,6 +3160,24 @@ bool ProcessNewBlockHeaders(const std::vector<CBlockHeader>& headers, CValidatio\n     return true;\n }\n \n+static CDiskBlockPos WriteBlockToDisk(const CBlock& block, int nHeight, const CChainParams& chainparams, const CDiskBlockPos* dbp) {\n+    unsigned int nBlockSize = ::GetSerializeSize(block, SER_DISK, CLIENT_VERSION);\n+    CDiskBlockPos blockPos;\n+    if (dbp != NULL)\n+        blockPos = *dbp;\n+    if (!FindBlockPos(blockPos, nBlockSize+8, nHeight, block.GetBlockTime(), dbp != NULL)) {\n+        error(\"AcceptBlock(): FindBlockPos failed\");\n+        return CDiskBlockPos();\n+    }\n+    if (dbp == NULL) {\n+        if (!WriteBlockToDisk(block, blockPos, chainparams.MessageStart())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113709236",
      "id" : 113709236,
      "original_commit_id" : "33aad08c6e7b0a9e291163c39538bee00be7e953",
      "original_position" : 32,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 35120955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:37:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113709236",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113712885"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113712885"
         }
      },
      "body" : "I think UndoReadFromDisk can be static.",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T14:40:03Z",
      "diff_hunk" : "@@ -1446,8 +1446,12 @@ bool UndoWriteToDisk(const CBlockUndo& blockundo, CDiskBlockPos& pos, const uint\n     return true;\n }\n \n-bool UndoReadFromDisk(CBlockUndo& blockundo, const CDiskBlockPos& pos, const uint256& hashBlock)\n+bool UndoReadFromDisk(CBlockUndo& blockundo, const CBlockIndex *pindex)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113712885",
      "id" : 113712885,
      "original_commit_id" : "e32dc53af14aa28d936da9c9b5a80b5fe522ad18",
      "original_position" : 5,
      "path" : "src/validation.cpp",
      "position" : 203,
      "pull_request_review_id" : 35125101,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:37:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113712885",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113713105"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113713105"
         }
      },
      "body" : "just noting: previously the following two lines are hit even if this conditional isn't true(and `pindex->GetUndoPos().IsNull()` is). No idea if this is a behavior change",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T14:40:47Z",
      "diff_hunk" : "@@ -1898,28 +1928,16 @@ static bool ConnectBlock(const CBlock& block, CValidationState& state, CBlockInd\n     if (fJustCheck)\n         return true;\n \n-    // Write undo information to disk\n-    if (pindex->GetUndoPos().IsNull() || !pindex->IsValid(BLOCK_VALID_SCRIPTS))\n-    {\n-        if (pindex->GetUndoPos().IsNull()) {\n-            CDiskBlockPos _pos;\n-            if (!FindUndoPos(state, pindex->nFile, _pos, ::GetSerializeSize(blockundo, SER_DISK, CLIENT_VERSION) + 40))\n-                return error(\"ConnectBlock(): FindUndoPos failed\");\n-            if (!UndoWriteToDisk(blockundo, _pos, pindex->pprev->GetBlockHash(), chainparams.MessageStart()))\n-                return AbortNode(state, \"Failed to write undo data\");\n-\n-            // update nUndoPos in block index\n-            pindex->nUndoPos = _pos.nPos;\n-            pindex->nStatus |= BLOCK_HAVE_UNDO;\n-        }\n+    if (!WriteUndoDataForBlock(blockundo, state, pindex, chainparams))\n+        return false;\n \n+    if (!pindex->IsValid(BLOCK_VALID_SCRIPTS)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113713105",
      "id" : 113713105,
      "original_commit_id" : "f2e9d9a5d8d57b277634c5f822134aab7fc05b7b",
      "original_position" : 84,
      "path" : "src/validation.cpp",
      "position" : 340,
      "pull_request_review_id" : 35125339,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:37:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113713105",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113713158"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113713158"
         }
      },
      "body" : "Again, If this is the only use of chainparams, perhaps it is better to just pass chainparams.MessageStart() directly instead.",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T14:40:59Z",
      "diff_hunk" : "@@ -1624,6 +1624,42 @@ void static FlushBlockFile(bool fFinalize = false)\n \n bool FindUndoPos(CValidationState &state, int nFile, CDiskBlockPos &pos, unsigned int nAddSize);\n \n+static bool WriteUndoDataForBlock(const CBlockUndo& blockundo, CValidationState& state, CBlockIndex* pindex, const CChainParams& chainparams)\n+{\n+    // Write undo information to disk\n+    if (pindex->GetUndoPos().IsNull()) {\n+        CDiskBlockPos _pos;\n+        if (!FindUndoPos(state, pindex->nFile, _pos, ::GetSerializeSize(blockundo, SER_DISK, CLIENT_VERSION) + 40))\n+            return error(\"ConnectBlock(): FindUndoPos failed\");\n+        if (!UndoWriteToDisk(blockundo, _pos, pindex->pprev->GetBlockHash(), chainparams.MessageStart()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113713158",
      "id" : 113713158,
      "original_commit_id" : "f2e9d9a5d8d57b277634c5f822134aab7fc05b7b",
      "original_position" : 11,
      "path" : "src/validation.cpp",
      "position" : 253,
      "pull_request_review_id" : 35125101,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:37:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113713158",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113715158"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113715158"
         }
      },
      "body" : "Why do any of this if `fTxIndex` is false?",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T14:45:57Z",
      "diff_hunk" : "@@ -1624,6 +1624,42 @@ void static FlushBlockFile(bool fFinalize = false)\n \n bool FindUndoPos(CValidationState &state, int nFile, CDiskBlockPos &pos, unsigned int nAddSize);\n \n+static bool WriteUndoDataForBlock(const CBlockUndo& blockundo, CValidationState& state, CBlockIndex* pindex, const CChainParams& chainparams)\n+{\n+    // Write undo information to disk\n+    if (pindex->GetUndoPos().IsNull()) {\n+        CDiskBlockPos _pos;\n+        if (!FindUndoPos(state, pindex->nFile, _pos, ::GetSerializeSize(blockundo, SER_DISK, CLIENT_VERSION) + 40))\n+            return error(\"ConnectBlock(): FindUndoPos failed\");\n+        if (!UndoWriteToDisk(blockundo, _pos, pindex->pprev->GetBlockHash(), chainparams.MessageStart()))\n+            return AbortNode(state, \"Failed to write undo data\");\n+\n+        // update nUndoPos in block index\n+        pindex->nUndoPos = _pos.nPos;\n+        pindex->nStatus |= BLOCK_HAVE_UNDO;\n+    }\n+\n+    return true;\n+}\n+\n+static bool WriteTxIndexDataForBlock(const CBlock& block, CValidationState& state, CBlockIndex* pindex)\n+{\n+    CDiskTxPos pos(pindex->GetBlockPos(), GetSizeOfCompactSize(block.vtx.size()));\n+    std::vector<std::pair<uint256, CDiskTxPos> > vPos;\n+    vPos.reserve(block.vtx.size());\n+    for (const CTransactionRef& tx : block.vtx)\n+    {\n+        vPos.push_back(std::make_pair(tx->GetHash(), pos));\n+        pos.nTxOffset += ::GetSerializeSize(*tx, SER_DISK, CLIENT_VERSION);\n+    }\n+\n+    if (fTxIndex)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113715158",
      "id" : 113715158,
      "original_commit_id" : "f2e9d9a5d8d57b277634c5f822134aab7fc05b7b",
      "original_position" : 33,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 35125339,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:37:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113715158",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113715268"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113715268"
         }
      },
      "body" : "There was a PR uniforming comments for ending namespaces. Also, according to our style, we don't indent on namespaces: https://github.com/bitcoin/bitcoin/blob/master/src/.clang-format#L32",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T14:46:14Z",
      "diff_hunk" : "@@ -53,11 +53,60 @@\n /**\n  * Global state\n  */\n+namespace {\n+    struct CBlockIndexWorkComparator\n+    {\n+        bool operator()(CBlockIndex *pa, CBlockIndex *pb) const {\n+            // First sort by most total work, ...\n+            if (pa->nChainWork > pb->nChainWork) return false;\n+            if (pa->nChainWork < pb->nChainWork) return true;\n+\n+            // ... then by earliest time received, ...\n+            if (pa->nSequenceId < pb->nSequenceId) return false;\n+            if (pa->nSequenceId > pb->nSequenceId) return true;\n+\n+            // Use pointer address as tie breaker (should only happen with blocks\n+            // loaded from disk, as those all have id 0).\n+            if (pa < pb) return false;\n+            if (pa > pb) return true;\n+\n+            // Identical blocks.\n+            return false;\n+        }\n+    };\n+};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113715268",
      "id" : 113715268,
      "original_commit_id" : "20aa3811df65e39d60572876ab2850eea6194429",
      "original_position" : 25,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 35127668,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:37:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113715268",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113715447"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113715447"
         }
      },
      "body" : "Probably better to move the CheckProofOfWord check into CChainParams::InsertBlockIndex (or the lambda). As eventually CChainParams should be a local variable inside CChainState, any objections to leaving this for later?",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T14:46:39Z",
      "diff_hunk" : "@@ -3511,9 +3538,9 @@ CBlockIndex * InsertBlockIndex(uint256 hash)\n     return pindexNew;\n }\n \n-bool static LoadBlockIndexDB(const CChainParams& chainparams)\n+bool CChainState::Load(CBlockTreeDB& blocktree)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113715447",
      "id" : 113715447,
      "original_commit_id" : "20aa3811df65e39d60572876ab2850eea6194429",
      "original_position" : 121,
      "path" : "src/validation.cpp",
      "position" : 653,
      "pull_request_review_id" : 35127854,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:37:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113715447",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113716280"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113716280"
         }
      },
      "body" : "Seems somewhat strange for CChainState to care at all about the existance of MessageStart(), no?",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T14:48:34Z",
      "diff_hunk" : "@@ -3160,6 +3160,24 @@ bool ProcessNewBlockHeaders(const std::vector<CBlockHeader>& headers, CValidatio\n     return true;\n }\n \n+static CDiskBlockPos WriteBlockToDisk(const CBlock& block, int nHeight, const CChainParams& chainparams, const CDiskBlockPos* dbp) {\n+    unsigned int nBlockSize = ::GetSerializeSize(block, SER_DISK, CLIENT_VERSION);\n+    CDiskBlockPos blockPos;\n+    if (dbp != NULL)\n+        blockPos = *dbp;\n+    if (!FindBlockPos(blockPos, nBlockSize+8, nHeight, block.GetBlockTime(), dbp != NULL)) {\n+        error(\"AcceptBlock(): FindBlockPos failed\");\n+        return CDiskBlockPos();\n+    }\n+    if (dbp == NULL) {\n+        if (!WriteBlockToDisk(block, blockPos, chainparams.MessageStart())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113716280",
      "id" : 113716280,
      "original_commit_id" : "33aad08c6e7b0a9e291163c39538bee00be7e953",
      "original_position" : 32,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 35128719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:37:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113716280",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113716676"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113716676"
         }
      },
      "body" : "It is already in an anonymous namespace, which I believe is equivalent.",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T14:49:27Z",
      "diff_hunk" : "@@ -1446,8 +1446,12 @@ bool UndoWriteToDisk(const CBlockUndo& blockundo, CDiskBlockPos& pos, const uint\n     return true;\n }\n \n-bool UndoReadFromDisk(CBlockUndo& blockundo, const CDiskBlockPos& pos, const uint256& hashBlock)\n+bool UndoReadFromDisk(CBlockUndo& blockundo, const CBlockIndex *pindex)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113716676",
      "id" : 113716676,
      "original_commit_id" : "e32dc53af14aa28d936da9c9b5a80b5fe522ad18",
      "original_position" : 5,
      "path" : "src/validation.cpp",
      "position" : 203,
      "pull_request_review_id" : 35129126,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:37:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113716676",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113717313"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113717313"
         }
      },
      "body" : "Fixed.",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T14:50:53Z",
      "diff_hunk" : "@@ -53,11 +53,60 @@\n /**\n  * Global state\n  */\n+namespace {\n+    struct CBlockIndexWorkComparator\n+    {\n+        bool operator()(CBlockIndex *pa, CBlockIndex *pb) const {\n+            // First sort by most total work, ...\n+            if (pa->nChainWork > pb->nChainWork) return false;\n+            if (pa->nChainWork < pb->nChainWork) return true;\n+\n+            // ... then by earliest time received, ...\n+            if (pa->nSequenceId < pb->nSequenceId) return false;\n+            if (pa->nSequenceId > pb->nSequenceId) return true;\n+\n+            // Use pointer address as tie breaker (should only happen with blocks\n+            // loaded from disk, as those all have id 0).\n+            if (pa < pb) return false;\n+            if (pa > pb) return true;\n+\n+            // Identical blocks.\n+            return false;\n+        }\n+    };\n+};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113717313",
      "id" : 113717313,
      "original_commit_id" : "20aa3811df65e39d60572876ab2850eea6194429",
      "original_position" : 25,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 35129755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:37:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113717313",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113718994"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113718994"
         }
      },
      "body" : "```strprintf(\"%s: Failed to find position to write new block to disk\", __func__)```",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T14:56:18Z",
      "diff_hunk" : "@@ -3215,19 +3233,13 @@ static bool AcceptBlock(const std::shared_ptr<const CBlock>& pblock, CValidation\n     if (!IsInitialBlockDownload() && chainActive.Tip() == pindex->pprev)\n         GetMainSignals().NewPoWValidBlock(pindex, pblock);\n \n-    int nHeight = pindex->nHeight;\n-\n     // Write block to history file\n     try {\n-        unsigned int nBlockSize = ::GetSerializeSize(block, SER_DISK, CLIENT_VERSION);\n-        CDiskBlockPos blockPos;\n-        if (dbp != NULL)\n-            blockPos = *dbp;\n-        if (!FindBlockPos(state, blockPos, nBlockSize+8, nHeight, block.GetBlockTime(), dbp != NULL))\n-            return error(\"AcceptBlock(): FindBlockPos failed\");\n-        if (dbp == NULL)\n-            if (!WriteBlockToDisk(block, blockPos, chainparams.MessageStart()))\n-                AbortNode(state, \"Failed to write block\");\n+        CDiskBlockPos blockPos = WriteBlockToDisk(block, pindex->nHeight, chainparams, dbp);\n+        if (blockPos.IsNull()) {\n+            state.Error(\"AcceptBlock(): Failed to find position to write new block to disk\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113718994",
      "id" : 113718994,
      "original_commit_id" : "33aad08c6e7b0a9e291163c39538bee00be7e953",
      "original_position" : 62,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 35131603,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:37:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113718994",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113719134"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113719134"
         }
      },
      "body" : "```strprintf(\"%s: FindBlockPos failed\", __func__)```",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T14:56:51Z",
      "diff_hunk" : "@@ -3160,6 +3160,24 @@ bool ProcessNewBlockHeaders(const std::vector<CBlockHeader>& headers, CValidatio\n     return true;\n }\n \n+static CDiskBlockPos WriteBlockToDisk(const CBlock& block, int nHeight, const CChainParams& chainparams, const CDiskBlockPos* dbp) {\n+    unsigned int nBlockSize = ::GetSerializeSize(block, SER_DISK, CLIENT_VERSION);\n+    CDiskBlockPos blockPos;\n+    if (dbp != NULL)\n+        blockPos = *dbp;\n+    if (!FindBlockPos(blockPos, nBlockSize+8, nHeight, block.GetBlockTime(), dbp != NULL)) {\n+        error(\"AcceptBlock(): FindBlockPos failed\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113719134",
      "id" : 113719134,
      "original_commit_id" : "33aad08c6e7b0a9e291163c39538bee00be7e953",
      "original_position" : 28,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 35131751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:37:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113719134",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113720238"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113720238"
         }
      },
      "body" : "Fixed.",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T15:00:43Z",
      "diff_hunk" : "@@ -3215,19 +3233,13 @@ static bool AcceptBlock(const std::shared_ptr<const CBlock>& pblock, CValidation\n     if (!IsInitialBlockDownload() && chainActive.Tip() == pindex->pprev)\n         GetMainSignals().NewPoWValidBlock(pindex, pblock);\n \n-    int nHeight = pindex->nHeight;\n-\n     // Write block to history file\n     try {\n-        unsigned int nBlockSize = ::GetSerializeSize(block, SER_DISK, CLIENT_VERSION);\n-        CDiskBlockPos blockPos;\n-        if (dbp != NULL)\n-            blockPos = *dbp;\n-        if (!FindBlockPos(state, blockPos, nBlockSize+8, nHeight, block.GetBlockTime(), dbp != NULL))\n-            return error(\"AcceptBlock(): FindBlockPos failed\");\n-        if (dbp == NULL)\n-            if (!WriteBlockToDisk(block, blockPos, chainparams.MessageStart()))\n-                AbortNode(state, \"Failed to write block\");\n+        CDiskBlockPos blockPos = WriteBlockToDisk(block, pindex->nHeight, chainparams, dbp);\n+        if (blockPos.IsNull()) {\n+            state.Error(\"AcceptBlock(): Failed to find position to write new block to disk\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113720238",
      "id" : 113720238,
      "original_commit_id" : "33aad08c6e7b0a9e291163c39538bee00be7e953",
      "original_position" : 62,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 35132988,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:37:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113720238",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113720248"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113720248"
         }
      },
      "body" : "Fixed.",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T15:00:46Z",
      "diff_hunk" : "@@ -3160,6 +3160,24 @@ bool ProcessNewBlockHeaders(const std::vector<CBlockHeader>& headers, CValidatio\n     return true;\n }\n \n+static CDiskBlockPos WriteBlockToDisk(const CBlock& block, int nHeight, const CChainParams& chainparams, const CDiskBlockPos* dbp) {\n+    unsigned int nBlockSize = ::GetSerializeSize(block, SER_DISK, CLIENT_VERSION);\n+    CDiskBlockPos blockPos;\n+    if (dbp != NULL)\n+        blockPos = *dbp;\n+    if (!FindBlockPos(blockPos, nBlockSize+8, nHeight, block.GetBlockTime(), dbp != NULL)) {\n+        error(\"AcceptBlock(): FindBlockPos failed\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113720248",
      "id" : 113720248,
      "original_commit_id" : "33aad08c6e7b0a9e291163c39538bee00be7e953",
      "original_position" : 28,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 35132997,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:37:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113720248",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "utACK (beyond nits, most of them not very important):\r\n- Make DisconnectBlock unaware of where undo data resides on disk e32dc53af14aa28d936da9c9b5a80b5fe522ad18 \r\n- Create initial CChainState to hold chain state information 20aa3811df65e39d60572876ab2850eea6194429\r\n- Move block writing out of AcceptBlock 33aad08c6e7b0a9e291163c39538bee00be7e953\r\n- Move some additional variables into CChainState private 0acb237f752c0cf7fd783e8c09c0cb55203a6a83\r\n\r\nStill trying to understand: Make ConnectBlock unaware of txindex/undo data disk locations f2e9d9a5d8d57b277634c5f822134aab7fc05b7b\r\n",
      "created_at" : "2017-04-27T15:04:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#issuecomment-297741469",
      "id" : 297741469,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10279",
      "updated_at" : "2017-04-27T15:04:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/297741469",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113728255"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113728255"
         }
      },
      "body" : "Because it used to be? Anyway, fixed in new commit.",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T15:30:08Z",
      "diff_hunk" : "@@ -1624,6 +1624,42 @@ void static FlushBlockFile(bool fFinalize = false)\n \n bool FindUndoPos(CValidationState &state, int nFile, CDiskBlockPos &pos, unsigned int nAddSize);\n \n+static bool WriteUndoDataForBlock(const CBlockUndo& blockundo, CValidationState& state, CBlockIndex* pindex, const CChainParams& chainparams)\n+{\n+    // Write undo information to disk\n+    if (pindex->GetUndoPos().IsNull()) {\n+        CDiskBlockPos _pos;\n+        if (!FindUndoPos(state, pindex->nFile, _pos, ::GetSerializeSize(blockundo, SER_DISK, CLIENT_VERSION) + 40))\n+            return error(\"ConnectBlock(): FindUndoPos failed\");\n+        if (!UndoWriteToDisk(blockundo, _pos, pindex->pprev->GetBlockHash(), chainparams.MessageStart()))\n+            return AbortNode(state, \"Failed to write undo data\");\n+\n+        // update nUndoPos in block index\n+        pindex->nUndoPos = _pos.nPos;\n+        pindex->nStatus |= BLOCK_HAVE_UNDO;\n+    }\n+\n+    return true;\n+}\n+\n+static bool WriteTxIndexDataForBlock(const CBlock& block, CValidationState& state, CBlockIndex* pindex)\n+{\n+    CDiskTxPos pos(pindex->GetBlockPos(), GetSizeOfCompactSize(block.vtx.size()));\n+    std::vector<std::pair<uint256, CDiskTxPos> > vPos;\n+    vPos.reserve(block.vtx.size());\n+    for (const CTransactionRef& tx : block.vtx)\n+    {\n+        vPos.push_back(std::make_pair(tx->GetHash(), pos));\n+        pos.nTxOffset += ::GetSerializeSize(*tx, SER_DISK, CLIENT_VERSION);\n+    }\n+\n+    if (fTxIndex)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113728255",
      "id" : 113728255,
      "original_commit_id" : "f2e9d9a5d8d57b277634c5f822134aab7fc05b7b",
      "original_position" : 33,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 35142010,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:37:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113728255",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113730369"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113730369"
         }
      },
      "body" : "Hmm, it may be, though not sure you could ever tickle it. I went ahead and duplicated the setDirtyBlockIndex.insert() call inside of WriteUndoDataForBlock.",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T15:37:39Z",
      "diff_hunk" : "@@ -1898,28 +1928,16 @@ static bool ConnectBlock(const CBlock& block, CValidationState& state, CBlockInd\n     if (fJustCheck)\n         return true;\n \n-    // Write undo information to disk\n-    if (pindex->GetUndoPos().IsNull() || !pindex->IsValid(BLOCK_VALID_SCRIPTS))\n-    {\n-        if (pindex->GetUndoPos().IsNull()) {\n-            CDiskBlockPos _pos;\n-            if (!FindUndoPos(state, pindex->nFile, _pos, ::GetSerializeSize(blockundo, SER_DISK, CLIENT_VERSION) + 40))\n-                return error(\"ConnectBlock(): FindUndoPos failed\");\n-            if (!UndoWriteToDisk(blockundo, _pos, pindex->pprev->GetBlockHash(), chainparams.MessageStart()))\n-                return AbortNode(state, \"Failed to write undo data\");\n-\n-            // update nUndoPos in block index\n-            pindex->nUndoPos = _pos.nPos;\n-            pindex->nStatus |= BLOCK_HAVE_UNDO;\n-        }\n+    if (!WriteUndoDataForBlock(blockundo, state, pindex, chainparams))\n+        return false;\n \n+    if (!pindex->IsValid(BLOCK_VALID_SCRIPTS)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113730369",
      "id" : 113730369,
      "original_commit_id" : "f2e9d9a5d8d57b277634c5f822134aab7fc05b7b",
      "original_position" : 84,
      "path" : "src/validation.cpp",
      "position" : 340,
      "pull_request_review_id" : 35142010,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:37:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113730369",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113731298"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113731298"
         }
      },
      "body" : "Strange or not, it does care about ut. It seems more strange for this new function to take the whole CChainParams class only for one getter, no?",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T15:41:36Z",
      "diff_hunk" : "@@ -3160,6 +3160,24 @@ bool ProcessNewBlockHeaders(const std::vector<CBlockHeader>& headers, CValidatio\n     return true;\n }\n \n+static CDiskBlockPos WriteBlockToDisk(const CBlock& block, int nHeight, const CChainParams& chainparams, const CDiskBlockPos* dbp) {\n+    unsigned int nBlockSize = ::GetSerializeSize(block, SER_DISK, CLIENT_VERSION);\n+    CDiskBlockPos blockPos;\n+    if (dbp != NULL)\n+        blockPos = *dbp;\n+    if (!FindBlockPos(blockPos, nBlockSize+8, nHeight, block.GetBlockTime(), dbp != NULL)) {\n+        error(\"AcceptBlock(): FindBlockPos failed\");\n+        return CDiskBlockPos();\n+    }\n+    if (dbp == NULL) {\n+        if (!WriteBlockToDisk(block, blockPos, chainparams.MessageStart())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113731298",
      "id" : 113731298,
      "original_commit_id" : "33aad08c6e7b0a9e291163c39538bee00be7e953",
      "original_position" : 32,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 35145342,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:41:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113731298",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113732571"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113732571"
         }
      },
      "body" : "What lambda?\r\nAnyway, if we plan not to do #9176 and moving the check instead, then there's no point in passing Consensus::Params to CChainState::Load if it's going to be only temporary.\r\n",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T15:46:49Z",
      "diff_hunk" : "@@ -3511,9 +3538,9 @@ CBlockIndex * InsertBlockIndex(uint256 hash)\n     return pindexNew;\n }\n \n-bool static LoadBlockIndexDB(const CChainParams& chainparams)\n+bool CChainState::Load(CBlockTreeDB& blocktree)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113732571",
      "id" : 113732571,
      "original_commit_id" : "20aa3811df65e39d60572876ab2850eea6194429",
      "original_position" : 121,
      "path" : "src/validation.cpp",
      "position" : 653,
      "pull_request_review_id" : 35146747,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:46:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113732571",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113736111"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113736111"
         }
      },
      "body" : "Well CChainState doesn't care about MessageStart(), it only cares that the write function figures out what it needs to do, if that means using Messagestart() thats between the write function and chainparams, not CChainState's business. Eventually the write function should be a virtual function inside an interface class and that class can hold the chainparams locally with CChainState only having a Consensus::Params.",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T15:59:53Z",
      "diff_hunk" : "@@ -3160,6 +3160,24 @@ bool ProcessNewBlockHeaders(const std::vector<CBlockHeader>& headers, CValidatio\n     return true;\n }\n \n+static CDiskBlockPos WriteBlockToDisk(const CBlock& block, int nHeight, const CChainParams& chainparams, const CDiskBlockPos* dbp) {\n+    unsigned int nBlockSize = ::GetSerializeSize(block, SER_DISK, CLIENT_VERSION);\n+    CDiskBlockPos blockPos;\n+    if (dbp != NULL)\n+        blockPos = *dbp;\n+    if (!FindBlockPos(blockPos, nBlockSize+8, nHeight, block.GetBlockTime(), dbp != NULL)) {\n+        error(\"AcceptBlock(): FindBlockPos failed\");\n+        return CDiskBlockPos();\n+    }\n+    if (dbp == NULL) {\n+        if (!WriteBlockToDisk(block, blockPos, chainparams.MessageStart())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113736111",
      "id" : 113736111,
      "original_commit_id" : "33aad08c6e7b0a9e291163c39538bee00be7e953",
      "original_position" : 32,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 35150546,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T15:59:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113736111",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113736813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113736813"
         }
      },
      "body" : "eg the CheckProofOfWork call that is currently in LoadBlockIndexGuts can just go in the insertBlockIndex lambda function and the call to that should be a fully-filled CBlockIndex instead of that getting filled by LoadBlockIndexGuts.",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T16:02:38Z",
      "diff_hunk" : "@@ -3511,9 +3538,9 @@ CBlockIndex * InsertBlockIndex(uint256 hash)\n     return pindexNew;\n }\n \n-bool static LoadBlockIndexDB(const CChainParams& chainparams)\n+bool CChainState::Load(CBlockTreeDB& blocktree)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113736813",
      "id" : 113736813,
      "original_commit_id" : "20aa3811df65e39d60572876ab2850eea6194429",
      "original_position" : 121,
      "path" : "src/validation.cpp",
      "position" : 653,
      "pull_request_review_id" : 35151298,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T16:02:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113736813",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113741574"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113741574"
         }
      },
      "body" : "CChainState::Load definitely cares about MessageStart(). But we disagree on next steps, I won't insist further.",
      "commit_id" : "6cd32b4902668bc8c41330de238711c69425b545",
      "created_at" : "2017-04-27T16:22:14Z",
      "diff_hunk" : "@@ -3160,6 +3160,24 @@ bool ProcessNewBlockHeaders(const std::vector<CBlockHeader>& headers, CValidatio\n     return true;\n }\n \n+static CDiskBlockPos WriteBlockToDisk(const CBlock& block, int nHeight, const CChainParams& chainparams, const CDiskBlockPos* dbp) {\n+    unsigned int nBlockSize = ::GetSerializeSize(block, SER_DISK, CLIENT_VERSION);\n+    CDiskBlockPos blockPos;\n+    if (dbp != NULL)\n+        blockPos = *dbp;\n+    if (!FindBlockPos(blockPos, nBlockSize+8, nHeight, block.GetBlockTime(), dbp != NULL)) {\n+        error(\"AcceptBlock(): FindBlockPos failed\");\n+        return CDiskBlockPos();\n+    }\n+    if (dbp == NULL) {\n+        if (!WriteBlockToDisk(block, blockPos, chainparams.MessageStart())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#discussion_r113741574",
      "id" : 113741574,
      "original_commit_id" : "33aad08c6e7b0a9e291163c39538bee00be7e953",
      "original_position" : 32,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 35156565,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10279",
      "updated_at" : "2017-04-27T16:22:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113741574",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Removed InsertBlockIndex from validation.h since it was moved into CChainState (there were no external callers already).",
      "created_at" : "2017-04-30T18:51:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10279#issuecomment-298249683",
      "id" : 298249683,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10279",
      "updated_at" : "2017-04-30T18:51:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298249683",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   }
]
