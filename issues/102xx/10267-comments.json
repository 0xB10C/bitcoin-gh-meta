[
   {
      "body" : "Yeah. Why not. This can be useful.\r\n\r\n* I would recommend to use `-addconf=` (otherwise user may think it replaces the bitcoin.conf configuration file).\r\n* If I follow `GetConfigFile()` correctly, you can also use absolut paths, right?",
      "created_at" : "2017-04-24T06:12:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10267#issuecomment-296533141",
      "id" : 296533141,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10267",
      "updated_at" : "2017-04-24T06:12:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/296533141",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Why not making the existing `-config` a repeatable argument.",
      "created_at" : "2017-04-24T07:15:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10267#issuecomment-296551716",
      "id" : 296551716,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10267",
      "updated_at" : "2017-04-24T07:15:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/296551716",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "body" : "@jonasschnelli Good point - will switch to `-addconf=`. Yes, you can use absolute paths. My worry above is for when a user presumes the path is relative to the config file when it is in fact not.\r\n\r\n@NicolasDorier I think `-config` simply tells what name to use and defaults to `bitcoin.conf` -- it doesn't actually load the file. This feature lets you load other files arbitrarily from within `bitcoin.conf`.\r\n",
      "created_at" : "2017-04-24T08:00:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10267#issuecomment-296565587",
      "id" : 296565587,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10267",
      "updated_at" : "2017-04-24T08:00:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/296565587",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "[Unsquashed history](https://github.com/kallewoof/bitcoin/tree/feature-config-readconfig-unsquashed): [1](https://github.com/kallewoof/bitcoin/commit/b2c56e1ae2dad03bfd8af64cdf0d185317b19662) Ã¢ÂÂ [2](https://github.com/kallewoof/bitcoin/commit/770b88e3514a1d289bb64d0d66d276ca24197b06) Ã¢ÂÂ [3Ã¢ÂÂ±1](https://github.com/kallewoof/bitcoin/commit/bc4a972bcc50ad37d5b386b52cfe7f7a5b3d87cd) Ã¢ÂÂ [4Ã¢ÂÂ±2](https://github.com/kallewoof/bitcoin/commit/0aae401523a8986617bd1306748dae3d9c08f107)",
      "created_at" : "2017-04-24T09:35:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10267#issuecomment-296595191",
      "id" : 296595191,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10267",
      "updated_at" : "2017-04-25T06:29:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/296595191",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "Concept ACK\r\n\r\n> My worry above is for when a user presumes the path is relative to the config file when it is in fact not.\r\n\r\nYes, making it relative to the data directory is a good choice. I think we should handle all relative paths in `bitcoind` that way.\r\n\r\n> Why not making the existing -config a repeatable argument.\r\n\r\nThat was also my first thought, but it may just be confusing as it changes the meaning of the option slightly. It's possible that some setups already use multiple `-conf` options, and rely on the overriding behavior.\r\n\r\nSo I'm good with making it an explicit option.  Another suggestion for the name would be `-includeconf`.",
      "created_at" : "2017-04-24T11:53:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10267#issuecomment-296636109",
      "id" : 296636109,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10267",
      "updated_at" : "2017-04-24T11:53:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/296636109",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Concept ACK. Don't care much about the name, but what about -extraconf ?",
      "created_at" : "2017-04-24T16:50:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10267#issuecomment-296739899",
      "id" : 296739899,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10267",
      "updated_at" : "2017-04-24T16:50:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/296739899",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "From the given suggestions I think `includeconf` is the most clear so I'll switch to that.\r\n\r\n@laanwj:\r\n\r\n> Yes, making it relative to the data directory is a good choice. I think we should handle all relative paths in bitcoind that way.\r\n\r\nTo clarify, you mean that the relative path inside /dir/file.conf should be /dir/, not [bitcoin datadir], right? It will require some lines of code I bet but I think that makes sense too.",
      "created_at" : "2017-04-25T01:47:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10267#issuecomment-296868359",
      "id" : 296868359,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10267",
      "updated_at" : "2017-04-25T01:47:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/296868359",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "The `includeconf` feature now defines the path relative to the file being read, if any. For command line, it is [datadir], for `/dir/abc.conf` it is `/dir/`. I tested this with\r\n```\r\nsrc/testreadconfig/bitcoin.conf: [...] includeconf=../global.conf\r\nsrc/global.conf: includeconf=secrets.conf\r\nsrc/secrets.conf: rpcpassword=foo\r\n```\r\nwith `bitcoind  -datadir=testreadconfig`. Ensured `bitcoin-cli` with password `foo` worked and password `bar` did not. \r\n\r\n[[...]](https://github.com/kallewoof/bitcoin/tree/feature-config-readconfig-unsquashed): Ã¢ÂÂ [5Ã¢ÂÂ±1](https://github.com/kallewoof/bitcoin/commit/f88e7ce8ec842ce2b46b551b0efc067ae8276a6f) Ã¢ÂÂ [6Ã¢ÂÂ±2](https://github.com/kallewoof/bitcoin/commit/cc917f86045a978c11d7be6e1fe7a4da93748b9a)",
      "created_at" : "2017-04-25T03:00:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10267#issuecomment-296880385",
      "id" : 296880385,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10267",
      "updated_at" : "2017-04-25T06:35:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/296880385",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "> To clarify, you mean that the relative path inside /dir/file.conf should be /dir/, not [bitcoin datadir], right? It > will require some lines of code I bet but I think that makes sense too.\r\n\r\nYes, seems good to me too. So it's like C's include \"\" - I wasn't thinking about relative includes in other includes.\r\n",
      "created_at" : "2017-04-25T05:14:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10267#issuecomment-296910968",
      "id" : 296910968,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10267",
      "updated_at" : "2017-04-25T05:14:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/296910968",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "To clarify, the code now does what @laanwj suggested.",
      "created_at" : "2017-04-25T07:34:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10267#issuecomment-296942171",
      "id" : 296942171,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10267",
      "updated_at" : "2017-04-25T07:34:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/296942171",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "> I am not sure how to test this in a neat manner. Feedback on this would be nice. Will dig/think though.\r\n\r\nSome ideas:\r\n- RPC test that creates a tree of bitcoin config files including each other beneath the data directory\r\n- Starts a node w/ `-includeconf=<path>`\r\n- Then interrogate node over RPC to verify the files got included, in the right order\r\n\r\nTo achieve the latter the option `uacomment=` is useful, as these will be added to an array, then querying `getnetworkinfo` to see if the `(...)` part of the `subversion` matches expected content and order.",
      "created_at" : "2017-05-01T11:59:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10267#issuecomment-298323813",
      "id" : 298323813,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10267",
      "updated_at" : "2017-05-01T11:59:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298323813",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj's suggested test method seems sensible. I'm happy to review that or lend a hand implementing it. Feel free to reach me on IRC.",
      "created_at" : "2017-05-01T21:43:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10267#issuecomment-298440791",
      "id" : 298440791,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10267",
      "updated_at" : "2017-05-01T21:43:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298440791",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "Thanks for the suggestion! I added a test that checks for load order and ensures circular include is guarded against. @jnewbery review would be wonderful :)\r\n\r\nEdit: If anyone has ideas why travis is failing I'd appreciate it. It works fine on all the machines I test it on locally (mac, linux).",
      "created_at" : "2017-05-02T01:28:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10267#issuecomment-298475283",
      "id" : 298475283,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10267",
      "updated_at" : "2017-05-02T04:54:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298475283",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "> If anyone has ideas why travis is failing I'd appreciate it\r\n\r\nYou've made `ReadConfigFile()` recursive (through `ProcessSetting()`). `ReadConfigFile()` locks cs_args, and then at the end calls `ClearDatadirCache()`, which locks csPathCached. That means that the bottom-most `ReadConfigFile()` locks csPathCached while cs_args is still held.\r\n\r\nThere's already a function that locks in the other order: `GetDataDir()` locks csPathCached and then locks cs_args (in its call to `IsArgSet()`).\r\n\r\nIf those two functions are called in different threads, we'd have a deadlock.\r\n\r\nThere's a CPP_FLAG option that checks lock ordering `CPPFLAGS=-DDEBUG_LOCKORDER`, which is used in Travis build 5. That's why that build is failing. You can repro locally by running `configure` with that option.\r\n\r\nYou can fix this by not locking cs_args recursively.",
      "created_at" : "2017-05-02T15:33:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10267#issuecomment-298671493",
      "id" : 298671493,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10267",
      "updated_at" : "2017-05-02T15:33:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298671493",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "@jnewbery Thanks a lot for the explanation! I should've paid closer attention to locks considering the added recursiveness.\r\n\r\n97ee63b fixes this by moving the conditionally-locked code into a new `ReadConfigStream` function which is called with locking/clearing in one case and without in the other, based on a `bool lockAndClear` added to `ReadConfigFile`.\r\n\r\n(Also had to tweak tests a tiny bit; 8fb6511.)",
      "created_at" : "2017-05-08T04:02:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10267#issuecomment-299767955",
      "id" : 299767955,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10267",
      "updated_at" : "2017-05-08T04:02:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/299767955",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "I think you've introduced a subtle bug here. If `-datadir` is configured in one of the additional config files, then the datadir cache won't be cleared, which means that bitcoind will continue to use the old datadir.\r\n\r\nI think you should try to not make ReadConfigFile recursive. For me, it would be acceptable to only allow one level of redirection here (ie the \"base\" config file can specify `-includeconf` config file, but those included config files cannot themselves include other config files). I think that would be a simpler model and would remove a whole bunch of potential bugs (circular references, blowing the stack through too many `-includeconf` redirects, etc). ",
      "created_at" : "2017-05-15T19:57:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10267#issuecomment-301586719",
      "id" : 301586719,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10267",
      "updated_at" : "2017-05-15T19:57:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/301586719",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "@jnewbery Hm, no the datadir cache is cleared after any recursions happen, which means it is always cleared, just not directly after the config file has been parsed. There are two cases:\r\n1. ParseParameters ([util.cpp:407](https://github.com/kallewoof/bitcoin/blame/feature-config-readconfig-unsquashed/src/util.cpp#L407) called from [bitcoind.cpp:75](https://github.com/kallewoof/bitcoin/blame/feature-config-readconfig-unsquashed/src/bitcoind.cpp#L75)) -- this will work as normal and does not require cache clearing.\r\n2. Nested ReadConfigs from the initial bitcoin.conf file: [bitcoind:107](https://github.com/kallewoof/bitcoin/blame/feature-config-readconfig-unsquashed/src/bitcoind.cpp#L107) calls `ReadConfigFile` with the `lockAndClear` flag set; recursion then happens in ProcessSetting (L401) via ReadConfigStream (L622) with `lockAndClear` unset. Eventually this gets back to original caller which leaves ReadConfigStream and gets to [util.cpp:649](https://github.com/kallewoof/bitcoin/blame/feature-config-readconfig-unsquashed/src/util.cpp#L649) which clears the datadir cache.\r\nOr am I missing something?\r\n\r\nAs for forbidding multiple levels of recursion, I think the value outweighs the issues personally (and I addressed circular refs I believe), but if people think it's not worth it I'll restrict it to one include.",
      "created_at" : "2017-05-16T00:54:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10267#issuecomment-301644638",
      "id" : 301644638,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10267",
      "updated_at" : "2017-05-16T00:55:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/301644638",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   }
]
