[
   {
      "author_association" : "NONE",
      "body" : "So the `settings.json` file is becoming corrupted after the disk is full? That seems like a problem which should be avoided. I'm not sure deleting it, and removing any settings which may be important to the user should be the official solution.",
      "created_at" : "2021-03-03T01:17:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/21340#issuecomment-789349694",
      "id" : 789349694,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21340",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4OTM0OTY5NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-03T01:17:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/789349694",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22969119?v=4",
         "events_url" : "https://api.github.com/users/mattwilson888/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mattwilson888/followers",
         "following_url" : "https://api.github.com/users/mattwilson888/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mattwilson888/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mattwilson888",
         "id" : 22969119,
         "login" : "mattwilson888",
         "node_id" : "MDQ6VXNlcjIyOTY5MTE5",
         "organizations_url" : "https://api.github.com/users/mattwilson888/orgs",
         "received_events_url" : "https://api.github.com/users/mattwilson888/received_events",
         "repos_url" : "https://api.github.com/users/mattwilson888/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mattwilson888/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mattwilson888/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mattwilson888"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yes, it is a problem that should be avoided (hence \"Another thing to look into might be to write the file atomically so that this doesn't occur.\"), but even then corruption can still happen and there needs to be a way to recover. I do agree silently deleting it would not be a good thing. A dialog at startup to continue with \"reset settings\" might do the trick better.",
      "created_at" : "2021-03-03T12:01:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/21340#issuecomment-789664942",
      "id" : 789664942,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21340",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4OTY2NDk0Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-03T12:02:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/789664942",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think bitcoin-core/gui#379 should resolve this. It clarifies the error and adds an option in the gui to reset the file",
      "created_at" : "2021-07-08T19:35:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/21340#issuecomment-876692566",
      "id" : 876692566,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21340",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NjY5MjU2Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-08T19:35:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876692566",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> So the `settings.json` file is becoming corrupted after the disk is full? \r\n\r\nWhen disk is totally full on Linux, any file randomly can be truncated to 0 size (the one you will try to overwrite at that moment). Guess solution could be to rename old file to temporary name before writing the new one and deleting old one only after the new one is saved correctly?",
      "created_at" : "2021-07-08T22:13:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/21340#issuecomment-876779561",
      "id" : 876779561,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21340",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3Njc3OTU2MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-08T22:13:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876779561",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4500994?v=4",
         "events_url" : "https://api.github.com/users/kristapsk/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kristapsk/followers",
         "following_url" : "https://api.github.com/users/kristapsk/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kristapsk/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kristapsk",
         "id" : 4500994,
         "login" : "kristapsk",
         "node_id" : "MDQ6VXNlcjQ1MDA5OTQ=",
         "organizations_url" : "https://api.github.com/users/kristapsk/orgs",
         "received_events_url" : "https://api.github.com/users/kristapsk/received_events",
         "repos_url" : "https://api.github.com/users/kristapsk/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kristapsk/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kristapsk"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> When disk is totally full on Linux, any file randomly can be truncated to 0 size (the one you will try to overwrite at that moment). \r\n\r\nInteresting. Is this documented somewhere? It definitely suggests regardless of any write errors that the settings read code should be treating an empty file the same as a non-existent file, and just ignoring it instead of triggering a fatal error.\r\n\r\nThis is an easy change to make but I'd also be curious to hear from @laanwj if he knows whether the file was truncated to size 0.\r\n\r\n> Guess solution could be to rename old file to temporary name before writing the new one and deleting old one only after the new one is saved correctly?\r\n\r\nI could be misunderstanding but I think this describes what happens currently: https://github.com/bitcoin/bitcoin/blob/df2b5dadfb2dc21b05e5a60b71987fb5b96201f5/src/util/system.cpp#L572-L579, but maybe there could be additional syncs or checks added?",
      "created_at" : "2021-07-08T23:02:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/21340#issuecomment-876797245",
      "id" : 876797245,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21340",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3Njc5NzI0NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-08T23:02:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876797245",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Interesting. Is this documented somewhere?\r\n\r\nHaven't looked at the kernel code in detail for this, just my personal experience (had old blog written in PHP long long time ago where everything was saved in text files instead of proper database and file got truncated to zero bytes when partition ran out of space, IIRC code just read everything into memory, modified and then tried to overwrite old file).",
      "created_at" : "2021-07-08T23:09:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/21340#issuecomment-876800543",
      "id" : 876800543,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21340",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NjgwMDU0Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-08T23:09:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876800543",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4500994?v=4",
         "events_url" : "https://api.github.com/users/kristapsk/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kristapsk/followers",
         "following_url" : "https://api.github.com/users/kristapsk/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kristapsk/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kristapsk",
         "id" : 4500994,
         "login" : "kristapsk",
         "node_id" : "MDQ6VXNlcjQ1MDA5OTQ=",
         "organizations_url" : "https://api.github.com/users/kristapsk/orgs",
         "received_events_url" : "https://api.github.com/users/kristapsk/received_events",
         "repos_url" : "https://api.github.com/users/kristapsk/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kristapsk/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kristapsk"
      }
   }
]
