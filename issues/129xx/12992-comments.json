[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you @dooglus for bringing attention to this in #11317 and opening #11320. \r\n\r\nThis is #11320 with the following changes:\r\n * rebased on master\r\n * added the wallet name in three additional logging messages for `rpcdump.cpp`'s `importwallet` function\r\n\r\nIn #11320 @promag and @luke-jr suggested approaches to reducing the repetition of `\"[%s]\" GetName()` boilerplate. @jimpo, in the context of #12954, what are your thoughts?\r\n\r\nThis is outside of the scope of this PR and may be controversial, but I do think we would benefit from automated testing of log messages. This could either be done by checking the `debug.log` of nodes in existing tests, or as a separate test script.\r\n\r\nOpen questions:\r\n\r\n1. There are logging calls in two `WalletBatch` methods where it's not immediately apparent to me how to get the wallet's name: `WalletBatch::FindWalletTx` and `WalletBatch::RecoverKeysOnlyFilter`. Is there something I'm not seeing? If the only solution is refactoring then I'll leave them alone in this PR.\r\n\r\n2. `CWallet`'s `m_name` defaults to an empty string, so we end up with lots of empty square brackets in the log messages. Should we have a default wallet name?",
      "created_at" : "2018-04-15T22:35:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12992#issuecomment-381443567",
      "id" : 381443567,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12992",
      "updated_at" : "2018-04-15T23:38:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381443567",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/6299681?v=4",
         "events_url" : "https://api.github.com/users/PierreRochard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/PierreRochard/followers",
         "following_url" : "https://api.github.com/users/PierreRochard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/PierreRochard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/PierreRochard",
         "id" : 6299681,
         "login" : "PierreRochard",
         "organizations_url" : "https://api.github.com/users/PierreRochard/orgs",
         "received_events_url" : "https://api.github.com/users/PierreRochard/received_events",
         "repos_url" : "https://api.github.com/users/PierreRochard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/PierreRochard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/PierreRochard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/PierreRochard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I luke-jr's suggestion of `CWallet::LogPrintf`. The main benefit is not even reducing boilerplate, it's to reduce the amount of refactoring required if someone decides that there is a better way of presenting the wallet info on the log line. Also, I think it'll be more obvious that way when people add new log statements in wallet files as compared to noticing the extra log argument and having to realize that it's a standard.\r\n\r\nWith regards to #12954, I don't see any issues. Won't even be a git conflict, I don't think.\r\n\r\nThis is an example of a case where [structured logging](https://stackify.com/what-is-structured-logging-and-why-developers-need-it/) might be useful (being able to tag log statments with key-value pairs in a not-ad-hoc way). I know the Bitcoin ABC team is thinking about this.",
      "created_at" : "2018-04-16T05:39:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12992#issuecomment-381485280",
      "id" : 381485280,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12992",
      "updated_at" : "2018-04-16T05:39:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381485280",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Agree that it makes sense to move this to `CWallet::LogPrintf` instead.",
      "created_at" : "2018-04-16T13:25:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12992#issuecomment-381598320",
      "id" : 381598320,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12992",
      "updated_at" : "2018-04-16T13:25:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381598320",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12992#discussion_r181732834"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12992"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181732834"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Weird ascii characters should not be translated. You can keep the `_(\"Importing...\")` and do the string manipulation afterward",
      "commit_id" : "2a967c9c584d0799cf53231786e13b8f57f546c8",
      "created_at" : "2018-04-16T13:27:26Z",
      "diff_hunk" : "@@ -554,7 +554,7 @@ UniValue importwallet(const JSONRPCRequest& request)\n \n         // Use uiInterface.ShowProgress instead of pwallet.ShowProgress because pwallet.ShowProgress has a cancel button tied to AbortRescan which\n         // we don't want for this progress bar shoing the import progress. uiInterface.ShowProgress does not have a cancel button.\n-        uiInterface.ShowProgress(_(\"Importing...\"), 0, false); // show progress dialog in GUI\n+        uiInterface.ShowProgress(strprintf(_(\"[%s] Importing...\"), pwallet->GetName()), 0, false); // show progress dialog in GUI",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12992#discussion_r181732834",
      "id" : 181732834,
      "original_commit_id" : "2a967c9c584d0799cf53231786e13b8f57f546c8",
      "original_position" : 5,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 5,
      "pull_request_review_id" : 112412423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12992",
      "updated_at" : "2018-04-16T13:27:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181732834",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. I agree that `CWallet::LogPrintf` would be useful.",
      "created_at" : "2018-04-16T14:03:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12992#issuecomment-381610475",
      "id" : 381610475,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12992",
      "updated_at" : "2018-04-16T14:03:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381610475",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
