[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r181830064"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181830064"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 16e4c4bed66e436be606b9cfc6fa982819f00b86: Should say \"changes\"?",
      "commit_id" : "e95db395592c763e8c77f619db7a8f5dbaa0a604",
      "created_at" : "2018-04-16T17:50:32Z",
      "diff_hunk" : "@@ -93,12 +107,22 @@ class CValidationInterface {\n     /**\n      * Notifies listeners of a block being disconnected\n      *\n+     * The ordering of BlockDisconnected and TransactionRemovedFromMempool\n+     * (for transactions removed due to memory constraints or lock time/\n+     * coinbase maturity chenges during the disconnection/reorg) is undefined,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r181830064",
      "id" : 181830064,
      "original_commit_id" : "16e4c4bed66e436be606b9cfc6fa982819f00b86",
      "original_position" : 36,
      "path" : "src/validationinterface.h",
      "position" : null,
      "pull_request_review_id" : 112522481,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979",
      "updated_at" : "2018-04-17T15:26:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181830064",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r181844101"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181844101"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit ff936aeea569a2ae56a3d9096a486fbd94b6dde7: I don't understand what this comment means. Mind to elaborate or remove?\r\n\r\nEdit: I presume instead of \"copy\" you mean \"witness\", since the witness might be different and it is no longer a copy?",
      "commit_id" : "e95db395592c763e8c77f619db7a8f5dbaa0a604",
      "created_at" : "2018-04-16T18:39:30Z",
      "diff_hunk" : "@@ -575,15 +580,18 @@ void CTxMemPool::removeForBlock(const std::vector<CTransactionRef>& vtx, unsigne\n     }\n     // Before the txs in the new block have been removed from the mempool, update policy estimates\n     if (minerPolicyEstimator) {minerPolicyEstimator->processBlock(nBlockHeight, entries);}\n+    std::vector<CTransactionRef> txn_conflicts, txn_removed_in_block;\n+    txn_removed_in_block.reserve(vtx.size());\n     for (const auto& tx : vtx)\n     {\n         txiter it = mapTx.find(tx->GetHash());\n         if (it != mapTx.end()) {\n             setEntries stage;\n             stage.insert(it);\n             RemoveStaged(stage, true, MemPoolRemovalReason::BLOCK);\n+            txn_removed_in_block.push_back(tx); // Use the block's copy",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r181844101",
      "id" : 181844101,
      "original_commit_id" : "ff936aeea569a2ae56a3d9096a486fbd94b6dde7",
      "original_position" : 36,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 112522481,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979",
      "updated_at" : "2018-04-17T15:26:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181844101",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r181859836"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181859836"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in commit db156ea327577fb1455049efe047e5722a18b1ab: Could add a semicolon, dot or new line to indicate the start of a new sentence. (before REPLACED)",
      "commit_id" : "e95db395592c763e8c77f619db7a8f5dbaa0a604",
      "created_at" : "2018-04-16T19:34:41Z",
      "diff_hunk" : "@@ -418,8 +418,10 @@ bool CTxMemPool::addUnchecked(const uint256& hash, const CTxMemPoolEntry &entry,\n \n void CTxMemPool::removeUnchecked(txiter it, MemPoolRemovalReason reason)\n {\n-    if (reason != MemPoolRemovalReason::BLOCK && reason != MemPoolRemovalReason::CONFLICT) {\n-        // BLOCK and CONFLICT callbacks are generated in removeForBlock\n+    if (reason != MemPoolRemovalReason::BLOCK && reason != MemPoolRemovalReason::CONFLICT &&\n+        reason != MemPoolRemovalReason::REPLACED) {\n+        // BLOCK and CONFLICT callbacks are generated in removeForBlock REPLACED",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r181859836",
      "id" : 181859836,
      "original_commit_id" : "6b4e2a79e41401c6a39f7039b469d04e13fd3c83",
      "original_position" : 8,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 112522481,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979",
      "updated_at" : "2018-04-17T15:26:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181859836",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r181864451"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181864451"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in commit 6b4e2a79e41401c6a39f7039b469d04e13fd3c83: Could add a comment to explain why `txn_replaced` is dropped?",
      "commit_id" : "e95db395592c763e8c77f619db7a8f5dbaa0a604",
      "created_at" : "2018-04-16T19:52:17Z",
      "diff_hunk" : "@@ -165,18 +165,22 @@ void CZMQNotificationInterface::TransactionAddedToMempool(const CTransactionRef&\n     }\n }\n \n+void CZMQNotificationInterface::TransactionAddedToMempool(const CTransactionRef& ptx, const std::vector<CTransactionRef>& txn_replaced) {\n+    NotifyTransaction(ptx);\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r181864451",
      "id" : 181864451,
      "original_commit_id" : "6b4e2a79e41401c6a39f7039b469d04e13fd3c83",
      "original_position" : 15,
      "path" : "src/zmq/zmqnotificationinterface.cpp",
      "position" : null,
      "pull_request_review_id" : 112522481,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979",
      "updated_at" : "2018-04-17T15:26:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181864451",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r181865943"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181865943"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit db156ea327577fb1455049efe047e5722a18b1ab: You pass the block height, but it doesn't appear to be used anywhere?",
      "commit_id" : "e95db395592c763e8c77f619db7a8f5dbaa0a604",
      "created_at" : "2018-04-16T19:58:03Z",
      "diff_hunk" : "@@ -599,7 +599,7 @@ void CTxMemPool::removeForBlock(const std::vector<CTransactionRef>& vtx, unsigne\n         removeConflicts(*tx, txn_conflicts);\n         ClearPrioritisation(tx->GetHash());\n     }\n-    GetMainSignals().MempoolUpdatedForBlockConnect(std::move(txn_removed_in_block), std::move(txn_conflicts));\n+    GetMainSignals().MempoolUpdatedForBlockConnect(std::move(txn_removed_in_block), std::move(txn_conflicts), nBlockHeight);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r181865943",
      "id" : 181865943,
      "original_commit_id" : "db156ea327577fb1455049efe047e5722a18b1ab",
      "original_position" : 5,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 112522481,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979",
      "updated_at" : "2018-04-17T15:26:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181865943",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r182112893"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182112893"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Its used in #11775.",
      "commit_id" : "e95db395592c763e8c77f619db7a8f5dbaa0a604",
      "created_at" : "2018-04-17T15:20:28Z",
      "diff_hunk" : "@@ -599,7 +599,7 @@ void CTxMemPool::removeForBlock(const std::vector<CTransactionRef>& vtx, unsigne\n         removeConflicts(*tx, txn_conflicts);\n         ClearPrioritisation(tx->GetHash());\n     }\n-    GetMainSignals().MempoolUpdatedForBlockConnect(std::move(txn_removed_in_block), std::move(txn_conflicts));\n+    GetMainSignals().MempoolUpdatedForBlockConnect(std::move(txn_removed_in_block), std::move(txn_conflicts), nBlockHeight);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r182112893",
      "id" : 182112893,
      "in_reply_to_id" : 181865943,
      "original_commit_id" : "db156ea327577fb1455049efe047e5722a18b1ab",
      "original_position" : 5,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 112860221,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979",
      "updated_at" : "2018-04-17T15:26:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182112893",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r182112915"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182112915"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I just added a \"as per spec\" note that its clarified more in MempoolUpdatedForBlockConnect docs (\"The txn_removed_in_block txn are as they appear in the block, and may have different witnesses from the version which was previously in the mempool\").",
      "commit_id" : "e95db395592c763e8c77f619db7a8f5dbaa0a604",
      "created_at" : "2018-04-17T15:20:31Z",
      "diff_hunk" : "@@ -575,15 +580,18 @@ void CTxMemPool::removeForBlock(const std::vector<CTransactionRef>& vtx, unsigne\n     }\n     // Before the txs in the new block have been removed from the mempool, update policy estimates\n     if (minerPolicyEstimator) {minerPolicyEstimator->processBlock(nBlockHeight, entries);}\n+    std::vector<CTransactionRef> txn_conflicts, txn_removed_in_block;\n+    txn_removed_in_block.reserve(vtx.size());\n     for (const auto& tx : vtx)\n     {\n         txiter it = mapTx.find(tx->GetHash());\n         if (it != mapTx.end()) {\n             setEntries stage;\n             stage.insert(it);\n             RemoveStaged(stage, true, MemPoolRemovalReason::BLOCK);\n+            txn_removed_in_block.push_back(tx); // Use the block's copy",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r182112915",
      "id" : 182112915,
      "in_reply_to_id" : 181844101,
      "original_commit_id" : "ff936aeea569a2ae56a3d9096a486fbd94b6dde7",
      "original_position" : 36,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 112860246,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979",
      "updated_at" : "2018-04-17T15:26:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182112915",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "weak re-utACK e95db395592c763e8c77f619db7a8f5dbaa0a604 (Only changes were a rebase to solve conflicts and three minor comment clarifications)",
      "created_at" : "2018-04-17T16:02:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12979#issuecomment-382047786",
      "id" : 382047786,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12979",
      "updated_at" : "2018-04-17T16:02:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/382047786",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r182594424"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182594424"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could you break this line?",
      "commit_id" : "e95db395592c763e8c77f619db7a8f5dbaa0a604",
      "created_at" : "2018-04-18T23:05:54Z",
      "diff_hunk" : "@@ -1205,8 +1205,11 @@ void CWallet::SyncTransaction(const CTransactionRef& ptx, const CBlockIndex *pin\n     }\n }\n \n-void CWallet::TransactionAddedToMempool(const CTransactionRef& ptx) {\n+void CWallet::TransactionAddedToMempool(const CTransactionRef& ptx, const std::vector<CTransactionRef>& txn_replaced) {\n     LOCK2(cs_main, cs_wallet);\n+\n+    for (const CTransactionRef& txit : txn_replaced) TransactionRemovedFromMempool(txit, MemPoolRemovalReason::REPLACED);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r182594424",
      "id" : 182594424,
      "original_commit_id" : "e95db395592c763e8c77f619db7a8f5dbaa0a604",
      "original_position" : 8,
      "path" : "src/wallet/wallet.cpp",
      "position" : 8,
      "pull_request_review_id" : 113422037,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979",
      "updated_at" : "2018-04-18T23:05:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182594424",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r182724028"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182724028"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please no trivial changes to pull request with a ton of commits. It is always a pain to re-ACK, since a diff has to be done for every commit.",
      "commit_id" : "e95db395592c763e8c77f619db7a8f5dbaa0a604",
      "created_at" : "2018-04-19T12:12:23Z",
      "diff_hunk" : "@@ -1205,8 +1205,11 @@ void CWallet::SyncTransaction(const CTransactionRef& ptx, const CBlockIndex *pin\n     }\n }\n \n-void CWallet::TransactionAddedToMempool(const CTransactionRef& ptx) {\n+void CWallet::TransactionAddedToMempool(const CTransactionRef& ptx, const std::vector<CTransactionRef>& txn_replaced) {\n     LOCK2(cs_main, cs_wallet);\n+\n+    for (const CTransactionRef& txit : txn_replaced) TransactionRemovedFromMempool(txit, MemPoolRemovalReason::REPLACED);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r182724028",
      "id" : 182724028,
      "in_reply_to_id" : 182594424,
      "original_commit_id" : "e95db395592c763e8c77f619db7a8f5dbaa0a604",
      "original_position" : 8,
      "path" : "src/wallet/wallet.cpp",
      "position" : 8,
      "pull_request_review_id" : 113577361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979",
      "updated_at" : "2018-04-19T12:12:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182724028",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r183101106"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/183101106"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Will do when another round of changes comes in after more review, until then agree with Marco, not worth a rebase for it.",
      "commit_id" : "e95db395592c763e8c77f619db7a8f5dbaa0a604",
      "created_at" : "2018-04-20T16:15:30Z",
      "diff_hunk" : "@@ -1205,8 +1205,11 @@ void CWallet::SyncTransaction(const CTransactionRef& ptx, const CBlockIndex *pin\n     }\n }\n \n-void CWallet::TransactionAddedToMempool(const CTransactionRef& ptx) {\n+void CWallet::TransactionAddedToMempool(const CTransactionRef& ptx, const std::vector<CTransactionRef>& txn_replaced) {\n     LOCK2(cs_main, cs_wallet);\n+\n+    for (const CTransactionRef& txit : txn_replaced) TransactionRemovedFromMempool(txit, MemPoolRemovalReason::REPLACED);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12979#discussion_r183101106",
      "id" : 183101106,
      "in_reply_to_id" : 182594424,
      "original_commit_id" : "e95db395592c763e8c77f619db7a8f5dbaa0a604",
      "original_position" : 8,
      "path" : "src/wallet/wallet.cpp",
      "position" : 8,
      "pull_request_review_id" : 114040157,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12979",
      "updated_at" : "2018-04-20T16:15:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/183101106",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "I'm confused, this removes the connect trace, but it's only refactoring?",
      "created_at" : "2018-04-26T19:11:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12979#issuecomment-384757747",
      "id" : 384757747,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12979",
      "updated_at" : "2018-04-26T19:11:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/384757747",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Still a big set of commits.\r\n\r\nIt seems like it would have been simpler to do:\r\n\r\n```\r\n+void CTxMemPool::removeRecursive(const CTransaction &origTx, MemPoolRemovalReason reason, std::vector<CTransactionRef>* txn_removed) {\r\n     // Remove transaction from memory pool\r\n     LOCK(cs);\r\n     setEntries setAllRemoves;\r\n     calculateRemoveRecursive(origTx, setAllRemoves);\r\n+    if (txn_removed != nullptr) {\r\n+        for (const txiter& it : setAllRemoves) {\r\n+            txn_removed->push_back(it->GetSharedTx());\r\n+        }\r\n+    }\r\n     RemoveStaged(setAllRemoves, false, reason);\r\n }\r\n```\r\n\r\nand pass in `&txn_removed` rather than duplicate the code. That would also avoid the need to split out `calculateRemoveRecursive()` from what I can see, though maybe another PR needs it? I'm not sure that `UpdateMempoolForReorg()` shouldn't also be tracking the conflicting txs it removes and issuing a notification anyway?\r\n\r\nOtherwise:\r\n\r\n* Pass new block height through MempoolUpdatedForBlock\r\n* Remove useless scope in AcceptToMemoryPoolWorker\r\n* Remove boost::signals from txmempool, call GetMainSignals() directly\r\n* Track the set of transactions removed/conflicted in removeForBlock\r\n* Split removeRecursive into calculate/remove steps\r\n* Pass MemPoolRemovalReason out through TransactionRemovedFromMempool\r\n\r\nall look fine and straightforward (and easily reviewable/mergeable if they were all there was).\r\n\r\nI haven't verified that the comments in\r\n\r\n* Clarify validationinterface notification ordering\r\n\r\nare actually correct. For what it's worth, a commit that documented what the ordering ideally would be (after all these commits, eg) and noted any deviations from that as TODOs (which then get removed in subsequent commits as they're fixed) might be/have been better?\r\n\r\nThat leaves these commits I'm not confident about:\r\n\r\n* Add txn_replaced to Added callback, remove lReplaced ATMP arg\r\n* BlockConnected(vtxConflicted) -> New MempoolInterface callback\r\n* Add a parallel validation interface for mempool events.\r\n\r\nEDIT: ~~In particular, there's a couple of changes in the \"Add txn_replaced\" commit that deal with (un)registering MempoolInterface that seem like they should be in an earlier commit, possibly the \"parallel validation interface for mempool events\" one?~~\r\n\r\nI'm not familiar with what `ConnectTrace` does or the impact of changing that area of code to be able to be confident in the BlockConnected... commit. Having one commit that just adds `MempoolUpdatedForBlockConnect` followed by one that removes ConnectTrace might be simpler to review? The MempoolUpdateForBlockConnect parts look good at least. Seems like the switch from BasicTestingSetup to TestingSetup for policyestimator_tests.cpp should be in one of the commits in \"Move fee estimator thread\" PR?",
      "created_at" : "2018-04-26T22:58:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12979#issuecomment-384813991",
      "id" : 384813991,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12979",
      "updated_at" : "2018-04-26T23:02:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/384813991",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   }
]
