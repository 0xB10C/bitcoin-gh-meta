[
   {
      "author_association" : "NONE",
      "body" : "@ryanofsky / other qt experts - the gui signals still get called out of cs_main - do you see any potential issues there?",
      "created_at" : "2018-04-15T15:37:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12988#issuecomment-381415528",
      "id" : 381415528,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12988",
      "updated_at" : "2018-04-15T15:37:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381415528",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/195769?v=4",
         "events_url" : "https://api.github.com/users/skeees/events{/privacy}",
         "followers_url" : "https://api.github.com/users/skeees/followers",
         "following_url" : "https://api.github.com/users/skeees/following{/other_user}",
         "gists_url" : "https://api.github.com/users/skeees/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/skeees",
         "id" : 195769,
         "login" : "skeees",
         "organizations_url" : "https://api.github.com/users/skeees/orgs",
         "received_events_url" : "https://api.github.com/users/skeees/received_events",
         "repos_url" : "https://api.github.com/users/skeees/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/skeees/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/skeees/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/skeees"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @ryanofsky / other qt experts - the gui signals still get called out of cs_main - do you see any potential issues there?\r\n\r\nWould have to look into it more, but if the problem is NotifyBlockTip events being sent to the GUI in the wrong order, we should determine whether one of @TheBlueMatt's PRs fixes this. Assuming one does, it's probably sufficient for this PR to just update the `NotifyBlockTip` documentation to say that notifications can arrive at the same time from multiple threads and there are no ordering guarantees (or whatever the current situation is).",
      "created_at" : "2018-04-15T16:31:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12988#issuecomment-381419449",
      "id" : 381419449,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12988",
      "updated_at" : "2018-04-15T16:31:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381419449",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "#11856 is the one that I think you are referring to which eliminates that particular call to NotifyBlockTip and replaces it with the ValidationInterface signals",
      "created_at" : "2018-04-15T16:39:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12988#issuecomment-381419950",
      "id" : 381419950,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12988",
      "updated_at" : "2018-04-15T16:40:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381419950",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/195769?v=4",
         "events_url" : "https://api.github.com/users/skeees/events{/privacy}",
         "followers_url" : "https://api.github.com/users/skeees/followers",
         "following_url" : "https://api.github.com/users/skeees/following{/other_user}",
         "gists_url" : "https://api.github.com/users/skeees/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/skeees",
         "id" : 195769,
         "login" : "skeees",
         "organizations_url" : "https://api.github.com/users/skeees/orgs",
         "received_events_url" : "https://api.github.com/users/skeees/received_events",
         "repos_url" : "https://api.github.com/users/skeees/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/skeees/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/skeees/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/skeees"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this PR is fine as-is, the GUI I'd be surprised if it were broken, though the mining stuff may be (but #11856 pulls it all out to using validationinterface, which should be a less-likely-to-break-things fix as it doesn't introduce new lockorders). It'd also be nice to see the no-change-callbacks go away ala a9db3dada0119c183d16627805e90c4dbca05c6a since we're touching this code anyway.",
      "created_at" : "2018-04-15T16:40:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12988#issuecomment-381420079",
      "id" : 381420079,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12988",
      "updated_at" : "2018-04-15T16:40:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381420079",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I think this PR is fine as-is\r\n\r\nI think it would be good for this PR to update `NotifyBlockTip` documentation if notifications can come out of order, regardless of whether there are currently any gui bugs.",
      "created_at" : "2018-04-15T16:50:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12988#issuecomment-381420700",
      "id" : 381420700,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12988",
      "updated_at" : "2018-04-15T16:50:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381420700",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@ryanofsky - i'll update docs\r\n@TheBlueMatt - will evaluate whether feasible to cherry-pick that commit into this pr",
      "created_at" : "2018-04-15T17:25:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12988#issuecomment-381423061",
      "id" : 381423061,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12988",
      "updated_at" : "2018-04-15T17:25:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381423061",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/195769?v=4",
         "events_url" : "https://api.github.com/users/skeees/events{/privacy}",
         "followers_url" : "https://api.github.com/users/skeees/followers",
         "following_url" : "https://api.github.com/users/skeees/following{/other_user}",
         "gists_url" : "https://api.github.com/users/skeees/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/skeees",
         "id" : 195769,
         "login" : "skeees",
         "organizations_url" : "https://api.github.com/users/skeees/orgs",
         "received_events_url" : "https://api.github.com/users/skeees/received_events",
         "repos_url" : "https://api.github.com/users/skeees/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/skeees/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/skeees/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/skeees"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> @ryanofsky / other qt experts - the gui signals still get called out of cs_main - do you see any potential issues there?\r\n\r\nI expect the GUI doesn't care - it transfers the signals to a different thread anyway.",
      "created_at" : "2018-04-16T13:34:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12988#issuecomment-381600952",
      "id" : 381600952,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12988",
      "updated_at" : "2018-04-16T13:34:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381600952",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Looks good to me. I don't think https://github.com/bitcoin/bitcoin/commit/a9db3dada0119c183d16627805e90c4dbca05c6a needs to be pulled in - it's an orthogonal change for whether to fire notifications at all. It's useful, but no need to widen the scope of this PR.",
      "created_at" : "2018-04-16T14:25:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12988#issuecomment-381617714",
      "id" : 381617714,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12988",
      "updated_at" : "2018-04-16T14:25:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381617714",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Heh, @jnewbery pointed out that a9db3dada0119c183d16627805e90c4dbca05c6a doesn't actually fix it, I was looking at the wrong callback, sorry for the noise.",
      "created_at" : "2018-04-16T14:29:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12988#issuecomment-381618983",
      "id" : 381618983,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12988",
      "updated_at" : "2018-04-16T14:40:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381618983",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "As for the uiInterface callback, I think its best to move it into the cs_main as well - as @laanwj points out in the GUI its immediately pushed to a queue for main thread execution so that should be fine, and the RPCNotifyBlockChange call should be cs_main-safe as it only notify_all()s and the cs_blockchange mutex is never taken with cs_main in another thread. Obviously this really sucks and risks future bugs and I'd like to see #11856 kill the uiInterface callback there entirely, but for a backport/fix, it looks pretty safe to me with current code.",
      "created_at" : "2018-04-16T14:44:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12988#issuecomment-381624346",
      "id" : 381624346,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12988",
      "updated_at" : "2018-04-16T14:44:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381624346",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12988#discussion_r181765749"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12988"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181765749"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should add\r\n```cpp\r\nAssertLockHeld(cs_main);\r\n````\r\nto `CMainSignals::UpdatedBlockTip`? And a comment.",
      "commit_id" : "50ef361e666762d4881556d84fdc9954f1b6e0b9",
      "created_at" : "2018-04-16T14:54:15Z",
      "diff_hunk" : "@@ -2677,14 +2677,15 @@ bool CChainState::ActivateBestChain(CValidationState &state, const CChainParams&\n                 assert(trace.pblock && trace.pindex);\n                 GetMainSignals().BlockConnected(trace.pblock, trace.pindex, trace.conflictedTxs);\n             }\n+\n+            // Notify external listeners about the new tip.\n+            // Enqueue while holding cs_main to ensure that UpdatedBlockTip is called in the order in which blocks are connected\n+            GetMainSignals().UpdatedBlockTip(pindexNewTip, pindexFork, fInitialDownload);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12988#discussion_r181765749",
      "id" : 181765749,
      "original_commit_id" : "50ef361e666762d4881556d84fdc9954f1b6e0b9",
      "original_position" : 16,
      "path" : "src/validation.cpp",
      "position" : 16,
      "pull_request_review_id" : 112452843,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12988",
      "updated_at" : "2018-04-16T14:56:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181765749",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12988#discussion_r181767852"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12988"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181767852"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This means that the UI can present a tip that is not the tip?",
      "commit_id" : "50ef361e666762d4881556d84fdc9954f1b6e0b9",
      "created_at" : "2018-04-16T14:56:14Z",
      "diff_hunk" : "@@ -2677,14 +2677,15 @@ bool CChainState::ActivateBestChain(CValidationState &state, const CChainParams&\n                 assert(trace.pblock && trace.pindex);\n                 GetMainSignals().BlockConnected(trace.pblock, trace.pindex, trace.conflictedTxs);\n             }\n+\n+            // Notify external listeners about the new tip.\n+            // Enqueue while holding cs_main to ensure that UpdatedBlockTip is called in the order in which blocks are connected\n+            GetMainSignals().UpdatedBlockTip(pindexNewTip, pindexFork, fInitialDownload);\n         }\n         // When we reach this point, we switched to a new tip (stored in pindexNewTip).\n \n         // Notifications/callbacks that can run without cs_main\n \n-        // Notify external listeners about the new tip.\n-        GetMainSignals().UpdatedBlockTip(pindexNewTip, pindexFork, fInitialDownload);\n-\n         // Always notify the UI if a new block tip was connected\n         if (pindexFork != pindexNewTip) {\n             uiInterface.NotifyBlockTip(fInitialDownload, pindexNewTip);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12988#discussion_r181767852",
      "id" : 181767852,
      "original_commit_id" : "50ef361e666762d4881556d84fdc9954f1b6e0b9",
      "original_position" : 27,
      "path" : "src/validation.cpp",
      "position" : 27,
      "pull_request_review_id" : 112452843,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12988",
      "updated_at" : "2018-04-16T14:56:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181767852",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
