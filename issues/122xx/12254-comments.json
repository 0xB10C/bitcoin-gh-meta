[
   {
      "author_association" : "MEMBER",
      "body" : "Big Concept ACK, excited about this",
      "created_at" : "2018-01-24T01:57:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-359994997",
      "id" : 359994997,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-01-24T01:57:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/359994997",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Should this be labeled consensus? This is a P2P change, right?\r\n",
      "created_at" : "2018-01-24T14:36:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-360154896",
      "id" : 360154896,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-01-24T14:36:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/360154896",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@laanwj This is a data structure to be used in a P2P change. I first thought that it shouldn't be tagged \"Consensus\", but there's an argument to be made for it. It doesn't affect blockchain consensus, but it is kind of a softer P2P consensus change, where network clients (though not other full nodes) may disconnect/ban you if you serve incorrectly computed block filters. I'll let you make the call on the tag.",
      "created_at" : "2018-01-24T17:09:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-360204783",
      "id" : 360204783,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-01-24T17:09:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/360204783",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Any fork that can be resolved by a P2P adaptor that speaks both protocols is not a consensus change.",
      "created_at" : "2018-01-24T17:12:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-360205706",
      "id" : 360205706,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-01-24T17:12:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/360205706",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> This is a data structure to be used in a P2P change.\r\n\r\nThanks for the explanation. With \"consensus\" we mean the blockchain consensus rules code. Banning\\disconnecting is a P2P level issue. So changing the label to P2P.",
      "created_at" : "2018-01-24T17:19:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-360207830",
      "id" : 360207830,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-01-24T17:19:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/360207830",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Great work @jimpo!\r\nBig Concept ACK,... will help to get this done.",
      "created_at" : "2018-01-25T22:33:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-360623262",
      "id" : 360623262,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-01-25T22:33:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/360623262",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r167173632"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/167173632"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure, but I guess that comments belongs to L113?",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-02-09T09:13:33Z",
      "diff_hunk" : "@@ -0,0 +1,319 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+static constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+static constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the\n+    // result to overflow, split the numbers into the most significant and\n+    // least significant 32 bits and perform multiplication piece-wise.\n+    //\n+    // See: https://stackoverflow.com/a/26855440\n+    uint64_t x_hi = x >> 32;\n+    uint64_t x_lo = x & 0xFFFFFFFF;\n+    uint64_t n_hi = n >> 32;\n+    uint64_t n_lo = n & 0xFFFFFFFF;\n+\n+    uint64_t ac = x_hi * n_hi;\n+    uint64_t ad = x_hi * n_lo;\n+    uint64_t bc = x_lo * n_hi;\n+    uint64_t bd = x_lo * n_lo;\n+\n+    uint64_t mid34 = (bd >> 32) + (bc & 0xFFFFFFFF) + (ad & 0xFFFFFFFF);\n+    uint64_t upper64 = ac + (bc >> 32) + (ad >> 32) + (mid34 >> 32);\n+    return upper64;\n+}\n+\n+uint64_t GCSFilter::HashToRange(const Element& element) const\n+{\n+    uint64_t hash = CSipHasher(m_siphash_k0, m_siphash_k1)\n+        .Write(element.data(), element.size())\n+        .Finalize();\n+    return MapIntoRange(hash, m_F);\n+}\n+\n+std::vector<uint64_t> GCSFilter::BuildHashedSet(const std::set<Element>& elements) const\n+{\n+    std::vector<uint64_t> hashed_elements;\n+    hashed_elements.reserve(elements.size());\n+    for (const Element& element : elements) {\n+        hashed_elements.push_back(HashToRange(element));\n+    }\n+    std::sort(hashed_elements.begin(), hashed_elements.end());\n+    return hashed_elements;\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P)\n+    : m_siphash_k0(siphash_k0), m_siphash_k1(siphash_k1), m_P(P), m_N(0), m_F(0)\n+{\n+    if (m_P > 32) {\n+        throw std::invalid_argument(\"P must be <=32\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     std::vector<unsigned char> encoded_filter)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    m_encoded = std::move(encoded_filter);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    m_N = ReadCompactSize(stream);\n+    m_F = m_N << m_P;\n+\n+    if (m_N >= (1ULL << 32)) {\n+        throw std::invalid_argument(\"N must be <2^32\");\n+    }\n+\n+    // Surface any errors decoding the filter on construction.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r167173632",
      "id" : 167173632,
      "original_commit_id" : "884ebec137484daac81c208b805815ff9ee3b35c",
      "original_position" : 117,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 95354532,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/167173632",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Reviewed and tested a bit... nice, clean PR!\r\nI would wish we had more test vectors... ",
      "created_at" : "2018-02-09T09:46:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-364385727",
      "id" : 364385727,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-02-09T09:46:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/364385727",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. Would it useful to add some (hidden) RPC commands so other developers can test it?",
      "created_at" : "2018-02-09T15:14:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-364461376",
      "id" : 364461376,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-02-09T15:14:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/364461376",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@jonasschnelli Thanks for reviewing. The test vectors were generated from a Go program I have that cross-validates against the [btcsuite implementation](https://github.com/Roasbeef/btcutil/pull/6). I can easily add any specific testnet blocks to the list of cases. The blocks were chosen to exercise certain edge cases (eg. empty filters, duplicate pushdatas, invalid output scripts), but the vectors aren't commented with which edges cases they exercise. I'll add the comments, because it seems worthwhile.\r\n\r\n@Sjors I'd definitely like to see RPC commands to fetch specific filters and filter headers, but I think it makes more sense to do that after adding the filter index, so that the RPC handlers just have to look up a precomputed filter/header. (So basically, in a subsequent PR).",
      "created_at" : "2018-02-09T18:15:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-364513902",
      "id" : 364513902,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-02-09T18:47:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/364513902",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r167313633"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/167313633"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "No, the idea is that the below lines fully decode the filter in the constructor so that any errors decoding get raised during construction rather than when it is first matched against. I'll elaborate on the comment.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-02-09T18:49:12Z",
      "diff_hunk" : "@@ -0,0 +1,319 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+static constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+static constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the\n+    // result to overflow, split the numbers into the most significant and\n+    // least significant 32 bits and perform multiplication piece-wise.\n+    //\n+    // See: https://stackoverflow.com/a/26855440\n+    uint64_t x_hi = x >> 32;\n+    uint64_t x_lo = x & 0xFFFFFFFF;\n+    uint64_t n_hi = n >> 32;\n+    uint64_t n_lo = n & 0xFFFFFFFF;\n+\n+    uint64_t ac = x_hi * n_hi;\n+    uint64_t ad = x_hi * n_lo;\n+    uint64_t bc = x_lo * n_hi;\n+    uint64_t bd = x_lo * n_lo;\n+\n+    uint64_t mid34 = (bd >> 32) + (bc & 0xFFFFFFFF) + (ad & 0xFFFFFFFF);\n+    uint64_t upper64 = ac + (bc >> 32) + (ad >> 32) + (mid34 >> 32);\n+    return upper64;\n+}\n+\n+uint64_t GCSFilter::HashToRange(const Element& element) const\n+{\n+    uint64_t hash = CSipHasher(m_siphash_k0, m_siphash_k1)\n+        .Write(element.data(), element.size())\n+        .Finalize();\n+    return MapIntoRange(hash, m_F);\n+}\n+\n+std::vector<uint64_t> GCSFilter::BuildHashedSet(const std::set<Element>& elements) const\n+{\n+    std::vector<uint64_t> hashed_elements;\n+    hashed_elements.reserve(elements.size());\n+    for (const Element& element : elements) {\n+        hashed_elements.push_back(HashToRange(element));\n+    }\n+    std::sort(hashed_elements.begin(), hashed_elements.end());\n+    return hashed_elements;\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P)\n+    : m_siphash_k0(siphash_k0), m_siphash_k1(siphash_k1), m_P(P), m_N(0), m_F(0)\n+{\n+    if (m_P > 32) {\n+        throw std::invalid_argument(\"P must be <=32\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     std::vector<unsigned char> encoded_filter)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    m_encoded = std::move(encoded_filter);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    m_N = ReadCompactSize(stream);\n+    m_F = m_N << m_P;\n+\n+    if (m_N >= (1ULL << 32)) {\n+        throw std::invalid_argument(\"N must be <2^32\");\n+    }\n+\n+    // Surface any errors decoding the filter on construction.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r167313633",
      "id" : 167313633,
      "in_reply_to_id" : 167173632,
      "original_commit_id" : "884ebec137484daac81c208b805815ff9ee3b35c",
      "original_position" : 117,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 95523188,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/167313633",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r174886724"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174886724"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"streams: Create CVectorReader stream interface for vectors.\" (93f702b08e413c5c025b155bfb62b721d27939f5)\r\n\r\nThis is pretty similar to the VectorReader class @TheBlueMatt is adding here: https://github.com/TheBlueMatt/bitcoin/commit/bb608a995e8fd16d156145bf41023e7a77d44971 for https://github.com/bitcoin/bitcoin/compare/master...TheBlueMatt:2018-02-miningserver\r\n\r\nYour implementation is more general with support for deserialization in the constructor and more complete comments. But his has a `pos()` method and uses non-hungarian names which are recommended by the contrib guide. Anyway you may want to incorporate some of his changes.\r\n\r\n",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-03-15T18:29:54Z",
      "diff_hunk" : "@@ -138,6 +138,80 @@ class CVectorWriter\n     size_t nPos;\n };\n \n+/* Minimal stream for reading from an existing vector by reference\n+ */\n+class CVectorReader",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r174886724",
      "id" : 174886724,
      "original_commit_id" : "93f702b08e413c5c025b155bfb62b721d27939f5",
      "original_position" : 6,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 104327123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174886724",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r174888569"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174888569"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"streams: Create CVectorReader stream interface for vectors.\" (93f702b08e413c5c025b155bfb62b721d27939f5)\r\n\r\nIt would be nice if this just had `const unsigned char*` and `size_t` members instead of a requiring a reference to an actual vector. That way the class could be used to efficiently deserialize from any memory location, and be compatible with other containers like `std::string`.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-03-15T18:34:53Z",
      "diff_hunk" : "@@ -138,6 +138,80 @@ class CVectorWriter\n     size_t nPos;\n };\n \n+/* Minimal stream for reading from an existing vector by reference\n+ */\n+class CVectorReader\n+{\n+private:\n+    const int nType;\n+    const int nVersion;\n+    const std::vector<unsigned char>& vchData;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r174888569",
      "id" : 174888569,
      "original_commit_id" : "93f702b08e413c5c025b155bfb62b721d27939f5",
      "original_position" : 11,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 104327123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174888569",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> @Sjors I'd definitely like to see RPC commands to fetch specific filters and filter headers, but I think it makes more sense to do that after adding the filter index, so that the RPC handlers just have to look up a precomputed filter/header. (So basically, in a subsequent PR).\r\n\r\nEven a proof-of-concept PR for that would be useful for review.",
      "created_at" : "2018-03-15T19:07:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-373489502",
      "id" : 373489502,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-03-15T19:07:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373489502",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r175538303"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175538303"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "OK, I can bring that commit over instead or modify this one to remove the hungarian notation.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-03-19T18:22:00Z",
      "diff_hunk" : "@@ -138,6 +138,80 @@ class CVectorWriter\n     size_t nPos;\n };\n \n+/* Minimal stream for reading from an existing vector by reference\n+ */\n+class CVectorReader",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r175538303",
      "id" : 175538303,
      "in_reply_to_id" : 174886724,
      "original_commit_id" : "93f702b08e413c5c025b155bfb62b721d27939f5",
      "original_position" : 6,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 105083611,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175538303",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r175539924"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175539924"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'd rather not deal with raw pointers because it leaves space for unsafe accesses. If generality is a concern, I'd prefer a templated approach with random access iterators.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-03-19T18:27:18Z",
      "diff_hunk" : "@@ -138,6 +138,80 @@ class CVectorWriter\n     size_t nPos;\n };\n \n+/* Minimal stream for reading from an existing vector by reference\n+ */\n+class CVectorReader\n+{\n+private:\n+    const int nType;\n+    const int nVersion;\n+    const std::vector<unsigned char>& vchData;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r175539924",
      "id" : 175539924,
      "in_reply_to_id" : 174888569,
      "original_commit_id" : "93f702b08e413c5c025b155bfb62b721d27939f5",
      "original_position" : 11,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 105085540,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175539924",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@Sjors Here is a branch that exposes an RPC for testing/playing around: https://github.com/jimpo/bitcoin/tree/bip158-rpc. Is not intended to be merged for reasons stated [above](https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-364513902).",
      "created_at" : "2018-03-20T01:48:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-374444591",
      "id" : 374444591,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-03-20T17:31:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/374444591",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178601571"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178601571"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"streams: Implement BitStreamReader/Writer classes.\"\r\n\r\nComment for m_offset would be helpful. Maybe `//!< Number of high order bits in m_buffer already returned by previous Read() calls.`",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-04-02T17:47:00Z",
      "diff_hunk" : "@@ -509,12 +509,88 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>\n+class BitStreamReader\n+{\n+private:\n+    IStream& m_istream;\n+    uint8_t m_buffer;\n+    int m_offset;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178601571",
      "id" : 178601571,
      "original_commit_id" : "e6e320d600c70cf4d530b49f3e526cdb7e66be6d",
      "original_position" : 10,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 108683613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178601571",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178604425"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178604425"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"streams: Implement BitStreamReader/Writer classes.\"\r\n\r\nWould be nice to initialize `m_buffer`, `m_offset` above, where they are declared (see \"Initialize all non-static class members where they are defined\" guideline from https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md). Similarly in BitStreamWriter below.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-04-02T17:57:11Z",
      "diff_hunk" : "@@ -509,12 +509,88 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>\n+class BitStreamReader\n+{\n+private:\n+    IStream& m_istream;\n+    uint8_t m_buffer;\n+    int m_offset;\n \n+public:\n+    BitStreamReader(IStream& istream)\n+        : m_istream(istream), m_buffer(0), m_offset(8) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178604425",
      "id" : 178604425,
      "original_commit_id" : "e6e320d600c70cf4d530b49f3e526cdb7e66be6d",
      "original_position" : 14,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 108683613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178604425",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178605236"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178605236"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"streams: Implement BitStreamReader/Writer classes.\"\r\n\r\nWould be nice to add a simple unit test writing values to a stream with BitStreamWriter, and then making sure same values are returned from BitStreamReader.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-04-02T17:59:57Z",
      "diff_hunk" : "@@ -509,12 +509,88 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>\n+class BitStreamReader\n+{\n+private:\n+    IStream& m_istream;\n+    uint8_t m_buffer;\n+    int m_offset;\n \n+public:\n+    BitStreamReader(IStream& istream)\n+        : m_istream(istream), m_buffer(0), m_offset(8) {}\n \n+    /** Read the specified number of bits from the stream. The data is returned\n+     * in the nbits least signficant bits of a 64-bit uint.\n+     */\n+    uint64_t Read(int nbits) {\n+        if (nbits < 0 || nbits > 64) {\n+            throw std::out_of_range(\"nbits must be between 0 and 64\");\n+        }\n+\n+        uint64_t data = 0;\n+        while (nbits > 0) {\n+            if (m_offset == 8) {\n+                m_istream >> m_buffer;\n+                m_offset = 0;\n+            }\n \n+            int bits = std::min(8 - m_offset, nbits);\n+            data <<= bits;\n+            data |= static_cast<uint8_t>(m_buffer << m_offset) >> (8 - bits);\n+            m_offset += bits;\n+            nbits -= bits;\n+        }\n+        return data;\n+    }\n+};\n \n+template <typename OStream>\n+class BitStreamWriter",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178605236",
      "id" : 178605236,
      "original_commit_id" : "e6e320d600c70cf4d530b49f3e526cdb7e66be6d",
      "original_position" : 42,
      "path" : "src/streams.h",
      "position" : 126,
      "pull_request_review_id" : 108683613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178605236",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178606747"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178606747"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"streams: Implement BitStreamReader/Writer classes.\"\r\n\r\nWould be good to add destructor either asserting `m_offset == 0`, or calling Flush(). Discarding bits that have been written but not flushed seems less safe than you might want as default behavior.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-04-02T18:05:44Z",
      "diff_hunk" : "@@ -509,12 +509,88 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>\n+class BitStreamReader\n+{\n+private:\n+    IStream& m_istream;\n+    uint8_t m_buffer;\n+    int m_offset;\n \n+public:\n+    BitStreamReader(IStream& istream)\n+        : m_istream(istream), m_buffer(0), m_offset(8) {}\n \n+    /** Read the specified number of bits from the stream. The data is returned\n+     * in the nbits least signficant bits of a 64-bit uint.\n+     */\n+    uint64_t Read(int nbits) {\n+        if (nbits < 0 || nbits > 64) {\n+            throw std::out_of_range(\"nbits must be between 0 and 64\");\n+        }\n+\n+        uint64_t data = 0;\n+        while (nbits > 0) {\n+            if (m_offset == 8) {\n+                m_istream >> m_buffer;\n+                m_offset = 0;\n+            }\n \n+            int bits = std::min(8 - m_offset, nbits);\n+            data <<= bits;\n+            data |= static_cast<uint8_t>(m_buffer << m_offset) >> (8 - bits);\n+            m_offset += bits;\n+            nbits -= bits;\n+        }\n+        return data;\n+    }\n+};\n \n+template <typename OStream>\n+class BitStreamWriter\n+{\n+private:\n+    OStream& m_ostream;\n+    uint8_t m_buffer;\n+    int m_offset;\n \n+public:\n+    BitStreamWriter(OStream& ostream)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178606747",
      "id" : 178606747,
      "original_commit_id" : "e6e320d600c70cf4d530b49f3e526cdb7e66be6d",
      "original_position" : 50,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 108683613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178606747",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178608110"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178608110"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"streams: Implement BitStreamReader/Writer classes.\"\r\n\r\nWould add  `= 0; //!< Number of high-order bits in m_buffer that have been written but not yet flushed to the stream.`",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-04-02T18:10:47Z",
      "diff_hunk" : "@@ -509,12 +509,88 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>\n+class BitStreamReader\n+{\n+private:\n+    IStream& m_istream;\n+    uint8_t m_buffer;\n+    int m_offset;\n \n+public:\n+    BitStreamReader(IStream& istream)\n+        : m_istream(istream), m_buffer(0), m_offset(8) {}\n \n+    /** Read the specified number of bits from the stream. The data is returned\n+     * in the nbits least signficant bits of a 64-bit uint.\n+     */\n+    uint64_t Read(int nbits) {\n+        if (nbits < 0 || nbits > 64) {\n+            throw std::out_of_range(\"nbits must be between 0 and 64\");\n+        }\n+\n+        uint64_t data = 0;\n+        while (nbits > 0) {\n+            if (m_offset == 8) {\n+                m_istream >> m_buffer;\n+                m_offset = 0;\n+            }\n \n+            int bits = std::min(8 - m_offset, nbits);\n+            data <<= bits;\n+            data |= static_cast<uint8_t>(m_buffer << m_offset) >> (8 - bits);\n+            m_offset += bits;\n+            nbits -= bits;\n+        }\n+        return data;\n+    }\n+};\n \n+template <typename OStream>\n+class BitStreamWriter\n+{\n+private:\n+    OStream& m_ostream;\n+    uint8_t m_buffer;\n+    int m_offset;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178608110",
      "id" : 178608110,
      "original_commit_id" : "e6e320d600c70cf4d530b49f3e526cdb7e66be6d",
      "original_position" : 47,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 108683613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178608110",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178627611"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178627611"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"blockfilter: Declare GCSFilter class for BIP 158 impl.\"\r\n\r\nIt seems cumbersome for this to be implemented as a class, since none of the class members can change after construction, and some of the stored state is redundant (`m_F` is derived from `m_N` and `m_P`), `m_N` is redundant with `elements.size()` and can be derived from `m_encoded`).\r\n\r\nIf this were a simple set of functions instead, like:\r\n\r\n```c++\r\n\r\nstruct FilterParams { k0; k1; P; };\r\n\r\nvector<char> BuildFilter(FilterParams, set<Elements>);\r\n\r\nbool FilterContains(FilterParams, vector<char>, Element);\r\n\r\nbool FilterContainsAny(FilterParams, vector<char>, set<Element>);\r\n```\r\n\r\nusage would be more obvious, and you could get rid of the current runtime throws and asserts checking for inconsistencies in the state.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-04-02T19:31:35Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_BLOCKFILTER_H\n+#define BITCOIN_BLOCKFILTER_H\n+\n+#include <set>\n+#include <stdint.h>\n+#include <vector>\n+\n+#include <serialize.h>\n+#include <uint256.h>\n+\n+/**\n+ * This implements a Golomb-coded set as defined in BIP 158. It is a\n+ * compact, probabilistic data structure for testing set membership.\n+ */\n+class GCSFilter",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178627611",
      "id" : 178627611,
      "original_commit_id" : "15d529dfc2b65f2badaa520799187aff103af2b6",
      "original_position" : 19,
      "path" : "src/blockfilter.h",
      "position" : 20,
      "pull_request_review_id" : 108683613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178627611",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178629277"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178629277"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"blockfilter: Implement GCSFilter constructors.\"\r\n\r\nHere and other places, N seems like it should be 32 bits instead 64.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-04-02T19:39:04Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178629277",
      "id" : 178629277,
      "original_commit_id" : "1b1d231ed77869174c33fde97efc65b0a0044ae0",
      "original_position" : 16,
      "path" : "src/blockfilter.cpp",
      "position" : 18,
      "pull_request_review_id" : 108683613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178629277",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178630615"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178630615"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"blockfilter: Implement GCSFilter constructors.\"\r\n\r\nI wonder if the optimization below actually buys anything over a more direct:\r\n\r\n```c++\r\nfor (int i = 0; i < q; ++i) bitwriter.Write(1, 1);\r\n```",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-04-02T19:45:15Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178630615",
      "id" : 178630615,
      "original_commit_id" : "1b1d231ed77869174c33fde97efc65b0a0044ae0",
      "original_position" : 18,
      "path" : "src/blockfilter.cpp",
      "position" : 20,
      "pull_request_review_id" : 108683613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178630615",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178637016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178637016"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"blockfilter: Implement GCSFilter Match methods.\"\r\n\r\nWould suggest implementing `Match` and `MatchAny` in terms of a common\r\n\r\n```c++\r\nMatch(const uint64_t* sorted_element_hashes, size_t size)\r\n```\r\n\r\nmethod to get rid of all the code duplication between the existing methods. No outside code would need to change, they could just call \r\n\r\n```c++\r\nMatch(&query, 1);\r\nMatch(queries.data(), queries.size());\r\n```\r\n\r\nrespectively.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-04-02T20:12:15Z",
      "diff_hunk" : "@@ -153,3 +153,64 @@ GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n \n     bitwriter.Flush();\n }\n+\n+bool GCSFilter::Match(const GCSFilter::Element& element) const\n+{\n+    uint64_t query = HashToRange(element);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    // Seek forward by size of N\n+    uint64_t N = ReadCompactSize(stream);\n+    assert(N == m_N);\n+\n+    BitStreamReader<CVectorReader> bitreader(stream);\n+\n+    uint64_t value = 0;\n+    for (uint64_t i = 0; i < m_N; i++) {\n+        uint64_t delta = GolombRiceDecode(bitreader, m_P);\n+        value += delta;\n+\n+        if (query == value) {\n+            return true;\n+        } else if (query < value) {\n+            break;\n+        }\n+    }\n+\n+    return false;\n+}\n+\n+bool GCSFilter::MatchAny(const std::set<Element>& elements) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178637016",
      "id" : 178637016,
      "original_commit_id" : "fb96e966c87f27fbfdf53ad7b8fd5a3c6c679a77",
      "original_position" : 32,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 108683613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178637016",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r180940245"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/180940245"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Didn't know about that guideline. Will do.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-04-12T01:04:44Z",
      "diff_hunk" : "@@ -509,12 +509,88 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>\n+class BitStreamReader\n+{\n+private:\n+    IStream& m_istream;\n+    uint8_t m_buffer;\n+    int m_offset;\n \n+public:\n+    BitStreamReader(IStream& istream)\n+        : m_istream(istream), m_buffer(0), m_offset(8) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r180940245",
      "id" : 180940245,
      "in_reply_to_id" : 178604425,
      "original_commit_id" : "e6e320d600c70cf4d530b49f3e526cdb7e66be6d",
      "original_position" : 14,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 111451491,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/180940245",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nNice work!",
      "created_at" : "2018-04-15T06:19:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-381383206",
      "id" : 381383206,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-04-15T06:19:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381383206",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Has there been any work yet on using this to implement BIP 157? I've worked on indexing in the past, and could take a look at implementing it.",
      "created_at" : "2018-04-17T01:20:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-381799042",
      "id" : 381799042,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-04-17T01:20:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381799042",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/544777?v=4",
         "events_url" : "https://api.github.com/users/braydonf/events{/privacy}",
         "followers_url" : "https://api.github.com/users/braydonf/followers",
         "following_url" : "https://api.github.com/users/braydonf/following{/other_user}",
         "gists_url" : "https://api.github.com/users/braydonf/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/braydonf",
         "id" : 544777,
         "login" : "braydonf",
         "organizations_url" : "https://api.github.com/users/braydonf/orgs",
         "received_events_url" : "https://api.github.com/users/braydonf/received_events",
         "repos_url" : "https://api.github.com/users/braydonf/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/braydonf/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/braydonf/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/braydonf"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r181930525"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181930525"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This does not seem up to date with the latest version of BIP158 (I'll review in full later).",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-04-17T01:30:56Z",
      "diff_hunk" : "@@ -0,0 +1,323 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the\n+    // result to overflow, split the numbers into the most significant and\n+    // least significant 32 bits and perform multiplication piece-wise.\n+    //\n+    // See: https://stackoverflow.com/a/26855440\n+    uint64_t x_hi = x >> 32;\n+    uint64_t x_lo = x & 0xFFFFFFFF;\n+    uint64_t n_hi = n >> 32;\n+    uint64_t n_lo = n & 0xFFFFFFFF;\n+\n+    uint64_t ac = x_hi * n_hi;\n+    uint64_t ad = x_hi * n_lo;\n+    uint64_t bc = x_lo * n_hi;\n+    uint64_t bd = x_lo * n_lo;\n+\n+    uint64_t mid34 = (bd >> 32) + (bc & 0xFFFFFFFF) + (ad & 0xFFFFFFFF);\n+    uint64_t upper64 = ac + (bc >> 32) + (ad >> 32) + (mid34 >> 32);\n+    return upper64;\n+}\n+\n+uint64_t GCSFilter::HashToRange(const Element& element) const\n+{\n+    uint64_t hash = CSipHasher(m_siphash_k0, m_siphash_k1)\n+        .Write(element.data(), element.size())\n+        .Finalize();\n+    return MapIntoRange(hash, m_F);\n+}\n+\n+std::vector<uint64_t> GCSFilter::BuildHashedSet(const std::set<Element>& elements) const\n+{\n+    std::vector<uint64_t> hashed_elements;\n+    hashed_elements.reserve(elements.size());\n+    for (const Element& element : elements) {\n+        hashed_elements.push_back(HashToRange(element));\n+    }\n+    std::sort(hashed_elements.begin(), hashed_elements.end());\n+    return hashed_elements;\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P)\n+    : m_siphash_k0(siphash_k0), m_siphash_k1(siphash_k1), m_P(P), m_N(0), m_F(0)\n+{\n+    if (m_P > 32) {\n+        throw std::invalid_argument(\"P must be <=32\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     std::vector<unsigned char> encoded_filter)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    m_encoded = std::move(encoded_filter);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    m_N = ReadCompactSize(stream);\n+    m_F = m_N << m_P;\n+\n+    if (m_N >= (1ULL << 32)) {\n+        throw std::ios_base::failure(\"N must be <2^32\");\n+    }\n+\n+    // Verify that the encoded filter contains exactly N elements. If it has too much or too little\n+    // data, a std::ios_base::failure exception will be raised.\n+    BitStreamReader<CVectorReader> bitreader(stream);\n+    for (uint64_t i = 0; i < m_N; i++) {\n+        GolombRiceDecode(bitreader, m_P);\n+    }\n+    if (!stream.empty()) {\n+        throw std::ios_base::failure(\"encoded_filter contains excess data\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     const std::set<GCSFilter::Element>& elements)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    if (elements.size() >= (1ULL << 32)) {\n+        throw std::invalid_argument(\"N must be <2^32\");\n+    }\n+\n+    m_N = elements.size();\n+    m_F = m_N << m_P;\n+\n+    CVectorWriter stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    WriteCompactSize(stream, m_N);\n+\n+    if (elements.empty()) {\n+        return;\n+    }\n+\n+    BitStreamWriter<CVectorWriter> bitwriter(stream);\n+\n+    uint64_t last_value = 0;\n+    for (uint64_t value : BuildHashedSet(elements)) {\n+        uint64_t delta = value - last_value;\n+        GolombRiceEncode(bitwriter, m_P, delta);\n+        last_value = value;\n+    }\n+\n+    bitwriter.Flush();\n+}\n+\n+bool GCSFilter::Match(const GCSFilter::Element& element) const\n+{\n+    uint64_t query = HashToRange(element);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    // Seek forward by size of N\n+    uint64_t N = ReadCompactSize(stream);\n+    assert(N == m_N);\n+\n+    BitStreamReader<CVectorReader> bitreader(stream);\n+\n+    uint64_t value = 0;\n+    for (uint64_t i = 0; i < m_N; i++) {\n+        uint64_t delta = GolombRiceDecode(bitreader, m_P);\n+        value += delta;\n+\n+        if (query == value) {\n+            return true;\n+        } else if (query < value) {\n+            break;\n+        }\n+    }\n+\n+    return false;\n+}\n+\n+bool GCSFilter::MatchAny(const std::set<Element>& elements) const\n+{\n+    const std::vector<uint64_t>&& queries = BuildHashedSet(elements);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    // Seek forward by size of N\n+    uint64_t N = ReadCompactSize(stream);\n+    assert(N == m_N);\n+\n+    BitStreamReader<CVectorReader> bitreader(stream);\n+\n+    uint64_t value = 0;\n+    auto query_it = queries.begin();\n+    for (uint64_t i = 0; i < m_N; i++) {\n+        uint64_t delta = GolombRiceDecode(bitreader, m_P);\n+        value += delta;\n+\n+        while (true) {\n+            if (query_it == queries.end()) {\n+                return false;\n+            } else if (*query_it == value) {\n+                return true;\n+            } else if (*query_it > value) {\n+                break;\n+            }\n+\n+            query_it++;\n+        }\n+    }\n+\n+    return false;\n+}\n+\n+static std::set<GCSFilter::Element> BasicFilterElements(const CBlock& block)\n+{\n+    std::set<GCSFilter::Element> elements;\n+    for (const CTransactionRef& tx : block.vtx) {\n+        // Include txid of each transaction.\n+        const uint256& txid = tx->GetHash();\n+        elements.emplace(txid.begin(), txid.end());\n+\n+        // Include previous outpoint of each input, except for coinbase.\n+        if (!tx->IsCoinBase()) {\n+            for (const CTxIn& txin : tx->vin) {\n+                std::vector<unsigned char> ser_outpoint;\n+                CVectorWriter(GCS_SER_TYPE, GCS_SER_VERSION, ser_outpoint, 0, txin.prevout);\n+                elements.insert(std::move(ser_outpoint));\n+            }\n+        }\n+\n+        // Include all data pushes in output scripts.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r181930525",
      "id" : 181930525,
      "original_commit_id" : "68777c59c91fdcdc2967a39b70d41f215c6846ca",
      "original_position" : 237,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 112641204,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181930525",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r181987725"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181987725"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good suggestion.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-04-17T08:16:24Z",
      "diff_hunk" : "@@ -153,3 +153,64 @@ GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n \n     bitwriter.Flush();\n }\n+\n+bool GCSFilter::Match(const GCSFilter::Element& element) const\n+{\n+    uint64_t query = HashToRange(element);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    // Seek forward by size of N\n+    uint64_t N = ReadCompactSize(stream);\n+    assert(N == m_N);\n+\n+    BitStreamReader<CVectorReader> bitreader(stream);\n+\n+    uint64_t value = 0;\n+    for (uint64_t i = 0; i < m_N; i++) {\n+        uint64_t delta = GolombRiceDecode(bitreader, m_P);\n+        value += delta;\n+\n+        if (query == value) {\n+            return true;\n+        } else if (query < value) {\n+            break;\n+        }\n+    }\n+\n+    return false;\n+}\n+\n+bool GCSFilter::MatchAny(const std::set<Element>& elements) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r181987725",
      "id" : 181987725,
      "in_reply_to_id" : 178637016,
      "original_commit_id" : "fb96e966c87f27fbfdf53ad7b8fd5a3c6c679a77",
      "original_position" : 32,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 112706974,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181987725",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r181992611"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181992611"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why do you say that? This function can encode 64-bit ints if it needs to. Also, it would have to immediately get cast to a uint64_t either way.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-04-17T08:32:52Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r181992611",
      "id" : 181992611,
      "in_reply_to_id" : 178629277,
      "original_commit_id" : "1b1d231ed77869174c33fde97efc65b0a0044ae0",
      "original_position" : 16,
      "path" : "src/blockfilter.cpp",
      "position" : 18,
      "pull_request_review_id" : 112712507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181992611",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r182009549"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182009549"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added in 5f67272f5a2d8567faf7b139c0239bc2788ed8b1.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-04-17T09:27:58Z",
      "diff_hunk" : "@@ -509,12 +509,88 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>\n+class BitStreamReader\n+{\n+private:\n+    IStream& m_istream;\n+    uint8_t m_buffer;\n+    int m_offset;\n \n+public:\n+    BitStreamReader(IStream& istream)\n+        : m_istream(istream), m_buffer(0), m_offset(8) {}\n \n+    /** Read the specified number of bits from the stream. The data is returned\n+     * in the nbits least signficant bits of a 64-bit uint.\n+     */\n+    uint64_t Read(int nbits) {\n+        if (nbits < 0 || nbits > 64) {\n+            throw std::out_of_range(\"nbits must be between 0 and 64\");\n+        }\n+\n+        uint64_t data = 0;\n+        while (nbits > 0) {\n+            if (m_offset == 8) {\n+                m_istream >> m_buffer;\n+                m_offset = 0;\n+            }\n \n+            int bits = std::min(8 - m_offset, nbits);\n+            data <<= bits;\n+            data |= static_cast<uint8_t>(m_buffer << m_offset) >> (8 - bits);\n+            m_offset += bits;\n+            nbits -= bits;\n+        }\n+        return data;\n+    }\n+};\n \n+template <typename OStream>\n+class BitStreamWriter",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r182009549",
      "id" : 182009549,
      "in_reply_to_id" : 178605236,
      "original_commit_id" : "e6e320d600c70cf4d530b49f3e526cdb7e66be6d",
      "original_position" : 42,
      "path" : "src/streams.h",
      "position" : 126,
      "pull_request_review_id" : 112732372,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182009549",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r182010116"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182010116"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I originally tried something like that, but I preferred to make it an actual class. I see the ability to store derivable data in private fields and check data consistency before using the data as features of this approach.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-04-17T09:29:55Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_BLOCKFILTER_H\n+#define BITCOIN_BLOCKFILTER_H\n+\n+#include <set>\n+#include <stdint.h>\n+#include <vector>\n+\n+#include <serialize.h>\n+#include <uint256.h>\n+\n+/**\n+ * This implements a Golomb-coded set as defined in BIP 158. It is a\n+ * compact, probabilistic data structure for testing set membership.\n+ */\n+class GCSFilter",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r182010116",
      "id" : 182010116,
      "in_reply_to_id" : 178627611,
      "original_commit_id" : "15d529dfc2b65f2badaa520799187aff103af2b6",
      "original_position" : 19,
      "path" : "src/blockfilter.h",
      "position" : 20,
      "pull_request_review_id" : 112733105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182010116",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r182010184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182010184"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-04-17T09:30:10Z",
      "diff_hunk" : "@@ -0,0 +1,323 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the\n+    // result to overflow, split the numbers into the most significant and\n+    // least significant 32 bits and perform multiplication piece-wise.\n+    //\n+    // See: https://stackoverflow.com/a/26855440\n+    uint64_t x_hi = x >> 32;\n+    uint64_t x_lo = x & 0xFFFFFFFF;\n+    uint64_t n_hi = n >> 32;\n+    uint64_t n_lo = n & 0xFFFFFFFF;\n+\n+    uint64_t ac = x_hi * n_hi;\n+    uint64_t ad = x_hi * n_lo;\n+    uint64_t bc = x_lo * n_hi;\n+    uint64_t bd = x_lo * n_lo;\n+\n+    uint64_t mid34 = (bd >> 32) + (bc & 0xFFFFFFFF) + (ad & 0xFFFFFFFF);\n+    uint64_t upper64 = ac + (bc >> 32) + (ad >> 32) + (mid34 >> 32);\n+    return upper64;\n+}\n+\n+uint64_t GCSFilter::HashToRange(const Element& element) const\n+{\n+    uint64_t hash = CSipHasher(m_siphash_k0, m_siphash_k1)\n+        .Write(element.data(), element.size())\n+        .Finalize();\n+    return MapIntoRange(hash, m_F);\n+}\n+\n+std::vector<uint64_t> GCSFilter::BuildHashedSet(const std::set<Element>& elements) const\n+{\n+    std::vector<uint64_t> hashed_elements;\n+    hashed_elements.reserve(elements.size());\n+    for (const Element& element : elements) {\n+        hashed_elements.push_back(HashToRange(element));\n+    }\n+    std::sort(hashed_elements.begin(), hashed_elements.end());\n+    return hashed_elements;\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P)\n+    : m_siphash_k0(siphash_k0), m_siphash_k1(siphash_k1), m_P(P), m_N(0), m_F(0)\n+{\n+    if (m_P > 32) {\n+        throw std::invalid_argument(\"P must be <=32\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     std::vector<unsigned char> encoded_filter)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    m_encoded = std::move(encoded_filter);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    m_N = ReadCompactSize(stream);\n+    m_F = m_N << m_P;\n+\n+    if (m_N >= (1ULL << 32)) {\n+        throw std::ios_base::failure(\"N must be <2^32\");\n+    }\n+\n+    // Verify that the encoded filter contains exactly N elements. If it has too much or too little\n+    // data, a std::ios_base::failure exception will be raised.\n+    BitStreamReader<CVectorReader> bitreader(stream);\n+    for (uint64_t i = 0; i < m_N; i++) {\n+        GolombRiceDecode(bitreader, m_P);\n+    }\n+    if (!stream.empty()) {\n+        throw std::ios_base::failure(\"encoded_filter contains excess data\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     const std::set<GCSFilter::Element>& elements)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    if (elements.size() >= (1ULL << 32)) {\n+        throw std::invalid_argument(\"N must be <2^32\");\n+    }\n+\n+    m_N = elements.size();\n+    m_F = m_N << m_P;\n+\n+    CVectorWriter stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    WriteCompactSize(stream, m_N);\n+\n+    if (elements.empty()) {\n+        return;\n+    }\n+\n+    BitStreamWriter<CVectorWriter> bitwriter(stream);\n+\n+    uint64_t last_value = 0;\n+    for (uint64_t value : BuildHashedSet(elements)) {\n+        uint64_t delta = value - last_value;\n+        GolombRiceEncode(bitwriter, m_P, delta);\n+        last_value = value;\n+    }\n+\n+    bitwriter.Flush();\n+}\n+\n+bool GCSFilter::Match(const GCSFilter::Element& element) const\n+{\n+    uint64_t query = HashToRange(element);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    // Seek forward by size of N\n+    uint64_t N = ReadCompactSize(stream);\n+    assert(N == m_N);\n+\n+    BitStreamReader<CVectorReader> bitreader(stream);\n+\n+    uint64_t value = 0;\n+    for (uint64_t i = 0; i < m_N; i++) {\n+        uint64_t delta = GolombRiceDecode(bitreader, m_P);\n+        value += delta;\n+\n+        if (query == value) {\n+            return true;\n+        } else if (query < value) {\n+            break;\n+        }\n+    }\n+\n+    return false;\n+}\n+\n+bool GCSFilter::MatchAny(const std::set<Element>& elements) const\n+{\n+    const std::vector<uint64_t>&& queries = BuildHashedSet(elements);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    // Seek forward by size of N\n+    uint64_t N = ReadCompactSize(stream);\n+    assert(N == m_N);\n+\n+    BitStreamReader<CVectorReader> bitreader(stream);\n+\n+    uint64_t value = 0;\n+    auto query_it = queries.begin();\n+    for (uint64_t i = 0; i < m_N; i++) {\n+        uint64_t delta = GolombRiceDecode(bitreader, m_P);\n+        value += delta;\n+\n+        while (true) {\n+            if (query_it == queries.end()) {\n+                return false;\n+            } else if (*query_it == value) {\n+                return true;\n+            } else if (*query_it > value) {\n+                break;\n+            }\n+\n+            query_it++;\n+        }\n+    }\n+\n+    return false;\n+}\n+\n+static std::set<GCSFilter::Element> BasicFilterElements(const CBlock& block)\n+{\n+    std::set<GCSFilter::Element> elements;\n+    for (const CTransactionRef& tx : block.vtx) {\n+        // Include txid of each transaction.\n+        const uint256& txid = tx->GetHash();\n+        elements.emplace(txid.begin(), txid.end());\n+\n+        // Include previous outpoint of each input, except for coinbase.\n+        if (!tx->IsCoinBase()) {\n+            for (const CTxIn& txin : tx->vin) {\n+                std::vector<unsigned char> ser_outpoint;\n+                CVectorWriter(GCS_SER_TYPE, GCS_SER_VERSION, ser_outpoint, 0, txin.prevout);\n+                elements.insert(std::move(ser_outpoint));\n+            }\n+        }\n+\n+        // Include all data pushes in output scripts.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r182010184",
      "id" : 182010184,
      "in_reply_to_id" : 181930525,
      "original_commit_id" : "68777c59c91fdcdc2967a39b70d41f215c6846ca",
      "original_position" : 237,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 112733198,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182010184",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781309"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781309"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agree, it would be nice to align the two implementations.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-12T19:34:24Z",
      "diff_hunk" : "@@ -138,6 +138,80 @@ class CVectorWriter\n     size_t nPos;\n };\n \n+/* Minimal stream for reading from an existing vector by reference\n+ */\n+class CVectorReader",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781309",
      "id" : 187781309,
      "in_reply_to_id" : 174886724,
      "original_commit_id" : "93f702b08e413c5c025b155bfb62b721d27939f5",
      "original_position" : 6,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 119634940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781309",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781338"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781338"
         }
      },
      "author_association" : "MEMBER",
      "body" : "An alternative (which could be done later, not a blocker for this PR) is using the `Span` class that was introduced in #12886 and is being extended in #13062).",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-12T19:36:10Z",
      "diff_hunk" : "@@ -138,6 +138,80 @@ class CVectorWriter\n     size_t nPos;\n };\n \n+/* Minimal stream for reading from an existing vector by reference\n+ */\n+class CVectorReader\n+{\n+private:\n+    const int nType;\n+    const int nVersion;\n+    const std::vector<unsigned char>& vchData;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781338",
      "id" : 187781338,
      "in_reply_to_id" : 174888569,
      "original_commit_id" : "93f702b08e413c5c025b155bfb62b721d27939f5",
      "original_position" : 11,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 119634940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781338",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781729"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781729"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"streams: Implement BitStreamReader/Writer classes.\", any reason to not make these operate with a 64-bit (or even larger) buffer? That would both simplify the code (no need to loop in the read/write operations) and possibly improve performance (due to fewer read/flush calls to the underlying buffer).",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-12T19:54:16Z",
      "diff_hunk" : "@@ -509,12 +509,102 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781729",
      "id" : 187781729,
      "original_commit_id" : "f7426bde309b35cb773935f7323f7546bcbb8c5b",
      "original_position" : 4,
      "path" : "src/streams.h",
      "position" : 85,
      "pull_request_review_id" : 119634940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781729",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781753"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781753"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't understand this comment either.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-12T19:55:57Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781753",
      "id" : 187781753,
      "in_reply_to_id" : 178629277,
      "original_commit_id" : "1b1d231ed77869174c33fde97efc65b0a0044ae0",
      "original_position" : 16,
      "path" : "src/blockfilter.cpp",
      "position" : 18,
      "pull_request_review_id" : 119634940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781753",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781789"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781789"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps add a note here to use `unsigned __int128` on supported platforms; that should be significantly faster than doing 4 separate multiplications.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-12T19:57:45Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781789",
      "id" : 187781789,
      "original_commit_id" : "c0815aa428d36d0ce0dc788e397e4e17066f708b",
      "original_position" : 53,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 119634940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781789",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187782008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187782008"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think the reference type is useful here; copy elision should apply, and otherwise at worst a move will occur.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-12T20:07:54Z",
      "diff_hunk" : "@@ -153,3 +153,47 @@ GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n \n     bitwriter.Flush();\n }\n+\n+bool GCSFilter::MatchInternal(const uint64_t* element_hashes, size_t size) const\n+{\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    // Seek forward by size of N\n+    uint64_t N = ReadCompactSize(stream);\n+    assert(N == m_N);\n+\n+    BitStreamReader<CVectorReader> bitreader(stream);\n+\n+    uint64_t value = 0;\n+    int hashes_index = 0;\n+    for (uint64_t i = 0; i < m_N; i++) {\n+        uint64_t delta = GolombRiceDecode(bitreader, m_P);\n+        value += delta;\n+\n+        while (true) {\n+            if (hashes_index == size) {\n+                return false;\n+            } else if (element_hashes[hashes_index] == value) {\n+                return true;\n+            } else if (element_hashes[hashes_index] > value) {\n+                break;\n+            }\n+\n+            hashes_index++;\n+        }\n+    }\n+\n+    return false;\n+}\n+\n+bool GCSFilter::Match(const GCSFilter::Element& element) const\n+{\n+    uint64_t query = HashToRange(element);\n+    return MatchInternal(&query, 1);\n+}\n+\n+bool GCSFilter::MatchAny(const std::set<Element>& elements) const\n+{\n+    const std::vector<uint64_t>&& queries = BuildHashedSet(elements);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187782008",
      "id" : 187782008,
      "original_commit_id" : "a780779b3a8f8e7daf270b4f1355dbcaf31e56fd",
      "original_position" : 45,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 119634940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187782008",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187782029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187782029"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is this worth it? The filter will be decoded twice in practice due to this?",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-12T20:08:57Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the\n+    // result to overflow, split the numbers into the most significant and\n+    // least significant 32 bits and perform multiplication piece-wise.\n+    //\n+    // See: https://stackoverflow.com/a/26855440\n+    uint64_t x_hi = x >> 32;\n+    uint64_t x_lo = x & 0xFFFFFFFF;\n+    uint64_t n_hi = n >> 32;\n+    uint64_t n_lo = n & 0xFFFFFFFF;\n+\n+    uint64_t ac = x_hi * n_hi;\n+    uint64_t ad = x_hi * n_lo;\n+    uint64_t bc = x_lo * n_hi;\n+    uint64_t bd = x_lo * n_lo;\n+\n+    uint64_t mid34 = (bd >> 32) + (bc & 0xFFFFFFFF) + (ad & 0xFFFFFFFF);\n+    uint64_t upper64 = ac + (bc >> 32) + (ad >> 32) + (mid34 >> 32);\n+    return upper64;\n+}\n+\n+uint64_t GCSFilter::HashToRange(const Element& element) const\n+{\n+    uint64_t hash = CSipHasher(m_siphash_k0, m_siphash_k1)\n+        .Write(element.data(), element.size())\n+        .Finalize();\n+    return MapIntoRange(hash, m_F);\n+}\n+\n+std::vector<uint64_t> GCSFilter::BuildHashedSet(const std::set<Element>& elements) const\n+{\n+    std::vector<uint64_t> hashed_elements;\n+    hashed_elements.reserve(elements.size());\n+    for (const Element& element : elements) {\n+        hashed_elements.push_back(HashToRange(element));\n+    }\n+    std::sort(hashed_elements.begin(), hashed_elements.end());\n+    return hashed_elements;\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P)\n+    : m_siphash_k0(siphash_k0), m_siphash_k1(siphash_k1), m_P(P), m_N(0), m_F(0)\n+{\n+    if (m_P > 32) {\n+        throw std::invalid_argument(\"P must be <=32\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     std::vector<unsigned char> encoded_filter)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    m_encoded = std::move(encoded_filter);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    m_N = ReadCompactSize(stream);\n+    m_F = m_N << m_P;\n+\n+    if (m_N >= (1ULL << 32)) {\n+        throw std::ios_base::failure(\"N must be <2^32\");\n+    }\n+\n+    // Verify that the encoded filter contains exactly N elements. If it has too much or too little",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187782029",
      "id" : 187782029,
      "original_commit_id" : "c0815aa428d36d0ce0dc788e397e4e17066f708b",
      "original_position" : 115,
      "path" : "src/blockfilter.cpp",
      "position" : 120,
      "pull_request_review_id" : 119634940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187782029",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187809813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187809813"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perhaps could improve performance, but it'd be trickier to handle streams that are not aligned on 8-byte boundaries. Since the buffer size is an implementation detail, would you be OK leaving that optimization for a later PR?",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-13T18:42:21Z",
      "diff_hunk" : "@@ -509,12 +509,102 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187809813",
      "id" : 187809813,
      "in_reply_to_id" : 187781729,
      "original_commit_id" : "f7426bde309b35cb773935f7323f7546bcbb8c5b",
      "original_position" : 4,
      "path" : "src/streams.h",
      "position" : 85,
      "pull_request_review_id" : 119663169,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187809813",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187810229"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187810229"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'll drop it if people prefer. I think having the constructor check its input makes for a better API. I'd also note that Core won't actually use these match methods unless it implements a light client mode -- they are just here for completeness and testing.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-13T18:59:32Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the\n+    // result to overflow, split the numbers into the most significant and\n+    // least significant 32 bits and perform multiplication piece-wise.\n+    //\n+    // See: https://stackoverflow.com/a/26855440\n+    uint64_t x_hi = x >> 32;\n+    uint64_t x_lo = x & 0xFFFFFFFF;\n+    uint64_t n_hi = n >> 32;\n+    uint64_t n_lo = n & 0xFFFFFFFF;\n+\n+    uint64_t ac = x_hi * n_hi;\n+    uint64_t ad = x_hi * n_lo;\n+    uint64_t bc = x_lo * n_hi;\n+    uint64_t bd = x_lo * n_lo;\n+\n+    uint64_t mid34 = (bd >> 32) + (bc & 0xFFFFFFFF) + (ad & 0xFFFFFFFF);\n+    uint64_t upper64 = ac + (bc >> 32) + (ad >> 32) + (mid34 >> 32);\n+    return upper64;\n+}\n+\n+uint64_t GCSFilter::HashToRange(const Element& element) const\n+{\n+    uint64_t hash = CSipHasher(m_siphash_k0, m_siphash_k1)\n+        .Write(element.data(), element.size())\n+        .Finalize();\n+    return MapIntoRange(hash, m_F);\n+}\n+\n+std::vector<uint64_t> GCSFilter::BuildHashedSet(const std::set<Element>& elements) const\n+{\n+    std::vector<uint64_t> hashed_elements;\n+    hashed_elements.reserve(elements.size());\n+    for (const Element& element : elements) {\n+        hashed_elements.push_back(HashToRange(element));\n+    }\n+    std::sort(hashed_elements.begin(), hashed_elements.end());\n+    return hashed_elements;\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P)\n+    : m_siphash_k0(siphash_k0), m_siphash_k1(siphash_k1), m_P(P), m_N(0), m_F(0)\n+{\n+    if (m_P > 32) {\n+        throw std::invalid_argument(\"P must be <=32\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     std::vector<unsigned char> encoded_filter)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    m_encoded = std::move(encoded_filter);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    m_N = ReadCompactSize(stream);\n+    m_F = m_N << m_P;\n+\n+    if (m_N >= (1ULL << 32)) {\n+        throw std::ios_base::failure(\"N must be <2^32\");\n+    }\n+\n+    // Verify that the encoded filter contains exactly N elements. If it has too much or too little",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187810229",
      "id" : 187810229,
      "in_reply_to_id" : 187782029,
      "original_commit_id" : "c0815aa428d36d0ce0dc788e397e4e17066f708b",
      "original_position" : 115,
      "path" : "src/blockfilter.cpp",
      "position" : 120,
      "pull_request_review_id" : 119663586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187810229",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187810670"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187810670"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, let's look at this later. It would complicate the reader indeed. For the writer I think it's pretty straightfoward.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-13T19:14:53Z",
      "diff_hunk" : "@@ -509,12 +509,102 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187810670",
      "id" : 187810670,
      "in_reply_to_id" : 187781729,
      "original_commit_id" : "f7426bde309b35cb773935f7323f7546bcbb8c5b",
      "original_position" : 4,
      "path" : "src/streams.h",
      "position" : 85,
      "pull_request_review_id" : 119664021,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187810670",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187810728"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187810728"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I expect we'll start using it for rescanning pretty quickly, regardless of protocol implementations.\r\n\r\nDo you have any numbers for how fast it is to iterate through a 10000 element set or so?",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-13T19:16:51Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the\n+    // result to overflow, split the numbers into the most significant and\n+    // least significant 32 bits and perform multiplication piece-wise.\n+    //\n+    // See: https://stackoverflow.com/a/26855440\n+    uint64_t x_hi = x >> 32;\n+    uint64_t x_lo = x & 0xFFFFFFFF;\n+    uint64_t n_hi = n >> 32;\n+    uint64_t n_lo = n & 0xFFFFFFFF;\n+\n+    uint64_t ac = x_hi * n_hi;\n+    uint64_t ad = x_hi * n_lo;\n+    uint64_t bc = x_lo * n_hi;\n+    uint64_t bd = x_lo * n_lo;\n+\n+    uint64_t mid34 = (bd >> 32) + (bc & 0xFFFFFFFF) + (ad & 0xFFFFFFFF);\n+    uint64_t upper64 = ac + (bc >> 32) + (ad >> 32) + (mid34 >> 32);\n+    return upper64;\n+}\n+\n+uint64_t GCSFilter::HashToRange(const Element& element) const\n+{\n+    uint64_t hash = CSipHasher(m_siphash_k0, m_siphash_k1)\n+        .Write(element.data(), element.size())\n+        .Finalize();\n+    return MapIntoRange(hash, m_F);\n+}\n+\n+std::vector<uint64_t> GCSFilter::BuildHashedSet(const std::set<Element>& elements) const\n+{\n+    std::vector<uint64_t> hashed_elements;\n+    hashed_elements.reserve(elements.size());\n+    for (const Element& element : elements) {\n+        hashed_elements.push_back(HashToRange(element));\n+    }\n+    std::sort(hashed_elements.begin(), hashed_elements.end());\n+    return hashed_elements;\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P)\n+    : m_siphash_k0(siphash_k0), m_siphash_k1(siphash_k1), m_P(P), m_N(0), m_F(0)\n+{\n+    if (m_P > 32) {\n+        throw std::invalid_argument(\"P must be <=32\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     std::vector<unsigned char> encoded_filter)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    m_encoded = std::move(encoded_filter);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    m_N = ReadCompactSize(stream);\n+    m_F = m_N << m_P;\n+\n+    if (m_N >= (1ULL << 32)) {\n+        throw std::ios_base::failure(\"N must be <2^32\");\n+    }\n+\n+    // Verify that the encoded filter contains exactly N elements. If it has too much or too little",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187810728",
      "id" : 187810728,
      "in_reply_to_id" : 187782029,
      "original_commit_id" : "c0815aa428d36d0ce0dc788e397e4e17066f708b",
      "original_position" : 115,
      "path" : "src/blockfilter.cpp",
      "position" : 120,
      "pull_request_review_id" : 119664076,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187810728",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187839783"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187839783"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-14T05:35:31Z",
      "diff_hunk" : "@@ -138,6 +138,80 @@ class CVectorWriter\n     size_t nPos;\n };\n \n+/* Minimal stream for reading from an existing vector by reference\n+ */\n+class CVectorReader",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187839783",
      "id" : 187839783,
      "in_reply_to_id" : 174886724,
      "original_commit_id" : "93f702b08e413c5c025b155bfb62b721d27939f5",
      "original_position" : 6,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 119697928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187839783",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187839843"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187839843"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed in 07df98686ec423dcf38ac28ad8e325708cb5b902.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-14T05:36:20Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187839843",
      "id" : 187839843,
      "in_reply_to_id" : 187781789,
      "original_commit_id" : "c0815aa428d36d0ce0dc788e397e4e17066f708b",
      "original_position" : 53,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 119698018,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187839843",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187840056"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187840056"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Benchmarks added in f1b341a9262f24ff72b5961538f83ffbf532d8d9. Decoding a 10,000 element filter and matching against one missing element takes about 20us, and grows linearly in the number of elements (as expected).",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-14T05:38:00Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the\n+    // result to overflow, split the numbers into the most significant and\n+    // least significant 32 bits and perform multiplication piece-wise.\n+    //\n+    // See: https://stackoverflow.com/a/26855440\n+    uint64_t x_hi = x >> 32;\n+    uint64_t x_lo = x & 0xFFFFFFFF;\n+    uint64_t n_hi = n >> 32;\n+    uint64_t n_lo = n & 0xFFFFFFFF;\n+\n+    uint64_t ac = x_hi * n_hi;\n+    uint64_t ad = x_hi * n_lo;\n+    uint64_t bc = x_lo * n_hi;\n+    uint64_t bd = x_lo * n_lo;\n+\n+    uint64_t mid34 = (bd >> 32) + (bc & 0xFFFFFFFF) + (ad & 0xFFFFFFFF);\n+    uint64_t upper64 = ac + (bc >> 32) + (ad >> 32) + (mid34 >> 32);\n+    return upper64;\n+}\n+\n+uint64_t GCSFilter::HashToRange(const Element& element) const\n+{\n+    uint64_t hash = CSipHasher(m_siphash_k0, m_siphash_k1)\n+        .Write(element.data(), element.size())\n+        .Finalize();\n+    return MapIntoRange(hash, m_F);\n+}\n+\n+std::vector<uint64_t> GCSFilter::BuildHashedSet(const std::set<Element>& elements) const\n+{\n+    std::vector<uint64_t> hashed_elements;\n+    hashed_elements.reserve(elements.size());\n+    for (const Element& element : elements) {\n+        hashed_elements.push_back(HashToRange(element));\n+    }\n+    std::sort(hashed_elements.begin(), hashed_elements.end());\n+    return hashed_elements;\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P)\n+    : m_siphash_k0(siphash_k0), m_siphash_k1(siphash_k1), m_P(P), m_N(0), m_F(0)\n+{\n+    if (m_P > 32) {\n+        throw std::invalid_argument(\"P must be <=32\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     std::vector<unsigned char> encoded_filter)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    m_encoded = std::move(encoded_filter);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    m_N = ReadCompactSize(stream);\n+    m_F = m_N << m_P;\n+\n+    if (m_N >= (1ULL << 32)) {\n+        throw std::ios_base::failure(\"N must be <2^32\");\n+    }\n+\n+    // Verify that the encoded filter contains exactly N elements. If it has too much or too little",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187840056",
      "id" : 187840056,
      "in_reply_to_id" : 187782029,
      "original_commit_id" : "c0815aa428d36d0ce0dc788e397e4e17066f708b",
      "original_position" : 115,
      "path" : "src/blockfilter.cpp",
      "position" : 120,
      "pull_request_review_id" : 119698257,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187840056",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa Thanks for the review. I agree on the extended filter -- I have dropped it from this PR. The code is in a new branch https://github.com/jimpo/bitcoin/tree/bip-158-extended in case it becomes useful in the future.",
      "created_at" : "2018-05-14T05:41:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-388702764",
      "id" : 388702764,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-05-14T05:41:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388702764",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK f1b341a9262f24ff72b5961538f83ffbf532d8d9\r\nI think this is a good and sane start since this is not used yet. I wish there would be more test vectors.",
      "created_at" : "2018-05-14T06:19:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-388708714",
      "id" : 388708714,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-05-14T06:19:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388708714",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187978111"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187978111"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "k should be checked < 64 to avoid right shift overflow, which could trigger a platform specific response. I know this is practically excluded with m_P <= 32, but if that is the safety net then there is also no need to check nbits <= 64 in bit stream read and write.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-14T14:39:32Z",
      "diff_hunk" : "@@ -0,0 +1,266 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187978111",
      "id" : 187978111,
      "original_commit_id" : "f1b341a9262f24ff72b5961538f83ffbf532d8d9",
      "original_position" : 18,
      "path" : "src/blockfilter.cpp",
      "position" : 18,
      "pull_request_review_id" : 119864048,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187978111",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4289351?v=4",
         "events_url" : "https://api.github.com/users/tamasblummer/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tamasblummer/followers",
         "following_url" : "https://api.github.com/users/tamasblummer/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tamasblummer/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tamasblummer",
         "id" : 4289351,
         "login" : "tamasblummer",
         "organizations_url" : "https://api.github.com/users/tamasblummer/orgs",
         "received_events_url" : "https://api.github.com/users/tamasblummer/received_events",
         "repos_url" : "https://api.github.com/users/tamasblummer/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tamasblummer/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tamasblummer/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tamasblummer"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187978488"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187978488"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "same here with k < 64 to avoid shift left overflow",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-14T14:40:34Z",
      "diff_hunk" : "@@ -0,0 +1,266 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187978488",
      "id" : 187978488,
      "original_commit_id" : "f1b341a9262f24ff72b5961538f83ffbf532d8d9",
      "original_position" : 35,
      "path" : "src/blockfilter.cpp",
      "position" : 35,
      "pull_request_review_id" : 119864543,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187978488",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4289351?v=4",
         "events_url" : "https://api.github.com/users/tamasblummer/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tamasblummer/followers",
         "following_url" : "https://api.github.com/users/tamasblummer/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tamasblummer/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tamasblummer",
         "id" : 4289351,
         "login" : "tamasblummer",
         "organizations_url" : "https://api.github.com/users/tamasblummer/orgs",
         "received_events_url" : "https://api.github.com/users/tamasblummer/received_events",
         "repos_url" : "https://api.github.com/users/tamasblummer/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tamasblummer/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tamasblummer/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tamasblummer"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187995873"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187995873"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not sure this assertion would add much. The reason for the check in the BitStreamReader/Writer is because it is part of a public interface. This function (and decode) are static within this compilation unit and thus part of a private interface.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-14T15:26:05Z",
      "diff_hunk" : "@@ -0,0 +1,266 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187995873",
      "id" : 187995873,
      "in_reply_to_id" : 187978111,
      "original_commit_id" : "f1b341a9262f24ff72b5961538f83ffbf532d8d9",
      "original_position" : 18,
      "path" : "src/blockfilter.cpp",
      "position" : 18,
      "pull_request_review_id" : 119885833,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187995873",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188012208"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188012208"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks, that is fine then. I did not check the visibility.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-14T16:13:19Z",
      "diff_hunk" : "@@ -0,0 +1,266 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188012208",
      "id" : 188012208,
      "in_reply_to_id" : 187978111,
      "original_commit_id" : "f1b341a9262f24ff72b5961538f83ffbf532d8d9",
      "original_position" : 18,
      "path" : "src/blockfilter.cpp",
      "position" : 18,
      "pull_request_review_id" : 119906053,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188012208",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4289351?v=4",
         "events_url" : "https://api.github.com/users/tamasblummer/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tamasblummer/followers",
         "following_url" : "https://api.github.com/users/tamasblummer/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tamasblummer/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tamasblummer",
         "id" : 4289351,
         "login" : "tamasblummer",
         "organizations_url" : "https://api.github.com/users/tamasblummer/orgs",
         "received_events_url" : "https://api.github.com/users/tamasblummer/received_events",
         "repos_url" : "https://api.github.com/users/tamasblummer/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tamasblummer/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tamasblummer/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tamasblummer"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188021443"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188021443"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "shouldn't GolombRiceEncode and GolombRiceEncode  functions be rather members of GCSFilter since they always use its initialized m_P as k ?",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-14T16:43:48Z",
      "diff_hunk" : "@@ -0,0 +1,266 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188021443",
      "id" : 188021443,
      "in_reply_to_id" : 187978111,
      "original_commit_id" : "f1b341a9262f24ff72b5961538f83ffbf532d8d9",
      "original_position" : 18,
      "path" : "src/blockfilter.cpp",
      "position" : 18,
      "pull_request_review_id" : 119917244,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188021443",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4289351?v=4",
         "events_url" : "https://api.github.com/users/tamasblummer/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tamasblummer/followers",
         "following_url" : "https://api.github.com/users/tamasblummer/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tamasblummer/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tamasblummer",
         "id" : 4289351,
         "login" : "tamasblummer",
         "organizations_url" : "https://api.github.com/users/tamasblummer/orgs",
         "received_events_url" : "https://api.github.com/users/tamasblummer/received_events",
         "repos_url" : "https://api.github.com/users/tamasblummer/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tamasblummer/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tamasblummer/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tamasblummer"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188043478"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188043478"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "comments would not hurt here. P Golomb-Rice Parameter (2^P), N number of elements in set. F is derived from P and N, so it better would not be here at all. ",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-14T17:57:37Z",
      "diff_hunk" : "@@ -0,0 +1,140 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_BLOCKFILTER_H\n+#define BITCOIN_BLOCKFILTER_H\n+\n+#include <set>\n+#include <stdint.h>\n+#include <vector>\n+\n+#include <primitives/block.h>\n+#include <serialize.h>\n+#include <uint256.h>\n+\n+/**\n+ * This implements a Golomb-coded set as defined in BIP 158. It is a\n+ * compact, probabilistic data structure for testing set membership.\n+ */\n+class GCSFilter\n+{\n+public:\n+    typedef std::vector<unsigned char> Element;\n+\n+private:\n+    uint64_t m_siphash_k0;\n+    uint64_t m_siphash_k1;\n+    uint8_t m_P;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188043478",
      "id" : 188043478,
      "original_commit_id" : "f1b341a9262f24ff72b5961538f83ffbf532d8d9",
      "original_position" : 28,
      "path" : "src/blockfilter.h",
      "position" : null,
      "pull_request_review_id" : 119943482,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188043478",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4289351?v=4",
         "events_url" : "https://api.github.com/users/tamasblummer/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tamasblummer/followers",
         "following_url" : "https://api.github.com/users/tamasblummer/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tamasblummer/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tamasblummer",
         "id" : 4289351,
         "login" : "tamasblummer",
         "organizations_url" : "https://api.github.com/users/tamasblummer/orgs",
         "received_events_url" : "https://api.github.com/users/tamasblummer/received_events",
         "repos_url" : "https://api.github.com/users/tamasblummer/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tamasblummer/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tamasblummer/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tamasblummer"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188053959"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188053959"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Agree with @jimpo, used IStream and OStream should be buffered implementations, not this specific algo. ",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-14T18:31:54Z",
      "diff_hunk" : "@@ -509,12 +509,102 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188053959",
      "id" : 188053959,
      "in_reply_to_id" : 187781729,
      "original_commit_id" : "f7426bde309b35cb773935f7323f7546bcbb8c5b",
      "original_position" : 4,
      "path" : "src/streams.h",
      "position" : 85,
      "pull_request_review_id" : 119956120,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188053959",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4289351?v=4",
         "events_url" : "https://api.github.com/users/tamasblummer/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tamasblummer/followers",
         "following_url" : "https://api.github.com/users/tamasblummer/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tamasblummer/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tamasblummer",
         "id" : 4289351,
         "login" : "tamasblummer",
         "organizations_url" : "https://api.github.com/users/tamasblummer/orgs",
         "received_events_url" : "https://api.github.com/users/tamasblummer/received_events",
         "repos_url" : "https://api.github.com/users/tamasblummer/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tamasblummer/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tamasblummer/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tamasblummer"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Why match on the txid of each transaction? I can't imagine a use-case where you'd ever want that where you couldn't simply match by one (or multiple) of the output scripts for little additional cost.",
      "created_at" : "2018-05-14T19:54:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-388941774",
      "id" : 388941774,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-05-14T19:54:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388941774",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188079506"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188079506"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I prefer they be standalone functions.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-14T20:02:07Z",
      "diff_hunk" : "@@ -0,0 +1,266 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188079506",
      "id" : 188079506,
      "in_reply_to_id" : 187978111,
      "original_commit_id" : "f1b341a9262f24ff72b5961538f83ffbf532d8d9",
      "original_position" : 18,
      "path" : "src/blockfilter.cpp",
      "position" : 18,
      "pull_request_review_id" : 119987435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188079506",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@TheBlueMatt I can definitely think of use cases where one only has the txid. For example, if a lightning wallet wants to determine if a channel exists, it only gets the txid from the `channel_announcement`.\r\n\r\nI definitely think txids should be included in a filter, though I think there's a valid argument for putting them in their own filter given that a basic wallet does not need them.",
      "created_at" : "2018-05-14T20:07:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-388945360",
      "id" : 388945360,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-05-14T20:07:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388945360",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm? channel_announcement messages don't contain a txid, they contain a block number/tx index/txo index, which is obviously way more effecient than storing all the filters (which are pretty huge, in total), scanning all of them, and then downloading the corresponding block to verify the transaction is there (of course an SPV Proof is much more effecient in either case).\n\nOn May 14, 2018 8:07:17 PM UTC, Jim Posen <notifications@github.com> wrote:\n>@TheBlueMatt I can definitely think of use cases where one only has the\n>txid. For example, if a lightning wallet wants to determine if a\n>channel exists, it only gets the txid from the `channel_announcement`.\n>\n>I definitely think txids should be included in a filter, though I think\n>there's a valid argument for putting them in their own filter given\n>that a basic wallet does not need them.\n>\n>-- \n>You are receiving this because you were mentioned.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-388945360\n",
      "created_at" : "2018-05-14T20:12:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-388946819",
      "id" : 388946819,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-05-14T20:12:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388946819",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "You're right, I forgot that channel_announcement uses the short ID instead of the channel ID.\r\n\r\nGiven that it would be a BIP change, I think the conversation about whether to remove TXID from the basic filter and move it to another filter (or drop entirely) is better had on the mailing list.",
      "created_at" : "2018-05-14T22:20:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-388981463",
      "id" : 388981463,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-05-14T22:20:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388981463",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188208980"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188208980"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`size_t`?",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-15T08:48:09Z",
      "diff_hunk" : "@@ -138,6 +138,80 @@ class CVectorWriter\n     size_t nPos;\n };\n \n+/* Minimal stream for reading from an existing vector by reference\n+ */\n+class VectorReader\n+{\n+private:\n+    const int m_type;\n+    const int m_version;\n+    const std::vector<unsigned char>& m_data;\n+    size_t m_pos = 0;\n+\n+public:\n+\n+    /*\n+     * @param[in]  type Serialization Type\n+     * @param[in]  version Serialization Version (including any flags)\n+     * @param[in]  data Referenced byte vector to overwrite/append\n+     * @param[in]  pos Starting position. Vector index where reads should start.\n+     */\n+    VectorReader(int type, int version, const std::vector<unsigned char>& data, size_t pos)\n+        : m_type(type), m_version(version), m_data(data)\n+    {\n+        seek(pos);\n+    }\n+\n+    /*\n+     * (other params same as above)\n+     * @param[in]  args  A list of items to deserialize starting at pos.\n+     */\n+    template <typename... Args>\n+    VectorReader(int type, int version, const std::vector<unsigned char>& data, size_t pos,\n+                  Args&&... args)\n+        : VectorReader(type, version, data, pos)\n+    {\n+        ::UnserializeMany(*this, std::forward<Args>(args)...);\n+    }\n+\n+    template<typename T>\n+    VectorReader& operator>>(T& obj)\n+    {\n+        // Unserialize from this stream\n+        ::Unserialize(*this, obj);\n+        return (*this);\n+    }\n+\n+    int GetVersion() const { return m_version; }\n+    int GetType() const { return m_type; }\n+\n+    size_t size() const { return m_data.size() - m_pos; }\n+    bool empty() const { return m_data.size() == m_pos; }\n+\n+    void read(char* dst, size_t n)\n+    {\n+        if (n == 0) {\n+            return;\n+        }\n+\n+        // Read from the beginning of the buffer\n+        unsigned int pos_next = m_pos + n;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188208980",
      "id" : 188208980,
      "original_commit_id" : "5a339f4118cc65a09d2321628e0db3102361c552",
      "original_position" : 61,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 120137580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188208980",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188209476"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188209476"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Comment says signed, but it is unsigned.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-15T08:49:43Z",
      "diff_hunk" : "@@ -71,6 +71,51 @@ BOOST_AUTO_TEST_CASE(streams_vector_writer)\n     vch.clear();\n }\n \n+BOOST_AUTO_TEST_CASE(streams_vector_reader)\n+{\n+    std::vector<unsigned char> vch = {1, 255, 3, 4, 5, 6};\n+\n+    VectorReader reader(SER_NETWORK, INIT_PROTO_VERSION, vch, 0);\n+    BOOST_CHECK_EQUAL(reader.size(), 6);\n+    BOOST_CHECK(!reader.empty());\n+\n+    // Read a single byte as an unsigned char.\n+    unsigned char a;\n+    reader >> a;\n+    BOOST_CHECK_EQUAL(a, 1);\n+    BOOST_CHECK_EQUAL(reader.size(), 5);\n+    BOOST_CHECK(!reader.empty());\n+\n+    // Read a single byte as a signed char.\n+    char b;\n+    reader >> b;\n+    BOOST_CHECK_EQUAL(b, -1);\n+    BOOST_CHECK_EQUAL(reader.size(), 4);\n+    BOOST_CHECK(!reader.empty());\n+\n+    // Read a 4 bytes as a signed int.\n+    unsigned int c;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188209476",
      "id" : 188209476,
      "original_commit_id" : "7a77fc51df74916707b1a6c0ad8583c93de91824",
      "original_position" : 27,
      "path" : "src/test/streams_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 120137580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188209476",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188209813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188209813"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`d` is a `signed int`, comment says `unsigned int`.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-15T08:50:46Z",
      "diff_hunk" : "@@ -71,6 +71,51 @@ BOOST_AUTO_TEST_CASE(streams_vector_writer)\n     vch.clear();\n }\n \n+BOOST_AUTO_TEST_CASE(streams_vector_reader)\n+{\n+    std::vector<unsigned char> vch = {1, 255, 3, 4, 5, 6};\n+\n+    VectorReader reader(SER_NETWORK, INIT_PROTO_VERSION, vch, 0);\n+    BOOST_CHECK_EQUAL(reader.size(), 6);\n+    BOOST_CHECK(!reader.empty());\n+\n+    // Read a single byte as an unsigned char.\n+    unsigned char a;\n+    reader >> a;\n+    BOOST_CHECK_EQUAL(a, 1);\n+    BOOST_CHECK_EQUAL(reader.size(), 5);\n+    BOOST_CHECK(!reader.empty());\n+\n+    // Read a single byte as a signed char.\n+    char b;\n+    reader >> b;\n+    BOOST_CHECK_EQUAL(b, -1);\n+    BOOST_CHECK_EQUAL(reader.size(), 4);\n+    BOOST_CHECK(!reader.empty());\n+\n+    // Read a 4 bytes as a signed int.\n+    unsigned int c;\n+    reader >> c;\n+    BOOST_CHECK_EQUAL(c, 100992003); // 3,4,5,6 in little-endian base-256\n+    BOOST_CHECK_EQUAL(reader.size(), 0);\n+    BOOST_CHECK(reader.empty());\n+\n+    // Reading after end of byte vector throws an error.\n+    signed int d;\n+    BOOST_CHECK_THROW(reader >> d, std::ios_base::failure);\n+\n+    // Read a 4 bytes as an unsigned int from the beginning of the buffer.\n+    reader.seek(-6);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188209813",
      "id" : 188209813,
      "original_commit_id" : "7a77fc51df74916707b1a6c0ad8583c93de91824",
      "original_position" : 38,
      "path" : "src/test/streams_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 120137580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188209813",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188211827"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188211827"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe also include a really high value (e.g. using all 64 bits). These are all single-byte values and will not test the looping part at all, I think?",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-15T08:56:59Z",
      "diff_hunk" : "@@ -116,6 +116,36 @@ BOOST_AUTO_TEST_CASE(streams_vector_reader)\n     BOOST_CHECK_THROW(reader >> d, std::ios_base::failure);\n }\n \n+BOOST_AUTO_TEST_CASE(bitstream_reader_writer)\n+{\n+    CDataStream data(SER_NETWORK, INIT_PROTO_VERSION);\n+\n+    BitStreamWriter<CDataStream> bit_writer(data);\n+    bit_writer.Write(0, 1);\n+    bit_writer.Write(2, 2);\n+    bit_writer.Write(6, 3);\n+    bit_writer.Write(11, 4);\n+    bit_writer.Write(1, 5);\n+    bit_writer.Write(32, 6);\n+    bit_writer.Write(7, 7);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188211827",
      "id" : 188211827,
      "original_commit_id" : "84ecb19ab6bf7d96c21c7100d49fad48fc1ac73d",
      "original_position" : 15,
      "path" : "src/test/streams_tests.cpp",
      "position" : 60,
      "pull_request_review_id" : 120137580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188211827",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188218055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188218055"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I recommend avoiding actual random values for unit tests, as generating random data is expensive and the tests may end up failing only sporadically, making it harder to debug (run the test 10 times and see the error once kinda thing).\r\n\r\nA simple approach is to use a random generator \"manually\" once to generate 200 random numbers as a big static vector. Another is to do e.g. `srand(12345);` once and then use `rand()`, but I'm not sure if that has downsides (or if it's slow, too).",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-15T09:16:31Z",
      "diff_hunk" : "@@ -0,0 +1,35 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <random.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_AUTO_TEST_SUITE(blockfilter_tests)\n+\n+BOOST_AUTO_TEST_CASE(gcsfilter_test)\n+{\n+    std::set<GCSFilter::Element> included_elements, excluded_elements;\n+    for (int i = 0; i < 100; ++i) {\n+        GCSFilter::Element rand1(32);\n+        GetRandBytes(rand1.data(), rand1.size());\n+        included_elements.insert(std::move(rand1));\n+\n+        GCSFilter::Element rand2(32);\n+        GetRandBytes(rand2.data(), rand2.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188218055",
      "id" : 188218055,
      "original_commit_id" : "a10dc09b7f968b904b136ab09e8959d52f8229ff",
      "original_position" : 21,
      "path" : "src/test/blockfilter_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 120137580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188218055",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188220185"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188220185"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe also check that `prevout(36e, 1)` is not a match while at it.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-15T09:23:57Z",
      "diff_hunk" : "@@ -32,4 +36,37 @@ BOOST_AUTO_TEST_CASE(gcsfilter_test)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(blockfilter_basic_test)\n+{\n+    CBlock block = getBlock13b8a();\n+    BlockFilter block_filter(BlockFilterType::BASIC, block);\n+    const GCSFilter& filter = block_filter.GetFilter();\n+\n+    // TXID of first non-coinbase tx in block.\n+    const uint256& txid = uint256S(\"f9fc751cb7dc372406a9f8d738d5e6f8f63bab71986a39cf36ee70ee17036d07\");\n+    GCSFilter::Element txid_element(txid.begin(), txid.end());\n+    BOOST_CHECK(filter.Match(txid_element));\n+\n+    // Outpoint spent by first non-coinbase tx in block.\n+    COutPoint prevout(uint256S(\"36e8f98c5f5733f88ca00dfa05afd7af5dc34dda802790daba6aa1afcb8c6096\"), 0);\n+    GCSFilter::Element prevout_element;\n+    CVectorWriter(SER_NETWORK, 0, prevout_element, 0, prevout);\n+    BOOST_CHECK(filter.Match(prevout_element));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188220185",
      "id" : 188220185,
      "original_commit_id" : "d7f8d3838ae4a7a5043351d81791ded96903761f",
      "original_position" : 32,
      "path" : "src/test/blockfilter_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 120137580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188220185",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188223873"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188223873"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note use of `GetRandBytes` here as well. Potential inconsistency in test outcomes and potential slowdown.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-15T09:35:53Z",
      "diff_hunk" : "@@ -0,0 +1,42 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <random.h>\n+#include <blockfilter.h>\n+\n+static void ConstructGCSFilter(benchmark::State& state)\n+{\n+    std::set<GCSFilter::Element> elements;\n+    for (int i = 0; i < 10000; i++) {\n+        GCSFilter::Element element(32);\n+        GetRandBytes(element.data(), element.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188223873",
      "id" : 188223873,
      "original_commit_id" : "f1b341a9262f24ff72b5961538f83ffbf532d8d9",
      "original_position" : 14,
      "path" : "src/bench/gcs_filter.cpp",
      "position" : null,
      "pull_request_review_id" : 120137580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188223873",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188416389"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188416389"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good idea.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-15T19:56:32Z",
      "diff_hunk" : "@@ -32,4 +36,37 @@ BOOST_AUTO_TEST_CASE(gcsfilter_test)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(blockfilter_basic_test)\n+{\n+    CBlock block = getBlock13b8a();\n+    BlockFilter block_filter(BlockFilterType::BASIC, block);\n+    const GCSFilter& filter = block_filter.GetFilter();\n+\n+    // TXID of first non-coinbase tx in block.\n+    const uint256& txid = uint256S(\"f9fc751cb7dc372406a9f8d738d5e6f8f63bab71986a39cf36ee70ee17036d07\");\n+    GCSFilter::Element txid_element(txid.begin(), txid.end());\n+    BOOST_CHECK(filter.Match(txid_element));\n+\n+    // Outpoint spent by first non-coinbase tx in block.\n+    COutPoint prevout(uint256S(\"36e8f98c5f5733f88ca00dfa05afd7af5dc34dda802790daba6aa1afcb8c6096\"), 0);\n+    GCSFilter::Element prevout_element;\n+    CVectorWriter(SER_NETWORK, 0, prevout_element, 0, prevout);\n+    BOOST_CHECK(filter.Match(prevout_element));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188416389",
      "id" : 188416389,
      "in_reply_to_id" : 188220185,
      "original_commit_id" : "d7f8d3838ae4a7a5043351d81791ded96903761f",
      "original_position" : 32,
      "path" : "src/test/blockfilter_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 120390684,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188416389",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188418596"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188418596"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's testing the looping part insofar as some of the writes crossed byte boundaries, but I also added a write/read of a 2-byte value.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-15T20:04:03Z",
      "diff_hunk" : "@@ -116,6 +116,36 @@ BOOST_AUTO_TEST_CASE(streams_vector_reader)\n     BOOST_CHECK_THROW(reader >> d, std::ios_base::failure);\n }\n \n+BOOST_AUTO_TEST_CASE(bitstream_reader_writer)\n+{\n+    CDataStream data(SER_NETWORK, INIT_PROTO_VERSION);\n+\n+    BitStreamWriter<CDataStream> bit_writer(data);\n+    bit_writer.Write(0, 1);\n+    bit_writer.Write(2, 2);\n+    bit_writer.Write(6, 3);\n+    bit_writer.Write(11, 4);\n+    bit_writer.Write(1, 5);\n+    bit_writer.Write(32, 6);\n+    bit_writer.Write(7, 7);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188418596",
      "id" : 188418596,
      "in_reply_to_id" : 188211827,
      "original_commit_id" : "84ecb19ab6bf7d96c21c7100d49fad48fc1ac73d",
      "original_position" : 15,
      "path" : "src/test/streams_tests.cpp",
      "position" : 60,
      "pull_request_review_id" : 120393476,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:04:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188418596",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188418651"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188418651"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed the rand.",
      "commit_id" : "669599d3503dc8a44098c70cddccf510be98e1f6",
      "created_at" : "2018-05-15T20:04:17Z",
      "diff_hunk" : "@@ -0,0 +1,35 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <random.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_AUTO_TEST_SUITE(blockfilter_tests)\n+\n+BOOST_AUTO_TEST_CASE(gcsfilter_test)\n+{\n+    std::set<GCSFilter::Element> included_elements, excluded_elements;\n+    for (int i = 0; i < 100; ++i) {\n+        GCSFilter::Element rand1(32);\n+        GetRandBytes(rand1.data(), rand1.size());\n+        included_elements.insert(std::move(rand1));\n+\n+        GCSFilter::Element rand2(32);\n+        GetRandBytes(rand2.data(), rand2.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188418651",
      "id" : 188418651,
      "in_reply_to_id" : 188218055,
      "original_commit_id" : "a10dc09b7f968b904b136ab09e8959d52f8229ff",
      "original_position" : 21,
      "path" : "src/test/blockfilter_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 120393541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-05-15T20:04:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188418651",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-utACK 669599d",
      "created_at" : "2018-05-16T01:01:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-389361376",
      "id" : 389361376,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-05-16T01:01:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/389361376",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Agree with @jimpo: dropping the txid filter check should be addresses via the BIP.",
      "created_at" : "2018-05-16T06:25:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-389408689",
      "id" : 389408689,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-05-16T06:25:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/389408689",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   }
]
