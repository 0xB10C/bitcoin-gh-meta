[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14802](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14802.html) (rpc: faster getblockstats using BlockUndo data by FelixWeis)\n* [#13903](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/13903.html) (Significantly reduce GetTransaction cs_main locking (TheBlueMatt) by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-01-14T02:18:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15159#issuecomment-453888281",
      "id" : 453888281,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15159",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1Mzg4ODI4MQ==",
      "updated_at" : "2019-01-14T02:18:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/453888281",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15159#discussion_r247495265"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15159"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/247495265"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`pblockindex == nullptr` will always hold here, right?",
      "commit_id" : "51fe3e42f6cfcf36870f9742acc65aba0e3c5c65",
      "created_at" : "2019-01-14T13:42:47Z",
      "diff_hunk" : "@@ -247,30 +246,19 @@ static UniValue gettxoutproof(const JSONRPCRequest& request)\n             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block not found\");\n         }\n     } else {\n-        LOCK(cs_main);\n-\n-        // Loop through txids and try to find which block they're in. Exit loop once a block is found.\n-        for (const auto& tx : setTxids) {\n-            const Coin& coin = AccessByTxid(*pcoinsTip, tx);\n-            if (!coin.IsSpent()) {\n-                pblockindex = chainActive[coin.nHeight];\n-                break;\n-            }\n+        if (!g_txindex) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"blockhash must be provided when txindex is disabled.\");\n         }\n-    }\n-\n \n-    // Allow txindex to catch up if we need to query it and before we acquire cs_main.\n-    if (g_txindex && !pblockindex) {\n-        g_txindex->BlockUntilSyncedToCurrentChain();\n-    }\n+        // Allow txindex to catch up if we need to query it and before we acquire cs_main.\n+        if (!pblockindex) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15159#discussion_r247495265",
      "id" : 247495265,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NzQ5NTI2NQ==",
      "original_commit_id" : "51fe3e42f6cfcf36870f9742acc65aba0e3c5c65",
      "original_position" : 51,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 51,
      "pull_request_review_id" : 192155988,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15159",
      "updated_at" : "2019-01-14T13:42:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/247495265",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15159#discussion_r247495398"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15159"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/247495398"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Missing whitespace after `,` :-)",
      "commit_id" : "51fe3e42f6cfcf36870f9742acc65aba0e3c5c65",
      "created_at" : "2019-01-14T13:43:06Z",
      "diff_hunk" : "@@ -23,6 +23,7 @@ class WalletTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.num_nodes = 4\n         self.setup_clean_chain = True\n+        self.extra_args = [[],[], [\"-txindex\"], []]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15159#discussion_r247495398",
      "id" : 247495398,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NzQ5NTM5OA==",
      "original_commit_id" : "51fe3e42f6cfcf36870f9742acc65aba0e3c5c65",
      "original_position" : 4,
      "path" : "test/functional/wallet_basic.py",
      "position" : 4,
      "pull_request_review_id" : 192156116,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15159",
      "updated_at" : "2019-01-14T13:43:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/247495398",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2019-01-14T15:37:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15159#issuecomment-454048324",
      "id" : 454048324,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15159",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDA0ODMyNA==",
      "updated_at" : "2019-01-14T15:37:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454048324",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Slightly tend to NACK. If I am not mistaken, this will force some user to enable `-txindex`, which seems unintended. Otherwise they might run into a race condition where they are first notified of a tx in the mempool, then try to `getrawtransaction` that tx, which might sometimes fail because it was added to a block in the meantime.",
      "created_at" : "2019-01-14T15:48:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15159#issuecomment-454052375",
      "id" : 454052375,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15159",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDA1MjM3NQ==",
      "updated_at" : "2019-01-14T15:48:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454052375",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15159#discussion_r247544918"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15159"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/247544918"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd personally remove the `NOTE: ` here (adding \"Note:\" or \"Note that\" almost always adds zero information to a sentence :slightly_smiling_face: )",
      "commit_id" : "51fe3e42f6cfcf36870f9742acc65aba0e3c5c65",
      "created_at" : "2019-01-14T15:50:17Z",
      "diff_hunk" : "@@ -67,12 +67,11 @@ static UniValue getrawtransaction(const JSONRPCRequest& request)\n     if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n         throw std::runtime_error(\n             RPCHelpMan{\"getrawtransaction\",\n-                \"\\nNOTE: By default this function only works for mempool transactions. If the -txindex option is\\n\"\n-                \"enabled, it also works for blockchain transactions. If the block which contains the transaction\\n\"\n-                \"is known, its hash can be provided even for nodes without -txindex. Note that if a blockhash is\\n\"\n-                \"provided, only that block will be searched and if the transaction is in the mempool or other\\n\"\n-                \"blocks, or if this node does not have the given block available, the transaction will not be found.\\n\"\n-            \"DEPRECATED: for now, it also works for transactions with unspent outputs.\\n\"\n+                \"\\nNOTE: By default this function only works for mempool transactions. When called with a blockhash\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15159#discussion_r247544918",
      "id" : 247544918,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NzU0NDkxOA==",
      "original_commit_id" : "51fe3e42f6cfcf36870f9742acc65aba0e3c5c65",
      "original_position" : 10,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 10,
      "pull_request_review_id" : 192219663,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15159",
      "updated_at" : "2019-01-14T15:50:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/247544918",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Otherwise they might run into a race condition where they are first notified of a tx in the mempool, then try to getrawtransaction that tx, which might sometimes fail because it was added to a block in the meantime.\r\n\r\nEven without this change, that race condition exists (if the tx's outputs are spent in the same block).\r\n\r\nI think the race is sufficiently rare that it's not realistically an issue, but we should definitely make sure that the error messages are clear enough in this case - ie it's explicit that the tx was not found in the mempool.",
      "created_at" : "2019-01-14T15:53:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15159#issuecomment-454054251",
      "id" : 454054251,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15159",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDA1NDI1MQ==",
      "updated_at" : "2019-01-14T15:53:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454054251",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
