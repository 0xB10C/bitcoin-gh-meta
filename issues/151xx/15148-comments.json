[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Possibly related to #15015 ",
      "created_at" : "2019-01-12T06:15:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15148#issuecomment-453723312",
      "id" : 453723312,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15148",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MzcyMzMxMg==",
      "updated_at" : "2019-01-12T06:15:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/453723312",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@RomanBelkov some questions:\r\n - does the RPC interface stops responding?\r\n - I assume you have `-txindex`?\r\n - Have you tweaked `-rpcthreads` and `rpcworkqueue`?\r\n - How big is the wallet? (transaction count, address count) \r\n\r\nIf it happens again please dump the process threads.",
      "created_at" : "2019-01-28T18:59:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15148#issuecomment-458257507",
      "id" : 458257507,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15148",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1ODI1NzUwNw==",
      "updated_at" : "2019-01-28T18:59:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/458257507",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@promag \r\n\r\n- We receive timeouts (no answer for 60 seconds) for all RPC calls at some point of time. After 4-5 minutes from first timed out request bitcoind stops any disk I/O.\r\n- No, actually we do not use `txindex`.\r\n- I have tweaked the `-rpcthreads` in the range from 8 to 64, but was unable to find any effect on freezes. I have never tweaked `-rpcworkqueue`, because I failed to find any good pieces of advice on how to tune this parameter.\r\n- Can you please give some advice on how to track these values? I have only the rough estimate of 300.000 addresses.\r\n\r\nSorry if this is a newbie question, but how do you dump the process threads for bitcoind? If there is a special guide for fine tuning/debugging the node, can you please share it with me so I won't ask any basic questions? ",
      "created_at" : "2019-01-29T12:12:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15148#issuecomment-458518013",
      "id" : 458518013,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15148",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1ODUxODAxMw==",
      "updated_at" : "2019-01-29T12:12:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/458518013",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5811999?v=4",
         "events_url" : "https://api.github.com/users/RomanBelkov/events{/privacy}",
         "followers_url" : "https://api.github.com/users/RomanBelkov/followers",
         "following_url" : "https://api.github.com/users/RomanBelkov/following{/other_user}",
         "gists_url" : "https://api.github.com/users/RomanBelkov/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/RomanBelkov",
         "id" : 5811999,
         "login" : "RomanBelkov",
         "node_id" : "MDQ6VXNlcjU4MTE5OTk=",
         "organizations_url" : "https://api.github.com/users/RomanBelkov/orgs",
         "received_events_url" : "https://api.github.com/users/RomanBelkov/received_events",
         "repos_url" : "https://api.github.com/users/RomanBelkov/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/RomanBelkov/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/RomanBelkov/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/RomanBelkov"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> bitcoind stops any disk I/O.\r\n\r\nHow do you check that? And what happens with new calls? Are they rejected or they also timeout?\r\n\r\n> we do not use txindex\r\n\r\nIt doesn't matter for `validateaddress` but calls to `getrawtransaction` are serialized, in other words, you don't have concurrency there. And your wallet might be big enough to cause slow `getrawtransactions`.\r\n\r\n> how to track these values\r\n\r\nYou can call `getwalletinfo` to see transaction count. You can run `dumpwallet` to see how many keys you have.\r\n\r\n> dump the process threads for bitcoind\r\n\r\nTry `ps -T -p <pid>` to view process threads. You could also enable `-debug` and check `debug.log`.\r\n\r\nI'd be surprise if your node is deadlock, but it's hard to tell from your feedback.  Have you tried running a newer version?",
      "created_at" : "2019-01-29T14:28:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15148#issuecomment-458559769",
      "id" : 458559769,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15148",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1ODU1OTc2OQ==",
      "updated_at" : "2019-01-29T14:28:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/458559769",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> How do you check that? And what happens with new calls? Are they rejected or they also timeout?\r\n\r\nI believe that we use some collectd monitoring for this node right now and it shows clearly that no I/O is performed by the process. If we check the debug log (we started to run it with -debug=1), the last messages would be something like\r\n```\r\n2019-01-25 13:55:33 ping timeout: 1200.021239s\r\n2019-01-25 13:55:33 disconnecting peer=3\r\n2019-01-25 14:40:03\r\n-----a considerable amount of newlines-----\r\n2019-01-25 14:40:03 Bitcoin Core version v0.16.3 (release build)\r\n```\r\nAll the RPC requests are timed out as soon as we hit the freeze.\r\n\r\nRegarding the `validateaddress/getrawtransaction` -- we've introduced the caches on our side to reduce the load on the node and it did not help.\r\n\r\nTransaction count is 230160.\r\nI am yet unable to perform `dumpwallet` due to various reasons for this wallet.\r\nHowever, I've tried running the `listaddressgroupings` RPC method and received a node freeze. The node thread dump after I/O stoppage:\r\n```\r\nPID  SPID TTY          TIME CMD\r\n 9603  9603 ?        00:00:33 bitcoind\r\n 9603  9604 ?        00:00:28 bitcoin-scriptc\r\n 9603  9605 ?        00:00:28 bitcoin-scriptc\r\n 9603  9606 ?        00:00:28 bitcoin-scriptc\r\n 9603  9607 ?        00:04:50 bitcoin-schedul\r\n 9603  9608 ?        00:00:19 bitcoin-http\r\n 9603  9609 ?        00:17:44 bitcoin-httpwor\r\n 9603  9610 ?        00:14:01 bitcoin-httpwor\r\n 9603  9611 ?        00:12:45 bitcoin-httpwor\r\n 9603  9612 ?        00:14:01 bitcoin-httpwor\r\n 9603  9613 ?        00:24:09 bitcoin-httpwor\r\n 9603  9614 ?        00:15:27 bitcoin-httpwor\r\n 9603  9615 ?        00:14:23 bitcoin-httpwor\r\n 9603  9616 ?        00:14:58 bitcoin-httpwor\r\n 9603  9617 ?        00:13:25 bitcoin-httpwor\r\n 9603  9618 ?        00:13:34 bitcoin-httpwor\r\n 9603  9619 ?        00:15:15 bitcoin-httpwor\r\n 9603  9620 ?        00:13:24 bitcoin-httpwor\r\n 9603  9621 ?        00:15:10 bitcoin-httpwor\r\n 9603  9622 ?        00:14:34 bitcoin-httpwor\r\n 9603  9623 ?        00:15:52 bitcoin-httpwor\r\n 9603  9624 ?        00:13:47 bitcoin-httpwor\r\n 9603  9836 ?        00:00:39 bitcoind\r\n 9603 10578 ?        00:00:00 bitcoin-torcont\r\n 9603 10585 ?        00:00:18 bitcoin-net\r\n 9603 10587 ?        00:00:00 bitcoin-addcon\r\n 9603 10588 ?        00:00:01 bitcoin-opencon\r\n 9603 10589 ?        00:01:38 bitcoin-msghand\r\n```",
      "created_at" : "2019-01-30T14:50:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15148#issuecomment-458971395",
      "id" : 458971395,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15148",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1ODk3MTM5NQ==",
      "updated_at" : "2019-01-30T15:21:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/458971395",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5811999?v=4",
         "events_url" : "https://api.github.com/users/RomanBelkov/events{/privacy}",
         "followers_url" : "https://api.github.com/users/RomanBelkov/followers",
         "following_url" : "https://api.github.com/users/RomanBelkov/following{/other_user}",
         "gists_url" : "https://api.github.com/users/RomanBelkov/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/RomanBelkov",
         "id" : 5811999,
         "login" : "RomanBelkov",
         "node_id" : "MDQ6VXNlcjU4MTE5OTk=",
         "organizations_url" : "https://api.github.com/users/RomanBelkov/orgs",
         "received_events_url" : "https://api.github.com/users/RomanBelkov/received_events",
         "repos_url" : "https://api.github.com/users/RomanBelkov/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/RomanBelkov/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/RomanBelkov/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/RomanBelkov"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@promag \r\nHere also is the thread dump when the node freezes 'naturally'.\r\n```\r\nPID  SPID TTY          TIME CMD\r\n1858  1858 ?        00:00:38 bitcoind\r\n1858  1859 ?        00:00:44 bitcoin-scriptc\r\n1858  1860 ?        00:00:44 bitcoin-scriptc\r\n1858  1861 ?        00:00:44 bitcoin-scriptc\r\n1858  1862 ?        00:07:16 bitcoin-schedul\r\n1858  1863 ?        00:00:40 bitcoin-http\r\n1858  1864 ?        00:30:45 bitcoin-httpwor\r\n1858  1865 ?        00:28:41 bitcoin-httpwor\r\n1858  1866 ?        00:31:43 bitcoin-httpwor\r\n1858  1867 ?        00:30:00 bitcoin-httpwor\r\n1858  1868 ?        00:35:15 bitcoin-httpwor\r\n1858  1869 ?        00:31:24 bitcoin-httpwor\r\n1858  1870 ?        00:33:17 bitcoin-httpwor\r\n1858  1871 ?        00:38:23 bitcoin-httpwor\r\n1858  1872 ?        00:35:16 bitcoin-httpwor\r\n1858  1873 ?        00:34:52 bitcoin-httpwor\r\n1858  1874 ?        00:30:29 bitcoin-httpwor\r\n1858  1875 ?        00:32:15 bitcoin-httpwor\r\n1858  1876 ?        00:36:47 bitcoin-httpwor\r\n1858  1877 ?        00:33:09 bitcoin-httpwor\r\n1858  1878 ?        00:28:32 bitcoin-httpwor\r\n1858  1879 ?        00:30:34 bitcoin-httpwor\r\n1858  2159 ?        00:00:00 bitcoind\r\n1858  3907 ?        00:00:00 bitcoin-torcont\r\n1858  3911 ?        00:00:46 bitcoin-net\r\n1858  3913 ?        00:00:00 bitcoin-addcon\r\n1858  3914 ?        00:00:02 bitcoin-opencon\r\n1858  3915 ?        00:03:30 bitcoin-msghand\r\n```\r\n\r\nI have also found out that calling `listaddressgroupings` during our usual node load _always_ causes node to freeze.\r\n\r\n> Have you tried running a newer version?\r\n\r\nNo, we have not, unfortunately.",
      "created_at" : "2019-01-31T10:59:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15148#issuecomment-459303187",
      "id" : 459303187,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15148",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1OTMwMzE4Nw==",
      "updated_at" : "2019-01-31T11:06:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/459303187",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5811999?v=4",
         "events_url" : "https://api.github.com/users/RomanBelkov/events{/privacy}",
         "followers_url" : "https://api.github.com/users/RomanBelkov/followers",
         "following_url" : "https://api.github.com/users/RomanBelkov/following{/other_user}",
         "gists_url" : "https://api.github.com/users/RomanBelkov/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/RomanBelkov",
         "id" : 5811999,
         "login" : "RomanBelkov",
         "node_id" : "MDQ6VXNlcjU4MTE5OTk=",
         "organizations_url" : "https://api.github.com/users/RomanBelkov/orgs",
         "received_events_url" : "https://api.github.com/users/RomanBelkov/received_events",
         "repos_url" : "https://api.github.com/users/RomanBelkov/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/RomanBelkov/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/RomanBelkov/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/RomanBelkov"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@promag what would be the next logical step to overcome the issue? Trying to upgrade to 0.17.x?",
      "created_at" : "2019-02-28T09:50:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15148#issuecomment-468208112",
      "id" : 468208112,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15148",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2ODIwODExMg==",
      "updated_at" : "2019-02-28T09:50:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/468208112",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5811999?v=4",
         "events_url" : "https://api.github.com/users/RomanBelkov/events{/privacy}",
         "followers_url" : "https://api.github.com/users/RomanBelkov/followers",
         "following_url" : "https://api.github.com/users/RomanBelkov/following{/other_user}",
         "gists_url" : "https://api.github.com/users/RomanBelkov/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/RomanBelkov",
         "id" : 5811999,
         "login" : "RomanBelkov",
         "node_id" : "MDQ6VXNlcjU4MTE5OTk=",
         "organizations_url" : "https://api.github.com/users/RomanBelkov/orgs",
         "received_events_url" : "https://api.github.com/users/RomanBelkov/received_events",
         "repos_url" : "https://api.github.com/users/RomanBelkov/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/RomanBelkov/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/RomanBelkov/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/RomanBelkov"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "same issue on testnet mining pool. it has large txs and qt stops if its updating balances...",
      "created_at" : "2019-02-28T12:50:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15148#issuecomment-468260897",
      "id" : 468260897,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15148",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2ODI2MDg5Nw==",
      "updated_at" : "2019-02-28T12:50:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/468260897",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/37016180?v=4",
         "events_url" : "https://api.github.com/users/cryptozeny/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cryptozeny/followers",
         "following_url" : "https://api.github.com/users/cryptozeny/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cryptozeny/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cryptozeny",
         "id" : 37016180,
         "login" : "cryptozeny",
         "node_id" : "MDQ6VXNlcjM3MDE2MTgw",
         "organizations_url" : "https://api.github.com/users/cryptozeny/orgs",
         "received_events_url" : "https://api.github.com/users/cryptozeny/received_events",
         "repos_url" : "https://api.github.com/users/cryptozeny/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cryptozeny/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cryptozeny/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cryptozeny"
      }
   }
]
