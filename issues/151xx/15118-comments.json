[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245562887"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245562887"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should this not be `||`? /cc @jonasschnelli 386a6b62a8a1db9dd0f354cb95b7585f555c7e5d",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T07:04:02Z",
      "diff_hunk" : "@@ -1631,8 +1631,8 @@ bool AppInitMain(InitInterfaces& interfaces)\n \n     // ********************************************************* Step 11: import blocks\n \n-    if (!CheckDiskSpace() && !CheckDiskSpace(0, true))\n-        return false;\n+    if (!CheckDiskSpace(GetDataDir()) && !CheckDiskSpace(GetBlocksDir()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245562887",
      "id" : 245562887,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTU2Mjg4Nw==",
      "original_commit_id" : "9ab64b2276b2ab6638987282cce16be9b682d490",
      "original_position" : 17,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 189693788,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245562887",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245563648"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245563648"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: could be static within the function",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T07:10:08Z",
      "diff_hunk" : "@@ -78,6 +78,9 @@\n #include <openssl/conf.h>\n #include <thread>\n \n+/** Minimum disk space required - used in CheckDiskSpace() */\n+static constexpr uint64_t nMinDiskSpace = 52428800;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245563648",
      "id" : 245563648,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTU2MzY0OA==",
      "original_commit_id" : "2af8b710b3183e82f7ff898a5c42502bab4bf753",
      "original_position" : 5,
      "path" : "src/util/system.cpp",
      "position" : null,
      "pull_request_review_id" : 189694792,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245563648",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245565332"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245565332"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: These could each be const.\r\n`#include <cstddef>` for `size_t`",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T07:22:24Z",
      "diff_hunk" : "@@ -0,0 +1,36 @@\n+// Copyright (c) 2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_FLATFILE_H\n+#define BITCOIN_FLATFILE_H\n+\n+#include <chain.h>\n+#include <fs.h>\n+\n+/**\n+ * FlatFileSeq represents a sequence of numbered files storing raw data. This class facilitates\n+ * access to and efficient management of these files.\n+ */\n+class FlatFileSeq\n+{\n+private:\n+    fs::path m_dir;\n+    const char* m_prefix;\n+    size_t m_chunk_size;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245565332",
      "id" : 245565332,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTU2NTMzMg==",
      "original_commit_id" : "88cf78032c221632643877dcada1ef38b3819460",
      "original_position" : 20,
      "path" : "src/flatfile.h",
      "position" : null,
      "pull_request_review_id" : 189696918,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245565332",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245567581"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245567581"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `true`",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T07:34:40Z",
      "diff_hunk" : "@@ -45,6 +45,15 @@ class FlatFileSeq\n      * @return The number of bytes successfully allocated.\n      */\n     size_t Allocate(const CDiskBlockPos& pos, size_t add_size, bool& out_of_space);\n+\n+    /**\n+     * Commit a file to disk, and optionally truncate off extra pre-allocated bytes if final.\n+     *\n+     * @param[in] pos The first unwritten position in the file to be flushed.\n+     * @param[in] finalize True if no more data will be written to this file.\n+     * @return True on success, false on failure.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245567581",
      "id" : 245567581,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTU2NzU4MQ==",
      "original_commit_id" : "d48754408bb36c8105002b1515ab8bb12db9313b",
      "original_position" : 10,
      "path" : "src/flatfile.h",
      "position" : 93,
      "pull_request_review_id" : 189699366,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245567581",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245568440"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245568440"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: this adds an extra `fseek` via `Open` each.",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T07:40:07Z",
      "diff_hunk" : "@@ -1631,25 +1631,12 @@ void static FlushBlockFile(bool fFinalize = false)\n {\n     LOCK(cs_LastBlockFile);\n \n-    CDiskBlockPos posOld(nLastBlockFile, 0);\n-    bool status = true;\n-\n-    FILE *fileOld = OpenBlockFile(posOld);\n-    if (fileOld) {\n-        if (fFinalize)\n-            status &= TruncateFile(fileOld, vinfoBlockFile[nLastBlockFile].nSize);\n-        status &= FileCommit(fileOld);\n-        fclose(fileOld);\n-    }\n-\n-    fileOld = OpenUndoFile(posOld);\n-    if (fileOld) {\n-        if (fFinalize)\n-            status &= TruncateFile(fileOld, vinfoBlockFile[nLastBlockFile].nUndoSize);\n-        status &= FileCommit(fileOld);\n-        fclose(fileOld);\n-    }\n+    CDiskBlockPos block_pos_old(nLastBlockFile, vinfoBlockFile[nLastBlockFile].nSize);\n+    CDiskBlockPos undo_pos_old(nLastBlockFile, vinfoBlockFile[nLastBlockFile].nUndoSize);\n \n+    bool status = true;\n+    status &= BlockFileSeq().Flush(block_pos_old, fFinalize);\n+    status &= UndoFileSeq().Flush(undo_pos_old, fFinalize);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245568440",
      "id" : 245568440,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTU2ODQ0MA==",
      "original_commit_id" : "d48754408bb36c8105002b1515ab8bb12db9313b",
      "original_position" : 27,
      "path" : "src/validation.cpp",
      "position" : 130,
      "pull_request_review_id" : 189700488,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245568440",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245569540"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245569540"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`#include <string>`",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T07:47:09Z",
      "diff_hunk" : "@@ -0,0 +1,98 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_FLATFILE_H\n+#define BITCOIN_FLATFILE_H\n+\n+#include <string>\n+\n+#include <fs.h>\n+#include <serialize.h>\n+\n+struct FlatFilePos\n+{\n+    int nFile;\n+    unsigned int nPos;\n+\n+    ADD_SERIALIZE_METHODS;\n+\n+    template <typename Stream, typename Operation>\n+    inline void SerializationOp(Stream& s, Operation ser_action) {\n+        READWRITE(VARINT(nFile, VarIntMode::NONNEGATIVE_SIGNED));\n+        READWRITE(VARINT(nPos));\n+    }\n+\n+    FlatFilePos() {\n+        SetNull();\n+    }\n+\n+    FlatFilePos(int nFileIn, unsigned int nPosIn) {\n+        nFile = nFileIn;\n+        nPos = nPosIn;\n+    }\n+\n+    friend bool operator==(const FlatFilePos &a, const FlatFilePos &b) {\n+        return (a.nFile == b.nFile && a.nPos == b.nPos);\n+    }\n+\n+    friend bool operator!=(const FlatFilePos &a, const FlatFilePos &b) {\n+        return !(a == b);\n+    }\n+\n+    void SetNull() { nFile = -1; nPos = 0; }\n+    bool IsNull() const { return (nFile == -1); }\n+\n+    std::string ToString() const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245569540",
      "id" : 245569540,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTU2OTU0MA==",
      "original_commit_id" : "13583e8a5edbb433f3e92562080786f8c079c5ca",
      "original_position" : 47,
      "path" : "src/flatfile.h",
      "position" : 47,
      "pull_request_review_id" : 189701918,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245569540",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK hooray objects!",
      "created_at" : "2019-01-07T07:48:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#issuecomment-451848663",
      "id" : 451848663,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15118",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MTg0ODY2Mw==",
      "updated_at" : "2019-01-07T07:48:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/451848663",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245589527"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245589527"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit 2af8b71\r\n\r\nRemove 2nd arg, it's the default?",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T09:21:53Z",
      "diff_hunk" : "@@ -2135,8 +2135,10 @@ bool static FlushStateToDisk(const CChainParams& chainparams, CValidationState &\n         // Write blocks and block index to disk.\n         if (fDoFullFlush || fPeriodicWrite) {\n             // Depend on nMinDiskSpace to ensure we can write block index\n-            if (!CheckDiskSpace(0, true))\n+            if (!CheckDiskSpace(GetBlocksDir(), 0)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245589527",
      "id" : 245589527,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTU4OTUyNw==",
      "original_commit_id" : "2af8b710b3183e82f7ff898a5c42502bab4bf753",
      "original_position" : 5,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 189726949,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245589527",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245591202"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245591202"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit 2af8b71\r\n\r\nCare add `{}`?",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T09:27:42Z",
      "diff_hunk" : "@@ -3024,7 +3028,7 @@ static bool FindBlockPos(CDiskBlockPos &pos, unsigned int nAddSize, unsigned int\n                 }\n             }\n             else",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245591202",
      "id" : 245591202,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTU5MTIwMg==",
      "original_commit_id" : "2af8b710b3183e82f7ff898a5c42502bab4bf753",
      "original_position" : 36,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 189726949,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245591202",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245592023"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245592023"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit 88cf780\r\n\r\nnit, initialize one per line?",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T09:30:07Z",
      "diff_hunk" : "@@ -0,0 +1,15 @@\n+// Copyright (c) 2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <flatfile.h>\n+#include <tinyformat.h>\n+\n+FlatFileSeq::FlatFileSeq(fs::path dir, const char* prefix, size_t chunk_size)\n+    : m_dir(std::move(dir)), m_prefix(prefix), m_chunk_size(chunk_size)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245592023",
      "id" : 245592023,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTU5MjAyMw==",
      "original_commit_id" : "88cf78032c221632643877dcada1ef38b3819460",
      "original_position" : 9,
      "path" : "src/flatfile.cpp",
      "position" : 17,
      "pull_request_review_id" : 189726949,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245592023",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245592409"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245592409"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit 88cf780\r\n\r\nAgree with `const` members.",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T09:31:10Z",
      "diff_hunk" : "@@ -0,0 +1,36 @@\n+// Copyright (c) 2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_FLATFILE_H\n+#define BITCOIN_FLATFILE_H\n+\n+#include <chain.h>\n+#include <fs.h>\n+\n+/**\n+ * FlatFileSeq represents a sequence of numbered files storing raw data. This class facilitates\n+ * access to and efficient management of these files.\n+ */\n+class FlatFileSeq\n+{\n+private:\n+    fs::path m_dir;\n+    const char* m_prefix;\n+    size_t m_chunk_size;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245592409",
      "id" : 245592409,
      "in_reply_to_id" : 245565332,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTU5MjQwOQ==",
      "original_commit_id" : "88cf78032c221632643877dcada1ef38b3819460",
      "original_position" : 20,
      "path" : "src/flatfile.h",
      "position" : null,
      "pull_request_review_id" : 189726949,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245592409",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245592900"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245592900"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit 88cf780\r\n\r\nPrefer forward declaration of `CDiskBlockPos`?",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T09:33:03Z",
      "diff_hunk" : "@@ -0,0 +1,36 @@\n+// Copyright (c) 2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_FLATFILE_H\n+#define BITCOIN_FLATFILE_H\n+\n+#include <chain.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245592900",
      "id" : 245592900,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTU5MjkwMA==",
      "original_commit_id" : "88cf78032c221632643877dcada1ef38b3819460",
      "original_position" : 8,
      "path" : "src/flatfile.h",
      "position" : null,
      "pull_request_review_id" : 189726949,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245592900",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245594004"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245594004"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit 88cf780\r\n\r\nnit, remove?",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T09:36:20Z",
      "diff_hunk" : "@@ -3802,9 +3815,9 @@ static FILE* OpenUndoFile(const CDiskBlockPos &pos, bool fReadOnly) {\n     return OpenDiskFile(pos, \"rev\", fReadOnly);\n }\n \n-fs::path GetBlockPosFilename(const CDiskBlockPos &pos, const char *prefix)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245594004",
      "id" : 245594004,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTU5NDAwNA==",
      "original_commit_id" : "88cf78032c221632643877dcada1ef38b3819460",
      "original_position" : 49,
      "path" : "src/validation.cpp",
      "position" : 371,
      "pull_request_review_id" : 189726949,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245594004",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245595454"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245595454"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit ad59122\r\n\r\nJust asking for a follow up, could this be changed to `std::fstream`?",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T09:41:36Z",
      "diff_hunk" : "@@ -13,3 +14,26 @@ fs::path FlatFileSeq::FileName(const CDiskBlockPos& pos) const\n {\n     return m_dir / strprintf(\"%s%05u.dat\", m_prefix, pos.nFile);\n }\n+\n+FILE* FlatFileSeq::Open(const CDiskBlockPos& pos, bool fReadOnly)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245595454",
      "id" : 245595454,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTU5NTQ1NA==",
      "original_commit_id" : "ad59122358b936613cb7ea51ff490595e1c13e40",
      "original_position" : 13,
      "path" : "src/flatfile.cpp",
      "position" : null,
      "pull_request_review_id" : 189726949,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245595454",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245726324"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245726324"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, seems like it to me.",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T17:01:38Z",
      "diff_hunk" : "@@ -1631,8 +1631,8 @@ bool AppInitMain(InitInterfaces& interfaces)\n \n     // ********************************************************* Step 11: import blocks\n \n-    if (!CheckDiskSpace() && !CheckDiskSpace(0, true))\n-        return false;\n+    if (!CheckDiskSpace(GetDataDir()) && !CheckDiskSpace(GetBlocksDir()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245726324",
      "id" : 245726324,
      "in_reply_to_id" : 245562887,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTcyNjMyNA==",
      "original_commit_id" : "9ab64b2276b2ab6638987282cce16be9b682d490",
      "original_position" : 17,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 189900452,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245726324",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245728116"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245728116"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good catch",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T17:07:04Z",
      "diff_hunk" : "@@ -1631,25 +1631,12 @@ void static FlushBlockFile(bool fFinalize = false)\n {\n     LOCK(cs_LastBlockFile);\n \n-    CDiskBlockPos posOld(nLastBlockFile, 0);\n-    bool status = true;\n-\n-    FILE *fileOld = OpenBlockFile(posOld);\n-    if (fileOld) {\n-        if (fFinalize)\n-            status &= TruncateFile(fileOld, vinfoBlockFile[nLastBlockFile].nSize);\n-        status &= FileCommit(fileOld);\n-        fclose(fileOld);\n-    }\n-\n-    fileOld = OpenUndoFile(posOld);\n-    if (fileOld) {\n-        if (fFinalize)\n-            status &= TruncateFile(fileOld, vinfoBlockFile[nLastBlockFile].nUndoSize);\n-        status &= FileCommit(fileOld);\n-        fclose(fileOld);\n-    }\n+    CDiskBlockPos block_pos_old(nLastBlockFile, vinfoBlockFile[nLastBlockFile].nSize);\n+    CDiskBlockPos undo_pos_old(nLastBlockFile, vinfoBlockFile[nLastBlockFile].nUndoSize);\n \n+    bool status = true;\n+    status &= BlockFileSeq().Flush(block_pos_old, fFinalize);\n+    status &= UndoFileSeq().Flush(undo_pos_old, fFinalize);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245728116",
      "id" : 245728116,
      "in_reply_to_id" : 245568440,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTcyODExNg==",
      "original_commit_id" : "d48754408bb36c8105002b1515ab8bb12db9313b",
      "original_position" : 27,
      "path" : "src/validation.cpp",
      "position" : 130,
      "pull_request_review_id" : 189902746,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245728116",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245728196"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245728196"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's included.",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T17:07:18Z",
      "diff_hunk" : "@@ -0,0 +1,98 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_FLATFILE_H\n+#define BITCOIN_FLATFILE_H\n+\n+#include <string>\n+\n+#include <fs.h>\n+#include <serialize.h>\n+\n+struct FlatFilePos\n+{\n+    int nFile;\n+    unsigned int nPos;\n+\n+    ADD_SERIALIZE_METHODS;\n+\n+    template <typename Stream, typename Operation>\n+    inline void SerializationOp(Stream& s, Operation ser_action) {\n+        READWRITE(VARINT(nFile, VarIntMode::NONNEGATIVE_SIGNED));\n+        READWRITE(VARINT(nPos));\n+    }\n+\n+    FlatFilePos() {\n+        SetNull();\n+    }\n+\n+    FlatFilePos(int nFileIn, unsigned int nPosIn) {\n+        nFile = nFileIn;\n+        nPos = nPosIn;\n+    }\n+\n+    friend bool operator==(const FlatFilePos &a, const FlatFilePos &b) {\n+        return (a.nFile == b.nFile && a.nPos == b.nPos);\n+    }\n+\n+    friend bool operator!=(const FlatFilePos &a, const FlatFilePos &b) {\n+        return !(a == b);\n+    }\n+\n+    void SetNull() { nFile = -1; nPos = 0; }\n+    bool IsNull() const { return (nFile == -1); }\n+\n+    std::string ToString() const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245728196",
      "id" : 245728196,
      "in_reply_to_id" : 245569540,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTcyODE5Ng==",
      "original_commit_id" : "13583e8a5edbb433f3e92562080786f8c079c5ca",
      "original_position" : 47,
      "path" : "src/flatfile.h",
      "position" : 47,
      "pull_request_review_id" : 189902845,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245728196",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245729668"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245729668"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I added the braces after the code is moved to `FlatFileSeq::Allocate`.",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T17:12:10Z",
      "diff_hunk" : "@@ -3024,7 +3028,7 @@ static bool FindBlockPos(CDiskBlockPos &pos, unsigned int nAddSize, unsigned int\n                 }\n             }\n             else",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245729668",
      "id" : 245729668,
      "in_reply_to_id" : 245591202,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTcyOTY2OA==",
      "original_commit_id" : "2af8b710b3183e82f7ff898a5c42502bab4bf753",
      "original_position" : 36,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 189904820,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245729668",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245729820"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245729820"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't see this in the style guide?",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T17:12:40Z",
      "diff_hunk" : "@@ -0,0 +1,15 @@\n+// Copyright (c) 2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <flatfile.h>\n+#include <tinyformat.h>\n+\n+FlatFileSeq::FlatFileSeq(fs::path dir, const char* prefix, size_t chunk_size)\n+    : m_dir(std::move(dir)), m_prefix(prefix), m_chunk_size(chunk_size)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245729820",
      "id" : 245729820,
      "in_reply_to_id" : 245592023,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTcyOTgyMA==",
      "original_commit_id" : "88cf78032c221632643877dcada1ef38b3819460",
      "original_position" : 9,
      "path" : "src/flatfile.cpp",
      "position" : 17,
      "pull_request_review_id" : 189905009,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245729820",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245730040"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245730040"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good point. Though CDiskBlockPos is moved into this header later on, so I don't think it's necessary to change in the earlier commit.",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T17:13:16Z",
      "diff_hunk" : "@@ -0,0 +1,36 @@\n+// Copyright (c) 2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_FLATFILE_H\n+#define BITCOIN_FLATFILE_H\n+\n+#include <chain.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245730040",
      "id" : 245730040,
      "in_reply_to_id" : 245592900,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTczMDA0MA==",
      "original_commit_id" : "88cf78032c221632643877dcada1ef38b3819460",
      "original_position" : 8,
      "path" : "src/flatfile.h",
      "position" : null,
      "pull_request_review_id" : 189905265,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245730040",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245730162"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245730162"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's used once in `init.cpp`.",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T17:13:37Z",
      "diff_hunk" : "@@ -3802,9 +3815,9 @@ static FILE* OpenUndoFile(const CDiskBlockPos &pos, bool fReadOnly) {\n     return OpenDiskFile(pos, \"rev\", fReadOnly);\n }\n \n-fs::path GetBlockPosFilename(const CDiskBlockPos &pos, const char *prefix)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245730162",
      "id" : 245730162,
      "in_reply_to_id" : 245594004,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTczMDE2Mg==",
      "original_commit_id" : "88cf78032c221632643877dcada1ef38b3819460",
      "original_position" : 49,
      "path" : "src/validation.cpp",
      "position" : 371,
      "pull_request_review_id" : 189905427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245730162",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245730847"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245730847"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe... but a lot of file utilities like `FileCommit`, `AllocateFileRange`, etc would have to be modified as well. I think the better approach would be to return a `CAutoFile` and define the move constructor/assignment operator properly. And probably move it to a different module, like in util.",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T17:15:51Z",
      "diff_hunk" : "@@ -13,3 +14,26 @@ fs::path FlatFileSeq::FileName(const CDiskBlockPos& pos) const\n {\n     return m_dir / strprintf(\"%s%05u.dat\", m_prefix, pos.nFile);\n }\n+\n+FILE* FlatFileSeq::Open(const CDiskBlockPos& pos, bool fReadOnly)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245730847",
      "id" : 245730847,
      "in_reply_to_id" : 245595454,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTczMDg0Nw==",
      "original_commit_id" : "ad59122358b936613cb7ea51ff490595e1c13e40",
      "original_position" : 13,
      "path" : "src/flatfile.cpp",
      "position" : null,
      "pull_request_review_id" : 189906305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245730847",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245735065"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245735065"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I know, just inline where needed?",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T17:29:14Z",
      "diff_hunk" : "@@ -3802,9 +3815,9 @@ static FILE* OpenUndoFile(const CDiskBlockPos &pos, bool fReadOnly) {\n     return OpenDiskFile(pos, \"rev\", fReadOnly);\n }\n \n-fs::path GetBlockPosFilename(const CDiskBlockPos &pos, const char *prefix)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245735065",
      "id" : 245735065,
      "in_reply_to_id" : 245594004,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTczNTA2NQ==",
      "original_commit_id" : "88cf78032c221632643877dcada1ef38b3819460",
      "original_position" : 49,
      "path" : "src/validation.cpp",
      "position" : 371,
      "pull_request_review_id" : 189911813,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245735065",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245760248"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245760248"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That would mean require `BlockFileSeq`, which is currently static and a broader interface.",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T18:54:46Z",
      "diff_hunk" : "@@ -3802,9 +3815,9 @@ static FILE* OpenUndoFile(const CDiskBlockPos &pos, bool fReadOnly) {\n     return OpenDiskFile(pos, \"rev\", fReadOnly);\n }\n \n-fs::path GetBlockPosFilename(const CDiskBlockPos &pos, const char *prefix)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245760248",
      "id" : 245760248,
      "in_reply_to_id" : 245594004,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTc2MDI0OA==",
      "original_commit_id" : "88cf78032c221632643877dcada1ef38b3819460",
      "original_position" : 49,
      "path" : "src/validation.cpp",
      "position" : 371,
      "pull_request_review_id" : 189944250,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245760248",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245761352"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245761352"
         }
      },
      "author_association" : "MEMBER",
      "body" : "#15124",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T18:58:30Z",
      "diff_hunk" : "@@ -1631,8 +1631,8 @@ bool AppInitMain(InitInterfaces& interfaces)\n \n     // ********************************************************* Step 11: import blocks\n \n-    if (!CheckDiskSpace() && !CheckDiskSpace(0, true))\n-        return false;\n+    if (!CheckDiskSpace(GetDataDir()) && !CheckDiskSpace(GetBlocksDir()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245761352",
      "id" : 245761352,
      "in_reply_to_id" : 245562887,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTc2MTM1Mg==",
      "original_commit_id" : "9ab64b2276b2ab6638987282cce16be9b682d490",
      "original_position" : 17,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 189945678,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245761352",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245827237"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245827237"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You also don't see to declare class members in multiple lines, but fair enough.",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T22:57:49Z",
      "diff_hunk" : "@@ -0,0 +1,15 @@\n+// Copyright (c) 2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <flatfile.h>\n+#include <tinyformat.h>\n+\n+FlatFileSeq::FlatFileSeq(fs::path dir, const char* prefix, size_t chunk_size)\n+    : m_dir(std::move(dir)), m_prefix(prefix), m_chunk_size(chunk_size)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245827237",
      "id" : 245827237,
      "in_reply_to_id" : 245592023,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTgyNzIzNw==",
      "original_commit_id" : "88cf78032c221632643877dcada1ef38b3819460",
      "original_position" : 9,
      "path" : "src/flatfile.cpp",
      "position" : 17,
      "pull_request_review_id" : 190030764,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245827237",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245831153"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245831153"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Right, just realized it's a static function in `validation.cpp`",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-07T23:17:30Z",
      "diff_hunk" : "@@ -3802,9 +3815,9 @@ static FILE* OpenUndoFile(const CDiskBlockPos &pos, bool fReadOnly) {\n     return OpenDiskFile(pos, \"rev\", fReadOnly);\n }\n \n-fs::path GetBlockPosFilename(const CDiskBlockPos &pos, const char *prefix)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r245831153",
      "id" : 245831153,
      "in_reply_to_id" : 245594004,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTgzMTE1Mw==",
      "original_commit_id" : "88cf78032c221632643877dcada1ef38b3819460",
      "original_position" : 49,
      "path" : "src/validation.cpp",
      "position" : 371,
      "pull_request_review_id" : 190035743,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245831153",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r246087519"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246087519"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason not to just have these on-hand as global objects instead of having to reconstruct an object for each use through these functions? Obviously there isn't much of a performance concern given these calls happen before disk IO, but I'm just curious.",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-08T17:37:04Z",
      "diff_hunk" : "@@ -310,6 +311,8 @@ static void FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nManualPr\n static void FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPruneAfterHeight);\n bool CheckInputs(const CTransaction& tx, CValidationState &state, const CCoinsViewCache &inputs, bool fScriptChecks, unsigned int flags, bool cacheSigStore, bool cacheFullScriptStore, PrecomputedTransactionData& txdata, std::vector<CScriptCheck> *pvChecks = nullptr);\n static FILE* OpenUndoFile(const CDiskBlockPos &pos, bool fReadOnly = false);\n+static FlatFileSeq BlockFileSeq();\n+static FlatFileSeq UndoFileSeq();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r246087519",
      "id" : 246087519,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjA4NzUxOQ==",
      "original_commit_id" : "88cf78032c221632643877dcada1ef38b3819460",
      "original_position" : 13,
      "path" : "src/validation.cpp",
      "position" : 33,
      "pull_request_review_id" : 190359901,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246087519",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r246099197"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246099197"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This should be `BlockFileSeq` and not `UndoFileSeq`, no?",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-08T18:14:46Z",
      "diff_hunk" : "@@ -3017,21 +3017,13 @@ static bool FindBlockPos(CDiskBlockPos &pos, unsigned int nAddSize, unsigned int\n         vinfoBlockFile[nFile].nSize += nAddSize;\n \n     if (!fKnown) {\n-        unsigned int nOldChunks = (pos.nPos + BLOCKFILE_CHUNK_SIZE - 1) / BLOCKFILE_CHUNK_SIZE;\n-        unsigned int nNewChunks = (vinfoBlockFile[nFile].nSize + BLOCKFILE_CHUNK_SIZE - 1) / BLOCKFILE_CHUNK_SIZE;\n-        if (nNewChunks > nOldChunks) {\n-            if (fPruneMode)\n-                fCheckForPruning = true;\n-            if (CheckDiskSpace(GetBlocksDir(), nNewChunks * BLOCKFILE_CHUNK_SIZE - pos.nPos)) {\n-                FILE *file = OpenBlockFile(pos);\n-                if (file) {\n-                    LogPrintf(\"Pre-allocating up to position 0x%x in blk%05u.dat\\n\", nNewChunks * BLOCKFILE_CHUNK_SIZE, pos.nFile);\n-                    AllocateFileRange(file, pos.nPos, nNewChunks * BLOCKFILE_CHUNK_SIZE - pos.nPos);\n-                    fclose(file);\n-                }\n-            }\n-            else\n-                return AbortNode(\"Disk space is low!\", _(\"Error: Disk space is low!\"));\n+        bool out_of_space;\n+        size_t bytes_allocated = UndoFileSeq().Allocate(pos, nAddSize, out_of_space);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r246099197",
      "id" : 246099197,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjA5OTE5Nw==",
      "original_commit_id" : "930e2839544dc82c333c2452f3cf6e662c5255e5",
      "original_position" : 20,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 190359901,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246099197",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r246109696"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246109696"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Cute.",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-08T18:48:43Z",
      "diff_hunk" : "@@ -0,0 +1,123 @@\n+// Copyright (c) 2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <flatfile.h>\n+#include <test/test_bitcoin.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_FIXTURE_TEST_SUITE(flatfile_tests, BasicTestingSetup)\n+\n+BOOST_AUTO_TEST_CASE(flatfile_filename)\n+{\n+    auto data_dir = SetDataDir(\"flatfile_test\");\n+\n+    FlatFilePos pos(456, 789);\n+\n+    FlatFileSeq seq1(data_dir, \"a\", 16 * 1024);\n+    BOOST_CHECK_EQUAL(seq1.FileName(pos), data_dir / \"a00456.dat\");\n+\n+    FlatFileSeq seq2(data_dir / \"a\", \"b\", 16 * 1024);\n+    BOOST_CHECK_EQUAL(seq2.FileName(pos), data_dir / \"a\" / \"b00456.dat\");\n+}\n+\n+BOOST_AUTO_TEST_CASE(flatfile_open)\n+{\n+    auto data_dir = SetDataDir(\"flatfile_test\");\n+    FlatFileSeq seq(data_dir, \"a\", 16 * 1024);\n+\n+    std::string line1(\"A purely peer-to-peer version of electronic cash would allow online \"\n+                      \"payments to be sent directly from one party to another without going \"\n+                      \"through a financial institution.\");\n+    std::string line2(\"Digital signatures provide part of the solution, but the main benefits are \"\n+                      \"lost if a trusted third party is still required to prevent double-spending.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r246109696",
      "id" : 246109696,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjEwOTY5Ng==",
      "original_commit_id" : "13583e8a5edbb433f3e92562080786f8c079c5ca",
      "original_position" : 34,
      "path" : "src/test/flatfile_tests.cpp",
      "position" : 34,
      "pull_request_review_id" : 190388449,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246109696",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r246133462"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246133462"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "They are constructed with `GetDataDir/GetBlocksDir` which are not static, so the initialization logic would get a bit tricky. Could be OK with lazy evaluation or something, but didn't seem worth it. Open to suggestions.",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-08T20:03:45Z",
      "diff_hunk" : "@@ -310,6 +311,8 @@ static void FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nManualPr\n static void FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPruneAfterHeight);\n bool CheckInputs(const CTransaction& tx, CValidationState &state, const CCoinsViewCache &inputs, bool fScriptChecks, unsigned int flags, bool cacheSigStore, bool cacheFullScriptStore, PrecomputedTransactionData& txdata, std::vector<CScriptCheck> *pvChecks = nullptr);\n static FILE* OpenUndoFile(const CDiskBlockPos &pos, bool fReadOnly = false);\n+static FlatFileSeq BlockFileSeq();\n+static FlatFileSeq UndoFileSeq();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r246133462",
      "id" : 246133462,
      "in_reply_to_id" : 246087519,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjEzMzQ2Mg==",
      "original_commit_id" : "88cf78032c221632643877dcada1ef38b3819460",
      "original_position" : 13,
      "path" : "src/validation.cpp",
      "position" : 33,
      "pull_request_review_id" : 190419189,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246133462",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r246133723"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246133723"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oops, good catch.",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-08T20:04:44Z",
      "diff_hunk" : "@@ -3017,21 +3017,13 @@ static bool FindBlockPos(CDiskBlockPos &pos, unsigned int nAddSize, unsigned int\n         vinfoBlockFile[nFile].nSize += nAddSize;\n \n     if (!fKnown) {\n-        unsigned int nOldChunks = (pos.nPos + BLOCKFILE_CHUNK_SIZE - 1) / BLOCKFILE_CHUNK_SIZE;\n-        unsigned int nNewChunks = (vinfoBlockFile[nFile].nSize + BLOCKFILE_CHUNK_SIZE - 1) / BLOCKFILE_CHUNK_SIZE;\n-        if (nNewChunks > nOldChunks) {\n-            if (fPruneMode)\n-                fCheckForPruning = true;\n-            if (CheckDiskSpace(GetBlocksDir(), nNewChunks * BLOCKFILE_CHUNK_SIZE - pos.nPos)) {\n-                FILE *file = OpenBlockFile(pos);\n-                if (file) {\n-                    LogPrintf(\"Pre-allocating up to position 0x%x in blk%05u.dat\\n\", nNewChunks * BLOCKFILE_CHUNK_SIZE, pos.nFile);\n-                    AllocateFileRange(file, pos.nPos, nNewChunks * BLOCKFILE_CHUNK_SIZE - pos.nPos);\n-                    fclose(file);\n-                }\n-            }\n-            else\n-                return AbortNode(\"Disk space is low!\", _(\"Error: Disk space is low!\"));\n+        bool out_of_space;\n+        size_t bytes_allocated = UndoFileSeq().Allocate(pos, nAddSize, out_of_space);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r246133723",
      "id" : 246133723,
      "in_reply_to_id" : 246099197,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjEzMzcyMw==",
      "original_commit_id" : "930e2839544dc82c333c2452f3cf6e662c5255e5",
      "original_position" : 20,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 190419563,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246133723",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r246137546"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246137546"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah, okay. Like I said, no big deal AFAICT.",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-08T20:18:42Z",
      "diff_hunk" : "@@ -310,6 +311,8 @@ static void FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nManualPr\n static void FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPruneAfterHeight);\n bool CheckInputs(const CTransaction& tx, CValidationState &state, const CCoinsViewCache &inputs, bool fScriptChecks, unsigned int flags, bool cacheSigStore, bool cacheFullScriptStore, PrecomputedTransactionData& txdata, std::vector<CScriptCheck> *pvChecks = nullptr);\n static FILE* OpenUndoFile(const CDiskBlockPos &pos, bool fReadOnly = false);\n+static FlatFileSeq BlockFileSeq();\n+static FlatFileSeq UndoFileSeq();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r246137546",
      "id" : 246137546,
      "in_reply_to_id" : 246087519,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjEzNzU0Ng==",
      "original_commit_id" : "88cf78032c221632643877dcada1ef38b3819460",
      "original_position" : 13,
      "path" : "src/validation.cpp",
      "position" : 33,
      "pull_request_review_id" : 190424488,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246137546",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r246536417"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246536417"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Make sure parameter names match between declaration and definition :-)",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-09T20:44:50Z",
      "diff_hunk" : "@@ -0,0 +1,98 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_FLATFILE_H\n+#define BITCOIN_FLATFILE_H\n+\n+#include <string>\n+\n+#include <fs.h>\n+#include <serialize.h>\n+\n+struct FlatFilePos\n+{\n+    int nFile;\n+    unsigned int nPos;\n+\n+    ADD_SERIALIZE_METHODS;\n+\n+    template <typename Stream, typename Operation>\n+    inline void SerializationOp(Stream& s, Operation ser_action) {\n+        READWRITE(VARINT(nFile, VarIntMode::NONNEGATIVE_SIGNED));\n+        READWRITE(VARINT(nPos));\n+    }\n+\n+    FlatFilePos() {\n+        SetNull();\n+    }\n+\n+    FlatFilePos(int nFileIn, unsigned int nPosIn) {\n+        nFile = nFileIn;\n+        nPos = nPosIn;\n+    }\n+\n+    friend bool operator==(const FlatFilePos &a, const FlatFilePos &b) {\n+        return (a.nFile == b.nFile && a.nPos == b.nPos);\n+    }\n+\n+    friend bool operator!=(const FlatFilePos &a, const FlatFilePos &b) {\n+        return !(a == b);\n+    }\n+\n+    void SetNull() { nFile = -1; nPos = 0; }\n+    bool IsNull() const { return (nFile == -1); }\n+\n+    std::string ToString() const;\n+};\n+\n+/**\n+ * FlatFileSeq represents a sequence of numbered files storing raw data. This class facilitates\n+ * access to and efficient management of these files.\n+ */\n+class FlatFileSeq\n+{\n+private:\n+    const fs::path m_dir;\n+    const char* const m_prefix;\n+    const size_t m_chunk_size;\n+\n+public:\n+    /**\n+     * Constructor\n+     *\n+     * @param dir The base directory that all files live in.\n+     * @param prefix A short prefix given to all file names.\n+     * @param chunk_size Disk space is pre-allocated in multiples of this amount.\n+     */\n+    FlatFileSeq(fs::path dir, const char* prefix, size_t chunk_size);\n+\n+    /** Get the name of the file at the given position. */\n+    fs::path FileName(const FlatFilePos& pos) const;\n+\n+    /** Open a handle to the file at the given position. */\n+    FILE* Open(const FlatFilePos& pos, bool read_only = false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r246536417",
      "id" : 246536417,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjUzNjQxNw==",
      "original_commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "original_position" : 75,
      "path" : "src/flatfile.h",
      "position" : 75,
      "pull_request_review_id" : 190930215,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:44:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246536417",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r246536653"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246536653"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Move `else {` one line up :-)",
      "commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "created_at" : "2019-01-09T20:45:44Z",
      "diff_hunk" : "@@ -0,0 +1,92 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <flatfile.h>\n+#include <logging.h>\n+#include <tinyformat.h>\n+#include <util/system.h>\n+\n+std::string FlatFilePos::ToString() const\n+{\n+    return strprintf(\"FlatFilePos(nFile=%i, nPos=%i)\", nFile, nPos);\n+}\n+\n+FlatFileSeq::FlatFileSeq(fs::path dir, const char* prefix, size_t chunk_size)\n+    : m_dir(std::move(dir)), m_prefix(prefix), m_chunk_size(chunk_size)\n+{}\n+\n+fs::path FlatFileSeq::FileName(const FlatFilePos& pos) const\n+{\n+    return m_dir / strprintf(\"%s%05u.dat\", m_prefix, pos.nFile);\n+}\n+\n+FILE* FlatFileSeq::Open(const FlatFilePos& pos, bool fReadOnly)\n+{\n+    if (pos.IsNull())\n+        return nullptr;\n+    fs::path path = FileName(pos);\n+    fs::create_directories(path.parent_path());\n+    FILE* file = fsbridge::fopen(path, fReadOnly ? \"rb\": \"rb+\");\n+    if (!file && !fReadOnly)\n+        file = fsbridge::fopen(path, \"wb+\");\n+    if (!file) {\n+        LogPrintf(\"Unable to open file %s\\n\", path.string());\n+        return nullptr;\n+    }\n+    if (pos.nPos) {\n+        if (fseek(file, pos.nPos, SEEK_SET)) {\n+            LogPrintf(\"Unable to seek to position %u of %s\\n\", pos.nPos, path.string());\n+            fclose(file);\n+            return nullptr;\n+        }\n+    }\n+    return file;\n+}\n+\n+size_t FlatFileSeq::Allocate(const FlatFilePos& pos, size_t add_size, bool& out_of_space)\n+{\n+    out_of_space = false;\n+\n+    unsigned int n_old_chunks = (pos.nPos + m_chunk_size - 1) / m_chunk_size;\n+    unsigned int n_new_chunks = (pos.nPos + add_size + m_chunk_size - 1) / m_chunk_size;\n+    if (n_new_chunks > n_old_chunks) {\n+        size_t old_size = pos.nPos;\n+        size_t new_size = n_new_chunks * m_chunk_size;\n+        size_t inc_size = new_size - old_size;\n+\n+        if (CheckDiskSpace(m_dir, inc_size)) {\n+            FILE *file = Open(pos);\n+            if (file) {\n+                LogPrintf(\"Pre-allocating up to position 0x%x in %s%05u.dat\\n\", new_size, m_prefix, pos.nFile);\n+                AllocateFileRange(file, pos.nPos, inc_size);\n+                fclose(file);\n+                return inc_size;\n+            }\n+        }\n+        else {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#discussion_r246536653",
      "id" : 246536653,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjUzNjY1Mw==",
      "original_commit_id" : "fbbf962422f2c73f45ef759f1a38c1bfced56fe7",
      "original_position" : 68,
      "path" : "src/flatfile.cpp",
      "position" : 68,
      "pull_request_review_id" : 190930519,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15118",
      "updated_at" : "2019-01-09T20:45:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246536653",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14802](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14802.html) (rpc: faster getblockstats using BlockUndo data by FelixWeis)\n* [#13868](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/13868.html) (Remove unused fScriptChecks parameter from CheckInputs by Empact)\n* [#13746](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/13746.html) (-masterdatadir for datadir bootstrapping by kallewoof)\n* [#10785](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/10785.html) (Serialization improvements by sipa)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-01-09T22:48:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15118#issuecomment-452898676",
      "id" : 452898676,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15118",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1Mjg5ODY3Ng==",
      "updated_at" : "2019-01-09T22:48:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/452898676",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
