[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246022808"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246022808"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think this should use the same script.",
      "commit_id" : "3e9b70d0d2e04605b0b947a487ac0a45c82851e5",
      "created_at" : "2019-01-08T14:50:14Z",
      "diff_hunk" : "@@ -875,6 +875,30 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n     return true;\n }\n \n+bool CWallet::RemoveFromWallet(const CTransaction& tx)\n+{\n+    LOCK(cs_wallet);\n+\n+    if (!WalletBatch(*database).EraseTx(tx.GetHash()))\n+        return false;\n+\n+    WalletLogPrintf(\"RemoveFromWallet %s\\n\", tx.GetHash().ToString());\n+\n+    // Notify UI of new or updated transaction\n+    NotifyTransactionChanged(this, tx.GetHash(), CT_DELETED);\n+\n+    // Notify an external script when a wallet transaction comes in or is updated\n+    std::string strCmd = gArgs.GetArg(\"-walletnotify\", \"\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246022808",
      "id" : 246022808,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjAyMjgwOA==",
      "original_commit_id" : "c6e9bca890bcfbe25bacec17a5cebb10dc677519",
      "original_position" : 17,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 190275992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "updated_at" : "2019-01-08T17:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246022808",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246022912"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246022912"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Add braces here and throughout.",
      "commit_id" : "3e9b70d0d2e04605b0b947a487ac0a45c82851e5",
      "created_at" : "2019-01-08T14:50:31Z",
      "diff_hunk" : "@@ -343,6 +343,89 @@ UniValue importaddress(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination& dest);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    if (::IsMine(*pwallet, script) == ISMINE_SPENDABLE)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246022912",
      "id" : 246022912,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjAyMjkxMg==",
      "original_commit_id" : "c6e9bca890bcfbe25bacec17a5cebb10dc677519",
      "original_position" : 7,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 190275992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "updated_at" : "2019-01-08T17:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246022912",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246023468"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246023468"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe submit this change in a separate PR.",
      "commit_id" : "3e9b70d0d2e04605b0b947a487ac0a45c82851e5",
      "created_at" : "2019-01-08T14:52:08Z",
      "diff_hunk" : "@@ -947,7 +971,10 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n             if (pIndex != nullptr)\n                 wtx.SetMerkleBranch(pIndex, posInBlock);\n \n-            return AddToWallet(wtx, false);\n+            if (IsMine(tx) || IsFromMe(tx))\n+                return AddToWallet(wtx, false);\n+\n+            return RemoveFromWallet(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246023468",
      "id" : 246023468,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjAyMzQ2OA==",
      "original_commit_id" : "c6e9bca890bcfbe25bacec17a5cebb10dc677519",
      "original_position" : 39,
      "path" : "src/wallet/wallet.cpp",
      "position" : 31,
      "pull_request_review_id" : 190275992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "updated_at" : "2019-01-08T17:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246023468",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246052520"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246052520"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, that makes a lot of sense now that you point that out, however, I have no idea what I'd name that. Any ideas?",
      "commit_id" : "3e9b70d0d2e04605b0b947a487ac0a45c82851e5",
      "created_at" : "2019-01-08T16:01:56Z",
      "diff_hunk" : "@@ -875,6 +875,30 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n     return true;\n }\n \n+bool CWallet::RemoveFromWallet(const CTransaction& tx)\n+{\n+    LOCK(cs_wallet);\n+\n+    if (!WalletBatch(*database).EraseTx(tx.GetHash()))\n+        return false;\n+\n+    WalletLogPrintf(\"RemoveFromWallet %s\\n\", tx.GetHash().ToString());\n+\n+    // Notify UI of new or updated transaction\n+    NotifyTransactionChanged(this, tx.GetHash(), CT_DELETED);\n+\n+    // Notify an external script when a wallet transaction comes in or is updated\n+    std::string strCmd = gArgs.GetArg(\"-walletnotify\", \"\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246052520",
      "id" : 246052520,
      "in_reply_to_id" : 246022808,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjA1MjUyMA==",
      "original_commit_id" : "c6e9bca890bcfbe25bacec17a5cebb10dc677519",
      "original_position" : 17,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 190314269,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "updated_at" : "2019-01-08T17:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246052520",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Split into 2 PRs, check #15130",
      "created_at" : "2019-01-08T16:31:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-452362966",
      "id" : 452362966,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MjM2Mjk2Ng==",
      "updated_at" : "2019-01-08T16:31:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/452362966",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246065849"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246065849"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe remove notification? This is only happens after the RPC so the client doesn't need a notification.",
      "commit_id" : "3e9b70d0d2e04605b0b947a487ac0a45c82851e5",
      "created_at" : "2019-01-08T16:36:36Z",
      "diff_hunk" : "@@ -875,6 +875,30 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n     return true;\n }\n \n+bool CWallet::RemoveFromWallet(const CTransaction& tx)\n+{\n+    LOCK(cs_wallet);\n+\n+    if (!WalletBatch(*database).EraseTx(tx.GetHash()))\n+        return false;\n+\n+    WalletLogPrintf(\"RemoveFromWallet %s\\n\", tx.GetHash().ToString());\n+\n+    // Notify UI of new or updated transaction\n+    NotifyTransactionChanged(this, tx.GetHash(), CT_DELETED);\n+\n+    // Notify an external script when a wallet transaction comes in or is updated\n+    std::string strCmd = gArgs.GetArg(\"-walletnotify\", \"\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246065849",
      "id" : 246065849,
      "in_reply_to_id" : 246022808,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjA2NTg0OQ==",
      "original_commit_id" : "c6e9bca890bcfbe25bacec17a5cebb10dc677519",
      "original_position" : 17,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 190331916,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "updated_at" : "2019-01-08T17:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246065849",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246073751"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246073751"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah that's true",
      "commit_id" : "3e9b70d0d2e04605b0b947a487ac0a45c82851e5",
      "created_at" : "2019-01-08T16:57:07Z",
      "diff_hunk" : "@@ -875,6 +875,30 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n     return true;\n }\n \n+bool CWallet::RemoveFromWallet(const CTransaction& tx)\n+{\n+    LOCK(cs_wallet);\n+\n+    if (!WalletBatch(*database).EraseTx(tx.GetHash()))\n+        return false;\n+\n+    WalletLogPrintf(\"RemoveFromWallet %s\\n\", tx.GetHash().ToString());\n+\n+    // Notify UI of new or updated transaction\n+    NotifyTransactionChanged(this, tx.GetHash(), CT_DELETED);\n+\n+    // Notify an external script when a wallet transaction comes in or is updated\n+    std::string strCmd = gArgs.GetArg(\"-walletnotify\", \"\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246073751",
      "id" : 246073751,
      "in_reply_to_id" : 246022808,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjA3Mzc1MQ==",
      "original_commit_id" : "c6e9bca890bcfbe25bacec17a5cebb10dc677519",
      "original_position" : 17,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 190342176,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "updated_at" : "2019-01-08T17:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246073751",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   }
]
