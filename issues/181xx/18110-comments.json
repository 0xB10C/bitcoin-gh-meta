[
   {
      "author_association" : "MEMBER",
      "body" : "See also http://gnusha.org/bitcoin-builds/2019-11-20.log\r\n\r\n```\r\n05:00 < MarcoFalke> So how would I build Bitcoin Core against musl?\r\n05:00 < fanquake> Spin up an Alpine container?\r\n05:02 < fanquake> https://github.com/fanquake/core-review/blob/master/docker/alpine.dockerfile\r\n05:02 < MarcoFalke> Ok, I guess I should make the ci system work with alpine\r\n05:02 < MarcoFalke> Can I do it in Ubuntu as well?\r\n05:02 < MarcoFalke> [08:02] <wumpus> I suppose it's pretty much impossible to do that on ubuntu ,though\r\n05:03 < fanquake> Heh, maybe using that wrapper\r\n05:04 < MarcoFalke> Yeah\r\n05:04 < wumpus> TIL there's a wrapper, this is very cool\r\n05:14 < wumpus> it looks like the wrapper only works for C, not C++\r\n05:16 < wumpus> it's super easy to get to work, installing from source takes 45 seconds or so on my old desktop; but it's no help for bitcoin if it's C only, there's no musl-g++ wrapper\r\n05:23 < wumpus> \"Be aware that, \"out of the box\", the wrapper only supports C applications, not C++. This is because the C++ libraries and headers are missing from the musl include/library path. The existing libstdc++ is actually compatible with musl in most cases and could be used by copying it into the musl library path, but the C++ header files are usually not compatible. One option may be rebuilding just\r\n05:23 < wumpus> libstdc++ against musl; however, if C++ support is needed, it's recommended just to build a native toolchain targetting musl. \"\r\n05:35 < wumpus> I guess there's no way around using something like alpine linux\r\n06:22 < wumpus> effetctively, building C++ for musl requires a full cross toolchain; using a cross-compilation toolchain for the native platform, might be advantageous from a determinism perspective though\r\n06:26 < wumpus> insulated the build from what happens to be installed on the system\r\n07:04 < wumpus> dongcarl cfields what do you think about switching linux builds to musl libc static builds?\r\n07:10 < wumpus> it has the advantage that the binaries work pretty much everywhere instead of only on a limited range of libc versions, and it's starting to be untenable to maintain libc compatibility this far back\r\n07:17 < dongcarl> not opposed... with Guix we won't have to maintain libc compatibility, since we won't be forced to upgrade libc version by ubuntu... but I do see the binary works everywhere advantage\r\n07:18 < wumpus> sure, you can build against a old libc version instead of the libc-compat workaround, but you'd have just as much trouble supporting getauxval\r\n07:19 < wumpus> it doesn't exist in 2.11 no matter how you build against it\r\n",
      "created_at" : "2020-02-10T21:02:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/18110#issuecomment-584352245",
      "id" : 584352245,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18110",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NDM1MjI0NQ==",
      "updated_at" : "2020-02-10T21:02:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/584352245",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm not sure how this is going to interact with, say, the GUI (desktop/system integration is pretty much at odds with static executables).\r\nBut definitely worth investigating.",
      "created_at" : "2020-02-11T12:41:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/18110#issuecomment-584615937",
      "id" : 584615937,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18110",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NDYxNTkzNw==",
      "updated_at" : "2020-02-11T12:41:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/584615937",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Similar to the CentOS build in the ci system, we could have an alpine build",
      "created_at" : "2020-02-11T12:51:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/18110#issuecomment-584619776",
      "id" : 584619776,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18110",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NDYxOTc3Ng==",
      "updated_at" : "2020-02-11T12:51:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/584619776",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Similar to the CentOS build in the ci system, we could have an alpine build\r\n\r\nThat's probably a good first step if it doesn't slow down the ci system. Are you thinking just add another runner that builds with alpine and runs the tests?",
      "created_at" : "2020-02-11T20:43:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/18110#issuecomment-584841797",
      "id" : 584841797,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18110",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NDg0MTc5Nw==",
      "updated_at" : "2020-02-11T20:43:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/584841797",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I'm not sure how this is going to interact with, say, the GUI (desktop/system integration is pretty much at odds with static executables).\r\n> But definitely worth investigating.\r\n\r\n@laanwj Ah yes good point. I don't think it'd be too weird if we end up supporting building everything other than `bitcoin-qt` statically with musl?",
      "created_at" : "2020-02-11T20:45:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/18110#issuecomment-584842798",
      "id" : 584842798,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18110",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NDg0Mjc5OA==",
      "updated_at" : "2020-02-11T20:45:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/584842798",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Did an experimental x86_64-native build of v0.20.1 (bitcoind-only) with alpine's musl-based toolchain...\r\n\r\nThe `configure` line that worked:\r\n```bash\r\nenv CONFIG_SITE=$PWD/depends/x86_64-pc-linux-musl/share/config.site \\\r\n    ./configure --disable-ccache \\\r\n                --disable-maintainer-mode \\\r\n                --disable-dependency-tracking \\\r\n                --enable-reduce-exports --disable-bench \\\r\n                --disable-gui-tests \\\r\n                CC=clang CXX=clang++ \\\r\n                CFLAGS=\"-O2 -g0 --static -static -fPIC\" \\\r\n                CXXFLAGS=\"-O2 -g0 --static -static -fPIC\" \\\r\n                LDFLAGS=\"-s -static-libgcc -static-libstdc++ -Wl,-O2\"\r\n```\r\n\r\n```\r\n~/bitcoin # file src/bitcoind\r\nsrc/bitcoind: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, stripped\r\n```\r\n\r\nSize-wise, it looks doable (at least for `bitcoind` itself):\r\n- 10,132 KiB: musl-built fully-static bitcoind v0.20.1\r\n- 10,072 KiB: release bitcoind v0.20.1\r\n\r\n",
      "created_at" : "2020-12-25T20:51:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/18110#issuecomment-751289914",
      "id" : 751289914,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18110",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MTI4OTkxNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-25T20:53:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/751289914",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Nice work!\r\n\r\nIt would be interesting to see benchmarks of sync performance. I don't expect that much of a difference, but it could go either way. The glibc allocator is quite efficient, I think musl's is somewhat simpler and slower in some cases. On the other hand, static linking can reduce call overhead (especially wih LTO, but that's a matter for another time).\r\n\r\n> @laanwj Ah yes good point. I don't think it'd be too weird if we end up supporting building everything other than bitcoin-qt statically with musl?\r\n\r\nI don't see a strong reason why not. Having some more requirements on the system (with regard to installed libraries, and e.g. fonts) for the GUI than for the other tools is not unreasonable. Thinking of it it's very little different from how things are now.",
      "created_at" : "2021-01-02T23:34:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/18110#issuecomment-753543704",
      "id" : 753543704,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18110",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MzU0MzcwNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-02T23:35:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/753543704",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I was thinking about this a bit again in context of #21022 and I think having a static `bitcoind` that runs directly on top of the kernel and doesn't depend on any libraries that happen to be on the system would be a good aim, at least for the release binaries. It removes a aource of variability and possible bugs. It would allow getting rid of all the glibc compatibility hacks.\r\n\r\nAlso it would also make packaging into containers, app images, and VMs and such easier. Basically you'd need only the binary and that's that.",
      "created_at" : "2021-01-28T18:34:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/18110#issuecomment-769289338",
      "id" : 769289338,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18110",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2OTI4OTMzOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-28T18:34:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769289338",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
