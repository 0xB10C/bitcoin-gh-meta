[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15842#discussion_r276680164"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15842"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276680164"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Accessing `m_last_block_processed` requires the `cs_wallet` lock. I think to make this work you'll need to:\r\n- grab `cs_wallet`\r\n- access `m_last_block_processed`\r\n- release `cs_wallet`\r\n- call the `waitForNotificationsUpToTip` interface method\r\n\r\nAlternatively, we could make `m_last_block_processed` an atomic.\r\n\r\nThoughts, @ryanofsky ?",
      "commit_id" : "1bcf91d49f0a399d505207428ac38f77e9c4e47c",
      "created_at" : "2019-04-18T14:09:27Z",
      "diff_hunk" : "@@ -1288,24 +1288,11 @@ void CWallet::UpdatedBlockTip()\n \n void CWallet::BlockUntilSyncedToCurrentChain() {\n     AssertLockNotHeld(cs_wallet);\n-\n-    {\n-        // Skip the queue-draining stuff if we know we're caught up with\n-        // chainActive.Tip()...\n-        // We could also take cs_wallet here, and call m_last_block_processed\n-        // protected by cs_wallet instead of cs_main, but as long as we need\n-        // cs_main here anyway, it's easier to just call it cs_main-protected.\n-        auto locked_chain = chain().lock();\n-\n-        if (!m_last_block_processed.IsNull() && locked_chain->isPotentialTip(m_last_block_processed)) {\n-            return;\n-        }\n-    }\n-\n-    // ...otherwise put a callback in the validation interface queue and wait\n+    // Skip the queue-draining stuff if we know we're caught up with\n+    // chainActive.Tip(), otherwise put a callback in the validation interface queue and wait\n     // for the queue to drain enough to execute it (indicating we are caught up\n     // at least with the time we entered this function).\n-    chain().waitForNotifications();\n+    chain().waitForNotificationsUpToTip(m_last_block_processed);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15842#discussion_r276680164",
      "id" : 276680164,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NjY4MDE2NA==",
      "original_commit_id" : "1bcf91d49f0a399d505207428ac38f77e9c4e47c",
      "original_position" : 24,
      "path" : "src/wallet/wallet.cpp",
      "position" : 24,
      "pull_request_review_id" : 228307233,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15842",
      "updated_at" : "2019-04-18T14:09:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276680164",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#15778](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15778.html) ([wallet] Move maxtxfee from node to wallet by jnewbery)\n* [#15713](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15713.html) (refactor: Replace chain relayTransactions/submitMemoryPool by higher method by ariard)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-04-18T15:13:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15842#issuecomment-484550891",
      "id" : 484550891,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15842",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NDU1MDg5MQ==",
      "updated_at" : "2019-04-18T15:13:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/484550891",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
