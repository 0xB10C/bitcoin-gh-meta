[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2019-04-18T18:44:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-484636149",
      "id" : 484636149,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NDYzNjE0OQ==",
      "updated_at" : "2019-04-18T18:44:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/484636149",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r276791064"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276791064"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This will miss P2PKH outputs I think.",
      "commit_id" : "abcddec08cc7ba06b0dea1ad3ca03a95f541dc93",
      "created_at" : "2019-04-18T18:53:17Z",
      "diff_hunk" : "@@ -1748,6 +1748,21 @@ int64_t CWallet::RescanFromTime(int64_t startTime, const WalletRescanReserver& r\n     return startTime;\n }\n \n+GCSFilter::ElementSet CWallet::GetScriptPubKeysForBlockFilter()\n+{\n+    GCSFilter::ElementSet ret;\n+    for (const auto& i : CBasicKeyStore::GetAllWatchedScriptPubKeys()) {\n+        ret.emplace(i.begin(), i.end());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r276791064",
      "id" : 276791064,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Njc5MTA2NA==",
      "original_commit_id" : "ffff46a547fc03dec3157e56a5953f4b3a8e9937",
      "original_position" : 8,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 228451408,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-04-24T17:34:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276791064",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2019-04-18T18:53:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-484640077",
      "id" : 484640077,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NDY0MDA3Nw==",
      "updated_at" : "2019-04-18T18:53:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/484640077",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r276791373"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276791373"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Just because we know about a script does not imply we're watching it I believe.",
      "commit_id" : "abcddec08cc7ba06b0dea1ad3ca03a95f541dc93",
      "created_at" : "2019-04-18T18:54:04Z",
      "diff_hunk" : "@@ -1748,6 +1748,21 @@ int64_t CWallet::RescanFromTime(int64_t startTime, const WalletRescanReserver& r\n     return startTime;\n }\n \n+GCSFilter::ElementSet CWallet::GetScriptPubKeysForBlockFilter()\n+{\n+    GCSFilter::ElementSet ret;\n+    for (const auto& i : CBasicKeyStore::GetAllWatchedScriptPubKeys()) {\n+        ret.emplace(i.begin(), i.end());\n+    }\n+    for (const auto& bs : CBasicKeyStore::GetAllBareScripts()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r276791373",
      "id" : 276791373,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Njc5MTM3Mw==",
      "original_commit_id" : "ffff46a547fc03dec3157e56a5953f4b3a8e9937",
      "original_position" : 10,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 228451798,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-04-24T17:34:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276791373",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r276792123"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276792123"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure, but I'd rather err on the safe side of scanning a block too much than missing a block (and thus lose coins)",
      "commit_id" : "abcddec08cc7ba06b0dea1ad3ca03a95f541dc93",
      "created_at" : "2019-04-18T18:56:01Z",
      "diff_hunk" : "@@ -1748,6 +1748,21 @@ int64_t CWallet::RescanFromTime(int64_t startTime, const WalletRescanReserver& r\n     return startTime;\n }\n \n+GCSFilter::ElementSet CWallet::GetScriptPubKeysForBlockFilter()\n+{\n+    GCSFilter::ElementSet ret;\n+    for (const auto& i : CBasicKeyStore::GetAllWatchedScriptPubKeys()) {\n+        ret.emplace(i.begin(), i.end());\n+    }\n+    for (const auto& bs : CBasicKeyStore::GetAllBareScripts()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r276792123",
      "id" : 276792123,
      "in_reply_to_id" : 276791373,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Njc5MjEyMw==",
      "original_commit_id" : "ffff46a547fc03dec3157e56a5953f4b3a8e9937",
      "original_position" : 10,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 228452738,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-04-24T17:34:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276792123",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Nice! That was quick.\r\nConcept ACK",
      "created_at" : "2019-04-18T18:58:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-484642339",
      "id" : 484642339,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NDY0MjMzOQ==",
      "updated_at" : "2019-04-18T18:58:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/484642339",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r276793224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276793224"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could you please elaborate in which code path we import a P2PKH address or a public key without adding it to `setWatchOnly`?",
      "commit_id" : "abcddec08cc7ba06b0dea1ad3ca03a95f541dc93",
      "created_at" : "2019-04-18T18:58:56Z",
      "diff_hunk" : "@@ -1748,6 +1748,21 @@ int64_t CWallet::RescanFromTime(int64_t startTime, const WalletRescanReserver& r\n     return startTime;\n }\n \n+GCSFilter::ElementSet CWallet::GetScriptPubKeysForBlockFilter()\n+{\n+    GCSFilter::ElementSet ret;\n+    for (const auto& i : CBasicKeyStore::GetAllWatchedScriptPubKeys()) {\n+        ret.emplace(i.begin(), i.end());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r276793224",
      "id" : 276793224,
      "in_reply_to_id" : 276791064,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Njc5MzIyNA==",
      "original_commit_id" : "ffff46a547fc03dec3157e56a5953f4b3a8e9937",
      "original_position" : 8,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 228454101,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-04-24T17:34:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/276793224",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Some rough benchmarks\r\n\r\n{\r\n  \"start_height\": 0,\r\n  \"stop_height\": 572152\r\n}\r\n\r\nreal\t4m23.596s\r\n\r\n\r\nA simple wallet,... filtered out roughly 2900 blocks and scanned them.",
      "created_at" : "2019-04-18T20:14:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-484672833",
      "id" : 484672833,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NDY3MjgzMw==",
      "updated_at" : "2019-04-18T20:14:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/484672833",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#15901](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15901.html) (wallet: log on rescan completion by andrewtoth)\n* [#15810](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15810.html) ([WIP] Remove nAbsurdFee fee from AcceptToMemoryPool by jnewbery)\n* [#15778](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15778.html) ([wallet] Move maxtxfee from node to wallet by jnewbery)\n* [#15764](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15764.html) (Native descriptor wallets by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.<!--2502f1a698b3751726fa55edcda76cd3-->\n\n### Coverage\n\n| Coverage  | Change ([pull 15845](https://drahtbot.github.io/reports/coverage/bitcoin/bitcoin/15845/total.coverage/index.html), 77e593bc79216175fa4c2fd05278bf1b7e4c7146) | Reference ([master](https://drahtbot.github.io/reports/coverage/bitcoin/bitcoin/master/total.coverage/index.html), 56376f336548b53cf31e98a58dfb4db22cede6e5)   |\n|-----------|-------------------------|--------------------|\n| Lines     | +0.0064 %            | 87.5552 %        |\n| Functions | -0.0143 %            | 84.6451 %        |\n| Branches  | +0.0017 %            | 51.5534 %        |\n\n<sup>Updated at: 2019-04-19T22:20:19.826705.</sup>\n",
      "created_at" : "2019-04-19T22:20:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-485027756",
      "id" : 485027756,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NTAyNzc1Ng==",
      "updated_at" : "2019-04-26T18:05:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485027756",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277109313"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277109313"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`result.last_scanned_block` and `result.last_scanned_height` should both be updated even if the filter doesn't match.",
      "commit_id" : "abcddec08cc7ba06b0dea1ad3ca03a95f541dc93",
      "created_at" : "2019-04-19T23:03:45Z",
      "diff_hunk" : "@@ -1806,6 +1820,8 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n                 WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", *block_height, progress_current);\n             }\n \n+            if (chain().filterMatchesAny(block_hash, filter_set)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277109313",
      "id" : 277109313,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzEwOTMxMw==",
      "original_commit_id" : "2a884d347eec442e81ce0b9fde7b728caed9d6da",
      "original_position" : 43,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 228848610,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-04-24T17:34:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277109313",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277110073"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277110073"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You don't need the lock for the filter lookup, just the block index lookup.",
      "commit_id" : "abcddec08cc7ba06b0dea1ad3ca03a95f541dc93",
      "created_at" : "2019-04-19T23:10:14Z",
      "diff_hunk" : "@@ -268,10 +268,13 @@ class ChainImpl : public Chain\n     {\n         const BlockFilterIndex* block_filter_index = GetBlockFilterIndex(BlockFilterType::BASIC);\n         if (!block_filter_index) return true;\n-        const CBlockIndex* index = LookupBlockIndex(hash);\n-        if (!index) return true;\n         BlockFilter filter;\n-        if (!block_filter_index->LookupFilter(index, filter)) return true;\n+        {\n+            LOCK(cs_main);\n+            const CBlockIndex* index = LookupBlockIndex(hash);\n+            if (!index) return true;\n+            if (!block_filter_index->LookupFilter(index, filter)) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277110073",
      "id" : 277110073,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzExMDA3Mw==",
      "original_commit_id" : "106e7c9ab68301c80870a5166d4f5cfb27287679",
      "original_position" : 12,
      "path" : "src/interfaces/chain.cpp",
      "position" : null,
      "pull_request_review_id" : 228848610,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-04-24T17:34:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277110073",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277110229"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277110229"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe make the BlockFilterType a parameter here?",
      "commit_id" : "abcddec08cc7ba06b0dea1ad3ca03a95f541dc93",
      "created_at" : "2019-04-19T23:11:46Z",
      "diff_hunk" : "@@ -263,6 +264,19 @@ class ChainImpl : public Chain\n         return std::move(result);\n     }\n     std::unique_ptr<Chain::Lock> assumeLocked() override { return MakeUnique<LockImpl>(); }\n+    bool filterMatchesAny(const uint256& hash, const GCSFilter::ElementSet& filter_set) override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277110229",
      "id" : 277110229,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzExMDIyOQ==",
      "original_commit_id" : "106e7c9ab68301c80870a5166d4f5cfb27287679",
      "original_position" : 12,
      "path" : "src/interfaces/chain.cpp",
      "position" : null,
      "pull_request_review_id" : 228848610,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-04-24T17:34:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277110229",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277110327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277110327"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'd note in the comment that it's a basic (type) block filter (in cases an other types are added).",
      "commit_id" : "abcddec08cc7ba06b0dea1ad3ca03a95f541dc93",
      "created_at" : "2019-04-19T23:12:47Z",
      "diff_hunk" : "@@ -677,6 +678,9 @@ class CWallet final : public CCryptoKeyStore, private interfaces::Chain::Notific\n      * Should be called with non-zero block_hash and posInBlock if this is for a transaction that is included in a block. */\n     void SyncTransaction(const CTransactionRef& tx, const uint256& block_hash, int posInBlock = 0, bool update_tx = true) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n \n+    /** Return all scriptPubKeys to be used in a BIP 157 block filter */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277110327",
      "id" : 277110327,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzExMDMyNw==",
      "original_commit_id" : "106e7c9ab68301c80870a5166d4f5cfb27287679",
      "original_position" : 12,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 228848610,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-04-24T17:34:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277110327",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277111477"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277111477"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is problematic for a few reasons.\r\n\r\n1) You can turn on the filter index and it will build in the background using the blocks on disk. This wouldn't work in pruned mode. It might be safe though to allow pruning if the block filter index tip is already within chain tip height - MIN_BLOCKS_TO_KEEP. But then we couldn't prune until the block filter index is in sync (it has its own sort of initial sync logic). Not prohibitively difficult though.\r\n2) There still needs to be logic to fetch blocks from the network if the filters match, which I don't see here. Doing that in a blocking way would probably still be quite slow, especially with the default keypool size as large as it is.",
      "commit_id" : "abcddec08cc7ba06b0dea1ad3ca03a95f541dc93",
      "created_at" : "2019-04-19T23:24:23Z",
      "diff_hunk" : "@@ -986,9 +986,6 @@ bool AppInitParameterInteraction()\n     if (gArgs.GetArg(\"-prune\", 0)) {\n         if (gArgs.GetBoolArg(\"-txindex\", DEFAULT_TXINDEX))\n             return InitError(_(\"Prune mode is incompatible with -txindex.\"));\n-        if (!g_enabled_filter_types.empty()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277111477",
      "id" : 277111477,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzExMTQ3Nw==",
      "original_commit_id" : "106e7c9ab68301c80870a5166d4f5cfb27287679",
      "original_position" : 4,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 228848610,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-04-24T17:34:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277111477",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277112226"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277112226"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh, there's another optimization possible, which is to not call `filterMatchesAny` if the filter index doesn't exist or doesn't contain any entry for any of the previously queried block hashes. If `filterMatchesAny` indicates whether the filter was found in addition to whether it matches, it would be pretty easy to check this.",
      "commit_id" : "abcddec08cc7ba06b0dea1ad3ca03a95f541dc93",
      "created_at" : "2019-04-19T23:31:28Z",
      "diff_hunk" : "@@ -1806,6 +1820,8 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n                 WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", *block_height, progress_current);\n             }\n \n+            if (chain().filterMatchesAny(block_hash, filter_set)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277112226",
      "id" : 277112226,
      "in_reply_to_id" : 277109313,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzExMjIyNg==",
      "original_commit_id" : "2a884d347eec442e81ce0b9fde7b728caed9d6da",
      "original_position" : 43,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 228852099,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-04-24T17:34:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277112226",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jimpo  \r\n\r\n> Why is the default keypool size so large?\r\n\r\nIIRC this makes it much less likely typical usage will hit a case when an encrypted wallet runs out of viable keys and starts to miss funds during a sync(since it currently doesn't pause a sync and ask the user for password).",
      "created_at" : "2019-04-20T19:06:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-485151790",
      "id" : 485151790,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NTE1MTc5MA==",
      "updated_at" : "2019-04-20T19:06:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485151790",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "and the obligatory concept ACK!",
      "created_at" : "2019-04-20T19:07:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-485151846",
      "id" : 485151846,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NTE1MTg0Ng==",
      "updated_at" : "2019-04-20T19:07:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485151846",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Why is the default keypool size so large?\r\n\r\nIt isn't. It's small... the whole concept of 'gap' scanning is fairly broken and easily results in funds loss... e.g. when a user hands out multiple addresses to people who haven't used them yet.  The brokenness can be largely addressed by setting the lookahead pretty far.\r\n\r\nIn some prelim testing this appears to be slower than just rescanning the block files directly with a specialized parser. :(",
      "created_at" : "2019-04-20T20:00:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-485160938",
      "id" : 485160938,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NTE2MDkzOA==",
      "updated_at" : "2019-04-20T20:00:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485160938",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@gmaxwell What specialized parser are you comparing to? Does it include the time to match all outputs/inputs to a set of 6000 sPKs?",
      "created_at" : "2019-04-20T20:36:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-485166805",
      "id" : 485166805,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NTE2NjgwNQ==",
      "updated_at" : "2019-04-20T20:36:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485166805",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jimpo 2 keypools (external and change), each 1000 keys, each key 3 sPKs (p2pkh, p2sh-p2wpkh, native p2wpkh), so I expect 6000 entries to match against.",
      "created_at" : "2019-04-20T20:42:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#issuecomment-485167872",
      "id" : 485167872,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15845",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NTE2Nzg3Mg==",
      "updated_at" : "2019-04-20T20:42:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485167872",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277298317"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277298317"
         }
      },
      "author_association" : "MEMBER",
      "body" : "CBlockIndex::nDataPos is protected by cs_main, but we never read that in LookupFilter, so yeah, don't need the lock",
      "commit_id" : "abcddec08cc7ba06b0dea1ad3ca03a95f541dc93",
      "created_at" : "2019-04-22T14:00:01Z",
      "diff_hunk" : "@@ -268,10 +268,13 @@ class ChainImpl : public Chain\n     {\n         const BlockFilterIndex* block_filter_index = GetBlockFilterIndex(BlockFilterType::BASIC);\n         if (!block_filter_index) return true;\n-        const CBlockIndex* index = LookupBlockIndex(hash);\n-        if (!index) return true;\n         BlockFilter filter;\n-        if (!block_filter_index->LookupFilter(index, filter)) return true;\n+        {\n+            LOCK(cs_main);\n+            const CBlockIndex* index = LookupBlockIndex(hash);\n+            if (!index) return true;\n+            if (!block_filter_index->LookupFilter(index, filter)) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277298317",
      "id" : 277298317,
      "in_reply_to_id" : 277110073,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzI5ODMxNw==",
      "original_commit_id" : "106e7c9ab68301c80870a5166d4f5cfb27287679",
      "original_position" : 12,
      "path" : "src/interfaces/chain.cpp",
      "position" : null,
      "pull_request_review_id" : 229072200,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-04-24T17:34:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277298317",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277298459"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277298459"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Indeed, last_scanned_height is reported by rpc as the stop_height, so should be updated.",
      "commit_id" : "abcddec08cc7ba06b0dea1ad3ca03a95f541dc93",
      "created_at" : "2019-04-22T14:00:31Z",
      "diff_hunk" : "@@ -1806,6 +1820,8 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n                 WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", *block_height, progress_current);\n             }\n \n+            if (chain().filterMatchesAny(block_hash, filter_set)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277298459",
      "id" : 277298459,
      "in_reply_to_id" : 277109313,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzI5ODQ1OQ==",
      "original_commit_id" : "2a884d347eec442e81ce0b9fde7b728caed9d6da",
      "original_position" : 43,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 229072386,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-04-24T17:34:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277298459",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277298780"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277298780"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Will there ever be a filter different from the basic filter?",
      "commit_id" : "abcddec08cc7ba06b0dea1ad3ca03a95f541dc93",
      "created_at" : "2019-04-22T14:01:27Z",
      "diff_hunk" : "@@ -263,6 +264,19 @@ class ChainImpl : public Chain\n         return std::move(result);\n     }\n     std::unique_ptr<Chain::Lock> assumeLocked() override { return MakeUnique<LockImpl>(); }\n+    bool filterMatchesAny(const uint256& hash, const GCSFilter::ElementSet& filter_set) override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277298780",
      "id" : 277298780,
      "in_reply_to_id" : 277110229,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzI5ODc4MA==",
      "original_commit_id" : "106e7c9ab68301c80870a5166d4f5cfb27287679",
      "original_position" : 12,
      "path" : "src/interfaces/chain.cpp",
      "position" : null,
      "pull_request_review_id" : 229072727,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-04-24T17:34:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277298780",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277299161"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277299161"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Mentioned \"basic\"",
      "commit_id" : "abcddec08cc7ba06b0dea1ad3ca03a95f541dc93",
      "created_at" : "2019-04-22T14:02:47Z",
      "diff_hunk" : "@@ -677,6 +678,9 @@ class CWallet final : public CCryptoKeyStore, private interfaces::Chain::Notific\n      * Should be called with non-zero block_hash and posInBlock if this is for a transaction that is included in a block. */\n     void SyncTransaction(const CTransactionRef& tx, const uint256& block_hash, int posInBlock = 0, bool update_tx = true) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n \n+    /** Return all scriptPubKeys to be used in a BIP 157 block filter */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277299161",
      "id" : 277299161,
      "in_reply_to_id" : 277110327,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzI5OTE2MQ==",
      "original_commit_id" : "106e7c9ab68301c80870a5166d4f5cfb27287679",
      "original_position" : 12,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 229073229,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-04-24T17:34:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277299161",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277299318"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277299318"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmm, right",
      "commit_id" : "abcddec08cc7ba06b0dea1ad3ca03a95f541dc93",
      "created_at" : "2019-04-22T14:03:13Z",
      "diff_hunk" : "@@ -986,9 +986,6 @@ bool AppInitParameterInteraction()\n     if (gArgs.GetArg(\"-prune\", 0)) {\n         if (gArgs.GetBoolArg(\"-txindex\", DEFAULT_TXINDEX))\n             return InitError(_(\"Prune mode is incompatible with -txindex.\"));\n-        if (!g_enabled_filter_types.empty()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15845#discussion_r277299318",
      "id" : 277299318,
      "in_reply_to_id" : 277111477,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NzI5OTMxOA==",
      "original_commit_id" : "106e7c9ab68301c80870a5166d4f5cfb27287679",
      "original_position" : 4,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 229073407,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15845",
      "updated_at" : "2019-04-24T17:34:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/277299318",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
