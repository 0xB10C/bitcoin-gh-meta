[
   {
      "body" : "utACK; nice!",
      "created_at" : "2014-11-23T11:35:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5347#issuecomment-64114916",
      "id" : 64114916,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5347",
      "updated_at" : "2014-11-23T11:35:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64114916",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Sorry if I'm missing something, but why is it OK to remove the mapNextTx check?  Where is the duplicate check?  I ran a little test on this pull that sent a second transaction that reused an input, and the second tx was accepted to the memory pool and then caused an assertion to fail in mempool.check() at line 543 in txmempool.cpp.  ",
      "created_at" : "2014-11-24T18:04:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5347#issuecomment-64235886",
      "id" : 64235886,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5347",
      "updated_at" : "2014-11-24T18:04:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64235886",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "@morcos In that case there is something else wrong. The first patch would avoid exposing outputs already spent inside the mempool in the used coinsview, so the \"HaveInputs\" check should fail for transactions that spend such outputs.",
      "created_at" : "2014-11-24T18:11:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5347#issuecomment-64236928",
      "id" : 64236928,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5347",
      "updated_at" : "2014-11-24T18:11:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64236928",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I think the problem might be that in `CCoinsViewMemPool::GetCoins` ,  `mempool.pruneSpent` is only called on coins returned from the mempool.  But you can still return unpruned coins from the chain that have outputs spent by other transactions in the mempool.",
      "created_at" : "2014-11-24T18:58:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5347#issuecomment-64244338",
      "id" : 64244338,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5347",
      "updated_at" : "2014-11-24T18:58:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64244338",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "Nice catch!",
      "created_at" : "2014-11-24T19:02:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5347#issuecomment-64244921",
      "id" : 64244921,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5347",
      "updated_at" : "2014-11-24T19:02:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/64244921",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Is this salvageable?  If a ``CCoinsView`` is to be used for conflict checks, it would need to persist across successive incoming transactions.  As @morcos says, the commits do not accomplish this.",
      "created_at" : "2014-11-30T21:11:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5347#issuecomment-65000476",
      "id" : 65000476,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5347",
      "updated_at" : "2014-11-30T21:11:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/65000476",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4284124?v=3",
         "events_url" : "https://api.github.com/users/dgenr8/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dgenr8/followers",
         "following_url" : "https://api.github.com/users/dgenr8/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dgenr8/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dgenr8",
         "id" : 4284124,
         "login" : "dgenr8",
         "organizations_url" : "https://api.github.com/users/dgenr8/orgs",
         "received_events_url" : "https://api.github.com/users/dgenr8/received_events",
         "repos_url" : "https://api.github.com/users/dgenr8/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dgenr8/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dgenr8/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dgenr8"
      }
   },
   {
      "body" : "Sure, just need to adapt GetCoins in CCoinsViewMemPool to call pruneSpent on non-mempool coins too, easy as pie :)",
      "created_at" : "2014-11-30T21:18:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5347#issuecomment-65000742",
      "id" : 65000742,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5347",
      "updated_at" : "2014-11-30T21:18:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/65000742",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "You mean start using pcoinsTip so that it no longer represents the tip, but tip+mempool?",
      "created_at" : "2014-12-01T01:55:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5347#issuecomment-65012095",
      "id" : 65012095,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5347",
      "updated_at" : "2014-12-01T01:55:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/65012095",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4284124?v=3",
         "events_url" : "https://api.github.com/users/dgenr8/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dgenr8/followers",
         "following_url" : "https://api.github.com/users/dgenr8/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dgenr8/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dgenr8",
         "id" : 4284124,
         "login" : "dgenr8",
         "organizations_url" : "https://api.github.com/users/dgenr8/orgs",
         "received_events_url" : "https://api.github.com/users/dgenr8/received_events",
         "repos_url" : "https://api.github.com/users/dgenr8/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dgenr8/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dgenr8/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dgenr8"
      }
   },
   {
      "body" : "@dgenr8 No, like the middle commit I just pushed :p",
      "created_at" : "2014-12-21T02:10:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5347#issuecomment-67757517",
      "id" : 67757517,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5347",
      "updated_at" : "2014-12-21T02:10:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/67757517",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Also added a little mini-testcase to catch this case (and any simple mempool double-spend) just because :).",
      "created_at" : "2014-12-21T02:44:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5347#issuecomment-67758119",
      "id" : 67758119,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5347",
      "updated_at" : "2014-12-21T02:44:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/67758119",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@TheBlueMatt Ok. The mempool containing tx1 is the elusive \"persistence mechanism\" I was hung up on.",
      "created_at" : "2014-12-21T21:37:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5347#issuecomment-67785826",
      "id" : 67785826,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5347",
      "updated_at" : "2014-12-21T21:37:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/67785826",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4284124?v=3",
         "events_url" : "https://api.github.com/users/dgenr8/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dgenr8/followers",
         "following_url" : "https://api.github.com/users/dgenr8/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dgenr8/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dgenr8",
         "id" : 4284124,
         "login" : "dgenr8",
         "organizations_url" : "https://api.github.com/users/dgenr8/orgs",
         "received_events_url" : "https://api.github.com/users/dgenr8/received_events",
         "repos_url" : "https://api.github.com/users/dgenr8/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dgenr8/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dgenr8/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dgenr8"
      }
   },
   {
      "body" : "@dgenr8 heh, thanks...hadnt realized this failed :)",
      "created_at" : "2014-12-22T02:26:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5347#issuecomment-67796088",
      "id" : 67796088,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5347",
      "updated_at" : "2014-12-22T02:26:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/67796088",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   }
]
