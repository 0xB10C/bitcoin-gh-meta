[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : ">We can forward it to these two groups IN ADDITION to forwarding to (1 or 2) peers, if there is a belief that this is might affect their security. The bandwidth overhead would be obviously very low.\r\n\r\nIt is good for SPV nodes to get addrs sent to them, but it doesn't benefit the network as much as sending addrs to a full node. Ensuring addrs go to 2 full node peers without excluding SPV nodes seems to capture the requirements well.",
      "created_at" : "2019-10-18T21:45:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17194#issuecomment-543965236",
      "id" : 543965236,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17194",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0Mzk2NTIzNg==",
      "updated_at" : "2019-10-18T21:45:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/543965236",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "node_id" : "MDQ6VXNlcjI3NDgxNA==",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nThanks for working on this!",
      "created_at" : "2019-10-20T14:20:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17194#issuecomment-544256694",
      "id" : 544256694,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17194",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NDI1NjY5NA==",
      "updated_at" : "2019-10-20T14:20:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/544256694",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> It is good for SPV nodes to get addrs sent to them\r\n\r\nDo you mean *unsolicited* addrs? If so, I tend to disagree. That would make it harder to run a bandwidth efficient non-addr-relay node (e.g. an \"SPV node\"). I think that addr messages should only be gossiped to bip-155 nodes or network nodes (detectable via service bit). All other nodes should send a `getaddr` or `getaddrv2` p2p message to solicit addresses.",
      "created_at" : "2019-10-22T19:46:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17194#issuecomment-545123214",
      "id" : 545123214,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17194",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTEyMzIxNA==",
      "updated_at" : "2019-10-22T19:46:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545123214",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think it's a bit more nuanced than that.\r\n\r\nIn an ideal world, I think light clients would participate in local IP address management. Perhaps they wouldn't relay addresses themselves, but even if not, they should be learning from IP addresses that are gossiped around.\r\n\r\nIn reality it seems that none of them do, and obviously gossipping IP addresses to nodes that are just going to ignore them is pointless.\r\n\r\n",
      "created_at" : "2019-10-22T19:53:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17194#issuecomment-545125684",
      "id" : 545125684,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17194",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTEyNTY4NA==",
      "updated_at" : "2019-10-22T19:53:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545125684",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I wanted to note that one SPV client I'm aware of does (or at least did) use addr messages to find nodes.  E.g., see this code:\r\n\r\n- https://github.com/breadwallet/breadwallet-core/blob/494aa99ed61df24d13e45f6b335cda192c1b765c/bitcoin/BRPeer.c#L268\r\n\r\nHowever, that wallet also uses BIP37 bloom filters, so I don't know what their strategy will be going forward with regards to using the P2P protocol.  Directly relevant to this PR, it looks like they don't accept unsolicited addr messages anyway---they only accept responses to a getaddr message: https://github.com/breadwallet/breadwallet-core/blob/494aa99ed61df24d13e45f6b335cda192c1b765c/bitcoin/BRPeer.c#L282",
      "created_at" : "2019-11-03T15:29:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17194#issuecomment-549148189",
      "id" : 549148189,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17194",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0OTE0ODE4OQ==",
      "updated_at" : "2019-11-03T15:29:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/549148189",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/61096?v=4",
         "events_url" : "https://api.github.com/users/harding/events{/privacy}",
         "followers_url" : "https://api.github.com/users/harding/followers",
         "following_url" : "https://api.github.com/users/harding/following{/other_user}",
         "gists_url" : "https://api.github.com/users/harding/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/harding",
         "id" : 61096,
         "login" : "harding",
         "node_id" : "MDQ6VXNlcjYxMDk2",
         "organizations_url" : "https://api.github.com/users/harding/orgs",
         "received_events_url" : "https://api.github.com/users/harding/received_events",
         "repos_url" : "https://api.github.com/users/harding/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/harding/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/harding/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/harding"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "So, it seems like most of us agree that we should allow light clients to request addrs, and we should **not** send them unsolicited addr messages assuming they forward them.\r\n\r\nJust wanted to clarify, it is exactly what this PR does.",
      "created_at" : "2019-11-05T18:48:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17194#issuecomment-549964175",
      "id" : 549964175,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17194",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0OTk2NDE3NQ==",
      "updated_at" : "2019-11-05T18:48:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/549964175",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I updated the script to account for black holes and be more precise in general (original post is updated to reflect new numbers).\r\nThe result is: current behavior is actually not as bad as I thought.\r\nI still think it's worth merging it though, especially because it will take a while for us to figure out all addrV2 stuff.\r\nSo let's save some bandwidth and make address relay be more effective for the cost of merging one line.",
      "created_at" : "2019-12-01T18:09:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17194#issuecomment-560138545",
      "id" : 560138545,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17194",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2MDEzODU0NQ==",
      "updated_at" : "2019-12-01T18:59:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/560138545",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@naumenkogs \r\nIf I understand you correctly this commit now excludes sending addrs to non-forward nodes, but would send addrs to SPV clients that do forward addrs?\r\n\r\nI looked through the commit and it wasn't completely obvious to me, how `MayHaveUsefulAddressDB` excludes non-forwarding nodes?\r\n\r\nI know `MayHaveUsefulAddressDB` checks the service flags and I read the service flag descriptions in the code but the flags seem obscure to me i.e. I have trouble understanding precisely what they denote. Also one imagines that a non-forwarding node may have a \"useful address DB\" so the name of the function call is slightly deceptive.\r\n\r\nI would advocate for a comment explaining the intention of the call: \"We are calling `MayHaveUsefulAddressDB` to exclude non-forwarding nodes.\"",
      "created_at" : "2019-12-02T15:55:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17194#issuecomment-560457030",
      "id" : 560457030,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17194",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2MDQ1NzAzMA==",
      "updated_at" : "2019-12-02T15:55:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/560457030",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "node_id" : "MDQ6VXNlcjI3NDgxNA==",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@EthanHeilman\r\n>this commit now excludes sending addrs to non-forward nodes, but would send addrs to SPV clients that do forward addrs?\r\n\r\nNo. Unfortunately, right now there is no way to distinguish forwarding SPV nodes and non-forwarding SPV nodes.\r\nBased on the implementations of SPV nodes I found, none of them forward addrs, so I suggest not forwarding to *all* SPV nodes for now (until we progress with an explicit opt-in addr forwarding).\r\nAlso we found that some implementations would still *request* addrs, and after this PR they would still be allowed to do so.\r\n\r\nFyi, service bits ``NODE_NETWORK | NODE_NETWORK_LIMITED`` currently literally mean \"everything except SPV\".\r\n\r\nNow I agree that documenting and renaming the function would be useful here, will do.",
      "created_at" : "2019-12-02T18:49:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17194#issuecomment-560528800",
      "id" : 560528800,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17194",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2MDUyODgwMA==",
      "updated_at" : "2019-12-02T18:49:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/560528800",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14033](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14033.html) (p2p: Drop CADDR_TIME_VERSION checks now that MIN_PEER_PROTO_VERSION is greater by Empact)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-01-17T07:45:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17194#issuecomment-575514104",
      "id" : 575514104,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17194",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NTUxNDEwNA==",
      "updated_at" : "2020-01-17T07:45:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/575514104",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
