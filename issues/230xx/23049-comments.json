[
   {
      "author_association" : "NONE",
      "body" : "To build it:\r\n```\r\n./contrib/guix/guix-clean\r\nenv HOSTS='x86_64-linux-gnu' ./contrib/guix/guix-build\r\n```\r\n\r\nTo test it:\r\n```\r\n ./guix-build-34bebad831a9/distsrc-34bebad831a9-x86_64-linux-gnu/src/bitcoind\r\n```\r\n\r\nAn example of how to import `sv2-ffi` in a generic c++ project can be found [here](https://github.com/stratum-mining/stratum/tree/main/examples/interop-cpp-no-cargo)",
      "created_at" : "2021-09-20T16:49:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23049#issuecomment-923099972",
      "id" : 923099972,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23049",
      "node_id" : "IC_kwDOABII5843BWNE",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-21T15:52:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/923099972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6207037?v=4",
         "events_url" : "https://api.github.com/users/Fi3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Fi3/followers",
         "following_url" : "https://api.github.com/users/Fi3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Fi3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Fi3",
         "id" : 6207037,
         "login" : "Fi3",
         "node_id" : "MDQ6VXNlcjYyMDcwMzc=",
         "organizations_url" : "https://api.github.com/users/Fi3/orgs",
         "received_events_url" : "https://api.github.com/users/Fi3/received_events",
         "repos_url" : "https://api.github.com/users/Fi3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Fi3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Fi3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Fi3"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23049#discussion_r712351205"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23049"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712351205"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think Bitcoin Core build should ever call cargo for rust stuff - we should call rustc directly with the relevant libraries.",
      "commit_id" : "bb059e4be395a34433149c6d1b465a1584c4c285",
      "created_at" : "2021-09-20T16:58:23Z",
      "diff_hunk" : "@@ -0,0 +1,36 @@\n+#! /bin/sh\n+\n+SCRIPT_DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" &> /dev/null && pwd )\"\n+\n+rm -rf ${SCRIPT_DIR}/target\n+mkdir ${SCRIPT_DIR}/target\n+mkdir ${SCRIPT_DIR}/target/package\n+\n+cargo package --manifest-path ${SCRIPT_DIR}/sv2-ffi/Cargo.toml --allow-dirty",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23049#discussion_r712351205",
      "id" : 712351205,
      "line" : 9,
      "node_id" : "PRRC_kwDOABII584qdZ3l",
      "original_commit_id" : "bb059e4be395a34433149c6d1b465a1584c4c285",
      "original_line" : 9,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/rusty/build-for-guix.sh",
      "position" : 9,
      "pull_request_review_id" : 758883359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23049",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-20T16:58:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712351205",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept NACK for Rust, until a secure bootstrap without trusted third party binaries is practical.",
      "created_at" : "2021-09-20T17:30:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23049#issuecomment-923132229",
      "id" : 923132229,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23049",
      "node_id" : "IC_kwDOABII5843BeFF",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-20T17:30:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/923132229",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23049#discussion_r712859234"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23049"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712859234"
         }
      },
      "author_association" : "NONE",
      "body" : "I'm gonna remove the cargo dependency. And subtree all the rust sources. ",
      "commit_id" : "bb059e4be395a34433149c6d1b465a1584c4c285",
      "created_at" : "2021-09-21T09:22:33Z",
      "diff_hunk" : "@@ -0,0 +1,36 @@\n+#! /bin/sh\n+\n+SCRIPT_DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" &> /dev/null && pwd )\"\n+\n+rm -rf ${SCRIPT_DIR}/target\n+mkdir ${SCRIPT_DIR}/target\n+mkdir ${SCRIPT_DIR}/target/package\n+\n+cargo package --manifest-path ${SCRIPT_DIR}/sv2-ffi/Cargo.toml --allow-dirty",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23049#discussion_r712859234",
      "id" : 712859234,
      "in_reply_to_id" : 712351205,
      "line" : 9,
      "node_id" : "PRRC_kwDOABII584qfV5i",
      "original_commit_id" : "bb059e4be395a34433149c6d1b465a1584c4c285",
      "original_line" : 9,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/rusty/build-for-guix.sh",
      "position" : 9,
      "pull_request_review_id" : 759506311,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23049",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-21T09:22:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712859234",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6207037?v=4",
         "events_url" : "https://api.github.com/users/Fi3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Fi3/followers",
         "following_url" : "https://api.github.com/users/Fi3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Fi3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Fi3",
         "id" : 6207037,
         "login" : "Fi3",
         "node_id" : "MDQ6VXNlcjYyMDcwMzc=",
         "organizations_url" : "https://api.github.com/users/Fi3/orgs",
         "received_events_url" : "https://api.github.com/users/Fi3/received_events",
         "repos_url" : "https://api.github.com/users/Fi3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Fi3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Fi3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Fi3"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Concept NACK for Rust, until a secure bootstrap without trusted third party binaries is practical.\r\n\r\nIsn't that already achieved with guix?",
      "created_at" : "2021-09-21T09:23:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23049#issuecomment-923797532",
      "id" : 923797532,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23049",
      "node_id" : "IC_kwDOABII5843EAgc",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-21T09:23:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/923797532",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6207037?v=4",
         "events_url" : "https://api.github.com/users/Fi3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Fi3/followers",
         "following_url" : "https://api.github.com/users/Fi3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Fi3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Fi3",
         "id" : 6207037,
         "login" : "Fi3",
         "node_id" : "MDQ6VXNlcjYyMDcwMzc=",
         "organizations_url" : "https://api.github.com/users/Fi3/orgs",
         "received_events_url" : "https://api.github.com/users/Fi3/received_events",
         "repos_url" : "https://api.github.com/users/Fi3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Fi3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Fi3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Fi3"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think this work is interesting, that said it might need more thought on how to interface with Core.\r\n\r\nAFAICT, the proposed PR just link the library in the build system and create a new template encoder in `bitcoind`. Though it doesn't introduce a new thread where the logic would co-run with other Core's current threads (`ThreadSocketHandler`, `ThreadOpenConnection`, ...). I initially followed this approach when I proposed AltNet with #18988. After gathering [feedbacks](https://gnusha.org/bitcoin-core-dev/2020-05-21.log) from other contributors, a separated process sounds a more flexible and safer approach.\r\n\r\nRecently, I've made some progress in this direction by building on top of the [multiprocess](https://github.com/bitcoin/bitcoin/pull/10102) project (see the hacky branch https://github.com/ariard/bitcoin/commits/2021-07-altnet-lightning). Process separation is promising, though going further I'm aiming to have AltNet pluggin modules written in Rust, while interfacing in Core over the  Cap'n Proto newer interfaces. The current bottleneck is re-writing `libmultiprocess` in Rust, see https://github.com/chaincodelabs/libmultiprocess/issues/56 for more information. It's more work than expected though I've a branch half-written doing that, hope to make it public soon(tm).\r\n\r\nI think such modules or the one proposed in the current PR could live beyond the Core repository to avoid burdening the maintenance effort and the concerns about Rust chain of trust, while consuming the stable interfaces to ease deployment across the ecosystem.\r\n\r\nGlad to see progress on the miner infrastructure, that's really needed!",
      "created_at" : "2021-09-23T01:33:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23049#issuecomment-925446441",
      "id" : 925446441,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23049",
      "node_id" : "IC_kwDOABII5843KTEp",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-23T01:33:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/925446441",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   }
]
