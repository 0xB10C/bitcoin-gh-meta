[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Is there any point in passing cfeerate by const reference vs just const\nvalue?\n\nOn Thu, Sep 23, 2021, 7:52 AM Jon Atack ***@***.***> wrote:\n\n> and add missing feerate and txmempool headers.\n> ------------------------------\n> You can view, comment on, or merge this pull request online at:\n>\n>   https://github.com/bitcoin/bitcoin/pull/23076\n> Commit Summary\n>\n>    - Pass CFeeRate and CTxMemPool in-params by reference to const\n>    <https://github.com/bitcoin/bitcoin/pull/23076/commits/2e4a6cd3c8eb8fafd940814f5f11a18a53060185>\n>\n> File Changes\n>\n>    - *M* src/policy/rbf.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/23076/files#diff-fa5cb2d84034ff72cdb9d479b17cf8c744a9bf3fc932b3a77c1a017edd767dfa>\n>    (8)\n>    - *M* src/policy/rbf.h\n>    <https://github.com/bitcoin/bitcoin/pull/23076/files#diff-a46953a84664bb5ac541df026cd5a22e88c50672f551c5e6d7825497c6535c85>\n>    (8)\n>    - *M* src/wallet/coinselection.h\n>    <https://github.com/bitcoin/bitcoin/pull/23076/files#diff-38f1a8db124a979cb6dd76ce263f7aae0053d6967ee909e6356115fa0402dc8c>\n>    (4)\n>\n> Patch Links:\n>\n>    - https://github.com/bitcoin/bitcoin/pull/23076.patch\n>    - https://github.com/bitcoin/bitcoin/pull/23076.diff\n>\n> â\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/23076>, or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AAGYN67CNE6N4Z6HYN73JHTUDM5J7ANCNFSM5ET4AYJA>\n> .\n> Triage notifications on the go with GitHub Mobile for iOS\n> <https://apps.apple.com/app/apple-store/id1477376905?ct=notification-email&mt=8&pt=524675>\n> or Android\n> <https://play.google.com/store/apps/details?id=com.github.android&referrer=utm_campaign%3Dnotification-email%26utm_medium%3Demail%26utm_source%3Dgithub>.\n>\n>\n",
      "created_at" : "2021-09-24T05:17:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23076#issuecomment-926353681",
      "id" : 926353681,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23076",
      "node_id" : "IC_kwDOABII5843NwkR",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-24T05:17:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/926353681",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Is there any point in passing cfeerate by const reference vs just const\r\n\r\nAgree. A `CFeeRate` is basically a wrapper around a `CAmount`, so 8 bytes. Seems for constant use it's better to pass it by value, instead of adding a level of indirection by reference.",
      "created_at" : "2021-09-24T11:05:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23076#issuecomment-926539987",
      "id" : 926539987,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23076",
      "node_id" : "IC_kwDOABII5843OeDT",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-24T11:05:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/926539987",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yes a `CAmount` is 8 bytes, and https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rf-in suggests a threshold of 2-3 words, e.g. `2 * sizeof(void*)`.\r\n\r\nSo, I wondered why elsewhere than this patch `CFeeRate` params are passed by reference to const. For instance, in `feerate.h`, `fees.{h,cpp}`, `policy.{h,cpp}` and`txmempool.{h,cpp}` (granted, it could all be an oversight).\r\n\r\nI found more in-depth discussion in Scott Meyers' \"Effective C++, Third Edition\" (2005), Item 20, pages 86-94, and \"Effective Modern C++\" (2015), Item 41, pages 281-292. Maybe it is somewhat dated. Apologies if it is old or obvious info. Some excerpts:\r\n\r\n- Avoid passing objects of user-defined types by value.\r\n\r\n- One might conclude that all small types are good candidates for pass-by-value,\r\n  even if they're user-defined. However, just because an object is small doesn't\r\n  mean that calling its copy constructor is inexpensive.  Many objects--most STL\r\n  containers among them--contain little more than a pointer, but copying such\r\n  objects entails copying everything they point to. That can be very expensive.\r\n\r\n- Even when small objects have inexpensive copy constructors, there can be\r\n  performance issues. Some compilers treat built-in and user-defined types\r\n  differently, even if they have the same underlying representation. When that\r\n  type of thing happens, you can be better off passing such objects by\r\n  reference, because compilers will certainly put pointers (the implementation\r\n  of references) into registers.\r\n\r\n- Another reason why small user-defined types are not necessarily good\r\n  pass-by-value candidates is that, being user-defined, their size is subject to\r\n  change. A type that's small now may be bigger in the future if its internal\r\n  implementation changes.  Things can even change when switching to a different\r\n  C++ implementation.\r\n\r\n- In general, the only types for which you can reasonably assume that\r\n  pass-by-value is inexpensive are built-in types and STL iterator and function\r\n  object types. For everything else, prefer pass-by-reference-to-const over\r\n  pass-by-value.\r\n\r\n- Exception: possibly consider pass-by-value of user-defined types for copyable\r\n  parameters that are cheap to move, if they are always copied anyway in their\r\n  implementation.\r\n\r\n- When there are chains of function calls, each of which passes-by-value, the\r\n  cost for the entire chain of calls accumulates and may not be something you can\r\n  tolerate. With by-reference passing, chains of calls don't incur this kind of\r\n  accumulated overhead.\r\n\r\n- The most practical approach may be to adopt a \"guilty until proven innocent\"\r\n  policy for pass-by-value of user-defined types.\r\n",
      "created_at" : "2021-09-24T14:10:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23076#issuecomment-926656639",
      "id" : 926656639,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23076",
      "node_id" : "IC_kwDOABII5843O6h_",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-24T15:28:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/926656639",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It looks like there are 18 lines of `CFeeRate` params passed by reference to const, and 7 in this patch passed by value. If the 18 should be changed rather than these 7, it would remain a reasonably small change.",
      "created_at" : "2021-09-24T14:22:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23076#issuecomment-926666242",
      "id" : 926666242,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23076",
      "node_id" : "IC_kwDOABII5843O84C",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-24T14:22:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/926666242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#17786](https://github.com/bitcoin/bitcoin/pull/17786) (refactor: Nuke policy/fees->mempool circular dependencies by hebasto)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-09-25T15:29:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23076#issuecomment-927137187",
      "id" : 927137187,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23076",
      "node_id" : "IC_kwDOABII5843Qv2j",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-25T15:29:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/927137187",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
