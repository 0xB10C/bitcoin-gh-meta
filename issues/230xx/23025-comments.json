[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711589008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711589008"
         }
      },
      "author_association" : "MEMBER",
      "body" : "3154897f nit, s/influcence/influence/",
      "commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "created_at" : "2021-09-18T13:12:44Z",
      "diff_hunk" : "@@ -20,19 +20,17 @@ static void EvictionProtectionCommon(\n {\n     using Candidates = std::vector<NodeEvictionCandidate>;\n     FastRandomContext random_context{true};\n-    bench.warmup(100).epochIterations(1100);\n \n     Candidates candidates{GetRandomNodeEvictionCandidates(num_candidates, random_context)};\n     for (auto& c : candidates) {\n         candidate_setup_fn(c);\n     }\n \n-    std::vector<Candidates> copies{\n-        static_cast<size_t>(bench.epochs() * bench.epochIterations()), candidates};\n-    size_t i{0};\n+\n     bench.run([&] {\n-        ProtectEvictionCandidatesByRatio(copies.at(i));\n-        ++i;\n+        // creating a copy has an overhead of about 3%, so it does not influcence the benchmark results much.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711589008",
      "id" : 711589008,
      "line" : 31,
      "node_id" : "PRRC_kwDOABII584qafyQ",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 31,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/bench/peer_eviction.cpp",
      "position" : 18,
      "pull_request_review_id" : 758061464,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-18T14:07:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711589008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711589771"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711589771"
         }
      },
      "author_association" : "MEMBER",
      "body" : "c67f365 nit s/method modifies theobject/modifies the object/",
      "commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "created_at" : "2021-09-18T13:19:39Z",
      "diff_hunk" : "@@ -130,10 +115,20 @@ static void AddrManGood(benchmark::Bench& bench)\n         }\n     };\n \n-    uint64_t i = 0;\n+    // the benchmark is quite slow, so we reduce the number of epochs (measurements) for faster results.\n+    bench.epochs(5);\n+\n     bench.run([&] {\n-        markSomeAsGood(*addrmans.at(i));\n-        ++i;\n+        // To make the benchmark independent of the number of evaluations, we always prepare a new addrman.\n+        // This is necessary because CAddrMan::Good() method modifies theobject, affecting the timing of subsequent calls",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711589771",
      "id" : 711589771,
      "line" : 123,
      "node_id" : "PRRC_kwDOABII584qaf-L",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 123,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/bench/addrman.cpp",
      "position" : 34,
      "pull_request_review_id" : 758061464,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-18T14:07:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711589771",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711590355"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711590355"
         }
      },
      "author_association" : "MEMBER",
      "body" : "f167647\r\n```suggestion\r\nstatic constexpr int64_t DEFAULT_MIN_DURATION_MS{10};\r\n```",
      "commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "created_at" : "2021-09-18T13:25:41Z",
      "diff_hunk" : "@@ -4,21 +4,24 @@\n \n #include <bench/bench.h>\n \n+#include <clientversion.h>\n #include <crypto/sha256.h>\n #include <util/strencodings.h>\n #include <util/system.h>\n \n #include <memory>\n \n static const char* DEFAULT_BENCH_FILTER = \".*\";\n+static const int64_t DEFAULT_MIN_DURATION_MS = 10;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711590355",
      "id" : 711590355,
      "line" : 15,
      "node_id" : "PRRC_kwDOABII584qagHT",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 15,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/bench/bench_bitcoin.cpp",
      "position" : 12,
      "pull_request_review_id" : 758061464,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-18T14:07:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711590355",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711590975"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711590975"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fc2d44dd missing word\r\n```suggestion\r\n                     \"    results, use CPU pinning and CPU isolation (see [2]).\\n\"\r\n```",
      "commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "created_at" : "2021-09-18T13:31:19Z",
      "diff_hunk" : "@@ -48,17 +51,63 @@ int main(int argc, char** argv)\n     }\n \n     if (HelpRequested(argsman)) {\n-        std::cout << argsman.GetHelpMessage();\n+        std::cout << \"Usage:  bench_bitcoin [options]\\n\"\n+                     \"\\n\"\n+                     \"Description:\\n\"\n+                     \"\\n\"\n+                     \"  bench_bitcoin executes microbenchmarks. The quality of the benchmark results\\n\"\n+                     \"  highly depend on the stability of the machine. It can sometimes be very\\n\"\n+                     \"  difficult to get repeatable results, so here are a few tips to get stable\\n\"\n+                     \"  results:\\n\"\n+                     \"\\n\"\n+                     \"  * Use pyperf [1] to disable frequency scaling, turbo boost etc. For best\\n\"\n+                     \"    use CPU pinning and CPU isolation (see [2]).\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711590975",
      "id" : 711590975,
      "line" : 64,
      "node_id" : "PRRC_kwDOABII584qagQ_",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 64,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/bench/bench_bitcoin.cpp",
      "position" : 42,
      "pull_request_review_id" : 758061464,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-18T14:07:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711590975",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711591098"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711591098"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fc2d44d s/reliable increase/reliable, increase/ and s/seconds/seconds./",
      "commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "created_at" : "2021-09-18T13:32:53Z",
      "diff_hunk" : "@@ -48,17 +51,63 @@ int main(int argc, char** argv)\n     }\n \n     if (HelpRequested(argsman)) {\n-        std::cout << argsman.GetHelpMessage();\n+        std::cout << \"Usage:  bench_bitcoin [options]\\n\"\n+                     \"\\n\"\n+                     \"Description:\\n\"\n+                     \"\\n\"\n+                     \"  bench_bitcoin executes microbenchmarks. The quality of the benchmark results\\n\"\n+                     \"  highly depend on the stability of the machine. It can sometimes be very\\n\"\n+                     \"  difficult to get repeatable results, so here are a few tips to get stable\\n\"\n+                     \"  results:\\n\"\n+                     \"\\n\"\n+                     \"  * Use pyperf [1] to disable frequency scaling, turbo boost etc. For best\\n\"\n+                     \"    use CPU pinning and CPU isolation (see [2]).\\n\"\n+                     \"\\n\"\n+                     \"  * Each call of run() should do exactly the same work. E.g. inserting into\\n\"\n+                     \"    a std::vector doesn't do that as it will reallocate on certain calls. Make\\n\"\n+                     \"    sure each run has exactly the same preconditions.\\n\"\n+                     \"\\n\"\n+                     \"  * If results are still not reliable increase runtime with e.g.\\n\"\n+                     \"    -min_duration_ms=5000 to let a benchmark run for at least 5 seconds\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711591098",
      "id" : 711591098,
      "line" : 71,
      "node_id" : "PRRC_kwDOABII584qagS6",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 71,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/bench/bench_bitcoin.cpp",
      "position" : 49,
      "pull_request_review_id" : 758061464,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-18T14:07:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711591098",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711591578"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711591578"
         }
      },
      "author_association" : "MEMBER",
      "body" : "f167647 or 3e1a8ca maybe place this line after `bool is_list_only`, as it is a very lightweight data type in terms of packing",
      "commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "created_at" : "2021-09-18T13:37:04Z",
      "diff_hunk" : "@@ -41,11 +41,12 @@ using ankerl::nanobench::Bench;\n typedef std::function<void(Bench&)> BenchFunction;\n \n struct Args {\n-    std::string regex_filter;\n     bool is_list_only;\n     std::vector<double> asymptote;\n     std::string output_csv;\n     std::string output_json;\n+    std::string regex_filter;\n+    std::chrono::milliseconds min_duration;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711591578",
      "id" : 711591578,
      "line" : 49,
      "node_id" : "PRRC_kwDOABII584qagaa",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 49,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/bench/bench.h",
      "position" : 10,
      "pull_request_review_id" : 758061464,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-18T14:08:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711591578",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711592387"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711592387"
         }
      },
      "author_association" : "MEMBER",
      "body" : "354fbc0 Would it be a good idea to instead just make `data` a vector of uint8? There has been ongoing refactoring in the codebase to move from unsigned char to uint8. \r\n```diff\r\n-    std::vector<unsigned char> data(32);\r\n-    uint32_t count = 0;\r\n+    std::vector<uint8_t> data(32);\r\n+    uint8_t count = 0;\r\n```\r\n",
      "commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "created_at" : "2021-09-18T13:43:48Z",
      "diff_hunk" : "@@ -13,16 +13,16 @@ static void RollingBloom(benchmark::Bench& bench)\n     uint32_t count = 0;\n     bench.run([&] {\n         count++;\n-        data[0] = count;\n-        data[1] = count >> 8;\n-        data[2] = count >> 16;\n-        data[3] = count >> 24;\n+        data[0] = static_cast<unsigned char>(count);\n+        data[1] = static_cast<unsigned char>(count >> 8);\n+        data[2] = static_cast<unsigned char>(count >> 16);\n+        data[3] = static_cast<unsigned char>(count >> 24);\n         filter.insert(data);\n \n-        data[0] = count >> 24;\n-        data[1] = count >> 16;\n-        data[2] = count >> 8;\n-        data[3] = count;\n+        data[0] = static_cast<unsigned char>(count >> 24);\n+        data[1] = static_cast<unsigned char>(count >> 16);\n+        data[2] = static_cast<unsigned char>(count >> 8);\n+        data[3] = static_cast<unsigned char>(count);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711592387",
      "id" : 711592387,
      "line" : 25,
      "node_id" : "PRRC_kwDOABII584qagnD",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 25,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/bench/rollingbloom.cpp",
      "position" : 21,
      "pull_request_review_id" : 758061464,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-18T14:07:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711592387",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711593437"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711593437"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fc2d44dd suggestion\r\n\r\n\"It can sometimes be difficult to get stable, repeatable results, so here are a few tips:\"\r\n",
      "commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "created_at" : "2021-09-18T13:53:21Z",
      "diff_hunk" : "@@ -48,17 +51,63 @@ int main(int argc, char** argv)\n     }\n \n     if (HelpRequested(argsman)) {\n-        std::cout << argsman.GetHelpMessage();\n+        std::cout << \"Usage:  bench_bitcoin [options]\\n\"\n+                     \"\\n\"\n+                     \"Description:\\n\"\n+                     \"\\n\"\n+                     \"  bench_bitcoin executes microbenchmarks. The quality of the benchmark results\\n\"\n+                     \"  highly depend on the stability of the machine. It can sometimes be very\\n\"\n+                     \"  difficult to get repeatable results, so here are a few tips to get stable\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711593437",
      "id" : 711593437,
      "line" : 60,
      "node_id" : "PRRC_kwDOABII584qag3d",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 60,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/bench/bench_bitcoin.cpp",
      "position" : 38,
      "pull_request_review_id" : 758061464,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-18T14:07:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711593437",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711593618"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711593618"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fc2d44d I think it would be most helpful to begin with the Options, followed by the Description and Notes, as they go together.",
      "commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "created_at" : "2021-09-18T13:55:10Z",
      "diff_hunk" : "@@ -48,17 +51,63 @@ int main(int argc, char** argv)\n     }\n \n     if (HelpRequested(argsman)) {\n-        std::cout << argsman.GetHelpMessage();\n+        std::cout << \"Usage:  bench_bitcoin [options]\\n\"\n+                     \"\\n\"\n+                     \"Description:\\n\"\n+                     \"\\n\"\n+                     \"  bench_bitcoin executes microbenchmarks. The quality of the benchmark results\\n\"\n+                     \"  highly depend on the stability of the machine. It can sometimes be very\\n\"\n+                     \"  difficult to get repeatable results, so here are a few tips to get stable\\n\"\n+                     \"  results:\\n\"\n+                     \"\\n\"\n+                     \"  * Use pyperf [1] to disable frequency scaling, turbo boost etc. For best\\n\"\n+                     \"    use CPU pinning and CPU isolation (see [2]).\\n\"\n+                     \"\\n\"\n+                     \"  * Each call of run() should do exactly the same work. E.g. inserting into\\n\"\n+                     \"    a std::vector doesn't do that as it will reallocate on certain calls. Make\\n\"\n+                     \"    sure each run has exactly the same preconditions.\\n\"\n+                     \"\\n\"\n+                     \"  * If results are still not reliable increase runtime with e.g.\\n\"\n+                     \"    -min_duration_ms=5000 to let a benchmark run for at least 5 seconds\\n\"\n+                     \"\\n\"\n+                     \"  * bench_bitcoin uses nanobench [3] for which there is extensive\\n\"\n+                     \"    documentation available online.\\n\"\n+                     \"\\n\"\n+                     \"Environment Variables:\\n\"\n+                     \"\\n\"\n+                     \"  To attach a profiler you can run a benchmark in endless mode. This can be\\n\"\n+                     \"  done with the environment variable NANOBENCH_ENDLESS. E.g. like so:\\n\"\n+                     \"\\n\"\n+                     \"    NANOBENCH_ENDLESS=MuHash ./bench_bitcoin -filter=MuHash\\n\"\n+                     \"\\n\"\n+                     \"  In rare cases it can be useful to suppress stability warnings. This can be\\n\"\n+                     \"  done with the environment variable NANOBENCH_SUPPRESS_WARNINGS, e.g:\\n\"\n+                     \"\\n\"\n+                     \"    NANOBENCH_SUPPRESS_WARNINGS=1 ./bench_bitcoin\\n\"\n+                     \"\\n\"\n+                  << argsman.GetHelpMessage()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711593618",
      "id" : 711593618,
      "line" : 88,
      "node_id" : "PRRC_kwDOABII584qag6S",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 88,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "src/bench/bench_bitcoin.cpp",
      "position" : 66,
      "pull_request_review_id" : 758061464,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-18T14:07:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711593618",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711593977"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711593977"
         }
      },
      "author_association" : "MEMBER",
      "body" : "f167647c consider shortening the argument name to `-min_time` (faster and easier to type!)",
      "commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "created_at" : "2021-09-18T13:58:37Z",
      "diff_hunk" : "@@ -4,21 +4,24 @@\n \n #include <bench/bench.h>\n \n+#include <clientversion.h>\n #include <crypto/sha256.h>\n #include <util/strencodings.h>\n #include <util/system.h>\n \n #include <memory>\n \n static const char* DEFAULT_BENCH_FILTER = \".*\";\n+static const int64_t DEFAULT_MIN_DURATION_MS = 10;\n \n static void SetupBenchArgs(ArgsManager& argsman)\n {\n     SetupHelpOptions(argsman);\n \n-    argsman.AddArg(\"-asymptote=n1,n2,n3,...\", \"Test asymptotic growth of the runtime of an algorithm, if supported by the benchmark\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-asymptote=<n1,n2,n3,...>\", \"Test asymptotic growth of the runtime of an algorithm, if supported by the benchmark\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-filter=<regex>\", strprintf(\"Regular expression filter to select benchmark by name (default: %s)\", DEFAULT_BENCH_FILTER), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n-    argsman.AddArg(\"-list\", \"List benchmarks without executing them\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-list\", \"List benchmarks without executing them\", ArgsManager::ALLOW_BOOL, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-min_duration_ms=<milliseconds>\", strprintf(\"Minimum runtime per benchmark, in milliseconds (default: %d)\", DEFAULT_MIN_DURATION_MS), ArgsManager::ALLOW_INT, OptionsCategory::OPTIONS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711593977",
      "id" : 711593977,
      "line" : 24,
      "node_id" : "PRRC_kwDOABII584qag_5",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 24,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/bench/bench_bitcoin.cpp",
      "position" : 23,
      "pull_request_review_id" : 758061464,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-18T14:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711593977",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711598161"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711598161"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Looking at https://en.cppreference.com/w/cpp/chrono/duration/duration_cast, would something like this be a good idea?\r\n\r\n```cpp\r\n// converting integral duration to integral duration of shorter divisible time unit:\r\n    // no duration_cast needed\r\n    std::chrono::duration<long, std::micro> int_usec = int_ms;\r\n```\r\n\r\nalso line 62, can shorten if preferred\r\n```diff\r\n-        if (args.min_duration > std::chrono::milliseconds::zero()) {\r\n+        if (args.min_duration > 0ms) {\r\n```\r\n\r\nalso, where `std::chrono` is added, look at include headers for `<chrono>` where needed",
      "commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "created_at" : "2021-09-18T14:32:52Z",
      "diff_hunk" : "@@ -61,6 +59,11 @@ void benchmark::BenchRunner::RunAll(const Args& args)\n \n         Bench bench;\n         bench.name(p.first);\n+        if (args.min_duration > std::chrono::milliseconds::zero()) {\n+            // convert to nanos before dividing to reduce rounding errors\n+            bench.minEpochTime(std::chrono::nanoseconds(args.min_duration) / bench.epochs());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711598161",
      "id" : 711598161,
      "line" : 64,
      "node_id" : "PRRC_kwDOABII584qaiBR",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 64,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/bench/bench.cpp",
      "position" : 16,
      "pull_request_review_id" : 758066738,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-18T14:32:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711598161",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711625919"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711625919"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Another alternative would be to add this Description and Notes documentation to `doc/benchmarking.md`.",
      "commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "created_at" : "2021-09-18T18:41:09Z",
      "diff_hunk" : "@@ -48,17 +51,63 @@ int main(int argc, char** argv)\n     }\n \n     if (HelpRequested(argsman)) {\n-        std::cout << argsman.GetHelpMessage();\n+        std::cout << \"Usage:  bench_bitcoin [options]\\n\"\n+                     \"\\n\"\n+                     \"Description:\\n\"\n+                     \"\\n\"\n+                     \"  bench_bitcoin executes microbenchmarks. The quality of the benchmark results\\n\"\n+                     \"  highly depend on the stability of the machine. It can sometimes be very\\n\"\n+                     \"  difficult to get repeatable results, so here are a few tips to get stable\\n\"\n+                     \"  results:\\n\"\n+                     \"\\n\"\n+                     \"  * Use pyperf [1] to disable frequency scaling, turbo boost etc. For best\\n\"\n+                     \"    use CPU pinning and CPU isolation (see [2]).\\n\"\n+                     \"\\n\"\n+                     \"  * Each call of run() should do exactly the same work. E.g. inserting into\\n\"\n+                     \"    a std::vector doesn't do that as it will reallocate on certain calls. Make\\n\"\n+                     \"    sure each run has exactly the same preconditions.\\n\"\n+                     \"\\n\"\n+                     \"  * If results are still not reliable increase runtime with e.g.\\n\"\n+                     \"    -min_duration_ms=5000 to let a benchmark run for at least 5 seconds\\n\"\n+                     \"\\n\"\n+                     \"  * bench_bitcoin uses nanobench [3] for which there is extensive\\n\"\n+                     \"    documentation available online.\\n\"\n+                     \"\\n\"\n+                     \"Environment Variables:\\n\"\n+                     \"\\n\"\n+                     \"  To attach a profiler you can run a benchmark in endless mode. This can be\\n\"\n+                     \"  done with the environment variable NANOBENCH_ENDLESS. E.g. like so:\\n\"\n+                     \"\\n\"\n+                     \"    NANOBENCH_ENDLESS=MuHash ./bench_bitcoin -filter=MuHash\\n\"\n+                     \"\\n\"\n+                     \"  In rare cases it can be useful to suppress stability warnings. This can be\\n\"\n+                     \"  done with the environment variable NANOBENCH_SUPPRESS_WARNINGS, e.g:\\n\"\n+                     \"\\n\"\n+                     \"    NANOBENCH_SUPPRESS_WARNINGS=1 ./bench_bitcoin\\n\"\n+                     \"\\n\"\n+                  << argsman.GetHelpMessage()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711625919",
      "id" : 711625919,
      "in_reply_to_id" : 711593618,
      "line" : 88,
      "node_id" : "PRRC_kwDOABII584qaoy_",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 88,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "src/bench/bench_bitcoin.cpp",
      "position" : 66,
      "pull_request_review_id" : 758083696,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-18T18:41:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711625919",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#22950](https://github.com/bitcoin/bitcoin/pull/22950) ([p2p] Pimpl AddrMan to abstract implementation details by amitiuttarwar)\n* [#22910](https://github.com/bitcoin/bitcoin/pull/22910) ([RFC] Encapsulate asmap in NetGroupManager by jnewbery)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-09-19T02:50:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#issuecomment-922406734",
      "id" : 922406734,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23025",
      "node_id" : "IC_kwDOABII5842-s9O",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-19T02:50:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/922406734",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711724830"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711724830"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed in eb399ab0577dffe7e1080bb497ff642de1c8c359",
      "commit_id" : "b901174bfb6895c8e332c2b5e280348836398e68",
      "created_at" : "2021-09-19T10:52:48Z",
      "diff_hunk" : "@@ -20,19 +20,17 @@ static void EvictionProtectionCommon(\n {\n     using Candidates = std::vector<NodeEvictionCandidate>;\n     FastRandomContext random_context{true};\n-    bench.warmup(100).epochIterations(1100);\n \n     Candidates candidates{GetRandomNodeEvictionCandidates(num_candidates, random_context)};\n     for (auto& c : candidates) {\n         candidate_setup_fn(c);\n     }\n \n-    std::vector<Candidates> copies{\n-        static_cast<size_t>(bench.epochs() * bench.epochIterations()), candidates};\n-    size_t i{0};\n+\n     bench.run([&] {\n-        ProtectEvictionCandidatesByRatio(copies.at(i));\n-        ++i;\n+        // creating a copy has an overhead of about 3%, so it does not influcence the benchmark results much.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711724830",
      "id" : 711724830,
      "in_reply_to_id" : 711589008,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qbA8e",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 31,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/bench/peer_eviction.cpp",
      "position" : null,
      "pull_request_review_id" : 758136372,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-19T10:52:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711724830",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711724965"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711724965"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed in 652faa16a1410b51a5ad78a3121cf6ab9329f640",
      "commit_id" : "b901174bfb6895c8e332c2b5e280348836398e68",
      "created_at" : "2021-09-19T10:53:41Z",
      "diff_hunk" : "@@ -130,10 +115,20 @@ static void AddrManGood(benchmark::Bench& bench)\n         }\n     };\n \n-    uint64_t i = 0;\n+    // the benchmark is quite slow, so we reduce the number of epochs (measurements) for faster results.\n+    bench.epochs(5);\n+\n     bench.run([&] {\n-        markSomeAsGood(*addrmans.at(i));\n-        ++i;\n+        // To make the benchmark independent of the number of evaluations, we always prepare a new addrman.\n+        // This is necessary because CAddrMan::Good() method modifies theobject, affecting the timing of subsequent calls",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711724965",
      "id" : 711724965,
      "in_reply_to_id" : 711589771,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qbA-l",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 123,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/bench/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 758136431,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-19T10:53:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711724965",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711725015"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711725015"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed in b8f16c323e02c3d06e5ad57b6c0f96196d9b12e0",
      "commit_id" : "b901174bfb6895c8e332c2b5e280348836398e68",
      "created_at" : "2021-09-19T10:54:20Z",
      "diff_hunk" : "@@ -4,21 +4,24 @@\n \n #include <bench/bench.h>\n \n+#include <clientversion.h>\n #include <crypto/sha256.h>\n #include <util/strencodings.h>\n #include <util/system.h>\n \n #include <memory>\n \n static const char* DEFAULT_BENCH_FILTER = \".*\";\n+static const int64_t DEFAULT_MIN_DURATION_MS = 10;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711725015",
      "id" : 711725015,
      "in_reply_to_id" : 711590355,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qbA_X",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 15,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/bench/bench_bitcoin.cpp",
      "position" : null,
      "pull_request_review_id" : 758136477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-19T10:54:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711725015",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711725089"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711725089"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "wordings fixed in 57a7a020a87f13c231b44ad1861b0bb6e6f92e70",
      "commit_id" : "b901174bfb6895c8e332c2b5e280348836398e68",
      "created_at" : "2021-09-19T10:55:01Z",
      "diff_hunk" : "@@ -48,17 +51,63 @@ int main(int argc, char** argv)\n     }\n \n     if (HelpRequested(argsman)) {\n-        std::cout << argsman.GetHelpMessage();\n+        std::cout << \"Usage:  bench_bitcoin [options]\\n\"\n+                     \"\\n\"\n+                     \"Description:\\n\"\n+                     \"\\n\"\n+                     \"  bench_bitcoin executes microbenchmarks. The quality of the benchmark results\\n\"\n+                     \"  highly depend on the stability of the machine. It can sometimes be very\\n\"\n+                     \"  difficult to get repeatable results, so here are a few tips to get stable\\n\"\n+                     \"  results:\\n\"\n+                     \"\\n\"\n+                     \"  * Use pyperf [1] to disable frequency scaling, turbo boost etc. For best\\n\"\n+                     \"    use CPU pinning and CPU isolation (see [2]).\\n\"\n+                     \"\\n\"\n+                     \"  * Each call of run() should do exactly the same work. E.g. inserting into\\n\"\n+                     \"    a std::vector doesn't do that as it will reallocate on certain calls. Make\\n\"\n+                     \"    sure each run has exactly the same preconditions.\\n\"\n+                     \"\\n\"\n+                     \"  * If results are still not reliable increase runtime with e.g.\\n\"\n+                     \"    -min_duration_ms=5000 to let a benchmark run for at least 5 seconds\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711725089",
      "id" : 711725089,
      "in_reply_to_id" : 711591098,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qbBAh",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 71,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/bench/bench_bitcoin.cpp",
      "position" : null,
      "pull_request_review_id" : 758136530,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-19T10:55:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711725089",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711725143"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711725143"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done!",
      "commit_id" : "b901174bfb6895c8e332c2b5e280348836398e68",
      "created_at" : "2021-09-19T10:55:12Z",
      "diff_hunk" : "@@ -41,11 +41,12 @@ using ankerl::nanobench::Bench;\n typedef std::function<void(Bench&)> BenchFunction;\n \n struct Args {\n-    std::string regex_filter;\n     bool is_list_only;\n     std::vector<double> asymptote;\n     std::string output_csv;\n     std::string output_json;\n+    std::string regex_filter;\n+    std::chrono::milliseconds min_duration;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711725143",
      "id" : 711725143,
      "in_reply_to_id" : 711591578,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qbBBX",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 49,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/bench/bench.h",
      "position" : null,
      "pull_request_review_id" : 758136547,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-19T10:55:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711725143",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711725279"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711725279"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I can't easily change that because the RollingBloomHash's API uses that and I don't want the change to be too large. I've changed this though to use `& 0xFF` like it's done in many other places in the code. Done in b901174bfb6895c8e332c2b5e280348836398e68",
      "commit_id" : "b901174bfb6895c8e332c2b5e280348836398e68",
      "created_at" : "2021-09-19T10:56:17Z",
      "diff_hunk" : "@@ -13,16 +13,16 @@ static void RollingBloom(benchmark::Bench& bench)\n     uint32_t count = 0;\n     bench.run([&] {\n         count++;\n-        data[0] = count;\n-        data[1] = count >> 8;\n-        data[2] = count >> 16;\n-        data[3] = count >> 24;\n+        data[0] = static_cast<unsigned char>(count);\n+        data[1] = static_cast<unsigned char>(count >> 8);\n+        data[2] = static_cast<unsigned char>(count >> 16);\n+        data[3] = static_cast<unsigned char>(count >> 24);\n         filter.insert(data);\n \n-        data[0] = count >> 24;\n-        data[1] = count >> 16;\n-        data[2] = count >> 8;\n-        data[3] = count;\n+        data[0] = static_cast<unsigned char>(count >> 24);\n+        data[1] = static_cast<unsigned char>(count >> 16);\n+        data[2] = static_cast<unsigned char>(count >> 8);\n+        data[3] = static_cast<unsigned char>(count);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711725279",
      "id" : 711725279,
      "in_reply_to_id" : 711592387,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qbBDf",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 25,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/bench/rollingbloom.cpp",
      "position" : null,
      "pull_request_review_id" : 758136644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-19T10:56:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711725279",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711725337"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711725337"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done in b8f16c323e02c3d06e5ad57b6c0f96196d9b12e0",
      "commit_id" : "b901174bfb6895c8e332c2b5e280348836398e68",
      "created_at" : "2021-09-19T10:56:52Z",
      "diff_hunk" : "@@ -4,21 +4,24 @@\n \n #include <bench/bench.h>\n \n+#include <clientversion.h>\n #include <crypto/sha256.h>\n #include <util/strencodings.h>\n #include <util/system.h>\n \n #include <memory>\n \n static const char* DEFAULT_BENCH_FILTER = \".*\";\n+static const int64_t DEFAULT_MIN_DURATION_MS = 10;\n \n static void SetupBenchArgs(ArgsManager& argsman)\n {\n     SetupHelpOptions(argsman);\n \n-    argsman.AddArg(\"-asymptote=n1,n2,n3,...\", \"Test asymptotic growth of the runtime of an algorithm, if supported by the benchmark\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-asymptote=<n1,n2,n3,...>\", \"Test asymptotic growth of the runtime of an algorithm, if supported by the benchmark\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-filter=<regex>\", strprintf(\"Regular expression filter to select benchmark by name (default: %s)\", DEFAULT_BENCH_FILTER), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n-    argsman.AddArg(\"-list\", \"List benchmarks without executing them\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-list\", \"List benchmarks without executing them\", ArgsManager::ALLOW_BOOL, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-min_duration_ms=<milliseconds>\", strprintf(\"Minimum runtime per benchmark, in milliseconds (default: %d)\", DEFAULT_MIN_DURATION_MS), ArgsManager::ALLOW_INT, OptionsCategory::OPTIONS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711725337",
      "id" : 711725337,
      "in_reply_to_id" : 711593977,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qbBEZ",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 24,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/bench/bench_bitcoin.cpp",
      "position" : null,
      "pull_request_review_id" : 758136691,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-19T10:56:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711725337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711725386"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711725386"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "changed in 57a7a020a87f13c231b44ad1861b0bb6e6f92e70",
      "commit_id" : "b901174bfb6895c8e332c2b5e280348836398e68",
      "created_at" : "2021-09-19T10:57:15Z",
      "diff_hunk" : "@@ -48,17 +51,63 @@ int main(int argc, char** argv)\n     }\n \n     if (HelpRequested(argsman)) {\n-        std::cout << argsman.GetHelpMessage();\n+        std::cout << \"Usage:  bench_bitcoin [options]\\n\"\n+                     \"\\n\"\n+                     \"Description:\\n\"\n+                     \"\\n\"\n+                     \"  bench_bitcoin executes microbenchmarks. The quality of the benchmark results\\n\"\n+                     \"  highly depend on the stability of the machine. It can sometimes be very\\n\"\n+                     \"  difficult to get repeatable results, so here are a few tips to get stable\\n\"\n+                     \"  results:\\n\"\n+                     \"\\n\"\n+                     \"  * Use pyperf [1] to disable frequency scaling, turbo boost etc. For best\\n\"\n+                     \"    use CPU pinning and CPU isolation (see [2]).\\n\"\n+                     \"\\n\"\n+                     \"  * Each call of run() should do exactly the same work. E.g. inserting into\\n\"\n+                     \"    a std::vector doesn't do that as it will reallocate on certain calls. Make\\n\"\n+                     \"    sure each run has exactly the same preconditions.\\n\"\n+                     \"\\n\"\n+                     \"  * If results are still not reliable increase runtime with e.g.\\n\"\n+                     \"    -min_duration_ms=5000 to let a benchmark run for at least 5 seconds\\n\"\n+                     \"\\n\"\n+                     \"  * bench_bitcoin uses nanobench [3] for which there is extensive\\n\"\n+                     \"    documentation available online.\\n\"\n+                     \"\\n\"\n+                     \"Environment Variables:\\n\"\n+                     \"\\n\"\n+                     \"  To attach a profiler you can run a benchmark in endless mode. This can be\\n\"\n+                     \"  done with the environment variable NANOBENCH_ENDLESS. E.g. like so:\\n\"\n+                     \"\\n\"\n+                     \"    NANOBENCH_ENDLESS=MuHash ./bench_bitcoin -filter=MuHash\\n\"\n+                     \"\\n\"\n+                     \"  In rare cases it can be useful to suppress stability warnings. This can be\\n\"\n+                     \"  done with the environment variable NANOBENCH_SUPPRESS_WARNINGS, e.g:\\n\"\n+                     \"\\n\"\n+                     \"    NANOBENCH_SUPPRESS_WARNINGS=1 ./bench_bitcoin\\n\"\n+                     \"\\n\"\n+                  << argsman.GetHelpMessage()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711725386",
      "id" : 711725386,
      "in_reply_to_id" : 711593618,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qbBFK",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 88,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "src/bench/bench_bitcoin.cpp",
      "position" : null,
      "pull_request_review_id" : 758136729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-19T10:57:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711725386",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711725752"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711725752"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "hm, I think it's fine to use `std::chrono::nanoseconds`, it's basically the same but with `int64_t`. It should be large so there's no easy chance for overflow. I generally try to not use `duration_cast`, because that's a sign that at that place there will be some loss of information due to the casting.\r\n\r\nI've changed  line 64 to 0ms in b8f16c323e02c3d06e5ad57b6c0f96196d9b12e0",
      "commit_id" : "b901174bfb6895c8e332c2b5e280348836398e68",
      "created_at" : "2021-09-19T10:59:55Z",
      "diff_hunk" : "@@ -61,6 +59,11 @@ void benchmark::BenchRunner::RunAll(const Args& args)\n \n         Bench bench;\n         bench.name(p.first);\n+        if (args.min_duration > std::chrono::milliseconds::zero()) {\n+            // convert to nanos before dividing to reduce rounding errors\n+            bench.minEpochTime(std::chrono::nanoseconds(args.min_duration) / bench.epochs());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711725752",
      "id" : 711725752,
      "in_reply_to_id" : 711598161,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qbBK4",
      "original_commit_id" : "354fbc002275364fefc67fff7447e77fc44dbae1",
      "original_line" : 64,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/bench/bench.cpp",
      "position" : null,
      "pull_request_review_id" : 758136930,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-19T10:59:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711725752",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the reviews! I've incorporated all the suggestions into the right commits and rebased everything.",
      "created_at" : "2021-09-19T11:00:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#issuecomment-922454698",
      "id" : 922454698,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23025",
      "node_id" : "IC_kwDOABII5842-4qq",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-19T11:00:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/922454698",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711761445"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711761445"
         }
      },
      "author_association" : "MEMBER",
      "body" : "57a7a02\r\n```suggestion\r\n                     \"    -min_time=5000 to let a benchmark run for at least 5 seconds.\\n\"\r\n```",
      "commit_id" : "b901174bfb6895c8e332c2b5e280348836398e68",
      "created_at" : "2021-09-19T15:26:19Z",
      "diff_hunk" : "@@ -48,17 +51,62 @@ int main(int argc, char** argv)\n     }\n \n     if (HelpRequested(argsman)) {\n-        std::cout << argsman.GetHelpMessage();\n+        std::cout << \"Usage:  bench_bitcoin [options]\\n\"\n+                     \"\\n\"\n+                  << argsman.GetHelpMessage()\n+                  << \"Description:\\n\"\n+                     \"\\n\"\n+                     \"  bench_bitcoin executes microbenchmarks. The quality of the benchmark results\\n\"\n+                     \"  highly depend on the stability of the machine. It can sometimes be difficult\\n\"\n+                     \"  to get stable, repeatable results, so here are a few tips:\\n\"\n+                     \"\\n\"\n+                     \"  * Use pyperf [1] to disable frequency scaling, turbo boost etc. For best\\n\"\n+                     \"    results, use CPU pinning and CPU isolation (see [2]).\\n\"\n+                     \"\\n\"\n+                     \"  * Each call of run() should do exactly the same work. E.g. inserting into\\n\"\n+                     \"    a std::vector doesn't do that as it will reallocate on certain calls. Make\\n\"\n+                     \"    sure each run has exactly the same preconditions.\\n\"\n+                     \"\\n\"\n+                     \"  * If results are still not reliable, increase runtime with e.g.\\n\"\n+                     \"    -min_duration_ms=5000 to let a benchmark run for at least 5 seconds.\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711761445",
      "id" : 711761445,
      "line" : 71,
      "node_id" : "PRRC_kwDOABII584qbJ4l",
      "original_commit_id" : "b901174bfb6895c8e332c2b5e280348836398e68",
      "original_line" : 71,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/bench/bench_bitcoin.cpp",
      "position" : 49,
      "pull_request_review_id" : 758160902,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-19T15:52:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711761445",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711763464"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711763464"
         }
      },
      "author_association" : "MEMBER",
      "body" : "b8f16c3\r\n\r\n- per `doc/developer-notes.md`, it looks like `#include <chrono>` should be added to bench.cpp and bench_bitcoin.cpp:\r\n```\r\n- Every `.cpp` and `.h` file should `#include` every header file it directly uses classes, functions or other\r\n  definitions from, even if those headers are already included indirectly through other headers.\r\n\r\n  - *Rationale*: Excluding headers because they are already indirectly included results in compilation\r\n    failures when those indirect dependencies change. Furthermore, it obscures what the real code\r\n    dependencies are.\r\n```\r\n\r\n- pico-nit, feel free to ignore\r\n```suggestion\r\n            const std::chrono::nanoseconds min_time_ns{args.min_time};\r\n```",
      "commit_id" : "b901174bfb6895c8e332c2b5e280348836398e68",
      "created_at" : "2021-09-19T15:40:39Z",
      "diff_hunk" : "@@ -61,6 +59,12 @@ void benchmark::BenchRunner::RunAll(const Args& args)\n \n         Bench bench;\n         bench.name(p.first);\n+        if (args.min_time > 0ms) {\n+            // convert to nanos before dividing to reduce rounding errors\n+            std::chrono::nanoseconds min_time_ns = args.min_time;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711763464",
      "id" : 711763464,
      "line" : 64,
      "node_id" : "PRRC_kwDOABII584qbKYI",
      "original_commit_id" : "b901174bfb6895c8e332c2b5e280348836398e68",
      "original_line" : 64,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/bench/bench.cpp",
      "position" : 16,
      "pull_request_review_id" : 758160902,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-19T15:52:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711763464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711777746"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711777746"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "hm, that include guideline is a bit hard to follow. There are lots of other missing includes, e.g. `bench_bitcoin.cpp` would need at least chrono, cstdint, vector, sstream, string, iostream. Should I add these as well?\r\n\r\nAbout the constructor, I think that is one of the cases where assignment is better: chrono's assignment is more strict than the constructor, you can't do e.g. `std::chrono::nanoseconds x = 123` but you can do `std::chrono::nanoseconds x{123}`. So with the assignment it's certain that `args.min_time` is actually another chrono type that convertible without loss of information, and not just any number that could represent anything.",
      "commit_id" : "b901174bfb6895c8e332c2b5e280348836398e68",
      "created_at" : "2021-09-19T17:37:19Z",
      "diff_hunk" : "@@ -61,6 +59,12 @@ void benchmark::BenchRunner::RunAll(const Args& args)\n \n         Bench bench;\n         bench.name(p.first);\n+        if (args.min_time > 0ms) {\n+            // convert to nanos before dividing to reduce rounding errors\n+            std::chrono::nanoseconds min_time_ns = args.min_time;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23025#discussion_r711777746",
      "id" : 711777746,
      "in_reply_to_id" : 711763464,
      "line" : 64,
      "node_id" : "PRRC_kwDOABII584qbN3S",
      "original_commit_id" : "b901174bfb6895c8e332c2b5e280348836398e68",
      "original_line" : 64,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/bench/bench.cpp",
      "position" : 16,
      "pull_request_review_id" : 758171233,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23025",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-19T17:37:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711777746",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   }
]
