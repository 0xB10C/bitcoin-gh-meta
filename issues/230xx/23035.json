{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "Based on #22831, this pull implements the suggestion in https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-920199755 to extend RPC getnodeaddresses to return whether the address is in the tried or new table, and if it's in the new table, its refcount. This allows us to better test the contents of the addrman using a public interface instead of relying on assert_debug_log in the functional tests.\r\n\r\nThe fInTried and nRefCount data members we want to make available are private members of CAddrInfo. Two ways to expose them are (1) move them from CAddrInfo to CAddress or (2) use CAddrInfo instead of CAddress for the GetAddr_(), GetAddr() and GetAddresses() functions and callers.  The first way is a much smaller diff and proposed here.  The second way is implemented in https://github.com/jonatack/bitcoin/commit/74c91f6d88faa86326c64e76a32e51254a04bd39 to compare.\r\n\r\nThis pull then updates the getnodeaddresses and addpeeraddress test coverage, followed by improving the relevant asmap test coverage.\r\n\r\nCredit to John Newbery for the idea.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 2,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23035/comments",
   "created_at" : "2021-09-19T14:39:15Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23035/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/23035",
   "id" : 1000331298,
   "labels" : [
      {
         "color" : "0052cc",
         "default" : false,
         "description" : null,
         "id" : 98279177,
         "name" : "RPC/REST/ZMQ",
         "node_id" : "MDU6TGFiZWw5ODI3OTE3Nw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ"
      },
      {
         "color" : "006b75",
         "default" : false,
         "description" : null,
         "id" : 98298007,
         "name" : "P2P",
         "node_id" : "MDU6TGFiZWw5ODI5ODAwNw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23035/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII584r7wyW",
   "number" : 23035,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/23035.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23035",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/23035.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23035"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "p2p, rpc, test: expose tried and refcount in getnodeaddresses, update/improve tests",
   "updated_at" : "2021-09-19T15:56:54Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23035",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
      "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
      "followers_url" : "https://api.github.com/users/jonatack/followers",
      "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/jonatack",
      "id" : 2415484,
      "login" : "jonatack",
      "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
      "organizations_url" : "https://api.github.com/users/jonatack/orgs",
      "received_events_url" : "https://api.github.com/users/jonatack/received_events",
      "repos_url" : "https://api.github.com/users/jonatack/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/jonatack"
   }
}
