[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [theuni](https://github.com/bitcoin/bitcoin/pull/28048#issuecomment-1625907483), [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/28048#issuecomment-1626127733), [hebasto](https://github.com/bitcoin/bitcoin/pull/28048#issuecomment-1626275707), [stickies-v](https://github.com/bitcoin/bitcoin/pull/28048#pullrequestreview-1521747346) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28052](https://github.com/bitcoin/bitcoin/pull/28052) (blockstorage: XOR blocksdir *.dat files by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-07-07T17:03:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#issuecomment-1625697201",
      "id" : 1625697201,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28048",
      "node_id" : "IC_kwDOABII585g5iux",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1625697201/reactions"
      },
      "updated_at" : "2023-07-10T20:18:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1625697201",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated 828af9ad19a702e711963f9b498f7462bde8aabb -> c2bcc339d7b8def58289d3ff01b2a905dc291ed6 ([`pr/stopafter.1`](https://github.com/ryanofsky/bitcoin/commits/pr/stopafter.1) -> [`pr/stopafter.2`](https://github.com/ryanofsky/bitcoin/commits/pr/stopafter.2), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/stopafter.1..pr/stopafter.2)) just updating comments and adding release note about `-stopatheight` behavior",
      "created_at" : "2023-07-07T18:07:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#issuecomment-1625782988",
      "id" : 1625782988,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28048",
      "node_id" : "IC_kwDOABII585g53rM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1625782988/reactions"
      },
      "updated_at" : "2023-07-07T18:07:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1625782988",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Very nice. Concept ACK and quick (very shallow) codereview ACK.\r\n\r\nI think the `-stopatheight` change is reasonable. If it turns out anyone/anything was relying on the way this worked before, we could always add functionality for that use-case (maybe `-stopatblock`?)\r\n\r\nHowever, the help string should be updated from:\r\n\r\n> Stop running after reaching the given height in the main chain\r\n\r\nIt sounds like it's not completely accurate now, and less so after this change :)",
      "created_at" : "2023-07-07T19:01:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#issuecomment-1625907483",
      "id" : 1625907483,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28048",
      "node_id" : "IC_kwDOABII585g6WEb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1625907483/reactions"
      },
      "updated_at" : "2023-07-07T19:01:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1625907483",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1256350258"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1256350258"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is it possible for this to be called twice?\r\n```c++\r\nif (m_stop_at_height) {\r\n  if (index.nHeight > m_stop_at_height) {\r\n    // assert(false) or return kernel::Interrupted{} ?\r\n  } else if (index.nHeight == m_stop_at_height) {\r\n  ..\r\n  }\r\n}\r\n```\r\n\r\nNot that I imagine calling `StartShutdown()` twice would be particularly harmful anyway.",
      "commit_id" : "c2bcc339d7b8def58289d3ff01b2a905dc291ed6",
      "created_at" : "2023-07-07T19:24:18Z",
      "diff_hunk" : "@@ -57,9 +58,23 @@ static void DoWarning(const bilingual_str& warning)\n \n namespace node {\n \n-void KernelNotifications::blockTip(SynchronizationState state, CBlockIndex& index)\n+kernel::InterruptResult KernelNotifications::blocksImported()\n+{\n+    if (m_stop_after_block_import) {\n+        StartShutdown();\n+        return kernel::Interrupted{};\n+    }\n+    return {};\n+}\n+\n+kernel::InterruptResult KernelNotifications::blockTip(SynchronizationState state, CBlockIndex& index)\n {\n     uiInterface.NotifyBlockTip(state, &index);\n+    if (m_stop_at_height && index.nHeight >= m_stop_at_height) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1256350258",
      "id" : 1256350258,
      "line" : 73,
      "node_id" : "PRRC_kwDOABII585K4mIy",
      "original_commit_id" : "c2bcc339d7b8def58289d3ff01b2a905dc291ed6",
      "original_line" : 73,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/node/kernel_notifications.cpp",
      "position" : 25,
      "pull_request_review_id" : 1519644020,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1256350258/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-07T19:24:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1256350258",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1256406548"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1256406548"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1256350258\r\n\r\nI don't think StartShutdown() can be called twice, but it should be ok if that did happen, like you say.\r\n\r\nChecking `index.nHeight > m_stop_at_height` wouldn't be a good way to detect two shutdown calls, though, because that condition can also happen if they the node is restarted with a lower `-stopatheight` value (because the implementation only stops when new blocks are added, and doesn't make any attempt to rewind)",
      "commit_id" : "09938a41d904c05b4676b064da9baa85e53e3e6f",
      "created_at" : "2023-07-07T20:09:08Z",
      "diff_hunk" : "@@ -57,9 +58,23 @@ static void DoWarning(const bilingual_str& warning)\n \n namespace node {\n \n-void KernelNotifications::blockTip(SynchronizationState state, CBlockIndex& index)\n+kernel::InterruptResult KernelNotifications::blocksImported()\n+{\n+    if (m_stop_after_block_import) {\n+        StartShutdown();\n+        return kernel::Interrupted{};\n+    }\n+    return {};\n+}\n+\n+kernel::InterruptResult KernelNotifications::blockTip(SynchronizationState state, CBlockIndex& index)\n {\n     uiInterface.NotifyBlockTip(state, &index);\n+    if (m_stop_at_height && index.nHeight >= m_stop_at_height) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1256406548",
      "id" : 1256406548,
      "in_reply_to_id" : 1256350258,
      "line" : 73,
      "node_id" : "PRRC_kwDOABII585K4z4U",
      "original_commit_id" : "c2bcc339d7b8def58289d3ff01b2a905dc291ed6",
      "original_line" : 73,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/node/kernel_notifications.cpp",
      "position" : 25,
      "pull_request_review_id" : 1519716758,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1256406548/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-07T21:48:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1256406548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Strong Concept ACK :)\r\n\r\nI'm glad you changed your mind on returning things from the notifications, putting the infrastructure in place to allow the code to now bubble a `-stopatheight` interrupt is a clear advantage to me.\r\n\r\nI was about to open a similar PR, albeit with a different approach for handling `-stopafterblockimport` ([patch](https://github.com/TheCharlatan/bitcoin/commit/1107a234838d7a3999dbf236c8a7e4e00d48f289)). Instead of creating a new notification for it, I thought slightly refactoring the function to instead return when the block import is done and then allow the user of the kernel (in this case the init code) to decide what to do is easier to reason with. This has the added benefit that users of the kernel can now just call `BlockImport` without having to rely on options and notification handlers to skip loading the mempool. Can you comment on this approach?\r\n\r\n",
      "created_at" : "2023-07-07T21:12:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#issuecomment-1626127733",
      "id" : 1626127733,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28048",
      "node_id" : "IC_kwDOABII585g7L11",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1626127733/reactions"
      },
      "updated_at" : "2023-07-07T21:13:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1626127733",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.",
      "created_at" : "2023-07-07T22:15:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#issuecomment-1626275707",
      "id" : 1626275707,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28048",
      "node_id" : "IC_kwDOABII585g7v97",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1626275707/reactions"
      },
      "updated_at" : "2023-07-07T22:15:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1626275707",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Re https://github.com/bitcoin/bitcoin/pull/28048#pullrequestreview-1520042712\r\n> Maybe the simplest path to not conflict much could be to provide ThreadImport with a \"return_after_import\" bool arg (true when -stopafterblockimport is set)\r\n\r\nThanks @furszy, opened https://github.com/bitcoin/bitcoin/pull/28053.",
      "created_at" : "2023-07-08T11:24:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#issuecomment-1627142023",
      "id" : 1627142023,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28048",
      "node_id" : "IC_kwDOABII585g_DeH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1627142023/reactions"
      },
      "updated_at" : "2023-07-08T11:24:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1627142023",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1258032967"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1258032967"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit\r\n```suggestion\r\n//! Result type for use with std::variant to indicate that an operation should be interrupted.\r\n```",
      "commit_id" : "09938a41d904c05b4676b064da9baa85e53e3e6f",
      "created_at" : "2023-07-10T10:17:40Z",
      "diff_hunk" : "@@ -9,12 +9,25 @@\n \n #include <cstdint>\n #include <string>\n+#include <variant>\n \n class CBlockIndex;\n enum class SynchronizationState;\n \n namespace kernel {\n \n+//! Result type for use with std::variant to indiciate that an operation should be interrupted.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1258032967",
      "id" : 1258032967,
      "line" : 19,
      "node_id" : "PRRC_kwDOABII585K_A9H",
      "original_commit_id" : "09938a41d904c05b4676b064da9baa85e53e3e6f",
      "original_line" : 19,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/kernel/notifications_interface.h",
      "position" : 11,
      "pull_request_review_id" : 1521747346,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1258032967/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-10T17:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1258032967",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1258586027"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1258586027"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: would `SetNotificationArgs` be a better name to clarify the side effects this function has?",
      "commit_id" : "09938a41d904c05b4676b064da9baa85e53e3e6f",
      "created_at" : "2023-07-10T16:45:24Z",
      "diff_hunk" : "@@ -1409,6 +1410,7 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     // ********************************************************* Step 7: load block chain\n \n     node.notifications = std::make_unique<KernelNotifications>(node.exit_status);\n+    ReadNotificationArgs(args, *node.notifications);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1258586027",
      "id" : 1258586027,
      "line" : 1413,
      "node_id" : "PRRC_kwDOABII585LBH-r",
      "original_commit_id" : "09938a41d904c05b4676b064da9baa85e53e3e6f",
      "original_line" : 1413,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 23,
      "pull_request_review_id" : 1521747346,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1258586027/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-10T17:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1258586027",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1258600239"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1258600239"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't see in which scenario `blockTip()` would return `kernel::Interrupted` here, but the docs seem to indicate that it could. I'd suggest to either update the docs to reflect that we never expect this to interrupt, or add a logging statement similar to what's done in `ThreadImport`?",
      "commit_id" : "09938a41d904c05b4676b064da9baa85e53e3e6f",
      "created_at" : "2023-07-10T16:58:33Z",
      "diff_hunk" : "@@ -3369,7 +3372,10 @@ bool Chainstate::InvalidateBlock(BlockValidationState& state, CBlockIndex* pinde\n \n     // Only notify about a new block tip if the active chain was modified.\n     if (pindex_was_in_chain) {\n-        m_chainman.GetNotifications().blockTip(GetSynchronizationState(IsInitialBlockDownload()), *to_mark_failed->pprev);\n+        // Ignoring return value for now, this could be changed to bubble up\n+        // kernel::Interrupted value to the caller so the caller could\n+        // distinguish between completed and interrupted operations.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1258600239",
      "id" : 1258600239,
      "line" : 3377,
      "node_id" : "PRRC_kwDOABII585LBLcv",
      "original_commit_id" : "09938a41d904c05b4676b064da9baa85e53e3e6f",
      "original_line" : 3377,
      "original_position" : 36,
      "original_start_line" : 3375,
      "path" : "src/validation.cpp",
      "position" : 36,
      "pull_request_review_id" : 1521747346,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1258600239/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3375,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-10T17:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1258600239",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1258979021"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1258979021"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1258586027\r\n\r\n> nit: would `SetNotificationArgs` be a better name to clarify the side effects this function has?\r\n\r\nIt seems like if you just saw a `ReadNotificationArgs(args, *node.notifications)` call with no context you would assume that it is reading args from the \"args\" variable into the \"notifications\" variable. Is there another way it could be interpreted?\r\n\r\n`node::ReadNotificationArgs` function name is meant to be consistent with `node::ReadDatabaseArgs`, `node::ReadCoinsViewArgs`, and `wallet::ReadDatabaseArgs` functions. The \"args\" that are being referred to are command line arguments and other `ArgsManager` settings that come from the OS and filesystem. So it seems more accurate to me to say that the args are read or parsed or interpreted here, not set here.",
      "commit_id" : "3e6b6877645f978b4999efdfb9e616f4dbf9dd19",
      "created_at" : "2023-07-10T22:40:16Z",
      "diff_hunk" : "@@ -1409,6 +1410,7 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     // ********************************************************* Step 7: load block chain\n \n     node.notifications = std::make_unique<KernelNotifications>(node.exit_status);\n+    ReadNotificationArgs(args, *node.notifications);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1258979021",
      "id" : 1258979021,
      "in_reply_to_id" : 1258586027,
      "line" : 1413,
      "node_id" : "PRRC_kwDOABII585LCn7N",
      "original_commit_id" : "09938a41d904c05b4676b064da9baa85e53e3e6f",
      "original_line" : 1413,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 23,
      "pull_request_review_id" : 1523139721,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1258979021/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-11T00:04:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1258979021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1258979349"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1258979349"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1258032967\r\n\r\n> nit\r\n\r\nThanks, fixed",
      "commit_id" : "3e6b6877645f978b4999efdfb9e616f4dbf9dd19",
      "created_at" : "2023-07-10T22:40:53Z",
      "diff_hunk" : "@@ -9,12 +9,25 @@\n \n #include <cstdint>\n #include <string>\n+#include <variant>\n \n class CBlockIndex;\n enum class SynchronizationState;\n \n namespace kernel {\n \n+//! Result type for use with std::variant to indiciate that an operation should be interrupted.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1258979349",
      "id" : 1258979349,
      "in_reply_to_id" : 1258032967,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LCoAV",
      "original_commit_id" : "09938a41d904c05b4676b064da9baa85e53e3e6f",
      "original_line" : 19,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/kernel/notifications_interface.h",
      "position" : null,
      "pull_request_review_id" : 1523139721,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1258979349/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-11T00:04:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1258979349",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1259001998"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1259001998"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1258600239\r\n\r\n> I don't see in which scenario `blockTip()` would return `kernel::Interrupted` here, but the docs seem to indicate that it could. I'd suggest to either update the docs to reflect that we never expect this to interrupt, or add a logging statement similar to what's done in `ThreadImport`?\r\n\r\nI'm happy to update the comment, but it would help to have a specific suggestion, because to me this is only saying that a kernel::Interrupted value might be returned here (as a fact of the `[[nodiscard]] virtual InterruptResult blockTip` return type). I don't think there's a suggestion here that bitcoind will return `kernel::Interrupted{}` . But other libbitcoinkernel applications or tests might could handle the `blockTip` notification in the future and return an interrupted value, and that case could be handled here.",
      "commit_id" : "3e6b6877645f978b4999efdfb9e616f4dbf9dd19",
      "created_at" : "2023-07-10T23:23:31Z",
      "diff_hunk" : "@@ -3369,7 +3372,10 @@ bool Chainstate::InvalidateBlock(BlockValidationState& state, CBlockIndex* pinde\n \n     // Only notify about a new block tip if the active chain was modified.\n     if (pindex_was_in_chain) {\n-        m_chainman.GetNotifications().blockTip(GetSynchronizationState(IsInitialBlockDownload()), *to_mark_failed->pprev);\n+        // Ignoring return value for now, this could be changed to bubble up\n+        // kernel::Interrupted value to the caller so the caller could\n+        // distinguish between completed and interrupted operations.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1259001998",
      "id" : 1259001998,
      "in_reply_to_id" : 1258600239,
      "line" : 3377,
      "node_id" : "PRRC_kwDOABII585LCtiO",
      "original_commit_id" : "09938a41d904c05b4676b064da9baa85e53e3e6f",
      "original_line" : 3377,
      "original_position" : 36,
      "original_start_line" : 3375,
      "path" : "src/validation.cpp",
      "position" : 36,
      "pull_request_review_id" : 1523139721,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1259001998/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3375,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-11T00:04:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1259001998",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1259566308"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1259566308"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think I was confusing the kernel/node boundaries a bit. You're right that here in the kernel logic that is `validation.cpp`, the documentation and behaviour are what we'd expect.\r\n\r\nMy concern was around the _node_ implementation of `blockTip()` now potentially calling `StartShutdown()` and returning a `kernel:Interrupted` without leaving any trace. It's not something we'd expect to happen in `InvalidateBlock()` (and it would be behaviour change). I think I was wrong in suggesting we catch/log/document that here in `validation.cpp` though, as it's node specific behaviour.\r\n\r\nPerhaps it would be beneficial to move [this logging](https://github.com/bitcoin/bitcoin/commit/09938a41d904c05b4676b064da9baa85e53e3e6f#diff-114c2880ec1ff2c5293ac65ceda0637bf92c05745b74b58410585a549464a33fR937) to `KernelNotifications::blocksImported()` and add a similar logging statement in `KernelNotifications::blockTip`?\r\n\r\n...\r\n_Although having typed all of this out... Is `InvalidateBlock()` even meant to be/stay in kernel?_",
      "commit_id" : "3e6b6877645f978b4999efdfb9e616f4dbf9dd19",
      "created_at" : "2023-07-11T10:55:19Z",
      "diff_hunk" : "@@ -3369,7 +3372,10 @@ bool Chainstate::InvalidateBlock(BlockValidationState& state, CBlockIndex* pinde\n \n     // Only notify about a new block tip if the active chain was modified.\n     if (pindex_was_in_chain) {\n-        m_chainman.GetNotifications().blockTip(GetSynchronizationState(IsInitialBlockDownload()), *to_mark_failed->pprev);\n+        // Ignoring return value for now, this could be changed to bubble up\n+        // kernel::Interrupted value to the caller so the caller could\n+        // distinguish between completed and interrupted operations.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1259566308",
      "id" : 1259566308,
      "in_reply_to_id" : 1258600239,
      "line" : 3377,
      "node_id" : "PRRC_kwDOABII585LE3Tk",
      "original_commit_id" : "09938a41d904c05b4676b064da9baa85e53e3e6f",
      "original_line" : 3377,
      "original_position" : 36,
      "original_start_line" : 3375,
      "path" : "src/validation.cpp",
      "position" : 36,
      "pull_request_review_id" : 1523997477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1259566308/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3375,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-11T10:55:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1259566308",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1259573661"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1259573661"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You make a lot of good points, and I think I agree with all of them. Thank you.",
      "commit_id" : "3e6b6877645f978b4999efdfb9e616f4dbf9dd19",
      "created_at" : "2023-07-11T11:01:53Z",
      "diff_hunk" : "@@ -1409,6 +1410,7 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     // ********************************************************* Step 7: load block chain\n \n     node.notifications = std::make_unique<KernelNotifications>(node.exit_status);\n+    ReadNotificationArgs(args, *node.notifications);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1259573661",
      "id" : 1259573661,
      "in_reply_to_id" : 1258586027,
      "line" : 1413,
      "node_id" : "PRRC_kwDOABII585LE5Gd",
      "original_commit_id" : "09938a41d904c05b4676b064da9baa85e53e3e6f",
      "original_line" : 1413,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 23,
      "pull_request_review_id" : 1524009154,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1259573661/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-11T11:01:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1259573661",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-07-11T14:32:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#issuecomment-1630945079",
      "id" : 1630945079,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28048",
      "node_id" : "IC_kwDOABII585hNj83",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1630945079/reactions"
      },
      "updated_at" : "2023-07-11T14:32:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1630945079",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1260065112"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1260065112"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Just wanted to note that this proposal has some history, see Issue #13477 and the two closed PRs: #13490 and #13713.\r\n\r\nIn particular, comment https://github.com/bitcoin/bitcoin/pull/13490#issuecomment-398069237 still seems relevant:\r\nThe expectation that -stopatheight stops exactly at the specified height relies on `ActivateBestChainStep()` only connecting a single block in each invocation, which is currently the case, but more \r\nof a coincidence due to not wanting to lock `cs_main` for too long than an actual guarantee given by the function.\r\n\r\nMaybe it would be good to explicitly document in `ActivateBestChainStep` that `-stopatheight` relies on it conecting just a single block (outside of a reorg situation)?",
      "commit_id" : "3e6b6877645f978b4999efdfb9e616f4dbf9dd19",
      "created_at" : "2023-07-11T17:36:03Z",
      "diff_hunk" : "@@ -0,0 +1 @@\n+- The `-stopatheight` option will now stop exactly at the specified height, rather than at or above the specified height. Since the node shuts down as soon as it find a valid chain at the specified height, it is possible for the resulting chain to no longer be the most-work chain, if some of the blocks above the specified height are invalid.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1260065112",
      "id" : 1260065112,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585LGxFY",
      "original_commit_id" : "3e6b6877645f978b4999efdfb9e616f4dbf9dd19",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "doc/release-notes-28048.md",
      "position" : 1,
      "pull_request_review_id" : 1524806674,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1260065112/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-11T17:47:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1260065112",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1260132300"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1260132300"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't actually want to make any new guarantees here. I'm just trying to make a simplification to the `ActivateBestChain` function and document the resulting behavior in release notes. Maybe the following release note would be better?\r\n\r\n- The `-stopatheight` option now stops earlier and no longer tries to validate and connect all the downloaded blocks above the specified height on the most-work chain. This means the resulting chain is more likely to be exactly the specified height instead of longer. But it also means the resulting chain might no longer the most-work chain if blocks above the specified height appeared to contain more work but were actually invalid.\r\n\r\nWould appreciate any suggestions to make the description better.",
      "commit_id" : "3e6b6877645f978b4999efdfb9e616f4dbf9dd19",
      "created_at" : "2023-07-11T18:38:01Z",
      "diff_hunk" : "@@ -0,0 +1 @@\n+- The `-stopatheight` option will now stop exactly at the specified height, rather than at or above the specified height. Since the node shuts down as soon as it find a valid chain at the specified height, it is possible for the resulting chain to no longer be the most-work chain, if some of the blocks above the specified height are invalid.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1260132300",
      "id" : 1260132300,
      "in_reply_to_id" : 1260065112,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585LHBfM",
      "original_commit_id" : "3e6b6877645f978b4999efdfb9e616f4dbf9dd19",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "doc/release-notes-28048.md",
      "position" : 1,
      "pull_request_review_id" : 1524948533,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1260132300/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-11T18:38:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1260132300",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1261480112"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1261480112"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I looked into this deeper and did some test runs on signet, and now I'm no longer sure that this is a behavioral change requiring a release note in the first place:\r\n\r\nMy understanding is that the IBD behavior on master is:\r\n* `ActivateBestChainStep()`Â  will connect only one block if we made progress\r\n* The inner do / while loop of `ActivateBestChain` also will only run once unless the chain has less work than intitially (only relevant in a reorg).\r\n* so during IBD we'll connect one block, release `cs_main`, call `StartShutdown()` if the stopheight is reached, break out of the outer do / while loop because `m_chainman.m_interrupt` is set.\r\n* There is a race between `Shutdown()` executed in the `init` thread, and `msghand`, so it's possible that `msghand` connects another block or two (by executing new calls to ABC!) before it's being stopped by `Shutdown()`. But the same should be possible after this PR?\r\n\r\nAlso, the explanation of previous behavior in the commit msg (\"It would not stop connecting blocks after the specifiedÂ  height if they were already downloaded.\") does not seem to be accurate because of the existing [break](https://github.com/bitcoin/bitcoin/blob/357e3f6aa476658aecae7239b4b06d2bc362ff1e/src/validation.cpp#L3191C13-L3191C23).",
      "commit_id" : "3e6b6877645f978b4999efdfb9e616f4dbf9dd19",
      "created_at" : "2023-07-12T17:14:12Z",
      "diff_hunk" : "@@ -0,0 +1 @@\n+- The `-stopatheight` option will now stop exactly at the specified height, rather than at or above the specified height. Since the node shuts down as soon as it find a valid chain at the specified height, it is possible for the resulting chain to no longer be the most-work chain, if some of the blocks above the specified height are invalid.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1261480112",
      "id" : 1261480112,
      "in_reply_to_id" : 1260065112,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585LMKiw",
      "original_commit_id" : "3e6b6877645f978b4999efdfb9e616f4dbf9dd19",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "doc/release-notes-28048.md",
      "position" : 1,
      "pull_request_review_id" : 1526836852,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1261480112/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-12T17:16:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1261480112",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1261536518"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1261536518"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1261480112\r\n\r\n:man_facepalming: Thanks! I didn't notice the `StartShutdown` call was followed by a `if (m_chainman.m_interrupt) break` line. So it was already exiting the loop after the height check, and adding a new `break` would not change anything.\r\n\r\nI think you are also right that there are race conditions where extra blocks could be attached, but I haven't looked into the details. Maybe it is worth opening an issue with your observations, in case there is a quick fix, or more questions to discuss. Naively, I'd think `ProcessNewBlock` should just do `if (m_interrupt) return false;` and the types of races you mention would be avoided.",
      "commit_id" : "31eca93a9eb8e54f856d3f558aa3c831ef181d37",
      "created_at" : "2023-07-12T17:53:48Z",
      "diff_hunk" : "@@ -0,0 +1 @@\n+- The `-stopatheight` option will now stop exactly at the specified height, rather than at or above the specified height. Since the node shuts down as soon as it find a valid chain at the specified height, it is possible for the resulting chain to no longer be the most-work chain, if some of the blocks above the specified height are invalid.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1261536518",
      "id" : 1261536518,
      "in_reply_to_id" : 1260065112,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LMYUG",
      "original_commit_id" : "3e6b6877645f978b4999efdfb9e616f4dbf9dd19",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "doc/release-notes-28048.md",
      "position" : null,
      "pull_request_review_id" : 1526920138,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1261536518/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T15:33:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1261536518",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1262699057"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262699057"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1259566308\r\n\r\nI'm not too concerned about `blockTip` notification shutting down during an `invalidateblock` call, because it seems like a corner case to worry about someone using `-stopafterheight` and `invalidblock` at the same time. If someone is doing this, I think there is only a small change of behavior not worth documenting where the `-stopatheight` option might take effect a little earlier and the node would shut down a little sooner.\r\n\r\nIf distinguishing `invalidateblock` tip changes from other tip changes is a concern for other reaons in the future, it could be addressed by adding an enum parameter to the `blockTip` function that indicates the source or the tip change.\r\n\r\nThe point of the \"this could be changed to bubble up kernel::Interrupted\" comment is not to worry about the stopatheight+invalidateblock corner case, but just suggest in general it should probably become a pattern to do something like `if (IsInterrupted(result)) return std::get<Interrrupted>(result)` and bubble up interrupted values to callers.\r\n\r\nOn logging, I think it is usually better to log from kernel code rather than from node hooks, because if the log statements are actually useful for our code there is a good chance they will be useful for other code as well.\r\n\r\nOn InvalidateBlock staying in the kernel, declaring blocks invalid seems like a useful feature to offer to kernel applications, so I don't think there would be much benefit to removing it.",
      "commit_id" : "31eca93a9eb8e54f856d3f558aa3c831ef181d37",
      "created_at" : "2023-07-13T15:04:34Z",
      "diff_hunk" : "@@ -3369,7 +3372,10 @@ bool Chainstate::InvalidateBlock(BlockValidationState& state, CBlockIndex* pinde\n \n     // Only notify about a new block tip if the active chain was modified.\n     if (pindex_was_in_chain) {\n-        m_chainman.GetNotifications().blockTip(GetSynchronizationState(IsInitialBlockDownload()), *to_mark_failed->pprev);\n+        // Ignoring return value for now, this could be changed to bubble up\n+        // kernel::Interrupted value to the caller so the caller could\n+        // distinguish between completed and interrupted operations.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1262699057",
      "id" : 1262699057,
      "in_reply_to_id" : 1258600239,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LQ0Ix",
      "original_commit_id" : "09938a41d904c05b4676b064da9baa85e53e3e6f",
      "original_line" : 3377,
      "original_position" : 36,
      "original_start_line" : 3375,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1526920138,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262699057/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-13T15:33:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262699057",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1262989504"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262989504"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Naively, I'd think ProcessNewBlock should just do if (m_interrupt) return false; and the types of races you mention would be avoided.\r\n\r\nHmm, if it arrived to `ProcessNewBlock` is because the node requested the block. So I would try to not discard it, and instead make it pass through `AcceptBlock` so it can be stored. Then quit early before ABC.",
      "commit_id" : "31eca93a9eb8e54f856d3f558aa3c831ef181d37",
      "created_at" : "2023-07-13T19:45:51Z",
      "diff_hunk" : "@@ -0,0 +1 @@\n+- The `-stopatheight` option will now stop exactly at the specified height, rather than at or above the specified height. Since the node shuts down as soon as it find a valid chain at the specified height, it is possible for the resulting chain to no longer be the most-work chain, if some of the blocks above the specified height are invalid.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1262989504",
      "id" : 1262989504,
      "in_reply_to_id" : 1260065112,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LR7DA",
      "original_commit_id" : "3e6b6877645f978b4999efdfb9e616f4dbf9dd19",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "doc/release-notes-28048.md",
      "position" : null,
      "pull_request_review_id" : 1529138787,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262989504/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T19:52:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262989504",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1263547071"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1263547071"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This requires to `#include \"kernel/notifications_interface.h\"`, no?",
      "commit_id" : "31eca93a9eb8e54f856d3f558aa3c831ef181d37",
      "created_at" : "2023-07-14T10:01:30Z",
      "diff_hunk" : "@@ -57,9 +58,14 @@ static void DoWarning(const bilingual_str& warning)\n \n namespace node {\n \n-void KernelNotifications::blockTip(SynchronizationState state, CBlockIndex& index)\n+kernel::InterruptResult KernelNotifications::blockTip(SynchronizationState state, CBlockIndex& index)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1263547071",
      "id" : 1263547071,
      "line" : 61,
      "node_id" : "PRRC_kwDOABII585LUDK_",
      "original_commit_id" : "31eca93a9eb8e54f856d3f558aa3c831ef181d37",
      "original_line" : 61,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/node/kernel_notifications.cpp",
      "position" : 13,
      "pull_request_review_id" : 1530008568,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1263547071/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-14T10:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1263547071",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1263674110"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1263674110"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> This requires to `#include \"kernel/notifications_interface.h\"`, no?\r\n\r\nIt is included from the header, and is not a new dependency since this file is subclassing that one, but yes according to IWYU's reasoning it should be included directly here as well. I'll add the include if I need to update this PR for another reason.",
      "commit_id" : "31eca93a9eb8e54f856d3f558aa3c831ef181d37",
      "created_at" : "2023-07-14T12:23:26Z",
      "diff_hunk" : "@@ -57,9 +58,14 @@ static void DoWarning(const bilingual_str& warning)\n \n namespace node {\n \n-void KernelNotifications::blockTip(SynchronizationState state, CBlockIndex& index)\n+kernel::InterruptResult KernelNotifications::blockTip(SynchronizationState state, CBlockIndex& index)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1263674110",
      "id" : 1263674110,
      "in_reply_to_id" : 1263547071,
      "line" : 61,
      "node_id" : "PRRC_kwDOABII585LUiL-",
      "original_commit_id" : "31eca93a9eb8e54f856d3f558aa3c831ef181d37",
      "original_line" : 61,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/node/kernel_notifications.cpp",
      "position" : 13,
      "pull_request_review_id" : 1530206423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1263674110/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-14T12:23:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1263674110",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1263696589"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1263696589"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd say no. There should be never a need to include `kernel/notifications_interface.h` when you've included `node/kernel_notifications.h`. And I don't see an outcome where `node/kernel_notifications.h` was ever changed to not include  `kernel/notifications_interface.h`. Thus, iwyu pragma `export` should be used.",
      "commit_id" : "31eca93a9eb8e54f856d3f558aa3c831ef181d37",
      "created_at" : "2023-07-14T12:47:05Z",
      "diff_hunk" : "@@ -57,9 +58,14 @@ static void DoWarning(const bilingual_str& warning)\n \n namespace node {\n \n-void KernelNotifications::blockTip(SynchronizationState state, CBlockIndex& index)\n+kernel::InterruptResult KernelNotifications::blockTip(SynchronizationState state, CBlockIndex& index)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28048#discussion_r1263696589",
      "id" : 1263696589,
      "in_reply_to_id" : 1263547071,
      "line" : 61,
      "node_id" : "PRRC_kwDOABII585LUnrN",
      "original_commit_id" : "31eca93a9eb8e54f856d3f558aa3c831ef181d37",
      "original_line" : 61,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/node/kernel_notifications.cpp",
      "position" : 13,
      "pull_request_review_id" : 1530242150,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28048",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1263696589/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-14T12:47:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1263696589",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
