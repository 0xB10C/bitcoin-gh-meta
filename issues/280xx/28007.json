{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "On busy VPS and shared host with limited resources, the time between when a messages is sent to the tcpip send or receive \r\nqueue and when it is sent in the case of send queue, or when it is processed (ProcessMessage) can be in excess of 30 seconds. \r\nThis delay introduces a skew in AdjustedTime.\r\n\r\nFor the receive queue, the post processing uses the receive time prior to entering the queue to calculate TimeOffset rather than Now()  which currently includes the delay in the queue.\r\n\r\nFor the send queue, the queued message is altered to update the nTime of the message to the actual time it is being sent rather than the time at which it was queued\r\n\r\nWas tested on an hp 370 G6 24 core 3ghz 192gb host with the daemon launched with -par=2 to restrict the resources of the \r\ndaemon. Logging was added pre-patch to document the delay through the queue and was observed for both send and receive to be occasionally > 30 seconds when the daemon was busy following the tip or during reorgs when the cup utilization for the assigned core  approached 100%.  Significant queue delay occurs most often in the receive queue (several times a minute) and infrequently in the send queue ( 1 observation in several hours of testing ).\r\n\r\n## Checklist:\r\n  _Go over all the following points, and put an `x` in all the boxes that apply._\r\n- [X ] I have performed a self-review of my own code\r\n- [X ] I have commented my code, particularly in hard-to-understand areas\r\n- [ ] I have added or updated relevant unit/integration/functional/e2e tests\r\n- [ ] I have made corresponding changes to the documentation\r\n- [ ] I have assigned this pull request to a milestone _(for repository code-owners and collaborators only)_\r\n",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 3,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28007/comments",
   "created_at" : "2023-06-29T20:02:40Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28007/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/28007",
   "id" : 1781424558,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28007/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII585URgZF",
   "number" : 28007,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/28007.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28007",
      "merged_at" : null,
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/28007.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28007"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28007/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28007/timeline",
   "title" : "fix: delay in TimeOffset applied to AdjustedTime caused by send/receiâ¦",
   "updated_at" : "2023-06-29T21:51:53Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28007",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/72998170?v=4",
      "events_url" : "https://api.github.com/users/techy2/events{/privacy}",
      "followers_url" : "https://api.github.com/users/techy2/followers",
      "following_url" : "https://api.github.com/users/techy2/following{/other_user}",
      "gists_url" : "https://api.github.com/users/techy2/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/techy2",
      "id" : 72998170,
      "login" : "techy2",
      "node_id" : "MDQ6VXNlcjcyOTk4MTcw",
      "organizations_url" : "https://api.github.com/users/techy2/orgs",
      "received_events_url" : "https://api.github.com/users/techy2/received_events",
      "repos_url" : "https://api.github.com/users/techy2/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/techy2/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/techy2/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/techy2"
   }
}
