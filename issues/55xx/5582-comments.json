[
   {
      "body" : "I was a bit foggy last night when writing the description after going in circles with SDKs and toolchains all day, so I'll try to provide a better breakdown here.\r\n\r\n#### XCode\r\nWhen building in the normal OSX ecosystem (download a monolithic Xcode release and use it without asking questions), the compiler, linker, build tools, and SDKs all come together. However, they retain a relatively high amount of back/forward-compatibility with each-other. Each Xcode release typically comes with ~2 SDKs for use. ThatÃ¢ÂÂs ignoring iOS, which weÃ¢ÂÂre not interested in.\r\n\r\nThe current stable release is Xcode 6.1.1.\r\n#### SDKs\r\n\r\nThe SDKs contain features available for the respective OS version, but they also remain backwards-compatible depending on a compiler switch that sets the minimum desired runtime environment. A new SDK is typically released just before each major OS upgrade.\r\n\r\nExample:\r\nItÃ¢ÂÂs possible to build against the 10.10 sdk while using -mmacosx-version-min=10.6. Weak linking is used to ensure that missing symbols on 10.6 wonÃ¢ÂÂt cause runtime failure, but if the symbols are detected at runtime on 10.7-10.10, they can be used. That looks something like this:\r\nhttps://github.com/bitcoin/bitcoin/pull/5477#issuecomment-67061992\r\n\r\nAs you can see, 10.10 features can happily be compiled and used, but care needs to be taken to ensure that theyÃ¢ÂÂre tested at runtime first. So the only downside in building against the latest/greatest SDK is that someone might have forgotten to add a runtime check for a new feature which would cause a crash in older environments. Using an older SDK in the same scenario would cause a build failure instead.\r\n\r\n#### Toolchains\r\n\r\nEach version of XCode ships with a new toolchain, which is comprised of a compiler (clang/clang++), linker (ld64, appleÃ¢ÂÂs own, not gold/bfd), and cctools (binutils in the rest of the unix world: ar, ranlib, nm, etc).\r\n\r\nFor the most part, the toolchains and SDKs are unrelated. A sufficiently new toolchain can build using any SDK.\r\n\r\n#### Stdlib\r\n\r\nPrior to 10.7, OSX shipped with only gnu libstdc++ runtime libs. The 10.7 SDK switched to clang and added the libc++ option, so devs could build using libc++ if they were willing to set a minimum supported runtime of 10.7.\r\n\r\nThe 10.9 SDK made libc++ the default, however itÃ¢ÂÂs still possible to use -stdlib=libstdc++ to avoid the change. Also, setting -mmacosx-version-min=10.6 will force the use of libstdc++, since itÃ¢ÂÂs not available there.\r\n\r\nThe main take-away here is that in order to build using libc++, the minimum runtime version will require a bump from 10.6 to 10.7.\r\n\r\n#### Putting it all together\r\n\r\nBecause we roll our own toolchain and build environments in Linux, weÃ¢ÂÂre free to mix and match the above components however we desire, as long as they all play nicely together.\r\n\r\nFor the work in this PR, I originally bumped to the following:\r\nclang 3.5 (xcode 6.1.1 uses Ã¢ÂÂApple LLVM version 6.0 (clang-600.0.56) (based on LLVM 3.5svn)Ã¢ÂÂ)\r\n10.10 SDK (from xcode 6.1.1)\r\nld64 241.9 (same version used in xcode 6.1.1)\r\ncctools 862 (same version used in xcode 6.1.1)\r\n\r\nThat put us 100% up-to-date with appleÃ¢ÂÂs current stable tools. Everything worked well.\r\n\r\nHowever, thereÃ¢ÂÂs not an official clang 3.5 binary for Precise, which is used by Gitian and Travis. There is a Trusty binary, but it requires a newer libstdc++ and canÃ¢ÂÂt run.\r\n\r\nTo get around that, I next tried downgrading clang to 3.4, which is compatible with Precise. Unfortunately, thereÃ¢ÂÂs a bug in 3.4 that breaks darwin builds, as discussed briefly with @gmaxwell last night. IÃ¢ÂÂm still working to track down the exact cause.\r\n\r\nFinally, I arrived at clang 3.3, which builds and works fine, however it is not capable of building with the 10.10 sdk. ItÃ¢ÂÂs fine up to 10.9 though.\r\n\r\n#### Takeaway\r\nSo the final result here is that with these changes we're using the latest/greatest apple tools and SDKs and we're in good shape for the foreseeable future, with the exception that we're currently slightly constrained by our build environments.\r\n\r\nBefore these changes, we were using much older versions of all of these tools, which limited the SDKs we could target. Those versions of cctools/ld64 also only worked when compiled as 32bit. Since ld64 requires the use of clang's libLTO, that meant that we were also stuck using a 32bit clang.",
      "created_at" : "2014-12-31T19:26:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5582#issuecomment-68463725",
      "id" : 68463725,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5582",
      "updated_at" : "2014-12-31T19:26:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/68463725",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "While I was looking at the clang-3.4 problem yesterday, robbak on IRC happened to be wrestling with the same problem on FreeBSD. I tested a vanilla osx build from llvm.org natively on osx, and it had the same problem. \r\n\r\nI've managed to track down the problem, and have a confirmed fix. This https://github.com/llvm-mirror/clang/commit/c174fe5f125f749eaf5ea7cc41f3cbf049bc5ada needs to be backported to the 3.4 branch. I'll report it to the LLVM list after the new year and see if they're interested in doing a 3.4.3 release, since the official 3.4.2 binaries are quite broken for (at a minimum) OSX and FreeBSD.",
      "created_at" : "2014-12-31T23:59:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5582#issuecomment-68475777",
      "id" : 68475777,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5582",
      "updated_at" : "2014-12-31T23:59:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/68475777",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "Nice. Tested. This fixes the Qt issue of building on 10.9 with the 10.10 SDK.",
      "created_at" : "2015-01-02T02:02:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5582#issuecomment-68505552",
      "id" : 68505552,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5582",
      "updated_at" : "2015-01-02T02:02:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/68505552",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=3",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "body" : "Thanks for figuring this all out @theuni!\r\nIs this intended for 0.10rc2 or just master?",
      "created_at" : "2015-01-02T12:30:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5582#issuecomment-68523581",
      "id" : 68523581,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5582",
      "updated_at" : "2015-01-02T12:30:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/68523581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj master only. I don't foresee any problems, but it'd be far too risky for 0.10 at the last minute.",
      "created_at" : "2015-01-02T18:53:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5582#issuecomment-68551269",
      "id" : 68551269,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5582",
      "updated_at" : "2015-01-02T18:53:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/68551269",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "First commit dropped, and rebased on top of #5586",
      "created_at" : "2015-01-02T20:12:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5582#issuecomment-68558085",
      "id" : 68558085,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5582",
      "updated_at" : "2015-01-02T20:12:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/68558085",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "utACK",
      "created_at" : "2015-01-03T09:32:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5582#issuecomment-68588892",
      "id" : 68588892,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5582",
      "updated_at" : "2015-01-03T09:32:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/68588892",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
