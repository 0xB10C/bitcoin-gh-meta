[
   {
      "body" : "@gmaxwell how does this impact on the connectivity of those [non-incoming] nodes? (that is, does it hinder them at all?)",
      "created_at" : "2016-08-25T23:55:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242582502",
      "id" : 242582502,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8594",
      "updated_at" : "2016-08-25T23:57:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242582502",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "utACK 53f8f226bd1d627c4a6dec5862a1d4ea5a933e45\r\n\r\ntravis is borked",
      "created_at" : "2016-08-26T01:03:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242591646",
      "id" : 242591646,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8594",
      "updated_at" : "2016-08-26T01:03:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242591646",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=3",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "body" : "utACK",
      "created_at" : "2016-08-26T04:06:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242625387",
      "id" : 242625387,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8594",
      "updated_at" : "2016-08-26T04:06:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242625387",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "@EthanHeilman any comments here?\n",
      "created_at" : "2016-08-26T07:12:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242648082",
      "id" : 242648082,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8594",
      "updated_at" : "2016-08-26T07:12:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242648082",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "utACK, this has bothered me before",
      "created_at" : "2016-08-26T09:19:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242676784",
      "id" : 242676784,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8594",
      "updated_at" : "2016-08-26T09:19:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242676784",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "utACK",
      "created_at" : "2016-08-26T13:01:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242729060",
      "id" : 242729060,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8594",
      "updated_at" : "2016-08-26T13:01:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242729060",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Can we backport this to 0.13?",
      "created_at" : "2016-08-26T13:06:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242730040",
      "id" : 242730040,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8594",
      "updated_at" : "2016-08-26T13:06:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242730040",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa @gmaxwell Reading [main.cpp:5033](https://github.com/bitcoin/bitcoin/blob/master/src/main.cpp#L5033), my understanding is that incoming connections are only added to the tried table if the source IP address of the TCP connection is the same as the IP address supplied in the version message. [The assumption here is that if the peer's IP in the version message is the same as the IP in TCP connect, the peer can accept incoming connections](https://github.com/bitcoin/bitcoin/blob/master/src/addrman.h#L127). This assumption can be violated under two conditions:\r\n\r\n1. Nothing prevents a malicious peer behind a NAT from altering the IP address in the version message to make it look like it is not behind a NAT. While this is less than ideal an attacker can only do this once per IP address they control. This is certainly better than the protections provided by address messages where a malicious peer controlling a single IP address can inject up to ~2048 IP addresses into the new table via address messages (this is an approximate back of the envelope calculation).\r\n\r\n2. A peer might not accept incoming connections but still may not be behind a NAT. It is unclear how common this is, but my expectation from reading bitcoind log files over the years would be that it would be that it is uncommon. We can answer this question with data.\r\n\r\nFrom a security standpoint IP addresses from address messages are more vulnerable to manipulation than IP addresses from incoming connections.\r\n\r\n>The vast majority of nodes on the network do not accept incoming connections, adding them will only slow down the process of making a successful connection in the future.\r\n\r\nI am operating under the assumption that most nodes that do not accept incoming connections do so because they are behind NATs and therefore would not be added to the tried table.\r\n\r\nFor this and other reasons I would be against this change. If we want to improve the quality of the tried table perhaps confirming that an incoming connection can be connected to via a feeler connection might be a solution. Test-before-evict which I'm currently working on (proof of concept can be found at #6355) does provide some functionality like this and my recently accepted pull request #8282 did, [in tests, boost the reachable nodes in the tried table from 55 IPs to 590 IPs](https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-237255215). I suspect the real problem with reachable IPs in the tried table is nodes switching IP addresses.",
      "created_at" : "2016-08-26T15:20:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242765325",
      "id" : 242765325,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8594",
      "updated_at" : "2016-08-26T15:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242765325",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "> Reading main.cpp:5033, my understanding is that incoming connections are only added to the tried table if the source IP address of the TCP connection is the same as the IP address supplied in the version message.\r\n\r\nDo we leak internal LAN IPs here, or is that prevented some way? Nodes should probably not advertise their address at all on outgoing connections, certainly not if they don't want / can't be connected to.",
      "created_at" : "2016-08-26T15:29:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8594#issuecomment-242767752",
      "id" : 242767752,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8594",
      "updated_at" : "2016-08-26T15:31:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242767752",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
