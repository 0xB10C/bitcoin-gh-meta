[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8084#discussion_r64144679"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8084"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64144679"
         }
      },
      "body" : "Ack",
      "commit_id" : "bba64dde5f6bff7a25143c62f4bcc089f5e84ef5",
      "created_at" : "2016-05-22T06:04:09Z",
      "diff_hunk" : "@@ -928,6 +950,20 @@ static bool AttemptToEvictConnection(bool fPreferNewConnection) {\n \n     if (vEvictionCandidates.empty()) return false;\n \n+    // Protect 4 nodes that most recently sent us transactions.\n+    // An attacker cannot manipulate this metric without performing useful work.\n+    std::sort(vEvictionCandidates.begin(), vEvictionCandidates.end(), CompareNodeTXTime);\n+    vEvictionCandidates.erase(vEvictionCandidates.end() - std::min(4, static_cast<int>(vEvictionCandidates.size())), vEvictionCandidates.end());\n+\n+    if (vEvictionCandidates.empty()) return false;\n+\n+    // Protect 4 nodes that most recently sent us blocks.\n+    // An attacker cannot manipulate this metric without performing useful work.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8084#discussion_r64144679",
      "id" : 64144679,
      "original_commit_id" : "bba64dde5f6bff7a25143c62f4bcc089f5e84ef5",
      "original_position" : 66,
      "path" : "src/net.cpp",
      "position" : 66,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8084",
      "updated_at" : "2016-05-22T06:04:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64144679",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2033945?v=3",
         "events_url" : "https://api.github.com/users/wallclockbuilder/events{/privacy}",
         "followers_url" : "https://api.github.com/users/wallclockbuilder/followers",
         "following_url" : "https://api.github.com/users/wallclockbuilder/following{/other_user}",
         "gists_url" : "https://api.github.com/users/wallclockbuilder/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/wallclockbuilder",
         "id" : 2033945,
         "login" : "wallclockbuilder",
         "organizations_url" : "https://api.github.com/users/wallclockbuilder/orgs",
         "received_events_url" : "https://api.github.com/users/wallclockbuilder/received_events",
         "repos_url" : "https://api.github.com/users/wallclockbuilder/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/wallclockbuilder/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/wallclockbuilder/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/wallclockbuilder"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8084#discussion_r64146173"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8084"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64146173"
         }
      },
      "body" : "Isn't this backward? This sorts by increasing last block time, and erases the last items.",
      "commit_id" : "bba64dde5f6bff7a25143c62f4bcc089f5e84ef5",
      "created_at" : "2016-05-22T08:30:04Z",
      "diff_hunk" : "@@ -852,6 +857,21 @@ static bool ReverseCompareNodeTimeConnected(const NodeEvictionCandidate &a, cons\n     return a.nTimeConnected > b.nTimeConnected;\n }\n \n+static bool CompareNodeBlockTime(const NodeEvictionCandidate &a, const NodeEvictionCandidate &b)\n+{\n+    if (a.nLastBlockTime != b.nLastBlockTime) return a.nLastBlockTime < b.nLastBlockTime;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8084#discussion_r64146173",
      "id" : 64146173,
      "original_commit_id" : "bba64dde5f6bff7a25143c62f4bcc089f5e84ef5",
      "original_position" : 18,
      "path" : "src/net.cpp",
      "position" : 18,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8084",
      "updated_at" : "2016-05-22T08:30:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64146173",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8084#discussion_r64146366"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8084"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64146366"
         }
      },
      "body" : "Erasing protects them from being evicted, thus keeping the most recent sources.",
      "commit_id" : "bba64dde5f6bff7a25143c62f4bcc089f5e84ef5",
      "created_at" : "2016-05-22T08:43:32Z",
      "diff_hunk" : "@@ -852,6 +857,21 @@ static bool ReverseCompareNodeTimeConnected(const NodeEvictionCandidate &a, cons\n     return a.nTimeConnected > b.nTimeConnected;\n }\n \n+static bool CompareNodeBlockTime(const NodeEvictionCandidate &a, const NodeEvictionCandidate &b)\n+{\n+    if (a.nLastBlockTime != b.nLastBlockTime) return a.nLastBlockTime < b.nLastBlockTime;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8084#discussion_r64146366",
      "id" : 64146366,
      "original_commit_id" : "bba64dde5f6bff7a25143c62f4bcc089f5e84ef5",
      "original_position" : 18,
      "path" : "src/net.cpp",
      "position" : 18,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8084",
      "updated_at" : "2016-05-22T08:43:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64146366",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8084#discussion_r64146610"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8084"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64146610"
         }
      },
      "body" : "Ah!",
      "commit_id" : "bba64dde5f6bff7a25143c62f4bcc089f5e84ef5",
      "created_at" : "2016-05-22T09:02:35Z",
      "diff_hunk" : "@@ -852,6 +857,21 @@ static bool ReverseCompareNodeTimeConnected(const NodeEvictionCandidate &a, cons\n     return a.nTimeConnected > b.nTimeConnected;\n }\n \n+static bool CompareNodeBlockTime(const NodeEvictionCandidate &a, const NodeEvictionCandidate &b)\n+{\n+    if (a.nLastBlockTime != b.nLastBlockTime) return a.nLastBlockTime < b.nLastBlockTime;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8084#discussion_r64146610",
      "id" : 64146610,
      "original_commit_id" : "bba64dde5f6bff7a25143c62f4bcc089f5e84ef5",
      "original_position" : 18,
      "path" : "src/net.cpp",
      "position" : 18,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8084",
      "updated_at" : "2016-05-22T09:02:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64146610",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
