[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16037#discussion_r284850850"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284850850"
         }
      },
      "author_association" : "MEMBER",
      "body" : "should there be some kind of grace period here, because block timestamps aren't exact?",
      "commit_id" : "90101d29304bce30eb5de8b25f19baf19482bdc8",
      "created_at" : "2019-05-16T18:53:46Z",
      "diff_hunk" : "@@ -647,15 +640,23 @@ UniValue importwallet(const JSONRPCRequest& request)\n                         fLabel = true;\n                     }\n                 }\n+                nTimeBegin = std::min(nTimeBegin, nTime);\n                 keys.push_back(std::make_tuple(key, nTime, fLabel, strLabel));\n             } else if(IsHex(vstr[0])) {\n                 std::vector<unsigned char> vData(ParseHex(vstr[0]));\n                 CScript script = CScript(vData.begin(), vData.end());\n                 int64_t birth_time = DecodeDumpTime(vstr[1]);\n+                if (birth_time > 0) nTimeBegin = std::min(nTimeBegin, birth_time);\n                 scripts.push_back(std::pair<CScript, int64_t>(script, birth_time));\n             }\n         }\n         file.close();\n+        if (pwallet->chain().havePruned()) {\n+            Optional<int> pruned_height = locked_chain->findPruned();\n+            if (pruned_height && nTimeBegin < locked_chain->getBlockTime(*pruned_height)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16037#discussion_r284850850",
      "id" : 284850850,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDg1MDg1MA==",
      "original_commit_id" : "90101d29304bce30eb5de8b25f19baf19482bdc8",
      "original_position" : 31,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 31,
      "pull_request_review_id" : 238577408,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16037",
      "updated_at" : "2019-05-16T18:53:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284850850",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The block lookup should be using findFirstBlockWithTime (see RescanFromTime) and allow some slop, because miners could have wrong clocks and users could have wrong clocks, TIMESTAMP_WINDOW,  (again see RescanFromTime).  This is particularly important for birthdays because installing the software and instantly generating a key, handing it out, and getting paid is a perfectly sensible sequence of events.\r\n\r\nOtherwise--  Concept ACK on doing this!",
      "created_at" : "2019-05-16T18:55:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16037#issuecomment-493190434",
      "id" : 493190434,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16037",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MzE5MDQzNA==",
      "updated_at" : "2019-05-16T18:55:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493190434",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16037#discussion_r284856284"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284856284"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, just use the same grace period as is used for the wallet birthday",
      "commit_id" : "90101d29304bce30eb5de8b25f19baf19482bdc8",
      "created_at" : "2019-05-16T19:09:18Z",
      "diff_hunk" : "@@ -647,15 +640,23 @@ UniValue importwallet(const JSONRPCRequest& request)\n                         fLabel = true;\n                     }\n                 }\n+                nTimeBegin = std::min(nTimeBegin, nTime);\n                 keys.push_back(std::make_tuple(key, nTime, fLabel, strLabel));\n             } else if(IsHex(vstr[0])) {\n                 std::vector<unsigned char> vData(ParseHex(vstr[0]));\n                 CScript script = CScript(vData.begin(), vData.end());\n                 int64_t birth_time = DecodeDumpTime(vstr[1]);\n+                if (birth_time > 0) nTimeBegin = std::min(nTimeBegin, birth_time);\n                 scripts.push_back(std::pair<CScript, int64_t>(script, birth_time));\n             }\n         }\n         file.close();\n+        if (pwallet->chain().havePruned()) {\n+            Optional<int> pruned_height = locked_chain->findPruned();\n+            if (pruned_height && nTimeBegin < locked_chain->getBlockTime(*pruned_height)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16037#discussion_r284856284",
      "id" : 284856284,
      "in_reply_to_id" : 284850850,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDg1NjI4NA==",
      "original_commit_id" : "90101d29304bce30eb5de8b25f19baf19482bdc8",
      "original_position" : 31,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 31,
      "pull_request_review_id" : 238584699,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16037",
      "updated_at" : "2019-05-16T19:09:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284856284",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16037#discussion_r284857816"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284857816"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was expecting this is wrong, will fix.",
      "commit_id" : "90101d29304bce30eb5de8b25f19baf19482bdc8",
      "created_at" : "2019-05-16T19:13:48Z",
      "diff_hunk" : "@@ -647,15 +640,23 @@ UniValue importwallet(const JSONRPCRequest& request)\n                         fLabel = true;\n                     }\n                 }\n+                nTimeBegin = std::min(nTimeBegin, nTime);\n                 keys.push_back(std::make_tuple(key, nTime, fLabel, strLabel));\n             } else if(IsHex(vstr[0])) {\n                 std::vector<unsigned char> vData(ParseHex(vstr[0]));\n                 CScript script = CScript(vData.begin(), vData.end());\n                 int64_t birth_time = DecodeDumpTime(vstr[1]);\n+                if (birth_time > 0) nTimeBegin = std::min(nTimeBegin, birth_time);\n                 scripts.push_back(std::pair<CScript, int64_t>(script, birth_time));\n             }\n         }\n         file.close();\n+        if (pwallet->chain().havePruned()) {\n+            Optional<int> pruned_height = locked_chain->findPruned();\n+            if (pruned_height && nTimeBegin < locked_chain->getBlockTime(*pruned_height)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16037#discussion_r284857816",
      "id" : 284857816,
      "in_reply_to_id" : 284850850,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDg1NzgxNg==",
      "original_commit_id" : "90101d29304bce30eb5de8b25f19baf19482bdc8",
      "original_position" : 31,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 31,
      "pull_request_review_id" : 238586664,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16037",
      "updated_at" : "2019-05-16T19:13:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284857816",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think the best place to test this is in `feature_prunning.py`, not `wallet_dump.py`, WDYT?",
      "created_at" : "2019-05-16T19:31:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16037#issuecomment-493202120",
      "id" : 493202120,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16037",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MzIwMjEyMA==",
      "updated_at" : "2019-05-16T19:32:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493202120",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Jup. And ideally feature_pruning should run with and without the wallet compiled in, so you can either guard it in feature_pruning behind the test framework check for the wallet or add a new test `feature_pruning_wallet`.",
      "created_at" : "2019-05-16T19:40:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16037#issuecomment-493204872",
      "id" : 493204872,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16037",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MzIwNDg3Mg==",
      "updated_at" : "2019-05-16T19:40:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493204872",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
