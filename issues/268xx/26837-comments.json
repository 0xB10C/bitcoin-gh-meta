[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [1440000bytes](https://github.com/bitcoin/bitcoin/pull/26837#issuecomment-1374359846) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26621](https://github.com/bitcoin/bitcoin/pull/26621) (refactor: Continue moving application data from CNode to Peer by dergoegge)\n* [#26441](https://github.com/bitcoin/bitcoin/pull/26441) (rpc, p2p: add `addpermissionflags` RPC by brunoerg)\n* [#26114](https://github.com/bitcoin/bitcoin/pull/26114) (net: Make AddrFetch connections to fixed seeds by mzumsande)\n* [#25515](https://github.com/bitcoin/bitcoin/pull/25515) (net, test: Virtualise CConnman and add initial PeerManager unit tests by dergoegge)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-01-06T17:43:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26837#issuecomment-1373948043",
      "id" : 1373948043,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26837",
      "node_id" : "IC_kwDOABII585R5MiL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1373948043/reactions"
      },
      "updated_at" : "2023-01-07T02:58:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1373948043",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "If it is desired to rate limit the creation of new sessions, we should (for `i2pacceptincoming=0` aka transient sessions):\r\n\r\n* keep track of the rate at which we create new sessions\r\n* when closing a connection, if the rate is too high, instead of discarding the session put it back to a pool of reused sessions\r\n* when creating new session, if the rate is too high and if the reused sessions pool is non-empty, then pick one from there\r\n\r\nReading https://github.com/bitcoin/bitcoin/issues/26754 I get the impression that this is not necessary. Further, it would be a compromise with \"one address per connection\" and would be somewhat more complicated (to implement and maintain).",
      "created_at" : "2023-01-06T17:53:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26837#issuecomment-1373956086",
      "id" : 1373956086,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26837",
      "node_id" : "IC_kwDOABII585R5Of2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1373956086/reactions"
      },
      "updated_at" : "2023-01-06T17:53:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1373956086",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26837#discussion_r1063681972"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26837"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063681972"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This would benefit from https://github.com/bitcoin/bitcoin/pull/25390 by just adding `Synced<...> m_i2p_sessions` without a separate mutex.",
      "commit_id" : "57fd27fd3621e782652c280d99263589fb3697a1",
      "created_at" : "2023-01-06T18:33:03Z",
      "diff_hunk" : "@@ -1126,6 +1127,20 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * Mutex protecting m_i2p_sam_sessions.\n+     */\n+    Mutex m_i2p_sessions_mutex;\n+\n+    /**\n+     * A pool of created I2P SAM transient sessions that should be used instead\n+     * of creating new ones in order to reduce the load on the I2P network.\n+     * Creating a session in I2P is not cheap, thus if this is not empty, then\n+     * pick an entry from it instead of creating a new session. If connecting to\n+     * a host fails, then the created session is put to this pool for reuse.\n+     */\n+    std::queue<std::unique_ptr<i2p::sam::Session>> m_i2p_sessions GUARDED_BY(m_i2p_sessions_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26837#discussion_r1063681972",
      "id" : 1063681972,
      "line" : 1142,
      "node_id" : "PRRC_kwDOABII584_Zn-0",
      "original_commit_id" : "57fd27fd3621e782652c280d99263589fb3697a1",
      "original_line" : 1142,
      "original_position" : 65,
      "original_start_line" : 1130,
      "path" : "src/net.h",
      "position" : 65,
      "pull_request_review_id" : 1239224890,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26837",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063681972/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1130,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-06T18:33:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063681972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @vasild, will have a look and test with i2pd.",
      "created_at" : "2023-01-06T20:19:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26837#issuecomment-1374088179",
      "id" : 1374088179,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26837",
      "node_id" : "IC_kwDOABII585R5uvz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1374088179/reactions"
      },
      "updated_at" : "2023-01-06T20:19:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1374088179",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2023-01-07T02:58:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26837#issuecomment-1374359846",
      "id" : 1374359846,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26837",
      "node_id" : "IC_kwDOABII585R6xEm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1374359846/reactions"
      },
      "updated_at" : "2023-01-07T02:58:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1374359846",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94559964?v=4",
         "events_url" : "https://api.github.com/users/1440000bytes/events{/privacy}",
         "followers_url" : "https://api.github.com/users/1440000bytes/followers",
         "following_url" : "https://api.github.com/users/1440000bytes/following{/other_user}",
         "gists_url" : "https://api.github.com/users/1440000bytes/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/1440000bytes",
         "id" : 94559964,
         "login" : "1440000bytes",
         "node_id" : "U_kgDOBaLe3A",
         "organizations_url" : "https://api.github.com/users/1440000bytes/orgs",
         "received_events_url" : "https://api.github.com/users/1440000bytes/received_events",
         "repos_url" : "https://api.github.com/users/1440000bytes/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/1440000bytes/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/1440000bytes/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/1440000bytes"
      }
   }
]
