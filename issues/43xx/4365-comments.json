[
   {
      "body" : "ACK",
      "created_at" : "2014-06-18T18:08:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4365#issuecomment-46471919",
      "id" : 46471919,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4365",
      "updated_at" : "2014-06-18T18:08:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46471919",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/251852?v=3",
         "events_url" : "https://api.github.com/users/drak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/drak/followers",
         "following_url" : "https://api.github.com/users/drak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/drak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/drak",
         "id" : 251852,
         "login" : "drak",
         "organizations_url" : "https://api.github.com/users/drak/orgs",
         "received_events_url" : "https://api.github.com/users/drak/received_events",
         "repos_url" : "https://api.github.com/users/drak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/drak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/drak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/drak"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/4365#discussion_r13968719"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/13968719"
         }
      },
      "body" : "Is this special-case just to make things explicit? I checked and ScriptSigArgsExpected returns 1 for TX_SCRIPTHASH.",
      "commit_id" : "7f3b4e95695d50a4970e6eb91faa956ab276f161",
      "created_at" : "2014-06-19T14:01:00Z",
      "diff_hunk" : "@@ -627,16 +626,24 @@ bool AreInputsStandard(const CTransaction& tx, CCoinsViewCache& mapInputs)\n             CScript subscript(stack.back().begin(), stack.back().end());\n             vector<vector<unsigned char> > vSolutions2;\n             txnouttype whichType2;\n-            if (!Solver(subscript, whichType2, vSolutions2))\n-                return false;\n-            if (whichType2 == TX_SCRIPTHASH)\n-                return false;\n-\n-            int tmpExpected;\n-            tmpExpected = ScriptSigArgsExpected(whichType2, vSolutions2);\n-            if (tmpExpected < 0)\n-                return false;\n-            nArgsExpected += tmpExpected;\n+            if (Solver(subscript, whichType2, vSolutions2))\n+            {\n+                int tmpExpected;\n+                if (whichType2 == TX_SCRIPTHASH)  // HASH160 <hash> OP_EQUAL\n+                    tmpExpected = 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4365#discussion_r13968719",
      "id" : 13968719,
      "original_commit_id" : "f4a78bebc45b44533ad55906a71bf0dbe4cf7b1e",
      "original_position" : 52,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4365",
      "updated_at" : "2014-06-23T19:10:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/13968719",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I worry that this will have the same effect as the fee drop - users and merchants will upgrade, miners won't, and the resulting lack of mempool consensus makes double spending easier. When we did the fee drop we didn't worry about this much because we'd done it before and it worked out OK, but this time seems to be different and miners aren't bothering to upgrade, perhaps because 0.9 had nothing for them.\r\n\r\nI don't want to make things unnecessarily complicated, but I wonder if the change should be marked in the coinbase. Then IsStandard changes once a sufficient percentage of hashing power has upgraded. Alternatively maybe if @dgenr8 gets his double spend relaying code in, that might also help.",
      "created_at" : "2014-06-19T18:14:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4365#issuecomment-46596692",
      "id" : 46596692,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4365",
      "updated_at" : "2014-06-19T18:14:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46596692",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/971089?v=3",
         "events_url" : "https://api.github.com/users/mikehearn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mikehearn/followers",
         "following_url" : "https://api.github.com/users/mikehearn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mikehearn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mikehearn",
         "id" : 971089,
         "login" : "mikehearn",
         "organizations_url" : "https://api.github.com/users/mikehearn/orgs",
         "received_events_url" : "https://api.github.com/users/mikehearn/received_events",
         "repos_url" : "https://api.github.com/users/mikehearn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mikehearn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mikehearn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mikehearn"
      }
   },
   {
      "body" : "@mikehearn Are we going to hold up every feature just because it might impact zeroconf transactions? Eligius already has implemented this patch with ~10% of hashing power; if you're worried about double-spends that opportunity already exists.",
      "created_at" : "2014-06-19T18:35:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4365#issuecomment-46599332",
      "id" : 46599332,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4365",
      "updated_at" : "2014-06-19T18:35:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46599332",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/4365#discussion_r14018609"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/14018609"
         }
      },
      "body" : "Pedantic: This example isn't actually spendable. Right now the first CHECKMULTISIG will leave a '1' on the stack making the second CHECKMULTISIG always fail. Change it to a CHECKMULTISIGVERIFY instead and remove the AND.",
      "commit_id" : "7f3b4e95695d50a4970e6eb91faa956ab276f161",
      "created_at" : "2014-06-20T13:20:02Z",
      "diff_hunk" : "@@ -256,46 +256,62 @@ BOOST_AUTO_TEST_CASE(AreInputsStandard)\n     CCoinsView coinsDummy;\n     CCoinsViewCache coins(coinsDummy);\n     CBasicKeyStore keystore;\n-    CKey key[3];\n+    CKey key[6];\n     vector<CPubKey> keys;\n-    for (int i = 0; i < 3; i++)\n+    for (int i = 0; i < 6; i++)\n     {\n         key[i].MakeNewKey(true);\n         keystore.AddKey(key[i]);\n-        keys.push_back(key[i].GetPubKey());\n     }\n+    for (int i = 0; i < 3; i++)\n+        keys.push_back(key[i].GetPubKey());\n \n     CTransaction txFrom;\n-    txFrom.vout.resize(6);\n+    txFrom.vout.resize(7);\n \n     // First three are standard:\n     CScript pay1; pay1.SetDestination(key[0].GetPubKey().GetID());\n     keystore.AddCScript(pay1);\n-    CScript payScriptHash1; payScriptHash1.SetDestination(pay1.GetID());\n     CScript pay1of3; pay1of3.SetMultisig(1, keys);\n \n-    txFrom.vout[0].scriptPubKey = payScriptHash1;\n+    txFrom.vout[0].scriptPubKey.SetDestination(pay1.GetID()); // P2SH (OP_CHECKSIG)\n     txFrom.vout[0].nValue = 1000;\n-    txFrom.vout[1].scriptPubKey = pay1;\n+    txFrom.vout[1].scriptPubKey = pay1; // ordinary OP_CHECKSIG\n     txFrom.vout[1].nValue = 2000;\n-    txFrom.vout[2].scriptPubKey = pay1of3;\n+    txFrom.vout[2].scriptPubKey = pay1of3; // ordinary OP_CHECKMULTISIG\n     txFrom.vout[2].nValue = 3000;\n \n-    // Last three non-standard:\n-    CScript empty;\n-    keystore.AddCScript(empty);\n-    txFrom.vout[3].scriptPubKey = empty;\n+    // vout[3] is complicated 1-of-3 AND 2-of-3\n+    // ... that is OK if wrapped in P2SH:\n+    CScript oneAndTwo;\n+    oneAndTwo << OP_1 << key[0].GetPubKey() << key[1].GetPubKey() << key[2].GetPubKey();\n+    oneAndTwo << OP_3 << OP_CHECKMULTISIG;\n+    oneAndTwo << OP_2 << key[3].GetPubKey() << key[4].GetPubKey() << key[5].GetPubKey();\n+    oneAndTwo << OP_3 << OP_CHECKMULTISIG;\n+    oneAndTwo << OP_AND;\n+    keystore.AddCScript(oneAndTwo);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4365#discussion_r14018609",
      "id" : 14018609,
      "original_commit_id" : "f4a78bebc45b44533ad55906a71bf0dbe4cf7b1e",
      "original_position" : 49,
      "path" : "src/test/script_P2SH_tests.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4365",
      "updated_at" : "2014-06-23T19:10:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/14018609",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "ACK modulo CHECKMULTISIG nit.\r\n\r\nI had been working on my own version of this patch and came up with a pretty similar design. Tested this with real-world non-std P2SH transactions on mainnet, no issues found. I also can't see any way that this could be a DoS issue - the 'limit sigops' approach taken is exactly how my version worked as well.",
      "created_at" : "2014-06-20T13:21:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4365#issuecomment-46677073",
      "id" : 46677073,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4365",
      "updated_at" : "2014-06-20T13:21:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46677073",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "Nits picked (removed unneeded test @laanwj found, fixed the sigop-counting unit test so it uses a 'realistic' Script) and rebased for the CMutableTransaction change.\r\n",
      "created_at" : "2014-06-23T19:13:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4365#issuecomment-46888582",
      "id" : 46888582,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4365",
      "updated_at" : "2014-06-23T19:13:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46888582",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/p4365_7f3b4e95695d50a4970e6eb91faa956ab276f161/ for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.",
      "created_at" : "2014-06-23T19:26:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4365#issuecomment-46890069",
      "id" : 46890069,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4365",
      "updated_at" : "2014-06-23T19:26:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46890069",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "body" : "ACK",
      "created_at" : "2014-06-23T19:38:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4365#issuecomment-46891377",
      "id" : 46891377,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4365",
      "updated_at" : "2014-06-23T19:38:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46891377",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "FYI, as @petertodd suggested, I added an index of the \"inner\" P2SH script types to bitcoin-ruby/webbtc, so you can see unusual p2sh scripts that are already spent:\r\nhttp://webbtc.com/p2sh_scripts/unknown",
      "created_at" : "2014-06-24T09:14:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4365#issuecomment-46948795",
      "id" : 46948795,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4365",
      "updated_at" : "2014-06-24T09:14:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46948795",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/168449?v=3",
         "events_url" : "https://api.github.com/users/mhanne/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mhanne/followers",
         "following_url" : "https://api.github.com/users/mhanne/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mhanne/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mhanne",
         "id" : 168449,
         "login" : "mhanne",
         "organizations_url" : "https://api.github.com/users/mhanne/orgs",
         "received_events_url" : "https://api.github.com/users/mhanne/received_events",
         "repos_url" : "https://api.github.com/users/mhanne/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mhanne/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mhanne/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mhanne"
      }
   }
]
