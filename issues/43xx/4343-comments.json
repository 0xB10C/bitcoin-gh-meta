[
   {
      "body" : "You are not correct that this is done before the rpcallowip check. The rpcallowip check is done immediately after the connection comes in in RPCAcceptHandler.\r\n\r\nNevertheless, see #4373.",
      "created_at" : "2014-06-20T13:32:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4343#issuecomment-46678019",
      "id" : 46678019,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4343",
      "updated_at" : "2014-06-20T13:32:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46678019",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Related bug:  we use C++'s getline(), which is of unbounded length.\r\n",
      "created_at" : "2014-06-20T14:29:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4343#issuecomment-46684206",
      "id" : 46684206,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4343",
      "updated_at" : "2014-06-20T14:29:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46684206",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "I see that in RPCAcceptHandler, I believe my test method was flawed for that claim. My mistake. ",
      "created_at" : "2014-06-20T14:40:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4343#issuecomment-46685530",
      "id" : 46685530,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4343",
      "updated_at" : "2014-06-20T14:40:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46685530",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/855009?v=3",
         "events_url" : "https://api.github.com/users/benburkhart1/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benburkhart1/followers",
         "following_url" : "https://api.github.com/users/benburkhart1/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benburkhart1/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benburkhart1",
         "id" : 855009,
         "login" : "benburkhart1",
         "organizations_url" : "https://api.github.com/users/benburkhart1/orgs",
         "received_events_url" : "https://api.github.com/users/benburkhart1/received_events",
         "repos_url" : "https://api.github.com/users/benburkhart1/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benburkhart1/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benburkhart1/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benburkhart1"
      }
   },
   {
      "body" : "I don't think it's worth trying to work around this in the current state. Preventing connection exhaustion attacks in a remotely sane way would need a complete overhaul of the RPC server.\r\n\r\nThe combination of boost::asio with getline() and stream.read() and friends is very strange to begin with. The HTTP(S) server should use async I/O all the way through, which would allow for setting timeouts for every connection phase. There are some HTTP server examples here: http://www.boost.org/doc/libs/1_55_0/doc/html/boost_asio/examples/cpp03_examples.html\r\n",
      "created_at" : "2014-06-20T15:09:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4343#issuecomment-46689071",
      "id" : 46689071,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4343",
      "updated_at" : "2014-06-20T15:11:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46689071",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj Agree 100%   I even prototyped a multi-threaded async I/O JSON-RPC server based on boost::asio here:  https://github.com/jgarzik/rpcsrv  It is a fully working JSON-RPC server skeleton.\r\n",
      "created_at" : "2014-06-20T15:11:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4343#issuecomment-46689310",
      "id" : 46689310,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4343",
      "updated_at" : "2014-06-20T15:11:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46689310",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "@jgarzik Cool! Any specific reason why that was never integrated?",
      "created_at" : "2014-06-20T15:13:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4343#issuecomment-46689553",
      "id" : 46689553,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4343",
      "updated_at" : "2014-06-20T15:13:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46689553",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj Just time.  Also, it's a lot of code for bitcoin, where a pure async I/O server might be more simple.\r\n\r\nboost::asio provides several HTTP server examples.  I took their M-T server example, and adapted it.  I can probably do the same for their async HTTP server example too.\r\n",
      "created_at" : "2014-06-20T15:16:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4343#issuecomment-46689876",
      "id" : 46689876,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4343",
      "updated_at" : "2014-06-20T15:16:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46689876",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "It's more code, sure, but the current rpcserver.cpp+rpcserver.h+rpcprotocol.cpp+rpcprotocol.h is also a lot of code, and less organized. It could be put in a subdir of src.\r\n\r\nAnd indeed a single-threaded asynchronous HTTP server would likely be enough for bitcoind's expected loads.\r\n\r\nWe'd still need a thread pool for the actual RPC command handling, but that can be completely separate from the HTTP server thread.\r\n",
      "created_at" : "2014-06-20T15:23:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4343#issuecomment-46690718",
      "id" : 46690718,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4343",
      "updated_at" : "2014-06-20T15:23:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46690718",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj hmmm, true.  My server does offer M-T execution as well as socket handling.  Maybe it is worth merging that one.  It's tested, working M-T JSON-RPC code after all.",
      "created_at" : "2014-06-20T16:37:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4343#issuecomment-46699409",
      "id" : 46699409,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4343",
      "updated_at" : "2014-06-20T16:37:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46699409",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "Yes, agreed.\r\n",
      "created_at" : "2014-06-21T10:16:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4343#issuecomment-46749703",
      "id" : 46749703,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4343",
      "updated_at" : "2014-06-21T10:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/46749703",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
