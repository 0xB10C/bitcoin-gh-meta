[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
      "created_at" : "2023-05-20T15:04:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27708#issuecomment-1555931428",
      "id" : 1555931428,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27708",
      "node_id" : "IC_kwDOABII585cvaEk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1555931428/reactions"
      },
      "updated_at" : "2023-05-20T15:04:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1555931428",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1205560303"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205560303"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could this just be a local static function in shutdown.cpp and not exposed in the header?",
      "commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "created_at" : "2023-05-25T13:56:07Z",
      "diff_hunk" : "@@ -19,6 +19,9 @@ bool InitShutdownState();\n /** Request shutdown of the application. */\n void StartShutdown();\n \n+/** Request application shutdown due an internal error. */\n+void StartErrorShutdown();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1205560303",
      "id" : 1205560303,
      "line" : 23,
      "node_id" : "PRRC_kwDOABII585H22Pv",
      "original_commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "original_line" : 23,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/shutdown.h",
      "position" : 5,
      "pull_request_review_id" : 1443959388,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205560303/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-25T15:13:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205560303",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1205561022"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205561022"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Does it make sense to add `[[nodiscard]]` here?",
      "commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "created_at" : "2023-05-25T13:56:40Z",
      "diff_hunk" : "@@ -29,7 +32,9 @@ bool ShutdownRequested();\n \n /** Wait for StartShutdown to be called in any thread. This can only be used\n  * from a single thread.\n+ * Returns true if shutdown was requested by the user. Otherwise, it's an\n+ * internally requested shutdown which only happens when an error arises.\n  */\n-void WaitForShutdown();\n+bool WaitForShutdown();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1205561022",
      "id" : 1205561022,
      "line" : 38,
      "node_id" : "PRRC_kwDOABII585H22a-",
      "original_commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "original_line" : 38,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/shutdown.h",
      "position" : 18,
      "pull_request_review_id" : 1443959388,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205561022/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-25T15:13:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205561022",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1205612087"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205612087"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This comment seems a bit inaccurate, e.g. we may have `stop_at_height` set, but shutdown is still triggered internally. There is also one error case in https://github.com/bitcoin/bitcoin/blob/master/src/node/blockstorage.cpp#L931 that triggers a normal shutdown.",
      "commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "created_at" : "2023-05-25T14:33:12Z",
      "diff_hunk" : "@@ -29,7 +32,9 @@ bool ShutdownRequested();\n \n /** Wait for StartShutdown to be called in any thread. This can only be used\n  * from a single thread.\n+ * Returns true if shutdown was requested by the user. Otherwise, it's an\n+ * internally requested shutdown which only happens when an error arises.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1205612087",
      "id" : 1205612087,
      "line" : 36,
      "node_id" : "PRRC_kwDOABII585H3C43",
      "original_commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "original_line" : 36,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/shutdown.h",
      "position" : 15,
      "pull_request_review_id" : 1443959388,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205612087/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-25T15:13:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205612087",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1206869341"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206869341"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The reason behind that is https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1199624849.\r\nBut.. could not expose it and move the caller to use `AbortNode()` instead. Same as we do with the external block import failures.\r\n\r\n",
      "commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "created_at" : "2023-05-26T14:26:09Z",
      "diff_hunk" : "@@ -19,6 +19,9 @@ bool InitShutdownState();\n /** Request shutdown of the application. */\n void StartShutdown();\n \n+/** Request application shutdown due an internal error. */\n+void StartErrorShutdown();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1206869341",
      "id" : 1206869341,
      "in_reply_to_id" : 1205560303,
      "line" : 23,
      "node_id" : "PRRC_kwDOABII585H711d",
      "original_commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "original_line" : 23,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/shutdown.h",
      "position" : 5,
      "pull_request_review_id" : 1446355484,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206869341/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-26T14:26:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206869341",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1206881682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206881682"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Still, in order to do that in the cleanest possible way, will need to refactor `shutdown.cpp`, so `AbortNode` is placed after the static `StartErrorShutdown` function. Which I'm not so sure that worth it due the conflicts that could cause with your PRs. Thoughts?",
      "commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "created_at" : "2023-05-26T14:34:17Z",
      "diff_hunk" : "@@ -19,6 +19,9 @@ bool InitShutdownState();\n /** Request shutdown of the application. */\n void StartShutdown();\n \n+/** Request application shutdown due an internal error. */\n+void StartErrorShutdown();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1206881682",
      "id" : 1206881682,
      "in_reply_to_id" : 1205560303,
      "line" : 23,
      "node_id" : "PRRC_kwDOABII585H742S",
      "original_commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "original_line" : 23,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/shutdown.h",
      "position" : 5,
      "pull_request_review_id" : 1446372379,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206881682/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-26T14:34:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206881682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1206916333"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206916333"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "So IIUC, this call [here](https://github.com/bitcoin/bitcoin/commit/ca3041984cf3665e27b6783c923ab1c32682500a#diff-b1e19192258d83199d8adaa5ac31f067af98f63554bfdd679bd8e8073815e69dR1669) would call `StartErrorShutdown`?",
      "commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "created_at" : "2023-05-26T14:58:44Z",
      "diff_hunk" : "@@ -19,6 +19,9 @@ bool InitShutdownState();\n /** Request shutdown of the application. */\n void StartShutdown();\n \n+/** Request application shutdown due an internal error. */\n+void StartErrorShutdown();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1206916333",
      "id" : 1206916333,
      "in_reply_to_id" : 1205560303,
      "line" : 23,
      "node_id" : "PRRC_kwDOABII585H8BTt",
      "original_commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "original_line" : 23,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/shutdown.h",
      "position" : 5,
      "pull_request_review_id" : 1446418102,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206916333/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-26T15:08:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206916333",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1206928091"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206928091"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah [here](https://github.com/bitcoin/bitcoin/commit/bc2315d86f13e6e15f681ecaf5efc9b33e6128a3#diff-b1e19192258d83199d8adaa5ac31f067af98f63554bfdd679bd8e8073815e69dR1675), I just rebased #27607 on top of this one.\r\n\r\nNo problem on using `AbortNode` there. Just would need to bubble up the indexes error so it can be provided to `AbortNode`. Which.. isn't bad as it will remove another `ui_interface` dependency.",
      "commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "created_at" : "2023-05-26T15:05:33Z",
      "diff_hunk" : "@@ -19,6 +19,9 @@ bool InitShutdownState();\n /** Request shutdown of the application. */\n void StartShutdown();\n \n+/** Request application shutdown due an internal error. */\n+void StartErrorShutdown();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1206928091",
      "id" : 1206928091,
      "in_reply_to_id" : 1205560303,
      "line" : 23,
      "node_id" : "PRRC_kwDOABII585H8ELb",
      "original_commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "original_line" : 23,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/shutdown.h",
      "position" : 5,
      "pull_request_review_id" : 1446440158,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206928091/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-26T15:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206928091",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1206967261"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206967261"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> This comment seems a bit inaccurate, e.g. we may have `stop_at_height` set, but shutdown is still triggered internally. There is also one error case in https://github.com/bitcoin/bitcoin/blob/master/src/node/blockstorage.cpp#L931 that triggers a normal shutdown.\r\n\r\nI would label `stop_at_height` as an action requested by the user. The user had to provide `-stopatheight` at startup so the shutdown is expected.\r\n\r\nOn the other hand, https://github.com/bitcoin/bitcoin/blob/master/src/node/blockstorage.cpp#L931 seems to be a good candidate for `AbortNode`. It's a error in the `ThreadImport`, so either the db data got modified in some wrong way or the user provided invalid external blocks.",
      "commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "created_at" : "2023-05-26T15:33:47Z",
      "diff_hunk" : "@@ -29,7 +32,9 @@ bool ShutdownRequested();\n \n /** Wait for StartShutdown to be called in any thread. This can only be used\n  * from a single thread.\n+ * Returns true if shutdown was requested by the user. Otherwise, it's an\n+ * internally requested shutdown which only happens when an error arises.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1206967261",
      "id" : 1206967261,
      "in_reply_to_id" : 1205612087,
      "line" : 36,
      "node_id" : "PRRC_kwDOABII585H8Nvd",
      "original_commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "original_line" : 36,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/shutdown.h",
      "position" : 15,
      "pull_request_review_id" : 1446487768,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206967261/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-26T15:33:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206967261",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1206969917"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206969917"
         }
      },
      "author_association" : "MEMBER",
      "body" : "sure",
      "commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "created_at" : "2023-05-26T15:35:51Z",
      "diff_hunk" : "@@ -29,7 +32,9 @@ bool ShutdownRequested();\n \n /** Wait for StartShutdown to be called in any thread. This can only be used\n  * from a single thread.\n+ * Returns true if shutdown was requested by the user. Otherwise, it's an\n+ * internally requested shutdown which only happens when an error arises.\n  */\n-void WaitForShutdown();\n+bool WaitForShutdown();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1206969917",
      "id" : 1206969917,
      "in_reply_to_id" : 1205561022,
      "line" : 38,
      "node_id" : "PRRC_kwDOABII585H8OY9",
      "original_commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "original_line" : 38,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/shutdown.h",
      "position" : 18,
      "pull_request_review_id" : 1446491982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206969917/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-26T15:35:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206969917",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1207346355"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1207346355"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Which.. isn't bad as it will remove another ui_interface dependency.\r\n\r\nCan you elaborate on this point? `AbortNode` still relies on `ui_interface` from what I can tell. \r\n\r\nFrom my current understanding both the `StartShutdown` in `ThreadImport` and in the check are call shutdown and node `AbortNode`, because `BlockImport` might run before the ui is available (this is me guessing out of historical reasons). I am not sold on this point though, since this runs in another thread and we also provide the noui consumer of the ui interface. So I think these should both become calls to `AbortNode`.",
      "commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "created_at" : "2023-05-26T21:03:31Z",
      "diff_hunk" : "@@ -19,6 +19,9 @@ bool InitShutdownState();\n /** Request shutdown of the application. */\n void StartShutdown();\n \n+/** Request application shutdown due an internal error. */\n+void StartErrorShutdown();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1207346355",
      "id" : 1207346355,
      "in_reply_to_id" : 1205560303,
      "line" : 23,
      "node_id" : "PRRC_kwDOABII585H9qSz",
      "original_commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "original_line" : 23,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/shutdown.h",
      "position" : 5,
      "pull_request_review_id" : 1446966193,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1207346355/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-26T21:03:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1207346355",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1207406938"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1207406938"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> > Which.. isn't bad as it will remove another ui_interface dependency.\r\n> \r\n> Can you elaborate on this point? `AbortNode` still relies on `ui_interface` from what I can tell.\r\n\r\nOk, I confused you. Sorry.\r\n\r\nThe ui_interface dependency that can be removed is the `base.cpp` one. Thus why said to \"bubble up\" the error string up to `init.cpp` instead of calling `InitError` from the index base class `Start` method.\r\n\r\n> From my current understanding both the `StartShutdown` in `ThreadImport` and in the check are call shutdown and node `AbortNode`, because `BlockImport` might run before the ui is available (this is me guessing out of historical reasons).\r\n\r\n`AbortNode` isn't doing anything special. We already use `InitError` in `init.cpp` prior spawning the import thread.\r\nWhat the node will do when there is no gui is print the error to the command line, and the debug file, prior shutting down (using the noui consumer as you said).\r\n\r\n> I am not sold on this point though, since this runs in another thread and we also provide the noui consumer of the ui interface. So I think these should both become calls to `AbortNode`.\r\n\r\nYeah, that is my idea as well. The `ThreadImport` \"fatal\" failures should use `AbortNode`.",
      "commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "created_at" : "2023-05-26T21:52:02Z",
      "diff_hunk" : "@@ -19,6 +19,9 @@ bool InitShutdownState();\n /** Request shutdown of the application. */\n void StartShutdown();\n \n+/** Request application shutdown due an internal error. */\n+void StartErrorShutdown();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27708#discussion_r1207406938",
      "id" : 1207406938,
      "in_reply_to_id" : 1205560303,
      "line" : 23,
      "node_id" : "PRRC_kwDOABII585H95Fa",
      "original_commit_id" : "c4e32eb72cae62eff510692a8df08181a2202a9d",
      "original_line" : 23,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/shutdown.h",
      "position" : 5,
      "pull_request_review_id" : 1447004254,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27708",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1207406938/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-26T21:52:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1207406938",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   }
]
