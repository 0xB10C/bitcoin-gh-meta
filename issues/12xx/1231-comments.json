[
   {
      "body" : "You are misunderstanding what that code does.\r\n\r\nCan you give a series of RPC commands that shows the bug?  setaccount associates a bitcoin address with an account, it we removed the \"Detect when changing...\" code as you suggest then you get situations where one address is associated with TWO accounts, which is wrong.\r\n",
      "created_at" : "2012-05-09T13:20:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1231#issuecomment-5599793",
      "id" : 5599793,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1231",
      "updated_at" : "2012-05-09T13:20:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5599793",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "Here's series of actions to demonstrate the problem:\r\n\r\n1. Create address: http://vvcap.net/db/ig2jMMXnX1MTPybtAFM7.htp\r\n2. Now the customer paid for the item, and we want to rename account: http://vvcap.net/db/FKIoM_-Rvt4LXqBcp9a1.htp\r\n3. We get this: http://vvcap.net/db/go58vwdQsVlfVXqxz2N3.htp . This is the EXPECTED behavior, the one I want to reproduce using XMLRPC.\r\n4. I rename account back: http://vvcap.net/db/NthP4EtVkOgKaOhpkCQj.htp\r\n5. Now I do the same thing using bitcoind, which uses same xlmrpc: http://vvcap.net/db/kxooAA7LiRhaa0ktxOBF.htp\r\n6. EXPECTED: old address is replaced with \"----> 02. Customer Actually Paid\" and not kept anywhere else in the address book\r\n\r\nOn 3.x versions, after that command, I have been getting address renamed, but \"----> 01...\" one relocated to a new. Same behavior I saw on another client, which I downloaded ~ 20-ish April 2012. I think it was 0.6.1, but maybe 0.6.0. According to the timestamps 0.6.1 didn't exist at this time, so maybe I'm imagining things. I did not take screenshots, and cannot reproduce it anymore.\r\n\r\nI retested now on all 0.6 versions and following are results:\r\n\r\n0.6.0 does not rename at all\r\n0.6.1 and 0.6.2 work as expected\r\n\r\nso I guess the bug is fixed. I have no idea why did I see that problem previously but not now. Since problem is not reproducibnle, I am closing the bug I guess.\r\n",
      "created_at" : "2012-05-11T02:18:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1231#issuecomment-5642077",
      "id" : 5642077,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1231",
      "updated_at" : "2012-05-11T02:21:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5642077",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1588731?v=3",
         "events_url" : "https://api.github.com/users/sgaltsev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sgaltsev/followers",
         "following_url" : "https://api.github.com/users/sgaltsev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sgaltsev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sgaltsev",
         "id" : 1588731,
         "login" : "sgaltsev",
         "organizations_url" : "https://api.github.com/users/sgaltsev/orgs",
         "received_events_url" : "https://api.github.com/users/sgaltsev/received_events",
         "repos_url" : "https://api.github.com/users/sgaltsev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sgaltsev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sgaltsev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sgaltsev"
      }
   },
   {
      "body" : "\r\n\r\nOkay, I reproduced the problem. I was apparently renaming outgoing address, when bug is affecting receiving address. Here's how it goes:\r\n\r\n1. Start position: http://vvcap.net/db/MUThlEUsdjSUl1uhdqaW.htp\r\n2. Rename using daemon: http://vvcap.net/db/vWiLAQcDBlZc-recHldI.htp\r\n3. Get this: http://vvcap.net/db/9KAeMv31O700xXl91mqx.htp\r\n\r\nSo, instead of renaming the address, setaccount relocated label to another address.\r\n\r\nClient version is here:  http://vvcap.net/db/8SgEs2t3RfMcJ_jD7UlM.htp\r\n",
      "created_at" : "2012-05-11T02:28:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1231#issuecomment-5642541",
      "id" : 5642541,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1231",
      "updated_at" : "2012-05-11T02:29:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5642541",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1588731?v=3",
         "events_url" : "https://api.github.com/users/sgaltsev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sgaltsev/followers",
         "following_url" : "https://api.github.com/users/sgaltsev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sgaltsev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sgaltsev",
         "id" : 1588731,
         "login" : "sgaltsev",
         "organizations_url" : "https://api.github.com/users/sgaltsev/orgs",
         "received_events_url" : "https://api.github.com/users/sgaltsev/received_events",
         "repos_url" : "https://api.github.com/users/sgaltsev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sgaltsev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sgaltsev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sgaltsev"
      }
   },
   {
      "body" : "not \"instead\", btw.\nAs I see on [3] Ã¢ÂÂ it renamed addres fine, but *also* (not instead) it moved \"----> 1\" to another one (does it? doesn't you?)\n\nBtw, I remember something like that on very-very-very old bitcoin-qt releases, when it created new addresses every time I tried to rename existing, but than @laanwj fixed this.\n\nSo, I guess, it is GUI-related bug (like it was on bitcoin-qt before moving it to main tree).",
      "created_at" : "2012-05-12T23:03:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1231#issuecomment-5672596",
      "id" : 5672596,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1231",
      "updated_at" : "2012-05-12T23:03:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5672596",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/268102?v=3",
         "events_url" : "https://api.github.com/users/msva/events{/privacy}",
         "followers_url" : "https://api.github.com/users/msva/followers",
         "following_url" : "https://api.github.com/users/msva/following{/other_user}",
         "gists_url" : "https://api.github.com/users/msva/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/msva",
         "id" : 268102,
         "login" : "msva",
         "organizations_url" : "https://api.github.com/users/msva/orgs",
         "received_events_url" : "https://api.github.com/users/msva/received_events",
         "repos_url" : "https://api.github.com/users/msva/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/msva/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/msva/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/msva"
      }
   },
   {
      "body" : "@msva You are right. What I was trying to say is that expected behavior is that account gets renamed and nothing else. Instead of that account gets renamed AND an old label gets relocated. The code that does it is located in RPC, at function `Value setaccount(const Array& params, bool fHelp)`, so it affects both GUI and daemon, and I saw this code in every incarnation of bitcoin client RPC.\n\nWhat makes this bug extra annoying is that essentially it makes impossible to get rid of the label once it is in the database, unless you use GUI.\n\nIs it possible to get this addressed anytime soon? I'm so tired of having to recompile client every time a new version comes out.",
      "created_at" : "2012-05-29T17:33:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1231#issuecomment-5990161",
      "id" : 5990161,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1231",
      "updated_at" : "2012-05-29T17:35:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5990161",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1588731?v=3",
         "events_url" : "https://api.github.com/users/sgaltsev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sgaltsev/followers",
         "following_url" : "https://api.github.com/users/sgaltsev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sgaltsev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sgaltsev",
         "id" : 1588731,
         "login" : "sgaltsev",
         "organizations_url" : "https://api.github.com/users/sgaltsev/orgs",
         "received_events_url" : "https://api.github.com/users/sgaltsev/received_events",
         "repos_url" : "https://api.github.com/users/sgaltsev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sgaltsev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sgaltsev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sgaltsev"
      }
   },
   {
      "body" : "@msva, that bug was related to the \"default address\" (vchDefault). Indeed, the default address is no longer used or updated when QT_GUI is set.\n\nThe problem here is that the \"account system\" is slightly different from the UI labels. It doesn't allow removing all addresses from an account, which is intended behavior not a bug. We cannot change this as programs might be relying on this.\n\nMaybe there should be a command to delete an account and move all its addresses to the \"\" label.\n",
      "created_at" : "2012-06-13T16:05:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1231#issuecomment-6305302",
      "id" : 6305302,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1231",
      "updated_at" : "2012-06-13T16:05:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/6305302",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "We're not going to touch the accounts for the foreseeable future.\r\nIt is not even sure if the future wallet implementation will have such a feature at all.\r\nIf you want anything else than the current state, it is recommended to build your own ledger system on top.",
      "created_at" : "2014-01-10T12:20:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1231#issuecomment-32023149",
      "id" : 32023149,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1231",
      "updated_at" : "2014-01-10T12:20:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/32023149",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
