[
   {
      "author_association" : "MEMBER",
      "body" : "Currently based on some other commits, which probably should be reviewed and merged first.\r\n\r\n* #13783",
      "created_at" : "2018-07-30T14:50:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13804#issuecomment-408890871",
      "id" : 408890871,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13804",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwODg5MDg3MQ==",
      "updated_at" : "2018-09-10T16:53:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/408890871",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->Note to reviewers: This pull request conflicts with the following ones:\n\n* #14226 (mempool: Fix unintended unsigned integer wraparound in CTxMemPool::UpdateAncestorsOf(bool add, Ã¢ÂÂ¦) when add is false by practicalswift)\n* #14224 (Document intentional and unintentional unsigned integer overflows (wraparounds) using annotations by practicalswift)\n* #14193 (validation: Add missing mempool locks by MarcoFalke)\n* #13949 (Introduce MempoolObserver interface to break \"policy/fees -> txmempool -> policy/fees\" circular dependency by Empact)\n* #13922 (Lower default relay fees by ajtowns)\n* #13864 (validation: Document where we are intentionally ignoring bool return values from validation related functions by practicalswift)\n* #13189 (Remove 2nd mapTx lookup in CTxMemPool::removeForBlock by promag)\n* #11652 (Add missing locks: validation.cpp + related by practicalswift)\n* #11535 (Avoid unintentional unsigned integer wraparounds by practicalswift)\n* #10443 (Add fee_est tool for debugging fee estimation code by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-07-30T17:42:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13804#issuecomment-408949300",
      "id" : 408949300,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13804",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwODk0OTMwMA==",
      "updated_at" : "2018-09-26T02:26:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/408949300",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r206541409"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/206541409"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit \"Stacked Transaction Pool\"\r\n\r\nnit, add space after `,`.",
      "commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "created_at" : "2018-07-31T14:05:34Z",
      "diff_hunk" : "@@ -23,6 +23,6 @@ bool SignalsOptInRBF(const CTransaction &tx);\n // according to BIP 125\n // This involves checking sequence numbers of the transaction, as well\n // as the sequence numbers of all in-mempool ancestors.\n-RBFTransactionState IsRBFOptIn(const CTransaction &tx, CTxMemPool &pool) EXCLUSIVE_LOCKS_REQUIRED(pool.cs);\n+RBFTransactionState IsRBFOptIn(const CTransaction &tx,const CTxMemPool &pool) EXCLUSIVE_LOCKS_REQUIRED(pool.cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r206541409",
      "id" : 206541409,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNjU0MTQwOQ==",
      "original_commit_id" : "fa7a9de343c689b8c6a83da8a014a825076f7583",
      "original_position" : 5,
      "path" : "src/policy/rbf.h",
      "position" : null,
      "pull_request_review_id" : 141971067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804",
      "updated_at" : "2018-09-19T20:34:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/206541409",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r206541787"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/206541787"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit \"Stacked Transaction Pool\"\r\n\r\nnit, remove extra spaces.",
      "commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "created_at" : "2018-07-31T14:06:36Z",
      "diff_hunk" : "@@ -289,19 +332,27 @@ void CTxMemPool::UpdateForRemoveFromMempool(const setEntries &entriesToRemove, b\n         // differ from the set of mempool parents we'd calculate by searching,\n         // and it's important that we use the mapLinks[] notion of ancestor\n         // transactions as the set of things to update for removal.\n-        CalculateMemPoolAncestors(removeIt, setAncestors, nNoLimit, nNoLimit, nNoLimit, nNoLimit, dummy);\n+        pool.CalculateMemPoolAncestors(removeIt, setAncestors, nNoLimit, nNoLimit, nNoLimit, nNoLimit, dummy);\n         // Note that UpdateAncestorsOf severs the child links that point to\n         // removeIt in the entries for the parents of removeIt.\n-        UpdateAncestorsOf(false, removeIt, setAncestors);\n+        pool.UpdateAncestorsOf(false, removeIt, setAncestors);\n     }\n     // After updating all the ancestor sizes, we can now sever the link between each\n     // transaction being removed and any mempool children (ie, update setMemPoolParents\n     // for each direct child of a transaction being removed).\n-    for (txiter removeIt : entriesToRemove) {\n-        UpdateChildrenForRemoval(removeIt);\n+    for (const auto& removeIt : entriesToRemove) {\n+        pool.UpdateChildrenForRemoval(removeIt);\n     }\n }\n+void CTxMemPool::UpdateForRemoveFromMempool(const setEntries& entriesToRemove, bool updateDescendants)\n+{\n+    return ::UpdateForRemoveFromMempool(*this, entriesToRemove, updateDescendants);\n+}\n \n+void CTxMemPool::Layer::  UpdateForRemoveFromMempool(const setEntries&entriesToRemove, bool updateDescendants)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r206541787",
      "id" : 206541787,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNjU0MTc4Nw==",
      "original_commit_id" : "fa7a9de343c689b8c6a83da8a014a825076f7583",
      "original_position" : 239,
      "path" : "src/txmempool.cpp",
      "position" : 235,
      "pull_request_review_id" : 141971067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804",
      "updated_at" : "2018-09-19T20:34:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/206541787",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r217764910"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217764910"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ownerless expression?",
      "commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "created_at" : "2018-09-14T16:10:01Z",
      "diff_hunk" : "@@ -865,38 +993,96 @@ const CTransaction* CTxMemPool::GetConflictTx(const COutPoint& prevout) const\n     return it == mapNextTx.end() ? nullptr : it->second;\n }\n \n+const CTransaction* CTxMemPool::Layer::GetConflictTx(const COutPoint& prevout) const\n+{\n+    auto it_add = m_map_next_tx_added.find(prevout);\n+    if (it_add != m_map_next_tx_added.end()) return it_add->second;\n+    if (m_map_next_tx_removed.find(prevout) != m_map_next_tx_removed.end()) return nullptr;\n+\n+    return m_tx_pool.GetConflictTx(prevout);\n+}\n+\n boost::optional<CTxMemPool::txiter> CTxMemPool::GetIter(const uint256& txid) const\n {\n     auto it = mapTx.find(txid);\n     if (it != mapTx.end()) return it;\n     return boost::optional<txiter>{};\n }\n \n-CTxMemPool::setEntries CTxMemPool::GetIterSet(const std::set<uint256>& hashes) const\n+boost::optional<CTxMemPool::Layer::txiter> CTxMemPool::Layer::GetIter(const uint256& txid) const\n {\n-    CTxMemPool::setEntries ret;\n+    const auto& it_cache = m_cache_added.find(txid);\n+    if (it_cache != m_cache_added.end()) {\n+        CTxMemPool::Layer::txiter{it_cache};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r217764910",
      "id" : 217764910,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNzc2NDkxMA==",
      "original_commit_id" : "7bbdcd3a04470c5c4ab6ef7d946a29d7504f7b16",
      "original_position" : 521,
      "path" : "src/txmempool.cpp",
      "position" : 521,
      "pull_request_review_id" : 155563229,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804",
      "updated_at" : "2018-09-19T20:34:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217764910",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This PR fails to compile with thread safety analysis enabled when rebased on `master`.",
      "created_at" : "2018-09-17T10:06:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13804#issuecomment-421953374",
      "id" : 421953374,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13804",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMTk1MzM3NA==",
      "updated_at" : "2018-09-17T10:06:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/421953374",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@practicalswift I think clang doesn't understand \"recursive\" annotations. I am happy to be proven wrong, but I think this just doesn't compile with annotations for now.",
      "created_at" : "2018-09-17T23:01:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13804#issuecomment-422199222",
      "id" : 422199222,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13804",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMjE5OTIyMg==",
      "updated_at" : "2018-09-17T23:01:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/422199222",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r219691487"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691487"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n2018-09-22 21:49:48 cpplint(pr=13804): src/txmempool.h:579:  You don't need a ; after a }  [readability/braces] [4]\r\n```",
      "commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "created_at" : "2018-09-23T08:11:32Z",
      "diff_hunk" : "@@ -575,6 +575,9 @@ class CTxMemPool\n     /** Translate a set of hashes into a set of pool iterators to avoid repeated lookups */\n     setEntries GetIterSet(const std::set<uint256>& hashes) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n+    /** Dereference the txiter */\n+    static const CTxMemPoolEntry& GetEntry(txiter it) { return *it; };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r219691487",
      "id" : 219691487,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTY5MTQ4Nw==",
      "original_commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "original_position" : 57,
      "path" : "src/txmempool.h",
      "position" : 57,
      "pull_request_review_id" : 157932097,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804",
      "updated_at" : "2018-09-23T08:11:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691487",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r219691495"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691495"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n2018-09-22 21:49:48 cpplint(pr=13804): src/txmempool.h:729:  You don't need a ; after a }  [readability/braces] [4]\r\n```",
      "commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "created_at" : "2018-09-23T08:11:54Z",
      "diff_hunk" : "@@ -699,6 +713,115 @@ class CTxMemPool\n      *  removal.\n      */\n     void removeUnchecked(txiter entry, MemPoolRemovalReason reason = MemPoolRemovalReason::UNKNOWN) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+\n+public:\n+    class Layer\n+    {\n+    public:\n+        /**\n+         * The lock of the underlying tx pool.\n+         * The caller must acquire this lock for the whole life-time of this layer.\n+         */\n+        CCriticalSection& cs;\n+\n+        struct txiter_nested {\n+            CTxMemPool::txiter _i;\n+            explicit txiter_nested(CTxMemPool::txiter val) : _i(val){};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r219691495",
      "id" : 219691495,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTY5MTQ5NQ==",
      "original_commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "original_position" : 154,
      "path" : "src/txmempool.h",
      "position" : 154,
      "pull_request_review_id" : 157932105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804",
      "updated_at" : "2018-09-23T08:11:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691495",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r219691499"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691499"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n2018-09-22 21:49:48 cpplint(pr=13804): src/txmempool.h:730:  You don't need a ; after a }  [readability/braces] [4]\r\n```",
      "commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "created_at" : "2018-09-23T08:12:10Z",
      "diff_hunk" : "@@ -699,6 +713,115 @@ class CTxMemPool\n      *  removal.\n      */\n     void removeUnchecked(txiter entry, MemPoolRemovalReason reason = MemPoolRemovalReason::UNKNOWN) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+\n+public:\n+    class Layer\n+    {\n+    public:\n+        /**\n+         * The lock of the underlying tx pool.\n+         * The caller must acquire this lock for the whole life-time of this layer.\n+         */\n+        CCriticalSection& cs;\n+\n+        struct txiter_nested {\n+            CTxMemPool::txiter _i;\n+            explicit txiter_nested(CTxMemPool::txiter val) : _i(val){};\n+            txiter_nested() : _i(){};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r219691499",
      "id" : 219691499,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTY5MTQ5OQ==",
      "original_commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "original_position" : 155,
      "path" : "src/txmempool.h",
      "position" : 155,
      "pull_request_review_id" : 157932107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804",
      "updated_at" : "2018-09-23T08:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691499",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r219691511"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691511"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n2018-09-22 21:49:48 cpplint(pr=13804): src/txmempool.h:759:  Single-parameter constructors should be marked explicit.  [runtime/explicit] [5]\r\n```",
      "commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "created_at" : "2018-09-23T08:12:36Z",
      "diff_hunk" : "@@ -699,6 +713,115 @@ class CTxMemPool\n      *  removal.\n      */\n     void removeUnchecked(txiter entry, MemPoolRemovalReason reason = MemPoolRemovalReason::UNKNOWN) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+\n+public:\n+    class Layer\n+    {\n+    public:\n+        /**\n+         * The lock of the underlying tx pool.\n+         * The caller must acquire this lock for the whole life-time of this layer.\n+         */\n+        CCriticalSection& cs;\n+\n+        struct txiter_nested {\n+            CTxMemPool::txiter _i;\n+            explicit txiter_nested(CTxMemPool::txiter val) : _i(val){};\n+            txiter_nested() : _i(){};\n+        };\n+        /**\n+         * The txiter of this layer is a pair.\n+         * The first element is a const iterator of this layer's m_cache_added,\n+         * the second element is a fallback to the underlying txiter (only present when first is missing)\n+         */\n+        using txiter = boost::variant<\n+            txiter_nested, // Can always use this one, since all entries might be created in the cache??\n+            CTxMemPool::txiter>;\n+\n+        struct CompareIteratorByHash {\n+            bool operator()(const txiter& a, const txiter& b) const\n+            {\n+                return GetEntry(a).GetTx().GetHash() < GetEntry(b).GetTx().GetHash();\n+            }\n+        };\n+\n+        using setEntries = std::set<CTxMemPool::Layer::txiter, CompareIteratorByHash>;\n+\n+        struct TxLinks {\n+            CTxMemPool::Layer::setEntries parents;\n+            CTxMemPool::Layer::setEntries children;\n+        };\n+        using txlinksMap = std::map<CTxMemPool::Layer::txiter, CTxMemPool::Layer::TxLinks, CompareIteratorByHash>;\n+        /**\n+         * Construct a Layer based on an existing tx pool.\n+         * The caller must acquire the lock for the whole life-time of this layer.\n+         */\n+        Layer(const CTxMemPool& p) EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r219691511",
      "id" : 219691511,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTY5MTUxMQ==",
      "original_commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "original_position" : 184,
      "path" : "src/txmempool.h",
      "position" : 184,
      "pull_request_review_id" : 157932121,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804",
      "updated_at" : "2018-09-23T08:12:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691511",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r219691518"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691518"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n2018-09-22 21:49:48 cpplint(pr=13804): src/txmempool.h:808:  Do not leave a blank line after \"private:\"  [whitespace/blank_line] [3]\r\n```",
      "commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "created_at" : "2018-09-23T08:13:02Z",
      "diff_hunk" : "@@ -699,6 +713,115 @@ class CTxMemPool\n      *  removal.\n      */\n     void removeUnchecked(txiter entry, MemPoolRemovalReason reason = MemPoolRemovalReason::UNKNOWN) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+\n+public:\n+    class Layer\n+    {\n+    public:\n+        /**\n+         * The lock of the underlying tx pool.\n+         * The caller must acquire this lock for the whole life-time of this layer.\n+         */\n+        CCriticalSection& cs;\n+\n+        struct txiter_nested {\n+            CTxMemPool::txiter _i;\n+            explicit txiter_nested(CTxMemPool::txiter val) : _i(val){};\n+            txiter_nested() : _i(){};\n+        };\n+        /**\n+         * The txiter of this layer is a pair.\n+         * The first element is a const iterator of this layer's m_cache_added,\n+         * the second element is a fallback to the underlying txiter (only present when first is missing)\n+         */\n+        using txiter = boost::variant<\n+            txiter_nested, // Can always use this one, since all entries might be created in the cache??\n+            CTxMemPool::txiter>;\n+\n+        struct CompareIteratorByHash {\n+            bool operator()(const txiter& a, const txiter& b) const\n+            {\n+                return GetEntry(a).GetTx().GetHash() < GetEntry(b).GetTx().GetHash();\n+            }\n+        };\n+\n+        using setEntries = std::set<CTxMemPool::Layer::txiter, CompareIteratorByHash>;\n+\n+        struct TxLinks {\n+            CTxMemPool::Layer::setEntries parents;\n+            CTxMemPool::Layer::setEntries children;\n+        };\n+        using txlinksMap = std::map<CTxMemPool::Layer::txiter, CTxMemPool::Layer::TxLinks, CompareIteratorByHash>;\n+        /**\n+         * Construct a Layer based on an existing tx pool.\n+         * The caller must acquire the lock for the whole life-time of this layer.\n+         */\n+        Layer(const CTxMemPool& p) EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs)\n+            : cs(p.cs), m_tx_pool(p) {}\n+\n+        /// Methods that have identical signatures in the underlying tx pool:\n+        bool exists(const uint256& hash) const EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs);\n+        boost::optional<txiter> GetIter(const uint256& txid) const EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs);\n+        CTxMemPool::Layer::setEntries GetIterSet(const std::set<uint256>& hashes) const EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs);\n+        template <typename UpdateStruct>\n+        void Modify(txiter it, const UpdateStruct& update_object);\n+        std::pair<txiter, bool> Insert(const CTxMemPoolEntry& entry) EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs)\n+        {\n+            auto ins = m_cache_added.insert(entry);\n+            assert(ins.second);\n+            return {txiter_nested{ins.first}, ins.second};\n+        }\n+        void EraseTx(CTxMemPool::Layer::txiter it) EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs);\n+        void InsertLinks(txiter newit) EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs) { m_cache_map_links.emplace(newit, TxLinks{}); }\n+        void EraseLinks(txiter it) EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs) { m_cache_map_links.erase(it); }\n+        void InsertNextTx(std::pair<const COutPoint*, const CTransaction*> next_tx) EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs) { m_map_next_tx_added.insert(next_tx); }\n+        void EraseNextTx(const COutPoint& out) EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs)\n+        {\n+            m_map_next_tx_added.erase(out);\n+            m_map_next_tx_removed.emplace(out);\n+        }\n+        static const CTxMemPoolEntry& GetEntry(const CTxMemPool::Layer::txiter& it);\n+        const CTransaction* GetConflictTx(const COutPoint& prevout) const EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs);\n+        CTransactionRef get(const uint256& hash) const EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs);\n+        void ApplyDelta(const uint256& hash, CAmount& fee_delta) const EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs);\n+        CFeeRate GetMinFee(size_t sizelimit) const EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs);\n+        bool CalculateMemPoolAncestors(txiter it, CTxMemPool::Layer::setEntries& setAncestors, uint64_t limitAncestorCount, uint64_t limitAncestorSize, uint64_t limitDescendantCount, uint64_t limitDescendantSize, std::string& errString, const CTxMemPoolEntry* search_parents_for_entry = nullptr) EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs);\n+        void CalculateDescendants(const CTxMemPool::Layer::txiter& it, CTxMemPool::Layer::setEntries& setDescendants) EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs);\n+        void RemoveStaged(CTxMemPool::Layer::setEntries& stage, bool updateDescendants, MemPoolRemovalReason reason = MemPoolRemovalReason::UNKNOWN) EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs);\n+        bool HasNoInputsOf(const CTransaction& tx) const EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs);\n+        void addUnchecked(const CTxMemPoolEntry& entry, bool /* validFeeEstimate */ ignore) EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs);\n+        CTxMemPool::Layer::setEntries GetMemPoolParents(const CTxMemPool::Layer::txiter& entry) const EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs);\n+        int Expire(int64_t time) EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs);\n+        void TrimToSize(size_t sizelimit, std::vector<COutPoint>* pvNoSpendsRemaining = nullptr) EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs);\n+\n+        void addUnchecked(const CTxMemPoolEntry& entry, const CTxMemPool::Layer::setEntries& setAncestors, bool /* validFeeEstimate */ ignore) EXCLUSIVE_LOCKS_REQUIRED(m_tx_pool.cs);\n+        void UpdateAncestorsOf(bool add, const CTxMemPool::Layer::txiter& it, const setEntries& setAncestors);\n+        void UpdateParent(const CTxMemPool::Layer::txiter& entry, const CTxMemPool::Layer::txiter& parent, bool add);\n+        void UpdateChild(const CTxMemPool::Layer::txiter& entry, const CTxMemPool::Layer::txiter& child, bool add);\n+        void UpdateEntryForAncestors(const CTxMemPool::Layer::txiter& it, const setEntries& setAncestors);\n+        void UpdateForRemoveFromMempool(const setEntries& entriesToRemove, bool updateDescendants);\n+        void UpdateChildrenForRemoval(txiter it);\n+        const setEntries& GetMemPoolChildren(txiter entry) const;\n+        void removeUnchecked(txiter it, MemPoolRemovalReason reason);\n+\n+    private:\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r219691518",
      "id" : 219691518,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTY5MTUxOA==",
      "original_commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "original_position" : 233,
      "path" : "src/txmempool.h",
      "position" : 233,
      "pull_request_review_id" : 157932128,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804",
      "updated_at" : "2018-09-23T08:13:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691518",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r220428297"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220428297"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Use an unnamed parameter instead of `ignore`.",
      "commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "created_at" : "2018-09-26T05:13:09Z",
      "diff_hunk" : "@@ -389,26 +438,52 @@ void CTxMemPool::addUnchecked(const CTxMemPoolEntry &entry, setEntries &setAnces\n     // to clean up the mess we're leaving here.\n \n     // Update ancestors with information about this tx\n-    for (const auto& pit : GetIterSet(setParentTransactions)) {\n-            UpdateParent(newit, pit, true);\n+    for (const auto& pit : pool.GetIterSet(setParentTransactions)) {\n+        pool.UpdateParent(newit, pit, true);\n     }\n-    UpdateAncestorsOf(true, newit, setAncestors);\n-    UpdateEntryForAncestors(newit, setAncestors);\n+    pool.UpdateAncestorsOf(true, newit, setAncestors);\n+    pool.UpdateEntryForAncestors(newit, setAncestors);\n+\n+    return newit;\n+}\n+\n+void CTxMemPool::addUnchecked(const CTxMemPoolEntry& entry, const setEntries& setAncestors, bool validFeeEstimate)\n+{\n+    NotifyEntryAdded(entry.GetSharedTx());\n+\n+    cachedInnerUsage += entry.DynamicMemoryUsage();\n+\n+    txiter newit = ::addUnchecked(*this, entry, setAncestors);\n \n     nTransactionsUpdated++;\n     totalTxSize += entry.GetTxSize();\n-    if (minerPolicyEstimator) {minerPolicyEstimator->processTransaction(entry, validFeeEstimate);}\n+    if (minerPolicyEstimator) {\n+        minerPolicyEstimator->processTransaction(entry, validFeeEstimate);\n+    }\n \n-    vTxHashes.emplace_back(tx.GetWitnessHash(), newit);\n+    vTxHashes.emplace_back(entry.GetTx().GetWitnessHash(), newit);\n     newit->vTxHashesIdx = vTxHashes.size() - 1;\n }\n \n+void CTxMemPool::Layer::addUnchecked(const CTxMemPoolEntry& entry, const CTxMemPool::Layer::setEntries& setAncestors, bool /* validFeeEstimate */ ignore)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r220428297",
      "id" : 220428297,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDQyODI5Nw==",
      "original_commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "original_position" : 321,
      "path" : "src/txmempool.cpp",
      "position" : 321,
      "pull_request_review_id" : 158833472,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804",
      "updated_at" : "2018-09-26T05:13:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220428297",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r220428346"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220428346"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Make `MemPoolRemovalReason` an unnamed parameter.",
      "commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "created_at" : "2018-09-26T05:13:35Z",
      "diff_hunk" : "@@ -389,26 +438,52 @@ void CTxMemPool::addUnchecked(const CTxMemPoolEntry &entry, setEntries &setAnces\n     // to clean up the mess we're leaving here.\n \n     // Update ancestors with information about this tx\n-    for (const auto& pit : GetIterSet(setParentTransactions)) {\n-            UpdateParent(newit, pit, true);\n+    for (const auto& pit : pool.GetIterSet(setParentTransactions)) {\n+        pool.UpdateParent(newit, pit, true);\n     }\n-    UpdateAncestorsOf(true, newit, setAncestors);\n-    UpdateEntryForAncestors(newit, setAncestors);\n+    pool.UpdateAncestorsOf(true, newit, setAncestors);\n+    pool.UpdateEntryForAncestors(newit, setAncestors);\n+\n+    return newit;\n+}\n+\n+void CTxMemPool::addUnchecked(const CTxMemPoolEntry& entry, const setEntries& setAncestors, bool validFeeEstimate)\n+{\n+    NotifyEntryAdded(entry.GetSharedTx());\n+\n+    cachedInnerUsage += entry.DynamicMemoryUsage();\n+\n+    txiter newit = ::addUnchecked(*this, entry, setAncestors);\n \n     nTransactionsUpdated++;\n     totalTxSize += entry.GetTxSize();\n-    if (minerPolicyEstimator) {minerPolicyEstimator->processTransaction(entry, validFeeEstimate);}\n+    if (minerPolicyEstimator) {\n+        minerPolicyEstimator->processTransaction(entry, validFeeEstimate);\n+    }\n \n-    vTxHashes.emplace_back(tx.GetWitnessHash(), newit);\n+    vTxHashes.emplace_back(entry.GetTx().GetWitnessHash(), newit);\n     newit->vTxHashesIdx = vTxHashes.size() - 1;\n }\n \n+void CTxMemPool::Layer::addUnchecked(const CTxMemPoolEntry& entry, const CTxMemPool::Layer::setEntries& setAncestors, bool /* validFeeEstimate */ ignore)\n+{\n+    ::addUnchecked(*this, entry, setAncestors);\n+}\n+\n+template <typename P>\n+static void removeUnchecked(P& pool, typename P::txiter it, MemPoolRemovalReason reason)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r220428346",
      "id" : 220428346,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDQyODM0Ng==",
      "original_commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "original_position" : 327,
      "path" : "src/txmempool.cpp",
      "position" : 327,
      "pull_request_review_id" : 158833527,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804",
      "updated_at" : "2018-09-26T05:13:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220428346",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r220428475"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220428475"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This code will never get executed.",
      "commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "created_at" : "2018-09-26T05:14:43Z",
      "diff_hunk" : "@@ -804,6 +898,17 @@ CTransactionRef CTxMemPool::get(const uint256& hash) const\n     return i->GetSharedTx();\n }\n \n+CTransactionRef CTxMemPool::Layer::get(const uint256& hash) const\n+{\n+    auto it = m_cache_added.find(hash);\n+    if (it == m_cache_added.end())\n+        return nullptr;\n+    else\n+        return it->GetSharedTx();\n+    if (m_cache_removed.find(hash) != m_cache_removed.end()) return nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r220428475",
      "id" : 220428475,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDQyODQ3NQ==",
      "original_commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "original_position" : 442,
      "path" : "src/txmempool.cpp",
      "position" : 442,
      "pull_request_review_id" : 158833691,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804",
      "updated_at" : "2018-09-26T05:14:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220428475",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r220428612"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220428612"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Make `time` an unnamed parameter.",
      "commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "created_at" : "2018-09-26T05:15:49Z",
      "diff_hunk" : "@@ -937,14 +1136,31 @@ int CTxMemPool::Expire(int64_t time) {\n     RemoveStaged(stage, false, MemPoolRemovalReason::EXPIRY);\n     return stage.size();\n }\n+int CTxMemPool::Layer::Expire(int64_t time)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r220428612",
      "id" : 220428612,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDQyODYxMg==",
      "original_commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "original_position" : 644,
      "path" : "src/txmempool.cpp",
      "position" : 644,
      "pull_request_review_id" : 158833848,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804",
      "updated_at" : "2018-09-26T05:15:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220428612",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r220428663"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220428663"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Make `sizelimit` and `pvNoSpendsRemaining` unnamed parameters.",
      "commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "created_at" : "2018-09-26T05:16:18Z",
      "diff_hunk" : "@@ -1058,6 +1316,13 @@ void CTxMemPool::TrimToSize(size_t sizelimit, std::vector<COutPoint>* pvNoSpends\n     }\n }\n \n+void CTxMemPool::Layer::TrimToSize(size_t sizelimit, std::vector<COutPoint>* pvNoSpendsRemaining)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13804#discussion_r220428663",
      "id" : 220428663,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDQyODY2Mw==",
      "original_commit_id" : "554c3b8592a007f3776e260d6ad4b4a6511b30d7",
      "original_position" : 757,
      "path" : "src/txmempool.cpp",
      "position" : 757,
      "pull_request_review_id" : 158833928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13804",
      "updated_at" : "2018-09-26T05:16:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220428663",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
