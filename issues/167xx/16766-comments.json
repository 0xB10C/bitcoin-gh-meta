[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I added a cache which works per call/across calls, but does not store the results semi-permanently.\r\n\r\nThis should reduce DoS risk of this change.\r\n\r\nThere is no risk of _untrusted_ parents causing a resource exploitation, as we immediately return once that is detected.",
      "created_at" : "2019-08-30T20:37:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-526741579",
      "id" : 526741579,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNjc0MTU3OQ==",
      "updated_at" : "2019-08-30T20:37:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/526741579",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#15931](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15931.html) (Remove GetDepthInMainChain dependency on locked chain interface by ariard)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-08-30T22:33:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-526769063",
      "id" : 526769063,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNjc2OTA2Mw==",
      "updated_at" : "2019-08-30T22:33:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/526769063",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> If a parent is not trusted, then a child should not be either.\r\n\r\nWould be nice to have a test for this or update the `wallet_balance.py` script in case it is already tested there. (`wallet_balance.py` is failing)",
      "created_at" : "2019-09-03T15:48:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-527518660",
      "id" : 527518660,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNzUxODY2MA==",
      "updated_at" : "2019-09-03T15:48:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/527518660",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I updated the tests to pass.\r\n\r\nIn the test, we  have two nodes with a balance of 50 each and then:\r\n\r\nSend 40 from node A to node B.\r\nSend 60 from node B to node A.\r\n\r\nThen we would check the balances.\r\n\r\nPreviously, we would immediately report a balance of 30 on node B as unconfirmed and trusted.\r\n\r\nNow, we show that balance as unconfirmed.\r\n\r\nThe balance is indeed \"trusted\" and \"confirmed\" insofar as removing the mempool transactions would return *at least* that much money. But the current software marks it as unconfirmed because the 'taint' tracking of transaction trust for summing balances doesn't consider which inputs belong to a user.\r\n\r\nI think the new behavior is correct; we shouldn't be treating those funds as confirmed. If you want to *rely* on that specific UTXO existing which has given you that balance, you cannot, as a third party spending the other input would destroy that unconfirmed.\r\n\r\nOverall I think that this points to a general concept worth exploring as a revision to the categories \"unconfirmed\" and \"confirmed\", to have \"free cash\", \"locked\", and \"unconfirmed\". Free cash can be spent at will, locked funds are balances that are guaranteed to exist but we don't have a confirmed UTXO for yet, and unconfirmed are funds we may or may not receive. I think this is out of scope of this PR though, but is worth further thought.",
      "created_at" : "2019-09-03T17:42:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#issuecomment-527563982",
      "id" : 527563982,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNzU2Mzk4Mg==",
      "updated_at" : "2019-09-03T17:42:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/527563982",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r320435215"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/320435215"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            assert_equal(self.nodes[1].getbalance(), Decimal('0'))  # node 1's send had an unsafe input\r\n```",
      "commit_id" : "bee1dc9f8a5182f03979fa066dc7937fc945bf29",
      "created_at" : "2019-09-03T19:16:39Z",
      "diff_hunk" : "@@ -112,10 +112,10 @@ def run_test(self):\n         def test_balances(*, fee_node_1=0):\n             # getbalance without any arguments includes unconfirmed transactions, but not untrusted transactions\n             assert_equal(self.nodes[0].getbalance(), Decimal('9.99'))  # change from node 0's send\n-            assert_equal(self.nodes[1].getbalance(), Decimal('30') - fee_node_1)  # change from node 1's send\n+            assert_equal(self.nodes[1].getbalance(), Decimal('0'))  # change from node 1's send",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16766#discussion_r320435215",
      "id" : 320435215,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyMDQzNTIxNQ==",
      "original_commit_id" : "bee1dc9f8a5182f03979fa066dc7937fc945bf29",
      "original_position" : 5,
      "path" : "test/functional/wallet_balance.py",
      "position" : 5,
      "pull_request_review_id" : 283206185,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16766",
      "updated_at" : "2019-09-03T19:17:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/320435215",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
