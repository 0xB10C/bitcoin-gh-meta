[
   {
      "author_association" : "MEMBER",
      "body" : "cr ACK fc471814dc34abb4d5479803ebb1033b572eda43",
      "created_at" : "2022-02-28T07:34:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24449#issuecomment-1053969495",
      "id" : 1053969495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24449",
      "node_id" : "IC_kwDOABII584-0kxX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1053969495/reactions"
      },
      "updated_at" : "2022-02-28T07:34:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1053969495",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Just to confirm, there are no steps to reproduce?",
      "created_at" : "2022-02-28T08:05:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24449#issuecomment-1053990159",
      "id" : 1053990159,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24449",
      "node_id" : "IC_kwDOABII584-0p0P",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1053990159/reactions"
      },
      "updated_at" : "2022-02-28T08:05:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1053990159",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "No steps to reproduce. My earlier comment was wrong, this shouldn't change any of the seeds since triggering an overflow of a `int64_t` at steps with maximum size of 4096 is infeasible.",
      "created_at" : "2022-02-28T14:11:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24449#issuecomment-1054296796",
      "id" : 1054296796,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24449",
      "node_id" : "IC_kwDOABII584-10rc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1054296796/reactions"
      },
      "updated_at" : "2022-02-28T14:11:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1054296796",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> On another note, I noticed that FuzzedFileProvider::seek has some confusing behavior with SEEK_END. It seems to me that if these handlers are supposed to mimic the real functions, that SEEK_END would use the offset from the end of the stream, rather than changing the offset with a random value between 0 and 4096. I could also open a PR to fix SEEK_END, but it would invalidate the seeds.\r\n\r\nI wonder if this is related to https://bugs.chromium.org/p/oss-fuzz/issues/list?q=FuzzedFileProvider&can=2",
      "created_at" : "2022-02-28T14:23:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24449#issuecomment-1054308101",
      "id" : 1054308101,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24449",
      "node_id" : "IC_kwDOABII584-13cF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1054308101/reactions"
      },
      "updated_at" : "2022-02-28T14:23:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1054308101",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "That is what I was trying to figure out, but didn't finish setting up oss-fuzz. I think FuzzedFileProvider would have to track the end of the filestream",
      "created_at" : "2022-02-28T15:31:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24449#issuecomment-1054375598",
      "id" : 1054375598,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24449",
      "node_id" : "IC_kwDOABII584-2H6u",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1054375598/reactions"
      },
      "updated_at" : "2022-02-28T15:31:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1054375598",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Not sure what the right place to post this is, but posting here. It seems that the offset value under ASAN+i386 is converted to a 32-bit pointer that's passed into `FuzzedFileProvider::seek` and that is the reason for the crash. I modified the `autofile` harness to only call `(void)fseek(file, 12, SEEK_CUR);` and exit. Here `file` is one created from `fopencookie` and the fuzzed file provider. This was the result:\r\n```\r\nAddressSanitizer:DEADLYSIGNAL\r\n=================================================================\r\n==12==ERROR: AddressSanitizer: SEGV on unknown address 0x0000000c (pc 0x583fa6d4 bp 0xff8722e8 sp 0xff872240 T0)\r\n==12==The signal is caused by a READ memory access.\r\n==12==Hint: address points to the zero page.\r\nSCARINESS: 10 (null-deref)\r\n    #0 0x583fa6d4 in FuzzedFileProvider::seek(void*, long long*, int) /src/bitcoin-core/src/test/fuzz/util.cpp:621:39\r\n    #1 0x56be7d99 in wrapped_seek(void*, unsigned long long*, int) /src/llvm-project/compiler-rt/lib/asan/../sanitizer_common/sanitizer_common_interceptors.inc:6454:22\r\n    #2 0xf7cde492  (/lib32/libc.so.6+0x141492)\r\n    #3 0xf7c14999 in _IO_file_seekoff (/lib32/libc.so.6+0x77999)\r\n    #4 0xf7c10bc8 in fseek (/lib32/libc.so.6+0x73bc8)\r\n    #5 0x56cc20ac in autofile_fuzz_target(Span<unsigned char const>) /src/bitcoin-core/src/test/fuzz/autofile.cpp:25:11\r\n    #6 0x56c716f6 in __invoke<void (*&)(Span<const unsigned char>), Span<const unsigned char> > /usr/local/bin/../include/c++/v1/type_traits:3663:23\r\n    #7 0x56c716f6 in __call<void (*&)(Span<const unsigned char>), Span<const unsigned char> > /usr/local/bin/../include/c++/v1/__functional/invoke.h:61:9\r\n    #8 0x56c716f6 in operator() /usr/local/bin/../include/c++/v1/__functional/function.h:172:16\r\n    #9 0x56c716f6 in std::__1::__function::__func<void (*)(Span<unsigned char const>), std::__1::allocator<void (*)(Span<unsigned char const>)>, void (Span<unsigned char const>)>::operator()(Span<unsigned char const>&&) /usr/local/bin/../include/c++/v1/__functional/function.h:346:12\r\n    #10 0x583dca19 in operator() /usr/local/bin/../include/c++/v1/__functional/function.h:499:16\r\n    #11 0x583dca19 in operator() /usr/local/bin/../include/c++/v1/__functional/function.h:1176:12\r\n    #12 0x583dca19 in LLVMFuzzerTestOneInput /src/bitcoin-core/src/test/fuzz/fuzz.cpp:119:5\r\n    #13 0x56b3fc6d in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned int) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:611:15\r\n    #14 0x56b40f66 in fuzzer::Fuzzer::ReadAndExecuteSeedCorpora(std::__Fuzzer::vector<fuzzer::SizedFile, std::__Fuzzer::allocator<fuzzer::SizedFile> >&) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:804:3\r\n    #15 0x56b4140e in fuzzer::Fuzzer::Loop(std::__Fuzzer::vector<fuzzer::SizedFile, std::__Fuzzer::allocator<fuzzer::SizedFile> >&) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:857:3\r\n    #16 0x56b30c6d in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned int)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:912:6\r\n    #17 0x56b59a67 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10\r\n    #18 0xf7bb7ee4 in __libc_start_main (/lib32/libc.so.6+0x1aee4)\r\n    #19 0x56b09114 in _start (/out/autofile+0x59b114)\r\n\r\nDEDUP_TOKEN: FuzzedFileProvider::seek(void*, long long*, int)--wrapped_seek(void*, unsigned long long*, int)--\r\nAddressSanitizer can not provide additional info.\r\nSUMMARY: AddressSanitizer: SEGV /src/bitcoin-core/src/test/fuzz/util.cpp:621:39 in FuzzedFileProvider::seek(void*, long long*, int)\r\n==12==ABORTING\r\nMS: 0 ; base unit: 0000000000000000000000000000000000000000\r\n```\r\nSince 0xc = 12, this leads me to believe my above statement. This also makes me think this is the reason why the crashes I've observed without modifying `autofile` were in the high `0xffff....` range (small negative number converted to 32-bit pointer). This seems to either be:\r\n- a problem with ASAN's fopencookie wrapper which calls wrapped_seek\r\n- a problem with bitcoind's build for ASAN + i386",
      "created_at" : "2022-03-22T13:10:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24449#issuecomment-1075161245",
      "id" : 1075161245,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24449",
      "node_id" : "IC_kwDOABII585AFaid",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1075161245/reactions"
      },
      "updated_at" : "2022-03-22T13:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1075161245",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Interesting. I wonder where this happens, as the reproducer is 8KB, so it seems to only happen after some \"state\" is accumulated.",
      "created_at" : "2022-03-22T14:22:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24449#issuecomment-1075246553",
      "id" : 1075246553,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24449",
      "node_id" : "IC_kwDOABII585AFvXZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1075246553/reactions"
      },
      "updated_at" : "2022-03-22T14:22:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1075246553",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
