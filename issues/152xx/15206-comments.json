[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14046](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14046.html) (net: Refactor message parsing (CNetMessage), adds flexibility by jonasschnelli)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-01-18T22:37:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-455710529",
      "id" : 455710529,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NTcxMDUyOQ==",
      "updated_at" : "2019-04-01T17:19:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455710529",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2019-01-19T16:29:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-455794363",
      "id" : 455794363,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NTc5NDM2Mw==",
      "updated_at" : "2019-01-19T16:29:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455794363",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't the deferred processing matters-- the checkvalue is protecting against network corruption not malicious input or anything like that, but I also don't think that doing it eagerly is harmful either.\r\n\r\nOne consequence of this is that it moves more processing into the networking thread, rather than leaving it in the message processing thread. As a result it may result in lower performance in cases where hashing was a bottleneck, but I'm doubtful the slowdown will matter much anywhere.",
      "created_at" : "2019-01-19T17:42:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-455800025",
      "id" : 455800025,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NTgwMDAyNQ==",
      "updated_at" : "2019-01-19T17:42:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455800025",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@gmaxwell It actually doesn't change much, as the message hash is being computed on the fly as the message packets come in. The `GetMessageHash` call only does the SHA256 finalization.\r\n",
      "created_at" : "2019-01-19T17:46:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-455800330",
      "id" : 455800330,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NTgwMDMzMA==",
      "updated_at" : "2019-01-19T17:46:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455800330",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa I was aware, but for many messages (e.g. small ones) the finalization is the hashing.",
      "created_at" : "2019-01-19T18:07:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-455802157",
      "id" : 455802157,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NTgwMjE1Nw==",
      "updated_at" : "2019-01-19T18:07:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455802157",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "\"The checksum check happens after deserialising all messages in the current read buffer.\" <-- No, this has not been the case since #9045. We hash as we receive data, only the *finalization* (ie last compression round and second hash) happen after we've received the full message. Don't really have a strong feeling about this, it does move a tiny big of CPU cost over to the net thread from net_processing, which is nice, though.",
      "created_at" : "2019-01-19T21:37:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-455817419",
      "id" : 455817419,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NTgxNzQxOQ==",
      "updated_at" : "2019-01-19T21:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455817419",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@TheBlueMatt: thanks for the clarification.\r\n\r\nThe intention of this PR is mainly to move the transportation protocol out of the message processing... and slowly moves towards a `CNetMessage` that is transport logic agnostic. With something like BIP150, we will have a different checksum (Poly1305 in the case of BIP151) and a different header. \r\n\r\nI think `CNetMessage` should at one point only carry the payload and the command (and eventually the recv. time). The serialisation as well as optional encryption/decryption plus the checksum should happen outside of `CNetMessage`.",
      "created_at" : "2019-01-20T06:11:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-455840885",
      "id" : 455840885,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NTg0MDg4NQ==",
      "updated_at" : "2019-01-20T06:11:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455840885",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r250249824"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250249824"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Suggest adding \", disconnecting\" to this message, consistent with the other disconnection scenario in `CNode::ReceiveMsgBytes`.",
      "commit_id" : "e7ab7d71a985526a9335edb52089e675a6a4a878",
      "created_at" : "2019-01-23T15:43:49Z",
      "diff_hunk" : "@@ -859,6 +859,18 @@ int CNetMessage::readData(const char *pch, unsigned int nBytes)\n     memcpy(&vRecv[nDataPos], pch, nCopy);\n     nDataPos += nCopy;\n \n+    if (complete()) {\n+        const uint256& hash = GetMessageHash();\n+        if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0)\n+        {\n+            LogPrint(BCLog::NET, \"%s(%s, %u bytes): CHECKSUM ERROR expected %s was %s\\n\", __func__,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r250249824",
      "id" : 250249824,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDI0OTgyNA==",
      "original_commit_id" : "2bf4bf76e6718992b085e7f02e9bad4628093b7d",
      "original_position" : 8,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 195590667,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "updated_at" : "2019-01-31T19:44:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250249824",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r250250631"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250250631"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I see that `CNode::ReceiveMsgBytes` returns `false` if `readData` doesn't return `0`, and that in turn `CConnman::SocketHandler()` calls `pnode->CloseSocketDisconnect()` if that returned `false`. This feels a bit brittle though, but maybe that's just because I'm not super familiar with this part of the codebase. ",
      "commit_id" : "e7ab7d71a985526a9335edb52089e675a6a4a878",
      "created_at" : "2019-01-23T15:45:41Z",
      "diff_hunk" : "@@ -859,6 +859,18 @@ int CNetMessage::readData(const char *pch, unsigned int nBytes)\n     memcpy(&vRecv[nDataPos], pch, nCopy);\n     nDataPos += nCopy;\n \n+    if (complete()) {\n+        const uint256& hash = GetMessageHash();\n+        if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0)\n+        {\n+            LogPrint(BCLog::NET, \"%s(%s, %u bytes): CHECKSUM ERROR expected %s was %s\\n\", __func__,\n+               SanitizeString(hdr.pchCommand), hdr.nMessageSize,\n+               HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n+               HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n+            return -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r250250631",
      "id" : 250250631,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDI1MDYzMQ==",
      "original_commit_id" : "2bf4bf76e6718992b085e7f02e9bad4628093b7d",
      "original_position" : 12,
      "path" : "src/net.cpp",
      "position" : 12,
      "pull_request_review_id" : 195590667,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "updated_at" : "2019-01-31T19:44:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250250631",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r250745459"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250745459"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's the same path of closing a connection then if a remote peer would send an oversize message (or an invalid header that can't be deserialized). I think it's acceptable,",
      "commit_id" : "e7ab7d71a985526a9335edb52089e675a6a4a878",
      "created_at" : "2019-01-24T19:26:56Z",
      "diff_hunk" : "@@ -859,6 +859,18 @@ int CNetMessage::readData(const char *pch, unsigned int nBytes)\n     memcpy(&vRecv[nDataPos], pch, nCopy);\n     nDataPos += nCopy;\n \n+    if (complete()) {\n+        const uint256& hash = GetMessageHash();\n+        if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0)\n+        {\n+            LogPrint(BCLog::NET, \"%s(%s, %u bytes): CHECKSUM ERROR expected %s was %s\\n\", __func__,\n+               SanitizeString(hdr.pchCommand), hdr.nMessageSize,\n+               HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n+               HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n+            return -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r250745459",
      "id" : 250745459,
      "in_reply_to_id" : 250250631,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDc0NTQ1OQ==",
      "original_commit_id" : "2bf4bf76e6718992b085e7f02e9bad4628093b7d",
      "original_position" : 12,
      "path" : "src/net.cpp",
      "position" : 12,
      "pull_request_review_id" : 196208909,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "updated_at" : "2019-01-31T19:44:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250745459",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r250748337"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250748337"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "e7ab7d71a985526a9335edb52089e675a6a4a878",
      "created_at" : "2019-01-24T19:34:34Z",
      "diff_hunk" : "@@ -859,6 +859,18 @@ int CNetMessage::readData(const char *pch, unsigned int nBytes)\n     memcpy(&vRecv[nDataPos], pch, nCopy);\n     nDataPos += nCopy;\n \n+    if (complete()) {\n+        const uint256& hash = GetMessageHash();\n+        if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0)\n+        {\n+            LogPrint(BCLog::NET, \"%s(%s, %u bytes): CHECKSUM ERROR expected %s was %s\\n\", __func__,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#discussion_r250748337",
      "id" : 250748337,
      "in_reply_to_id" : 250249824,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDc0ODMzNw==",
      "original_commit_id" : "2bf4bf76e6718992b085e7f02e9bad4628093b7d",
      "original_position" : 8,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 196212521,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15206",
      "updated_at" : "2019-01-31T19:44:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250748337",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Needs rebase (for sanity checking against the merged 36aeb43c01d250d99cfffdfbb70d2420b70054cc)",
      "created_at" : "2019-01-31T15:43:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-459392053",
      "id" : 459392053,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1OTM5MjA1Mw==",
      "updated_at" : "2019-01-31T15:43:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/459392053",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased (required for now merged #15246).\r\nAdapted test.",
      "created_at" : "2019-01-31T19:45:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-459479966",
      "id" : 459479966,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1OTQ3OTk2Ng==",
      "updated_at" : "2019-01-31T19:45:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/459479966",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "`p2p_invalid_messages.py` test passes on macOS 10.14.3 for the newly rebased e7ab7d7. It [failed](https://travis-ci.org/bitcoin/bitcoin/jobs/487103354) on one of the Travis machines though.",
      "created_at" : "2019-02-01T10:20:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-459675325",
      "id" : 459675325,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1OTY3NTMyNQ==",
      "updated_at" : "2019-02-01T10:20:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/459675325",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> p2p_invalid_messages.py test passes on macOS 10.14.3 for the newly rebased e7ab7d7. It failed on one of the Travis machines though.\r\n\r\nIndeed. I think it is because of the immediate termination of the connection which somehow confuses `mininode`'s getdata. I'll investigate.",
      "created_at" : "2019-02-01T23:48:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-459907144",
      "id" : 459907144,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1OTkwNzE0NA==",
      "updated_at" : "2019-02-01T23:48:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/459907144",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Should we also worry about this breaking networking for nodes behind idiot firewalls that corrupt certain strings?   We know they exist because they occasionally cause nodes to be unable to fetch certain blocks and other such sillyness.  Right now if the stupidity that triggers them is in an ephemeral message (like a ping, inv, or an addr message) it'll just get dropped, logged, and move on.",
      "created_at" : "2019-02-03T04:56:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-460023239",
      "id" : 460023239,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MDAyMzIzOQ==",
      "updated_at" : "2019-02-03T21:11:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/460023239",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I always wondered. Would the checksum could just be skipped at all?\r\n\r\nIf I understand what is being said here, the only reason for having the checksum is so people have a clearer message in logs if the message get corrupted by firewall?",
      "created_at" : "2019-02-03T05:37:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-460024940",
      "id" : 460024940,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MDAyNDk0MA==",
      "updated_at" : "2019-02-03T05:37:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/460024940",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@NicolasDorier  It could be but it would generally be a bad idea, because then nodes would operate with silent corruption in some cases. In particular, a common failure mode (relatively speaking) is for firewalls rewrite addresses and port numbers, corrupting version handshakes and addr messages.  It was more of a concern before we started relaxing banning behaviour, but even without that, no one should have to waste countless hours troubleshooting a really dumb issue like a non-transparent firewall.  Doubly so because protocol conformance requires encoding it anyways.\r\n\r\n(plus, there is simply no reason to do so, the time they take is essentially negligible compared to other activities, and if we wanted to reduce it the authentication in the encrypted transport is faster (and thoroughly not optional)...)",
      "created_at" : "2019-02-03T19:57:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15206#issuecomment-460082894",
      "id" : 460082894,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15206",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MDA4Mjg5NA==",
      "updated_at" : "2019-02-03T19:57:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/460082894",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   }
]
