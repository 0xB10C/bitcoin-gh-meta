[
   {
      "author_association" : "MEMBER",
      "body" : "Obviously this will fail tests and need docs fixed up. I'll do that unless there are NACKs.",
      "created_at" : "2021-12-10T09:08:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23731#issuecomment-990757338",
      "id" : 990757338,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23731",
      "node_id" : "IC_kwDOABII5847DcHa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990757338/reactions"
      },
      "updated_at" : "2021-12-10T09:08:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990757338",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "(un?) related: According to https://transactionfee.info/charts/inputs-types-by-count/ about 80% of spends today are using the witness stack.",
      "created_at" : "2021-12-10T11:05:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23731#issuecomment-990875381",
      "id" : 990875381,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23731",
      "node_id" : "IC_kwDOABII5847D471",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990875381/reactions"
      },
      "updated_at" : "2021-12-10T11:05:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990875381",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Light concept ACK\r\n\r\nTalking about potential privacy loss, isn't the main concern here to consider how hard it is to deduce which one is the change output? (https://en.bitcoin.it/wiki/Privacy#Change_address_detection)\r\nFor the mentioned special scenario \"p2sh-witness as address type and there are no bech32(m) outputs.\" and a simple spend to a P2SH(-wrapped) destination:\r\n- On master, the change address is also P2SH(-wrapped) -> Perfect, both outputs are equally likely to be change.\r\n- On the PR branch, the change address is bech32(m). Is this slightly worse? (Or even better, as analyzers assume the change address type usually matches the input type and would wrongly deduce that the bech32(m) output is actually the destination?)\r\n\r\nJust thinking out loud, would be very interested to hear comments about this.",
      "created_at" : "2021-12-14T00:11:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23731#issuecomment-993026569",
      "id" : 993026569,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23731",
      "node_id" : "IC_kwDOABII5847MGIJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/993026569/reactions"
      },
      "updated_at" : "2021-12-14T00:11:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/993026569",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> On master, the change address is also P2SH(-wrapped) -> Perfect, both outputs are equally likely to be change.\r\n\r\nNot sure this is necessarily true. If the payment is unwrapped to be non-witness and our change is unwrapped to be witness (which is likely because ~80% of all spends are using the witness stack and also P2SH seems to be exclusively used for wrapping a witness program), then this can be combined with other leaks to determine the change address.\r\n\r\n> On the PR branch, the change address is bech32(m). Is this slightly worse? (Or even better, as analyzers assume the change address type usually matches the input type and would wrongly deduce that the bech32(m) output is actually the destination?)\r\n\r\nAs you say it might be slightly worse or slightly better, depending on the context. After all those are heuristics.\r\n\r\n",
      "created_at" : "2021-12-14T07:46:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23731#issuecomment-993246664",
      "id" : 993246664,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23731",
      "node_id" : "IC_kwDOABII5847M73I",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/993246664/reactions"
      },
      "updated_at" : "2021-12-14T07:46:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/993246664",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "An alternative approach I could think of would be to treat a wallet that can provide bech32m addresses as a taproot wallet. A wallet that can provide bech32 as a wpkh wallet.\r\n\r\n```py\r\nif tx_has_any_tr_output and wallet_has_tr:\r\n return bech32m\r\nif tx_has_any_wpkh and wallet_has_wpkh:\r\n return bech32\r\nif wallet_has_tr:\r\n return bech32m\r\nif wallet_has_wpkh:\r\n return bech32\r\n```\r\n\r\nObviously this will break again once we add output script descriptor support for v2 witness programs.\r\n\r\nHappy to implement this nonetheless if reviewers think it is useful.\r\n\r\n",
      "created_at" : "2021-12-14T07:54:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23731#issuecomment-993251510",
      "id" : 993251510,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23731",
      "node_id" : "IC_kwDOABII5847M9C2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/993251510/reactions"
      },
      "updated_at" : "2021-12-14T07:54:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/993251510",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
