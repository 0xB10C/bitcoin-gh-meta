[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23720#discussion_r765797782"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23720"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765797782"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's a bit of a shame that this wraps based on a global counter. Perhaps:\r\n\r\n```suggestion\r\n                assert self.counter < 256 ** 2  # Don't allow the returned ip addresses to wrap.\r\n                addr.ip = f\"123.123.{self.counter // 256}.{self.counter % 256}\"\r\n```",
      "commit_id" : "f8ff552aa05686d5b08c9b03bb798804039b738d",
      "created_at" : "2021-12-09T13:40:48Z",
      "diff_hunk" : "@@ -91,13 +91,16 @@ def run_test(self):\n         self.blocksonly_mode_tests()\n         self.rate_limit_tests()\n \n-    def setup_addr_msg(self, num):\n+    def setup_addr_msg(self, num, deterministic_ips=True):\n         addrs = []\n         for i in range(num):\n             addr = CAddress()\n-            addr.time = self.mocktime + i\n+            addr.time = self.mocktime + random.randrange(-100, 100)\n             addr.nServices = P2P_SERVICES\n-            addr.ip = f\"123.123.123.{self.counter % 256}\"\n+            if deterministic_ips:\n+                addr.ip = f\"123.123.123.{self.counter % 256}\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23720#discussion_r765797782",
      "id" : 765797782,
      "line" : 101,
      "node_id" : "PRRC_kwDOABII584tpSWW",
      "original_commit_id" : "f8ff552aa05686d5b08c9b03bb798804039b738d",
      "original_line" : 101,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "test/functional/p2p_addr_relay.py",
      "position" : 14,
      "pull_request_review_id" : 827694191,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23720",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765797782/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-09T14:21:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765797782",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23720#discussion_r765798374"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23720"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765798374"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: to bikeshed, I'd suggest calling this parameter `sequential_ips`, since even the \"random\" ips are deterministic based on the random seed set at the start of the test.",
      "commit_id" : "f8ff552aa05686d5b08c9b03bb798804039b738d",
      "created_at" : "2021-12-09T13:41:30Z",
      "diff_hunk" : "@@ -91,13 +91,16 @@ def run_test(self):\n         self.blocksonly_mode_tests()\n         self.rate_limit_tests()\n \n-    def setup_addr_msg(self, num):\n+    def setup_addr_msg(self, num, deterministic_ips=True):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23720#discussion_r765798374",
      "id" : 765798374,
      "line" : 94,
      "node_id" : "PRRC_kwDOABII584tpSfm",
      "original_commit_id" : "f8ff552aa05686d5b08c9b03bb798804039b738d",
      "original_line" : 94,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/p2p_addr_relay.py",
      "position" : 5,
      "pull_request_review_id" : 827694191,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23720",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765798374/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-09T14:21:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765798374",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23720#discussion_r765834760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23720"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765834760"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is a bit of a magic number. Perhaps it's worth a comment?\r\n\r\n```diff\r\ndiff --git a/test/functional/p2p_addr_relay.py b/test/functional/p2p_addr_relay.py\r\nindex 5f75670739..1502038b2d 100755\r\n--- a/test/functional/p2p_addr_relay.py\r\n+++ b/test/functional/p2p_addr_relay.py\r\n@@ -272,6 +272,10 @@ class AddrTest(BitcoinTestFramework):\r\n         block_relay_peer.send_and_ping(msg_getaddr())\r\n         inbound_peer.send_and_ping(msg_getaddr())\r\n \r\n+        # `addr` messages are sent on an exponential distribution with mean interval\r\n+        # of 30s. Setting the mocktime 600s forward and waiting for 60s for the\r\n+        # addr message gives a probability of (1 - e^-(660/30)) that the event will\r\n+        # occur (i.e. this fails less than one in 3 billion repeats).\r\n         self.mocktime += 10 * 60\r\n         self.nodes[0].setmocktime(self.mocktime)\r\n         inbound_peer.wait_until(lambda: inbound_peer.addr_received() is True)\r\n```\r\n\r\nIncidentally, I don't like the name `PoissonNextSend` since people often refer to it incorrectly as a \"Poisson distribution\", whereas it is in fact an _exponential distribution_, which gives the probability distribution of the time between events in a _Poisson point process_ (https://en.wikipedia.org/wiki/Exponential_distribution).",
      "commit_id" : "f8ff552aa05686d5b08c9b03bb798804039b738d",
      "created_at" : "2021-12-09T14:21:29Z",
      "diff_hunk" : "@@ -282,7 +272,7 @@ def getaddr_tests(self):\n         block_relay_peer.send_and_ping(msg_getaddr())\n         inbound_peer.send_and_ping(msg_getaddr())\n \n-        self.mocktime += 5 * 60\n+        self.mocktime += 10 * 60",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23720#discussion_r765834760",
      "id" : 765834760,
      "line" : 275,
      "node_id" : "PRRC_kwDOABII584tpbYI",
      "original_commit_id" : "f8ff552aa05686d5b08c9b03bb798804039b738d",
      "original_line" : 275,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "test/functional/p2p_addr_relay.py",
      "position" : 45,
      "pull_request_review_id" : 827694191,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23720",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765834760/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-09T14:21:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765834760",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
