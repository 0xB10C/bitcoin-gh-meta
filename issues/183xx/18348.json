{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "**Expected behavior**\r\nI should be able to make the depends without an error.\r\n\r\n**Actual behavior**\r\nThe program extracts BDB, preprocesses BDB, and configures BDB (I think), then goes into a long list of \"checking\" lines (e.g. `checking for fopen... yes`).\r\n\r\nThe output shows `checking for clock_gettime monotonic clock...` then the error message below pops up (`The code execution cannot proceed because libwinpthread-1.dll was not found. Reinstalling the program may fix this problem.`)\r\n\r\n![image](https://user-images.githubusercontent.com/30005204/76664418-14010400-6563-11ea-9025-715f0968d9c9.png)\r\n\r\nI click okay and it outputs `no` for `checking for clock_gettime monotonic clock...`. The program continues running the checks and seems to finish building the depends normally.  I can then do the following:\r\n```\r\ncd ..\r\n./autogen.sh\r\nCONFIG_SITE=$PWD/depends/x86_64-w64-mingw32/share/config.site ./configure --prefix=/\r\nmake\r\n```\r\nAnd it builds without error. But when I run `make check` I get the following output in the test-suite.log (showing the WalletTests failed):\r\n```\r\n********* Start testing of WalletTests *********\r\nConfig: Using QtTest library 5.9.8, Qt 5.9.8 (x86_64-little_endian-llp64 static release build; by GCC 7.3-posix 20180312)\r\nPASS   : WalletTests::initTestCase()\r\nQDEBUG : WalletTests::walletTests() TransactionTablePriv::refreshWallet\r\nQWARN  : WalletTests::walletTests() This plugin does not support propagateSizeHints()\r\nA crash occurred in \\\\wsl$\\Ubuntu\\usr\\src\\bitcoin\\src\\qt\\test\\test_bitcoin-qt.exe.\r\nFunction time: 1440ms Total time: 1441ms\r\n\r\nException address: 0x0000000001568e55\r\nException code   : 0xc0000005\r\n\r\nStack:\r\n#  1: Unable to obtain symbol\r\n#  2: UnhandledExceptionFilter() - 0x00007fff0a61f4b0\r\n#  3: memset() - 0x00007fff0c8c3000\r\n#  4: _C_specific_handler() - 0x00007fff0c8ac640\r\n#  5: _chkstk() - 0x00007fff0c8c1100\r\n#  6: RtlRaiseException() - 0x00007fff0c889ef0\r\n#  7: KiUserExceptionDispatcher() - 0x00007fff0c8bfe60\r\n#  8: Unable to obtain symbol\r\n#  9: Unable to obtain symbol\r\n# 10: Unable to obtain symbol\r\n# 11: Unable to obtain symbol\r\n# 12: Unable to obtain symbol\r\n# 13: Unable to obtain symbol\r\n# 14: Unable to obtain symbol\r\n# 15: Unable to obtain symbol\r\n# 16: Unable to obtain symbol\r\n# 17: Unable to obtain symbol\r\n# 18: Unable to obtain symbol\r\n# 19: Unable to obtain symbol\r\n# 20: Unable to obtain symbol\r\n# 21: Unable to obtain symbol\r\n# 22: Unable to obtain symbol\r\n# 23: Unable to obtain symbol\r\n# 24: Unable to obtain symbol\r\n# 25: Unable to obtain symbol\r\n# 26: Unable to obtain symbol\r\n# 27: Unable to obtain symbol\r\n# 28: Unable to obtain symbol\r\n# 29: Unable to obtain symbol\r\n# 30: secp256k1_ecdsa_recover() - 0x0000000001e309a0\r\n# 31: Unable to obtain symbol\r\n# 32: Unable to obtain symbol\r\n# 33: BaseThreadInitThunk() - 0x00007fff0b8a7bc0\r\n# 34: RtlUserThreadStart() - 0x00007fff0c88ceb0\r\n\r\nFAIL qt/test/test_bitcoin-qt.exe (exit status: 5)\r\n```\r\n\r\nI'm not sure if this wallet error is caused by the first error (missing DLL).\r\n\r\n**To reproduce**\r\nI get the error every time I run it on my system.\r\n\r\n1. Clone repository to WSL `/home/billy/bitcoin`\r\n2. Follow steps at https://github.com/bitcoin/bitcoin/blob/master/doc/build-windows.md \"Cross-compilation for Ubuntu and Windows Subsystem for Linux\" and \"Building for 64-bit Windows\" up to and including `make HOST=x86_64-w64-mingw32`\r\n3. Let it run until the error message (screenshot above) pops up\r\n4. Click OK\r\n5. Let it finish building depends\r\n6. Run the following:\r\n```\r\ncd ..\r\n./autogen.sh\r\nCONFIG_SITE=$PWD/depends/x86_64-w64-mingw32/share/config.site ./configure --prefix=/\r\nmake\r\nmake check\r\n```\r\n\r\n**System information**\r\n- Bitcoin Core master, built using instructions at https://github.com/bitcoin/bitcoin/blob/master/doc/build-windows.md\r\n- Windows 10 version 10.0.18363.719\r\n- Ubuntu 18.04 WSL (fresh install from Microsoft Store). I also tried on a different WSL that I upgraded from Ubuntu 16.04 to 18.04\r\n- Intel i7 processor\r\n\r\n**Other information**\r\nSimilar issue here: https://github.com/bitcoin/bitcoin/issues/17277\r\n\r\nHere's a copy of the full output from making the depends: https://gist.githubusercontent.com/billygarrison/c548ea99d3b498065c3dc1438d1561c7/raw/64359504e6bf5639396c9aa2313e73a1b0dd2ce8/out.log\r\n\r\nAnd here's a subset of that with showing just the bdb output (line 283 is where it hangs until I click OK on the error popup): https://gist.github.com/billygarrison/ebaad2b2f93c8e89281e7a1d2ce9d88b",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 1,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18348/comments",
   "created_at" : "2020-03-13T22:48:03Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18348/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/18348",
   "id" : 580911540,
   "labels" : [
      {
         "color" : "FBBAAB",
         "default" : false,
         "description" : null,
         "id" : 64585,
         "name" : "Bug",
         "node_id" : "MDU6TGFiZWw2NDU4NQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18348/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU1ODA5MTE1NDA=",
   "number" : 18348,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "libwinpthread-1.dll not found during depends build (bdb) on Windows Subsystem for Linux",
   "updated_at" : "2020-03-19T12:43:16Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18348",
   "user" : {
      "avatar_url" : "https://avatars1.githubusercontent.com/u/30005204?v=4",
      "events_url" : "https://api.github.com/users/billygarrison/events{/privacy}",
      "followers_url" : "https://api.github.com/users/billygarrison/followers",
      "following_url" : "https://api.github.com/users/billygarrison/following{/other_user}",
      "gists_url" : "https://api.github.com/users/billygarrison/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/billygarrison",
      "id" : 30005204,
      "login" : "billygarrison",
      "node_id" : "MDQ6VXNlcjMwMDA1MjA0",
      "organizations_url" : "https://api.github.com/users/billygarrison/orgs",
      "received_events_url" : "https://api.github.com/users/billygarrison/received_events",
      "repos_url" : "https://api.github.com/users/billygarrison/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/billygarrison/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/billygarrison/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/billygarrison"
   }
}
