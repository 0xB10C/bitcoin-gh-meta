[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.\r\nThough, wouldn't it be easier to record these metrics outside of Bitcoin Core? I.e. in the \"middle\" between the rpc endpoint and rpc consumer. The outside approach seems more flexible to me, since it could collect the metrics per-call or overall or per day ...",
      "created_at" : "2018-09-12T03:15:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14202#issuecomment-420498219",
      "id" : 420498219,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14202",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMDQ5ODIxOQ==",
      "updated_at" : "2018-09-12T03:15:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/420498219",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@MarcoFalke Thank you for the quick feedback!\r\n\r\nSo, in the configuration I have in mind here we have a set of nodes sitting behind a load-balancer. The desire is to gather info about request volume and latency from the nodes themselves as part of a health check, and to potentially use this information to scale the cluster up or down. Nodes themselves are ephemeral and the entire cluster may be redeployed multiple times per day.\r\n\r\nAWS (as far as I know) does not provide a way to query comparable information in realtime from an ELB/NLB/ALB, but instead allows you to export logs for later analysis. So getting this information in real-time from the load balancer isn't possible.\r\n\r\nThe remaining option is to introduce an additional HTTP proxy between the HTTP server provided by Bitcoin and the incoming requests for the sole purpose of collecting this information, but this seems wasteful since Bitcoin itself is a server and could provide the required information with lower latency and higher quality. Since comparable information is already provided about the P2P services provided by Bitcoin (`getnettotals`), it seems to make sense to provide similar information about the HTTP services.",
      "created_at" : "2018-09-12T03:39:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14202#issuecomment-420501555",
      "id" : 420501555,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14202",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMDUwMTU1NQ==",
      "updated_at" : "2018-09-12T03:39:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/420501555",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/69561?v=4",
         "events_url" : "https://api.github.com/users/etscrivner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/etscrivner/followers",
         "following_url" : "https://api.github.com/users/etscrivner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/etscrivner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/etscrivner",
         "id" : 69561,
         "login" : "etscrivner",
         "node_id" : "MDQ6VXNlcjY5NTYx",
         "organizations_url" : "https://api.github.com/users/etscrivner/orgs",
         "received_events_url" : "https://api.github.com/users/etscrivner/received_events",
         "repos_url" : "https://api.github.com/users/etscrivner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/etscrivner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/etscrivner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/etscrivner"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "As an aside, I think a better name for this is probably `getrpctotals` or something similar. Could possibly be merged with `getnettotals` as well.",
      "created_at" : "2018-09-12T03:41:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14202#issuecomment-420501801",
      "id" : 420501801,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14202",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMDUwMTgwMQ==",
      "updated_at" : "2018-09-12T12:36:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/420501801",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/69561?v=4",
         "events_url" : "https://api.github.com/users/etscrivner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/etscrivner/followers",
         "following_url" : "https://api.github.com/users/etscrivner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/etscrivner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/etscrivner",
         "id" : 69561,
         "login" : "etscrivner",
         "node_id" : "MDQ6VXNlcjY5NTYx",
         "organizations_url" : "https://api.github.com/users/etscrivner/orgs",
         "received_events_url" : "https://api.github.com/users/etscrivner/received_events",
         "repos_url" : "https://api.github.com/users/etscrivner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/etscrivner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/etscrivner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/etscrivner"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->Note to reviewers: This pull request conflicts with the following ones:\n\n* #13152 ([rpc] Add getnodeaddresses RPC command by chris-belcher)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-09-12T06:45:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14202#issuecomment-420531523",
      "id" : 420531523,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14202",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMDUzMTUyMw==",
      "updated_at" : "2018-09-12T06:45:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/420531523",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14202#discussion_r216918866"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14202"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/216918866"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Needs locking?",
      "commit_id" : "d553a82aab20eea05a3411a199a1a6f3de1abdf0",
      "created_at" : "2018-09-12T07:12:00Z",
      "diff_hunk" : "@@ -677,3 +697,8 @@ std::string urlDecode(const std::string &urlEncoded) {\n     }\n     return res;\n }\n+\n+void GetRPCServerStats(RPCServerStats* rpc_server_stats) {\n+    assert(rpc_server_stats != nullptr);\n+    memcpy(rpc_server_stats, &g_rpcserverstats, sizeof(RPCServerStats));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14202#discussion_r216918866",
      "id" : 216918866,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNjkxODg2Ng==",
      "original_commit_id" : "dfb1ba37cffad00ae2aa8c5e3be926d10143d5f4",
      "original_position" : 67,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_review_id" : 154510048,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14202",
      "updated_at" : "2018-09-12T12:48:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/216918866",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@promag This works and could be a much lower maintenance burden. I assume you mean using `boost::signals2` to create request start/end signals or possibly pushing zeromq notifications? Any recommendations on approach would be appreciated",
      "created_at" : "2018-09-12T12:46:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14202#issuecomment-420634868",
      "id" : 420634868,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14202",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMDYzNDg2OA==",
      "updated_at" : "2018-09-12T13:13:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/420634868",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/69561?v=4",
         "events_url" : "https://api.github.com/users/etscrivner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/etscrivner/followers",
         "following_url" : "https://api.github.com/users/etscrivner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/etscrivner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/etscrivner",
         "id" : 69561,
         "login" : "etscrivner",
         "node_id" : "MDQ6VXNlcjY5NTYx",
         "organizations_url" : "https://api.github.com/users/etscrivner/orgs",
         "received_events_url" : "https://api.github.com/users/etscrivner/received_events",
         "repos_url" : "https://api.github.com/users/etscrivner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/etscrivner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/etscrivner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/etscrivner"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14202#discussion_r217014729"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14202"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217014729"
         }
      },
      "author_association" : "NONE",
      "body" : "Thanks!",
      "commit_id" : "d553a82aab20eea05a3411a199a1a6f3de1abdf0",
      "created_at" : "2018-09-12T12:46:38Z",
      "diff_hunk" : "@@ -677,3 +697,8 @@ std::string urlDecode(const std::string &urlEncoded) {\n     }\n     return res;\n }\n+\n+void GetRPCServerStats(RPCServerStats* rpc_server_stats) {\n+    assert(rpc_server_stats != nullptr);\n+    memcpy(rpc_server_stats, &g_rpcserverstats, sizeof(RPCServerStats));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14202#discussion_r217014729",
      "id" : 217014729,
      "in_reply_to_id" : 216918866,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNzAxNDcyOQ==",
      "original_commit_id" : "dfb1ba37cffad00ae2aa8c5e3be926d10143d5f4",
      "original_position" : 67,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_review_id" : 154628591,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14202",
      "updated_at" : "2018-09-12T12:48:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217014729",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/69561?v=4",
         "events_url" : "https://api.github.com/users/etscrivner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/etscrivner/followers",
         "following_url" : "https://api.github.com/users/etscrivner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/etscrivner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/etscrivner",
         "id" : 69561,
         "login" : "etscrivner",
         "node_id" : "MDQ6VXNlcjY5NTYx",
         "organizations_url" : "https://api.github.com/users/etscrivner/orgs",
         "received_events_url" : "https://api.github.com/users/etscrivner/received_events",
         "repos_url" : "https://api.github.com/users/etscrivner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/etscrivner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/etscrivner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/etscrivner"
      }
   }
]
