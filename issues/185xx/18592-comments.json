[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18592#discussion_r407046263"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18592"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407046263"
         }
      },
      "author_association" : "MEMBER",
      "body" : "read-only access to a wallet that is not a `nullptr` should probably be \r\n```suggestion\r\nstatic inline bool GetAvoidReuseFlag(const CWallet& wallet, const UniValue& param) {\r\n```\r\n\r\nAll RPCs check wallet for nullptr at the beginning of the function, so there shouldn't be an occasion where this is assumption fails.",
      "commit_id" : "dc1feb63faeeba864fdbcf441f643b083aebf800",
      "created_at" : "2020-04-11T10:23:08Z",
      "diff_hunk" : "@@ -40,7 +40,7 @@\n static const std::string WALLET_ENDPOINT_BASE = \"/wallet/\";\n static const std::string HELP_REQUIRING_PASSPHRASE{\"\\nRequires wallet passphrase to be set with walletpassphrase call if wallet is encrypted.\\n\"};\n \n-static inline bool GetAvoidReuseFlag(const CWallet* const pwallet, const UniValue& param) {\n+static inline bool GetAvoidReuseFlag(const std::shared_ptr<CWallet> pwallet, const UniValue& param) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18592#discussion_r407046263",
      "id" : 407046263,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA0NjI2Mw==",
      "original_commit_id" : "0b3ee615491edf6f542631bf6ae6f72eac406550",
      "original_line" : 43,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 391754708,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18592",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-11T10:38:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407046263",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18592#discussion_r407047725"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18592"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407047725"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, have changed it.\r\nHave also changed the CWallet reference variable name in `ParseIncludeWatchonly`.",
      "commit_id" : "dc1feb63faeeba864fdbcf441f643b083aebf800",
      "created_at" : "2020-04-11T10:38:21Z",
      "diff_hunk" : "@@ -40,7 +40,7 @@\n static const std::string WALLET_ENDPOINT_BASE = \"/wallet/\";\n static const std::string HELP_REQUIRING_PASSPHRASE{\"\\nRequires wallet passphrase to be set with walletpassphrase call if wallet is encrypted.\\n\"};\n \n-static inline bool GetAvoidReuseFlag(const CWallet* const pwallet, const UniValue& param) {\n+static inline bool GetAvoidReuseFlag(const std::shared_ptr<CWallet> pwallet, const UniValue& param) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18592#discussion_r407047725",
      "id" : 407047725,
      "in_reply_to_id" : 407046263,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA0NzcyNQ==",
      "original_commit_id" : "0b3ee615491edf6f542631bf6ae6f72eac406550",
      "original_line" : 43,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 391755677,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18592",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-11T10:39:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407047725",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18592#discussion_r407049333"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18592"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407049333"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Instead of new method, you could change `EnsureWalletIsAvailable` and update rpcdump.cpp? Also, `const std::shared_ptr<CWallet>&` avoids incr/decr usage count.",
      "commit_id" : "dc1feb63faeeba864fdbcf441f643b083aebf800",
      "created_at" : "2020-04-11T10:54:05Z",
      "diff_hunk" : "@@ -111,13 +111,32 @@ bool EnsureWalletIsAvailable(const CWallet* pwallet, bool avoidException)\n         \"Wallet file not specified (must request wallet RPC through /wallet/<filename> uri-path).\");\n }\n \n+bool EnsureWalletRefIsAvailable(const std::shared_ptr<CWallet> pwallet, bool avoidException)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18592#discussion_r407049333",
      "id" : 407049333,
      "line" : 114,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA0OTMzMw==",
      "original_commit_id" : "dc1feb63faeeba864fdbcf441f643b083aebf800",
      "original_line" : 114,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 29,
      "pull_request_review_id" : 391756615,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18592",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-11T10:56:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407049333",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18592#discussion_r407049382"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18592"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407049382"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same as above.",
      "commit_id" : "dc1feb63faeeba864fdbcf441f643b083aebf800",
      "created_at" : "2020-04-11T10:54:37Z",
      "diff_hunk" : "@@ -111,13 +111,32 @@ bool EnsureWalletIsAvailable(const CWallet* pwallet, bool avoidException)\n         \"Wallet file not specified (must request wallet RPC through /wallet/<filename> uri-path).\");\n }\n \n+bool EnsureWalletRefIsAvailable(const std::shared_ptr<CWallet> pwallet, bool avoidException)\n+{\n+    if (pwallet) return true;\n+    if (avoidException) return false;\n+    if (!HasWallets()) {\n+        throw JSONRPCError(\n+            RPC_METHOD_NOT_FOUND, \"Method not found (wallet method is disabled because no wallet is loaded)\");\n+    }\n+    throw JSONRPCError(RPC_WALLET_NOT_SPECIFIED,\n+        \"Wallet file not specified (must request wallet RPC through /wallet/<filename> uri-path).\");\n+}\n+\n void EnsureWalletIsUnlocked(const CWallet* pwallet)\n {\n     if (pwallet->IsLocked()) {\n         throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Please enter the wallet passphrase with walletpassphrase first.\");\n     }\n }\n \n+void EnsureWalletRefIsUnlocked(const std::shared_ptr<CWallet> pwallet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18592#discussion_r407049382",
      "id" : 407049382,
      "line" : 133,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA0OTM4Mg==",
      "original_commit_id" : "dc1feb63faeeba864fdbcf441f643b083aebf800",
      "original_line" : 133,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 48,
      "pull_request_review_id" : 391756615,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18592",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-11T10:56:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407049382",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18592#discussion_r407049785"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18592"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407049785"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, I could, but I didn't want to affect anything outside `rpcwallet.cpp`. At least not without consultation with others.  ",
      "commit_id" : "dc1feb63faeeba864fdbcf441f643b083aebf800",
      "created_at" : "2020-04-11T10:59:31Z",
      "diff_hunk" : "@@ -111,13 +111,32 @@ bool EnsureWalletIsAvailable(const CWallet* pwallet, bool avoidException)\n         \"Wallet file not specified (must request wallet RPC through /wallet/<filename> uri-path).\");\n }\n \n+bool EnsureWalletRefIsAvailable(const std::shared_ptr<CWallet> pwallet, bool avoidException)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18592#discussion_r407049785",
      "id" : 407049785,
      "in_reply_to_id" : 407049333,
      "line" : 114,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA0OTc4NQ==",
      "original_commit_id" : "dc1feb63faeeba864fdbcf441f643b083aebf800",
      "original_line" : 114,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 29,
      "pull_request_review_id" : 391756924,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18592",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-11T10:59:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407049785",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18592#discussion_r407050083"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18592"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407050083"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You can consider rpcdump.cpp and rpcwallet.cpp as one, these belong to libbitcoin_wallet. Furthermore, the diff is more of the same.",
      "commit_id" : "dc1feb63faeeba864fdbcf441f643b083aebf800",
      "created_at" : "2020-04-11T11:02:48Z",
      "diff_hunk" : "@@ -111,13 +111,32 @@ bool EnsureWalletIsAvailable(const CWallet* pwallet, bool avoidException)\n         \"Wallet file not specified (must request wallet RPC through /wallet/<filename> uri-path).\");\n }\n \n+bool EnsureWalletRefIsAvailable(const std::shared_ptr<CWallet> pwallet, bool avoidException)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18592#discussion_r407050083",
      "id" : 407050083,
      "in_reply_to_id" : 407049333,
      "line" : 114,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA1MDA4Mw==",
      "original_commit_id" : "dc1feb63faeeba864fdbcf441f643b083aebf800",
      "original_line" : 114,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 29,
      "pull_request_review_id" : 391757114,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18592",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-11T11:03:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407050083",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18592#discussion_r407050182"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18592"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407050182"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ok, then I will adapt `rpcdump.cpp` as well.",
      "commit_id" : "dc1feb63faeeba864fdbcf441f643b083aebf800",
      "created_at" : "2020-04-11T11:03:49Z",
      "diff_hunk" : "@@ -111,13 +111,32 @@ bool EnsureWalletIsAvailable(const CWallet* pwallet, bool avoidException)\n         \"Wallet file not specified (must request wallet RPC through /wallet/<filename> uri-path).\");\n }\n \n+bool EnsureWalletRefIsAvailable(const std::shared_ptr<CWallet> pwallet, bool avoidException)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18592#discussion_r407050182",
      "id" : 407050182,
      "in_reply_to_id" : 407049333,
      "line" : 114,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA1MDE4Mg==",
      "original_commit_id" : "dc1feb63faeeba864fdbcf441f643b083aebf800",
      "original_line" : 114,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 29,
      "pull_request_review_id" : 391757166,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18592",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-11T11:03:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407050182",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   }
]
