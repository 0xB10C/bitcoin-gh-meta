[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403642900"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403642900"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "(will remove after debugging)",
      "commit_id" : "d86dba18b06f1558c353beff335f6c03bd406008",
      "created_at" : "2020-04-05T03:21:04Z",
      "diff_hunk" : "@@ -3,7 +3,7 @@\n # Distributed under the MIT software license, see the accompanying\n # file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \"\"\"Test p2p blocksonly\"\"\"\n-\n+from pprint import pprint",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403642900",
      "id" : 403642900,
      "line" : 6,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0MjkwMA==",
      "original_commit_id" : "d86dba18b06f1558c353beff335f6c03bd406008",
      "original_line" : 6,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : 5,
      "pull_request_review_id" : 387777754,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-05T03:21:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403642900",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/38899812?v=4",
         "events_url" : "https://api.github.com/users/glowang/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glowang/followers",
         "following_url" : "https://api.github.com/users/glowang/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glowang/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glowang",
         "id" : 38899812,
         "login" : "glowang",
         "node_id" : "MDQ6VXNlcjM4ODk5ODEy",
         "organizations_url" : "https://api.github.com/users/glowang/orgs",
         "received_events_url" : "https://api.github.com/users/glowang/received_events",
         "repos_url" : "https://api.github.com/users/glowang/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glowang/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glowang/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glowang"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403643020"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403643020"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I am getting this error on this line: \r\n`File \"/Users/gwang/Documents/bitcoin/test/functional/test_framework/util.py\", line 234, in wait_until\r\n    raise AssertionError(\"Predicate {} not true after {} seconds\".format(predicate_source, timeout))\r\nAssertionError: Predicate ''''\r\n        def test_function():\r\n            assert self.is_connected\r\n            if not self.last_message.get('tx'):\r\n                return False\r\n            return self.last_message['tx'].tx.rehash() == txid\r\n''' not true after 60 seconds`\r\n\r\nI'm a bit confused about why this transaction isn't working, since I constructed it very similarly to the first transaction in this test file. I am still learning the way that this test setup works, and I might have been missing something",
      "commit_id" : "d86dba18b06f1558c353beff335f6c03bd406008",
      "created_at" : "2020-04-05T03:23:01Z",
      "diff_hunk" : "@@ -55,8 +55,51 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=1'.format(txid)]):\n             self.nodes[0].sendrawtransaction(sigtx)\n             self.nodes[0].p2p.wait_for_tx(txid)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid))\n             assert_equal(self.nodes[0].getmempoolinfo()['size'], 1)\n \n+        self.log.info(\"Restarting node 0 with whitelist permission and blocksonly\")\n+        self.stop_node(0)\n+        self.start_node(0, [\"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\"])\n+        self.nodes[0].add_p2p_connection(P2PInterface())\n+        self.log.info('Check that txs from whitelisted peers are not rejected and relayed to others')\n+        peerInfo = self.nodes[0].getpeerinfo()[0]\n+        assert_equal(peerInfo['whitelisted'], True)\n+        assert_equal(peerInfo['permissions'], ['noban', 'forcerelay', 'relay', 'mempool']) #checkpermission use check permission from p2p_permission\n+\n+        # create a new transaction\n+        prevtx1 = self.nodes[0].getblock(self.nodes[0].getblockhash(2), 2)['tx'][0]\n+        rawtx1 = self.nodes[0].createrawtransaction(\n+            inputs=[{\n+                'txid': prevtx1['txid'],\n+                'vout': 0\n+            }],\n+            outputs=[{\n+                self.nodes[0].get_deterministic_priv_key().address: 50 - 0.00125\n+            }],\n+        )\n+        sigtx1 = self.nodes[0].signrawtransactionwithkey(\n+            hexstring=rawtx1,\n+            privkeys=[self.nodes[0].get_deterministic_priv_key().key],\n+            prevtxs=[{\n+                'txid': prevtx1['txid'],\n+                'vout': 0,\n+                'scriptPubKey': prevtx1['vout'][0]['scriptPubKey']['hex'],\n+            }],\n+        )['hex']\n+        txid1 = self.nodes[0].testmempoolaccept([sigtx1])[0]['txid']\n+        self.nodes[0].p2p.send_message(msg_tx(FromHex(CTransaction(), sigtx1))) # so self is the transaction sender?\n+\n+        pprint(self.nodes[0].p2p.last_message)\n+        pprint(self.nodes[0].p2p.last_message.get('tx'))\n+\n+        with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=0'.format(txid1)]):\n+            self.nodes[0].sendrawtransaction(sigtx1)\n+            self.nodes[0].p2p.wait_for_tx(txid1)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid1))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403643020",
      "id" : 403643020,
      "line" : 99,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0MzAyMA==",
      "original_commit_id" : "d86dba18b06f1558c353beff335f6c03bd406008",
      "original_line" : 99,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : 54,
      "pull_request_review_id" : 387777826,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-05T03:27:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403643020",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/38899812?v=4",
         "events_url" : "https://api.github.com/users/glowang/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glowang/followers",
         "following_url" : "https://api.github.com/users/glowang/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glowang/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glowang",
         "id" : 38899812,
         "login" : "glowang",
         "node_id" : "MDQ6VXNlcjM4ODk5ODEy",
         "organizations_url" : "https://api.github.com/users/glowang/orgs",
         "received_events_url" : "https://api.github.com/users/glowang/received_events",
         "repos_url" : "https://api.github.com/users/glowang/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glowang/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glowang/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glowang"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403643235"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403643235"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "There seem to exist many variations of the \"whitelist\" params and different tests set these params differently. For example, ` [\"-whitelist=127.0.0.1\", \"-whitelistrelay=0\"]`, or ` [\"-whitelist=127.0.0.1\", \"-whitelistrelay=0\"],`, `['-whitelist=noban@127.0.0.1']`, etc. Understanding the nuances between them is a bit challenging after I have done quite a bit of digging. Could someone point me to some resource for this?",
      "commit_id" : "d86dba18b06f1558c353beff335f6c03bd406008",
      "created_at" : "2020-04-05T03:26:10Z",
      "diff_hunk" : "@@ -55,8 +55,51 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=1'.format(txid)]):\n             self.nodes[0].sendrawtransaction(sigtx)\n             self.nodes[0].p2p.wait_for_tx(txid)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid))\n             assert_equal(self.nodes[0].getmempoolinfo()['size'], 1)\n \n+        self.log.info(\"Restarting node 0 with whitelist permission and blocksonly\")\n+        self.stop_node(0)\n+        self.start_node(0, [\"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403643235",
      "id" : 403643235,
      "line" : 63,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0MzIzNQ==",
      "original_commit_id" : "d86dba18b06f1558c353beff335f6c03bd406008",
      "original_line" : 63,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : 18,
      "pull_request_review_id" : 387777968,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-05T03:26:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403643235",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/38899812?v=4",
         "events_url" : "https://api.github.com/users/glowang/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glowang/followers",
         "following_url" : "https://api.github.com/users/glowang/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glowang/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glowang",
         "id" : 38899812,
         "login" : "glowang",
         "node_id" : "MDQ6VXNlcjM4ODk5ODEy",
         "organizations_url" : "https://api.github.com/users/glowang/orgs",
         "received_events_url" : "https://api.github.com/users/glowang/received_events",
         "repos_url" : "https://api.github.com/users/glowang/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glowang/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glowang/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glowang"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403643287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403643287"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "not sure if `noban` is necessary to check here",
      "commit_id" : "d86dba18b06f1558c353beff335f6c03bd406008",
      "created_at" : "2020-04-05T03:26:50Z",
      "diff_hunk" : "@@ -55,8 +55,51 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=1'.format(txid)]):\n             self.nodes[0].sendrawtransaction(sigtx)\n             self.nodes[0].p2p.wait_for_tx(txid)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid))\n             assert_equal(self.nodes[0].getmempoolinfo()['size'], 1)\n \n+        self.log.info(\"Restarting node 0 with whitelist permission and blocksonly\")\n+        self.stop_node(0)\n+        self.start_node(0, [\"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\"])\n+        self.nodes[0].add_p2p_connection(P2PInterface())\n+        self.log.info('Check that txs from whitelisted peers are not rejected and relayed to others')\n+        peerInfo = self.nodes[0].getpeerinfo()[0]\n+        assert_equal(peerInfo['whitelisted'], True)\n+        assert_equal(peerInfo['permissions'], ['noban', 'forcerelay', 'relay', 'mempool']) #checkpermission use check permission from p2p_permission",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403643287",
      "id" : 403643287,
      "line" : 68,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0MzI4Nw==",
      "original_commit_id" : "d86dba18b06f1558c353beff335f6c03bd406008",
      "original_line" : 68,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : 23,
      "pull_request_review_id" : 387777993,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-05T03:26:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403643287",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/38899812?v=4",
         "events_url" : "https://api.github.com/users/glowang/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glowang/followers",
         "following_url" : "https://api.github.com/users/glowang/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glowang/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glowang",
         "id" : 38899812,
         "login" : "glowang",
         "node_id" : "MDQ6VXNlcjM4ODk5ODEy",
         "organizations_url" : "https://api.github.com/users/glowang/orgs",
         "received_events_url" : "https://api.github.com/users/glowang/received_events",
         "repos_url" : "https://api.github.com/users/glowang/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glowang/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glowang/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glowang"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403643527"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403643527"
         }
      },
      "author_association" : "NONE",
      "body" : "REVISA LA BASE Y CONTINUA CON LO DEMÃS.",
      "commit_id" : "d86dba18b06f1558c353beff335f6c03bd406008",
      "created_at" : "2020-04-05T03:30:07Z",
      "diff_hunk" : "@@ -55,8 +55,51 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=1'.format(txid)]):\n             self.nodes[0].sendrawtransaction(sigtx)\n             self.nodes[0].p2p.wait_for_tx(txid)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid))\n             assert_equal(self.nodes[0].getmempoolinfo()['size'], 1)\n \n+        self.log.info(\"Restarting node 0 with whitelist permission and blocksonly\")\n+        self.stop_node(0)\n+        self.start_node(0, [\"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403643527",
      "id" : 403643527,
      "in_reply_to_id" : 403643235,
      "line" : 63,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0MzUyNw==",
      "original_commit_id" : "d86dba18b06f1558c353beff335f6c03bd406008",
      "original_line" : 63,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : 18,
      "pull_request_review_id" : 387778133,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-05T03:30:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403643527",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/63138099?v=4",
         "events_url" : "https://api.github.com/users/RANDALL-hub/events{/privacy}",
         "followers_url" : "https://api.github.com/users/RANDALL-hub/followers",
         "following_url" : "https://api.github.com/users/RANDALL-hub/following{/other_user}",
         "gists_url" : "https://api.github.com/users/RANDALL-hub/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/RANDALL-hub",
         "id" : 63138099,
         "login" : "RANDALL-hub",
         "node_id" : "MDQ6VXNlcjYzMTM4MDk5",
         "organizations_url" : "https://api.github.com/users/RANDALL-hub/orgs",
         "received_events_url" : "https://api.github.com/users/RANDALL-hub/received_events",
         "repos_url" : "https://api.github.com/users/RANDALL-hub/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/RANDALL-hub/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/RANDALL-hub/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/RANDALL-hub"
      }
   }
]
