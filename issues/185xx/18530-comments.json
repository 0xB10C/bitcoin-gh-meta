[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403642900"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403642900"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "(will remove after debugging)",
      "commit_id" : "209da1b0597521806d392aa38ad0d8b760ef59dd",
      "created_at" : "2020-04-05T03:21:04Z",
      "diff_hunk" : "@@ -3,7 +3,7 @@\n # Distributed under the MIT software license, see the accompanying\n # file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \"\"\"Test p2p blocksonly\"\"\"\n-\n+from pprint import pprint",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403642900",
      "id" : 403642900,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0MjkwMA==",
      "original_commit_id" : "d86dba18b06f1558c353beff335f6c03bd406008",
      "original_line" : 6,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : null,
      "pull_request_review_id" : 387777754,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-12T03:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403642900",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/38899812?v=4",
         "events_url" : "https://api.github.com/users/glowang/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glowang/followers",
         "following_url" : "https://api.github.com/users/glowang/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glowang/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glowang",
         "id" : 38899812,
         "login" : "glowang",
         "node_id" : "MDQ6VXNlcjM4ODk5ODEy",
         "organizations_url" : "https://api.github.com/users/glowang/orgs",
         "received_events_url" : "https://api.github.com/users/glowang/received_events",
         "repos_url" : "https://api.github.com/users/glowang/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glowang/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glowang/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glowang"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403643020"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403643020"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I am getting this error on this line: \r\n`File \"/Users/gwang/Documents/bitcoin/test/functional/test_framework/util.py\", line 234, in wait_until\r\n    raise AssertionError(\"Predicate {} not true after {} seconds\".format(predicate_source, timeout))\r\nAssertionError: Predicate ''''\r\n        def test_function():\r\n            assert self.is_connected\r\n            if not self.last_message.get('tx'):\r\n                return False\r\n            return self.last_message['tx'].tx.rehash() == txid\r\n''' not true after 60 seconds`\r\n\r\nI'm a bit confused about why this transaction isn't working, since I constructed it very similarly to the first transaction in this test file. I am still learning the way that this test setup works, and I might have been missing something",
      "commit_id" : "209da1b0597521806d392aa38ad0d8b760ef59dd",
      "created_at" : "2020-04-05T03:23:01Z",
      "diff_hunk" : "@@ -55,8 +55,51 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=1'.format(txid)]):\n             self.nodes[0].sendrawtransaction(sigtx)\n             self.nodes[0].p2p.wait_for_tx(txid)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid))\n             assert_equal(self.nodes[0].getmempoolinfo()['size'], 1)\n \n+        self.log.info(\"Restarting node 0 with whitelist permission and blocksonly\")\n+        self.stop_node(0)\n+        self.start_node(0, [\"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\"])\n+        self.nodes[0].add_p2p_connection(P2PInterface())\n+        self.log.info('Check that txs from whitelisted peers are not rejected and relayed to others')\n+        peerInfo = self.nodes[0].getpeerinfo()[0]\n+        assert_equal(peerInfo['whitelisted'], True)\n+        assert_equal(peerInfo['permissions'], ['noban', 'forcerelay', 'relay', 'mempool']) #checkpermission use check permission from p2p_permission\n+\n+        # create a new transaction\n+        prevtx1 = self.nodes[0].getblock(self.nodes[0].getblockhash(2), 2)['tx'][0]\n+        rawtx1 = self.nodes[0].createrawtransaction(\n+            inputs=[{\n+                'txid': prevtx1['txid'],\n+                'vout': 0\n+            }],\n+            outputs=[{\n+                self.nodes[0].get_deterministic_priv_key().address: 50 - 0.00125\n+            }],\n+        )\n+        sigtx1 = self.nodes[0].signrawtransactionwithkey(\n+            hexstring=rawtx1,\n+            privkeys=[self.nodes[0].get_deterministic_priv_key().key],\n+            prevtxs=[{\n+                'txid': prevtx1['txid'],\n+                'vout': 0,\n+                'scriptPubKey': prevtx1['vout'][0]['scriptPubKey']['hex'],\n+            }],\n+        )['hex']\n+        txid1 = self.nodes[0].testmempoolaccept([sigtx1])[0]['txid']\n+        self.nodes[0].p2p.send_message(msg_tx(FromHex(CTransaction(), sigtx1))) # so self is the transaction sender?\n+\n+        pprint(self.nodes[0].p2p.last_message)\n+        pprint(self.nodes[0].p2p.last_message.get('tx'))\n+\n+        with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=0'.format(txid1)]):\n+            self.nodes[0].sendrawtransaction(sigtx1)\n+            self.nodes[0].p2p.wait_for_tx(txid1)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid1))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403643020",
      "id" : 403643020,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0MzAyMA==",
      "original_commit_id" : "d86dba18b06f1558c353beff335f6c03bd406008",
      "original_line" : 99,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : null,
      "pull_request_review_id" : 387777826,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-12T03:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403643020",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/38899812?v=4",
         "events_url" : "https://api.github.com/users/glowang/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glowang/followers",
         "following_url" : "https://api.github.com/users/glowang/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glowang/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glowang",
         "id" : 38899812,
         "login" : "glowang",
         "node_id" : "MDQ6VXNlcjM4ODk5ODEy",
         "organizations_url" : "https://api.github.com/users/glowang/orgs",
         "received_events_url" : "https://api.github.com/users/glowang/received_events",
         "repos_url" : "https://api.github.com/users/glowang/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glowang/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glowang/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glowang"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403643235"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403643235"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "There seem to exist many variations of the \"whitelist\" params and different tests set these params differently. For example, ` [\"-whitelist=127.0.0.1\", \"-whitelistrelay=0\"]`, or ` [\"-whitelist=127.0.0.1\", \"-whitelistrelay=0\"],`, `['-whitelist=noban@127.0.0.1']`, etc. Understanding the nuances between them is a bit challenging after I have done quite a bit of digging. Could someone point me to some resource for this?",
      "commit_id" : "209da1b0597521806d392aa38ad0d8b760ef59dd",
      "created_at" : "2020-04-05T03:26:10Z",
      "diff_hunk" : "@@ -55,8 +55,51 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=1'.format(txid)]):\n             self.nodes[0].sendrawtransaction(sigtx)\n             self.nodes[0].p2p.wait_for_tx(txid)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid))\n             assert_equal(self.nodes[0].getmempoolinfo()['size'], 1)\n \n+        self.log.info(\"Restarting node 0 with whitelist permission and blocksonly\")\n+        self.stop_node(0)\n+        self.start_node(0, [\"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403643235",
      "id" : 403643235,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0MzIzNQ==",
      "original_commit_id" : "d86dba18b06f1558c353beff335f6c03bd406008",
      "original_line" : 63,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : null,
      "pull_request_review_id" : 387777968,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-12T03:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403643235",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/38899812?v=4",
         "events_url" : "https://api.github.com/users/glowang/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glowang/followers",
         "following_url" : "https://api.github.com/users/glowang/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glowang/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glowang",
         "id" : 38899812,
         "login" : "glowang",
         "node_id" : "MDQ6VXNlcjM4ODk5ODEy",
         "organizations_url" : "https://api.github.com/users/glowang/orgs",
         "received_events_url" : "https://api.github.com/users/glowang/received_events",
         "repos_url" : "https://api.github.com/users/glowang/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glowang/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glowang/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glowang"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403643287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403643287"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "not sure if `noban` is necessary to check here",
      "commit_id" : "209da1b0597521806d392aa38ad0d8b760ef59dd",
      "created_at" : "2020-04-05T03:26:50Z",
      "diff_hunk" : "@@ -55,8 +55,51 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=1'.format(txid)]):\n             self.nodes[0].sendrawtransaction(sigtx)\n             self.nodes[0].p2p.wait_for_tx(txid)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid))\n             assert_equal(self.nodes[0].getmempoolinfo()['size'], 1)\n \n+        self.log.info(\"Restarting node 0 with whitelist permission and blocksonly\")\n+        self.stop_node(0)\n+        self.start_node(0, [\"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\"])\n+        self.nodes[0].add_p2p_connection(P2PInterface())\n+        self.log.info('Check that txs from whitelisted peers are not rejected and relayed to others')\n+        peerInfo = self.nodes[0].getpeerinfo()[0]\n+        assert_equal(peerInfo['whitelisted'], True)\n+        assert_equal(peerInfo['permissions'], ['noban', 'forcerelay', 'relay', 'mempool']) #checkpermission use check permission from p2p_permission",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403643287",
      "id" : 403643287,
      "line" : 65,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0MzI4Nw==",
      "original_commit_id" : "d86dba18b06f1558c353beff335f6c03bd406008",
      "original_line" : 65,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : 18,
      "pull_request_review_id" : 387777993,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-12T03:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403643287",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/38899812?v=4",
         "events_url" : "https://api.github.com/users/glowang/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glowang/followers",
         "following_url" : "https://api.github.com/users/glowang/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glowang/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glowang",
         "id" : 38899812,
         "login" : "glowang",
         "node_id" : "MDQ6VXNlcjM4ODk5ODEy",
         "organizations_url" : "https://api.github.com/users/glowang/orgs",
         "received_events_url" : "https://api.github.com/users/glowang/received_events",
         "repos_url" : "https://api.github.com/users/glowang/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glowang/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glowang/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glowang"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403643527"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403643527"
         }
      },
      "author_association" : "NONE",
      "body" : "REVISA LA BASE Y CONTINUA CON LO DEMÃS.",
      "commit_id" : "209da1b0597521806d392aa38ad0d8b760ef59dd",
      "created_at" : "2020-04-05T03:30:07Z",
      "diff_hunk" : "@@ -55,8 +55,51 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=1'.format(txid)]):\n             self.nodes[0].sendrawtransaction(sigtx)\n             self.nodes[0].p2p.wait_for_tx(txid)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid))\n             assert_equal(self.nodes[0].getmempoolinfo()['size'], 1)\n \n+        self.log.info(\"Restarting node 0 with whitelist permission and blocksonly\")\n+        self.stop_node(0)\n+        self.start_node(0, [\"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403643527",
      "id" : 403643527,
      "in_reply_to_id" : 403643235,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0MzUyNw==",
      "original_commit_id" : "d86dba18b06f1558c353beff335f6c03bd406008",
      "original_line" : 63,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : null,
      "pull_request_review_id" : 387778133,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-12T03:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403643527",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/63138099?v=4",
         "events_url" : "https://api.github.com/users/RANDALL-hub/events{/privacy}",
         "followers_url" : "https://api.github.com/users/RANDALL-hub/followers",
         "following_url" : "https://api.github.com/users/RANDALL-hub/following{/other_user}",
         "gists_url" : "https://api.github.com/users/RANDALL-hub/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/RANDALL-hub",
         "id" : 63138099,
         "login" : "RANDALL-hub",
         "node_id" : "MDQ6VXNlcjYzMTM4MDk5",
         "organizations_url" : "https://api.github.com/users/RANDALL-hub/orgs",
         "received_events_url" : "https://api.github.com/users/RANDALL-hub/received_events",
         "repos_url" : "https://api.github.com/users/RANDALL-hub/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/RANDALL-hub/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/RANDALL-hub/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/RANDALL-hub"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #16890 (rpc: Don't allow to 'estimatesmartfee' in blocksonly mode by darosior)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-04-05T07:24:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#issuecomment-609371900",
      "id" : 609371900,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18530",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwOTM3MTkwMA==",
      "updated_at" : "2020-04-05T07:24:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/609371900",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403700002"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403700002"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think if you add nopersistmempool, it will drop the tx from the mempool and you can reuse it for this test without having to construct it again. In fact the below construction looks similar to the one above, so the resulting tx might be the same, thus leading to test failures.\r\n\r\n```suggestion\r\n        self.start_node(0, [\"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\", \"-nopersistmempool\"])\r\n```",
      "commit_id" : "209da1b0597521806d392aa38ad0d8b760ef59dd",
      "created_at" : "2020-04-05T13:10:57Z",
      "diff_hunk" : "@@ -55,8 +55,51 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=1'.format(txid)]):\n             self.nodes[0].sendrawtransaction(sigtx)\n             self.nodes[0].p2p.wait_for_tx(txid)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid))\n             assert_equal(self.nodes[0].getmempoolinfo()['size'], 1)\n \n+        self.log.info(\"Restarting node 0 with whitelist permission and blocksonly\")\n+        self.stop_node(0)\n+        self.start_node(0, [\"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r403700002",
      "id" : 403700002,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcwMDAwMg==",
      "original_commit_id" : "d86dba18b06f1558c353beff335f6c03bd406008",
      "original_line" : 63,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : null,
      "pull_request_review_id" : 387817487,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-12T03:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403700002",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r404979914"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/404979914"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks Marco, going to try again with the suggestion!",
      "commit_id" : "209da1b0597521806d392aa38ad0d8b760ef59dd",
      "created_at" : "2020-04-07T17:18:44Z",
      "diff_hunk" : "@@ -55,8 +55,51 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=1'.format(txid)]):\n             self.nodes[0].sendrawtransaction(sigtx)\n             self.nodes[0].p2p.wait_for_tx(txid)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid))\n             assert_equal(self.nodes[0].getmempoolinfo()['size'], 1)\n \n+        self.log.info(\"Restarting node 0 with whitelist permission and blocksonly\")\n+        self.stop_node(0)\n+        self.start_node(0, [\"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r404979914",
      "id" : 404979914,
      "in_reply_to_id" : 403700002,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk3OTkxNA==",
      "original_commit_id" : "d86dba18b06f1558c353beff335f6c03bd406008",
      "original_line" : 63,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : null,
      "pull_request_review_id" : 389329192,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-12T03:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/404979914",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/38899812?v=4",
         "events_url" : "https://api.github.com/users/glowang/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glowang/followers",
         "following_url" : "https://api.github.com/users/glowang/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glowang/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glowang",
         "id" : 38899812,
         "login" : "glowang",
         "node_id" : "MDQ6VXNlcjM4ODk5ODEy",
         "organizations_url" : "https://api.github.com/users/glowang/orgs",
         "received_events_url" : "https://api.github.com/users/glowang/received_events",
         "repos_url" : "https://api.github.com/users/glowang/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glowang/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glowang/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glowang"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r405186143"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/405186143"
         }
      },
      "author_association" : "MEMBER",
      "body" : "On startup failures or general test failures, you can combine the logs to see the issue:\r\n\r\n```\r\n$ ./test/functional/combine_logs.py -c /tmp/bitcoin_func_test_wnpgbmh_  | tail \r\n                                     File \"/home/marco/workspace/btc_bitcoin_core/test/functional/test_framework/test_framework.py\", line 419, in start_node\r\n                                       node.wait_for_rpc_connection()\r\n                                     File \"/home/marco/workspace/btc_bitcoin_core/test/functional/test_framework/test_node.py\", line 217, in wait_for_rpc_connection\r\n                                       'bitcoind exited with status {} during initialization'.format(self.process.returncode)))\r\n                                   test_framework.test_node.FailedToStartError: [node 0] bitcoind exited with status 1 during initialization\r\n test  2020-04-08T00:11:49.629000Z TestFramework (DEBUG): Closing down network thread \r\n test  2020-04-08T00:11:49.680000Z TestFramework (INFO): Stopping nodes \r\n test  2020-04-08T00:11:49.681000Z TestFramework.node0 (DEBUG): Stopping node \r\n\r\n node0 stderr Error: Command line contains unexpected token 'persistmempool=0', see bitcoind -h for a list of options. \r\n",
      "commit_id" : "209da1b0597521806d392aa38ad0d8b760ef59dd",
      "created_at" : "2020-04-08T00:13:35Z",
      "diff_hunk" : "@@ -212,6 +212,7 @@ def wait_for_rpc_connection(self):\n         poll_per_s = 4\n         for _ in range(poll_per_s * self.rpc_timeout):\n             if self.process.poll() is not None:\n+                print('process poll is not NONE', self.process.poll()) #this outputs me 1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r405186143",
      "id" : 405186143,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE4NjE0Mw==",
      "original_commit_id" : "037f2d3d3352882e2521adffe8be58fb4d64d2f0",
      "original_line" : 215,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : null,
      "pull_request_review_id" : 389573709,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-12T03:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/405186143",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r405186243"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/405186243"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        self.restart_node(0, [\"-persistmempool=0\", \"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\"])\r\n```",
      "commit_id" : "209da1b0597521806d392aa38ad0d8b760ef59dd",
      "created_at" : "2020-04-08T00:13:48Z",
      "diff_hunk" : "@@ -55,8 +55,28 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=1'.format(txid)]):\n             self.nodes[0].sendrawtransaction(sigtx)\n             self.nodes[0].p2p.wait_for_tx(txid)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid))\n             assert_equal(self.nodes[0].getmempoolinfo()['size'], 1)\n \n+        self.log.info(\"Restarting node 0 with whitelist permission and blocksonly\")\n+        self.restart_node(0, [\"persistmempool=0\", \"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r405186243",
      "id" : 405186243,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE4NjI0Mw==",
      "original_commit_id" : "037f2d3d3352882e2521adffe8be58fb4d64d2f0",
      "original_line" : 62,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : null,
      "pull_request_review_id" : 389573787,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-12T03:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/405186243",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r405186596"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/405186596"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See also https://github.com/bitcoin/bitcoin/tree/master/test#test-logging\r\n\r\nI just ran the test with\r\n```\r\n$ ./test/functional/p2p_blocksonly.py --tracerpc -l DEBUG",
      "commit_id" : "209da1b0597521806d392aa38ad0d8b760ef59dd",
      "created_at" : "2020-04-08T00:14:58Z",
      "diff_hunk" : "@@ -212,6 +212,7 @@ def wait_for_rpc_connection(self):\n         poll_per_s = 4\n         for _ in range(poll_per_s * self.rpc_timeout):\n             if self.process.poll() is not None:\n+                print('process poll is not NONE', self.process.poll()) #this outputs me 1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r405186596",
      "id" : 405186596,
      "in_reply_to_id" : 405186143,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE4NjU5Ng==",
      "original_commit_id" : "037f2d3d3352882e2521adffe8be58fb4d64d2f0",
      "original_line" : 215,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : null,
      "pull_request_review_id" : 389574179,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-12T03:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/405186596",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r407129597"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407129597"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You will need at least three (mini)nodes if you want to check what you claim to be wanting to check. \"Check that txs from whitelisted peers are not rejected and relayed to others\"\r\n\r\nwhitlisted peer --- tx ---> Bitcoin Core ---- tx -----> another peer\r\n\r\n```suggestion\r\n            another_peer = self.nodes[0].add_p2p_connection(P2PInterface())\r\n            ... etc\r\n```",
      "commit_id" : "209da1b0597521806d392aa38ad0d8b760ef59dd",
      "created_at" : "2020-04-12T01:04:50Z",
      "diff_hunk" : "@@ -55,8 +55,29 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=1'.format(txid)]):\n             self.nodes[0].sendrawtransaction(sigtx)\n             self.nodes[0].p2p.wait_for_tx(txid)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid))\n             assert_equal(self.nodes[0].getmempoolinfo()['size'], 1)\n \n+        self.log.info(\"Restarting node 0 with whitelist permission and blocksonly\")\n+        self.restart_node(0, [\"-persistmempool=0\", \"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\"])\n+        self.log.info('Check that txs from whitelisted peers are not rejected and relayed to others')\n+        self.nodes[0].add_p2p_connection(P2PInterface())\n+        peerInfo = self.nodes[0].getpeerinfo()[0]\n+        assert_equal(peerInfo['whitelisted'], True)\n+        assert_equal(peerInfo['permissions'], ['noban', 'forcerelay', 'relay', 'mempool']) #checkpermission use check permission from p2p_permission\n+\n+        self.nodes[0].p2p.send_message(msg_tx(FromHex(CTransaction(), sigtx)))\n+\n+        pprint(self.nodes[0].p2p.last_message)\n+        pprint(self.nodes[0].p2p.last_message.get('tx'))\n+\n+        assert_equal(self.nodes[0].p2p.is_connected, True)\n+        with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=0'.format(txid)]):\n+            self.nodes[0].sendrawtransaction(sigtx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r407129597",
      "id" : 407129597,
      "line" : 76,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzEyOTU5Nw==",
      "original_commit_id" : "bc432ee0b3d1200aafc8bf935f2010d595d67e6a",
      "original_line" : 76,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : 29,
      "pull_request_review_id" : 391812134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-12T03:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407129597",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r407136294"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407136294"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Achso! I **thnk** I know why I am erroring...I couldn't figure out why `self.nodes[0].p2p.wait_for_tx(txid)` kept timing out(line 77)...but little did I realized that  this tx was originated by `self.nodes[0].p2p` hence it wouldn't hear this transaction again?? And instead, `another_peer.wait_for_tx(txid)` would be the correct thing to check for..?",
      "commit_id" : "209da1b0597521806d392aa38ad0d8b760ef59dd",
      "created_at" : "2020-04-12T02:36:07Z",
      "diff_hunk" : "@@ -55,8 +55,29 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=1'.format(txid)]):\n             self.nodes[0].sendrawtransaction(sigtx)\n             self.nodes[0].p2p.wait_for_tx(txid)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid))\n             assert_equal(self.nodes[0].getmempoolinfo()['size'], 1)\n \n+        self.log.info(\"Restarting node 0 with whitelist permission and blocksonly\")\n+        self.restart_node(0, [\"-persistmempool=0\", \"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\"])\n+        self.log.info('Check that txs from whitelisted peers are not rejected and relayed to others')\n+        self.nodes[0].add_p2p_connection(P2PInterface())\n+        peerInfo = self.nodes[0].getpeerinfo()[0]\n+        assert_equal(peerInfo['whitelisted'], True)\n+        assert_equal(peerInfo['permissions'], ['noban', 'forcerelay', 'relay', 'mempool']) #checkpermission use check permission from p2p_permission\n+\n+        self.nodes[0].p2p.send_message(msg_tx(FromHex(CTransaction(), sigtx)))\n+\n+        pprint(self.nodes[0].p2p.last_message)\n+        pprint(self.nodes[0].p2p.last_message.get('tx'))\n+\n+        assert_equal(self.nodes[0].p2p.is_connected, True)\n+        with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=0'.format(txid)]):\n+            self.nodes[0].sendrawtransaction(sigtx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r407136294",
      "id" : 407136294,
      "in_reply_to_id" : 407129597,
      "line" : 76,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzEzNjI5NA==",
      "original_commit_id" : "bc432ee0b3d1200aafc8bf935f2010d595d67e6a",
      "original_line" : 76,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : 29,
      "pull_request_review_id" : 391816204,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-12T03:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407136294",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/38899812?v=4",
         "events_url" : "https://api.github.com/users/glowang/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glowang/followers",
         "following_url" : "https://api.github.com/users/glowang/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glowang/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glowang",
         "id" : 38899812,
         "login" : "glowang",
         "node_id" : "MDQ6VXNlcjM4ODk5ODEy",
         "organizations_url" : "https://api.github.com/users/glowang/orgs",
         "received_events_url" : "https://api.github.com/users/glowang/received_events",
         "repos_url" : "https://api.github.com/users/glowang/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glowang/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glowang/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glowang"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r407137006"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407137006"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Also, this has been unclear to me:\r\nline 69 suggests to me that it is nodes[0]'s peer who sends out the transaction, which should be received by node[0]. We want to test whether node[0] would accept and relay this tx. This is aligned with purpose of the test.\r\n\r\nHowever, on line 24, 33, and line 76, it seems to be that node[0] is the one who initiates the transaction, zB ` self.nodes[0].sendrawtransaction(sigtx)`. As a relay node (of the peer node[0].p2p), why is node[0] creating, signing, and transaction then?",
      "commit_id" : "209da1b0597521806d392aa38ad0d8b760ef59dd",
      "created_at" : "2020-04-12T02:44:56Z",
      "diff_hunk" : "@@ -55,8 +55,29 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=1'.format(txid)]):\n             self.nodes[0].sendrawtransaction(sigtx)\n             self.nodes[0].p2p.wait_for_tx(txid)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid))\n             assert_equal(self.nodes[0].getmempoolinfo()['size'], 1)\n \n+        self.log.info(\"Restarting node 0 with whitelist permission and blocksonly\")\n+        self.restart_node(0, [\"-persistmempool=0\", \"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\"])\n+        self.log.info('Check that txs from whitelisted peers are not rejected and relayed to others')\n+        self.nodes[0].add_p2p_connection(P2PInterface())\n+        peerInfo = self.nodes[0].getpeerinfo()[0]\n+        assert_equal(peerInfo['whitelisted'], True)\n+        assert_equal(peerInfo['permissions'], ['noban', 'forcerelay', 'relay', 'mempool']) #checkpermission use check permission from p2p_permission\n+\n+        self.nodes[0].p2p.send_message(msg_tx(FromHex(CTransaction(), sigtx)))\n+\n+        pprint(self.nodes[0].p2p.last_message)\n+        pprint(self.nodes[0].p2p.last_message.get('tx'))\n+\n+        assert_equal(self.nodes[0].p2p.is_connected, True)\n+        with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=0'.format(txid)]):\n+            self.nodes[0].sendrawtransaction(sigtx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r407137006",
      "id" : 407137006,
      "line" : 76,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzEzNzAwNg==",
      "original_commit_id" : "bc432ee0b3d1200aafc8bf935f2010d595d67e6a",
      "original_line" : 76,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : 29,
      "pull_request_review_id" : 391816612,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-12T03:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407137006",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/38899812?v=4",
         "events_url" : "https://api.github.com/users/glowang/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glowang/followers",
         "following_url" : "https://api.github.com/users/glowang/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glowang/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glowang",
         "id" : 38899812,
         "login" : "glowang",
         "node_id" : "MDQ6VXNlcjM4ODk5ODEy",
         "organizations_url" : "https://api.github.com/users/glowang/orgs",
         "received_events_url" : "https://api.github.com/users/glowang/received_events",
         "repos_url" : "https://api.github.com/users/glowang/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glowang/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glowang/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glowang"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r407137042"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407137042"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke  It would be really great if you could clarify this too",
      "commit_id" : "209da1b0597521806d392aa38ad0d8b760ef59dd",
      "created_at" : "2020-04-12T02:45:22Z",
      "diff_hunk" : "@@ -55,8 +55,29 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=1'.format(txid)]):\n             self.nodes[0].sendrawtransaction(sigtx)\n             self.nodes[0].p2p.wait_for_tx(txid)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid))\n             assert_equal(self.nodes[0].getmempoolinfo()['size'], 1)\n \n+        self.log.info(\"Restarting node 0 with whitelist permission and blocksonly\")\n+        self.restart_node(0, [\"-persistmempool=0\", \"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\"])\n+        self.log.info('Check that txs from whitelisted peers are not rejected and relayed to others')\n+        self.nodes[0].add_p2p_connection(P2PInterface())\n+        peerInfo = self.nodes[0].getpeerinfo()[0]\n+        assert_equal(peerInfo['whitelisted'], True)\n+        assert_equal(peerInfo['permissions'], ['noban', 'forcerelay', 'relay', 'mempool']) #checkpermission use check permission from p2p_permission\n+\n+        self.nodes[0].p2p.send_message(msg_tx(FromHex(CTransaction(), sigtx)))\n+\n+        pprint(self.nodes[0].p2p.last_message)\n+        pprint(self.nodes[0].p2p.last_message.get('tx'))\n+\n+        assert_equal(self.nodes[0].p2p.is_connected, True)\n+        with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=0'.format(txid)]):\n+            self.nodes[0].sendrawtransaction(sigtx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r407137042",
      "id" : 407137042,
      "in_reply_to_id" : 407137006,
      "line" : 76,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzEzNzA0Mg==",
      "original_commit_id" : "bc432ee0b3d1200aafc8bf935f2010d595d67e6a",
      "original_line" : 76,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : 29,
      "pull_request_review_id" : 391816637,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-12T03:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407137042",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/38899812?v=4",
         "events_url" : "https://api.github.com/users/glowang/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glowang/followers",
         "following_url" : "https://api.github.com/users/glowang/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glowang/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glowang",
         "id" : 38899812,
         "login" : "glowang",
         "node_id" : "MDQ6VXNlcjM4ODk5ODEy",
         "organizations_url" : "https://api.github.com/users/glowang/orgs",
         "received_events_url" : "https://api.github.com/users/glowang/received_events",
         "repos_url" : "https://api.github.com/users/glowang/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glowang/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glowang/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glowang"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r407261799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407261799"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> And instead, another_peer.wait_for_tx(txid) would be the correct thing to check for..?\r\n\r\nCorrect",
      "commit_id" : "209da1b0597521806d392aa38ad0d8b760ef59dd",
      "created_at" : "2020-04-12T22:46:05Z",
      "diff_hunk" : "@@ -55,8 +55,29 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=1'.format(txid)]):\n             self.nodes[0].sendrawtransaction(sigtx)\n             self.nodes[0].p2p.wait_for_tx(txid)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid))\n             assert_equal(self.nodes[0].getmempoolinfo()['size'], 1)\n \n+        self.log.info(\"Restarting node 0 with whitelist permission and blocksonly\")\n+        self.restart_node(0, [\"-persistmempool=0\", \"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\"])\n+        self.log.info('Check that txs from whitelisted peers are not rejected and relayed to others')\n+        self.nodes[0].add_p2p_connection(P2PInterface())\n+        peerInfo = self.nodes[0].getpeerinfo()[0]\n+        assert_equal(peerInfo['whitelisted'], True)\n+        assert_equal(peerInfo['permissions'], ['noban', 'forcerelay', 'relay', 'mempool']) #checkpermission use check permission from p2p_permission\n+\n+        self.nodes[0].p2p.send_message(msg_tx(FromHex(CTransaction(), sigtx)))\n+\n+        pprint(self.nodes[0].p2p.last_message)\n+        pprint(self.nodes[0].p2p.last_message.get('tx'))\n+\n+        assert_equal(self.nodes[0].p2p.is_connected, True)\n+        with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=0'.format(txid)]):\n+            self.nodes[0].sendrawtransaction(sigtx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r407261799",
      "id" : 407261799,
      "in_reply_to_id" : 407129597,
      "line" : 76,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzI2MTc5OQ==",
      "original_commit_id" : "bc432ee0b3d1200aafc8bf935f2010d595d67e6a",
      "original_line" : 76,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : 29,
      "pull_request_review_id" : 391901392,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-12T22:46:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407261799",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r407262179"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407262179"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`self.nodes[0]` is the Bitcoin Core node \"in the middle\". I suggest not using self.nodes[0].p2p at all and instead assigning the peers proper names. You did that with `first_peer`, `second_peer`.\r\n\r\n`first_peer` and `second_peer` are *not* Bitcoin Core nodes, but python mininodes (mock nodes).\r\n\r\nWhen you say `self.nodes[0].sendrawtransacttion`, I believe you really meant `first_peer.send_message(msg_tx(FromHex(CTransaction(), sigtx)))`?",
      "commit_id" : "209da1b0597521806d392aa38ad0d8b760ef59dd",
      "created_at" : "2020-04-12T22:50:03Z",
      "diff_hunk" : "@@ -55,8 +55,29 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=1'.format(txid)]):\n             self.nodes[0].sendrawtransaction(sigtx)\n             self.nodes[0].p2p.wait_for_tx(txid)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid))\n             assert_equal(self.nodes[0].getmempoolinfo()['size'], 1)\n \n+        self.log.info(\"Restarting node 0 with whitelist permission and blocksonly\")\n+        self.restart_node(0, [\"-persistmempool=0\", \"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\"])\n+        self.log.info('Check that txs from whitelisted peers are not rejected and relayed to others')\n+        self.nodes[0].add_p2p_connection(P2PInterface())\n+        peerInfo = self.nodes[0].getpeerinfo()[0]\n+        assert_equal(peerInfo['whitelisted'], True)\n+        assert_equal(peerInfo['permissions'], ['noban', 'forcerelay', 'relay', 'mempool']) #checkpermission use check permission from p2p_permission\n+\n+        self.nodes[0].p2p.send_message(msg_tx(FromHex(CTransaction(), sigtx)))\n+\n+        pprint(self.nodes[0].p2p.last_message)\n+        pprint(self.nodes[0].p2p.last_message.get('tx'))\n+\n+        assert_equal(self.nodes[0].p2p.is_connected, True)\n+        with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=0'.format(txid)]):\n+            self.nodes[0].sendrawtransaction(sigtx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r407262179",
      "id" : 407262179,
      "in_reply_to_id" : 407137006,
      "line" : 76,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzI2MjE3OQ==",
      "original_commit_id" : "bc432ee0b3d1200aafc8bf935f2010d595d67e6a",
      "original_line" : 76,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : 29,
      "pull_request_review_id" : 391901641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-12T22:51:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407262179",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r410727651"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410727651"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think what confuses me is the existing code line 56 uses this construct too: `   self.nodes[0].sendrawtransaction(sigtx)` so I kind of mimicked that line ð  Does this mean that line 56 should be fixed too?",
      "commit_id" : "209da1b0597521806d392aa38ad0d8b760ef59dd",
      "created_at" : "2020-04-18T17:39:37Z",
      "diff_hunk" : "@@ -55,8 +55,29 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=1'.format(txid)]):\n             self.nodes[0].sendrawtransaction(sigtx)\n             self.nodes[0].p2p.wait_for_tx(txid)\n+            pprint(self.nodes[0].p2p.wait_for_tx(txid))\n             assert_equal(self.nodes[0].getmempoolinfo()['size'], 1)\n \n+        self.log.info(\"Restarting node 0 with whitelist permission and blocksonly\")\n+        self.restart_node(0, [\"-persistmempool=0\", \"-whitelist=127.0.0.1\", \"-whitelistforcerelay\", \"-blocksonly\"])\n+        self.log.info('Check that txs from whitelisted peers are not rejected and relayed to others')\n+        self.nodes[0].add_p2p_connection(P2PInterface())\n+        peerInfo = self.nodes[0].getpeerinfo()[0]\n+        assert_equal(peerInfo['whitelisted'], True)\n+        assert_equal(peerInfo['permissions'], ['noban', 'forcerelay', 'relay', 'mempool']) #checkpermission use check permission from p2p_permission\n+\n+        self.nodes[0].p2p.send_message(msg_tx(FromHex(CTransaction(), sigtx)))\n+\n+        pprint(self.nodes[0].p2p.last_message)\n+        pprint(self.nodes[0].p2p.last_message.get('tx'))\n+\n+        assert_equal(self.nodes[0].p2p.is_connected, True)\n+        with self.nodes[0].assert_debug_log(['received getdata for: tx {} peer=0'.format(txid)]):\n+            self.nodes[0].sendrawtransaction(sigtx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18530#discussion_r410727651",
      "id" : 410727651,
      "in_reply_to_id" : 407137006,
      "line" : 76,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcyNzY1MQ==",
      "original_commit_id" : "bc432ee0b3d1200aafc8bf935f2010d595d67e6a",
      "original_line" : 76,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : 29,
      "pull_request_review_id" : 395934904,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18530",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-18T17:39:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410727651",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/38899812?v=4",
         "events_url" : "https://api.github.com/users/glowang/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glowang/followers",
         "following_url" : "https://api.github.com/users/glowang/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glowang/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glowang",
         "id" : 38899812,
         "login" : "glowang",
         "node_id" : "MDQ6VXNlcjM4ODk5ODEy",
         "organizations_url" : "https://api.github.com/users/glowang/orgs",
         "received_events_url" : "https://api.github.com/users/glowang/received_events",
         "repos_url" : "https://api.github.com/users/glowang/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glowang/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glowang/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glowang"
      }
   }
]
