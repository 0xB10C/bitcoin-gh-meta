[
   {
      "body" : "Prior development work subsumed in this request: #3883 #4450 #4484\r\nGuidance and contributions so far from the following: @gavinandresen @mikehearn @petertodd @SergioDemianLerner @laanwj @sipa @jgarzik @gmaxwell @drak @Diapolo\r\n",
      "created_at" : "2014-07-22T07:13:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4570#issuecomment-49705678",
      "id" : 49705678,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4570",
      "updated_at" : "2014-07-22T07:13:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/49705678",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4284124?v=3",
         "events_url" : "https://api.github.com/users/dgenr8/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dgenr8/followers",
         "following_url" : "https://api.github.com/users/dgenr8/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dgenr8/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dgenr8",
         "id" : 4284124,
         "login" : "dgenr8",
         "organizations_url" : "https://api.github.com/users/dgenr8/orgs",
         "received_events_url" : "https://api.github.com/users/dgenr8/received_events",
         "repos_url" : "https://api.github.com/users/dgenr8/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dgenr8/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dgenr8/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dgenr8"
      }
   },
   {
      "body" : "UI needs to have a more restrictive idea of what is a double-spend. Make it only trigger the UI display of a double-spend if the double-spend doesn't pay you at least as much as the previous tx.\r\n\r\nRight now this warning will be set off by accident in many cases, for instance wallets like GreenAddress.it where dual-factor controls expire after some time period, allowing the txouts to be spent with more than one scriptSig.",
      "created_at" : "2014-07-22T20:45:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4570#issuecomment-49798175",
      "id" : 49798175,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4570",
      "updated_at" : "2014-07-22T20:45:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/49798175",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "Also there are valid double spend cases employed in contract protocols.  For example, payment channels rely on only-A-or-B-is-valid protocol property to guarantee that the payment channel refund transaction OR the payment channel payment transaction is valid, but not both.",
      "created_at" : "2014-07-22T20:57:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4570#issuecomment-49799833",
      "id" : 49799833,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4570",
      "updated_at" : "2014-07-22T20:57:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/49799833",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "@jgarzik Are there double-spend cases where an alert would be undesirable?\r\n\r\nFor a payment channel, merchant would get an alert for the known attack where merchant claims payment close to the refund unlock time, then customer broadcasts the refund transaction as a double-spend as soon as it unlocks.",
      "created_at" : "2014-07-22T23:42:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4570#issuecomment-49816133",
      "id" : 49816133,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4570",
      "updated_at" : "2014-07-22T23:56:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/49816133",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4284124?v=3",
         "events_url" : "https://api.github.com/users/dgenr8/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dgenr8/followers",
         "following_url" : "https://api.github.com/users/dgenr8/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dgenr8/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dgenr8",
         "id" : 4284124,
         "login" : "dgenr8",
         "organizations_url" : "https://api.github.com/users/dgenr8/orgs",
         "received_events_url" : "https://api.github.com/users/dgenr8/received_events",
         "repos_url" : "https://api.github.com/users/dgenr8/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dgenr8/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dgenr8/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dgenr8"
      }
   },
   {
      "body" : "@petertodd That is a bit of a minefield.  Consider these 3 transactions \r\n```\r\n In       Paysme\r\ntx1-1\r\n coin1      1\r\n\r\ntx1-2\r\n coin2      1\r\n\r\ntx2\r\n coin1      1\r\n coin2\r\n```\r\ntx2 double-spends both tx1-1 and tx1-2.  It pays as much as either one alone, but is not innocuous because it can stop both of them from confirming.  What the UI currently does is highlight both tx1-1 and tx1-2 (conflict seen).  tx2 is displayed (only because it pays us), and is also highlighted because it is a non-clone conflict.\r\n\r\nRe: GreenAddress can you connect the dots for me?  How does the script getting more permissive imply it's not important to alert if the coin is spent twice?\r\n",
      "created_at" : "2014-07-23T01:13:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4570#issuecomment-49822001",
      "id" : 49822001,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4570",
      "updated_at" : "2014-07-23T02:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/49822001",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4284124?v=3",
         "events_url" : "https://api.github.com/users/dgenr8/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dgenr8/followers",
         "following_url" : "https://api.github.com/users/dgenr8/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dgenr8/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dgenr8",
         "id" : 4284124,
         "login" : "dgenr8",
         "organizations_url" : "https://api.github.com/users/dgenr8/orgs",
         "received_events_url" : "https://api.github.com/users/dgenr8/received_events",
         "repos_url" : "https://api.github.com/users/dgenr8/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dgenr8/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dgenr8/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dgenr8"
      }
   },
   {
      "body" : "@dgenr8 I don't think anyone said implementing this correctly would be easy ;)",
      "created_at" : "2014-07-23T01:16:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4570#issuecomment-49822207",
      "id" : 49822207,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4570",
      "updated_at" : "2014-07-23T01:16:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/49822207",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "@luke-jr It wasn't ;P  The example can be made arbitrarily complex by making overlapping groups of conflicts.  The wording is careful -- another transaction was seen spending the money you think you're getting [unsaid -- there may be a third that you haven't seen].  Best to wait for confirmation.",
      "created_at" : "2014-07-23T02:50:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4570#issuecomment-49827373",
      "id" : 49827373,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4570",
      "updated_at" : "2014-07-23T02:50:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/49827373",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4284124?v=3",
         "events_url" : "https://api.github.com/users/dgenr8/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dgenr8/followers",
         "following_url" : "https://api.github.com/users/dgenr8/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dgenr8/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dgenr8",
         "id" : 4284124,
         "login" : "dgenr8",
         "organizations_url" : "https://api.github.com/users/dgenr8/orgs",
         "received_events_url" : "https://api.github.com/users/dgenr8/received_events",
         "repos_url" : "https://api.github.com/users/dgenr8/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dgenr8/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dgenr8/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dgenr8"
      }
   },
   {
      "body" : "@dgenr8 You've also forgotten the case there tx2 spends tx1 and tx1 is double-spent. You're code doesn't right now warn users if they're only paid by tx2. Probably better to remove the UI stuff in this patch for now; make it a separate patch.",
      "created_at" : "2014-07-23T03:41:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4570#issuecomment-49829720",
      "id" : 49829720,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4570",
      "updated_at" : "2014-07-23T03:41:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/49829720",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "@dgenr8 Warning users about perfectly reasonable behaviour is not appropriate. And you should always wait for confirmation if you need confirmation, period.",
      "created_at" : "2014-07-23T03:53:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4570#issuecomment-49830281",
      "id" : 49830281,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4570",
      "updated_at" : "2014-07-23T03:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/49830281",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "@petertodd Thank you.  Proper alerts for a double-spend of an unconfirmed parent will require adding the branch of unconfirmed parents to the wallet at the time the child is first added.\r\n\r\nI'd like to get feedback on whether anyone sees a problem with this.  These parents would be persistent like all wallet txes, and would not be displayed unless they are IsMine/IsFromMe themselves.  They were already allowed into the mempool.",
      "created_at" : "2014-07-23T22:32:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4570#issuecomment-49945425",
      "id" : 49945425,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4570",
      "updated_at" : "2014-12-11T00:27:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/49945425",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4284124?v=3",
         "events_url" : "https://api.github.com/users/dgenr8/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dgenr8/followers",
         "following_url" : "https://api.github.com/users/dgenr8/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dgenr8/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dgenr8",
         "id" : 4284124,
         "login" : "dgenr8",
         "organizations_url" : "https://api.github.com/users/dgenr8/orgs",
         "received_events_url" : "https://api.github.com/users/dgenr8/received_events",
         "repos_url" : "https://api.github.com/users/dgenr8/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dgenr8/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dgenr8/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dgenr8"
      }
   },
   {
      "body" : "Lately, miners are pretty consistently [not mining respends](http://respends.thinlink.com/) if they occur quickly, apparently up to a day or so after the first spend.\r\n\r\nThat is nice, but the network still buries respends.  Accepting 0-conf payments is still susceptible to the following attack, even if all miners are nice:\r\n\r\nWhen ready to \"pay,\" attacker first transmits a bunch of transactions tx1 paying self, each from a different coin cX.  Then, at a succession of time offsets, he transmits a respend of each coin to the target.\r\n\r\nThe goal is for at least one tx2 to be seen by the *target first*, but the eventual *miner second*.  An additional constant input c0 is included in all the tx2 to ensure that in an adverse scenario for attacker, the target can only be paid once at most.  Change is not shown:\r\n```\r\nrespends=20  offset=.40s  offset increment=.05s\r\n\r\ntx1               elapsed        tx2\r\nc1 -> self          .40s         c1 + c0 -> target\r\nc2 -> self          .45s         c2 + c0 -> target\r\n...\r\nc20 -> self        1.35s         c20 + c0 -> target\r\n\r\nWorst-case value to attacker: -20*fee\r\nBest-case value to attacker: (value of goods or services) - 19*fee\r\n```\r\nRespend relay, with a properly monitored alert, is an effective countermeasure to this attack.  Target would be alerted almost immediately to withhold goods or services.\r\n\r\nIn addition to tuning the parameters, the attacker can use diverse nodes to gain variability in the timings, helping at least one pair to achieve the goal.\r\n",
      "created_at" : "2014-08-23T01:22:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4570#issuecomment-53138831",
      "id" : 53138831,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4570",
      "updated_at" : "2014-08-26T00:15:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53138831",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4284124?v=3",
         "events_url" : "https://api.github.com/users/dgenr8/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dgenr8/followers",
         "following_url" : "https://api.github.com/users/dgenr8/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dgenr8/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dgenr8",
         "id" : 4284124,
         "login" : "dgenr8",
         "organizations_url" : "https://api.github.com/users/dgenr8/orgs",
         "received_events_url" : "https://api.github.com/users/dgenr8/received_events",
         "repos_url" : "https://api.github.com/users/dgenr8/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dgenr8/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dgenr8/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dgenr8"
      }
   },
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/p4570_d17d9ccf44625207415e6450171579ce8351c99d/ for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.",
      "created_at" : "2014-09-20T21:09:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4570#issuecomment-56280462",
      "id" : 56280462,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4570",
      "updated_at" : "2014-09-20T21:09:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/56280462",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   }
]
