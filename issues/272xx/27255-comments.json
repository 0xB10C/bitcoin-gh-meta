[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [michaelfolkson](https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1468032095) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2023-03-14T12:24:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1468010901",
      "id" : 1468010901,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585XgBGV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1468010901/reactions"
      },
      "updated_at" : "2023-03-14T12:40:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1468010901",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK, an important piece in opening up Taproot scripting.\r\n\r\n> The design of Miniscript for Tapscript is the result of discussions between various people over the past year(s).\r\n\r\nYour PR description is great but perhaps you can link to a few of those discussions for extra background reading for those that are interested? e.g. https://gist.github.com/sipa/06c5c844df155d4e5044c2c8cac9c05e\r\n\r\nAlso just checking if this PR should be in Draft or not? Are there ongoing open discussions on anything important or is this ready for extensive review?\r\n\r\n",
      "created_at" : "2023-03-14T12:40:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1468032095",
      "id" : 1468032095,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585XgGRf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1468032095/reactions"
      },
      "updated_at" : "2023-03-14T12:40:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1468032095",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yeah, thanks for the suggestion. Reviewers may be interested in https://github.com/sipa/miniscript/pull/134 as well.\r\n\r\n> Also just checking if this PR should be in Draft or not? Are there ongoing open discussions on anything important or is this ready for extensive review?\r\n\r\nIt is ready for (extensive or not) review. Otherwise i'd have opened it as a draft. But please tell me clearly if you disagree.",
      "created_at" : "2023-03-14T14:31:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1468209943",
      "id" : 1468209943,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585XgxsX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1468209943/reactions"
      },
      "updated_at" : "2023-03-14T14:31:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1468209943",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This PR removes the witness script push accounting in the Miniscript stack size checks, so as it stands it would actually make it possible to import a `wsh()` descriptor that would be unspendable by standardness since we currently only check whether the underlying Miniscript `IsSane()`.\r\n\r\nThe same holds for `tr()` descriptors generally, as a Miniscript may well be `IsSane()` on its own but not spendable if buried deep enough in a Taproot tree.\r\n\r\nBoth could be checked at parsing time, but it also makes me think (in relation to #27104) we could introduce an `IsSane()` at the descriptor level.",
      "created_at" : "2023-03-14T14:58:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1468263557",
      "id" : 1468263557,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585Xg-yF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1468263557/reactions"
      },
      "updated_at" : "2023-03-14T14:58:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1468263557",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1136724397"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1136724397"
         }
      },
      "author_association" : "NONE",
      "body" : "Perhaps `multi_a` for consistency, since `multi` is a valid fragment elsewhere?\r\nOr `Tapscript multisig` if you want to explicitly _not_ refer to the fragment.",
      "commit_id" : "33f28a8d472a2869d37e40f5f9d7efd7f88bcc89",
      "created_at" : "2023-03-15T08:57:45Z",
      "diff_hunk" : "@@ -1901,7 +2136,38 @@ inline NodeRef<Key> DecodeScript(I& in, I last, const Ctx& ctx)\n                 if (!k || *k < 1 || *k > *n) return {};\n                 in += 3 + *n;\n                 std::reverse(keys.begin(), keys.end());\n-                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, Fragment::MULTI, std::move(keys), *k));\n+                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, ctx, Fragment::MULTI, std::move(keys), *k));\n+                break;\n+            }\n+            // Tapscript's multi",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1136724397",
      "id" : 1136724397,
      "line" : 2142,
      "node_id" : "PRRC_kwDOABII585DwQmt",
      "original_commit_id" : "33f28a8d472a2869d37e40f5f9d7efd7f88bcc89",
      "original_line" : 2142,
      "original_position" : 965,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 965,
      "pull_request_review_id" : 1340932665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1136724397/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T08:57:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1136724397",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6681844?v=4",
         "events_url" : "https://api.github.com/users/bigspider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bigspider/followers",
         "following_url" : "https://api.github.com/users/bigspider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bigspider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bigspider",
         "id" : 6681844,
         "login" : "bigspider",
         "node_id" : "MDQ6VXNlcjY2ODE4NDQ=",
         "organizations_url" : "https://api.github.com/users/bigspider/orgs",
         "received_events_url" : "https://api.github.com/users/bigspider/received_events",
         "repos_url" : "https://api.github.com/users/bigspider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bigspider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bigspider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bigspider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1137201661"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137201661"
         }
      },
      "author_association" : "NONE",
      "body" : "It might be worth explicitly enumerating both the known contexts, and have a defensive final  `assert(false);`.\r\nSimilarly for other places where the context is accessed).",
      "commit_id" : "33f28a8d472a2869d37e40f5f9d7efd7f88bcc89",
      "created_at" : "2023-03-15T14:42:41Z",
      "diff_hunk" : "@@ -1188,23 +1188,28 @@ struct Node {\n     //! Return the number of ops in the script (not counting the dynamic ones that depend on execution).\n     uint32_t GetStaticOps() const { return ops.count; }\n \n-    //! Check the ops limit of this script against the consensus limit.\n-    bool CheckOpsLimit() const { return GetOps() <= MAX_OPS_PER_SCRIPT; }\n+    //! Check the ops limit of this script against the consensus limit. This limit is only present for P2WSH.\n+    template <typename Ctx> bool CheckOpsLimit(const Ctx& ctx) const {\n+        return ctx.MsContext() == MiniscriptContext::TAPSCRIPT || GetOps() <= MAX_OPS_PER_SCRIPT;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1137201661",
      "id" : 1137201661,
      "line" : 1320,
      "node_id" : "PRRC_kwDOABII585DyFH9",
      "original_commit_id" : "62d31e6c7bc190602b0a89a1ff330a2bf6aefbf3",
      "original_line" : 1194,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 407,
      "pull_request_review_id" : 1341664972,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137201661/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T14:42:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137201661",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6681844?v=4",
         "events_url" : "https://api.github.com/users/bigspider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bigspider/followers",
         "following_url" : "https://api.github.com/users/bigspider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bigspider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bigspider",
         "id" : 6681844,
         "login" : "bigspider",
         "node_id" : "MDQ6VXNlcjY2ODE4NDQ=",
         "organizations_url" : "https://api.github.com/users/bigspider/orgs",
         "received_events_url" : "https://api.github.com/users/bigspider/received_events",
         "repos_url" : "https://api.github.com/users/bigspider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bigspider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bigspider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bigspider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1137224005"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137224005"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I could have a `IsTapscript(ctx)` helper that does that next to the `MiniscriptContext` enum. It could then be used in all those places to not have to duplicate the verbose `switch () ... assert(false)`.",
      "commit_id" : "33f28a8d472a2869d37e40f5f9d7efd7f88bcc89",
      "created_at" : "2023-03-15T14:55:02Z",
      "diff_hunk" : "@@ -1188,23 +1188,28 @@ struct Node {\n     //! Return the number of ops in the script (not counting the dynamic ones that depend on execution).\n     uint32_t GetStaticOps() const { return ops.count; }\n \n-    //! Check the ops limit of this script against the consensus limit.\n-    bool CheckOpsLimit() const { return GetOps() <= MAX_OPS_PER_SCRIPT; }\n+    //! Check the ops limit of this script against the consensus limit. This limit is only present for P2WSH.\n+    template <typename Ctx> bool CheckOpsLimit(const Ctx& ctx) const {\n+        return ctx.MsContext() == MiniscriptContext::TAPSCRIPT || GetOps() <= MAX_OPS_PER_SCRIPT;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1137224005",
      "id" : 1137224005,
      "in_reply_to_id" : 1137201661,
      "line" : 1320,
      "node_id" : "PRRC_kwDOABII585DyKlF",
      "original_commit_id" : "62d31e6c7bc190602b0a89a1ff330a2bf6aefbf3",
      "original_line" : 1194,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 407,
      "pull_request_review_id" : 1341692112,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137224005/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T14:55:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137224005",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   }
]
