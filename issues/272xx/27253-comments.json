[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [brunoerg](https://github.com/bitcoin/bitcoin/pull/27253#pullrequestreview-1339187663), [vasild](https://github.com/bitcoin/bitcoin/pull/27253#issuecomment-1480921094) |\n| Stale ACK | [stickies-v](https://github.com/bitcoin/bitcoin/pull/27253#pullrequestreview-1352688865) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2023-03-14T04:22:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#issuecomment-1467334860",
      "id" : 1467334860,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27253",
      "node_id" : "IC_kwDOABII585XdcDM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1467334860/reactions"
      },
      "updated_at" : "2023-03-23T10:11:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1467334860",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> What do you think?\r\n\r\nAs @stickies-v explained to me outside this PR: \"... by moving the uri parsing to http_request_cb we're failing super early, and even when the query parameter would never be called by the endpoint... \", this makes more sense.\r\n\r\nI'm working on this approach which I think it's better as well.",
      "created_at" : "2023-03-14T21:14:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#issuecomment-1468854086",
      "id" : 1468854086,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27253",
      "node_id" : "IC_kwDOABII585XjO9G",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1468854086/reactions"
      },
      "updated_at" : "2023-03-14T21:14:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1468854086",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1139143140"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139143140"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit\r\n```suggestion\r\n    if (!m_uri_parsed) return std::nullopt;\r\n```",
      "commit_id" : "d16effe8cb2c18b72eeda596c4d3cf0c38b93263",
      "created_at" : "2023-03-16T17:46:13Z",
      "diff_hunk" : "@@ -663,17 +674,10 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n-std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key) const\n+std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key)\n {\n-    const char* uri{evhttp_request_get_uri(req)};\n-\n-    return GetQueryParameterFromUri(uri, key);\n-}\n-\n-std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key)\n-{\n-    evhttp_uri* uri_parsed{evhttp_uri_parse(uri)};\n-    const char* query{evhttp_uri_get_query(uri_parsed)};\n+    if (!m_uri_parsed) { return std::nullopt; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1139143140",
      "id" : 1139143140,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D5fHk",
      "original_commit_id" : "02cbb583271cabe1b4062525dea785ea21796462",
      "original_line" : 679,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_review_id" : 1344413373,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139143140/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-16T18:12:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139143140",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated changes:\r\n- move the validation/parsing logic up in the stack as soon as the request is initiated even before the work item thread is created\r\n- updated unit and functional tests",
      "created_at" : "2023-03-16T17:59:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#issuecomment-1472457091",
      "id" : 1472457091,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27253",
      "node_id" : "IC_kwDOABII585Xw-mD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1472457091/reactions"
      },
      "updated_at" : "2023-03-16T17:59:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1472457091",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1139180604"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139180604"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "See https://github.com/bitcoin/bitcoin/pull/24012 - I couldn't get mocking an `evhttp_request*` past the ASan test, and it looks like they're failing again here too. That's why in #24098 I introduced the `GetQueryParameterFromUri()` helper function: it could easily be unit tested, and then `HTTPRequest::GetQueryParameter()` was just a simple wrapper left untested.",
      "commit_id" : "d16effe8cb2c18b72eeda596c4d3cf0c38b93263",
      "created_at" : "2023-03-16T18:10:30Z",
      "diff_hunk" : "@@ -13,26 +15,34 @@ BOOST_AUTO_TEST_CASE(test_query_parameters)\n {\n     std::string uri {};\n \n+    evhttp_request* evreq = evhttp_request_new(nullptr, nullptr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1139180604",
      "id" : 1139180604,
      "line" : 18,
      "node_id" : "PRRC_kwDOABII585D5oQ8",
      "original_commit_id" : "213554cb97c9c89bca56b56e8d0af473102e3061",
      "original_line" : 18,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/httpserver_tests.cpp",
      "position" : 13,
      "pull_request_review_id" : 1344413373,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139180604/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-16T18:12:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139180604",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1139181920"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139181920"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Seems like unrelated/unnecessary churn imo, and redefining HTTP status codes in a single functional test doesn't seem like a productive approach. Would leave this out?",
      "commit_id" : "d16effe8cb2c18b72eeda596c4d3cf0c38b93263",
      "created_at" : "2023-03-16T18:11:36Z",
      "diff_hunk" : "@@ -44,6 +44,11 @@ class RetType(Enum):\n     BYTES = 2\n     JSON = 3\n \n+class HTTPStatusCode(Enum):\n+    HTTP_OK = 200\n+    HTTP_BAD_REQUEST = 400\n+    HTTP_NOT_FOUND = 404\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1139181920",
      "id" : 1139181920,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D5olg",
      "original_commit_id" : "213554cb97c9c89bca56b56e8d0af473102e3061",
      "original_line" : 51,
      "original_position" : 8,
      "original_start_line" : 47,
      "path" : "test/functional/interface_rest.py",
      "position" : null,
      "pull_request_review_id" : 1344413373,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139181920/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-16T18:13:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139181920",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1139308077"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139308077"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks, corrected other similar 2.",
      "commit_id" : "d16effe8cb2c18b72eeda596c4d3cf0c38b93263",
      "created_at" : "2023-03-16T20:14:52Z",
      "diff_hunk" : "@@ -663,17 +674,10 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\n     }\n }\n \n-std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key) const\n+std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key)\n {\n-    const char* uri{evhttp_request_get_uri(req)};\n-\n-    return GetQueryParameterFromUri(uri, key);\n-}\n-\n-std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key)\n-{\n-    evhttp_uri* uri_parsed{evhttp_uri_parse(uri)};\n-    const char* query{evhttp_uri_get_query(uri_parsed)};\n+    if (!m_uri_parsed) { return std::nullopt; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1139308077",
      "id" : 1139308077,
      "in_reply_to_id" : 1139143140,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D6HYt",
      "original_commit_id" : "02cbb583271cabe1b4062525dea785ea21796462",
      "original_line" : 679,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_review_id" : 1344642054,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139308077/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-16T20:14:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139308077",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1139309346"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139309346"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm now reusing the HTTPStatus enum from the python http module in python; there were like 20 places where these codes were introduced as int. I think it makes it clearer but pls let me know if that's not the case.",
      "commit_id" : "d16effe8cb2c18b72eeda596c4d3cf0c38b93263",
      "created_at" : "2023-03-16T20:16:21Z",
      "diff_hunk" : "@@ -44,6 +44,11 @@ class RetType(Enum):\n     BYTES = 2\n     JSON = 3\n \n+class HTTPStatusCode(Enum):\n+    HTTP_OK = 200\n+    HTTP_BAD_REQUEST = 400\n+    HTTP_NOT_FOUND = 404\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1139309346",
      "id" : 1139309346,
      "in_reply_to_id" : 1139181920,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D6Hsi",
      "original_commit_id" : "213554cb97c9c89bca56b56e8d0af473102e3061",
      "original_line" : 51,
      "original_position" : 8,
      "original_start_line" : 47,
      "path" : "test/functional/interface_rest.py",
      "position" : null,
      "pull_request_review_id" : 1344646552,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139309346/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-16T20:16:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139309346",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1139311306"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139311306"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If I bring it back I won't be able to access to m_uri_parsed from the helper function, unless there's another alternative, I'll have to roll-back to the original approach of the PR.",
      "commit_id" : "d16effe8cb2c18b72eeda596c4d3cf0c38b93263",
      "created_at" : "2023-03-16T20:18:09Z",
      "diff_hunk" : "@@ -13,26 +15,34 @@ BOOST_AUTO_TEST_CASE(test_query_parameters)\n {\n     std::string uri {};\n \n+    evhttp_request* evreq = evhttp_request_new(nullptr, nullptr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1139311306",
      "id" : 1139311306,
      "in_reply_to_id" : 1139180604,
      "line" : 18,
      "node_id" : "PRRC_kwDOABII585D6ILK",
      "original_commit_id" : "213554cb97c9c89bca56b56e8d0af473102e3061",
      "original_line" : 18,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/httpserver_tests.cpp",
      "position" : 13,
      "pull_request_review_id" : 1344651093,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139311306/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-16T20:18:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139311306",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1139348308"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139348308"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Every line of code that you change needs review. If those changed lines of code are unrelated to what you're trying to achieve, you risk unnecessarily slowing doing the PR or even getting NACKs for reasons unrelated to what you're really trying to do. I'd strongly suggest keeping the scope as small as possible.\r\n\r\nI'm not saying it's necessarily a bad idea to use enumerated HTTP status codes, but it would be better off in a separate PR/issue (and have you checked if it's been suggested before?)",
      "commit_id" : "d16effe8cb2c18b72eeda596c4d3cf0c38b93263",
      "created_at" : "2023-03-16T20:53:48Z",
      "diff_hunk" : "@@ -44,6 +44,11 @@ class RetType(Enum):\n     BYTES = 2\n     JSON = 3\n \n+class HTTPStatusCode(Enum):\n+    HTTP_OK = 200\n+    HTTP_BAD_REQUEST = 400\n+    HTTP_NOT_FOUND = 404\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1139348308",
      "id" : 1139348308,
      "in_reply_to_id" : 1139181920,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D6RNU",
      "original_commit_id" : "213554cb97c9c89bca56b56e8d0af473102e3061",
      "original_line" : 51,
      "original_position" : 8,
      "original_start_line" : 47,
      "path" : "test/functional/interface_rest.py",
      "position" : null,
      "pull_request_review_id" : 1344697393,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139348308/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-16T20:53:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1139348308",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "https://cirrus-ci.com/task/4643666984173568:\r\n```bash\r\n test  2023-03-16T20:06:03.567000Z TestFramework (ERROR): Unexpected exception caught during testing \r\n                                   Traceback (most recent call last):\r\n                                     File \"/private/var/folders/v7/fs2b0v3s0lz1n57gj9y4xb5m0000gn/T/cirrus-ci-build/ci/scratch/build/bitcoin-arm64-apple-darwin/test/functional/test_framework/test_framework.py\", line 132, in main\r\n                                       self.run_test()\r\n                                     File \"/private/var/folders/v7/fs2b0v3s0lz1n57gj9y4xb5m0000gn/T/cirrus-ci-build/ci/scratch/build/bitcoin-arm64-apple-darwin/test/functional/interface_rest.py\", line 372, in run_test\r\n                                       resp = self.test_rest_request(\"/mempool/contents\", ret_type=RetType.OBJ, status=400, query_params={\"verbose\": \"true\", \"mempool_sequence\": \"true\"})\r\n                                     File \"/private/var/folders/v7/fs2b0v3s0lz1n57gj9y4xb5m0000gn/T/cirrus-ci-build/ci/scratch/build/bitcoin-arm64-apple-darwin/test/functional/interface_rest.py\", line 86, in test_rest_request\r\n                                       assert_equal(resp.status, status.value)\r\n                                   AttributeError: 'int' object has no attribute 'value'\r\n```",
      "created_at" : "2023-03-16T21:01:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#issuecomment-1472733580",
      "id" : 1472733580,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27253",
      "node_id" : "IC_kwDOABII585XyCGM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1472733580/reactions"
      },
      "updated_at" : "2023-03-16T21:01:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1472733580",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@fanquake that's something perhaps I've introduced with my last push, I'm on it, thanks. Weird, it's not failing locally for me:\r\n```\r\n$ ./test/functional/interface_rest.py \r\n2023-03-16T21:14:11.025000Z TestFramework (INFO): PRNG seed is: 326626678636704986\r\n2023-03-16T21:14:11.026000Z TestFramework (INFO): Initializing test directory /tmp/bitcoin_func_test_vwqauy2g\r\n2023-03-16T21:14:11.812000Z TestFramework (INFO): Broadcast test transaction and sync nodes\r\n2023-03-16T21:14:12.865000Z TestFramework (INFO): Test the /tx URI\r\n2023-03-16T21:14:12.876000Z TestFramework (INFO): Query an unspent TXO using the /getutxos URI\r\n2023-03-16T21:14:12.934000Z TestFramework (INFO): Query a spent TXO using the /getutxos URI\r\n2023-03-16T21:14:12.935000Z TestFramework (INFO): Query two TXOs using the /getutxos URI\r\n2023-03-16T21:14:12.938000Z TestFramework (INFO): Query the TXOs using the /getutxos URI with a binary response\r\n2023-03-16T21:14:12.939000Z TestFramework (INFO): Test the /getutxos URI with and without /checkmempool\r\n2023-03-16T21:14:14.065000Z TestFramework (INFO): Test the /block, /blockhashbyheight, /headers, and /blockfilterheaders URIs\r\n2023-03-16T21:14:15.221000Z TestFramework (INFO): Test tx inclusion in the /mempool and /block URIs\r\n2023-03-16T21:14:16.326000Z TestFramework (INFO): Test the /chaininfo URI\r\n2023-03-16T21:14:16.334000Z TestFramework (INFO): Test compatibility of deprecated and newer endpoints\r\n2023-03-16T21:14:16.341000Z TestFramework (INFO): Test the /deploymentinfo URI\r\n2023-03-16T21:14:16.404000Z TestFramework (INFO): Stopping nodes\r\n2023-03-16T21:14:16.611000Z TestFramework (INFO): Cleaning up /tmp/bitcoin_func_test_vwqauy2g on exit\r\n2023-03-16T21:14:16.612000Z TestFramework (INFO): Tests successful\r\n\r\n```\r\n\r\nI think this was the issue: Python Enums were introduced in version 3.4, and the value attribute was added in version 3.6. I'm fixing it.",
      "created_at" : "2023-03-16T21:13:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#issuecomment-1472748621",
      "id" : 1472748621,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27253",
      "node_id" : "IC_kwDOABII585XyFxN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1472748621/reactions"
      },
      "updated_at" : "2023-03-16T21:26:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1472748621",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1140271032"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140271032"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What do you think about this approach? I think it's quite minimal:\r\n\r\n<details>\r\n<summary>git diff</summary>\r\n\r\n```diff\r\ndiff --git a/src/httpserver.cpp b/src/httpserver.cpp\r\nindex 942caa042..6a6176a78 100644\r\n--- a/src/httpserver.cpp\r\n+++ b/src/httpserver.cpp\r\n@@ -15,6 +15,7 @@\r\n #include <rpc/protocol.h> // For HTTP status codes\r\n #include <shutdown.h>\r\n #include <sync.h>\r\n+#include <util/check.h>\r\n #include <util/strencodings.h>\r\n #include <util/syscall_sandbox.h>\r\n #include <util/system.h>\r\n@@ -253,6 +254,14 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\r\n         return;\r\n     }\r\n \r\n+    // Early reject invalid URI\r\n+    if (!hreq->GetURIParsed()) {\r\n+        LogPrint(BCLog::HTTP, \"HTTP request from %s rejected: Invalid URI\\n\",\r\n+                 hreq->GetPeer().ToStringAddrPort());\r\n+        hreq->WriteReply(HTTP_BAD_REQUEST, \"Invalid URI\");\r\n+        return;\r\n+    }\r\n+\r\n     LogPrint(BCLog::HTTP, \"Received a %s request for %s from %s\\n\",\r\n              RequestMethodString(hreq->GetRequestMethod()), SanitizeString(hreq->GetURI(), SAFE_CHARS_URI).substr(0, 100), hreq->GetPeer().ToStringAddrPort());\r\n \r\n@@ -535,18 +544,22 @@ void HTTPEvent::trigger(struct timeval* tv)\r\n     else\r\n         evtimer_add(ev, tv); // trigger after timeval passed\r\n }\r\n-HTTPRequest::HTTPRequest(struct evhttp_request* _req, bool _replySent) : req(_req), replySent(_replySent)\r\n+HTTPRequest::HTTPRequest(struct evhttp_request* _req, bool _replySent) :\r\n+        req{_req},\r\n+        m_uri_parsed{evhttp_uri_parse(evhttp_request_get_uri(req))},\r\n+        replySent{_replySent}\r\n {\r\n }\r\n \r\n HTTPRequest::~HTTPRequest()\r\n {\r\n+    // evhttpd cleans up the request, as long as a reply was sent.\r\n     if (!replySent) {\r\n         // Keep track of whether reply was sent to avoid request leaks\r\n         LogPrintf(\"%s: Unhandled request\\n\", __func__);\r\n         WriteReply(HTTP_INTERNAL_SERVER_ERROR, \"Unhandled request\");\r\n     }\r\n-    // evhttpd cleans up the request, as long as a reply was sent.\r\n+    if(m_uri_parsed) evhttp_uri_free(m_uri_parsed);\r\n }\r\n \r\n std::pair<bool, std::string> HTTPRequest::GetHeader(const std::string& hdr) const\r\n@@ -665,14 +678,13 @@ HTTPRequest::RequestMethod HTTPRequest::GetRequestMethod() const\r\n \r\n std::optional<std::string> HTTPRequest::GetQueryParameter(const std::string& key) const\r\n {\r\n-    const char* uri{evhttp_request_get_uri(req)};\r\n-\r\n-    return GetQueryParameterFromUri(uri, key);\r\n+    if (!Assume(m_uri_parsed)) return std::nullopt;  // http_request_cb should have checked that m_uri_parsed is not nullptr\r\n+    return GetQueryParameterFromUri(m_uri_parsed, key);\r\n }\r\n \r\n-std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key)\r\n+std::optional<std::string> GetQueryParameterFromUri(const evhttp_uri* uri_parsed, const std::string& key)\r\n {\r\n-    evhttp_uri* uri_parsed{evhttp_uri_parse(uri)};\r\n+    assert(uri_parsed);\r\n     const char* query{evhttp_uri_get_query(uri_parsed)};\r\n     std::optional<std::string> result;\r\n \r\n@@ -689,7 +701,6 @@ std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::\r\n         }\r\n         evhttp_clear_headers(&params_q);\r\n     }\r\n-    evhttp_uri_free(uri_parsed);\r\n \r\n     return result;\r\n }\r\ndiff --git a/src/httpserver.h b/src/httpserver.h\r\nindex 036a39a02..84906e121 100644\r\n--- a/src/httpserver.h\r\n+++ b/src/httpserver.h\r\n@@ -14,6 +14,7 @@ static const int DEFAULT_HTTP_WORKQUEUE=16;\r\n static const int DEFAULT_HTTP_SERVER_TIMEOUT=30;\r\n \r\n struct evhttp_request;\r\n+struct evhttp_uri;\r\n struct event_base;\r\n class CService;\r\n class HTTPRequest;\r\n@@ -57,6 +58,7 @@ class HTTPRequest\r\n {\r\n private:\r\n     struct evhttp_request* req;\r\n+    evhttp_uri* m_uri_parsed;\r\n     bool replySent;\r\n \r\n public:\r\n@@ -75,6 +77,9 @@ public:\r\n      */\r\n     std::string GetURI() const;\r\n \r\n+    /** Get libevent parsed URI, which is nullptr if uri parsing failed */\r\n+    const evhttp_uri* GetURIParsed() const { return m_uri_parsed; }\r\n+\r\n     /** Get CService (address:ip) for the origin of the http request.\r\n      */\r\n     CService GetPeer() const;\r\n@@ -135,10 +140,10 @@ public:\r\n  *\r\n  * Helper function for HTTPRequest::GetQueryParameter.\r\n  *\r\n- * @param[in] uri is the entire request uri\r\n+ * @param[in] uri_parsed is the request uri after parsing it with evhttp_uri_parse\r\n  * @param[in] key represents the query parameter of which the value is returned\r\n  */\r\n-std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key);\r\n+std::optional<std::string> GetQueryParameterFromUri(const evhttp_uri* uri_parsed, const std::string& key);\r\n \r\n /** Event handler closure.\r\n  */\r\n\r\n```\r\n</details>",
      "commit_id" : "d16effe8cb2c18b72eeda596c4d3cf0c38b93263",
      "created_at" : "2023-03-17T13:56:15Z",
      "diff_hunk" : "@@ -13,26 +15,34 @@ BOOST_AUTO_TEST_CASE(test_query_parameters)\n {\n     std::string uri {};\n \n+    evhttp_request* evreq = evhttp_request_new(nullptr, nullptr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1140271032",
      "id" : 1140271032,
      "in_reply_to_id" : 1139180604,
      "line" : 18,
      "node_id" : "PRRC_kwDOABII585D9ye4",
      "original_commit_id" : "213554cb97c9c89bca56b56e8d0af473102e3061",
      "original_line" : 18,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/httpserver_tests.cpp",
      "position" : 13,
      "pull_request_review_id" : 1346000963,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140271032/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-17T13:56:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140271032",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1140471392"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140471392"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ok, got it now and I agree. Thanks.",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-17T16:46:05Z",
      "diff_hunk" : "@@ -44,6 +44,11 @@ class RetType(Enum):\n     BYTES = 2\n     JSON = 3\n \n+class HTTPStatusCode(Enum):\n+    HTTP_OK = 200\n+    HTTP_BAD_REQUEST = 400\n+    HTTP_NOT_FOUND = 404\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1140471392",
      "id" : 1140471392,
      "in_reply_to_id" : 1139181920,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D-jZg",
      "original_commit_id" : "213554cb97c9c89bca56b56e8d0af473102e3061",
      "original_line" : 51,
      "original_position" : 8,
      "original_start_line" : 47,
      "path" : "test/functional/interface_rest.py",
      "position" : null,
      "pull_request_review_id" : 1346316209,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140471392/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-17T16:46:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140471392",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1140471811"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140471811"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I see, ok, it makes sense, let me make some changes.",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-17T16:46:29Z",
      "diff_hunk" : "@@ -13,26 +15,34 @@ BOOST_AUTO_TEST_CASE(test_query_parameters)\n {\n     std::string uri {};\n \n+    evhttp_request* evreq = evhttp_request_new(nullptr, nullptr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1140471811",
      "id" : 1140471811,
      "in_reply_to_id" : 1139180604,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D-jgD",
      "original_commit_id" : "213554cb97c9c89bca56b56e8d0af473102e3061",
      "original_line" : 18,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/httpserver_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1346316825,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140471811/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-17T16:46:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1140471811",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142370781"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142370781"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "A simple getter is best implemented in the header",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-20T16:11:30Z",
      "diff_hunk" : "@@ -689,11 +703,12 @@ std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::\n         }\n         evhttp_clear_headers(&params_q);\n     }\n-    evhttp_uri_free(uri_parsed);\n \n     return result;\n }\n \n+evhttp_uri* HTTPRequest::GetURIParsed() { return m_uri_parsed; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142370781",
      "id" : 1142370781,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EFzHd",
      "original_commit_id" : "0115dccef675c62d1c7f1b0df4c94827737de4a3",
      "original_line" : 710,
      "original_position" : 92,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_review_id" : 1348929370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142370781/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-20T16:26:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142370781",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142371332"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142371332"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    const evhttp_uri* GetURIParsed() const;\r\n```",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-20T16:11:54Z",
      "diff_hunk" : "@@ -124,21 +126,10 @@ class HTTPRequest\n      * main thread, do not call any other HTTPRequest methods after calling this.\n      */\n     void WriteReply(int nStatus, const std::string& strReply = \"\");\n-};\n \n-/** Get the query parameter value from request uri for a specified key, or std::nullopt if the key\n- * is not found.\n- *\n- * If the query string contains duplicate keys, the first value is returned. Many web frameworks\n- * would instead parse this as an array of values, but this is not (yet) implemented as it is\n- * currently not needed in any of the endpoints.\n- *\n- * Helper function for HTTPRequest::GetQueryParameter.\n- *\n- * @param[in] uri is the entire request uri\n- * @param[in] key represents the query parameter of which the value is returned\n- */\n-std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key);\n+    /** Get libevent parsed URI, which is nullptr if uri parsing failed */\n+    evhttp_uri* GetURIParsed();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142371332",
      "id" : 1142371332,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EFzQE",
      "original_commit_id" : "0115dccef675c62d1c7f1b0df4c94827737de4a3",
      "original_line" : 131,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/httpserver.h",
      "position" : null,
      "pull_request_review_id" : 1348929370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142371332/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-20T16:26:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142371332",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142374618"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142374618"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "After some tweaks around the unit tests (can't [test an assertion failure on`BOOST`](https://stackoverflow.com/questions/270542/testing-for-assert-in-the-boost-test-framework) and the a solution using`BOOST_REQUIRE_THROW(function_w_failing_assert(), boost::execution_exception);`works only on windows), this is done now.",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-20T16:14:22Z",
      "diff_hunk" : "@@ -13,26 +15,34 @@ BOOST_AUTO_TEST_CASE(test_query_parameters)\n {\n     std::string uri {};\n \n+    evhttp_request* evreq = evhttp_request_new(nullptr, nullptr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142374618",
      "id" : 1142374618,
      "in_reply_to_id" : 1139180604,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EF0Da",
      "original_commit_id" : "213554cb97c9c89bca56b56e8d0af473102e3061",
      "original_line" : 18,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/httpserver_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1348935012,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142374618/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-20T16:14:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142374618",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142376537"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142376537"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What's the rationale behind moving all this code? I don't think it's necessary?",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-20T16:15:52Z",
      "diff_hunk" : "@@ -172,4 +163,19 @@ class HTTPEvent\n     struct event* ev;\n };\n \n+\n+/** Get the query parameter value from a evhttp_uri (parsed) object for a specified key, or std::nullopt\n+ * if the key is not found or uri_parsed parameter is nullptr (most probably from a failed parsing).\n+ *\n+ * If the query string contains duplicate keys, the first value is returned. Many web frameworks\n+ * would instead parse this as an array of values, but this is not (yet) implemented as it is\n+ * currently not needed in any of the endpoints.\n+ *\n+ * Helper function for HTTPRequest::GetQueryParameter.\n+ *\n+ * @param[in] uri_parsed is the evhttp_uri object (obtained from evhttp_uri_parse - libevent function)\n+ * @param[in] key represents the query parameter of which the value is returned\n+ */\n+std::optional<std::string> GetQueryParameterFromUri(const evhttp_uri* uri_parsed, const std::string& key);\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142376537",
      "id" : 1142376537,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EF0hZ",
      "original_commit_id" : "0115dccef675c62d1c7f1b0df4c94827737de4a3",
      "original_line" : 180,
      "original_position" : 70,
      "original_start_line" : 166,
      "path" : "src/httpserver.h",
      "position" : null,
      "pull_request_review_id" : 1348929370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142376537/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-20T16:26:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142376537",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142378663"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142378663"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "seems unrelated to this PR, and no need to touch this otherwise?",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-20T16:17:27Z",
      "diff_hunk" : "@@ -56,7 +57,8 @@ struct event_base* EventBase();\n class HTTPRequest\n {\n private:\n-    struct evhttp_request* req;\n+    struct evhttp_request* req{nullptr};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142378663",
      "id" : 1142378663,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EF1Cn",
      "original_commit_id" : "0115dccef675c62d1c7f1b0df4c94827737de4a3",
      "original_line" : 60,
      "original_position" : 13,
      "original_start_line" : 59,
      "path" : "src/httpserver.h",
      "position" : null,
      "pull_request_review_id" : 1348929370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142378663/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-03-20T16:26:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142378663",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142379157"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142379157"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why remove `const`?",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-20T16:17:50Z",
      "diff_hunk" : "@@ -92,7 +94,7 @@ class HTTPRequest\n      *\n      * @param[in] key represents the query parameter of which the value is returned\n      */\n-    std::optional<std::string> GetQueryParameter(const std::string& key) const;\n+    std::optional<std::string> GetQueryParameter(const std::string& key);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142379157",
      "id" : 1142379157,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EF1KV",
      "original_commit_id" : "0115dccef675c62d1c7f1b0df4c94827737de4a3",
      "original_line" : 97,
      "original_position" : 23,
      "original_start_line" : 95,
      "path" : "src/httpserver.h",
      "position" : null,
      "pull_request_review_id" : 1348929370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142379157/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-03-20T16:26:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142379157",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142382188"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142382188"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this would benefit from helper function(s) to avoid duplicating all the parsing/memclearing logic and make the tests easier to read.",
      "commit_id" : "9b0a0dc92308fa069ffc03ebe93eff2de317d59a",
      "created_at" : "2023-03-20T16:19:56Z",
      "diff_hunk" : "",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142382188",
      "id" : 1142382188,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585EF15s",
      "original_commit_id" : "9b0a0dc92308fa069ffc03ebe93eff2de317d59a",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/test/httpserver_tests.cpp",
      "position" : 1,
      "pull_request_review_id" : 1348929370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142382188/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "file",
      "updated_at" : "2023-03-20T16:26:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142382188",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142386023"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142386023"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "These changes are unrelated to the segmentation fault and at the very least need to be in a separate commit",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-20T16:22:20Z",
      "diff_hunk" : "@@ -205,16 +206,16 @@ def run_test(self):\n         assert_equal(len(json_obj['utxos']), 1)\n \n         # Do some invalid requests\n-        self.test_rest_request(\"/getutxos\", http_method='POST', req_type=ReqType.JSON, body='{\"checkmempool', status=400, ret_type=RetType.OBJ)\n-        self.test_rest_request(\"/getutxos\", http_method='POST', req_type=ReqType.BIN, body='{\"checkmempool', status=400, ret_type=RetType.OBJ)\n-        self.test_rest_request(\"/getutxos/checkmempool\", http_method='POST', req_type=ReqType.JSON, status=400, ret_type=RetType.OBJ)\n+        self.test_rest_request(\"/getutxos\", http_method='POST', req_type=ReqType.JSON, body='{\"checkmempool', status=HTTPStatus.BAD_REQUEST, ret_type=RetType.OBJ)\n+        self.test_rest_request(\"/getutxos\", http_method='POST', req_type=ReqType.BIN, body='{\"checkmempool', status=HTTPStatus.BAD_REQUEST, ret_type=RetType.OBJ)\n+        self.test_rest_request(\"/getutxos/checkmempool\", http_method='POST', req_type=ReqType.JSON, status=HTTPStatus.BAD_REQUEST, ret_type=RetType.OBJ)\n \n         # Test limits\n         long_uri = '/'.join([f\"{txid}-{n_}\" for n_ in range(20)])\n-        self.test_rest_request(f\"/getutxos/checkmempool/{long_uri}\", http_method='POST', status=400, ret_type=RetType.OBJ)\n+        self.test_rest_request(f\"/getutxos/checkmempool/{long_uri}\", http_method='POST', status=HTTPStatus.BAD_REQUEST, ret_type=RetType.OBJ)\n \n         long_uri = '/'.join([f'{txid}-{n_}' for n_ in range(15)])\n-        self.test_rest_request(f\"/getutxos/checkmempool/{long_uri}\", http_method='POST', status=200)\n+        self.test_rest_request(f\"/getutxos/checkmempool/{long_uri}\", http_method='POST', status=HTTPStatus.OK)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142386023",
      "id" : 1142386023,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EF21n",
      "original_commit_id" : "9b0a0dc92308fa069ffc03ebe93eff2de317d59a",
      "original_line" : 218,
      "original_position" : 47,
      "original_start_line" : 217,
      "path" : "test/functional/interface_rest.py",
      "position" : null,
      "pull_request_review_id" : 1348929370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142386023/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-03-20T16:26:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142386023",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated changes:\r\n- Updated the code with a new workaround to avoid failures on unit tests (`httpserver_tests`).\r\n\r\nThanks @stickies-v for your prompt response and your support on quick workarounds on issues raised.",
      "created_at" : "2023-03-20T16:24:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#issuecomment-1476552873",
      "id" : 1476552873,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27253",
      "node_id" : "IC_kwDOABII585YAmip",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476552873/reactions"
      },
      "updated_at" : "2023-03-20T16:24:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1476552873",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142420455"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142420455"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Sorry, forgot to remove all that.",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-20T16:48:13Z",
      "diff_hunk" : "@@ -205,16 +206,16 @@ def run_test(self):\n         assert_equal(len(json_obj['utxos']), 1)\n \n         # Do some invalid requests\n-        self.test_rest_request(\"/getutxos\", http_method='POST', req_type=ReqType.JSON, body='{\"checkmempool', status=400, ret_type=RetType.OBJ)\n-        self.test_rest_request(\"/getutxos\", http_method='POST', req_type=ReqType.BIN, body='{\"checkmempool', status=400, ret_type=RetType.OBJ)\n-        self.test_rest_request(\"/getutxos/checkmempool\", http_method='POST', req_type=ReqType.JSON, status=400, ret_type=RetType.OBJ)\n+        self.test_rest_request(\"/getutxos\", http_method='POST', req_type=ReqType.JSON, body='{\"checkmempool', status=HTTPStatus.BAD_REQUEST, ret_type=RetType.OBJ)\n+        self.test_rest_request(\"/getutxos\", http_method='POST', req_type=ReqType.BIN, body='{\"checkmempool', status=HTTPStatus.BAD_REQUEST, ret_type=RetType.OBJ)\n+        self.test_rest_request(\"/getutxos/checkmempool\", http_method='POST', req_type=ReqType.JSON, status=HTTPStatus.BAD_REQUEST, ret_type=RetType.OBJ)\n \n         # Test limits\n         long_uri = '/'.join([f\"{txid}-{n_}\" for n_ in range(20)])\n-        self.test_rest_request(f\"/getutxos/checkmempool/{long_uri}\", http_method='POST', status=400, ret_type=RetType.OBJ)\n+        self.test_rest_request(f\"/getutxos/checkmempool/{long_uri}\", http_method='POST', status=HTTPStatus.BAD_REQUEST, ret_type=RetType.OBJ)\n \n         long_uri = '/'.join([f'{txid}-{n_}' for n_ in range(15)])\n-        self.test_rest_request(f\"/getutxos/checkmempool/{long_uri}\", http_method='POST', status=200)\n+        self.test_rest_request(f\"/getutxos/checkmempool/{long_uri}\", http_method='POST', status=HTTPStatus.OK)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142420455",
      "id" : 1142420455,
      "in_reply_to_id" : 1142386023,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EF_Pn",
      "original_commit_id" : "9b0a0dc92308fa069ffc03ebe93eff2de317d59a",
      "original_line" : 218,
      "original_position" : 47,
      "original_start_line" : 217,
      "path" : "test/functional/interface_rest.py",
      "position" : null,
      "pull_request_review_id" : 1349011567,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142420455/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-03-20T16:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142420455",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142421537"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142421537"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Was unintentional, going to place it on its original location.",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-20T16:49:05Z",
      "diff_hunk" : "@@ -172,4 +163,19 @@ class HTTPEvent\n     struct event* ev;\n };\n \n+\n+/** Get the query parameter value from a evhttp_uri (parsed) object for a specified key, or std::nullopt\n+ * if the key is not found or uri_parsed parameter is nullptr (most probably from a failed parsing).\n+ *\n+ * If the query string contains duplicate keys, the first value is returned. Many web frameworks\n+ * would instead parse this as an array of values, but this is not (yet) implemented as it is\n+ * currently not needed in any of the endpoints.\n+ *\n+ * Helper function for HTTPRequest::GetQueryParameter.\n+ *\n+ * @param[in] uri_parsed is the evhttp_uri object (obtained from evhttp_uri_parse - libevent function)\n+ * @param[in] key represents the query parameter of which the value is returned\n+ */\n+std::optional<std::string> GetQueryParameterFromUri(const evhttp_uri* uri_parsed, const std::string& key);\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142421537",
      "id" : 1142421537,
      "in_reply_to_id" : 1142376537,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EF_gh",
      "original_commit_id" : "0115dccef675c62d1c7f1b0df4c94827737de4a3",
      "original_line" : 180,
      "original_position" : 70,
      "original_start_line" : 166,
      "path" : "src/httpserver.h",
      "position" : null,
      "pull_request_review_id" : 1349013127,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142421537/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-20T16:49:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142421537",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142422788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142422788"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ok",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-20T16:50:02Z",
      "diff_hunk" : "@@ -689,11 +703,12 @@ std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::\n         }\n         evhttp_clear_headers(&params_q);\n     }\n-    evhttp_uri_free(uri_parsed);\n \n     return result;\n }\n \n+evhttp_uri* HTTPRequest::GetURIParsed() { return m_uri_parsed; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142422788",
      "id" : 1142422788,
      "in_reply_to_id" : 1142370781,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EF_0E",
      "original_commit_id" : "0115dccef675c62d1c7f1b0df4c94827737de4a3",
      "original_line" : 710,
      "original_position" : 92,
      "original_start_line" : null,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_review_id" : 1349014880,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142422788/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-20T16:50:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142422788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142437445"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142437445"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n```suggestion\r\n    const std::string uri{\"localhost:8080/rest/headers/someresource.json\"};\r\n```",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-20T17:01:25Z",
      "diff_hunk" : "@@ -5,34 +5,50 @@\n #include <httpserver.h>\n #include <test/util/setup_common.h>\n \n+#include <event2/http.h>\n+\n #include <boost/test/unit_test.hpp>\n \n BOOST_FIXTURE_TEST_SUITE(httpserver_tests, BasicTestingSetup)\n \n BOOST_AUTO_TEST_CASE(test_query_parameters)\n {\n-    std::string uri {};\n-\n     // No parameters\n-    uri = \"localhost:8080/rest/headers/someresource.json\";\n-    BOOST_CHECK(!GetQueryParameterFromUri(uri.c_str(), \"p1\").has_value());\n+    std::string uri = \"localhost:8080/rest/headers/someresource.json\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142437445",
      "id" : 1142437445,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EGDZF",
      "original_commit_id" : "9b0a0dc92308fa069ffc03ebe93eff2de317d59a",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/test/httpserver_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1349035814,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142437445/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-20T17:01:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142437445",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142439278"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142439278"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "right",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-20T17:02:57Z",
      "diff_hunk" : "@@ -5,34 +5,50 @@\n #include <httpserver.h>\n #include <test/util/setup_common.h>\n \n+#include <event2/http.h>\n+\n #include <boost/test/unit_test.hpp>\n \n BOOST_FIXTURE_TEST_SUITE(httpserver_tests, BasicTestingSetup)\n \n BOOST_AUTO_TEST_CASE(test_query_parameters)\n {\n-    std::string uri {};\n-\n     // No parameters\n-    uri = \"localhost:8080/rest/headers/someresource.json\";\n-    BOOST_CHECK(!GetQueryParameterFromUri(uri.c_str(), \"p1\").has_value());\n+    std::string uri = \"localhost:8080/rest/headers/someresource.json\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142439278",
      "id" : 1142439278,
      "in_reply_to_id" : 1142437445,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EGD1u",
      "original_commit_id" : "9b0a0dc92308fa069ffc03ebe93eff2de317d59a",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/test/httpserver_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1349038523,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142439278/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-20T17:02:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142439278",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142447667"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142447667"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I wanted to make sure then to use the free up function for the request in the `HTTPRequest` destructor: `evhttp_request_free`. This was something I was doing while investigating the previous failure of the ASan tests and possible memory leaks. I'll remove it if you think unnecessary, ",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-20T17:10:00Z",
      "diff_hunk" : "@@ -56,7 +57,8 @@ struct event_base* EventBase();\n class HTTPRequest\n {\n private:\n-    struct evhttp_request* req;\n+    struct evhttp_request* req{nullptr};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142447667",
      "id" : 1142447667,
      "in_reply_to_id" : 1142378663,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EGF4z",
      "original_commit_id" : "0115dccef675c62d1c7f1b0df4c94827737de4a3",
      "original_line" : 60,
      "original_position" : 13,
      "original_start_line" : 59,
      "path" : "src/httpserver.h",
      "position" : null,
      "pull_request_review_id" : 1349051248,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142447667/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-03-20T17:10:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142447667",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142449820"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142449820"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ok, let me add some helper(s) there.",
      "commit_id" : "9b0a0dc92308fa069ffc03ebe93eff2de317d59a",
      "created_at" : "2023-03-20T17:11:51Z",
      "diff_hunk" : "",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142449820",
      "id" : 1142449820,
      "in_reply_to_id" : 1142382188,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585EGGac",
      "original_commit_id" : "9b0a0dc92308fa069ffc03ebe93eff2de317d59a",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/test/httpserver_tests.cpp",
      "position" : 1,
      "pull_request_review_id" : 1349054407,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142449820/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "file",
      "updated_at" : "2023-03-20T17:11:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142449820",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142466765"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142466765"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, putting it back, before the compiler was complaining as in the previous approach we were modifying m_uri_parsed in this function.",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-20T17:26:12Z",
      "diff_hunk" : "@@ -124,21 +126,10 @@ class HTTPRequest\n      * main thread, do not call any other HTTPRequest methods after calling this.\n      */\n     void WriteReply(int nStatus, const std::string& strReply = \"\");\n-};\n \n-/** Get the query parameter value from request uri for a specified key, or std::nullopt if the key\n- * is not found.\n- *\n- * If the query string contains duplicate keys, the first value is returned. Many web frameworks\n- * would instead parse this as an array of values, but this is not (yet) implemented as it is\n- * currently not needed in any of the endpoints.\n- *\n- * Helper function for HTTPRequest::GetQueryParameter.\n- *\n- * @param[in] uri is the entire request uri\n- * @param[in] key represents the query parameter of which the value is returned\n- */\n-std::optional<std::string> GetQueryParameterFromUri(const char* uri, const std::string& key);\n+    /** Get libevent parsed URI, which is nullptr if uri parsing failed */\n+    evhttp_uri* GetURIParsed();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142466765",
      "id" : 1142466765,
      "in_reply_to_id" : 1142371332,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EGKjN",
      "original_commit_id" : "0115dccef675c62d1c7f1b0df4c94827737de4a3",
      "original_line" : 131,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/httpserver.h",
      "position" : null,
      "pull_request_review_id" : 1349078617,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142466765/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-20T17:26:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142466765",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142467803"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142467803"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Similar reason to the above comment on`GetURIParsed()` function, back again. ",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-20T17:27:08Z",
      "diff_hunk" : "@@ -92,7 +94,7 @@ class HTTPRequest\n      *\n      * @param[in] key represents the query parameter of which the value is returned\n      */\n-    std::optional<std::string> GetQueryParameter(const std::string& key) const;\n+    std::optional<std::string> GetQueryParameter(const std::string& key);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142467803",
      "id" : 1142467803,
      "in_reply_to_id" : 1142379157,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EGKzb",
      "original_commit_id" : "0115dccef675c62d1c7f1b0df4c94827737de4a3",
      "original_line" : 97,
      "original_position" : 23,
      "original_start_line" : 95,
      "path" : "src/httpserver.h",
      "position" : null,
      "pull_request_review_id" : 1349080168,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142467803/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-03-20T17:27:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142467803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142472126"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142472126"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'll take it back.",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-20T17:30:56Z",
      "diff_hunk" : "@@ -56,7 +57,8 @@ struct event_base* EventBase();\n class HTTPRequest\n {\n private:\n-    struct evhttp_request* req;\n+    struct evhttp_request* req{nullptr};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142472126",
      "id" : 1142472126,
      "in_reply_to_id" : 1142378663,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585EGL2-",
      "original_commit_id" : "0115dccef675c62d1c7f1b0df4c94827737de4a3",
      "original_line" : 60,
      "original_position" : 13,
      "original_start_line" : 59,
      "path" : "src/httpserver.h",
      "position" : null,
      "pull_request_review_id" : 1349086453,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142472126/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-03-20T17:30:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142472126",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142506066"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142506066"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done.",
      "commit_id" : "9b0a0dc92308fa069ffc03ebe93eff2de317d59a",
      "created_at" : "2023-03-20T18:01:55Z",
      "diff_hunk" : "",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1142506066",
      "id" : 1142506066,
      "in_reply_to_id" : 1142382188,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585EGUJS",
      "original_commit_id" : "9b0a0dc92308fa069ffc03ebe93eff2de317d59a",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/test/httpserver_tests.cpp",
      "position" : 1,
      "pull_request_review_id" : 1349136769,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142506066/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "file",
      "updated_at" : "2023-03-20T18:01:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142506066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1143232308"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1143232308"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: it's actually an argument, but I would just leave it out\r\n\r\n```suggestion\r\n * if the key is not found or if uri_parsed is nullptr (most probably from a failed parsing).\r\n```",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-21T11:26:13Z",
      "diff_hunk" : "@@ -124,21 +126,24 @@ class HTTPRequest\n      * main thread, do not call any other HTTPRequest methods after calling this.\n      */\n     void WriteReply(int nStatus, const std::string& strReply = \"\");\n+\n+    /** Get libevent parsed URI, which is nullptr if uri parsing failed */\n+    const evhttp_uri* GetURIParsed() const { return m_uri_parsed; }\n };\n \n-/** Get the query parameter value from request uri for a specified key, or std::nullopt if the key\n- * is not found.\n+/** Get the query parameter value from a evhttp_uri (parsed) object for a specified key, or std::nullopt\n+ * if the key is not found or uri_parsed parameter is nullptr (most probably from a failed parsing).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1143232308",
      "id" : 1143232308,
      "line" : 135,
      "node_id" : "PRRC_kwDOABII585EJFc0",
      "original_commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "original_line" : 135,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/httpserver.h",
      "position" : 28,
      "pull_request_review_id" : 1350217812,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1143232308/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-21T12:12:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1143232308",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1143234062"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1143234062"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit\r\n```suggestion\r\n * @param[in] uri_parsed is the uri parsed with libevent's evhttp_uri_parse\r\n```",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-21T11:27:55Z",
      "diff_hunk" : "@@ -124,21 +126,24 @@ class HTTPRequest\n      * main thread, do not call any other HTTPRequest methods after calling this.\n      */\n     void WriteReply(int nStatus, const std::string& strReply = \"\");\n+\n+    /** Get libevent parsed URI, which is nullptr if uri parsing failed */\n+    const evhttp_uri* GetURIParsed() const { return m_uri_parsed; }\n };\n \n-/** Get the query parameter value from request uri for a specified key, or std::nullopt if the key\n- * is not found.\n+/** Get the query parameter value from a evhttp_uri (parsed) object for a specified key, or std::nullopt\n+ * if the key is not found or uri_parsed parameter is nullptr (most probably from a failed parsing).\n  *\n  * If the query string contains duplicate keys, the first value is returned. Many web frameworks\n  * would instead parse this as an array of values, but this is not (yet) implemented as it is\n  * currently not needed in any of the endpoints.\n  *\n  * Helper function for HTTPRequest::GetQueryParameter.\n  *\n- * @param[in] uri is the entire request uri\n+ * @param[in] uri_parsed is the evhttp_uri object (obtained from evhttp_uri_parse - libevent function)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1143234062",
      "id" : 1143234062,
      "line" : 143,
      "node_id" : "PRRC_kwDOABII585EJF4O",
      "original_commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "original_line" : 143,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/httpserver.h",
      "position" : 37,
      "pull_request_review_id" : 1350217812,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1143234062/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-21T12:12:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1143234062",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1143273441"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1143273441"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think the tests are still more complex than necessary. How about this:\r\n\r\n<details>\r\n<summary>git diff</summary>\r\n\r\n```diff\r\ndiff --git a/src/test/httpserver_tests.cpp b/src/test/httpserver_tests.cpp\r\nindex 0462d3ae3..6ae57bdf0 100644\r\n--- a/src/test/httpserver_tests.cpp\r\n+++ b/src/test/httpserver_tests.cpp\r\n@@ -11,42 +11,46 @@\r\n \r\n BOOST_FIXTURE_TEST_SUITE(httpserver_tests, BasicTestingSetup)\r\n \r\n-static evhttp_uri* GetURIParsed(const std::string uri){\r\n-    return evhttp_uri_parse(uri.c_str());\r\n+/** Test if query parameter exists in the provided uri. */\r\n+bool QueryParameterExists(std::string_view uri, const std::string& key)\r\n+{\r\n+    auto uri_parsed{evhttp_uri_parse(uri.data())};\r\n+    const bool exists{GetQueryParameterFromUri(uri_parsed, key).has_value()};\r\n+    if(uri_parsed) evhttp_uri_free(uri_parsed);\r\n+    return exists;\r\n+}\r\n+\r\n+/** Test if query parameter exists in the provided uri and if its value matches the expected_value. */\r\n+bool QueryParameterEquals(std::string_view uri, const std::string& key, std::string_view expected_value)\r\n+{\r\n+    auto uri_parsed{evhttp_uri_parse(uri.data())};\r\n+    const auto param_value{GetQueryParameterFromUri(uri_parsed, key)};\r\n+    const bool is_equal{param_value.has_value() && *param_value == expected_value};\r\n+    if(uri_parsed) evhttp_uri_free(uri_parsed);\r\n+    return is_equal;\r\n }\r\n \r\n BOOST_AUTO_TEST_CASE(test_query_parameters)\r\n {\r\n     // No parameters\r\n-    evhttp_uri* uri_parsed{GetURIParsed(\"localhost:8080/rest/headers/someresource.json\")};\r\n-    BOOST_CHECK(!GetQueryParameterFromUri(uri_parsed, \"p1\").has_value());\r\n-    evhttp_uri_free(uri_parsed);\r\n+    BOOST_CHECK(!QueryParameterExists(\"localhost:8080/rest/headers/someresource.json\", \"p1\"));\r\n \r\n     // Single parameter\r\n-    uri_parsed = GetURIParsed(\"localhost:8080/rest/endpoint/someresource.json?p1=v1\");\r\n-    BOOST_CHECK_EQUAL(GetQueryParameterFromUri(uri_parsed, \"p1\").value(), \"v1\");\r\n-    BOOST_CHECK(!GetQueryParameterFromUri(uri_parsed, \"p2\").has_value());\r\n-    evhttp_uri_free(uri_parsed);\r\n+    BOOST_CHECK(QueryParameterEquals(\"localhost:8080/rest/endpoint/someresource.json?p1=v1\", \"p1\", \"v1\"));\r\n+    BOOST_CHECK(!QueryParameterExists(\"localhost:8080/rest/endpoint/someresource.json?p1=v1\", \"p2\"));\r\n \r\n     // Multiple parameters\r\n-    uri_parsed = GetURIParsed(\"/rest/endpoint/someresource.json?p1=v1&p2=v2\");\r\n-    BOOST_CHECK_EQUAL(GetQueryParameterFromUri(uri_parsed, \"p1\").value(), \"v1\");\r\n-    BOOST_CHECK_EQUAL(GetQueryParameterFromUri(uri_parsed, \"p2\").value(), \"v2\");\r\n-    evhttp_uri_free(uri_parsed);\r\n+    BOOST_CHECK(QueryParameterEquals(\"/rest/endpoint/someresource.json?p1=v1&p2=v2\", \"p1\", \"v1\"));\r\n+    BOOST_CHECK(QueryParameterEquals(\"/rest/endpoint/someresource.json?p1=v1&p2=v2\", \"p2\", \"v2\"));\r\n \r\n     // If the query string contains duplicate keys, the first value is returned\r\n-    uri_parsed = GetURIParsed(\"/rest/endpoint/someresource.json?p1=v1&p1=v2\");\r\n-    BOOST_CHECK_EQUAL(GetQueryParameterFromUri(uri_parsed, \"p1\").value(), \"v1\");\r\n-    evhttp_uri_free(uri_parsed);\r\n+    BOOST_CHECK(QueryParameterEquals(\"/rest/endpoint/someresource.json?p1=v1&p1=v2\", \"p1\", \"v1\"));\r\n \r\n     // Invalid query string syntax is the same as not having parameters\r\n-    uri_parsed = GetURIParsed(\"/rest/endpoint/someresource.json&p1=v1&p2=v2\");\r\n-    BOOST_CHECK(!GetQueryParameterFromUri(uri_parsed, \"p1\").has_value());\r\n-    evhttp_uri_free(uri_parsed);\r\n+    BOOST_CHECK(!QueryParameterExists(\"/rest/endpoint/someresource.json&p1=v1&p2=v2\", \"p1\"));\r\n \r\n     // Invalid URI with % symbol won't return any values as not having parameters at all\r\n-    uri_parsed = GetURIParsed(\"/rest/endpoint/someresource.json&p1=v1&p2=v2%\");\r\n-    BOOST_CHECK_EQUAL(uri_parsed, nullptr);\r\n-    BOOST_CHECK(!GetQueryParameterFromUri(uri_parsed, \"p1\").has_value());\r\n+    BOOST_CHECK(!QueryParameterExists(\"/rest/endpoint/someresource.json&p1=v1&p2=v2%\", \"p1\"));\r\n+\r\n }\r\n BOOST_AUTO_TEST_SUITE_END()\r\n\r\n```\r\n</details>\r\n\r\nCan probably still be deduplicated a bit more using an RAII wrapper for uri_parsed, if you like.",
      "commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "created_at" : "2023-03-21T12:04:40Z",
      "diff_hunk" : "",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#discussion_r1143273441",
      "id" : 1143273441,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585EJPfh",
      "original_commit_id" : "36be160a9b4863c59c6be4bc41d6ffa29903da17",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/test/httpserver_tests.cpp",
      "position" : 1,
      "pull_request_review_id" : 1350217812,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27253",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1143273441/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "file",
      "updated_at" : "2023-03-21T12:12:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1143273441",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> but I think the commit message [should be updated](https://github.com/bitcoin/bitcoin/pull/27253#pullrequestreview-1348929370) to better describe the bug, the fix, and the behaviour change introduced\r\n\r\nYes, I have that pending to do asap.",
      "created_at" : "2023-03-22T15:15:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#issuecomment-1479758216",
      "id" : 1479758216,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27253",
      "node_id" : "IC_kwDOABII585YM1GI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1479758216/reactions"
      },
      "updated_at" : "2023-03-22T15:15:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1479758216",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\n\r\nThe code as of 8bdea6316c looks ok, but it seems to be mixing the fix with an optimization to only parse once (instead of every time a parameter is retrieved). It would be better to have two separate commits - one with the non-functional optimization and one with the fix.\r\n\r\nIdea: I think it would be better to disallow the creation of `HTTPRequest` if the request is invalid/unparsable. This would avoid having a `nullptr` member `m_uri_parsed` and having to handle the nullness. Would it work to check the sanity in the `HTTPRequest` constructor and if a problem is detected, then `throw` some object that contains an error code and a string (to convey e.g. `HTTP_BAD_REQUEST, \"Invalid URI\"`)? Then catch this in `http_request_cb()` and return early.\r\n\r\nThere are other similar bugs in this code which exist in `master` and remain unfixed by this PR:\r\n* `evhttp_request_get_uri()` may return `nullptr` which we pass unconditionally to `evhttp_uri_parse()` which will crash on `nullptr`.\r\n* In `HTTPRequest::GetURI()` we implicitly create `std::string` from the return value of `evhttp_request_get_uri()`. Creating a string from `nullptr` is undefined behavior.\r\n\r\nI am not sure under what circumstances would `evhttp_request_get_uri()` return `nullptr`, but it is not documented that it will never return `nullptr` and also [its source code](https://github.com/libevent/libevent/blob/6e1826dd7730330536e1838824bddd0d4d8adb0d/http.c#L4465-L4469) implies that it can, so better safe than sorry. I don't think fixing those is a requirement for this PR. If they are not, then I will follow up with a subsequent PR.\r\n",
      "created_at" : "2023-03-23T10:11:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#issuecomment-1480921094",
      "id" : 1480921094,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27253",
      "node_id" : "IC_kwDOABII585YRRAG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1480921094/reactions"
      },
      "updated_at" : "2023-03-23T10:11:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1480921094",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> It would be better to have two separate commits - one with the non-functional optimization and one with the fix.\r\n\r\nAgreed, that could probably be improved.\r\n\r\n> Idea: I think it would be better to disallow the creation of HTTPRequest if the request is invalid/unparsable.\r\n\r\nThis was the first approach I considered, but I think it's better not to. A request with an invalid URI is still a request, and thus it should be representable. Moving the URI validation to the constructor feels like a shortcut and coupling we don't need to take?\r\n\r\n> `evhttp_request_get_uri()` may return `nullptr`\r\n\r\nLike you, I don't see how that can happen in practice but can never hurt to make more robust. I think it's orthogonal to this PR but happy to review your PR - feel free to ping me?",
      "created_at" : "2023-03-23T13:06:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#issuecomment-1481163868",
      "id" : 1481163868,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27253",
      "node_id" : "IC_kwDOABII585YSMRc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1481163868/reactions"
      },
      "updated_at" : "2023-03-23T13:06:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1481163868",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Moving the URI validation to the constructor feels like a shortcut and coupling we don't need to take?\r\n\r\nI do not have a strong opinion. This PR moved the parsing to the constructor, but left the checking of the parsing result for later. Now the code looks like (simplified):\r\n\r\n```cpp\r\n// constructs the object, does the parsing, leaves null m_uri_parsed if it fails\r\nHTTPRequest hreq(...);\r\n\r\nif (hreq.m_uri_parsed == nullptr) {\r\n    handle error and dispose hreq\r\n}\r\n\r\n// elsewhere a soft assert is needed to ensure hreq.m_uri_parsed != nullptr\r\n```\r\n\r\nI find the following more robust and compact:\r\n\r\n```cpp\r\nstd::unique_ptr<HTTPRequest> hreq;\r\ntry {\r\n    hreq = std::make_unique<HTTPRequest>(...);\r\n} catch (e) {\r\n    handle error e.code + e.msg\r\n}\r\n\r\n// no need for further error handling or checking here or elsewhere\r\n```\r\n\r\n> happy to review your PR - feel free to ping me\r\n\r\nSure, lets first see what happens with this PR. Maybe @pablomartin4btc would decide to check the return value of `evhttp_request_get_uri()` in this PR.",
      "created_at" : "2023-03-23T13:48:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#issuecomment-1481229146",
      "id" : 1481229146,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27253",
      "node_id" : "IC_kwDOABII585YScNa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1481229146/reactions"
      },
      "updated_at" : "2023-03-23T13:48:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1481229146",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> >  It would be better to have two separate commits - one with the non-functional optimization and one with the fix.\r\n\r\n> Agreed, that could probably be improved.\r\n\r\nI can do this.\r\n\r\n\r\n> > Sure, lets first see what happens with this PR. Maybe @pablomartin4btc would decide to check the return value of evhttp_request_get_uri() in this PR.\r\n\r\nIt was under my radar and I thought to do it in a follow up, but I could do it here if it's more practical (need to update title and description of this PR).\r\n\r\n\r\n> > I find the following more robust and compact:\r\n```\r\nstd::unique_ptr<HTTPRequest> hreq;\r\ntry {\r\n    hreq = std::make_unique<HTTPRequest>(...);\r\n} catch (e) {\r\n    handle error e.code + e.msg\r\n}\r\n\r\n// no need for further error handling or checking here or elsewhere\r\n\r\n```\r\n\r\nI like this approach, let me check and play a bit with the code as if I need to raise an exception or can return the `HTTP_BAD_REQUEST` from there, and how the consumer (rest obj) would behave/ interact with it.\r\n",
      "created_at" : "2023-03-23T15:21:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#issuecomment-1481390885",
      "id" : 1481390885,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27253",
      "node_id" : "IC_kwDOABII585YTDsl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1481390885/reactions"
      },
      "updated_at" : "2023-03-23T15:21:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1481390885",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "If you decide to go this way, something like this should work:\r\n\r\n```cpp\r\n// in HTTPRequest::HTTPRequest():\r\nif (cannot parse uri) {\r\n    const int code{HTTP_BAD_METHOD};\r\n    const char* what{\"Invalid URI\"};\r\n    WriteReply(code, what);\r\n    throw std::system_error(code, std::generic_category(), what);\r\n}\r\n\r\n// in http_request_cb():\r\nstd::unique_ptr<HTTPRequest> hreq;\r\ntry {\r\n    hreq = std::make_unique<HTTPRequest>(...);\r\n} catch (const std::system_error& e) {\r\n    LogPrint(BCLog::HTTP, \"%d %s\\n\", e.code().value(), e.what());\r\n    return;\r\n}",
      "created_at" : "2023-03-24T09:01:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27253#issuecomment-1482465778",
      "id" : 1482465778,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27253",
      "node_id" : "IC_kwDOABII585YXKHy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1482465778/reactions"
      },
      "updated_at" : "2023-03-24T09:01:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1482465778",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
