[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
      "created_at" : "2023-01-17T19:00:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26910#issuecomment-1385908048",
      "id" : 1385908048,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26910",
      "node_id" : "IC_kwDOABII585Sm0dQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1385908048/reactions"
      },
      "updated_at" : "2023-01-17T19:00:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1385908048",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26910#discussion_r1072813726"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072813726"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I wonder if the message is consistent with how the migration code actually works. For instance, the error returned before this change is \"`This wallet already uses SQLite`\":\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/fbe5e1220a35c35a668ec965c66508a7839aa7dd/src/wallet/wallet.cpp#L3765-L3774\r\n\r\nEven if it passed that check (which I believe is impossible in this situation), it does the same check as in this PR and reads \"`This wallet is already a descriptor wallet`\":\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/fbe5e1220a35c35a668ec965c66508a7839aa7dd/src/wallet/wallet.cpp#L3837-L3845\r\n\r\n\r\nMinor additional nit: I think the RPC error messages typically start with a capital letter after the `Error: ` unless it's an RPC command (as in line 745 above).",
      "commit_id" : "412a9aa6f05396999057a9fd16684b590a09b9b7",
      "created_at" : "2023-01-17T21:01:59Z",
      "diff_hunk" : "@@ -745,6 +745,10 @@ static RPCHelpMan migratewallet()\n                 throw JSONRPCError(RPC_WALLET_WRONG_ENC_STATE, \"Error: migratewallet on encrypted wallets is currently unsupported.\");\n             }\n \n+            if (!wallet->GetLegacyScriptPubKeyMan()) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(\"Error: nothing to migrate, no legacy data contained in wallet \\\"%s\\\"\", wallet->GetName()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26910#discussion_r1072813726",
      "id" : 1072813726,
      "line" : 749,
      "node_id" : "PRRC_kwDOABII584_8dae",
      "original_commit_id" : "412a9aa6f05396999057a9fd16684b590a09b9b7",
      "original_line" : 749,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : 5,
      "pull_request_review_id" : 1252450155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26910",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072813726/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T21:06:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072813726",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/116917595?v=4",
         "events_url" : "https://api.github.com/users/john-moffett/events{/privacy}",
         "followers_url" : "https://api.github.com/users/john-moffett/followers",
         "following_url" : "https://api.github.com/users/john-moffett/following{/other_user}",
         "gists_url" : "https://api.github.com/users/john-moffett/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/john-moffett",
         "id" : 116917595,
         "login" : "john-moffett",
         "node_id" : "U_kgDOBvgFWw",
         "organizations_url" : "https://api.github.com/users/john-moffett/orgs",
         "received_events_url" : "https://api.github.com/users/john-moffett/received_events",
         "repos_url" : "https://api.github.com/users/john-moffett/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/john-moffett/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/john-moffett/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/john-moffett"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26910#discussion_r1073617130"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073617130"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I wonder if the message is consistent with how the migration code actually works. For instance, the error returned before this change is \"This wallet already uses SQLite\"\r\n\r\nwell, think about the command purpose. If there is no legacy data to migrate then why the command should be executed at all? Doesn't really care if the db is sqlite, bdb or anything else.\r\n\r\n> Minor additional nit: I think the RPC error messages typically start with a capital letter after the Error:  unless it's an RPC command (as in line 745 above).\r\n\r\nSeems that we have a mix of them, some errors start with a capital letter, some others not (like the encrypt.cpp file). I'm more aligned to this second form but have no real preference for any. Maybe the best move would be to open an issue an align all of them, in one way or another, at once.",
      "commit_id" : "412a9aa6f05396999057a9fd16684b590a09b9b7",
      "created_at" : "2023-01-18T14:34:39Z",
      "diff_hunk" : "@@ -745,6 +745,10 @@ static RPCHelpMan migratewallet()\n                 throw JSONRPCError(RPC_WALLET_WRONG_ENC_STATE, \"Error: migratewallet on encrypted wallets is currently unsupported.\");\n             }\n \n+            if (!wallet->GetLegacyScriptPubKeyMan()) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(\"Error: nothing to migrate, no legacy data contained in wallet \\\"%s\\\"\", wallet->GetName()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26910#discussion_r1073617130",
      "id" : 1073617130,
      "in_reply_to_id" : 1072813726,
      "line" : 749,
      "node_id" : "PRRC_kwDOABII584__hjq",
      "original_commit_id" : "412a9aa6f05396999057a9fd16684b590a09b9b7",
      "original_line" : 749,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/wallet.cpp",
      "position" : 5,
      "pull_request_review_id" : 1253604801,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26910",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073617130/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-18T14:34:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073617130",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   }
]
