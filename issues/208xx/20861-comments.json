[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20832 (rpc: Better error messages for invalid addresses by eilx2)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-01-05T22:05:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20861#issuecomment-754930797",
      "id" : 754930797,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20861",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1NDkzMDc5Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-05T22:05:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/754930797",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20861#discussion_r552296627"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20861"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/552296627"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why forbid Bech32m for v0? Seems like it might be nice to (very slowly) migrate to Bech32m exclusively, and drop Bech32 someday?",
      "commit_id" : "863a5c2eba77ca571813b33b9fa6237a9f3efbd7",
      "created_at" : "2021-01-06T00:52:33Z",
      "diff_hunk" : "@@ -90,14 +90,21 @@ CTxDestination DecodeDestination(const std::string& str, const CChainParams& par\n             return ScriptHash(hash);\n         }\n     }\n+    bech32::Encoding encoding;\n+    std::string hrp;\n+    std::vector<unsigned char> encdata;\n     data.clear();\n-    auto bech = bech32::Decode(str);\n-    if (bech.second.size() > 0 && bech.first == params.Bech32HRP()) {\n+    std::tie(encoding, hrp, encdata) = bech32::Decode(str);\n+    if ((encoding == bech32::Encoding::BECH32 || encoding == bech32::Encoding::BECH32M) &&\n+        encdata.size() > 0 && hrp == params.Bech32HRP()) {\n         // Bech32 decoding\n-        int version = bech.second[0]; // The first 5 bit symbol is the witness version (0-16)\n+        int version = encdata[0]; // The first 5 bit symbol is the witness version (0-16)\n+        if ((version == 0 && encoding != bech32::Encoding::BECH32) || (version != 0 && encoding != bech32::Encoding::BECH32M)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20861#discussion_r552296627",
      "id" : 552296627,
      "line" : 102,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjI5NjYyNw==",
      "original_commit_id" : "863a5c2eba77ca571813b33b9fa6237a9f3efbd7",
      "original_line" : 102,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/key_io.cpp",
      "position" : 43,
      "pull_request_review_id" : 562255415,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20861",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-06T00:52:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/552296627",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20861#discussion_r552298542"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20861"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/552298542"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it's a bad idea to have multiple addresses valid for the same scriptPubKey. It only results in confusion when decoding/recoding doesn't roundtrip. v0 outputs use bech32, and I don't think this should ever change, for better or for worse.\r\n\r\nIt also worsens error detection to 29 bits (as every v0 output now has two valid checksums).",
      "commit_id" : "863a5c2eba77ca571813b33b9fa6237a9f3efbd7",
      "created_at" : "2021-01-06T00:55:03Z",
      "diff_hunk" : "@@ -90,14 +90,21 @@ CTxDestination DecodeDestination(const std::string& str, const CChainParams& par\n             return ScriptHash(hash);\n         }\n     }\n+    bech32::Encoding encoding;\n+    std::string hrp;\n+    std::vector<unsigned char> encdata;\n     data.clear();\n-    auto bech = bech32::Decode(str);\n-    if (bech.second.size() > 0 && bech.first == params.Bech32HRP()) {\n+    std::tie(encoding, hrp, encdata) = bech32::Decode(str);\n+    if ((encoding == bech32::Encoding::BECH32 || encoding == bech32::Encoding::BECH32M) &&\n+        encdata.size() > 0 && hrp == params.Bech32HRP()) {\n         // Bech32 decoding\n-        int version = bech.second[0]; // The first 5 bit symbol is the witness version (0-16)\n+        int version = encdata[0]; // The first 5 bit symbol is the witness version (0-16)\n+        if ((version == 0 && encoding != bech32::Encoding::BECH32) || (version != 0 && encoding != bech32::Encoding::BECH32M)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20861#discussion_r552298542",
      "id" : 552298542,
      "in_reply_to_id" : 552296627,
      "line" : 102,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjI5ODU0Mg==",
      "original_commit_id" : "863a5c2eba77ca571813b33b9fa6237a9f3efbd7",
      "original_line" : 102,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/key_io.cpp",
      "position" : 43,
      "pull_request_review_id" : 562256132,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20861",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-06T00:55:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/552298542",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
