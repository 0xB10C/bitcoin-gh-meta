[
   {
      "body" : "This doesn't change the actual behaviour of the pre-existing functions, correct? So, eg, unit test assumptions remain valid..",
      "created_at" : "2014-03-16T20:30:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-37769328",
      "id" : 37769328,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-03-16T20:30:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/37769328",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "A better summary of the changes:\r\n* before: standalone headers/tx checks, (orphan store), tree headers/tx checks, store block, connect\r\n* after: standalone headers checks, tree headers checks, store headers, standalone tx checks, (orphan store), tree tx checks, store block, connect\r\n\r\nIn a later pull request, the orphan storage will be removed entirely, as blocks can be stored with just headers validated but not transactions (potentially resulting in out-of-order block storagre).",
      "created_at" : "2014-03-16T20:34:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-37769604",
      "id" : 37769604,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-03-16T20:34:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/37769604",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Please take your time, and ask for clarification as necessary.\r\n",
      "created_at" : "2014-03-17T19:06:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-37856930",
      "id" : 37856930,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-03-17T19:06:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/37856930",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "There is a bug in this code, which prevents syncing. Closing until fixed.",
      "created_at" : "2014-03-29T16:16:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-39000202",
      "id" : 39000202,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-03-29T16:16:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/39000202",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "\\o/ segfault",
      "created_at" : "2014-04-08T00:14:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-39799010",
      "id" : 39799010,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-04-08T00:14:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/39799010",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Bug fixed.\r\n\r\n@luke-jr I don't think any assumptions that are used in unit tests change. The only real change is that now CBlockIndex entries in the block tree may exist that do not have actual block data associated with them.",
      "created_at" : "2014-04-08T18:22:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-39883370",
      "id" : 39883370,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-04-08T18:22:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/39883370",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I did a review, comments ended up on the origin commit rather than here - oops.\r\n\r\nOverall looks good, just would appreciate some more comments and helper methods in a few places to make the logic easier to follow and reduce the chances of typos with all the bit twiddling.",
      "created_at" : "2014-04-10T15:08:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-40097047",
      "id" : 40097047,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-04-10T15:08:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/40097047",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/971089?v=3",
         "events_url" : "https://api.github.com/users/mikehearn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mikehearn/followers",
         "following_url" : "https://api.github.com/users/mikehearn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mikehearn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mikehearn",
         "id" : 971089,
         "login" : "mikehearn",
         "organizations_url" : "https://api.github.com/users/mikehearn/orgs",
         "received_events_url" : "https://api.github.com/users/mikehearn/received_events",
         "repos_url" : "https://api.github.com/users/mikehearn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mikehearn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mikehearn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mikehearn"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/3884#discussion_r11529986"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/3884"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/11529986"
         }
      },
      "body" : "Shouldn't these be constants perhaps in CChainParams?",
      "commit_id" : "942b33a19d3aa96326acc044c1834c48beff777c",
      "created_at" : "2014-04-11T12:42:37Z",
      "diff_hunk" : "@@ -2395,18 +2445,58 @@ bool AcceptBlock(CBlock& block, CValidationState& state, CDiskBlockPos* dbp)\n                                      REJECT_OBSOLETE, \"bad-version\");\n             }\n         }\n-        // Enforce block.nVersion=2 rule that the coinbase starts with serialized block height\n-        if (block.nVersion >= 2)\n+    }\n+\n+    if (pindex == NULL)\n+        pindex = AddToBlockIndex(block);\n+\n+    if ((pindex->nStatus & BLOCK_VALID_MASK) < BLOCK_VALID_TREE)\n+        pindex->nStatus = (pindex->nStatus & ~BLOCK_VALID_MASK) | BLOCK_VALID_TREE;\n+\n+    if (ppindex)\n+        *ppindex = pindex;\n+\n+    return true;\n+}\n+\n+bool AcceptBlock(CBlock& block, CValidationState& state, CBlockIndex** ppindex, CDiskBlockPos* dbp)\n+{\n+    CBlockIndex *&pindex = *ppindex;\n+\n+    if (!AcceptBlockHeader(block, state, &pindex))\n+        return false;\n+\n+    if (!CheckBlock(block, state)) {\n+        if (state.Invalid() && !state.CorruptionPossible()) {\n+            pindex->nStatus |= BLOCK_FAILED_VALID;\n+        }\n+        return false;\n+    }\n+\n+    int nHeight = pindex->nHeight;\n+    uint256 hash = pindex->GetBlockHash();\n+\n+    // Check that all transactions are finalized\n+    BOOST_FOREACH(const CTransaction& tx, block.vtx)\n+        if (!IsFinalTx(tx, nHeight, block.GetBlockTime())) {\n+            pindex->nStatus |= BLOCK_FAILED_VALID;\n+            return state.DoS(10, error(\"AcceptBlock() : contains a non-final transaction\"),\n+                             REJECT_INVALID, \"bad-txns-nonfinal\");\n+        }\n+\n+    // Enforce block.nVersion=2 rule that the coinbase starts with serialized block height\n+    if (block.nVersion >= 2)\n+    {\n+        // if 750 of the last 1,000 blocks are version 2 or greater (51/100 if testnet):\n+        if ((!TestNet() && CBlockIndex::IsSuperMajority(2, pindex->pprev, 750, 1000)) ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#discussion_r11529986",
      "id" : 11529986,
      "original_commit_id" : "2c82f2e5bed71e01d90e33122c82231f16286a4b",
      "original_position" : 225,
      "path" : "src/main.cpp",
      "position" : 248,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/3884",
      "updated_at" : "2014-04-24T22:36:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/11529986",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/3884#discussion_r11531092"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/3884"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/11531092"
         }
      },
      "body" : "Agree, but let's do that in another PR.",
      "commit_id" : "942b33a19d3aa96326acc044c1834c48beff777c",
      "created_at" : "2014-04-11T13:12:17Z",
      "diff_hunk" : "@@ -2395,18 +2445,58 @@ bool AcceptBlock(CBlock& block, CValidationState& state, CDiskBlockPos* dbp)\n                                      REJECT_OBSOLETE, \"bad-version\");\n             }\n         }\n-        // Enforce block.nVersion=2 rule that the coinbase starts with serialized block height\n-        if (block.nVersion >= 2)\n+    }\n+\n+    if (pindex == NULL)\n+        pindex = AddToBlockIndex(block);\n+\n+    if ((pindex->nStatus & BLOCK_VALID_MASK) < BLOCK_VALID_TREE)\n+        pindex->nStatus = (pindex->nStatus & ~BLOCK_VALID_MASK) | BLOCK_VALID_TREE;\n+\n+    if (ppindex)\n+        *ppindex = pindex;\n+\n+    return true;\n+}\n+\n+bool AcceptBlock(CBlock& block, CValidationState& state, CBlockIndex** ppindex, CDiskBlockPos* dbp)\n+{\n+    CBlockIndex *&pindex = *ppindex;\n+\n+    if (!AcceptBlockHeader(block, state, &pindex))\n+        return false;\n+\n+    if (!CheckBlock(block, state)) {\n+        if (state.Invalid() && !state.CorruptionPossible()) {\n+            pindex->nStatus |= BLOCK_FAILED_VALID;\n+        }\n+        return false;\n+    }\n+\n+    int nHeight = pindex->nHeight;\n+    uint256 hash = pindex->GetBlockHash();\n+\n+    // Check that all transactions are finalized\n+    BOOST_FOREACH(const CTransaction& tx, block.vtx)\n+        if (!IsFinalTx(tx, nHeight, block.GetBlockTime())) {\n+            pindex->nStatus |= BLOCK_FAILED_VALID;\n+            return state.DoS(10, error(\"AcceptBlock() : contains a non-final transaction\"),\n+                             REJECT_INVALID, \"bad-txns-nonfinal\");\n+        }\n+\n+    // Enforce block.nVersion=2 rule that the coinbase starts with serialized block height\n+    if (block.nVersion >= 2)\n+    {\n+        // if 750 of the last 1,000 blocks are version 2 or greater (51/100 if testnet):\n+        if ((!TestNet() && CBlockIndex::IsSuperMajority(2, pindex->pprev, 750, 1000)) ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#discussion_r11531092",
      "id" : 11531092,
      "original_commit_id" : "2c82f2e5bed71e01d90e33122c82231f16286a4b",
      "original_position" : 225,
      "path" : "src/main.cpp",
      "position" : 248,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/3884",
      "updated_at" : "2014-04-24T22:36:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/11531092",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "There seems to be some bug on the connection logic in this pull. I got a node stuck after it got shutdown during syncing. After launching it again, all the remaining blocks got marked as orphans, and it never resumed syncing. Shutting down and launching again several times didn't help.",
      "created_at" : "2014-04-16T16:43:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-40622381",
      "id" : 40622381,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-04-16T16:43:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/40622381",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1192483?v=3",
         "events_url" : "https://api.github.com/users/rdponticelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rdponticelli/followers",
         "following_url" : "https://api.github.com/users/rdponticelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rdponticelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rdponticelli",
         "id" : 1192483,
         "login" : "rdponticelli",
         "organizations_url" : "https://api.github.com/users/rdponticelli/orgs",
         "received_events_url" : "https://api.github.com/users/rdponticelli/received_events",
         "repos_url" : "https://api.github.com/users/rdponticelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rdponticelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rdponticelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rdponticelli"
      }
   },
   {
      "body" : "@rdponticelli With a recent version of this code (less than 8 days old?)",
      "created_at" : "2014-04-16T17:24:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-40627044",
      "id" : 40627044,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-04-16T17:24:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/40627044",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa Yes, last version. Culprit seems to be some kind of race condition with the low disk space code. Some logs:\r\n\r\n2014-04-16 14:18:49 UpdateTip: new best=0000000000000000937bdca5485b8a02da4cbfea74fe982903a2da1ba8537866  height=295933  log2_work=77.988128  tx=36873027  date=2014-04-15 07:18:51 progress=0.993805\r\n2014-04-16 14:18:49 ProcessBlock: ACCEPTED\r\n2014-04-16 14:18:49 *** Error: Disk space is low!\r\n2014-04-16 14:19:03 ERROR: AcceptBlock() : FindBlockPos failed\r\n2014-04-16 14:19:03 ERROR: ProcessBlock() : AcceptBlock FAILED\r\n2014-04-16 14:19:03 Requesting shutdown\r\n2014-04-16 14:19:03 ProcessBlock: ORPHAN BLOCK 0, prev=0000000000000000a89d601cd42705cfe8a25b6546ed892309c67e5a197e3fdb\r\n2014-04-16 14:19:03 ProcessBlock: ORPHAN BLOCK 1, prev=000000000000000005ea1ca8a944a574826bd856b83a29871f46c8e2a2323deb\r\n2014-04-16 14:19:03 Running Shutdown in thread\r\n\r\nAfter that all the chain is detected as orphan:\r\n\r\n2014-04-16 14:58:04 Initialization result: 1\r\n2014-04-16 14:58:14 ProcessBlock: ORPHAN BLOCK 0, prev=0000000000000000a89d601cd42705cfe8a25b6546ed892309c67e5a197e3fdb\r\n2014-04-16 14:58:15 ProcessBlock: ORPHAN BLOCK 1, prev=000000000000000005ea1ca8a944a574826bd856b83a29871f46c8e2a2323deb\r\n2014-04-16 14:58:17 ProcessBlock: ORPHAN BLOCK 2, prev=00000000000000001179ce5490d2ff833c0afb1799b6beb0981096c9800002c8\r\n2014-04-16 14:58:17 ProcessBlock: ORPHAN BLOCK 3, prev=00000000000000001b4fd2aaec801ac068ea2a39a4b9f9eb16569a69c6713d6f\r\n2014-04-16 14:58:18 ProcessBlock: ORPHAN BLOCK 4, prev=000000000000000023524d33b27b7ea7135332b32853a7582cf504e20644ea48\r\n2014-04-16 14:58:19 ProcessBlock: ORPHAN BLOCK 5, prev=0000000000000000a5344e5239e17ae8995d3c7c1417b38d0dc1e047595a3807\r\n",
      "created_at" : "2014-04-16T17:35:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-40628189",
      "id" : 40628189,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-04-16T17:35:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/40628189",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1192483?v=3",
         "events_url" : "https://api.github.com/users/rdponticelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rdponticelli/followers",
         "following_url" : "https://api.github.com/users/rdponticelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rdponticelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rdponticelli",
         "id" : 1192483,
         "login" : "rdponticelli",
         "organizations_url" : "https://api.github.com/users/rdponticelli/orgs",
         "received_events_url" : "https://api.github.com/users/rdponticelli/received_events",
         "repos_url" : "https://api.github.com/users/rdponticelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rdponticelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rdponticelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rdponticelli"
      }
   },
   {
      "body" : "Running the code in master in this state I got:\r\n\r\n2014-04-16 17:10:31 init message: Done loading\r\n2014-04-16 17:10:31 Initialization result: 1\r\n2014-04-16 17:10:41 Pre-allocating up to position 0x7000000 in blk00132.dat\r\n2014-04-16 17:10:47 ERROR: ReadBlockFromDisk : OpenBlockFile failed\r\n2014-04-16 17:10:47 *** Failed to read block\r\n2014-04-16 17:10:51 ERROR: AcceptBlock() : AddToBlockIndex failed\r\n2014-04-16 17:10:51 ERROR: ProcessBlock() : AcceptBlock FAILED\r\n2014-04-16 17:10:51 ERROR: ReadBlockFromDisk : OpenBlockFile failed\r\n2014-04-16 17:10:51 *** Failed to read block\r\n2014-04-16 17:10:51 ERROR: AcceptBlock() : AddToBlockIndex failed\r\n2014-04-16 17:10:51 ERROR: ProcessBlock() : AcceptBlock FAILED\r\n2014-04-16 17:10:51 Requesting shutdown\r\n2014-04-16 17:10:51 Running Shutdown in thread\r\n2014-04-16 17:10:51 ERROR: ReadBlockFromDisk : OpenBlockFile failed\r\n2014-04-16 17:10:51 *** Failed to read block\r\n2014-04-16 17:10:51 addcon thread interrupt\r\n2014-04-16 17:10:51 net thread interrupt\r\n2014-04-16 17:10:51 dumpaddr thread stop\r\n2014-04-16 17:10:51 opencon thread interrupt\r\n2014-04-16 17:10:53 ERROR: AcceptBlock() : AddToBlockIndex failed\r\n2014-04-16 17:10:53 ERROR: ProcessBlock() : AcceptBlock FAILED\r\n2014-04-16 17:10:53 msghand thread interrupt\r\n2014-04-16 17:10:53 Shutdown : In progress...\r\n\r\nAnd after that the new code again:\r\n\r\n2014-04-16 17:45:19 init message: Done loading\r\n2014-04-16 17:45:19 Initialization result: 1\r\n2014-04-16 17:45:28 ProcessBlock: ACCEPTED\r\n2014-04-16 17:45:31 ProcessBlock: ACCEPTED\r\n2014-04-16 17:45:31 CheckForkWarningConditions: Warning: Found invalid chain at least ~6 blocks longer than our best chain.\r\nChain state database corruption likely.\r\n2014-04-16 17:45:31 ProcessBlock: ACCEPTED\r\n2014-04-16 17:45:31 CheckForkWarningConditions: Warning: Large valid fork found\r\n  forking the chain at height 295933 (0000000000000000937bdca5485b8a02da4cbfea74fe982903a2da1ba8537866)\r\n  lasting to height 295941 (00000000000000002cda160c4452e7ad5252453a969dc6ff9b6e9e8bb584093f).\r\nChain state database corruption likely.\r\n2014-04-16 17:45:31 ProcessBlock: ACCEPTED\r\n2014-04-16 17:45:33 CheckForkWarningConditions: Warning: Large valid fork found\r\n  forking the chain at height 295933 (0000000000000000937bdca5485b8a02da4cbfea74fe982903a2da1ba8537866)\r\n  lasting to height 295942 (0000000000000000adfe890f4c33801b26fac05207747652d8c311244e59a6d0).\r\nChain state database corruption likely.\r\n\r\nAnd it's still going like this....",
      "created_at" : "2014-04-16T18:18:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-40633330",
      "id" : 40633330,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-04-16T18:18:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/40633330",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1192483?v=3",
         "events_url" : "https://api.github.com/users/rdponticelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rdponticelli/followers",
         "following_url" : "https://api.github.com/users/rdponticelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rdponticelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rdponticelli",
         "id" : 1192483,
         "login" : "rdponticelli",
         "organizations_url" : "https://api.github.com/users/rdponticelli/orgs",
         "received_events_url" : "https://api.github.com/users/rdponticelli/received_events",
         "repos_url" : "https://api.github.com/users/rdponticelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rdponticelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rdponticelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rdponticelli"
      }
   },
   {
      "body" : "@rdponticelli Thanks for testing!\r\n\r\nSo the problem was that if the block data failed to write, we ended up with a block header in the index, but no corresponding block data in the block file. At next startup, this would mean it would need to download it again, but the block download logic can't deal with the in-index-but-not-on-disk case yet, which will be added later.\r\n\r\nI've (hopefully) fixed it by only writing the block header to the index after the block data is present.",
      "created_at" : "2014-04-17T11:21:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-40704167",
      "id" : 40704167,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-04-17T11:21:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/40704167",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Now I'm getting this on another node. It seems that it's breaking when it changes the block file:\r\n\r\n2014-04-17 19:02:56 ProcessBlock: ACCEPTED\r\n2014-04-17 19:03:07 UpdateTip: new best=0000000000000000551b394408e467f83cd5d6f36612f8e33643d188f0d4498f  height=293947  log2_work=77.722856  tx=36140885  date=2014-04-03 11:35:26 progress=0.931634\r\n2014-04-17 19:03:07 ProcessBlock: ACCEPTED\r\n2014-04-17 19:03:18 Pre-allocating up to position 0x300000 in rev00129.dat\r\n2014-04-17 19:03:19 UpdateTip: new best=000000000000000055c9d3b2a816877d3b1a9ca6048170ed7cee1c8629255e0e  height=293948  log2_work=77.72298  tx=36141736  date=2014-04-03 11:56:14 progress=0.931702\r\n2014-04-17 19:03:19 ProcessBlock: ACCEPTED\r\n2014-04-17 19:03:21 Pre-allocating up to position 0x2000000 in blk00129.dat\r\n2014-04-17 19:03:52 UpdateTip: new best=0000000000000000b2a0b9c58aa86994aa85385d0d8a8676945f6d3b642b27a9  height=293949  log2_work=77.723105  tx=36142897  date=2014-04-03 12:08:09 progress=0.931744\r\n2014-04-17 19:03:53 ProcessBlock: ACCEPTED\r\n2014-04-17 19:03:53 ProcessBlock: ORPHAN BLOCK 0, prev=00000000000000006c3f5ca15b21e43e7328c6ea033a25671f08c396cfd027ca\r\n2014-04-17 19:03:59 UpdateTip: new best=00000000000000006e97b96972f7f31f0847fcf35e723193c0949dad4bbc730c  height=293950  log2_work=77.723229  tx=36143254  date=2014-04-03 12:14:21 progress=0.931765\r\n2014-04-17 19:03:59 ProcessBlock: ACCEPTED\r\n2014-04-17 19:04:03 UpdateTip: new best=0000000000000000cf179e61ecbe56eb19561396ef72650f2a8b3e7d29d21cde  height=293951  log2_work=77.723353  tx=36143569  date=2014-04-03 12:20:27 progress=0.931785\r\n2014-04-17 19:04:03 ProcessBlock: ACCEPTED\r\n2014-04-17 19:04:05 UpdateTip: new best=000000000000000039022b02422dfee754c2dd91cf8dac8289c956b30da37b80  height=293952  log2_work=77.723478  tx=36143600  date=2014-04-03 12:20:35 progress=0.931785\r\n2014-04-17 19:04:05 ProcessBlock: ACCEPTED\r\n2014-04-17 19:04:05 ProcessBlock: ORPHAN BLOCK 1, prev=00000000000000007f49a436045b4190c4164adef4479ebc290ae1379826b40a\r\n2014-04-17 19:04:07 UpdateTip: new best=00000000000000001c9b145536ce2f3ffd529742b0ab58a4bdee1ebd985e4c69  height=293953  log2_work=77.723602  tx=36143765  date=2014-04-03 12:24:37 progress=0.931799\r\n2014-04-17 19:04:07 ProcessBlock: ACCEPTED\r\n2014-04-17 19:04:07 ProcessBlock: ORPHAN BLOCK 2, prev=0000000000000000c0b4bede793045606417892efcbb83c3d5c52b9aa74b9086\r\n2014-04-17 19:04:08 UpdateTip: new best=0000000000000000c9cbe25307641906939f3e767d94dd7d2553b860dad7a835  height=293954  log2_work=77.723726  tx=36143895  date=2014-04-03 12:27:15 progress=0.931808\r\n",
      "created_at" : "2014-04-17T19:19:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-40752143",
      "id" : 40752143,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-04-17T19:19:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/40752143",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1192483?v=3",
         "events_url" : "https://api.github.com/users/rdponticelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rdponticelli/followers",
         "following_url" : "https://api.github.com/users/rdponticelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rdponticelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rdponticelli",
         "id" : 1192483,
         "login" : "rdponticelli",
         "organizations_url" : "https://api.github.com/users/rdponticelli/orgs",
         "received_events_url" : "https://api.github.com/users/rdponticelli/received_events",
         "repos_url" : "https://api.github.com/users/rdponticelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rdponticelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rdponticelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rdponticelli"
      }
   },
   {
      "body" : "Just seeing orphans while syncing is perfectly expected (not intentional though, but it will require more to fix that).",
      "created_at" : "2014-04-17T19:49:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-40755048",
      "id" : 40755048,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-04-17T19:49:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/40755048",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Rebased and addressed @mikehearn's comments.",
      "created_at" : "2014-04-18T21:42:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-40847068",
      "id" : 40847068,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-04-18T21:42:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/40847068",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Rebased.",
      "created_at" : "2014-04-24T22:36:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-41341113",
      "id" : 41341113,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-04-24T22:36:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/41341113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/942b33a19d3aa96326acc044c1834c48beff777c for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.",
      "created_at" : "2014-04-24T23:00:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-41342904",
      "id" : 41342904,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-04-24T23:00:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/41342904",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "body" : "@gavinandresen How does this look to you?",
      "created_at" : "2014-04-29T21:42:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-41736093",
      "id" : 41736093,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-04-29T21:42:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/41736093",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/971089?v=3",
         "events_url" : "https://api.github.com/users/mikehearn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mikehearn/followers",
         "following_url" : "https://api.github.com/users/mikehearn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mikehearn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mikehearn",
         "id" : 971089,
         "login" : "mikehearn",
         "organizations_url" : "https://api.github.com/users/mikehearn/orgs",
         "received_events_url" : "https://api.github.com/users/mikehearn/received_events",
         "repos_url" : "https://api.github.com/users/mikehearn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mikehearn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mikehearn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mikehearn"
      }
   },
   {
      "body" : "Tested this on the Dogecoin blockchain. Both initial sync and keeping up with the blockchain worked as normal, both restarting the client and waking up from hibernation worked fine and I didn't spot anything unusual in the logs.",
      "created_at" : "2014-05-02T13:38:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-42032702",
      "id" : 42032702,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-05-02T13:38:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/42032702",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4348296?v=3",
         "events_url" : "https://api.github.com/users/leofidus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/leofidus/followers",
         "following_url" : "https://api.github.com/users/leofidus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/leofidus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/leofidus",
         "id" : 4348296,
         "login" : "leofidus",
         "organizations_url" : "https://api.github.com/users/leofidus/orgs",
         "received_events_url" : "https://api.github.com/users/leofidus/received_events",
         "repos_url" : "https://api.github.com/users/leofidus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/leofidus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/leofidus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/leofidus"
      }
   },
   {
      "body" : "I'm currently testing this. It's still incredibly slow due to the peer selection for the block download. I really think it should take the speed of download into consideration for selecting a peer, and I still don't understand why it selects only one peer - why can't it select several? After all, most download tools these days choose to download from multiple sources to reduce the load on any one source.",
      "created_at" : "2014-05-09T00:09:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-42621306",
      "id" : 42621306,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-05-09T00:09:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/42621306",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "@rebroad This is an incremental reorganization. All that stuff you are talking about was implemented months ago in sipa's headers first branch but it was too risky a change to take at once and wasn't seeing adequate testing.  This pull (and others) are breaking up the steps to move to it incrementally in a way which is easier to verify.",
      "created_at" : "2014-05-09T00:14:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-42621532",
      "id" : 42621532,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-05-09T00:14:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/42621532",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@gmaxwell yes, I know. The stuff I am talking about hasn't been implemented yet. This is why I am mentioning it.",
      "created_at" : "2014-05-09T01:48:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-42626282",
      "id" : 42626282,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-05-09T01:48:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/42626282",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "> The stuff I am talking about hasn't been implemented yet.\r\n\r\nPulling from multiple peers and taking speed into account were both implemented in the headers first branch. (actually it does something which is usually better than take speed into account it tracks when peers are stalling the process and kicks out the straggler(s)).",
      "created_at" : "2014-05-09T02:00:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-42626881",
      "id" : 42626881,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-05-09T02:00:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/42626881",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@rebroad That's just rude. Please keep discussion in issues about the goal of the issue. @sipa does not claim that this change solves the problems that you mention, so you should not be disappointed that they are not solved by it.",
      "created_at" : "2014-05-09T05:46:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-42635350",
      "id" : 42635350,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-05-09T05:46:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/42635350",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@rebroad Selecting multiple peers to download from would just bring duplicate block downloads back, unless it happens in a coordinated way. No such coordination exists, because we don't know in advance which peers have which blocks - we just download what they tell us they have.\r\n\r\nNobody claims we can't download from multiple peers at once - that is one of the goals of headers-first synchronization (which this is incremental work towards, but it will take a few more pull requests before we're actually there).",
      "created_at" : "2014-05-09T10:25:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-42652367",
      "id" : 42652367,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-05-09T10:25:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/42652367",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "How do we decide when there's been enough testing and review? Seems like the path forward here isn't clear.",
      "created_at" : "2014-05-09T11:00:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-42654652",
      "id" : 42654652,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-05-09T11:00:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/42654652",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/971089?v=3",
         "events_url" : "https://api.github.com/users/mikehearn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mikehearn/followers",
         "following_url" : "https://api.github.com/users/mikehearn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mikehearn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mikehearn",
         "id" : 971089,
         "login" : "mikehearn",
         "organizations_url" : "https://api.github.com/users/mikehearn/orgs",
         "received_events_url" : "https://api.github.com/users/mikehearn/received_events",
         "repos_url" : "https://api.github.com/users/mikehearn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mikehearn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mikehearn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mikehearn"
      }
   },
   {
      "body" : "@mikehearn What part is unclear? This is tagged '0.10' so will be merged after the branch-off of 0.9.2.\r\n\r\n",
      "created_at" : "2014-05-09T11:31:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-42656694",
      "id" : 42656694,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-05-09T11:31:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/42656694",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "This may be a discussion for the mailing list, but I'm not sure it's healthy to keep pull requests that are \"done\" queued up where they have to be constantly rebased, waiting to enter master, missing out on testing that people might do. If you want to have a branch for stabilisation, why not branch for 0.9.2 now and cherry pick fixes into it until you're confident it's ready?",
      "created_at" : "2014-05-09T11:46:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-42657665",
      "id" : 42657665,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-05-09T11:46:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/42657665",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/971089?v=3",
         "events_url" : "https://api.github.com/users/mikehearn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mikehearn/followers",
         "following_url" : "https://api.github.com/users/mikehearn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mikehearn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mikehearn",
         "id" : 971089,
         "login" : "mikehearn",
         "organizations_url" : "https://api.github.com/users/mikehearn/orgs",
         "received_events_url" : "https://api.github.com/users/mikehearn/received_events",
         "repos_url" : "https://api.github.com/users/mikehearn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mikehearn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mikehearn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mikehearn"
      }
   },
   {
      "body" : "I know that - the plan is to split off 0.9.2 this week.",
      "created_at" : "2014-05-09T12:48:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-42661928",
      "id" : 42661928,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-05-09T12:48:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/42661928",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Okie dokie.",
      "created_at" : "2014-05-09T12:59:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-42662782",
      "id" : 42662782,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-05-09T12:59:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/42662782",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/971089?v=3",
         "events_url" : "https://api.github.com/users/mikehearn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mikehearn/followers",
         "following_url" : "https://api.github.com/users/mikehearn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mikehearn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mikehearn",
         "id" : 971089,
         "login" : "mikehearn",
         "organizations_url" : "https://api.github.com/users/mikehearn/orgs",
         "received_events_url" : "https://api.github.com/users/mikehearn/received_events",
         "repos_url" : "https://api.github.com/users/mikehearn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mikehearn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mikehearn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mikehearn"
      }
   },
   {
      "body" : "@gmaxwell ah, so it's not in the master branch? Am I able to submit pull requests to the branch you mention? What is the purpose of this branch and will it as some point be merged into master?\r\n\r\nMy main reason for mentioning these concerns is that the current master as it is doesn't work well, and gets 300 or so orphan blocks piling up without catching up on the blockchain, often requiring a restart of bitcoind to get it downloading again, at which point the hundreds of orphan blocks already downloaded are then lost (since they are not saved to disk).\r\n\r\nIt's also frustrating to see this, considering I raised a pull request about 2 years ago which downloaded blocks far faster and more efficiently than it currently does, and which did detect stuck downloads, unlike the current master branch.",
      "created_at" : "2014-05-09T13:18:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-42664439",
      "id" : 42664439,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-05-09T13:22:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/42664439",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "@rebroad Gregory talking about my personal headers-first branch (#2964),\nwhich was never merged because of multiple reasons, and later abandoned.\nI've since (slowly) been working on several pull requests with pieces of\nthat functionality. This pull request is just some refactoring work towards\nthat.",
      "created_at" : "2014-05-09T13:57:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3884#issuecomment-42668599",
      "id" : 42668599,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3884",
      "updated_at" : "2014-05-09T13:57:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/42668599",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
