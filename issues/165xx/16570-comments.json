[
   {
      "author_association" : "NONE",
      "body" : "Woops, lint failed.. \r\nIs there an easy way to reproduce a Travis job locally? I'm a newb to Travis. I tried following https://stackoverflow.com/questions/21053657/how-to-run-travis-ci-locally/49019950 but I don't understand the instance field that is displayed in the Travis build logs (there is more than one instance there?)",
      "created_at" : "2019-08-08T12:37:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16570#issuecomment-519499953",
      "id" : 519499953,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16570",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxOTQ5OTk1Mw==",
      "updated_at" : "2019-08-08T12:37:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/519499953",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/5347350?v=4",
         "events_url" : "https://api.github.com/users/davereikher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/davereikher/followers",
         "following_url" : "https://api.github.com/users/davereikher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/davereikher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/davereikher",
         "id" : 5347350,
         "login" : "davereikher",
         "node_id" : "MDQ6VXNlcjUzNDczNTA=",
         "organizations_url" : "https://api.github.com/users/davereikher/orgs",
         "received_events_url" : "https://api.github.com/users/davereikher/received_events",
         "repos_url" : "https://api.github.com/users/davereikher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/davereikher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/davereikher"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@davereikher The linter is just complaining about [trailing whitespace](https://travis-ci.org/bitcoin/bitcoin/jobs/569314353):\r\n```bash\r\nThis diff appears to have added new lines with trailing whitespace.\r\n\r\nThe following changes were suspected:\r\n\r\ndiff --git a/src/test/descriptor_tests.cpp b/src/test/descriptor_tests.cpp\r\n\r\n@@ -55,0 +63 @@ std::string MaybeUseHInsteadOfApostrophy(std::string ret)\r\n\r\n+\r\n\r\n@@ -61 +69,2 @@ const std::set<std::vector<uint32_t>> ONLY_EMPTY{{}};\r\n\r\n+void DoCheck(const std::string& prv, const std::string& pub, int flags, const std::vector<std::vector<std::string>>& scripts, const std::set<std::vector<uint32_t>>& paths = ONLY_EMPTY,\r\n\r\n^---- failure generated from test/lint/lint-whitespace.sh\r\n```\r\n\r\nYou should be able to run the `test/lint/lint-whitespace.sh` script (as well as the other linters) locally.",
      "created_at" : "2019-08-08T12:41:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16570#issuecomment-519501230",
      "id" : 519501230,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16570",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxOTUwMTIzMA==",
      "updated_at" : "2019-08-08T12:41:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/519501230",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16542](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16542.html) (Return more specific errors about invalid descriptors by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-08-08T12:52:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16570#issuecomment-519504998",
      "id" : 519504998,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16570",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxOTUwNDk5OA==",
      "updated_at" : "2019-08-08T12:52:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/519504998",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "The `test/lint/lint-whitespace.sh` script finishes without errors locally. I would like to reproduce the Travis environment to avoid fixing and pushing multiple times. If not, I can just remove the trailing whitespace and try again.",
      "created_at" : "2019-08-08T12:54:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16570#issuecomment-519505652",
      "id" : 519505652,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16570",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxOTUwNTY1Mg==",
      "updated_at" : "2019-08-08T12:54:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/519505652",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/5347350?v=4",
         "events_url" : "https://api.github.com/users/davereikher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/davereikher/followers",
         "following_url" : "https://api.github.com/users/davereikher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/davereikher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/davereikher",
         "id" : 5347350,
         "login" : "davereikher",
         "node_id" : "MDQ6VXNlcjUzNDczNTA=",
         "organizations_url" : "https://api.github.com/users/davereikher/orgs",
         "received_events_url" : "https://api.github.com/users/davereikher/received_events",
         "repos_url" : "https://api.github.com/users/davereikher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/davereikher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/davereikher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312172302"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312172302"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This comment shouldn't be moved.",
      "commit_id" : "0fc46f5b9262f016c42d2abe68d5125833f55416",
      "created_at" : "2019-08-08T18:06:38Z",
      "diff_hunk" : "@@ -137,6 +109,36 @@ std::string DescriptorChecksum(const Span<const char>& span)\n     return ret;\n }\n \n+\n+namespace {\n+\n+////////////////////////////////////////////////////////////////////////////\n+// Checksum                                                               //",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312172302",
      "id" : 312172302,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjE3MjMwMg==",
      "original_commit_id" : "f86cf3ab9b84d68e40e5d28fcc60033b571e4b9e",
      "original_position" : 43,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 272746486,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570",
      "updated_at" : "2019-08-09T14:24:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312172302",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312172435"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312172435"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Unnecessary whitespace change.",
      "commit_id" : "0fc46f5b9262f016c42d2abe68d5125833f55416",
      "created_at" : "2019-08-08T18:06:56Z",
      "diff_hunk" : "@@ -28,6 +31,8 @@ constexpr int HARDENED = 2; // Derivation needs access to private keys\n constexpr int UNSOLVABLE = 4; // This descriptor is not expected to be solvable\n constexpr int SIGNABLE = 8; // We can sign with this descriptor (this is not true when actual BIP32 derivation is used, as that's not integrated in our signing code)\n \n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312172435",
      "id" : 312172435,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjE3MjQzNQ==",
      "original_commit_id" : "f86cf3ab9b84d68e40e5d28fcc60033b571e4b9e",
      "original_position" : 14,
      "path" : "src/test/descriptor_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 272746486,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570",
      "updated_at" : "2019-08-09T14:24:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312172435",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312176003"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312176003"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it would make more sense to largely leave this function untouched and instead do the `'` to `h` change in your new `Check` function below. The only change here would be to remove `MaybeUseHInsteadOfApostrophy`",
      "commit_id" : "0fc46f5b9262f016c42d2abe68d5125833f55416",
      "created_at" : "2019-08-08T18:14:53Z",
      "diff_hunk" : "@@ -40,32 +45,46 @@ bool EqualDescriptor(std::string a, std::string b)\n     return a == b;\n }\n \n-std::string MaybeUseHInsteadOfApostrophy(std::string ret)\n+std::string UseHInsteadOfApostrophe(std::string ret)\n {\n-    if (InsecureRandBool()) {\n-        while (true) {\n-            auto it = ret.find(\"'\");\n-            if (it != std::string::npos) {\n-                ret[it] = 'h';\n-                if (ret.size() > 9 && ret[ret.size() - 9] == '#') ret = ret.substr(0, ret.size() - 9); // Changing apostrophe to h breaks the checksum\n-            } else {\n-                break;\n+    while (true) {\n+        auto it = ret.find(\"'\");\n+        if (it != std::string::npos) {\n+            ret[it] = 'h';\n+            if (ret.size() > 9 && ret[ret.size() - 9] == '#') {\n+                Span<const char> data = Span<const char>(ret.data(), ret.size() - 9);\n+                std::string new_checksum = DescriptorChecksum(data);\n+                ret = ret.substr(0, ret.size() - 8) + new_checksum; // Changing apostrophe to h breaks the checksum - recalculate it and replace the broken one\n             }\n+        } else {\n+            break;\n         }\n     }\n     return ret;\n }\n \n const std::set<std::vector<uint32_t>> ONLY_EMPTY{{}};\n \n-void Check(const std::string& prv, const std::string& pub, int flags, const std::vector<std::vector<std::string>>& scripts, const std::set<std::vector<uint32_t>>& paths = ONLY_EMPTY)\n+void DoCheck(const std::string& prv, const std::string& pub, int flags, const std::vector<std::vector<std::string>>& scripts, const std::set<std::vector<uint32_t>>& paths = ONLY_EMPTY,\n+    bool replace_apostrophe_with_h=false)\n {\n     FlatSigningProvider keys_priv, keys_pub;\n     std::set<std::vector<uint32_t>> left_paths = paths;\n \n+    std::unique_ptr<Descriptor> parse_priv;\n+    std::unique_ptr<Descriptor> parse_pub;\n     // Check that parsing succeeds.\n-    auto parse_priv = Parse(MaybeUseHInsteadOfApostrophy(prv), keys_priv);\n-    auto parse_pub = Parse(MaybeUseHInsteadOfApostrophy(pub), keys_pub);\n+    if (replace_apostrophe_with_h)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312176003",
      "id" : 312176003,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjE3NjAwMw==",
      "original_commit_id" : "f86cf3ab9b84d68e40e5d28fcc60033b571e4b9e",
      "original_position" : 64,
      "path" : "src/test/descriptor_tests.cpp",
      "position" : 55,
      "pull_request_review_id" : 272746486,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570",
      "updated_at" : "2019-08-09T14:24:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312176003",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312398066"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312398066"
         }
      },
      "author_association" : "NONE",
      "body" : "I'm not sure I understand. It's not quite clear in the diff, but the `// Checksum` comment was not moved. It remains after `namespace {`. The only comment that was moved is the one above `PolyMod`, describing the operation of that function, along with the function.",
      "commit_id" : "0fc46f5b9262f016c42d2abe68d5125833f55416",
      "created_at" : "2019-08-09T09:24:05Z",
      "diff_hunk" : "@@ -137,6 +109,36 @@ std::string DescriptorChecksum(const Span<const char>& span)\n     return ret;\n }\n \n+\n+namespace {\n+\n+////////////////////////////////////////////////////////////////////////////\n+// Checksum                                                               //",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312398066",
      "id" : 312398066,
      "in_reply_to_id" : 312172302,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjM5ODA2Ng==",
      "original_commit_id" : "f86cf3ab9b84d68e40e5d28fcc60033b571e4b9e",
      "original_position" : 43,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 273033010,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570",
      "updated_at" : "2019-08-09T14:24:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312398066",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/5347350?v=4",
         "events_url" : "https://api.github.com/users/davereikher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/davereikher/followers",
         "following_url" : "https://api.github.com/users/davereikher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/davereikher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/davereikher",
         "id" : 5347350,
         "login" : "davereikher",
         "node_id" : "MDQ6VXNlcjUzNDczNTA=",
         "organizations_url" : "https://api.github.com/users/davereikher/orgs",
         "received_events_url" : "https://api.github.com/users/davereikher/received_events",
         "repos_url" : "https://api.github.com/users/davereikher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/davereikher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/davereikher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312409702"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312409702"
         }
      },
      "author_association" : "NONE",
      "body" : "I agree and I did it that way initially but then, for example, this check failed:\r\n```\r\nstd::string pub1 = parse_priv->ToString();\r\nBOOST_CHECK(EqualDescriptor(pub, pub1));\r\n```\r\nsince Descriptor::ToString returns a descriptor formatted with `'`, while pub has `h`, if I do it the way you suggest. I had to work around this by passing pub and prv without modification and introducing a boolean argument of whether to swap `'` with `h` only when passing them to the `Parse` function.",
      "commit_id" : "0fc46f5b9262f016c42d2abe68d5125833f55416",
      "created_at" : "2019-08-09T09:55:46Z",
      "diff_hunk" : "@@ -40,32 +45,46 @@ bool EqualDescriptor(std::string a, std::string b)\n     return a == b;\n }\n \n-std::string MaybeUseHInsteadOfApostrophy(std::string ret)\n+std::string UseHInsteadOfApostrophe(std::string ret)\n {\n-    if (InsecureRandBool()) {\n-        while (true) {\n-            auto it = ret.find(\"'\");\n-            if (it != std::string::npos) {\n-                ret[it] = 'h';\n-                if (ret.size() > 9 && ret[ret.size() - 9] == '#') ret = ret.substr(0, ret.size() - 9); // Changing apostrophe to h breaks the checksum\n-            } else {\n-                break;\n+    while (true) {\n+        auto it = ret.find(\"'\");\n+        if (it != std::string::npos) {\n+            ret[it] = 'h';\n+            if (ret.size() > 9 && ret[ret.size() - 9] == '#') {\n+                Span<const char> data = Span<const char>(ret.data(), ret.size() - 9);\n+                std::string new_checksum = DescriptorChecksum(data);\n+                ret = ret.substr(0, ret.size() - 8) + new_checksum; // Changing apostrophe to h breaks the checksum - recalculate it and replace the broken one\n             }\n+        } else {\n+            break;\n         }\n     }\n     return ret;\n }\n \n const std::set<std::vector<uint32_t>> ONLY_EMPTY{{}};\n \n-void Check(const std::string& prv, const std::string& pub, int flags, const std::vector<std::vector<std::string>>& scripts, const std::set<std::vector<uint32_t>>& paths = ONLY_EMPTY)\n+void DoCheck(const std::string& prv, const std::string& pub, int flags, const std::vector<std::vector<std::string>>& scripts, const std::set<std::vector<uint32_t>>& paths = ONLY_EMPTY,\n+    bool replace_apostrophe_with_h=false)\n {\n     FlatSigningProvider keys_priv, keys_pub;\n     std::set<std::vector<uint32_t>> left_paths = paths;\n \n+    std::unique_ptr<Descriptor> parse_priv;\n+    std::unique_ptr<Descriptor> parse_pub;\n     // Check that parsing succeeds.\n-    auto parse_priv = Parse(MaybeUseHInsteadOfApostrophy(prv), keys_priv);\n-    auto parse_pub = Parse(MaybeUseHInsteadOfApostrophy(pub), keys_pub);\n+    if (replace_apostrophe_with_h)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312409702",
      "id" : 312409702,
      "in_reply_to_id" : 312176003,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjQwOTcwMg==",
      "original_commit_id" : "f86cf3ab9b84d68e40e5d28fcc60033b571e4b9e",
      "original_position" : 64,
      "path" : "src/test/descriptor_tests.cpp",
      "position" : 55,
      "pull_request_review_id" : 273048118,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570",
      "updated_at" : "2019-08-09T14:24:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312409702",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/5347350?v=4",
         "events_url" : "https://api.github.com/users/davereikher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/davereikher/followers",
         "following_url" : "https://api.github.com/users/davereikher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/davereikher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/davereikher",
         "id" : 5347350,
         "login" : "davereikher",
         "node_id" : "MDQ6VXNlcjUzNDczNTA=",
         "organizations_url" : "https://api.github.com/users/davereikher/orgs",
         "received_events_url" : "https://api.github.com/users/davereikher/received_events",
         "repos_url" : "https://api.github.com/users/davereikher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/davereikher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/davereikher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312425303"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312425303"
         }
      },
      "author_association" : "NONE",
      "body" : "Thanks, fixed in commit d3e2d08a3be92cecb50c89c69871e61e0618e10b.",
      "commit_id" : "0fc46f5b9262f016c42d2abe68d5125833f55416",
      "created_at" : "2019-08-09T10:44:55Z",
      "diff_hunk" : "@@ -28,6 +31,8 @@ constexpr int HARDENED = 2; // Derivation needs access to private keys\n constexpr int UNSOLVABLE = 4; // This descriptor is not expected to be solvable\n constexpr int SIGNABLE = 8; // We can sign with this descriptor (this is not true when actual BIP32 derivation is used, as that's not integrated in our signing code)\n \n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312425303",
      "id" : 312425303,
      "in_reply_to_id" : 312172435,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjQyNTMwMw==",
      "original_commit_id" : "f86cf3ab9b84d68e40e5d28fcc60033b571e4b9e",
      "original_position" : 14,
      "path" : "src/test/descriptor_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 273068485,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570",
      "updated_at" : "2019-08-09T14:24:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312425303",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/5347350?v=4",
         "events_url" : "https://api.github.com/users/davereikher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/davereikher/followers",
         "following_url" : "https://api.github.com/users/davereikher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/davereikher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/davereikher",
         "id" : 5347350,
         "login" : "davereikher",
         "node_id" : "MDQ6VXNlcjUzNDczNTA=",
         "organizations_url" : "https://api.github.com/users/davereikher/orgs",
         "received_events_url" : "https://api.github.com/users/davereikher/received_events",
         "repos_url" : "https://api.github.com/users/davereikher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/davereikher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/davereikher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312451973"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312451973"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In other words: The function does not need to move, only the `namespace {`",
      "commit_id" : "0fc46f5b9262f016c42d2abe68d5125833f55416",
      "created_at" : "2019-08-09T12:16:11Z",
      "diff_hunk" : "@@ -137,6 +109,36 @@ std::string DescriptorChecksum(const Span<const char>& span)\n     return ret;\n }\n \n+\n+namespace {\n+\n+////////////////////////////////////////////////////////////////////////////\n+// Checksum                                                               //",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312451973",
      "id" : 312451973,
      "in_reply_to_id" : 312172302,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjQ1MTk3Mw==",
      "original_commit_id" : "f86cf3ab9b84d68e40e5d28fcc60033b571e4b9e",
      "original_position" : 43,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 273103014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570",
      "updated_at" : "2019-08-09T14:24:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312451973",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312477258"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312477258"
         }
      },
      "author_association" : "NONE",
      "body" : "Thanks, fixed in commit 6819fbd741891081b2679e4b763bb88dc997ffe7. Is there a way to re-run AppVeyor? Looks like it timed out.",
      "commit_id" : "0fc46f5b9262f016c42d2abe68d5125833f55416",
      "created_at" : "2019-08-09T13:24:55Z",
      "diff_hunk" : "@@ -137,6 +109,36 @@ std::string DescriptorChecksum(const Span<const char>& span)\n     return ret;\n }\n \n+\n+namespace {\n+\n+////////////////////////////////////////////////////////////////////////////\n+// Checksum                                                               //",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312477258",
      "id" : 312477258,
      "in_reply_to_id" : 312172302,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjQ3NzI1OA==",
      "original_commit_id" : "f86cf3ab9b84d68e40e5d28fcc60033b571e4b9e",
      "original_position" : 43,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 273136158,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570",
      "updated_at" : "2019-08-09T14:24:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312477258",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/5347350?v=4",
         "events_url" : "https://api.github.com/users/davereikher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/davereikher/followers",
         "following_url" : "https://api.github.com/users/davereikher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/davereikher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/davereikher",
         "id" : 5347350,
         "login" : "davereikher",
         "node_id" : "MDQ6VXNlcjUzNDczNTA=",
         "organizations_url" : "https://api.github.com/users/davereikher/orgs",
         "received_events_url" : "https://api.github.com/users/davereikher/received_events",
         "repos_url" : "https://api.github.com/users/davereikher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/davereikher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/davereikher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312479811"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312479811"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You can re-run the ci by squashing your commits according to https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#squashing-commits",
      "commit_id" : "0fc46f5b9262f016c42d2abe68d5125833f55416",
      "created_at" : "2019-08-09T13:31:26Z",
      "diff_hunk" : "@@ -137,6 +109,36 @@ std::string DescriptorChecksum(const Span<const char>& span)\n     return ret;\n }\n \n+\n+namespace {\n+\n+////////////////////////////////////////////////////////////////////////////\n+// Checksum                                                               //",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312479811",
      "id" : 312479811,
      "in_reply_to_id" : 312172302,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjQ3OTgxMQ==",
      "original_commit_id" : "f86cf3ab9b84d68e40e5d28fcc60033b571e4b9e",
      "original_position" : 43,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 273139671,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570",
      "updated_at" : "2019-08-09T14:24:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312479811",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312523013"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312523013"
         }
      },
      "author_association" : "NONE",
      "body" : "Ok, done in commit 0fc46f5b9262f016c42d2abe68d5125833f55416.",
      "commit_id" : "0fc46f5b9262f016c42d2abe68d5125833f55416",
      "created_at" : "2019-08-09T15:05:10Z",
      "diff_hunk" : "@@ -137,6 +109,36 @@ std::string DescriptorChecksum(const Span<const char>& span)\n     return ret;\n }\n \n+\n+namespace {\n+\n+////////////////////////////////////////////////////////////////////////////\n+// Checksum                                                               //",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16570#discussion_r312523013",
      "id" : 312523013,
      "in_reply_to_id" : 312172302,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjUyMzAxMw==",
      "original_commit_id" : "f86cf3ab9b84d68e40e5d28fcc60033b571e4b9e",
      "original_position" : 43,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 273196621,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16570",
      "updated_at" : "2019-08-09T15:05:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312523013",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/5347350?v=4",
         "events_url" : "https://api.github.com/users/davereikher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/davereikher/followers",
         "following_url" : "https://api.github.com/users/davereikher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/davereikher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/davereikher",
         "id" : 5347350,
         "login" : "davereikher",
         "node_id" : "MDQ6VXNlcjUzNDczNTA=",
         "organizations_url" : "https://api.github.com/users/davereikher/orgs",
         "received_events_url" : "https://api.github.com/users/davereikher/received_events",
         "repos_url" : "https://api.github.com/users/davereikher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/davereikher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/davereikher"
      }
   }
]
