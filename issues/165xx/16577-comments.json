[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16577#discussion_r312697097"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16577"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312697097"
         }
      },
      "author_association" : "MEMBER",
      "body" : "NACK this hunk, it only changes formatting.",
      "commit_id" : "b1aee230574a7eb72ca5101458fc9ef4a957d626",
      "created_at" : "2019-08-10T09:26:34Z",
      "diff_hunk" : "@@ -734,17 +734,21 @@ class CBufferedFile\n             return false;\n         size_t nBytes = fread((void*)&vchBuf[pos], 1, readNow, src);\n         if (nBytes == 0) {\n-            throw std::ios_base::failure(feof(src) ? \"CBufferedFile::Fill: end of file\" : \"CBufferedFile::Fill: fread failed\");\n-        } else {\n-            nSrcPos += nBytes;\n-            return true;\n+            throw std::ios_base::failure(feof(src) ?",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16577#discussion_r312697097",
      "id" : 312697097,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjY5NzA5Nw==",
      "original_commit_id" : "b1aee230574a7eb72ca5101458fc9ef4a957d626",
      "original_position" : 8,
      "path" : "src/streams.h",
      "position" : 8,
      "pull_request_review_id" : 273418979,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16577",
      "updated_at" : "2019-08-10T09:45:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312697097",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16577#discussion_r312697122"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16577"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312697122"
         }
      },
      "author_association" : "MEMBER",
      "body" : "NACK this hunk, only splits the line in 2 lines.",
      "commit_id" : "b1aee230574a7eb72ca5101458fc9ef4a957d626",
      "created_at" : "2019-08-10T09:27:36Z",
      "diff_hunk" : "@@ -734,17 +734,21 @@ class CBufferedFile\n             return false;\n         size_t nBytes = fread((void*)&vchBuf[pos], 1, readNow, src);\n         if (nBytes == 0) {\n-            throw std::ios_base::failure(feof(src) ? \"CBufferedFile::Fill: end of file\" : \"CBufferedFile::Fill: fread failed\");\n-        } else {\n-            nSrcPos += nBytes;\n-            return true;\n+            throw std::ios_base::failure(feof(src) ?\n+                \"CBufferedFile::Fill: end of file\" :\n+                \"CBufferedFile::Fill: fread failed\");\n         }\n+        nSrcPos += nBytes;\n+        return true;\n     }\n \n public:\n     CBufferedFile(FILE *fileIn, uint64_t nBufSize, uint64_t nRewindIn, int nTypeIn, int nVersionIn) :\n-        nType(nTypeIn), nVersion(nVersionIn), nSrcPos(0), nReadPos(0), nReadLimit(std::numeric_limits<uint64_t>::max()), nRewind(nRewindIn), vchBuf(nBufSize, 0)\n+        nType(nTypeIn), nVersion(nVersionIn), nSrcPos(0), nReadPos(0),\n+        nReadLimit(std::numeric_limits<uint64_t>::max()), nRewind(nRewindIn), vchBuf(nBufSize, 0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16577#discussion_r312697122",
      "id" : 312697122,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjY5NzEyMg==",
      "original_commit_id" : "b1aee230574a7eb72ca5101458fc9ef4a957d626",
      "original_position" : 20,
      "path" : "src/streams.h",
      "position" : 20,
      "pull_request_review_id" : 273418979,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16577",
      "updated_at" : "2019-08-10T09:45:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312697122",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16577#discussion_r312697302"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16577"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312697302"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd keep `else`s.",
      "commit_id" : "b1aee230574a7eb72ca5101458fc9ef4a957d626",
      "created_at" : "2019-08-10T09:35:07Z",
      "diff_hunk" : "@@ -802,16 +804,19 @@ class CBufferedFile\n \n     //! rewind to a given reading position\n     bool SetPos(uint64_t nPos) {\n-        nReadPos = nPos;\n-        if (nReadPos + nRewind < nSrcPos) {\n-            nReadPos = nSrcPos - nRewind;\n+        size_t bufsize = vchBuf.size();\n+        if (nSrcPos > bufsize && nPos < nSrcPos - bufsize) {\n+            // rewinding too far, rewind as far as possible\n+            nReadPos = nSrcPos - bufsize;\n             return false;\n-        } else if (nReadPos > nSrcPos) {\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16577#discussion_r312697302",
      "id" : 312697302,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjY5NzMwMg==",
      "original_commit_id" : "b1aee230574a7eb72ca5101458fc9ef4a957d626",
      "original_position" : 49,
      "path" : "src/streams.h",
      "position" : 49,
      "pull_request_review_id" : 273418979,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16577",
      "updated_at" : "2019-08-10T09:45:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312697302",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16577#discussion_r312697551"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16577"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312697551"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this is wrong, `vchBuf.size()` if constant and the actual read position is obtained from `nReadPos % vchBuf.size()` - it's a ring buffer.",
      "commit_id" : "b1aee230574a7eb72ca5101458fc9ef4a957d626",
      "created_at" : "2019-08-10T09:44:54Z",
      "diff_hunk" : "@@ -802,16 +804,19 @@ class CBufferedFile\n \n     //! rewind to a given reading position\n     bool SetPos(uint64_t nPos) {\n-        nReadPos = nPos;\n-        if (nReadPos + nRewind < nSrcPos) {\n-            nReadPos = nSrcPos - nRewind;\n+        size_t bufsize = vchBuf.size();\n+        if (nSrcPos > bufsize && nPos < nSrcPos - bufsize) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16577#discussion_r312697551",
      "id" : 312697551,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMjY5NzU1MQ==",
      "original_commit_id" : "b1aee230574a7eb72ca5101458fc9ef4a957d626",
      "original_position" : 44,
      "path" : "src/streams.h",
      "position" : 44,
      "pull_request_review_id" : 273418979,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16577",
      "updated_at" : "2019-08-10T09:45:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/312697551",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
