[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18115 (wallet: Pass in transactions and messages for signing instead of exporting the private keys by achow101)\n* #18064 (gui: Drop WalletModel dependency to RecentRequestsTableModel by promag)\n* #17877 (qt, refactor: Make enums in BitcoinUnits class scoped by hebasto)\n* #17681 (wallet: Keep inactive seeds after sethdseed and derive keys from them as needed by achow101)\n* #17443 (Drop checkFinalTx and use Median Time Past to check finality of wallet transactions by ariard)\n* #17211 (Allow fundrawtransaction and walletcreatefundedpsbt to take external inputs by achow101)\n* #16910 (wallet: reduce loading time by using unordered maps by achow101)\n* #16710 (build: Enable -Wsuggest-override if available by hebasto)\n* #16549 ([WIP] UI external signer support (e.g. hardware wallet) by Sjors)\n* #16546 ([WIP] External signer support - Wallet Box edition by Sjors)\n* #16463 ([BIP 174] Implement serialization support for GLOBAL_XPUB field. by achow101)\n* #16432 (qt: Add privacy to the Overview page by hebasto)\n* #16378 ([WIP] The ultimate send RPC by Sjors)\n* #16224 (gui: Bilingual GUI error messages by hebasto)\n* #16116 (Avoid unnecessary signing provider copies on descriptor expansion by Empact)\n* #12911 (wallet: Show fee in results for signrawtransaction* for segwit inputs by kallewoof)\n* #11413 ([wallet] [rpc] sendtoaddress/sendmany: Add explicit feerate option by kallewoof)\n* #10102 ([experimental] Multiprocess bitcoin by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-08-02T03:23:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-517532927",
      "id" : 517532927,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNzUzMjkyNw==",
      "updated_at" : "2020-02-27T09:13:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/517532927",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Strong Concept ACK, this should be much nicer now it is preceded by the rework.",
      "created_at" : "2019-08-02T03:25:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-517533269",
      "id" : 517533269,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNzUzMzI2OQ==",
      "updated_at" : "2019-08-02T03:25:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/517533269",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Approach ACK. It looks pretty straight forward and thanks to The Box feels cleaner than the previous attempt. \r\n\r\nI suggest that, after a bit more progress on #16341, we review this in parallel. That ensures that we don't mess up the division of labour between `ScriptPubKeyMan` and its subclasses.\r\n\r\nAlso concept ACK on using BIP44/49/84 for new descriptor wallets. That may need some discussion, because it means individual addresses are no longer hardened.\r\n\r\nSome issues I found perusing the commits:\r\n* when you restart bitcoind and load a (watch-only) wallet the keypool is empty and `getnewaddress` no longer works\r\n* `importdescriptors` should no longer require a `range` argument (~also I would prefer a singular RPC~ nvm that makes rescan slow)\r\n* when calling `getnewaddress` with an address type for which the wallet misses a descriptor, it returns a blank `error message:` \r\n* can you give each ScriptPubKeyManager it's own file?\r\n* deleting `GetMetadata` and `Upgrade` inside `Introduce WalletDescriptor`; should have its own commit?\r\n* `ScriptPubKeyMap` could be introduced in `Implement IsMine` instead of the earlier commit. Would it make sense to move this into the Descriptor class? How are infinite range descriptors handled, expanded and cached `keypoolsize` items at a time?\r\n* Am I reading this wrong or is `SetupGeneration` creating a fresh seed for each descriptor?\r\n* I'm not a fan of determining the output type in an indirect manner by expanding the descriptor `Optional<OutputType> out_script_type = DetermineOutputType(scripts_temp[0], out_keys);`; that information is already encoded in the descriptor. Shameless plug for #15590.",
      "created_at" : "2019-08-03T08:23:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-517905778",
      "id" : 517905778,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNzkwNTc3OA==",
      "updated_at" : "2019-08-03T09:40:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/517905778",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Concept ACK.\r\n\r\n@achow101 I just noticed that both the existing `deriveaddressses` & `importmulti` commands treat descriptor `[range_start, range_end]` as inclusive, which is consistent with the common understanding of the notation `[]`. Should we update the new `importdescriptors` command to do the same (make range_end inclusive)?\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/master/src/rpc/misc.cpp#L215\r\nhttps://github.com/bitcoin/bitcoin/blob/master/src/wallet/rpcdump.cpp#L1122",
      "created_at" : "2019-08-12T14:57:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-520460635",
      "id" : 520460635,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMDQ2MDYzNQ==",
      "updated_at" : "2019-08-12T14:59:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/520460635",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4769925?v=4",
         "events_url" : "https://api.github.com/users/hugohn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hugohn/followers",
         "following_url" : "https://api.github.com/users/hugohn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hugohn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hugohn",
         "id" : 4769925,
         "login" : "hugohn",
         "node_id" : "MDQ6VXNlcjQ3Njk5MjU=",
         "organizations_url" : "https://api.github.com/users/hugohn/orgs",
         "received_events_url" : "https://api.github.com/users/hugohn/received_events",
         "repos_url" : "https://api.github.com/users/hugohn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hugohn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hugohn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hugohn"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Should we update the new `importdescriptors` command to do the same (make range_end inclusive)?\r\n\r\nI guess so. Latest pushed should do that.",
      "created_at" : "2019-08-12T16:20:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-520494128",
      "id" : 520494128,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMDQ5NDEyOA==",
      "updated_at" : "2019-08-12T16:20:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/520494128",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Due to your latest change upstream, this now complains: `scriptpubkeyman.h:516:10: warning: 'CheckDecryptionKey' overrides a member function but is not marked 'override' `",
      "created_at" : "2019-10-10T16:50:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-540675668",
      "id" : 540675668,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0MDY3NTY2OA==",
      "updated_at" : "2019-10-10T16:50:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/540675668",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fixed the warning.",
      "created_at" : "2019-10-10T19:13:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-540736034",
      "id" : 540736034,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0MDczNjAzNA==",
      "updated_at" : "2019-10-10T19:13:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/540736034",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rescanning is broken for (some?) descriptor wallets, both when importing descriptors and when calling `rescanblockchain`. It does detect new transactions. Example:\r\n\r\n```\r\n# Drop coins on a random address in the default wallet\r\nbitcoin-cli -regtest -rpcwallet=\"\" generatetoaddress 101 `bitcoin-cli -regtest -rpcwallet=\"\" getnewaddress`\r\nsrc/bitcoin-cli -regtest createwallet T false true \"\" true true\r\nsrc/bitcoin-cli -regtest -rpcwallet=T importdescriptors '[{\"desc\": \"wpkh([00000001/84h/1h/0h]tprv8ZgxMBicQKsPd7Uf69XL1XwhmjHopUGep8GuEiJDZmbQz6o58LninorQAfcKZWARbtRtfnLcJ5MQ2AtHcQJCCRUcMRvmDUjyEmNUWwx8UbK/0/*)#slxu8rmv\", \"timestamp\": 0, \"range\": [0,1], \"internal\": false, \"active\": true}]'\r\nbitcoin-cli -regtest -rpcwallet=T getnewaddress\r\nbitcoin-cli -regtest -rpcwallet=T getaddressinfo bcrt1qm90ugl4d48jv8n6e5t9ln6t9zlpm5th68x4f8g\r\nsrc/bitcoin-cli -regtest -rpcwallet=\"\" sendtoaddress bcrt1qm90ugl4d48jv8n6e5t9ln6t9zlpm5th68x4f8g 1\r\nbitcoin-cli -regtest -rpcwallet=\"\" generatetoaddress 1 `bitcoin-cli -regtest -rpcwallet=\"\" getnewaddress`\r\nbitcoin-cli -regtest -rpcwallet=T listunspent 0 9999999 '[]' true\r\n```\r\n\r\nThe last command should show the UTXO.\r\n\r\nCreate another wallet and repeat the `importdescriptors` call. UTXO won't show up:\r\n\r\n```\r\nsrc/bitcoin-cli -regtest createwallet T2 false true \"\" true true\r\nsrc/bitcoin-cli -regtest -rpcwallet=T2 importdescriptors '[{\"desc\": \"wpkh([00000001/84h/1h/0h]tprv8ZgxMBicQKsPd7Uf69XL1XwhmjHopUGep8GuEiJDZmbQz6o58LninorQAfcKZWARbtRtfnLcJ5MQ2AtHcQJCCRUcMRvmDUjyEmNUWwx8UbK/0/*)#slxu8rmv\", \"timestamp\": 0, \"range\": [0,1], \"internal\": false, \"active\": true}]'\r\nbitcoin-cli -regtest -rpcwallet=T2 listunspent 0 9999999 '[]' true\r\n```\r\n\r\nWhen you send it new coins, those do show up.\r\n\r\nAlso note the address is incorrectly marked as `ischange` (but the derivation is correct). Might be unrelated though; the wallet determines IsChange() by checking if it's in the address book (yuck).\r\n\r\nUpdate: I can no longer reproduce this (d7ca9abe4b817913852abbd48082bde64df8e9d9)",
      "created_at" : "2019-11-05T11:18:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-549780152",
      "id" : 549780152,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0OTc4MDE1Mg==",
      "updated_at" : "2019-11-07T15:38:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/549780152",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I wrote a test to check `sortedmulti()` origins: https://github.com/Sjors/bitcoin/commit/04610844704aee8fb7cd6f94167a767f5473d281\r\n\r\nUnfortunately this test passes, so I can't reproduce the bug I was chasing just yet. I was seeing an origin-pubkey mismatch for sortedmulti() descriptors.\r\n\r\n_Update: fairly certain I was chasing a ghost. Hopefully the tests are useful._",
      "created_at" : "2020-01-20T18:53:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-576394411",
      "id" : 576394411,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NjM5NDQxMQ==",
      "updated_at" : "2020-01-21T19:05:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576394411",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I could not replicate any bugs with `sortedmulti` descriptors.",
      "created_at" : "2020-01-21T18:29:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-576816376",
      "id" : 576816376,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NjgxNjM3Ng==",
      "updated_at" : "2020-01-21T18:29:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576816376",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased onto master, now ready for review.",
      "created_at" : "2020-01-30T05:00:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-580083947",
      "id" : 580083947,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDA4Mzk0Nw==",
      "updated_at" : "2020-01-30T05:00:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580083947",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept and approach re-ACK\r\n\r\nI rebased my HWI support PRs on top of this:  #16546 (RPC) and #16549 (GUI).\r\n\r\nThe first commit could go to an independent PR:\r\n* `Output a descriptor in createmultisig`\r\n\r\nAnd a few that could be done before this PR, just to get the number of commits down a bit :-)\r\n* ~`Introduce SetType function to tell ScriptPubKeyMans the type and internal-ness of it`~ (empty for legacy)\r\n* `Change wallet_encryption.py to use signmessage instead of dumpprivkey`\r\n* d3819b681f766a17deef4650bd6297178924f04b  `Change GetMetadata to use unique_ptr<CKeyMetadata>`\r\n* c80e25d8743d7e5bfe866d32bf394cf55166bde5  `Add a function to determine the `OutputType` of a scriptPubKey` (`DetermineOutputType` should be contrasted to getting this information directly from the descriptor like in #15590)\r\n* 0fc666f32ff8472215e05e85dd609901a02dc3ae  `Add IsLegacy to CWallet so that the GUI knows whether to show watchonly`\r\n\r\nSome of my [earlier comments](https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-517905778) are still relevant:\r\n* I'm ambivalent about using BIP44/49/84 for new descriptor wallets. Downside is that individual addresses are no longer hardened. Upside is that this many other wallets use this standard and we could even consider BIP39 backup at some point (#17748). Perhaps `createwallet` (and the GUI) could make the use of BIP44/49/84 optional.\r\n* `importdescriptors` should no longer require a range argument\r\n* `importdescriptor` could be a singular RPC (less tedious when used manually). It could drop the `timestamp` argument in favor of just calling `rescanblockchain` after import.\r\n\r\nI think we should split `scriptpubkeyman.{h,cpp}` into `scriptpubkeyman.{h,cpp}` , `legacy_scriptpubkeyman.{h,cpp}`  and `descriptor_scriptpubkeyman.{h,cpp}` (although meh because it creates large diff, but maybe better to get it over with).",
      "created_at" : "2020-01-30T12:38:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-580233543",
      "id" : 580233543,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDIzMzU0Mw==",
      "updated_at" : "2020-01-30T14:26:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580233543",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r372959221"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372959221"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Whether it's P2SH depends on `address_type`, so maybe just say \"The descriptor for this multisig address\\\"",
      "commit_id" : "6c1929a8f4d435671e5e0679c71582349b3f336a",
      "created_at" : "2020-01-30T13:53:17Z",
      "diff_hunk" : "@@ -83,6 +83,7 @@ static UniValue createmultisig(const JSONRPCRequest& request)\n             \"{\\n\"\n             \"  \\\"address\\\":\\\"multisigaddress\\\",  (string) The value of the new multisig address.\\n\"\n             \"  \\\"redeemScript\\\":\\\"script\\\"       (string) The string value of the hex-encoded redemption script.\\n\"\n+            \"  \\\"descriptor\\\":\\\"descriptor\\\"     (string) The descriptor for the P2SH address for this multisig\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r372959221",
      "id" : 372959221,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk1OTIyMQ==",
      "original_commit_id" : "dd92677895de134c77b318cf7e27e2471a10842c",
      "original_position" : 4,
      "path" : "src/rpc/misc.cpp",
      "position" : null,
      "pull_request_review_id" : 350837022,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-20T00:10:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372959221",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r372983424"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372983424"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In  e40a833c3bffb0cf723357238eb809398e3e5237 `Create LegacyScriptPubKeyMan when not a descriptor wallet`: accidentally dropping `Upgrade()`?",
      "commit_id" : "6c1929a8f4d435671e5e0679c71582349b3f336a",
      "created_at" : "2020-01-30T14:34:32Z",
      "diff_hunk" : "@@ -1486,11 +1486,6 @@ bool DescriptorScriptPubKeyMan::CanGetAddresses(bool internal)\n     return false;\n }\n \n-bool DescriptorScriptPubKeyMan::Upgrade(int prev_version, std::string& error)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r372983424",
      "id" : 372983424,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk4MzQyNA==",
      "original_commit_id" : "e40a833c3bffb0cf723357238eb809398e3e5237",
      "original_position" : 4,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 350837022,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-20T00:10:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372983424",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r372985994"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372985994"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The new dummy class in 3f6cbc5bb16f8a021bbe88d998b12698205aaeac introduces several compiler problems (rebase slippage?), e.g:\r\n```\r\n./wallet/scriptpubkeyman.h:483:41: error: non-virtual member function marked 'override' hides virtual member function\r\n    void KeepDestination(int64_t index) override;\r\n```",
      "commit_id" : "6c1929a8f4d435671e5e0679c71582349b3f336a",
      "created_at" : "2020-01-30T14:38:58Z",
      "diff_hunk" : "@@ -467,4 +468,52 @@ class LegacySigningProvider : public SigningProvider\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override { return m_spk_man.GetKeyOrigin(keyid, info); }\n };\n \n+class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n+{\n+public:\n+    using ScriptPubKeyMan::ScriptPubKeyMan;\n+\n+    bool GetNewDestination(const OutputType type, CTxDestination& dest, std::string& error) override;\n+    isminetype IsMine(const CScript& script) const override;\n+\n+    bool CheckDecryptionKey(const CKeyingMaterial& master_key, bool accept_no_keys = false) override;\n+    bool Encrypt(const CKeyingMaterial& master_key, WalletBatch* batch) override;\n+\n+    bool GetReservedDestination(const OutputType type, bool internal, CTxDestination& address, int64_t& index, CKeyPool& keypool) override;\n+    void KeepDestination(int64_t index) override;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r372985994",
      "id" : 372985994,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk4NTk5NA==",
      "original_commit_id" : "3f6cbc5bb16f8a021bbe88d998b12698205aaeac",
      "original_position" : 24,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 350837022,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-20T00:10:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372985994",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373229817"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373229817"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Dropped the commit, but fixed in the separate PR for descriptors in `createmultisig`",
      "commit_id" : "6c1929a8f4d435671e5e0679c71582349b3f336a",
      "created_at" : "2020-01-30T22:32:23Z",
      "diff_hunk" : "@@ -83,6 +83,7 @@ static UniValue createmultisig(const JSONRPCRequest& request)\n             \"{\\n\"\n             \"  \\\"address\\\":\\\"multisigaddress\\\",  (string) The value of the new multisig address.\\n\"\n             \"  \\\"redeemScript\\\":\\\"script\\\"       (string) The string value of the hex-encoded redemption script.\\n\"\n+            \"  \\\"descriptor\\\":\\\"descriptor\\\"     (string) The descriptor for the P2SH address for this multisig\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373229817",
      "id" : 373229817,
      "in_reply_to_id" : 372959221,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIyOTgxNw==",
      "original_commit_id" : "dd92677895de134c77b318cf7e27e2471a10842c",
      "original_position" : 4,
      "path" : "src/rpc/misc.cpp",
      "position" : null,
      "pull_request_review_id" : 351188746,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-20T00:10:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373229817",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373229896"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373229896"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It should be dropped, but not in that commit. Moved it to the dummy class definition.",
      "commit_id" : "6c1929a8f4d435671e5e0679c71582349b3f336a",
      "created_at" : "2020-01-30T22:32:38Z",
      "diff_hunk" : "@@ -1486,11 +1486,6 @@ bool DescriptorScriptPubKeyMan::CanGetAddresses(bool internal)\n     return false;\n }\n \n-bool DescriptorScriptPubKeyMan::Upgrade(int prev_version, std::string& error)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373229896",
      "id" : 373229896,
      "in_reply_to_id" : 372983424,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIyOTg5Ng==",
      "original_commit_id" : "e40a833c3bffb0cf723357238eb809398e3e5237",
      "original_position" : 4,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 351188848,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-20T00:10:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373229896",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373230082"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373230082"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since this gets dropped later, dropped this at the dummy class definition.",
      "commit_id" : "6c1929a8f4d435671e5e0679c71582349b3f336a",
      "created_at" : "2020-01-30T22:33:04Z",
      "diff_hunk" : "@@ -467,4 +468,52 @@ class LegacySigningProvider : public SigningProvider\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override { return m_spk_man.GetKeyOrigin(keyid, info); }\n };\n \n+class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n+{\n+public:\n+    using ScriptPubKeyMan::ScriptPubKeyMan;\n+\n+    bool GetNewDestination(const OutputType type, CTxDestination& dest, std::string& error) override;\n+    isminetype IsMine(const CScript& script) const override;\n+\n+    bool CheckDecryptionKey(const CKeyingMaterial& master_key, bool accept_no_keys = false) override;\n+    bool Encrypt(const CKeyingMaterial& master_key, WalletBatch* batch) override;\n+\n+    bool GetReservedDestination(const OutputType type, bool internal, CTxDestination& address, int64_t& index, CKeyPool& keypool) override;\n+    void KeepDestination(int64_t index) override;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373230082",
      "id" : 373230082,
      "in_reply_to_id" : 372985994,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIzMDA4Mg==",
      "original_commit_id" : "3f6cbc5bb16f8a021bbe88d998b12698205aaeac",
      "original_position" : 24,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 351189052,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-20T00:10:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373230082",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Moved `Output a descriptor in createmultisig` to it's own PR and dropped it from here since it isn't actually used in descriptor wallets.\r\n\r\nI will investigate breaking out the other commits.\r\n\r\n>     * I'm ambivalent about using BIP44/49/84 for new descriptor wallets. Downside is that individual addresses are no longer hardened. Upside is that this many other wallets use this standard and we could even consider BIP39 backup at some point (#17748). Perhaps `createwallet` (and the GUI) could make the use of BIP44/49/84 optional.\r\n\r\nAFAICT, the reasoning for using exclusively hardened derivation is because we could export private keys with `dumpprivkey` and that has issues. But since that is disabled for descriptor wallets, I think it's fine.\r\n\r\n>     * `importdescriptors` should no longer require a range argument\r\n\r\nWhy?\r\n\r\n>     * `importdescriptor` could be a singular RPC (less tedious when used manually). It could drop the `timestamp` argument in favor of just calling `rescanblockchain` after import.\r\n\r\nI suppose, but I don't really want there to be multiple commands that do fundamentally the same thing.\r\n\r\n> I think we should split `scriptpubkeyman.{h,cpp}` into `scriptpubkeyman.{h,cpp}` , `legacy_scriptpubkeyman.{h,cpp}` and `descriptor_scriptpubkeyman.{h,cpp}` (although meh because it creates large diff, but maybe better to get it over with).\r\n\r\nMeh.",
      "created_at" : "2020-01-30T22:34:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-580494041",
      "id" : 580494041,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDQ5NDA0MQ==",
      "updated_at" : "2020-01-30T22:40:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580494041",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Descriptors can be expanded indefinitely, so why specify a (mandatory) range on import? It might make sense as an optional field to set a boundary, e.g. if you know the external signing device has a range limit.\r\n\r\n> AFAICT, the reasoning for using exclusively hardened derivation is because we could export private keys with dumpprivkey and that has issues. But since that is disabled for descriptor wallets, I think it's fine.\r\n\r\nI'm not familiar with the history. Another reason could be that if one private key is compromised in a side-channel attack, the other keys are still safe. But that assumes such a side-channel attack, couldn't also compromise the master key. Or perhaps a (horrible) bug in the signing code causes a private key to leak on chain. Or someone wants to reenable `dumpprivkey` again to redeem some fork coin. Using `m/{0,1,2}'/{0,1}'/k` by default and making BIP44/49/84 opt-in (in a followup) seems less of change from status quo.\r\n\r\n> I don't really want there to be multiple commands that do fundamentally the same thing.\r\n\r\nDo you mean having similar commands (`importmulti` and `importdescriptors`) with different options? I like consistency, as do developers who want a simple path to switch their integration over to descriptor wallets. But I also like the rare opportunity to clean up the RPC. And when people have to copy-paste some magic to import keys from a hardware wallet, this new syntax looks less intimidating. Though ideally that shouldn't be needed at all.  \r\n\r\n\r\nThe [AppVeyor failure](https://ci.appveyor.com/project/DrahtBot/bitcoin/builds/30473125#L4131) might be legit `wallet_importdescriptors.py` encounters `JSONRPCException: bad-txns-inputs-missingorspent (-25)`, albeit odd.\r\n\r\nIn f83fde4e8e13a254083e9433dfa770a8b52b1053 `Create LegacyScriptPubKeyMan when not a descriptor wallet` you're also introducing `class WalletDescriptor`; that was supposed to be a separate commit?\r\n\r\nYou're serialising the descriptor as a string (in `WalletDescriptor`). That's fine with me, I'd rather not delay this work, and we can change the serialisation later. However there's been some [mailinglist discussion](https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2019-December/017529.html) about serialising descriptors into something that's easier to copy/paste and put in a QR code. Maybe that's worth working out in a separate PR and then to use that for the wallet as well. Added a an issue for it #18043.",
      "created_at" : "2020-01-31T10:35:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-580679648",
      "id" : 580679648,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDY3OTY0OA==",
      "updated_at" : "2020-01-31T16:25:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580679648",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373572192"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373572192"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In ee6980be437c09df6044a5ced7caa91410453027 `Introduce DescriptorScriptPubKeyMan as a dummy class`: this line (`using ScriptPubKeyMan::ScriptPubKeyMan;`) is dropped in 7af1a569567a595dc26c33075632f406c4ff0904.",
      "commit_id" : "6c1929a8f4d435671e5e0679c71582349b3f336a",
      "created_at" : "2020-01-31T16:36:24Z",
      "diff_hunk" : "@@ -467,4 +468,49 @@ class LegacySigningProvider : public SigningProvider\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override { return m_spk_man.GetKeyOrigin(keyid, info); }\n };\n \n+class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n+{\n+public:\n+    using ScriptPubKeyMan::ScriptPubKeyMan;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373572192",
      "id" : 373572192,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU3MjE5Mg==",
      "original_commit_id" : "ee6980be437c09df6044a5ced7caa91410453027",
      "original_position" : 15,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 351628547,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-20T00:10:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373572192",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373574359"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373574359"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: these are added, but not used, in 7af1a569567a595dc26c33075632f406c4ff0904 `Store WalletDescriptor in DescriptorScriptPubKeyMan` which seems out of the blue. b784a150b23e10ee794d1d2616a0df5c0f317fef seems a better place.",
      "commit_id" : "6c1929a8f4d435671e5e0679c71582349b3f336a",
      "created_at" : "2020-01-31T16:40:55Z",
      "diff_hunk" : "@@ -60,8 +60,10 @@ extern const std::string CRYPTED_KEY;\n extern const std::string CSCRIPT;\n extern const std::string DEFAULTKEY;\n extern const std::string DESTDATA;\n+extern const std::string EXTERNALSPK;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373574359",
      "id" : 373574359,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU3NDM1OQ==",
      "original_commit_id" : "7af1a569567a595dc26c33075632f406c4ff0904",
      "original_position" : 4,
      "path" : "src/wallet/walletdb.h",
      "position" : 12,
      "pull_request_review_id" : 351628547,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-20T00:10:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373574359",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373579192"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373579192"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 7af1a569567a595dc26c33075632f406c4ff0904: `ScriptPubKeyMap`'s `uint32_t` changes to `int32_t` in e7e62209a176a00a03657e6fe8fd221bf2821bf5",
      "commit_id" : "6c1929a8f4d435671e5e0679c71582349b3f336a",
      "created_at" : "2020-01-31T16:50:47Z",
      "diff_hunk" : "@@ -470,8 +470,17 @@ class LegacySigningProvider : public SigningProvider\n \n class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n {\n+private:\n+    WalletDescriptor descriptor GUARDED_BY(cs_desc_man);\n+\n+    using ScriptPubKeyMap = std::map<CScript, uint32_t>; // Map of scripts to descriptor range index",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373579192",
      "id" : 373579192,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU3OTE5Mg==",
      "original_commit_id" : "7af1a569567a595dc26c33075632f406c4ff0904",
      "original_position" : 7,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 351628547,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-20T00:10:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373579192",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373612485"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373612485"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ee6980be437c09df6044a5ced7caa91410453027:  `void RewriteDB() override;` is dropped in fd995af379b73b63b78b276b5b8f31d39b2d2b67",
      "commit_id" : "6c1929a8f4d435671e5e0679c71582349b3f336a",
      "created_at" : "2020-01-31T18:09:19Z",
      "diff_hunk" : "@@ -467,4 +468,49 @@ class LegacySigningProvider : public SigningProvider\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override { return m_spk_man.GetKeyOrigin(keyid, info); }\n };\n \n+class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n+{\n+public:\n+    using ScriptPubKeyMan::ScriptPubKeyMan;\n+\n+    bool GetNewDestination(const OutputType type, CTxDestination& dest, std::string& error) override;\n+    isminetype IsMine(const CScript& script) const override;\n+\n+    bool CheckDecryptionKey(const CKeyingMaterial& master_key, bool accept_no_keys = false) override;\n+    bool Encrypt(const CKeyingMaterial& master_key, WalletBatch* batch) override;\n+\n+    bool GetReservedDestination(const OutputType type, bool internal, CTxDestination& address, int64_t& index, CKeyPool& keypool) override;\n+    void ReturnDestination(int64_t index, bool internal, const CTxDestination& addr) override;\n+\n+    bool TopUp(unsigned int size = 0) override;\n+\n+    void MarkUnusedAddresses(const CScript& script) override;\n+\n+    bool IsHDEnabled() const override;\n+\n+    bool SetupGeneration(bool force = false) override;\n+\n+    bool HavePrivateKeys() const override;\n+\n+    void RewriteDB() override;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373612485",
      "id" : 373612485,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYxMjQ4NQ==",
      "original_commit_id" : "ee6980be437c09df6044a5ced7caa91410453027",
      "original_position" : 36,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 351628547,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-20T00:10:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373612485",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Related 31 January wallet meeting discussion:\r\nhttp://www.erisian.com.au/meetbot/bitcoin-core-dev/2020/bitcoin-core-dev.2020-01-31-19.00.log.html",
      "created_at" : "2020-01-31T19:59:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-580888293",
      "id" : 580888293,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDg4ODI5Mw==",
      "updated_at" : "2020-01-31T19:59:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580888293",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2020-02-04T21:08:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-582115685",
      "id" : 582115685,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MjExNTY4NQ==",
      "updated_at" : "2020-02-04T21:08:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582115685",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r377827327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377827327"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's intentional. The `using ScriptPubKeyMan::ScriptPubKeyMan;` is needed to use the default `ScriptPubKeyMan` constructor until we add a custom one for `DescriptorScriptPubKeyMan`.",
      "commit_id" : "6c1929a8f4d435671e5e0679c71582349b3f336a",
      "created_at" : "2020-02-11T18:47:09Z",
      "diff_hunk" : "@@ -467,4 +468,49 @@ class LegacySigningProvider : public SigningProvider\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override { return m_spk_man.GetKeyOrigin(keyid, info); }\n };\n \n+class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n+{\n+public:\n+    using ScriptPubKeyMan::ScriptPubKeyMan;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r377827327",
      "id" : 377827327,
      "in_reply_to_id" : 373572192,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgyNzMyNw==",
      "original_commit_id" : "ee6980be437c09df6044a5ced7caa91410453027",
      "original_position" : 15,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 356903809,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-20T00:10:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377827327",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r377853944"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377853944"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Moved",
      "commit_id" : "6c1929a8f4d435671e5e0679c71582349b3f336a",
      "created_at" : "2020-02-11T19:35:49Z",
      "diff_hunk" : "@@ -60,8 +60,10 @@ extern const std::string CRYPTED_KEY;\n extern const std::string CSCRIPT;\n extern const std::string DEFAULTKEY;\n extern const std::string DESTDATA;\n+extern const std::string EXTERNALSPK;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r377853944",
      "id" : 377853944,
      "in_reply_to_id" : 373574359,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg1Mzk0NA==",
      "original_commit_id" : "7af1a569567a595dc26c33075632f406c4ff0904",
      "original_position" : 4,
      "path" : "src/wallet/walletdb.h",
      "position" : 12,
      "pull_request_review_id" : 356937290,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-20T00:10:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377853944",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r377854006"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377854006"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed",
      "commit_id" : "6c1929a8f4d435671e5e0679c71582349b3f336a",
      "created_at" : "2020-02-11T19:35:55Z",
      "diff_hunk" : "@@ -470,8 +470,17 @@ class LegacySigningProvider : public SigningProvider\n \n class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n {\n+private:\n+    WalletDescriptor descriptor GUARDED_BY(cs_desc_man);\n+\n+    using ScriptPubKeyMap = std::map<CScript, uint32_t>; // Map of scripts to descriptor range index",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r377854006",
      "id" : 377854006,
      "in_reply_to_id" : 373579192,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg1NDAwNg==",
      "original_commit_id" : "7af1a569567a595dc26c33075632f406c4ff0904",
      "original_position" : 7,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 356937361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-20T00:10:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377854006",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r377854045"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377854045"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Dropped",
      "commit_id" : "6c1929a8f4d435671e5e0679c71582349b3f336a",
      "created_at" : "2020-02-11T19:36:00Z",
      "diff_hunk" : "@@ -467,4 +468,49 @@ class LegacySigningProvider : public SigningProvider\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override { return m_spk_man.GetKeyOrigin(keyid, info); }\n };\n \n+class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n+{\n+public:\n+    using ScriptPubKeyMan::ScriptPubKeyMan;\n+\n+    bool GetNewDestination(const OutputType type, CTxDestination& dest, std::string& error) override;\n+    isminetype IsMine(const CScript& script) const override;\n+\n+    bool CheckDecryptionKey(const CKeyingMaterial& master_key, bool accept_no_keys = false) override;\n+    bool Encrypt(const CKeyingMaterial& master_key, WalletBatch* batch) override;\n+\n+    bool GetReservedDestination(const OutputType type, bool internal, CTxDestination& address, int64_t& index, CKeyPool& keypool) override;\n+    void ReturnDestination(int64_t index, bool internal, const CTxDestination& addr) override;\n+\n+    bool TopUp(unsigned int size = 0) override;\n+\n+    void MarkUnusedAddresses(const CScript& script) override;\n+\n+    bool IsHDEnabled() const override;\n+\n+    bool SetupGeneration(bool force = false) override;\n+\n+    bool HavePrivateKeys() const override;\n+\n+    void RewriteDB() override;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r377854045",
      "id" : 377854045,
      "in_reply_to_id" : 373612485,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg1NDA0NQ==",
      "original_commit_id" : "ee6980be437c09df6044a5ced7caa91410453027",
      "original_position" : 36,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 356937407,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-20T00:10:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377854045",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've rebased this on top of #18115 and #18034. I'll start addressing other issues tomorrow.\r\n\r\nI believe I've fixed the random failure of `wallet_importdescriptors.py` as well.",
      "created_at" : "2020-02-12T00:37:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-584946241",
      "id" : 584946241,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NDk0NjI0MQ==",
      "updated_at" : "2020-02-12T00:37:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/584946241",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r378112191"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378112191"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This trips up AppVeyor:\r\n```\r\nC:\\projects\\bitcoin\\src\\rpc\\rawtransaction_util.h(27,132): error C2039: 'string': is not a member of 'std' [C:\\projects\\bitcoin\\build_msvc\\libbitcoin_common\\libbitcoin_common.vcxproj]\r\n63C:\\projects\\bitcoin\\src\\rpc\\rawtransaction_util.h(27,138): error C2065: 'string': undeclared identifier [C:\\projects\\bitcoin\\build_msvc\\libbitcoin_common\\libbitcoin_common.vcxproj]\r\n64C:\\projects\\bitcoin\\src\\rpc\\rawtransaction_util.h(27,118): error C2923: 'std::map': 'string' is not a valid template type argument for parameter '_Ty' \r\n```",
      "commit_id" : "20d6303cf744bb8bd0c0a9cb75904cd323ba9a02",
      "created_at" : "2020-02-12T08:54:37Z",
      "diff_hunk" : "@@ -24,6 +24,7 @@ class SigningProvider;\n  * @param result         JSON object where signed transaction results accumulate\n  */\n void SignTransaction(CMutableTransaction& mtx, const SigningProvider* keystore, const std::map<COutPoint, Coin>& coins, const UniValue& hashType, UniValue& result);\n+void MakeSignTransactionResult(CMutableTransaction& mtx, bool complete, const std::map<COutPoint, Coin>& coins, std::map<int, std::string>& input_errors, UniValue& result);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r378112191",
      "id" : 378112191,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODExMjE5MQ==",
      "original_commit_id" : "20d6303cf744bb8bd0c0a9cb75904cd323ba9a02",
      "original_position" : 4,
      "path" : "src/rpc/rawtransaction_util.h",
      "position" : 4,
      "pull_request_review_id" : 357277072,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-12T08:54:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378112191",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've removed the requirement for `range` in `importdescriptors`. It will give a warning and use the default keypool range.",
      "created_at" : "2020-02-14T20:16:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-586456127",
      "id" : 586456127,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NjQ1NjEyNw==",
      "updated_at" : "2020-02-14T20:16:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/586456127",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r381325869"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/381325869"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should this be `GetSolvingProvider` for watch-only wallets? I'm having difficulty getting bip32 keys added to the PSBT while trying to rebase #16546 , see https://github.com/Sjors/bitcoin/commit/8660421cba60de3dd5ab76c8f285bce1f0b4327b\r\n(maybe I should try less of a hack and actually make that subclass...)",
      "commit_id" : "6c1929a8f4d435671e5e0679c71582349b3f336a",
      "created_at" : "2020-02-19T14:30:00Z",
      "diff_hunk" : "@@ -1426,3 +1488,623 @@ std::set<CKeyID> LegacyScriptPubKeyMan::GetKeys() const\n     }\n     return set_address;\n }\n+\n+void LegacyScriptPubKeyMan::SetType(OutputType type, bool internal) {}\n+\n+bool DescriptorScriptPubKeyMan::GetNewDestination(const OutputType type, CTxDestination& dest, std::string& error)\n+{\n+    if (!CanGetAddresses(internal)) {\n+        error = \"No private keys available\";\n+        return false;\n+    }\n+    {\n+        LOCK(cs_desc_man);\n+        if (descriptor.descriptor->IsSingleType() && type != address_type) {\n+            throw std::runtime_error(std::string(__func__) + \": Types are inconsistent\");\n+        }\n+\n+        TopUp();\n+\n+        // Get the scriptPubKey from the descriptor\n+        FlatSigningProvider out_keys;\n+        std::vector<CScript> scripts_temp;\n+        if (descriptor.cache.size() <= (unsigned int)(descriptor.next_index - descriptor.range_start) && !TopUp(1)) {\n+            // We can't generate anymore keys\n+            error = \"Error: Keypool ran out, please call keypoolrefill first\";\n+            return false;\n+        }\n+        descriptor.descriptor->ExpandFromCache(descriptor.next_index, descriptor.cache[descriptor.next_index - descriptor.range_start], scripts_temp, out_keys);\n+\n+        if (descriptor.descriptor->IsSingleType()) {\n+            Optional<OutputType> out_script_type = descriptor.descriptor->GetOutputType();\n+            if (out_script_type && out_script_type == type) {\n+                ExtractDestination(scripts_temp[0], dest);\n+            } else {\n+                throw std::runtime_error(std::string(__func__) + \": Types are inconsistent. Stored type does not match type of newly generated address\");\n+            }\n+        } else {\n+            // This is a combo descriptor which should not be an active descriptor\n+            assert(false);\n+        }\n+        descriptor.next_index++;\n+        WalletBatch(m_storage.GetDatabase()).WriteDescriptor(GetID(), descriptor);\n+        return true;\n+    }\n+}\n+\n+isminetype DescriptorScriptPubKeyMan::IsMine(const CScript& script) const\n+{\n+    LOCK(cs_desc_man);\n+    if (m_map_script_pub_keys.count(script) > 0) {\n+        return ISMINE_SPENDABLE;\n+    }\n+    return ISMINE_NO;\n+}\n+\n+bool DescriptorScriptPubKeyMan::CheckDecryptionKey(const CKeyingMaterial& master_key, bool accept_no_keys)\n+{\n+    {\n+        LOCK(cs_desc_man);\n+        if (!m_map_keys.empty())\n+            return false;\n+\n+        bool keyPass = m_map_crypted_keys.empty(); // Always pass when there are no encrypted keys\n+        bool keyFail = false;\n+        CryptedKeyMap::const_iterator mi = m_map_crypted_keys.begin();\n+        for (; mi != m_map_crypted_keys.end(); ++mi)\n+        {\n+            const CPubKey &pubkey = (*mi).second.first;\n+            const std::vector<unsigned char> &crypted_secret = (*mi).second.second;\n+            CKey key;\n+            if (!DecryptKey(master_key, crypted_secret, pubkey, key))\n+            {\n+                keyFail = true;\n+                break;\n+            }\n+            keyPass = true;\n+            if (m_decryption_thoroughly_checked)\n+                break;\n+        }\n+        if (keyPass && keyFail)\n+        {\n+            LogPrintf(\"The wallet is probably corrupted: Some keys decrypt but not all.\\n\");\n+            throw std::runtime_error(\"Error unlocking wallet: some keys decrypt but not all. Your wallet file may be corrupt.\");\n+        }\n+        if (keyFail || (!keyPass && !accept_no_keys))\n+            return false;\n+        m_decryption_thoroughly_checked = true;\n+    }\n+    return true;\n+}\n+\n+bool DescriptorScriptPubKeyMan::Encrypt(const CKeyingMaterial& master_key, WalletBatch* batch)\n+{\n+    LOCK(cs_desc_man);\n+    if (!m_map_crypted_keys.empty()) {\n+        return false;\n+    }\n+\n+    for (const KeyMap::value_type& key_in : m_map_keys)\n+    {\n+        const CKey &key = key_in.second;\n+        CPubKey pubkey = key.GetPubKey();\n+        CKeyingMaterial secret(key.begin(), key.end());\n+        std::vector<unsigned char> crypted_secret;\n+        if (!EncryptSecret(master_key, secret, pubkey.GetHash(), crypted_secret)) {\n+            return false;\n+        }\n+        m_map_crypted_keys[pubkey.GetID()] = make_pair(pubkey, crypted_secret);\n+        batch->WriteCryptedDescriptorKey(GetID(), pubkey, crypted_secret);\n+    }\n+    m_map_keys.clear();\n+    return true;\n+}\n+\n+bool DescriptorScriptPubKeyMan::GetReservedDestination(const OutputType type, bool internal, CTxDestination& address, int64_t& index, CKeyPool& keypool)\n+{\n+    LOCK(cs_desc_man);\n+    std::string error;\n+    bool result = GetNewDestination(type, address, error);\n+    index = descriptor.next_index - 1;\n+    return result;\n+}\n+\n+void DescriptorScriptPubKeyMan::ReturnDestination(int64_t index, bool internal, const CTxDestination& addr)\n+{\n+    LOCK(cs_desc_man);\n+    // Only return when the index was the most recent\n+    if (descriptor.next_index - 1 == index) {\n+        descriptor.next_index--;\n+    }\n+    WalletBatch(m_storage.GetDatabase()).WriteDescriptor(GetID(), descriptor);\n+    NotifyCanGetAddressesChanged();\n+}\n+\n+std::map<CKeyID, CKey> DescriptorScriptPubKeyMan::GetKeys() const\n+{\n+    AssertLockHeld(cs_desc_man);\n+    if (m_storage.HasEncryptionKeys() && !m_storage.IsLocked()) {\n+        KeyMap keys;\n+        for (auto key_pair : m_map_crypted_keys) {\n+            const CPubKey& pubkey = key_pair.second.first;\n+            const std::vector<unsigned char>& crypted_secret = key_pair.second.second;\n+            CKey key;\n+            DecryptKey(m_storage.GetEncryptionKey(), crypted_secret, pubkey, key);\n+            keys[pubkey.GetID()] = key;\n+        }\n+        return keys;\n+    }\n+    return m_map_keys;\n+}\n+\n+bool DescriptorScriptPubKeyMan::TopUp(unsigned int size)\n+{\n+    LOCK(cs_desc_man);\n+    unsigned int target_size;\n+    if (size > 0)\n+        target_size = size;\n+    else\n+        target_size = std::max(gArgs.GetArg(\"-keypool\", DEFAULT_KEYPOOL_SIZE), (int64_t) 0);\n+\n+    // Make sure we have everything between range_start and range_end\n+    int32_t range_size = descriptor.range_end - descriptor.range_start;\n+    int32_t highest_cached_index = descriptor.range_start + descriptor.cache.size();\n+    int32_t to_fill = std::max(range_size - (int)descriptor.cache.size(), 0);\n+\n+    // Fill up the rest of the pool\n+    int missing_pool = std::max(std::max((int)target_size, 1) - (descriptor.range_end - descriptor.next_index), 0);\n+    to_fill += missing_pool;\n+\n+    // If the descriptor is not ranged, we actually just want to fill the first cache item\n+    if (!descriptor.descriptor->IsRange()) {\n+        to_fill = descriptor.cache.size() == 0 ? 1 : 0;\n+        missing_pool = 0;\n+        descriptor.range_end = 1;\n+        descriptor.range_start = 0;\n+    }\n+\n+    FlatSigningProvider provider;\n+    provider.keys = GetKeys();\n+\n+    WalletBatch batch(m_storage.GetDatabase());\n+    uint256 id = GetID();\n+    for (int32_t i = highest_cached_index; i < highest_cached_index + to_fill; ++i) {\n+        FlatSigningProvider out_keys;\n+        std::vector<CScript> scripts_temp;\n+        std::vector<unsigned char> cache;\n+        if (!descriptor.descriptor->Expand(i, provider, scripts_temp, out_keys, &cache)) return false;\n+        // Add all of the scriptPubKeys to the scriptPubKey set\n+        for (const CScript& script : scripts_temp) {\n+            m_map_script_pub_keys[script] = i;\n+        }\n+        // Write the cache\n+        if (!batch.WriteDescriptorCache(id, i, cache)) {\n+            throw std::runtime_error(std::string(__func__) + \": writing cache item failed\");\n+        }\n+        descriptor.cache.push_back(std::move(cache));\n+    }\n+    descriptor.range_end += missing_pool;\n+    batch.WriteDescriptor(GetID(), descriptor);\n+\n+    // By this point, the cache size should be the size of the entire range\n+    assert((uint32_t)descriptor.range_end - (uint32_t)descriptor.range_start == descriptor.cache.size());\n+\n+    NotifyCanGetAddressesChanged();\n+    return true;\n+}\n+\n+bool DescriptorScriptPubKeyMan::ClearDescriptorCache() {\n+    LOCK(cs_desc_man);\n+    WalletBatch batch(m_storage.GetDatabase());\n+    uint256 id = GetID();\n+    int32_t highest_cached_index = descriptor.range_start + descriptor.cache.size();\n+    for (uint32_t i = highest_cached_index; i < (uint32_t)highest_cached_index + descriptor.cache.size(); ++i) {\n+        if (!batch.EraseDescriptorCache(id, i)) {\n+            throw std::runtime_error(std::string(__func__) + \": removing cache item failed\");\n+        }\n+    }\n+    descriptor.cache.clear();\n+\n+    return true;\n+}\n+\n+void DescriptorScriptPubKeyMan::MarkUnusedAddresses(const CScript& script)\n+{\n+    LOCK(cs_desc_man);\n+    if (IsMine(script)) {\n+        int32_t index = m_map_script_pub_keys[script];\n+        if (index >= descriptor.next_index) {\n+            WalletLogPrintf(\"%s: Detected a used keypool item, mark all keypool items up to this item as used\\n\", __func__);\n+            descriptor.next_index = index + 1;\n+        }\n+        if (!TopUp()) {\n+            WalletLogPrintf(\"%s: Topping up keypool failed (locked wallet)\\n\", __func__);\n+        }\n+    }\n+}\n+\n+void DescriptorScriptPubKeyMan::AddDescriptorKey(const CKey& key, const CPubKey &pubkey)\n+{\n+    LOCK(cs_desc_man);\n+    WalletBatch batch(m_storage.GetDatabase());\n+    if (!AddDescriptorKeyWithDB(batch, key, pubkey)) {\n+        throw std::runtime_error(std::string(__func__) + \": writing descriptor private key failed\");\n+    }\n+}\n+\n+bool DescriptorScriptPubKeyMan::AddDescriptorKeyWithDB(WalletBatch& batch, const CKey& key, const CPubKey &pubkey)\n+{\n+    AssertLockHeld(cs_desc_man);\n+    assert(!m_storage.IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS));\n+\n+    if (m_storage.HasEncryptionKeys()) {\n+        if (m_storage.IsLocked()) {\n+            return false;\n+        }\n+\n+        std::vector<unsigned char> crypted_secret;\n+        CKeyingMaterial secret(key.begin(), key.end());\n+        if (!EncryptSecret(m_storage.GetEncryptionKey(), secret, pubkey.GetHash(), crypted_secret)) {\n+            return false;\n+        }\n+\n+        m_map_crypted_keys[pubkey.GetID()] = make_pair(pubkey, crypted_secret);\n+        batch.WriteCryptedDescriptorKey(GetID(), pubkey, crypted_secret);\n+        return true;\n+    } else {\n+        m_map_keys[pubkey.GetID()] = key;\n+        return batch.WriteDescriptorKey(GetID(), pubkey, key.GetPrivKey());\n+    }\n+}\n+\n+bool DescriptorScriptPubKeyMan::SetupDescriptorGeneration(const CExtKey& master_key)\n+{\n+    LOCK(cs_desc_man);\n+    assert(m_storage.IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS));\n+\n+    // Ignore when there is already a descriptor\n+    if (descriptor.descriptor) {\n+        return false;\n+    }\n+\n+    int64_t creation_time = GetTime();\n+\n+    CPubKey master_pubkey = master_key.key.GetPubKey();\n+    assert(master_key.key.VerifyPubKey(master_pubkey));\n+\n+    // Get the fingerprint\n+    CKeyID master_id = master_key.key.GetPubKey().GetID();\n+    std::string fingerprint = HexStr(master_id.begin(), master_id.begin() + 4);\n+\n+    // Add the seed to the wallet\n+    std::string desc_prefix;\n+    std::string desc_suffix = \"/*)\";\n+    CExtKey d1;\n+    switch (address_type) {\n+    case OutputType::LEGACY: {\n+        master_key.Derive(d1, BIP32_HARDENED_KEY_LIMIT + 44);\n+        desc_prefix = \"pkh([\" + fingerprint + \"/44'\";\n+        break;\n+    }\n+    case OutputType::P2SH_SEGWIT: {\n+        master_key.Derive(d1, BIP32_HARDENED_KEY_LIMIT + 49);\n+        desc_prefix = \"sh(wpkh([\" + fingerprint + \"/49'\";\n+        desc_suffix += \")\";\n+        break;\n+    }\n+    case OutputType::BECH32: {\n+        master_key.Derive(d1, BIP32_HARDENED_KEY_LIMIT + 84);\n+        desc_prefix = \"wpkh([\" + fingerprint + \"/84'\";\n+        break;\n+    }\n+    default: assert(false);\n+    }\n+\n+    // Mainnet derives at 0',testnet and regtest derive at 1'\n+    CExtKey d2;\n+    if (Params().IsTestChain()) {\n+        d1.Derive(d2, BIP32_HARDENED_KEY_LIMIT + 1);\n+        desc_prefix += \"/1'\";\n+    } else {\n+        d1.Derive(d2, BIP32_HARDENED_KEY_LIMIT + 0);\n+        desc_prefix += \"/0'\";\n+    }\n+    // 3rd level is always 0'\n+    CExtKey d3;\n+    d2.Derive(d3, BIP32_HARDENED_KEY_LIMIT + 0);\n+    std::string xpub = EncodeExtPubKey(d3.Neuter());\n+\n+    // Build descriptor string\n+    std::string internal_path = internal ? \"/1\" : \"/0\";\n+    std::string desc_str = desc_prefix + \"/0']\" + xpub + internal_path + desc_suffix;\n+\n+    // Make the descriptor\n+    FlatSigningProvider keys;\n+    std::string error;\n+    std::unique_ptr<Descriptor> desc = Parse(desc_str, keys, error, false);\n+    WalletDescriptor w_desc(std::move(desc), creation_time, 0, 0, 0);\n+    descriptor = w_desc;\n+\n+    // Store the master private key, derived intermediate key, and descriptor\n+    WalletBatch batch(m_storage.GetDatabase());\n+    if (!AddDescriptorKeyWithDB(batch, master_key.key, master_key.key.GetPubKey())) {\n+        throw std::runtime_error(std::string(__func__) + \": writing descriptor master rivate key failed\");\n+    }\n+    if (!AddDescriptorKeyWithDB(batch, d3.key, d3.key.GetPubKey())) {\n+        throw std::runtime_error(std::string(__func__) + \": writing descriptor intermediate private key failed\");\n+    }\n+    if (!batch.WriteDescriptor(GetID(), descriptor)) {\n+        throw std::runtime_error(std::string(__func__) + \": writing descriptor failed\");\n+    }\n+\n+    // TopUp\n+    TopUp();\n+\n+    m_storage.UnsetBlankWalletFlag(batch);\n+    return true;\n+}\n+\n+bool DescriptorScriptPubKeyMan::IsHDEnabled() const\n+{\n+    LOCK(cs_desc_man);\n+    return descriptor.descriptor->IsRange();\n+}\n+\n+bool DescriptorScriptPubKeyMan::CanGetAddresses(bool internal)\n+{\n+    LOCK(cs_desc_man);\n+    return HavePrivateKeys() || descriptor.next_index < descriptor.range_end;\n+}\n+\n+bool DescriptorScriptPubKeyMan::HavePrivateKeys() const\n+{\n+    LOCK(cs_desc_man);\n+    return m_map_keys.size() > 0 || m_map_crypted_keys.size() > 0;\n+}\n+\n+int64_t DescriptorScriptPubKeyMan::GetOldestKeyPoolTime()\n+{\n+    return 0;\n+}\n+\n+size_t DescriptorScriptPubKeyMan::KeypoolCountExternalKeys()\n+{\n+    if (internal) {\n+        return 0;\n+    }\n+    return GetKeyPoolSize();\n+}\n+\n+unsigned int DescriptorScriptPubKeyMan::GetKeyPoolSize() const\n+{\n+    LOCK(cs_desc_man);\n+    return descriptor.range_end - descriptor.next_index;\n+}\n+\n+int64_t DescriptorScriptPubKeyMan::GetTimeFirstKey() const\n+{\n+    LOCK(cs_desc_man);\n+    return descriptor.creation_time;\n+}\n+\n+std::unique_ptr<FlatSigningProvider> DescriptorScriptPubKeyMan::GetSigningProvider(const CScript& script, bool include_private) const\n+{\n+    LOCK(cs_desc_man);\n+\n+    // Find the index of the script\n+    auto it = m_map_script_pub_keys.find(script);\n+    if (it == m_map_script_pub_keys.end()) {\n+        return nullptr;\n+    }\n+    int32_t index = it->second;\n+\n+    // Get the scripts, keys, and key origins for this script\n+    std::unique_ptr<FlatSigningProvider> out_keys = MakeUnique<FlatSigningProvider>();\n+    std::vector<CScript> scripts_temp;\n+    if (!descriptor.descriptor->ExpandFromCache(index, descriptor.cache[index - descriptor.range_start], scripts_temp, *out_keys)) return nullptr;\n+\n+    if (include_private) {\n+        FlatSigningProvider master_provider;\n+        master_provider.keys = GetKeys();\n+        descriptor.descriptor->ExpandPrivate(index, master_provider, *out_keys);\n+    }\n+\n+    return std::move(out_keys);\n+}\n+\n+std::unique_ptr<SigningProvider> DescriptorScriptPubKeyMan::GetSolvingProvider(const CScript& script) const\n+{\n+    return GetSigningProvider(script, false);\n+}\n+\n+bool DescriptorScriptPubKeyMan::CanProvide(const CScript& script, SignatureData& sigdata)\n+{\n+    return IsMine(script);\n+}\n+\n+bool DescriptorScriptPubKeyMan::SignTransaction(CMutableTransaction& tx, const std::map<COutPoint, Coin>& coins, int sighash, std::map<int, std::string>& input_errors) const\n+{\n+    std::unique_ptr<FlatSigningProvider> keys = MakeUnique<FlatSigningProvider>();\n+    for (const auto& coin_pair : coins) {\n+        std::unique_ptr<FlatSigningProvider> coin_keys = std::move(GetSigningProvider(coin_pair.second.out.scriptPubKey, true));\n+        if (!coin_keys) {\n+            continue;\n+        }\n+        *keys = Merge(*keys, *coin_keys);\n+    }\n+\n+    return ::SignTransaction(tx, keys.get(), coins, sighash, input_errors);\n+}\n+\n+SigningResult DescriptorScriptPubKeyMan::SignMessage(const std::string& message, const PKHash& pkhash, std::string& str_sig) const\n+{\n+    std::unique_ptr<FlatSigningProvider> keys = std::move(GetSigningProvider(GetScriptForDestination(pkhash), true));\n+    if (!keys) {\n+        return SigningResult::PRIVATE_KEY_NOT_AVAILABLE;\n+    }\n+\n+    CKeyID key_id(pkhash);\n+    CKey key;\n+    if (!keys->GetKey(key_id, key)) {\n+        return SigningResult::PRIVATE_KEY_NOT_AVAILABLE;\n+    }\n+\n+    if (!MessageSign(key, message, str_sig)) {\n+        return SigningResult::SIGNING_FAILED;\n+    }\n+    return SigningResult::OK;\n+}\n+\n+TransactionError DescriptorScriptPubKeyMan::FillPSBT(PartiallySignedTransaction& psbtx, int sighash_type, bool sign, bool bip32derivs) const\n+{\n+    for (unsigned int i = 0; i < psbtx.tx->vin.size(); ++i) {\n+        const CTxIn& txin = psbtx.tx->vin[i];\n+        PSBTInput& input = psbtx.inputs.at(i);\n+\n+        if (PSBTInputSigned(input)) {\n+            continue;\n+        }\n+\n+        // Verify input looks sane. This will check that we have at most one uxto, witness or non-witness.\n+        if (!input.IsSane()) {\n+            return TransactionError::INVALID_PSBT;\n+        }\n+\n+        // Get the Sighash type\n+        if (sign && input.sighash_type > 0 && input.sighash_type != sighash_type) {\n+            return TransactionError::SIGHASH_MISMATCH;\n+        }\n+\n+        // Get the scriptPubKey to know which SigningProvider to use\n+        CScript script;\n+        if (!input.witness_utxo.IsNull()) {\n+            script = input.witness_utxo.scriptPubKey;\n+        } else if (input.non_witness_utxo) {\n+            if (txin.prevout.n >= input.non_witness_utxo->vout.size()) {\n+                return TransactionError::MISSING_INPUTS;\n+            }\n+            script = input.non_witness_utxo->vout[txin.prevout.n].scriptPubKey;\n+        } else {\n+            // There's no UTXO so we can just skip this now\n+            continue;\n+        }\n+        SignatureData sigdata;\n+        input.FillSignatureData(sigdata);\n+\n+        std::unique_ptr<FlatSigningProvider> keys = GetSigningProvider(script, true);\n+        if (!keys) {\n+            continue;\n+        }\n+\n+        SignPSBTInput(HidingSigningProvider(keys.get(), !sign, !bip32derivs), psbtx, i, sighash_type);\n+    }\n+\n+    // Fill in the bip32 keypaths and redeemscripts for the outputs so that hardware wallets can identify change\n+    for (unsigned int i = 0; i < psbtx.tx->vout.size(); ++i) {\n+        std::unique_ptr<FlatSigningProvider> keys = GetSigningProvider(psbtx.tx->vout.at(i).scriptPubKey, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r381325869",
      "id" : 381325869,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyNTg2OQ==",
      "original_commit_id" : "91d4efc84283743ef26e58526269731909286777",
      "original_position" : 621,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 361155493,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-20T00:10:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/381325869",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r381372422"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/381372422"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Once #18180 is implemented that reduce at least some of my confusion :-) ",
      "commit_id" : "6c1929a8f4d435671e5e0679c71582349b3f336a",
      "created_at" : "2020-02-19T16:04:54Z",
      "diff_hunk" : "@@ -1426,3 +1488,623 @@ std::set<CKeyID> LegacyScriptPubKeyMan::GetKeys() const\n     }\n     return set_address;\n }\n+\n+void LegacyScriptPubKeyMan::SetType(OutputType type, bool internal) {}\n+\n+bool DescriptorScriptPubKeyMan::GetNewDestination(const OutputType type, CTxDestination& dest, std::string& error)\n+{\n+    if (!CanGetAddresses(internal)) {\n+        error = \"No private keys available\";\n+        return false;\n+    }\n+    {\n+        LOCK(cs_desc_man);\n+        if (descriptor.descriptor->IsSingleType() && type != address_type) {\n+            throw std::runtime_error(std::string(__func__) + \": Types are inconsistent\");\n+        }\n+\n+        TopUp();\n+\n+        // Get the scriptPubKey from the descriptor\n+        FlatSigningProvider out_keys;\n+        std::vector<CScript> scripts_temp;\n+        if (descriptor.cache.size() <= (unsigned int)(descriptor.next_index - descriptor.range_start) && !TopUp(1)) {\n+            // We can't generate anymore keys\n+            error = \"Error: Keypool ran out, please call keypoolrefill first\";\n+            return false;\n+        }\n+        descriptor.descriptor->ExpandFromCache(descriptor.next_index, descriptor.cache[descriptor.next_index - descriptor.range_start], scripts_temp, out_keys);\n+\n+        if (descriptor.descriptor->IsSingleType()) {\n+            Optional<OutputType> out_script_type = descriptor.descriptor->GetOutputType();\n+            if (out_script_type && out_script_type == type) {\n+                ExtractDestination(scripts_temp[0], dest);\n+            } else {\n+                throw std::runtime_error(std::string(__func__) + \": Types are inconsistent. Stored type does not match type of newly generated address\");\n+            }\n+        } else {\n+            // This is a combo descriptor which should not be an active descriptor\n+            assert(false);\n+        }\n+        descriptor.next_index++;\n+        WalletBatch(m_storage.GetDatabase()).WriteDescriptor(GetID(), descriptor);\n+        return true;\n+    }\n+}\n+\n+isminetype DescriptorScriptPubKeyMan::IsMine(const CScript& script) const\n+{\n+    LOCK(cs_desc_man);\n+    if (m_map_script_pub_keys.count(script) > 0) {\n+        return ISMINE_SPENDABLE;\n+    }\n+    return ISMINE_NO;\n+}\n+\n+bool DescriptorScriptPubKeyMan::CheckDecryptionKey(const CKeyingMaterial& master_key, bool accept_no_keys)\n+{\n+    {\n+        LOCK(cs_desc_man);\n+        if (!m_map_keys.empty())\n+            return false;\n+\n+        bool keyPass = m_map_crypted_keys.empty(); // Always pass when there are no encrypted keys\n+        bool keyFail = false;\n+        CryptedKeyMap::const_iterator mi = m_map_crypted_keys.begin();\n+        for (; mi != m_map_crypted_keys.end(); ++mi)\n+        {\n+            const CPubKey &pubkey = (*mi).second.first;\n+            const std::vector<unsigned char> &crypted_secret = (*mi).second.second;\n+            CKey key;\n+            if (!DecryptKey(master_key, crypted_secret, pubkey, key))\n+            {\n+                keyFail = true;\n+                break;\n+            }\n+            keyPass = true;\n+            if (m_decryption_thoroughly_checked)\n+                break;\n+        }\n+        if (keyPass && keyFail)\n+        {\n+            LogPrintf(\"The wallet is probably corrupted: Some keys decrypt but not all.\\n\");\n+            throw std::runtime_error(\"Error unlocking wallet: some keys decrypt but not all. Your wallet file may be corrupt.\");\n+        }\n+        if (keyFail || (!keyPass && !accept_no_keys))\n+            return false;\n+        m_decryption_thoroughly_checked = true;\n+    }\n+    return true;\n+}\n+\n+bool DescriptorScriptPubKeyMan::Encrypt(const CKeyingMaterial& master_key, WalletBatch* batch)\n+{\n+    LOCK(cs_desc_man);\n+    if (!m_map_crypted_keys.empty()) {\n+        return false;\n+    }\n+\n+    for (const KeyMap::value_type& key_in : m_map_keys)\n+    {\n+        const CKey &key = key_in.second;\n+        CPubKey pubkey = key.GetPubKey();\n+        CKeyingMaterial secret(key.begin(), key.end());\n+        std::vector<unsigned char> crypted_secret;\n+        if (!EncryptSecret(master_key, secret, pubkey.GetHash(), crypted_secret)) {\n+            return false;\n+        }\n+        m_map_crypted_keys[pubkey.GetID()] = make_pair(pubkey, crypted_secret);\n+        batch->WriteCryptedDescriptorKey(GetID(), pubkey, crypted_secret);\n+    }\n+    m_map_keys.clear();\n+    return true;\n+}\n+\n+bool DescriptorScriptPubKeyMan::GetReservedDestination(const OutputType type, bool internal, CTxDestination& address, int64_t& index, CKeyPool& keypool)\n+{\n+    LOCK(cs_desc_man);\n+    std::string error;\n+    bool result = GetNewDestination(type, address, error);\n+    index = descriptor.next_index - 1;\n+    return result;\n+}\n+\n+void DescriptorScriptPubKeyMan::ReturnDestination(int64_t index, bool internal, const CTxDestination& addr)\n+{\n+    LOCK(cs_desc_man);\n+    // Only return when the index was the most recent\n+    if (descriptor.next_index - 1 == index) {\n+        descriptor.next_index--;\n+    }\n+    WalletBatch(m_storage.GetDatabase()).WriteDescriptor(GetID(), descriptor);\n+    NotifyCanGetAddressesChanged();\n+}\n+\n+std::map<CKeyID, CKey> DescriptorScriptPubKeyMan::GetKeys() const\n+{\n+    AssertLockHeld(cs_desc_man);\n+    if (m_storage.HasEncryptionKeys() && !m_storage.IsLocked()) {\n+        KeyMap keys;\n+        for (auto key_pair : m_map_crypted_keys) {\n+            const CPubKey& pubkey = key_pair.second.first;\n+            const std::vector<unsigned char>& crypted_secret = key_pair.second.second;\n+            CKey key;\n+            DecryptKey(m_storage.GetEncryptionKey(), crypted_secret, pubkey, key);\n+            keys[pubkey.GetID()] = key;\n+        }\n+        return keys;\n+    }\n+    return m_map_keys;\n+}\n+\n+bool DescriptorScriptPubKeyMan::TopUp(unsigned int size)\n+{\n+    LOCK(cs_desc_man);\n+    unsigned int target_size;\n+    if (size > 0)\n+        target_size = size;\n+    else\n+        target_size = std::max(gArgs.GetArg(\"-keypool\", DEFAULT_KEYPOOL_SIZE), (int64_t) 0);\n+\n+    // Make sure we have everything between range_start and range_end\n+    int32_t range_size = descriptor.range_end - descriptor.range_start;\n+    int32_t highest_cached_index = descriptor.range_start + descriptor.cache.size();\n+    int32_t to_fill = std::max(range_size - (int)descriptor.cache.size(), 0);\n+\n+    // Fill up the rest of the pool\n+    int missing_pool = std::max(std::max((int)target_size, 1) - (descriptor.range_end - descriptor.next_index), 0);\n+    to_fill += missing_pool;\n+\n+    // If the descriptor is not ranged, we actually just want to fill the first cache item\n+    if (!descriptor.descriptor->IsRange()) {\n+        to_fill = descriptor.cache.size() == 0 ? 1 : 0;\n+        missing_pool = 0;\n+        descriptor.range_end = 1;\n+        descriptor.range_start = 0;\n+    }\n+\n+    FlatSigningProvider provider;\n+    provider.keys = GetKeys();\n+\n+    WalletBatch batch(m_storage.GetDatabase());\n+    uint256 id = GetID();\n+    for (int32_t i = highest_cached_index; i < highest_cached_index + to_fill; ++i) {\n+        FlatSigningProvider out_keys;\n+        std::vector<CScript> scripts_temp;\n+        std::vector<unsigned char> cache;\n+        if (!descriptor.descriptor->Expand(i, provider, scripts_temp, out_keys, &cache)) return false;\n+        // Add all of the scriptPubKeys to the scriptPubKey set\n+        for (const CScript& script : scripts_temp) {\n+            m_map_script_pub_keys[script] = i;\n+        }\n+        // Write the cache\n+        if (!batch.WriteDescriptorCache(id, i, cache)) {\n+            throw std::runtime_error(std::string(__func__) + \": writing cache item failed\");\n+        }\n+        descriptor.cache.push_back(std::move(cache));\n+    }\n+    descriptor.range_end += missing_pool;\n+    batch.WriteDescriptor(GetID(), descriptor);\n+\n+    // By this point, the cache size should be the size of the entire range\n+    assert((uint32_t)descriptor.range_end - (uint32_t)descriptor.range_start == descriptor.cache.size());\n+\n+    NotifyCanGetAddressesChanged();\n+    return true;\n+}\n+\n+bool DescriptorScriptPubKeyMan::ClearDescriptorCache() {\n+    LOCK(cs_desc_man);\n+    WalletBatch batch(m_storage.GetDatabase());\n+    uint256 id = GetID();\n+    int32_t highest_cached_index = descriptor.range_start + descriptor.cache.size();\n+    for (uint32_t i = highest_cached_index; i < (uint32_t)highest_cached_index + descriptor.cache.size(); ++i) {\n+        if (!batch.EraseDescriptorCache(id, i)) {\n+            throw std::runtime_error(std::string(__func__) + \": removing cache item failed\");\n+        }\n+    }\n+    descriptor.cache.clear();\n+\n+    return true;\n+}\n+\n+void DescriptorScriptPubKeyMan::MarkUnusedAddresses(const CScript& script)\n+{\n+    LOCK(cs_desc_man);\n+    if (IsMine(script)) {\n+        int32_t index = m_map_script_pub_keys[script];\n+        if (index >= descriptor.next_index) {\n+            WalletLogPrintf(\"%s: Detected a used keypool item, mark all keypool items up to this item as used\\n\", __func__);\n+            descriptor.next_index = index + 1;\n+        }\n+        if (!TopUp()) {\n+            WalletLogPrintf(\"%s: Topping up keypool failed (locked wallet)\\n\", __func__);\n+        }\n+    }\n+}\n+\n+void DescriptorScriptPubKeyMan::AddDescriptorKey(const CKey& key, const CPubKey &pubkey)\n+{\n+    LOCK(cs_desc_man);\n+    WalletBatch batch(m_storage.GetDatabase());\n+    if (!AddDescriptorKeyWithDB(batch, key, pubkey)) {\n+        throw std::runtime_error(std::string(__func__) + \": writing descriptor private key failed\");\n+    }\n+}\n+\n+bool DescriptorScriptPubKeyMan::AddDescriptorKeyWithDB(WalletBatch& batch, const CKey& key, const CPubKey &pubkey)\n+{\n+    AssertLockHeld(cs_desc_man);\n+    assert(!m_storage.IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS));\n+\n+    if (m_storage.HasEncryptionKeys()) {\n+        if (m_storage.IsLocked()) {\n+            return false;\n+        }\n+\n+        std::vector<unsigned char> crypted_secret;\n+        CKeyingMaterial secret(key.begin(), key.end());\n+        if (!EncryptSecret(m_storage.GetEncryptionKey(), secret, pubkey.GetHash(), crypted_secret)) {\n+            return false;\n+        }\n+\n+        m_map_crypted_keys[pubkey.GetID()] = make_pair(pubkey, crypted_secret);\n+        batch.WriteCryptedDescriptorKey(GetID(), pubkey, crypted_secret);\n+        return true;\n+    } else {\n+        m_map_keys[pubkey.GetID()] = key;\n+        return batch.WriteDescriptorKey(GetID(), pubkey, key.GetPrivKey());\n+    }\n+}\n+\n+bool DescriptorScriptPubKeyMan::SetupDescriptorGeneration(const CExtKey& master_key)\n+{\n+    LOCK(cs_desc_man);\n+    assert(m_storage.IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS));\n+\n+    // Ignore when there is already a descriptor\n+    if (descriptor.descriptor) {\n+        return false;\n+    }\n+\n+    int64_t creation_time = GetTime();\n+\n+    CPubKey master_pubkey = master_key.key.GetPubKey();\n+    assert(master_key.key.VerifyPubKey(master_pubkey));\n+\n+    // Get the fingerprint\n+    CKeyID master_id = master_key.key.GetPubKey().GetID();\n+    std::string fingerprint = HexStr(master_id.begin(), master_id.begin() + 4);\n+\n+    // Add the seed to the wallet\n+    std::string desc_prefix;\n+    std::string desc_suffix = \"/*)\";\n+    CExtKey d1;\n+    switch (address_type) {\n+    case OutputType::LEGACY: {\n+        master_key.Derive(d1, BIP32_HARDENED_KEY_LIMIT + 44);\n+        desc_prefix = \"pkh([\" + fingerprint + \"/44'\";\n+        break;\n+    }\n+    case OutputType::P2SH_SEGWIT: {\n+        master_key.Derive(d1, BIP32_HARDENED_KEY_LIMIT + 49);\n+        desc_prefix = \"sh(wpkh([\" + fingerprint + \"/49'\";\n+        desc_suffix += \")\";\n+        break;\n+    }\n+    case OutputType::BECH32: {\n+        master_key.Derive(d1, BIP32_HARDENED_KEY_LIMIT + 84);\n+        desc_prefix = \"wpkh([\" + fingerprint + \"/84'\";\n+        break;\n+    }\n+    default: assert(false);\n+    }\n+\n+    // Mainnet derives at 0',testnet and regtest derive at 1'\n+    CExtKey d2;\n+    if (Params().IsTestChain()) {\n+        d1.Derive(d2, BIP32_HARDENED_KEY_LIMIT + 1);\n+        desc_prefix += \"/1'\";\n+    } else {\n+        d1.Derive(d2, BIP32_HARDENED_KEY_LIMIT + 0);\n+        desc_prefix += \"/0'\";\n+    }\n+    // 3rd level is always 0'\n+    CExtKey d3;\n+    d2.Derive(d3, BIP32_HARDENED_KEY_LIMIT + 0);\n+    std::string xpub = EncodeExtPubKey(d3.Neuter());\n+\n+    // Build descriptor string\n+    std::string internal_path = internal ? \"/1\" : \"/0\";\n+    std::string desc_str = desc_prefix + \"/0']\" + xpub + internal_path + desc_suffix;\n+\n+    // Make the descriptor\n+    FlatSigningProvider keys;\n+    std::string error;\n+    std::unique_ptr<Descriptor> desc = Parse(desc_str, keys, error, false);\n+    WalletDescriptor w_desc(std::move(desc), creation_time, 0, 0, 0);\n+    descriptor = w_desc;\n+\n+    // Store the master private key, derived intermediate key, and descriptor\n+    WalletBatch batch(m_storage.GetDatabase());\n+    if (!AddDescriptorKeyWithDB(batch, master_key.key, master_key.key.GetPubKey())) {\n+        throw std::runtime_error(std::string(__func__) + \": writing descriptor master rivate key failed\");\n+    }\n+    if (!AddDescriptorKeyWithDB(batch, d3.key, d3.key.GetPubKey())) {\n+        throw std::runtime_error(std::string(__func__) + \": writing descriptor intermediate private key failed\");\n+    }\n+    if (!batch.WriteDescriptor(GetID(), descriptor)) {\n+        throw std::runtime_error(std::string(__func__) + \": writing descriptor failed\");\n+    }\n+\n+    // TopUp\n+    TopUp();\n+\n+    m_storage.UnsetBlankWalletFlag(batch);\n+    return true;\n+}\n+\n+bool DescriptorScriptPubKeyMan::IsHDEnabled() const\n+{\n+    LOCK(cs_desc_man);\n+    return descriptor.descriptor->IsRange();\n+}\n+\n+bool DescriptorScriptPubKeyMan::CanGetAddresses(bool internal)\n+{\n+    LOCK(cs_desc_man);\n+    return HavePrivateKeys() || descriptor.next_index < descriptor.range_end;\n+}\n+\n+bool DescriptorScriptPubKeyMan::HavePrivateKeys() const\n+{\n+    LOCK(cs_desc_man);\n+    return m_map_keys.size() > 0 || m_map_crypted_keys.size() > 0;\n+}\n+\n+int64_t DescriptorScriptPubKeyMan::GetOldestKeyPoolTime()\n+{\n+    return 0;\n+}\n+\n+size_t DescriptorScriptPubKeyMan::KeypoolCountExternalKeys()\n+{\n+    if (internal) {\n+        return 0;\n+    }\n+    return GetKeyPoolSize();\n+}\n+\n+unsigned int DescriptorScriptPubKeyMan::GetKeyPoolSize() const\n+{\n+    LOCK(cs_desc_man);\n+    return descriptor.range_end - descriptor.next_index;\n+}\n+\n+int64_t DescriptorScriptPubKeyMan::GetTimeFirstKey() const\n+{\n+    LOCK(cs_desc_man);\n+    return descriptor.creation_time;\n+}\n+\n+std::unique_ptr<FlatSigningProvider> DescriptorScriptPubKeyMan::GetSigningProvider(const CScript& script, bool include_private) const\n+{\n+    LOCK(cs_desc_man);\n+\n+    // Find the index of the script\n+    auto it = m_map_script_pub_keys.find(script);\n+    if (it == m_map_script_pub_keys.end()) {\n+        return nullptr;\n+    }\n+    int32_t index = it->second;\n+\n+    // Get the scripts, keys, and key origins for this script\n+    std::unique_ptr<FlatSigningProvider> out_keys = MakeUnique<FlatSigningProvider>();\n+    std::vector<CScript> scripts_temp;\n+    if (!descriptor.descriptor->ExpandFromCache(index, descriptor.cache[index - descriptor.range_start], scripts_temp, *out_keys)) return nullptr;\n+\n+    if (include_private) {\n+        FlatSigningProvider master_provider;\n+        master_provider.keys = GetKeys();\n+        descriptor.descriptor->ExpandPrivate(index, master_provider, *out_keys);\n+    }\n+\n+    return std::move(out_keys);\n+}\n+\n+std::unique_ptr<SigningProvider> DescriptorScriptPubKeyMan::GetSolvingProvider(const CScript& script) const\n+{\n+    return GetSigningProvider(script, false);\n+}\n+\n+bool DescriptorScriptPubKeyMan::CanProvide(const CScript& script, SignatureData& sigdata)\n+{\n+    return IsMine(script);\n+}\n+\n+bool DescriptorScriptPubKeyMan::SignTransaction(CMutableTransaction& tx, const std::map<COutPoint, Coin>& coins, int sighash, std::map<int, std::string>& input_errors) const\n+{\n+    std::unique_ptr<FlatSigningProvider> keys = MakeUnique<FlatSigningProvider>();\n+    for (const auto& coin_pair : coins) {\n+        std::unique_ptr<FlatSigningProvider> coin_keys = std::move(GetSigningProvider(coin_pair.second.out.scriptPubKey, true));\n+        if (!coin_keys) {\n+            continue;\n+        }\n+        *keys = Merge(*keys, *coin_keys);\n+    }\n+\n+    return ::SignTransaction(tx, keys.get(), coins, sighash, input_errors);\n+}\n+\n+SigningResult DescriptorScriptPubKeyMan::SignMessage(const std::string& message, const PKHash& pkhash, std::string& str_sig) const\n+{\n+    std::unique_ptr<FlatSigningProvider> keys = std::move(GetSigningProvider(GetScriptForDestination(pkhash), true));\n+    if (!keys) {\n+        return SigningResult::PRIVATE_KEY_NOT_AVAILABLE;\n+    }\n+\n+    CKeyID key_id(pkhash);\n+    CKey key;\n+    if (!keys->GetKey(key_id, key)) {\n+        return SigningResult::PRIVATE_KEY_NOT_AVAILABLE;\n+    }\n+\n+    if (!MessageSign(key, message, str_sig)) {\n+        return SigningResult::SIGNING_FAILED;\n+    }\n+    return SigningResult::OK;\n+}\n+\n+TransactionError DescriptorScriptPubKeyMan::FillPSBT(PartiallySignedTransaction& psbtx, int sighash_type, bool sign, bool bip32derivs) const\n+{\n+    for (unsigned int i = 0; i < psbtx.tx->vin.size(); ++i) {\n+        const CTxIn& txin = psbtx.tx->vin[i];\n+        PSBTInput& input = psbtx.inputs.at(i);\n+\n+        if (PSBTInputSigned(input)) {\n+            continue;\n+        }\n+\n+        // Verify input looks sane. This will check that we have at most one uxto, witness or non-witness.\n+        if (!input.IsSane()) {\n+            return TransactionError::INVALID_PSBT;\n+        }\n+\n+        // Get the Sighash type\n+        if (sign && input.sighash_type > 0 && input.sighash_type != sighash_type) {\n+            return TransactionError::SIGHASH_MISMATCH;\n+        }\n+\n+        // Get the scriptPubKey to know which SigningProvider to use\n+        CScript script;\n+        if (!input.witness_utxo.IsNull()) {\n+            script = input.witness_utxo.scriptPubKey;\n+        } else if (input.non_witness_utxo) {\n+            if (txin.prevout.n >= input.non_witness_utxo->vout.size()) {\n+                return TransactionError::MISSING_INPUTS;\n+            }\n+            script = input.non_witness_utxo->vout[txin.prevout.n].scriptPubKey;\n+        } else {\n+            // There's no UTXO so we can just skip this now\n+            continue;\n+        }\n+        SignatureData sigdata;\n+        input.FillSignatureData(sigdata);\n+\n+        std::unique_ptr<FlatSigningProvider> keys = GetSigningProvider(script, true);\n+        if (!keys) {\n+            continue;\n+        }\n+\n+        SignPSBTInput(HidingSigningProvider(keys.get(), !sign, !bip32derivs), psbtx, i, sighash_type);\n+    }\n+\n+    // Fill in the bip32 keypaths and redeemscripts for the outputs so that hardware wallets can identify change\n+    for (unsigned int i = 0; i < psbtx.tx->vout.size(); ++i) {\n+        std::unique_ptr<FlatSigningProvider> keys = GetSigningProvider(psbtx.tx->vout.at(i).scriptPubKey, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r381372422",
      "id" : 381372422,
      "in_reply_to_id" : 381325869,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM3MjQyMg==",
      "original_commit_id" : "91d4efc84283743ef26e58526269731909286777",
      "original_position" : 621,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 361216880,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-20T00:10:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/381372422",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r382704392"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/382704392"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I figured out what confused me. I was trying to call the Descriptor SKPMan version of `FillPSBT()` but that doesn't include the UTXOs, which are normally added in `CWallet`. I overhauled my design to avoid that problem. ",
      "commit_id" : "6c1929a8f4d435671e5e0679c71582349b3f336a",
      "created_at" : "2020-02-21T17:16:39Z",
      "diff_hunk" : "@@ -1426,3 +1488,623 @@ std::set<CKeyID> LegacyScriptPubKeyMan::GetKeys() const\n     }\n     return set_address;\n }\n+\n+void LegacyScriptPubKeyMan::SetType(OutputType type, bool internal) {}\n+\n+bool DescriptorScriptPubKeyMan::GetNewDestination(const OutputType type, CTxDestination& dest, std::string& error)\n+{\n+    if (!CanGetAddresses(internal)) {\n+        error = \"No private keys available\";\n+        return false;\n+    }\n+    {\n+        LOCK(cs_desc_man);\n+        if (descriptor.descriptor->IsSingleType() && type != address_type) {\n+            throw std::runtime_error(std::string(__func__) + \": Types are inconsistent\");\n+        }\n+\n+        TopUp();\n+\n+        // Get the scriptPubKey from the descriptor\n+        FlatSigningProvider out_keys;\n+        std::vector<CScript> scripts_temp;\n+        if (descriptor.cache.size() <= (unsigned int)(descriptor.next_index - descriptor.range_start) && !TopUp(1)) {\n+            // We can't generate anymore keys\n+            error = \"Error: Keypool ran out, please call keypoolrefill first\";\n+            return false;\n+        }\n+        descriptor.descriptor->ExpandFromCache(descriptor.next_index, descriptor.cache[descriptor.next_index - descriptor.range_start], scripts_temp, out_keys);\n+\n+        if (descriptor.descriptor->IsSingleType()) {\n+            Optional<OutputType> out_script_type = descriptor.descriptor->GetOutputType();\n+            if (out_script_type && out_script_type == type) {\n+                ExtractDestination(scripts_temp[0], dest);\n+            } else {\n+                throw std::runtime_error(std::string(__func__) + \": Types are inconsistent. Stored type does not match type of newly generated address\");\n+            }\n+        } else {\n+            // This is a combo descriptor which should not be an active descriptor\n+            assert(false);\n+        }\n+        descriptor.next_index++;\n+        WalletBatch(m_storage.GetDatabase()).WriteDescriptor(GetID(), descriptor);\n+        return true;\n+    }\n+}\n+\n+isminetype DescriptorScriptPubKeyMan::IsMine(const CScript& script) const\n+{\n+    LOCK(cs_desc_man);\n+    if (m_map_script_pub_keys.count(script) > 0) {\n+        return ISMINE_SPENDABLE;\n+    }\n+    return ISMINE_NO;\n+}\n+\n+bool DescriptorScriptPubKeyMan::CheckDecryptionKey(const CKeyingMaterial& master_key, bool accept_no_keys)\n+{\n+    {\n+        LOCK(cs_desc_man);\n+        if (!m_map_keys.empty())\n+            return false;\n+\n+        bool keyPass = m_map_crypted_keys.empty(); // Always pass when there are no encrypted keys\n+        bool keyFail = false;\n+        CryptedKeyMap::const_iterator mi = m_map_crypted_keys.begin();\n+        for (; mi != m_map_crypted_keys.end(); ++mi)\n+        {\n+            const CPubKey &pubkey = (*mi).second.first;\n+            const std::vector<unsigned char> &crypted_secret = (*mi).second.second;\n+            CKey key;\n+            if (!DecryptKey(master_key, crypted_secret, pubkey, key))\n+            {\n+                keyFail = true;\n+                break;\n+            }\n+            keyPass = true;\n+            if (m_decryption_thoroughly_checked)\n+                break;\n+        }\n+        if (keyPass && keyFail)\n+        {\n+            LogPrintf(\"The wallet is probably corrupted: Some keys decrypt but not all.\\n\");\n+            throw std::runtime_error(\"Error unlocking wallet: some keys decrypt but not all. Your wallet file may be corrupt.\");\n+        }\n+        if (keyFail || (!keyPass && !accept_no_keys))\n+            return false;\n+        m_decryption_thoroughly_checked = true;\n+    }\n+    return true;\n+}\n+\n+bool DescriptorScriptPubKeyMan::Encrypt(const CKeyingMaterial& master_key, WalletBatch* batch)\n+{\n+    LOCK(cs_desc_man);\n+    if (!m_map_crypted_keys.empty()) {\n+        return false;\n+    }\n+\n+    for (const KeyMap::value_type& key_in : m_map_keys)\n+    {\n+        const CKey &key = key_in.second;\n+        CPubKey pubkey = key.GetPubKey();\n+        CKeyingMaterial secret(key.begin(), key.end());\n+        std::vector<unsigned char> crypted_secret;\n+        if (!EncryptSecret(master_key, secret, pubkey.GetHash(), crypted_secret)) {\n+            return false;\n+        }\n+        m_map_crypted_keys[pubkey.GetID()] = make_pair(pubkey, crypted_secret);\n+        batch->WriteCryptedDescriptorKey(GetID(), pubkey, crypted_secret);\n+    }\n+    m_map_keys.clear();\n+    return true;\n+}\n+\n+bool DescriptorScriptPubKeyMan::GetReservedDestination(const OutputType type, bool internal, CTxDestination& address, int64_t& index, CKeyPool& keypool)\n+{\n+    LOCK(cs_desc_man);\n+    std::string error;\n+    bool result = GetNewDestination(type, address, error);\n+    index = descriptor.next_index - 1;\n+    return result;\n+}\n+\n+void DescriptorScriptPubKeyMan::ReturnDestination(int64_t index, bool internal, const CTxDestination& addr)\n+{\n+    LOCK(cs_desc_man);\n+    // Only return when the index was the most recent\n+    if (descriptor.next_index - 1 == index) {\n+        descriptor.next_index--;\n+    }\n+    WalletBatch(m_storage.GetDatabase()).WriteDescriptor(GetID(), descriptor);\n+    NotifyCanGetAddressesChanged();\n+}\n+\n+std::map<CKeyID, CKey> DescriptorScriptPubKeyMan::GetKeys() const\n+{\n+    AssertLockHeld(cs_desc_man);\n+    if (m_storage.HasEncryptionKeys() && !m_storage.IsLocked()) {\n+        KeyMap keys;\n+        for (auto key_pair : m_map_crypted_keys) {\n+            const CPubKey& pubkey = key_pair.second.first;\n+            const std::vector<unsigned char>& crypted_secret = key_pair.second.second;\n+            CKey key;\n+            DecryptKey(m_storage.GetEncryptionKey(), crypted_secret, pubkey, key);\n+            keys[pubkey.GetID()] = key;\n+        }\n+        return keys;\n+    }\n+    return m_map_keys;\n+}\n+\n+bool DescriptorScriptPubKeyMan::TopUp(unsigned int size)\n+{\n+    LOCK(cs_desc_man);\n+    unsigned int target_size;\n+    if (size > 0)\n+        target_size = size;\n+    else\n+        target_size = std::max(gArgs.GetArg(\"-keypool\", DEFAULT_KEYPOOL_SIZE), (int64_t) 0);\n+\n+    // Make sure we have everything between range_start and range_end\n+    int32_t range_size = descriptor.range_end - descriptor.range_start;\n+    int32_t highest_cached_index = descriptor.range_start + descriptor.cache.size();\n+    int32_t to_fill = std::max(range_size - (int)descriptor.cache.size(), 0);\n+\n+    // Fill up the rest of the pool\n+    int missing_pool = std::max(std::max((int)target_size, 1) - (descriptor.range_end - descriptor.next_index), 0);\n+    to_fill += missing_pool;\n+\n+    // If the descriptor is not ranged, we actually just want to fill the first cache item\n+    if (!descriptor.descriptor->IsRange()) {\n+        to_fill = descriptor.cache.size() == 0 ? 1 : 0;\n+        missing_pool = 0;\n+        descriptor.range_end = 1;\n+        descriptor.range_start = 0;\n+    }\n+\n+    FlatSigningProvider provider;\n+    provider.keys = GetKeys();\n+\n+    WalletBatch batch(m_storage.GetDatabase());\n+    uint256 id = GetID();\n+    for (int32_t i = highest_cached_index; i < highest_cached_index + to_fill; ++i) {\n+        FlatSigningProvider out_keys;\n+        std::vector<CScript> scripts_temp;\n+        std::vector<unsigned char> cache;\n+        if (!descriptor.descriptor->Expand(i, provider, scripts_temp, out_keys, &cache)) return false;\n+        // Add all of the scriptPubKeys to the scriptPubKey set\n+        for (const CScript& script : scripts_temp) {\n+            m_map_script_pub_keys[script] = i;\n+        }\n+        // Write the cache\n+        if (!batch.WriteDescriptorCache(id, i, cache)) {\n+            throw std::runtime_error(std::string(__func__) + \": writing cache item failed\");\n+        }\n+        descriptor.cache.push_back(std::move(cache));\n+    }\n+    descriptor.range_end += missing_pool;\n+    batch.WriteDescriptor(GetID(), descriptor);\n+\n+    // By this point, the cache size should be the size of the entire range\n+    assert((uint32_t)descriptor.range_end - (uint32_t)descriptor.range_start == descriptor.cache.size());\n+\n+    NotifyCanGetAddressesChanged();\n+    return true;\n+}\n+\n+bool DescriptorScriptPubKeyMan::ClearDescriptorCache() {\n+    LOCK(cs_desc_man);\n+    WalletBatch batch(m_storage.GetDatabase());\n+    uint256 id = GetID();\n+    int32_t highest_cached_index = descriptor.range_start + descriptor.cache.size();\n+    for (uint32_t i = highest_cached_index; i < (uint32_t)highest_cached_index + descriptor.cache.size(); ++i) {\n+        if (!batch.EraseDescriptorCache(id, i)) {\n+            throw std::runtime_error(std::string(__func__) + \": removing cache item failed\");\n+        }\n+    }\n+    descriptor.cache.clear();\n+\n+    return true;\n+}\n+\n+void DescriptorScriptPubKeyMan::MarkUnusedAddresses(const CScript& script)\n+{\n+    LOCK(cs_desc_man);\n+    if (IsMine(script)) {\n+        int32_t index = m_map_script_pub_keys[script];\n+        if (index >= descriptor.next_index) {\n+            WalletLogPrintf(\"%s: Detected a used keypool item, mark all keypool items up to this item as used\\n\", __func__);\n+            descriptor.next_index = index + 1;\n+        }\n+        if (!TopUp()) {\n+            WalletLogPrintf(\"%s: Topping up keypool failed (locked wallet)\\n\", __func__);\n+        }\n+    }\n+}\n+\n+void DescriptorScriptPubKeyMan::AddDescriptorKey(const CKey& key, const CPubKey &pubkey)\n+{\n+    LOCK(cs_desc_man);\n+    WalletBatch batch(m_storage.GetDatabase());\n+    if (!AddDescriptorKeyWithDB(batch, key, pubkey)) {\n+        throw std::runtime_error(std::string(__func__) + \": writing descriptor private key failed\");\n+    }\n+}\n+\n+bool DescriptorScriptPubKeyMan::AddDescriptorKeyWithDB(WalletBatch& batch, const CKey& key, const CPubKey &pubkey)\n+{\n+    AssertLockHeld(cs_desc_man);\n+    assert(!m_storage.IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS));\n+\n+    if (m_storage.HasEncryptionKeys()) {\n+        if (m_storage.IsLocked()) {\n+            return false;\n+        }\n+\n+        std::vector<unsigned char> crypted_secret;\n+        CKeyingMaterial secret(key.begin(), key.end());\n+        if (!EncryptSecret(m_storage.GetEncryptionKey(), secret, pubkey.GetHash(), crypted_secret)) {\n+            return false;\n+        }\n+\n+        m_map_crypted_keys[pubkey.GetID()] = make_pair(pubkey, crypted_secret);\n+        batch.WriteCryptedDescriptorKey(GetID(), pubkey, crypted_secret);\n+        return true;\n+    } else {\n+        m_map_keys[pubkey.GetID()] = key;\n+        return batch.WriteDescriptorKey(GetID(), pubkey, key.GetPrivKey());\n+    }\n+}\n+\n+bool DescriptorScriptPubKeyMan::SetupDescriptorGeneration(const CExtKey& master_key)\n+{\n+    LOCK(cs_desc_man);\n+    assert(m_storage.IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS));\n+\n+    // Ignore when there is already a descriptor\n+    if (descriptor.descriptor) {\n+        return false;\n+    }\n+\n+    int64_t creation_time = GetTime();\n+\n+    CPubKey master_pubkey = master_key.key.GetPubKey();\n+    assert(master_key.key.VerifyPubKey(master_pubkey));\n+\n+    // Get the fingerprint\n+    CKeyID master_id = master_key.key.GetPubKey().GetID();\n+    std::string fingerprint = HexStr(master_id.begin(), master_id.begin() + 4);\n+\n+    // Add the seed to the wallet\n+    std::string desc_prefix;\n+    std::string desc_suffix = \"/*)\";\n+    CExtKey d1;\n+    switch (address_type) {\n+    case OutputType::LEGACY: {\n+        master_key.Derive(d1, BIP32_HARDENED_KEY_LIMIT + 44);\n+        desc_prefix = \"pkh([\" + fingerprint + \"/44'\";\n+        break;\n+    }\n+    case OutputType::P2SH_SEGWIT: {\n+        master_key.Derive(d1, BIP32_HARDENED_KEY_LIMIT + 49);\n+        desc_prefix = \"sh(wpkh([\" + fingerprint + \"/49'\";\n+        desc_suffix += \")\";\n+        break;\n+    }\n+    case OutputType::BECH32: {\n+        master_key.Derive(d1, BIP32_HARDENED_KEY_LIMIT + 84);\n+        desc_prefix = \"wpkh([\" + fingerprint + \"/84'\";\n+        break;\n+    }\n+    default: assert(false);\n+    }\n+\n+    // Mainnet derives at 0',testnet and regtest derive at 1'\n+    CExtKey d2;\n+    if (Params().IsTestChain()) {\n+        d1.Derive(d2, BIP32_HARDENED_KEY_LIMIT + 1);\n+        desc_prefix += \"/1'\";\n+    } else {\n+        d1.Derive(d2, BIP32_HARDENED_KEY_LIMIT + 0);\n+        desc_prefix += \"/0'\";\n+    }\n+    // 3rd level is always 0'\n+    CExtKey d3;\n+    d2.Derive(d3, BIP32_HARDENED_KEY_LIMIT + 0);\n+    std::string xpub = EncodeExtPubKey(d3.Neuter());\n+\n+    // Build descriptor string\n+    std::string internal_path = internal ? \"/1\" : \"/0\";\n+    std::string desc_str = desc_prefix + \"/0']\" + xpub + internal_path + desc_suffix;\n+\n+    // Make the descriptor\n+    FlatSigningProvider keys;\n+    std::string error;\n+    std::unique_ptr<Descriptor> desc = Parse(desc_str, keys, error, false);\n+    WalletDescriptor w_desc(std::move(desc), creation_time, 0, 0, 0);\n+    descriptor = w_desc;\n+\n+    // Store the master private key, derived intermediate key, and descriptor\n+    WalletBatch batch(m_storage.GetDatabase());\n+    if (!AddDescriptorKeyWithDB(batch, master_key.key, master_key.key.GetPubKey())) {\n+        throw std::runtime_error(std::string(__func__) + \": writing descriptor master rivate key failed\");\n+    }\n+    if (!AddDescriptorKeyWithDB(batch, d3.key, d3.key.GetPubKey())) {\n+        throw std::runtime_error(std::string(__func__) + \": writing descriptor intermediate private key failed\");\n+    }\n+    if (!batch.WriteDescriptor(GetID(), descriptor)) {\n+        throw std::runtime_error(std::string(__func__) + \": writing descriptor failed\");\n+    }\n+\n+    // TopUp\n+    TopUp();\n+\n+    m_storage.UnsetBlankWalletFlag(batch);\n+    return true;\n+}\n+\n+bool DescriptorScriptPubKeyMan::IsHDEnabled() const\n+{\n+    LOCK(cs_desc_man);\n+    return descriptor.descriptor->IsRange();\n+}\n+\n+bool DescriptorScriptPubKeyMan::CanGetAddresses(bool internal)\n+{\n+    LOCK(cs_desc_man);\n+    return HavePrivateKeys() || descriptor.next_index < descriptor.range_end;\n+}\n+\n+bool DescriptorScriptPubKeyMan::HavePrivateKeys() const\n+{\n+    LOCK(cs_desc_man);\n+    return m_map_keys.size() > 0 || m_map_crypted_keys.size() > 0;\n+}\n+\n+int64_t DescriptorScriptPubKeyMan::GetOldestKeyPoolTime()\n+{\n+    return 0;\n+}\n+\n+size_t DescriptorScriptPubKeyMan::KeypoolCountExternalKeys()\n+{\n+    if (internal) {\n+        return 0;\n+    }\n+    return GetKeyPoolSize();\n+}\n+\n+unsigned int DescriptorScriptPubKeyMan::GetKeyPoolSize() const\n+{\n+    LOCK(cs_desc_man);\n+    return descriptor.range_end - descriptor.next_index;\n+}\n+\n+int64_t DescriptorScriptPubKeyMan::GetTimeFirstKey() const\n+{\n+    LOCK(cs_desc_man);\n+    return descriptor.creation_time;\n+}\n+\n+std::unique_ptr<FlatSigningProvider> DescriptorScriptPubKeyMan::GetSigningProvider(const CScript& script, bool include_private) const\n+{\n+    LOCK(cs_desc_man);\n+\n+    // Find the index of the script\n+    auto it = m_map_script_pub_keys.find(script);\n+    if (it == m_map_script_pub_keys.end()) {\n+        return nullptr;\n+    }\n+    int32_t index = it->second;\n+\n+    // Get the scripts, keys, and key origins for this script\n+    std::unique_ptr<FlatSigningProvider> out_keys = MakeUnique<FlatSigningProvider>();\n+    std::vector<CScript> scripts_temp;\n+    if (!descriptor.descriptor->ExpandFromCache(index, descriptor.cache[index - descriptor.range_start], scripts_temp, *out_keys)) return nullptr;\n+\n+    if (include_private) {\n+        FlatSigningProvider master_provider;\n+        master_provider.keys = GetKeys();\n+        descriptor.descriptor->ExpandPrivate(index, master_provider, *out_keys);\n+    }\n+\n+    return std::move(out_keys);\n+}\n+\n+std::unique_ptr<SigningProvider> DescriptorScriptPubKeyMan::GetSolvingProvider(const CScript& script) const\n+{\n+    return GetSigningProvider(script, false);\n+}\n+\n+bool DescriptorScriptPubKeyMan::CanProvide(const CScript& script, SignatureData& sigdata)\n+{\n+    return IsMine(script);\n+}\n+\n+bool DescriptorScriptPubKeyMan::SignTransaction(CMutableTransaction& tx, const std::map<COutPoint, Coin>& coins, int sighash, std::map<int, std::string>& input_errors) const\n+{\n+    std::unique_ptr<FlatSigningProvider> keys = MakeUnique<FlatSigningProvider>();\n+    for (const auto& coin_pair : coins) {\n+        std::unique_ptr<FlatSigningProvider> coin_keys = std::move(GetSigningProvider(coin_pair.second.out.scriptPubKey, true));\n+        if (!coin_keys) {\n+            continue;\n+        }\n+        *keys = Merge(*keys, *coin_keys);\n+    }\n+\n+    return ::SignTransaction(tx, keys.get(), coins, sighash, input_errors);\n+}\n+\n+SigningResult DescriptorScriptPubKeyMan::SignMessage(const std::string& message, const PKHash& pkhash, std::string& str_sig) const\n+{\n+    std::unique_ptr<FlatSigningProvider> keys = std::move(GetSigningProvider(GetScriptForDestination(pkhash), true));\n+    if (!keys) {\n+        return SigningResult::PRIVATE_KEY_NOT_AVAILABLE;\n+    }\n+\n+    CKeyID key_id(pkhash);\n+    CKey key;\n+    if (!keys->GetKey(key_id, key)) {\n+        return SigningResult::PRIVATE_KEY_NOT_AVAILABLE;\n+    }\n+\n+    if (!MessageSign(key, message, str_sig)) {\n+        return SigningResult::SIGNING_FAILED;\n+    }\n+    return SigningResult::OK;\n+}\n+\n+TransactionError DescriptorScriptPubKeyMan::FillPSBT(PartiallySignedTransaction& psbtx, int sighash_type, bool sign, bool bip32derivs) const\n+{\n+    for (unsigned int i = 0; i < psbtx.tx->vin.size(); ++i) {\n+        const CTxIn& txin = psbtx.tx->vin[i];\n+        PSBTInput& input = psbtx.inputs.at(i);\n+\n+        if (PSBTInputSigned(input)) {\n+            continue;\n+        }\n+\n+        // Verify input looks sane. This will check that we have at most one uxto, witness or non-witness.\n+        if (!input.IsSane()) {\n+            return TransactionError::INVALID_PSBT;\n+        }\n+\n+        // Get the Sighash type\n+        if (sign && input.sighash_type > 0 && input.sighash_type != sighash_type) {\n+            return TransactionError::SIGHASH_MISMATCH;\n+        }\n+\n+        // Get the scriptPubKey to know which SigningProvider to use\n+        CScript script;\n+        if (!input.witness_utxo.IsNull()) {\n+            script = input.witness_utxo.scriptPubKey;\n+        } else if (input.non_witness_utxo) {\n+            if (txin.prevout.n >= input.non_witness_utxo->vout.size()) {\n+                return TransactionError::MISSING_INPUTS;\n+            }\n+            script = input.non_witness_utxo->vout[txin.prevout.n].scriptPubKey;\n+        } else {\n+            // There's no UTXO so we can just skip this now\n+            continue;\n+        }\n+        SignatureData sigdata;\n+        input.FillSignatureData(sigdata);\n+\n+        std::unique_ptr<FlatSigningProvider> keys = GetSigningProvider(script, true);\n+        if (!keys) {\n+            continue;\n+        }\n+\n+        SignPSBTInput(HidingSigningProvider(keys.get(), !sign, !bip32derivs), psbtx, i, sighash_type);\n+    }\n+\n+    // Fill in the bip32 keypaths and redeemscripts for the outputs so that hardware wallets can identify change\n+    for (unsigned int i = 0; i < psbtx.tx->vout.size(); ++i) {\n+        std::unique_ptr<FlatSigningProvider> keys = GetSigningProvider(psbtx.tx->vout.at(i).scriptPubKey, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r382704392",
      "id" : 382704392,
      "in_reply_to_id" : 381325869,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjcwNDM5Mg==",
      "original_commit_id" : "91d4efc84283743ef26e58526269731909286777",
      "original_position" : 621,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 362787031,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-21T17:16:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/382704392",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "We should make `IsChange` check for derivation path for descriptor wallets and not the ad-hoc \"is this address in my address book\", which we have to support for legacy wallets forever.\r\n\r\nedit: nevermind, not derivation path, just whether or not it's in `m_internal_spk_mans` or not",
      "created_at" : "2020-02-24T14:57:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-590362243",
      "id" : 590362243,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MDM2MjI0Mw==",
      "updated_at" : "2020-02-24T17:41:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/590362243",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2020-02-25T11:19:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-590817709",
      "id" : 590817709,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MDgxNzcwOQ==",
      "updated_at" : "2020-02-25T11:19:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/590817709",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've added #18204 into this now",
      "created_at" : "2020-02-27T01:46:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-591735331",
      "id" : 591735331,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MTczNTMzMQ==",
      "updated_at" : "2020-02-27T01:46:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/591735331",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Not exactly related but I got a crash due to an assert() failing when I create a native descriptor wallet with `avoid_reuse=true` (5th parameter)\r\n\r\n`./bitcoin-cli -testnet createwallet test_wallet true true \"\" true true`\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/652ffb49f1fdd9be804990e9e350fd8f647ceb81/src/wallet/wallet.cpp#L754",
      "created_at" : "2020-02-27T10:46:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-591904329",
      "id" : 591904329,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MTkwNDMyOQ==",
      "updated_at" : "2020-02-27T10:48:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/591904329",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4769925?v=4",
         "events_url" : "https://api.github.com/users/hugohn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hugohn/followers",
         "following_url" : "https://api.github.com/users/hugohn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hugohn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hugohn",
         "id" : 4769925,
         "login" : "hugohn",
         "node_id" : "MDQ6VXNlcjQ3Njk5MjU=",
         "organizations_url" : "https://api.github.com/users/hugohn/orgs",
         "received_events_url" : "https://api.github.com/users/hugohn/received_events",
         "repos_url" : "https://api.github.com/users/hugohn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hugohn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hugohn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hugohn"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Not exactly related but I got a crash due to an assert() failing when I create a native descriptor wallet with `avoid_reuse=true` (5th parameter)\r\n> \r\n> `./bitcoin-cli -testnet createwallet test_wallet true true \"\" true true`\r\n\r\nI can't replicate this.",
      "created_at" : "2020-02-27T19:40:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-592141441",
      "id" : 592141441,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MjE0MTQ0MQ==",
      "updated_at" : "2020-02-27T19:40:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592141441",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "hmm I synced to tip and now couldn't reproduce either...\r\n\r\nFWIW, it crashed after restarting `bitcoind` with `-testnet -wallet=test_wallet`, not when I created the wallet. Will report if reproducible.",
      "created_at" : "2020-02-28T04:14:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-592304787",
      "id" : 592304787,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MjMwNDc4Nw==",
      "updated_at" : "2020-02-28T04:14:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592304787",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4769925?v=4",
         "events_url" : "https://api.github.com/users/hugohn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hugohn/followers",
         "following_url" : "https://api.github.com/users/hugohn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hugohn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hugohn",
         "id" : 4769925,
         "login" : "hugohn",
         "node_id" : "MDQ6VXNlcjQ3Njk5MjU=",
         "organizations_url" : "https://api.github.com/users/hugohn/orgs",
         "received_events_url" : "https://api.github.com/users/hugohn/received_events",
         "repos_url" : "https://api.github.com/users/hugohn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hugohn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hugohn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hugohn"
      }
   }
]
