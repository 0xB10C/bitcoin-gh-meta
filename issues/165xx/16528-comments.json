[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18115 ([wallet] Pass in transactions and messages for signing instead of exporting the private keys by achow101)\n* #18034 (Get the OutputType for a descriptor by achow101)\n* #17877 (qt, refactor: Make enums in BitcoinUnits class scoped by hebasto)\n* #17681 (wallet: Keep inactive seeds after sethdseed and derive keys from them as needed by achow101)\n* #16710 (build: Enable -Wsuggest-override if available by hebasto)\n* #16440 (BIP-322: Generic signed message format by kallewoof)\n* #16432 (qt: Add privacy to the Overview page by hebasto)\n* #16365 (Log RPC parameters (arguments) if -debug=rpcparams by LarryRuane)\n* #16224 (gui: Bilingual GUI error messages by hebasto)\n* #11413 ([wallet] [rpc] sendtoaddress/sendmany: Add explicit feerate option by kallewoof)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-08-02T03:23:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-517532927",
      "id" : 517532927,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNzUzMjkyNw==",
      "updated_at" : "2020-02-11T22:35:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/517532927",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Strong Concept ACK, this should be much nicer now it is preceded by the rework.",
      "created_at" : "2019-08-02T03:25:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-517533269",
      "id" : 517533269,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNzUzMzI2OQ==",
      "updated_at" : "2019-08-02T03:25:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/517533269",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Approach ACK. It looks pretty straight forward and thanks to The Box feels cleaner than the previous attempt. \r\n\r\nI suggest that, after a bit more progress on #16341, we review this in parallel. That ensures that we don't mess up the division of labour between `ScriptPubKeyMan` and its subclasses.\r\n\r\nAlso concept ACK on using BIP44/49/84 for new descriptor wallets. That may need some discussion, because it means individual addresses are no longer hardened.\r\n\r\nSome issues I found perusing the commits:\r\n* when you restart bitcoind and load a (watch-only) wallet the keypool is empty and `getnewaddress` no longer works\r\n* `importdescriptors` should no longer require a `range` argument (~also I would prefer a singular RPC~ nvm that makes rescan slow)\r\n* when calling `getnewaddress` with an address type for which the wallet misses a descriptor, it returns a blank `error message:` \r\n* can you give each ScriptPubKeyManager it's own file?\r\n* deleting `GetMetadata` and `Upgrade` inside `Introduce WalletDescriptor`; should have its own commit?\r\n* `ScriptPubKeyMap` could be introduced in `Implement IsMine` instead of the earlier commit. Would it make sense to move this into the Descriptor class? How are infinite range descriptors handled, expanded and cached `keypoolsize` items at a time?\r\n* Am I reading this wrong or is `SetupGeneration` creating a fresh seed for each descriptor?\r\n* I'm not a fan of determining the output type in an indirect manner by expanding the descriptor `Optional<OutputType> out_script_type = DetermineOutputType(scripts_temp[0], out_keys);`; that information is already encoded in the descriptor. Shameless plug for #15590.",
      "created_at" : "2019-08-03T08:23:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-517905778",
      "id" : 517905778,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNzkwNTc3OA==",
      "updated_at" : "2019-08-03T09:40:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/517905778",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Concept ACK.\r\n\r\n@achow101 I just noticed that both the existing `deriveaddressses` & `importmulti` commands treat descriptor `[range_start, range_end]` as inclusive, which is consistent with the common understanding of the notation `[]`. Should we update the new `importdescriptors` command to do the same (make range_end inclusive)?\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/master/src/rpc/misc.cpp#L215\r\nhttps://github.com/bitcoin/bitcoin/blob/master/src/wallet/rpcdump.cpp#L1122",
      "created_at" : "2019-08-12T14:57:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-520460635",
      "id" : 520460635,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMDQ2MDYzNQ==",
      "updated_at" : "2019-08-12T14:59:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/520460635",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4769925?v=4",
         "events_url" : "https://api.github.com/users/hugohn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hugohn/followers",
         "following_url" : "https://api.github.com/users/hugohn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hugohn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hugohn",
         "id" : 4769925,
         "login" : "hugohn",
         "node_id" : "MDQ6VXNlcjQ3Njk5MjU=",
         "organizations_url" : "https://api.github.com/users/hugohn/orgs",
         "received_events_url" : "https://api.github.com/users/hugohn/received_events",
         "repos_url" : "https://api.github.com/users/hugohn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hugohn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hugohn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hugohn"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Should we update the new `importdescriptors` command to do the same (make range_end inclusive)?\r\n\r\nI guess so. Latest pushed should do that.",
      "created_at" : "2019-08-12T16:20:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-520494128",
      "id" : 520494128,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMDQ5NDEyOA==",
      "updated_at" : "2019-08-12T16:20:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/520494128",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Due to your latest change upstream, this now complains: `scriptpubkeyman.h:516:10: warning: 'CheckDecryptionKey' overrides a member function but is not marked 'override' `",
      "created_at" : "2019-10-10T16:50:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-540675668",
      "id" : 540675668,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0MDY3NTY2OA==",
      "updated_at" : "2019-10-10T16:50:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/540675668",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fixed the warning.",
      "created_at" : "2019-10-10T19:13:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-540736034",
      "id" : 540736034,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0MDczNjAzNA==",
      "updated_at" : "2019-10-10T19:13:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/540736034",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rescanning is broken for (some?) descriptor wallets, both when importing descriptors and when calling `rescanblockchain`. It does detect new transactions. Example:\r\n\r\n```\r\n# Drop coins on a random address in the default wallet\r\nbitcoin-cli -regtest -rpcwallet=\"\" generatetoaddress 101 `bitcoin-cli -regtest -rpcwallet=\"\" getnewaddress`\r\nsrc/bitcoin-cli -regtest createwallet T false true \"\" true true\r\nsrc/bitcoin-cli -regtest -rpcwallet=T importdescriptors '[{\"desc\": \"wpkh([00000001/84h/1h/0h]tprv8ZgxMBicQKsPd7Uf69XL1XwhmjHopUGep8GuEiJDZmbQz6o58LninorQAfcKZWARbtRtfnLcJ5MQ2AtHcQJCCRUcMRvmDUjyEmNUWwx8UbK/0/*)#slxu8rmv\", \"timestamp\": 0, \"range\": [0,1], \"internal\": false, \"active\": true}]'\r\nbitcoin-cli -regtest -rpcwallet=T getnewaddress\r\nbitcoin-cli -regtest -rpcwallet=T getaddressinfo bcrt1qm90ugl4d48jv8n6e5t9ln6t9zlpm5th68x4f8g\r\nsrc/bitcoin-cli -regtest -rpcwallet=\"\" sendtoaddress bcrt1qm90ugl4d48jv8n6e5t9ln6t9zlpm5th68x4f8g 1\r\nbitcoin-cli -regtest -rpcwallet=\"\" generatetoaddress 1 `bitcoin-cli -regtest -rpcwallet=\"\" getnewaddress`\r\nbitcoin-cli -regtest -rpcwallet=T listunspent 0 9999999 '[]' true\r\n```\r\n\r\nThe last command should show the UTXO.\r\n\r\nCreate another wallet and repeat the `importdescriptors` call. UTXO won't show up:\r\n\r\n```\r\nsrc/bitcoin-cli -regtest createwallet T2 false true \"\" true true\r\nsrc/bitcoin-cli -regtest -rpcwallet=T2 importdescriptors '[{\"desc\": \"wpkh([00000001/84h/1h/0h]tprv8ZgxMBicQKsPd7Uf69XL1XwhmjHopUGep8GuEiJDZmbQz6o58LninorQAfcKZWARbtRtfnLcJ5MQ2AtHcQJCCRUcMRvmDUjyEmNUWwx8UbK/0/*)#slxu8rmv\", \"timestamp\": 0, \"range\": [0,1], \"internal\": false, \"active\": true}]'\r\nbitcoin-cli -regtest -rpcwallet=T2 listunspent 0 9999999 '[]' true\r\n```\r\n\r\nWhen you send it new coins, those do show up.\r\n\r\nAlso note the address is incorrectly marked as `ischange` (but the derivation is correct). Might be unrelated though; the wallet determines IsChange() by checking if it's in the address book (yuck).\r\n\r\nUpdate: I can no longer reproduce this (d7ca9abe4b817913852abbd48082bde64df8e9d9)",
      "created_at" : "2019-11-05T11:18:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-549780152",
      "id" : 549780152,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0OTc4MDE1Mg==",
      "updated_at" : "2019-11-07T15:38:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/549780152",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I wrote a test to check `sortedmulti()` origins: https://github.com/Sjors/bitcoin/commit/04610844704aee8fb7cd6f94167a767f5473d281\r\n\r\nUnfortunately this test passes, so I can't reproduce the bug I was chasing just yet. I was seeing an origin-pubkey mismatch for sortedmulti() descriptors.\r\n\r\n_Update: fairly certain I was chasing a ghost. Hopefully the tests are useful._",
      "created_at" : "2020-01-20T18:53:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-576394411",
      "id" : 576394411,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NjM5NDQxMQ==",
      "updated_at" : "2020-01-21T19:05:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576394411",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I could not replicate any bugs with `sortedmulti` descriptors.",
      "created_at" : "2020-01-21T18:29:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-576816376",
      "id" : 576816376,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NjgxNjM3Ng==",
      "updated_at" : "2020-01-21T18:29:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576816376",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased onto master, now ready for review.",
      "created_at" : "2020-01-30T05:00:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-580083947",
      "id" : 580083947,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDA4Mzk0Nw==",
      "updated_at" : "2020-01-30T05:00:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580083947",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept and approach re-ACK\r\n\r\nI rebased my HWI support PRs on top of this:  #16546 (RPC) and #16549 (GUI).\r\n\r\nThe first commit could go to an independent PR:\r\n* `Output a descriptor in createmultisig`\r\n\r\nAnd a few that could be done before this PR, just to get the number of commits down a bit :-)\r\n* ~`Introduce SetType function to tell ScriptPubKeyMans the type and internal-ness of it`~ (empty for legacy)\r\n* `Change wallet_encryption.py to use signmessage instead of dumpprivkey`\r\n* d3819b681f766a17deef4650bd6297178924f04b  `Change GetMetadata to use unique_ptr<CKeyMetadata>`\r\n* c80e25d8743d7e5bfe866d32bf394cf55166bde5  `Add a function to determine the `OutputType` of a scriptPubKey` (`DetermineOutputType` should be contrasted to getting this information directly from the descriptor like in #15590)\r\n* 0fc666f32ff8472215e05e85dd609901a02dc3ae  `Add IsLegacy to CWallet so that the GUI knows whether to show watchonly`\r\n\r\nSome of my [earlier comments](https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-517905778) are still relevant:\r\n* I'm ambivalent about using BIP44/49/84 for new descriptor wallets. Downside is that individual addresses are no longer hardened. Upside is that this many other wallets use this standard and we could even consider BIP39 backup at some point (#17748). Perhaps `createwallet` (and the GUI) could make the use of BIP44/49/84 optional.\r\n* `importdescriptors` should no longer require a range argument\r\n* `importdescriptor` could be a singular RPC (less tedious when used manually). It could drop the `timestamp` argument in favor of just calling `rescanblockchain` after import.\r\n\r\nI think we should split `scriptpubkeyman.{h,cpp}` into `scriptpubkeyman.{h,cpp}` , `legacy_scriptpubkeyman.{h,cpp}`  and `descriptor_scriptpubkeyman.{h,cpp}` (although meh because it creates large diff, but maybe better to get it over with).",
      "created_at" : "2020-01-30T12:38:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-580233543",
      "id" : 580233543,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDIzMzU0Mw==",
      "updated_at" : "2020-01-30T14:26:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580233543",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r372959221"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372959221"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Whether it's P2SH depends on `address_type`, so maybe just say \"The descriptor for this multisig address\\\"",
      "commit_id" : "65eceb45c0e1320317c009393689307572f6a7ef",
      "created_at" : "2020-01-30T13:53:17Z",
      "diff_hunk" : "@@ -83,6 +83,7 @@ static UniValue createmultisig(const JSONRPCRequest& request)\n             \"{\\n\"\n             \"  \\\"address\\\":\\\"multisigaddress\\\",  (string) The value of the new multisig address.\\n\"\n             \"  \\\"redeemScript\\\":\\\"script\\\"       (string) The string value of the hex-encoded redemption script.\\n\"\n+            \"  \\\"descriptor\\\":\\\"descriptor\\\"     (string) The descriptor for the P2SH address for this multisig\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r372959221",
      "id" : 372959221,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk1OTIyMQ==",
      "original_commit_id" : "dd92677895de134c77b318cf7e27e2471a10842c",
      "original_position" : 4,
      "path" : "src/rpc/misc.cpp",
      "position" : null,
      "pull_request_review_id" : 350837022,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-11T19:35:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372959221",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r372983424"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372983424"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In  e40a833c3bffb0cf723357238eb809398e3e5237 `Create LegacyScriptPubKeyMan when not a descriptor wallet`: accidentally dropping `Upgrade()`?",
      "commit_id" : "65eceb45c0e1320317c009393689307572f6a7ef",
      "created_at" : "2020-01-30T14:34:32Z",
      "diff_hunk" : "@@ -1486,11 +1486,6 @@ bool DescriptorScriptPubKeyMan::CanGetAddresses(bool internal)\n     return false;\n }\n \n-bool DescriptorScriptPubKeyMan::Upgrade(int prev_version, std::string& error)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r372983424",
      "id" : 372983424,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk4MzQyNA==",
      "original_commit_id" : "e40a833c3bffb0cf723357238eb809398e3e5237",
      "original_position" : 4,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 350837022,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-11T19:35:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372983424",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r372985994"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372985994"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The new dummy class in 3f6cbc5bb16f8a021bbe88d998b12698205aaeac introduces several compiler problems (rebase slippage?), e.g:\r\n```\r\n./wallet/scriptpubkeyman.h:483:41: error: non-virtual member function marked 'override' hides virtual member function\r\n    void KeepDestination(int64_t index) override;\r\n```",
      "commit_id" : "65eceb45c0e1320317c009393689307572f6a7ef",
      "created_at" : "2020-01-30T14:38:58Z",
      "diff_hunk" : "@@ -467,4 +468,52 @@ class LegacySigningProvider : public SigningProvider\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override { return m_spk_man.GetKeyOrigin(keyid, info); }\n };\n \n+class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n+{\n+public:\n+    using ScriptPubKeyMan::ScriptPubKeyMan;\n+\n+    bool GetNewDestination(const OutputType type, CTxDestination& dest, std::string& error) override;\n+    isminetype IsMine(const CScript& script) const override;\n+\n+    bool CheckDecryptionKey(const CKeyingMaterial& master_key, bool accept_no_keys = false) override;\n+    bool Encrypt(const CKeyingMaterial& master_key, WalletBatch* batch) override;\n+\n+    bool GetReservedDestination(const OutputType type, bool internal, CTxDestination& address, int64_t& index, CKeyPool& keypool) override;\n+    void KeepDestination(int64_t index) override;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r372985994",
      "id" : 372985994,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk4NTk5NA==",
      "original_commit_id" : "3f6cbc5bb16f8a021bbe88d998b12698205aaeac",
      "original_position" : 24,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 350837022,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-11T19:35:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372985994",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373229817"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373229817"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Dropped the commit, but fixed in the separate PR for descriptors in `createmultisig`",
      "commit_id" : "65eceb45c0e1320317c009393689307572f6a7ef",
      "created_at" : "2020-01-30T22:32:23Z",
      "diff_hunk" : "@@ -83,6 +83,7 @@ static UniValue createmultisig(const JSONRPCRequest& request)\n             \"{\\n\"\n             \"  \\\"address\\\":\\\"multisigaddress\\\",  (string) The value of the new multisig address.\\n\"\n             \"  \\\"redeemScript\\\":\\\"script\\\"       (string) The string value of the hex-encoded redemption script.\\n\"\n+            \"  \\\"descriptor\\\":\\\"descriptor\\\"     (string) The descriptor for the P2SH address for this multisig\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373229817",
      "id" : 373229817,
      "in_reply_to_id" : 372959221,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIyOTgxNw==",
      "original_commit_id" : "dd92677895de134c77b318cf7e27e2471a10842c",
      "original_position" : 4,
      "path" : "src/rpc/misc.cpp",
      "position" : null,
      "pull_request_review_id" : 351188746,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-11T19:35:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373229817",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373229896"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373229896"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It should be dropped, but not in that commit. Moved it to the dummy class definition.",
      "commit_id" : "65eceb45c0e1320317c009393689307572f6a7ef",
      "created_at" : "2020-01-30T22:32:38Z",
      "diff_hunk" : "@@ -1486,11 +1486,6 @@ bool DescriptorScriptPubKeyMan::CanGetAddresses(bool internal)\n     return false;\n }\n \n-bool DescriptorScriptPubKeyMan::Upgrade(int prev_version, std::string& error)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373229896",
      "id" : 373229896,
      "in_reply_to_id" : 372983424,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIyOTg5Ng==",
      "original_commit_id" : "e40a833c3bffb0cf723357238eb809398e3e5237",
      "original_position" : 4,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 351188848,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-11T19:35:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373229896",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373230082"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373230082"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since this gets dropped later, dropped this at the dummy class definition.",
      "commit_id" : "65eceb45c0e1320317c009393689307572f6a7ef",
      "created_at" : "2020-01-30T22:33:04Z",
      "diff_hunk" : "@@ -467,4 +468,52 @@ class LegacySigningProvider : public SigningProvider\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override { return m_spk_man.GetKeyOrigin(keyid, info); }\n };\n \n+class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n+{\n+public:\n+    using ScriptPubKeyMan::ScriptPubKeyMan;\n+\n+    bool GetNewDestination(const OutputType type, CTxDestination& dest, std::string& error) override;\n+    isminetype IsMine(const CScript& script) const override;\n+\n+    bool CheckDecryptionKey(const CKeyingMaterial& master_key, bool accept_no_keys = false) override;\n+    bool Encrypt(const CKeyingMaterial& master_key, WalletBatch* batch) override;\n+\n+    bool GetReservedDestination(const OutputType type, bool internal, CTxDestination& address, int64_t& index, CKeyPool& keypool) override;\n+    void KeepDestination(int64_t index) override;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373230082",
      "id" : 373230082,
      "in_reply_to_id" : 372985994,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIzMDA4Mg==",
      "original_commit_id" : "3f6cbc5bb16f8a021bbe88d998b12698205aaeac",
      "original_position" : 24,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 351189052,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-11T19:35:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373230082",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Moved `Output a descriptor in createmultisig` to it's own PR and dropped it from here since it isn't actually used in descriptor wallets.\r\n\r\nI will investigate breaking out the other commits.\r\n\r\n>     * I'm ambivalent about using BIP44/49/84 for new descriptor wallets. Downside is that individual addresses are no longer hardened. Upside is that this many other wallets use this standard and we could even consider BIP39 backup at some point (#17748). Perhaps `createwallet` (and the GUI) could make the use of BIP44/49/84 optional.\r\n\r\nAFAICT, the reasoning for using exclusively hardened derivation is because we could export private keys with `dumpprivkey` and that has issues. But since that is disabled for descriptor wallets, I think it's fine.\r\n\r\n>     * `importdescriptors` should no longer require a range argument\r\n\r\nWhy?\r\n\r\n>     * `importdescriptor` could be a singular RPC (less tedious when used manually). It could drop the `timestamp` argument in favor of just calling `rescanblockchain` after import.\r\n\r\nI suppose, but I don't really want there to be multiple commands that do fundamentally the same thing.\r\n\r\n> I think we should split `scriptpubkeyman.{h,cpp}` into `scriptpubkeyman.{h,cpp}` , `legacy_scriptpubkeyman.{h,cpp}` and `descriptor_scriptpubkeyman.{h,cpp}` (although meh because it creates large diff, but maybe better to get it over with).\r\n\r\nMeh.",
      "created_at" : "2020-01-30T22:34:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-580494041",
      "id" : 580494041,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDQ5NDA0MQ==",
      "updated_at" : "2020-01-30T22:40:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580494041",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Descriptors can be expanded indefinitely, so why specify a (mandatory) range on import? It might make sense as an optional field to set a boundary, e.g. if you know the external signing device has a range limit.\r\n\r\n> AFAICT, the reasoning for using exclusively hardened derivation is because we could export private keys with dumpprivkey and that has issues. But since that is disabled for descriptor wallets, I think it's fine.\r\n\r\nI'm not familiar with the history. Another reason could be that if one private key is compromised in a side-channel attack, the other keys are still safe. But that assumes such a side-channel attack, couldn't also compromise the master key. Or perhaps a (horrible) bug in the signing code causes a private key to leak on chain. Or someone wants to reenable `dumpprivkey` again to redeem some fork coin. Using `m/{0,1,2}'/{0,1}'/k` by default and making BIP44/49/84 opt-in (in a followup) seems less of change from status quo.\r\n\r\n> I don't really want there to be multiple commands that do fundamentally the same thing.\r\n\r\nDo you mean having similar commands (`importmulti` and `importdescriptors`) with different options? I like consistency, as do developers who want a simple path to switch their integration over to descriptor wallets. But I also like the rare opportunity to clean up the RPC. And when people have to copy-paste some magic to import keys from a hardware wallet, this new syntax looks less intimidating. Though ideally that shouldn't be needed at all.  \r\n\r\n\r\nThe [AppVeyor failure](https://ci.appveyor.com/project/DrahtBot/bitcoin/builds/30473125#L4131) might be legit `wallet_importdescriptors.py` encounters `JSONRPCException: bad-txns-inputs-missingorspent (-25)`, albeit odd.\r\n\r\nIn f83fde4e8e13a254083e9433dfa770a8b52b1053 `Create LegacyScriptPubKeyMan when not a descriptor wallet` you're also introducing `class WalletDescriptor`; that was supposed to be a separate commit?\r\n\r\nYou're serialising the descriptor as a string (in `WalletDescriptor`). That's fine with me, I'd rather not delay this work, and we can change the serialisation later. However there's been some [mailinglist discussion](https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2019-December/017529.html) about serialising descriptors into something that's easier to copy/paste and put in a QR code. Maybe that's worth working out in a separate PR and then to use that for the wallet as well. Added a an issue for it #18043.",
      "created_at" : "2020-01-31T10:35:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-580679648",
      "id" : 580679648,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDY3OTY0OA==",
      "updated_at" : "2020-01-31T16:25:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580679648",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373572192"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373572192"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In ee6980be437c09df6044a5ced7caa91410453027 `Introduce DescriptorScriptPubKeyMan as a dummy class`: this line (`using ScriptPubKeyMan::ScriptPubKeyMan;`) is dropped in 7af1a569567a595dc26c33075632f406c4ff0904.",
      "commit_id" : "65eceb45c0e1320317c009393689307572f6a7ef",
      "created_at" : "2020-01-31T16:36:24Z",
      "diff_hunk" : "@@ -467,4 +468,49 @@ class LegacySigningProvider : public SigningProvider\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override { return m_spk_man.GetKeyOrigin(keyid, info); }\n };\n \n+class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n+{\n+public:\n+    using ScriptPubKeyMan::ScriptPubKeyMan;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373572192",
      "id" : 373572192,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU3MjE5Mg==",
      "original_commit_id" : "ee6980be437c09df6044a5ced7caa91410453027",
      "original_position" : 15,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 351628547,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-11T19:35:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373572192",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373574359"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373574359"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: these are added, but not used, in 7af1a569567a595dc26c33075632f406c4ff0904 `Store WalletDescriptor in DescriptorScriptPubKeyMan` which seems out of the blue. b784a150b23e10ee794d1d2616a0df5c0f317fef seems a better place.",
      "commit_id" : "65eceb45c0e1320317c009393689307572f6a7ef",
      "created_at" : "2020-01-31T16:40:55Z",
      "diff_hunk" : "@@ -60,8 +60,10 @@ extern const std::string CRYPTED_KEY;\n extern const std::string CSCRIPT;\n extern const std::string DEFAULTKEY;\n extern const std::string DESTDATA;\n+extern const std::string EXTERNALSPK;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373574359",
      "id" : 373574359,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU3NDM1OQ==",
      "original_commit_id" : "7af1a569567a595dc26c33075632f406c4ff0904",
      "original_position" : 4,
      "path" : "src/wallet/walletdb.h",
      "position" : 12,
      "pull_request_review_id" : 351628547,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-11T19:35:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373574359",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373579192"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373579192"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 7af1a569567a595dc26c33075632f406c4ff0904: `ScriptPubKeyMap`'s `uint32_t` changes to `int32_t` in e7e62209a176a00a03657e6fe8fd221bf2821bf5",
      "commit_id" : "65eceb45c0e1320317c009393689307572f6a7ef",
      "created_at" : "2020-01-31T16:50:47Z",
      "diff_hunk" : "@@ -470,8 +470,17 @@ class LegacySigningProvider : public SigningProvider\n \n class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n {\n+private:\n+    WalletDescriptor descriptor GUARDED_BY(cs_desc_man);\n+\n+    using ScriptPubKeyMap = std::map<CScript, uint32_t>; // Map of scripts to descriptor range index",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373579192",
      "id" : 373579192,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU3OTE5Mg==",
      "original_commit_id" : "7af1a569567a595dc26c33075632f406c4ff0904",
      "original_position" : 7,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 351628547,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-11T19:35:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373579192",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373612485"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373612485"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ee6980be437c09df6044a5ced7caa91410453027:  `void RewriteDB() override;` is dropped in fd995af379b73b63b78b276b5b8f31d39b2d2b67",
      "commit_id" : "65eceb45c0e1320317c009393689307572f6a7ef",
      "created_at" : "2020-01-31T18:09:19Z",
      "diff_hunk" : "@@ -467,4 +468,49 @@ class LegacySigningProvider : public SigningProvider\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override { return m_spk_man.GetKeyOrigin(keyid, info); }\n };\n \n+class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n+{\n+public:\n+    using ScriptPubKeyMan::ScriptPubKeyMan;\n+\n+    bool GetNewDestination(const OutputType type, CTxDestination& dest, std::string& error) override;\n+    isminetype IsMine(const CScript& script) const override;\n+\n+    bool CheckDecryptionKey(const CKeyingMaterial& master_key, bool accept_no_keys = false) override;\n+    bool Encrypt(const CKeyingMaterial& master_key, WalletBatch* batch) override;\n+\n+    bool GetReservedDestination(const OutputType type, bool internal, CTxDestination& address, int64_t& index, CKeyPool& keypool) override;\n+    void ReturnDestination(int64_t index, bool internal, const CTxDestination& addr) override;\n+\n+    bool TopUp(unsigned int size = 0) override;\n+\n+    void MarkUnusedAddresses(const CScript& script) override;\n+\n+    bool IsHDEnabled() const override;\n+\n+    bool SetupGeneration(bool force = false) override;\n+\n+    bool HavePrivateKeys() const override;\n+\n+    void RewriteDB() override;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r373612485",
      "id" : 373612485,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYxMjQ4NQ==",
      "original_commit_id" : "ee6980be437c09df6044a5ced7caa91410453027",
      "original_position" : 36,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 351628547,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-11T19:35:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373612485",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Related 31 January wallet meeting discussion:\r\nhttp://www.erisian.com.au/meetbot/bitcoin-core-dev/2020/bitcoin-core-dev.2020-01-31-19.00.log.html",
      "created_at" : "2020-01-31T19:59:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-580888293",
      "id" : 580888293,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDg4ODI5Mw==",
      "updated_at" : "2020-01-31T19:59:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580888293",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2020-02-04T21:08:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-582115685",
      "id" : 582115685,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MjExNTY4NQ==",
      "updated_at" : "2020-02-04T21:08:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582115685",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r377827327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377827327"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's intentional. The `using ScriptPubKeyMan::ScriptPubKeyMan;` is needed to use the default `ScriptPubKeyMan` constructor until we add a custom one for `DescriptorScriptPubKeyMan`.",
      "commit_id" : "65eceb45c0e1320317c009393689307572f6a7ef",
      "created_at" : "2020-02-11T18:47:09Z",
      "diff_hunk" : "@@ -467,4 +468,49 @@ class LegacySigningProvider : public SigningProvider\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override { return m_spk_man.GetKeyOrigin(keyid, info); }\n };\n \n+class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n+{\n+public:\n+    using ScriptPubKeyMan::ScriptPubKeyMan;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r377827327",
      "id" : 377827327,
      "in_reply_to_id" : 373572192,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgyNzMyNw==",
      "original_commit_id" : "ee6980be437c09df6044a5ced7caa91410453027",
      "original_position" : 15,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 356903809,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-11T19:35:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377827327",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r377853944"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377853944"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Moved",
      "commit_id" : "65eceb45c0e1320317c009393689307572f6a7ef",
      "created_at" : "2020-02-11T19:35:49Z",
      "diff_hunk" : "@@ -60,8 +60,10 @@ extern const std::string CRYPTED_KEY;\n extern const std::string CSCRIPT;\n extern const std::string DEFAULTKEY;\n extern const std::string DESTDATA;\n+extern const std::string EXTERNALSPK;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r377853944",
      "id" : 377853944,
      "in_reply_to_id" : 373574359,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg1Mzk0NA==",
      "original_commit_id" : "7af1a569567a595dc26c33075632f406c4ff0904",
      "original_position" : 4,
      "path" : "src/wallet/walletdb.h",
      "position" : 12,
      "pull_request_review_id" : 356937290,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-11T19:35:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377853944",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r377854006"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377854006"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed",
      "commit_id" : "65eceb45c0e1320317c009393689307572f6a7ef",
      "created_at" : "2020-02-11T19:35:55Z",
      "diff_hunk" : "@@ -470,8 +470,17 @@ class LegacySigningProvider : public SigningProvider\n \n class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n {\n+private:\n+    WalletDescriptor descriptor GUARDED_BY(cs_desc_man);\n+\n+    using ScriptPubKeyMap = std::map<CScript, uint32_t>; // Map of scripts to descriptor range index",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r377854006",
      "id" : 377854006,
      "in_reply_to_id" : 373579192,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg1NDAwNg==",
      "original_commit_id" : "7af1a569567a595dc26c33075632f406c4ff0904",
      "original_position" : 7,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 356937361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-11T19:35:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377854006",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r377854045"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377854045"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Dropped",
      "commit_id" : "65eceb45c0e1320317c009393689307572f6a7ef",
      "created_at" : "2020-02-11T19:36:00Z",
      "diff_hunk" : "@@ -467,4 +468,49 @@ class LegacySigningProvider : public SigningProvider\n     bool GetKeyOrigin(const CKeyID& keyid, KeyOriginInfo& info) const override { return m_spk_man.GetKeyOrigin(keyid, info); }\n };\n \n+class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n+{\n+public:\n+    using ScriptPubKeyMan::ScriptPubKeyMan;\n+\n+    bool GetNewDestination(const OutputType type, CTxDestination& dest, std::string& error) override;\n+    isminetype IsMine(const CScript& script) const override;\n+\n+    bool CheckDecryptionKey(const CKeyingMaterial& master_key, bool accept_no_keys = false) override;\n+    bool Encrypt(const CKeyingMaterial& master_key, WalletBatch* batch) override;\n+\n+    bool GetReservedDestination(const OutputType type, bool internal, CTxDestination& address, int64_t& index, CKeyPool& keypool) override;\n+    void ReturnDestination(int64_t index, bool internal, const CTxDestination& addr) override;\n+\n+    bool TopUp(unsigned int size = 0) override;\n+\n+    void MarkUnusedAddresses(const CScript& script) override;\n+\n+    bool IsHDEnabled() const override;\n+\n+    bool SetupGeneration(bool force = false) override;\n+\n+    bool HavePrivateKeys() const override;\n+\n+    void RewriteDB() override;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#discussion_r377854045",
      "id" : 377854045,
      "in_reply_to_id" : 373612485,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg1NDA0NQ==",
      "original_commit_id" : "ee6980be437c09df6044a5ced7caa91410453027",
      "original_position" : 36,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 356937407,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16528",
      "updated_at" : "2020-02-11T19:36:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377854045",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've rebased this on top of #18115 and #18034. I'll start addressing other issues tomorrow.\r\n\r\nI believe I've fixed the random failure of `wallet_importdescriptors.py` as well.",
      "created_at" : "2020-02-12T00:37:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16528#issuecomment-584946241",
      "id" : 584946241,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16528",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NDk0NjI0MQ==",
      "updated_at" : "2020-02-12T00:37:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/584946241",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
