[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16489](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16489.html) (log: harmonize bitcoind logging by jonatack)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-08-04T07:43:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16544#issuecomment-517981643",
      "id" : 517981643,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16544",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNzk4MTY0Mw==",
      "updated_at" : "2019-08-04T07:43:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/517981643",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16544#discussion_r310375536"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16544"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310375536"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could you follow [Coding Style (C++)](https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#coding-style-c)?",
      "commit_id" : "514faf30a249216d5fa42dc169ca140e498f667d",
      "created_at" : "2019-08-04T08:03:17Z",
      "diff_hunk" : "@@ -169,11 +170,39 @@ UniValue stop(const JSONRPCRequest& jsonRequest)\n             }.ToString());\n     // Event loop will exit after current HTTP requests have been handled, so\n     // this reply will get back to the client.\n-    StartShutdown();\n-    if (jsonRequest.params[0].isNum()) {\n-        MilliSleep(jsonRequest.params[0].get_int());\n+    if(rpcallowstop)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16544#discussion_r310375536",
      "id" : 310375536,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMDM3NTUzNg==",
      "original_commit_id" : "514faf30a249216d5fa42dc169ca140e498f667d",
      "original_position" : 15,
      "path" : "src/rpc/server.cpp",
      "position" : 15,
      "pull_request_review_id" : 270485884,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16544",
      "updated_at" : "2019-08-04T08:03:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310375536",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16544#discussion_r310379805"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16544"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310379805"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This block is redundant with the one at L174 and could be extracted.",
      "commit_id" : "514faf30a249216d5fa42dc169ca140e498f667d",
      "created_at" : "2019-08-04T10:02:11Z",
      "diff_hunk" : "@@ -169,11 +170,39 @@ UniValue stop(const JSONRPCRequest& jsonRequest)\n             }.ToString());\n     // Event loop will exit after current HTTP requests have been handled, so\n     // this reply will get back to the client.\n-    StartShutdown();\n-    if (jsonRequest.params[0].isNum()) {\n-        MilliSleep(jsonRequest.params[0].get_int());\n+    if(rpcallowstop)\n+    {\n+        StartShutdown();\n+        if (jsonRequest.params[0].isNum()) {\n+            MilliSleep(jsonRequest.params[0].get_int());\n+        }\n+        return \"Bitcoin server stopping\";\n+    }\n+    else\n+    {\n+        // Check if IP is 127.0.0.1\n+        std::string ip;\n+        for(int i = 0; i < jsonRequest.peerAddr.length(); i++)\n+        {\n+            if(jsonRequest.peerAddr[i] == ':')\n+            {\n+                break;\n+            }\n+            ip += jsonRequest.peerAddr[i];\n+        }\n+        if(ip == \"127.0.0.1\")\n+        {\n+            StartShutdown();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16544#discussion_r310379805",
      "id" : 310379805,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMDM3OTgwNQ==",
      "original_commit_id" : "514faf30a249216d5fa42dc169ca140e498f667d",
      "original_position" : 37,
      "path" : "src/rpc/server.cpp",
      "position" : 37,
      "pull_request_review_id" : 270490023,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16544",
      "updated_at" : "2019-08-04T10:08:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310379805",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16544#discussion_r310380006"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16544"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310380006"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Suggest: \"Accept shutdown (stop) commands from remote RPC clients.\"",
      "commit_id" : "514faf30a249216d5fa42dc169ca140e498f667d",
      "created_at" : "2019-08-04T10:07:14Z",
      "diff_hunk" : "@@ -517,6 +517,7 @@ void SetupServerArgs()\n \n     gArgs.AddArg(\"-rest\", strprintf(\"Accept public REST requests (default: %u)\", DEFAULT_REST_ENABLE), ArgsManager::ALLOW_ANY, OptionsCategory::RPC);\n     gArgs.AddArg(\"-rpcallowip=<ip>\", \"Allow JSON-RPC connections from specified source. Valid for <ip> are a single IP (e.g. 1.2.3.4), a network/netmask (e.g. 1.2.3.4/255.255.255.0) or a network/CIDR (e.g. 1.2.3.4/24). This option can be specified multiple times\", ArgsManager::ALLOW_ANY, OptionsCategory::RPC);\n+    gArgs.AddArg(\"-rpcallowstop\", \"Allow stop over a remote RPC client\", ArgsManager::ALLOW_ANY, OptionsCategory::RPC);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16544#discussion_r310380006",
      "id" : 310380006,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMDM4MDAwNg==",
      "original_commit_id" : "514faf30a249216d5fa42dc169ca140e498f667d",
      "original_position" : 4,
      "path" : "src/init.cpp",
      "position" : 4,
      "pull_request_review_id" : 270490023,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16544",
      "updated_at" : "2019-08-04T10:08:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310380006",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
