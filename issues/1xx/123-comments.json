[
   {
      "body" : "I haven't reviewed the code thoroughly, but it looks reasonable.\r\n\r\nIn order to ease future changes to the wallet format, how about adding a key/value pair into the wallet indicating its data format version number?",
      "created_at" : "2011-03-20T23:51:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/123#issuecomment-896691",
      "id" : 896691,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/123",
      "updated_at" : "2011-03-20T23:51:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896691",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/653590?v=3",
         "events_url" : "https://api.github.com/users/jhyslop/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jhyslop/followers",
         "following_url" : "https://api.github.com/users/jhyslop/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jhyslop/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jhyslop",
         "id" : 653590,
         "login" : "jhyslop",
         "organizations_url" : "https://api.github.com/users/jhyslop/orgs",
         "received_events_url" : "https://api.github.com/users/jhyslop/received_events",
         "repos_url" : "https://api.github.com/users/jhyslop/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jhyslop/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jhyslop/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jhyslop"
      }
   },
   {
      "body" : "That's certainly a possibility, which may be useful in the future, but it's not really necessary now. The old format used a dedicated byte for specifying spentness, while the new code uses a key-value entry (using the dedicated byte if not present) and keeps the spent-byte updated as well.",
      "created_at" : "2011-03-20T23:59:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/123#issuecomment-896714",
      "id" : 896714,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/123",
      "updated_at" : "2011-03-20T23:59:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896714",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Well, I mildly disagree that it's not necessary now. The time to implement versioning is now, before it's needed, so that when it is needed clients will have the version-checking code in place. But on reflection, that's what the nVersion parameter to the Serialize family of functions is for, isn't it?",
      "created_at" : "2011-03-21T00:15:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/123#issuecomment-896757",
      "id" : 896757,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/123",
      "updated_at" : "2011-03-21T00:15:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896757",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/653590?v=3",
         "events_url" : "https://api.github.com/users/jhyslop/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jhyslop/followers",
         "following_url" : "https://api.github.com/users/jhyslop/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jhyslop/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jhyslop",
         "id" : 653590,
         "login" : "jhyslop",
         "organizations_url" : "https://api.github.com/users/jhyslop/orgs",
         "received_events_url" : "https://api.github.com/users/jhyslop/received_events",
         "repos_url" : "https://api.github.com/users/jhyslop/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jhyslop/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jhyslop/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jhyslop"
      }
   },
   {
      "body" : "Don't get me wrong - I merely mean that for this particular issue there shouldn't be a problem.",
      "created_at" : "2011-03-21T00:53:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/123#issuecomment-896839",
      "id" : 896839,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/123",
      "updated_at" : "2011-03-21T00:53:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896839",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I pulled this and ran it against a testnet-in-a-box, and there's something seriously wrong-- look at this getinfo output:\n{\n    \"version\" : 32100,\n    \"balance\" : 103514.73287496,\n    \"blocks\" : 1479,\n    \"connections\" : 1,\n    \"proxy\" : \"\",\n    \"generate\" : false,\n    \"genproclimit\" : 3,\n    \"difficulty\" : 1.00000000,\n    \"hashespersec\" : 0,\n    \"testnet\" : true,\n    \"keypoololdest\" : 1302017341,\n    \"paytxfee\" : 0.00000000,\n    \"errors\" : \"\"\n}\n\nbalance is greater than 50*blocks, which should be impossible!\n\nI uploaded the pre-conversion -testnet wallet and block index to: \n   http://www.skypaint.com/bitcoin/spentpertxout.zip\n\n",
      "created_at" : "2011-04-06T02:06:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/123#issuecomment-962237",
      "id" : 962237,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/123",
      "updated_at" : "2011-04-06T02:20:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/962237",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "Sounds like you have a lot of (used) high-value transactions whose output is yourself, but are for some reason not marked spent. I'm not sure how that is possible but I'll check the wallet in that zip file.",
      "created_at" : "2011-04-06T15:21:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/123#issuecomment-964462",
      "id" : 964462,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/123",
      "updated_at" : "2011-04-06T15:21:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/964462",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "FYI:  Wallet is from a 3-node \"testnet-in-a-box\" that I ran a bunch of ClearCoin escrow unit tests against.  Typical use was  Sending wallet -> escrow wallet -> receiver wallet, then between tests send coins from receiver wallet back to sending wallet.  Sending wallet is the one I posted.\r\n\r\nI haven't tried the much simpler test of just taking a testnet-in-a-box wallet and running it against your patch; that might be a good place to start (see if balance is correct to start).\r\n\r\n",
      "created_at" : "2011-04-06T20:49:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/123#issuecomment-966022",
      "id" : 966022,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/123",
      "updated_at" : "2011-04-06T20:49:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/966022",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "I tried running a testnet-in-a-box with your wallet and block database, but everything runs fine here. Could you post your corrupted wallet/blockdb as well?\r\n",
      "created_at" : "2011-04-12T09:35:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/123#issuecomment-988541",
      "id" : 988541,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/123",
      "updated_at" : "2011-04-12T09:35:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/988541",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I just tried again after cloning and compling directly from your git branch and got similar results.  Bad \"after\" wallet is at:  http://www.skypaint.com/bitcoin/spentpertxout_after.zip\n\n(this one is the entire datadir in a directory called 'd')",
      "created_at" : "2011-04-12T12:43:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/123#issuecomment-989238",
      "id" : 989238,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/123",
      "updated_at" : "2011-04-12T12:46:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989238",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "Interesting, though:  balance is different from first time I tried:\r\n\r\n  {\r\n    \"version\" : 32100,\r\n    \"balance\" : 60605705932.90255737,\r\n    \"blocks\" : 1455,\r\n    \"connections\" : 0,\r\n    \"proxy\" : \"\",\r\n    \"generate\" : false,\r\n    \"genproclimit\" : 3,\r\n    \"difficulty\" : 1.00000000,\r\n    \"hashespersec\" : 0,\r\n    \"testnet\" : true,\r\n    \"keypoololdest\" : 1301969525,\r\n    \"paytxfee\" : 0.00000000,\r\n    \"errors\" : \"\"\r\n  }\r\n",
      "created_at" : "2011-04-12T12:44:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/123#issuecomment-989241",
      "id" : 989241,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/123",
      "updated_at" : "2011-04-12T12:44:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989241",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "Bug fixed - fAvailableCreditCached was not initialized, causing arbitrary reported numbers on some systems",
      "created_at" : "2011-04-12T17:13:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/123#issuecomment-990743",
      "id" : 990743,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/123",
      "updated_at" : "2011-04-12T17:13:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990743",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
