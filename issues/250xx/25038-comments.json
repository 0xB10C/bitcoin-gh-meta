[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24836](https://github.com/bitcoin/bitcoin/pull/24836) (add RPC (-regtest only) for testing package policy by glozow)\n* [#24007](https://github.com/bitcoin/bitcoin/pull/24007) ([mempool] allow tx replacement by smaller witness by LarryRuane)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-04-30T04:17:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1113911849",
      "id" : 1113911849,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585CZPIp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113911849/reactions"
      },
      "updated_at" : "2022-05-31T09:35:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113911849",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "```\r\n$ ./test/lint/lint-python.py\r\ntest/functional/feature_package_rbf.py:18:1: F401 'test_framework.util.assert_equal' imported but unused\r\n```\r\n",
      "created_at" : "2022-05-03T14:21:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1116158353",
      "id" : 1116158353,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585ChzmR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1116158353/reactions"
      },
      "updated_at" : "2022-05-03T14:21:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1116158353",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "$ ./test/lint/lint-python.py\r\ntest/functional/feature_package_rbf.py:18:1: F401 'test_framework.util.assert_equal' imported but unused",
      "created_at" : "2022-05-09T02:50:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1120581194",
      "id" : 1120581194,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585CyrZK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1120581194/reactions"
      },
      "updated_at" : "2022-05-09T02:50:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1120581194",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/101321365?v=4",
         "events_url" : "https://api.github.com/users/ramsemune123/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ramsemune123/followers",
         "following_url" : "https://api.github.com/users/ramsemune123/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ramsemune123/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ramsemune123",
         "id" : 101321365,
         "login" : "ramsemune123",
         "node_id" : "U_kgDOBgoKlQ",
         "organizations_url" : "https://api.github.com/users/ramsemune123/orgs",
         "received_events_url" : "https://api.github.com/users/ramsemune123/received_events",
         "repos_url" : "https://api.github.com/users/ramsemune123/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ramsemune123/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ramsemune123/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ramsemune123"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868430869"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868430869"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Reason to not turn `PackageTestAccept` as `true` too ?",
      "commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "created_at" : "2022-05-09T20:34:11Z",
      "diff_hunk" : "@@ -502,7 +505,7 @@ class MemPoolAccept\n                             /* m_bypass_limits */ false,\n                             /* m_coins_to_uncache */ coins_to_uncache,\n                             /* m_test_accept */ false,\n-                            /* m_allow_bip125_replacement */ false,\n+                            /* m_allow_bip125_replacement */ true,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868430869",
      "id" : 868430869,
      "line" : 508,
      "node_id" : "PRRC_kwDOABII584zwzQV",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 508,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 15,
      "pull_request_review_id" : 966801973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868430869/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T22:25:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868430869",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868495787"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868495787"
         }
      },
      "author_association" : "MEMBER",
      "body" : "IIUC given that `PackageMempoolChecks` happens after package dedup there should not be remaining already-in-mempool transactions at that stage in `txns` ? So no descendants that could be `to-be-replaced mempool entries` to subtract or are you thinking to something else ? ",
      "commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "created_at" : "2022-05-09T21:42:14Z",
      "diff_hunk" : "@@ -975,13 +1006,89 @@ bool MemPoolAccept::PackageMempoolChecks(const std::vector<CTransactionRef>& txn\n     assert(std::all_of(txns.cbegin(), txns.cend(), [this](const auto& tx)\n                        { return !m_pool.exists(GenTxid::Txid(tx->GetHash()));}));\n \n+    // Populate with the union of all transactions' ancestors.\n+    CTxMemPool::setEntries m_collective_ancestors;\n+    for (const auto& ws : workspaces) {\n+        for (const auto& it : ws.m_ancestors) m_collective_ancestors.insert(it);\n+    }\n+\n     std::string err_string;\n     if (!m_pool.CheckPackageLimits(txns, m_limit_ancestors, m_limit_ancestor_size, m_limit_descendants,\n                                    m_limit_descendant_size, err_string)) {\n+        // TODO: When replacements exist, to avoid overestimating descendant counts, deduct the\n+        // to-be-replaced mempool entries when counting descendants. Note that this is not\n+        // necessarily as simple as subtracting the count/size from descendant limits, because\n+        // multiple transactions may conflict with the same entries, causing us to double-count them\n+        // and their descendants.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868495787",
      "id" : 868495787,
      "line" : 1022,
      "node_id" : "PRRC_kwDOABII584zxDGr",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 1022,
      "original_position" : 221,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 221,
      "pull_request_review_id" : 966801973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868495787/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T22:25:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868495787",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868503310"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868503310"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure if this check isn't already redundant given that calling `ReplacementChecks` in `AcceptSingleTransaction` is dependent on `m_rbf=true` or unless there is another code path where it makes sense ?",
      "commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "created_at" : "2022-05-09T21:50:22Z",
      "diff_hunk" : "@@ -928,6 +952,9 @@ bool MemPoolAccept::ReplacementChecks(Workspace& ws)\n     const uint256& hash = ws.m_hash;\n     TxValidationState& state = ws.m_state;\n \n+    m_rbf = ws.m_conflicts.size() > 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868503310",
      "id" : 868503310,
      "line" : 955,
      "node_id" : "PRRC_kwDOABII584zxE8O",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 955,
      "original_position" : 156,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 156,
      "pull_request_review_id" : 966801973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868503310/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T22:25:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868503310",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868529657"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868529657"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Depending on the design of p2p packages, we might relay the \"full-non-dedup\" version of the package as our peers might not have the same mempool composition. So the additional fees might have to be paid on the non-dedup package. I don't think we have to settle the question now though we might have to rework package-RBF in function of p2p design ?",
      "commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "created_at" : "2022-05-09T22:20:36Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.\n+\n+4. The package fee after deduplication pays an absolute fee of at least the sum paid by the\n+   original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868529657",
      "id" : 868529657,
      "line" : 137,
      "node_id" : "PRRC_kwDOABII584zxLX5",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 137,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 45,
      "pull_request_review_id" : 966801973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868529657/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T22:25:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868529657",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868533379"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868533379"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it could be a limitation for second-layer package issuers, where a child-with-parents package aims to replace more than 5 LN commitment transactions at the same time. A counterparty could extend the 5 non-related commitment transactions descendants until reaching max in-mempool limits, thus interfering with their potential package-RBF.\r\n\r\nAm I correct ? That said, I remember we've already said that child-with-parents to replace multiple LN commitment transactions open the door to malicious interferences.",
      "commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "created_at" : "2022-05-09T22:25:01Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.\n+\n+4. The package fee after deduplication pays an absolute fee of at least the sum paid by the\n+   original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth after deduplication at or\n+   above the rate set by the node's incremental relay feerate. For example, if the incremental relay\n+   feerate is 1 satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the\n+   package fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+6. The number of original transactions does not exceed 100.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868533379",
      "id" : 868533379,
      "line" : 143,
      "node_id" : "PRRC_kwDOABII584zxMSD",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 143,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 51,
      "pull_request_review_id" : 966801973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868533379/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T22:25:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868533379",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r869137839"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869137839"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This rule startled me a bit at first, it may be worth mentioning that if you want to update the package's child, you should do a normal RBF of just that child.\r\n\r\nWhat you mean is that package-rbf applies for the case where we want for example to replace `{commitTxAlice, anchorAlice}` by `{commitTxBob, anchorBob}` where `commitTxAlice` and `commitTxBob` conflict, but we cannot use package-rbf to replace `{commitTxAlice, anchorAlice1}` by `{commitTxAlice, anchorAlice2}` where `anchorAlice2` pays more fees than `anchorAlice1`. In that case we should submit `anchorAlice2` alone and it will go through the usual RBF rules. Is that correct?\r\n\r\nAlso you don't want to mix up package-rbf and normal rbf, so a child tx cannot create conflicts \"outside of the package\" IIUC.",
      "commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "created_at" : "2022-05-10T11:46:25Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r869137839",
      "id" : 869137839,
      "line" : 126,
      "node_id" : "PRRC_kwDOABII584zzf2v",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 126,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 34,
      "pull_request_review_id" : 967623639,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869137839/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T12:14:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869137839",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r869152001"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869152001"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "My head hurts :laughing: \r\n\r\nI'm not 100% sure I'm understanding this rule correctly, can you let me know if the following example makes sense?\r\n\r\nLet's imagine we have `{commitTxAlice, anchorTxAlice}` in the mempool that we want to replace.\r\nWhat we really want to do is to replace `commitTxAlice` by `commitTxBob` (the child is just a tool to achieve that).\r\nWe ask `bitcoind` to `fundrawtransaction` to ensure our `anchorTxBob` adds enough funds.\r\n`bitcoind` adds an unconfirmed (but safe) wallet input:\r\n\r\n```\r\n+-------------+\r\n| commitTxBob |---------+\r\n+-------------+         |      +-------------+\r\n                        |      |             |\r\n+------------------+    +----->| anchorTxBob |\r\n| previousWalletTx |---------->|             |\r\n+------------------+           +-------------+\r\n```\r\n\r\nIf we include `previousWalletTx` in the package, this package-rbf would work, right?\r\nBut if we don't include `previousWalletTx` in the package, this would be rejected?\r\n\r\nBut what if `previousWalletTx` itself has an unconfirmed parent?\r\nWe cannot include this grand-parent in the package (since packages are only parents-with-single-child).\r\n\r\nThis isn't directly bringing an unconfirmed input, but it is indirectly bringing one. Is that ok? If that's ok, why wouldn't it be ok to just allow adding new unconfirmed inputs in the first place?",
      "commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "created_at" : "2022-05-10T12:03:32Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r869152001",
      "id" : 869152001,
      "line" : 132,
      "node_id" : "PRRC_kwDOABII584zzjUB",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 132,
      "original_position" : 40,
      "original_start_line" : 130,
      "path" : "doc/policy/packages.md",
      "position" : 40,
      "pull_request_review_id" : 967623639,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869152001/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 130,
      "start_side" : "RIGHT",
      "updated_at" : "2022-05-10T12:14:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869152001",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r869160432"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869160432"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I believe this issue can unfortunately arise even when you're replacing a single LN commitment transaction.\r\nImagine that you're trying to replace `{commitTxAlice, anchorTxAlice}` but Alice has created `anchorTxAlice` to have 100 outputs and broadcast one child tx per output, you're already hitting the 100 transactions limit...\r\n\r\nI believe that the only thing that can save Bob here is to broadcast `{commitTxAlice, anchorTxBob}` by relying on the CPFP carve-out rule to get Alice's commitment to confirm. But in order to do that, Bob needs to somehow get the signed `commitTxAlice` (which never appeared in his mempool since his mempool contains `commitTxBob`).\r\n\r\nSo this rule is an issue for L2 protocols, but it is also a protection against high mempool churn, so it's hard to draw the line.",
      "commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "created_at" : "2022-05-10T12:12:45Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.\n+\n+4. The package fee after deduplication pays an absolute fee of at least the sum paid by the\n+   original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth after deduplication at or\n+   above the rate set by the node's incremental relay feerate. For example, if the incremental relay\n+   feerate is 1 satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the\n+   package fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+6. The number of original transactions does not exceed 100.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r869160432",
      "id" : 869160432,
      "in_reply_to_id" : 868533379,
      "line" : 143,
      "node_id" : "PRRC_kwDOABII584zzlXw",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 143,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 51,
      "pull_request_review_id" : 967623639,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869160432/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T12:14:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869160432",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873782940"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873782940"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This RBF policy is essentially treating the package as \"one big transaction,\" which works because everything is in the ancestor set of the child. PackageTestAccept doesn't impose any topology restrictions - it even allows unrelated transactions to be submitted as a group. So it wouldn't make sense to use each other's fees.",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-05-16T14:16:28Z",
      "diff_hunk" : "@@ -502,7 +505,7 @@ class MemPoolAccept\n                             /* m_bypass_limits */ false,\n                             /* m_coins_to_uncache */ coins_to_uncache,\n                             /* m_test_accept */ false,\n-                            /* m_allow_bip125_replacement */ false,\n+                            /* m_allow_bip125_replacement */ true,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873782940",
      "id" : 873782940,
      "in_reply_to_id" : 868430869,
      "line" : 515,
      "node_id" : "PRRC_kwDOABII5840FN6c",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 515,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 15,
      "pull_request_review_id" : 974037959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873782940/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-16T14:36:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873782940",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873799952"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873799952"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I mean a situation like this:\r\n\r\n<img width=\"673\" alt=\"image\" src=\"https://user-images.githubusercontent.com/25183001/168615825-6251d4d6-97b6-45cf-ada7-91c6a1d9ce45.png\">\r\n\r\n\r\n{A, B, C} are in the mempool, and A is already at the descendant limit (101KvB). {X, Y, Z} is a package where X conflicts with B and will replace {B, C}. However, when we run descendant limit checks, it will look like A's descendants include {B, C, X, Z} and reject it. But actually A's descendants will only include {X, Z} after the replacement.",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-05-16T14:31:01Z",
      "diff_hunk" : "@@ -975,13 +1006,89 @@ bool MemPoolAccept::PackageMempoolChecks(const std::vector<CTransactionRef>& txn\n     assert(std::all_of(txns.cbegin(), txns.cend(), [this](const auto& tx)\n                        { return !m_pool.exists(GenTxid::Txid(tx->GetHash()));}));\n \n+    // Populate with the union of all transactions' ancestors.\n+    CTxMemPool::setEntries m_collective_ancestors;\n+    for (const auto& ws : workspaces) {\n+        for (const auto& it : ws.m_ancestors) m_collective_ancestors.insert(it);\n+    }\n+\n     std::string err_string;\n     if (!m_pool.CheckPackageLimits(txns, m_limit_ancestors, m_limit_ancestor_size, m_limit_descendants,\n                                    m_limit_descendant_size, err_string)) {\n+        // TODO: When replacements exist, to avoid overestimating descendant counts, deduct the\n+        // to-be-replaced mempool entries when counting descendants. Note that this is not\n+        // necessarily as simple as subtracting the count/size from descendant limits, because\n+        // multiple transactions may conflict with the same entries, causing us to double-count them\n+        // and their descendants.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873799952",
      "id" : 873799952,
      "in_reply_to_id" : 868495787,
      "line" : 1026,
      "node_id" : "PRRC_kwDOABII5840FSEQ",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 1026,
      "original_position" : 221,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 211,
      "pull_request_review_id" : 974037959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873799952/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-16T14:36:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873799952",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873809115"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873809115"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah good point, I forgot I had moved this to the bottom of PreChecks.",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-05-16T14:38:52Z",
      "diff_hunk" : "@@ -928,6 +952,9 @@ bool MemPoolAccept::ReplacementChecks(Workspace& ws)\n     const uint256& hash = ws.m_hash;\n     TxValidationState& state = ws.m_state;\n \n+    m_rbf = ws.m_conflicts.size() > 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873809115",
      "id" : 873809115,
      "in_reply_to_id" : 868503310,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5840FUTb",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 955,
      "original_position" : 156,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 974075624,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873809115/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-16T14:38:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873809115",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873820419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873820419"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I think it could be a limitation for second-layer package issuers, where a child-with-parents package aims to replace more than 5 LN commitment transactions at the same time. A counterparty could extend the 5 non-related commitment transactions descendants until reaching max in-mempool limits, thus interfering with their potential package-RBF.\r\n\r\nYeah, batching multiple commitment transaction replacements isn't very safe. That's why we have the \"Warning: Batched fee-bumping may be unsafe for some use cases. Users and application developers should take caution if utilizing multi-parent packages.\" in the [doc](https://github.com/bitcoin/bitcoin/blob/master/doc/policy/packages.md#package-mempool-acceptance-rules).\r\n\r\n> I believe this issue can unfortunately arise even when you're replacing a single LN commitment transaction.\r\n\r\nI don't think this scenario is possible with our current mempool policy. With our descendant limit at 25,  `anchorTxAlice` wouldn't be able to have 100 children.",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-05-16T14:47:38Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.\n+\n+4. The package fee after deduplication pays an absolute fee of at least the sum paid by the\n+   original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth after deduplication at or\n+   above the rate set by the node's incremental relay feerate. For example, if the incremental relay\n+   feerate is 1 satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the\n+   package fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+6. The number of original transactions does not exceed 100.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873820419",
      "id" : 873820419,
      "in_reply_to_id" : 868533379,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5840FXED",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 143,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 974093538,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873820419/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-16T14:47:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873820419",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873852659"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873852659"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Unfortunately, no, `previousWalletTx` cannot be used as one of the parents; all of `anchorTxBob`'s inputs need to be confirmed.\r\n\r\nThis is an extension of BIP 125 Rule 2. I currently don't know a safe way to remove that rule. #23121 was an attempt, but also unsafe. Very sorry :(\r\n\r\n",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-05-16T15:16:00Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873852659",
      "id" : 873852659,
      "in_reply_to_id" : 869152001,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5840Fe7z",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 132,
      "original_position" : 40,
      "original_start_line" : 130,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 974140337,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873852659/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-05-16T15:16:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873852659",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873854502"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873854502"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes you're right. Thanks for the feedback and clear explanation, adding some similar language to the doc!",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-05-16T15:17:45Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873854502",
      "id" : 873854502,
      "in_reply_to_id" : 869137839,
      "line" : 126,
      "node_id" : "PRRC_kwDOABII5840FfYm",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 126,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 34,
      "pull_request_review_id" : 974143032,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873854502/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-16T15:17:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873854502",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r875569716"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/875569716"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Gotcha, thanks for the confirmation, we'll deal with that limitation then, it's already a good start. And hopefully we'll eventually figure out better RBF rules for both single txs and packages!",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-05-18T07:41:31Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r875569716",
      "id" : 875569716,
      "in_reply_to_id" : 869152001,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5840MCI0",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 132,
      "original_position" : 40,
      "original_start_line" : 130,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 976493853,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/875569716/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-05-18T07:41:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/875569716",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r878468366"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/878468366"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(Sorry for my earlier comment, I was confused)\r\n\r\n> If we include previousWalletTx in the package, this package-rbf would work, right?\r\n\r\nYes. It's fine because it's one of the direct parents of `anchorTxBob`.\r\n\r\n> But if we don't include previousWalletTx in the package, this would be rejected?\r\n\r\nIf you mean `anchorTxBob` now only has 1 unconfirmed input, `commitTxBob`, actually this would be accepted.\r\n\r\nIf you mean that `previousWalletTx` was submitted ahead of time, that should still be okay because the code will remember to exempt `previousWalletTx` from the \"no new unconfirmed\" rule.\r\n\r\n> But what if previousWalletTx itself has an unconfirmed parent?\r\n\r\nBased on this rule, if `previousWalletTx` has another unconfirmed parent, this would be rejected.",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-05-20T19:00:15Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r878468366",
      "id" : 878468366,
      "in_reply_to_id" : 869152001,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5840XF0O",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 132,
      "original_position" : 40,
      "original_start_line" : 130,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 980563664,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/878468366/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-05-20T19:00:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/878468366",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r880098512"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/880098512"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the clarification! I'll create extensive tests of this behavior and will report back.",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-05-24T06:18:49Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r880098512",
      "id" : 880098512,
      "in_reply_to_id" : 869152001,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5840dTzQ",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 132,
      "original_position" : 40,
      "original_start_line" : 130,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 982646813,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/880098512/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-05-24T06:18:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/880098512",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@t-bast \r\n\r\n> to have 100 outputs and broadcast one child tx per output, you're already hitting the 100 transactions limit...\r\n\r\nThey cannot create this chain to begin with as from any single unconfirmed transaction with confirmed parents, you can only make 25 transactions.\r\n\r\nSo if you for example had >4 commitment transactions that you want to CPFP with a single bump transaction, this is where the limit can be hit.",
      "created_at" : "2022-06-02T19:58:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1145285891",
      "id" : 1145285891,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585EQ60D",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145285891/reactions"
      },
      "updated_at" : "2022-06-02T19:58:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145285891",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> They cannot create this chain to begin with as from any single unconfirmed transaction with confirmed parents, you can only make 25 transactions.\r\n\r\nRight, I had forgotten that restriction! However, this 25 descendants chain limit is only a configuration parameter on bitcoind, not a BIP 125 requirement, right? So in theory we cannot fully rely on it, nothing prevents an attacker to inject a 100 descendants chain in miners mempools if they have configured their bitcoind differently (or even use a different implementation)?",
      "created_at" : "2022-06-02T22:26:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1145404055",
      "id" : 1145404055,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585ERXqX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145404055/reactions"
      },
      "updated_at" : "2022-06-02T22:26:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145404055",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@t-bast unlikely but true, seems like something to consider scaling with other policies to be more robust?",
      "created_at" : "2022-06-02T23:21:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1145431949",
      "id" : 1145431949,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585EReeN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145431949/reactions"
      },
      "updated_at" : "2022-06-02T23:21:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145431949",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> this 25 descendants chain limit is only a configuration parameter on bitcoind, not a BIP 125 requirement\r\n\r\nNote that BIP 125 enforcement could be considered a configuration parameter too -- eg knots nodes will allow replacement of any tx, whether they signal or not.\r\n\r\nPerhaps something we could consider is defining a service bit to correspond with a relay policy, and have nodes preferential peer with other nodes who set that bit; that way you're more likely for nodes that support a particular policy to form a fully connected graph, and thus have a path to any miners that also accept that relay policy. Knots defines an experimental service bit for full-RBF nodes https://github.com/bitcoinknots/bitcoin/blob/23.x-knots/src/init.cpp#L1103 . ",
      "created_at" : "2022-06-02T23:49:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1145451225",
      "id" : 1145451225,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585ERjLZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145451225/reactions"
      },
      "updated_at" : "2022-06-02T23:49:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145451225",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r889005663"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889005663"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since we are introducing a new form of RBF that doesn't currently exist, now might be the best time to at least improve the BIP 125 rules to be incentive compatible in all situations (though this comes at the cost of making replacements potentially more expensive).\r\n\r\nIn particular what I have in mind is that we require the ancestor feerate of the child transaction to be higher than the actual feerate of all transactions that would be evicted. This is conservative but I think would ensure that we don't have any situations where there are transactions being replaced that might appear in the next block, while the new transactions do not.\r\n\r\nWould this be too conservative for the use cases that we have in mind?",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-03T14:36:20Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r889005663",
      "id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII5840_SZf",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 995003793,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889005663/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-03T14:36:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889005663",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r889037679"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889037679"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can you elaborate with an example? It's possible I don't have the same mental mapping to terms and do not understand the scenario.",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-03T15:11:26Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r889037679",
      "id" : 889037679,
      "in_reply_to_id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII5840_aNv",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 995049541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889037679/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-03T15:11:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889037679",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r889064935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889064935"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure -- consider the case where you have a transaction A(100vb, 1sat/vb) and child B (100vb, 10sat/vb) in the mempool.  Total fees = 1100 sat.\r\n\r\nA package comes in with parent A'(100vb, 1sat/vb) and child B'(1000vb, 2.5sat/vb).  Total package fees = 2600 sat.\r\n\r\nUnder the rules described here, package (A', B') could replace (A, B) in the mempool, because total fees are paid for and there's enough left over fee to pay the incremental relay fee of the new package (1500 sat/1100 vb). Also the package feerate is higher than that of the direct conflicts[1].\r\n\r\nThe deficiency in the logic is that we're not looking at the feerates of the transactions that would be evicted -- even though their absolute fee is being paid, their feerate could be even higher than the transactions that would replace them.  Calculating the effective feerate that such a transaction would have in our mining code is tricky (because a sibling could pay for an ancestor, it's not quite right to just consider ancestor feerate), but using its feerate is a conservative check here -- any descendant that is paying for its confirmation would be caught in this logic, and its (higher) feerate considered if necessary.\r\n\r\nFor evaluating the mining suitability of the new transactions coming in, I think we can just look at the ancestor feerate of the package, which is a lower bound on the attractiveness of the new transactions.  (I think this would also allow us to relax the rule against new unconfirmed inputs.)\r\n\r\n[1] In looking at this example, I noticed that BIP 125 as drafted seems to misstate an important check we perform in our current RBF policy, namely that we compare the feerate of a new transaction coming in to the feerate of the existing transactions that it directly conflicts with.  (Without this check, a small high fee transaction could be replaced by a large low fee transaction!). From my first glance at the code in this PR, it looks like the code itself does a similar check for packages (comparing the package feerate to the feerate of the direct conflicts) so that is good at least, but the description of the logic in the documentation should point out that there is some feerate check happening as well.\r\n\r\n",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-03T15:44:22Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r889064935",
      "id" : 889064935,
      "in_reply_to_id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII5840_g3n",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 995088589,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889064935/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-03T16:01:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889064935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r889076418"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889076418"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's ancient lore by now, but I'm not sure it's a \"mis-statement\" or just incentive incompatible stuff no one implements(becase feerate check is cheap). I agree with your reading of current texts either way and agree pulling that into the text is the right thing to do. ",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-03T15:58:32Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r889076418",
      "id" : 889076418,
      "in_reply_to_id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII5840_jrC",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 995104339,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889076418/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-03T15:59:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889076418",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r898197226"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/898197226"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> require the ancestor feerate of the child transaction to be higher than the actual feerate of all transactions that would be evicted. This is conservative but I think would ensure that we don't have any situations where there are transactions being replaced that might appear in the next block, while the new transactions do not.\r\n\r\nI think this is a sensible addition. I cannot think of any easy attacks since it's only the directly conflicting transactions and not their descendants (i.e. I don't have the concerns stated in https://github.com/bitcoin/bitcoin/pull/23121#issuecomment-1004774370).\r\n\r\nBtw, don't we want min(package feerate, child ancestor feerate)?\r\n\r\nIn pseudocode for a child-with-unconfirmed-parents package: \r\n```\r\nfor each tx in directly_conflicting_transactions:\r\n    if min(package_feerate, child.ancestor_feerate) <= tx.individual_feerate\r\n        fail\r\n```\r\n\r\nWith this, do you think it would be acceptable to remove the \"no new unconfirmed inputs\" rule in package RBF?\r\n\r\n\r\n> we compare the feerate of a new transaction coming in to the feerate of the existing transactions that it directly conflicts with\r\n\r\nRight, this wasn't in BIP 125. I also misinterpreted that part of the code to be part of the other fee-related rules and just a \"fail fast\" piece of logic, and didn't include it in # #23711 either (gah!). Just opened #25382 to add test coverage for it in isolation + add it to doc/policy/replacements.md",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-15T16:38:13Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r898197226",
      "id" : 898197226,
      "in_reply_to_id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII5841iWbq",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 1007815154,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/898197226/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-15T16:38:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/898197226",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   }
]
