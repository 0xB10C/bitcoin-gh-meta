[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25183](https://github.com/bitcoin/bitcoin/pull/25183) (rpc: Segwit-only inputs option for fundrawtransaction by aureleoules)\n* [#25118](https://github.com/bitcoin/bitcoin/pull/25118) (wallet: unify âallow/block other inputsâ concept by furszy)\n* [#24699](https://github.com/bitcoin/bitcoin/pull/24699) (wallet: Improve AvailableCoins performance by reducing duplicated operations by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-04-28T02:00:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#issuecomment-1111657636",
      "id" : 1111657636,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25005",
      "node_id" : "IC_kwDOABII585CQoyk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1111657636/reactions"
      },
      "updated_at" : "2022-05-25T19:57:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1111657636",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@furszy It looks like the qt wallet test is failing in the CI. You can run `./src/qt/test/test_bitcoin-qt` in your dev environment to reproduce and debug the issue.",
      "created_at" : "2022-04-28T10:45:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#issuecomment-1112056877",
      "id" : 1112056877,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25005",
      "node_id" : "IC_kwDOABII585CSKQt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112056877/reactions"
      },
      "updated_at" : "2022-04-28T10:45:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112056877",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah, thanks @jonatack ð. Just noticed that the GUI `WalletTests` isn't run by default in my OS under `make check`.\r\n\r\nIt's an easy fix; as the test doesn't start the balance polling timer, the model does not have the balance cached so.. as 5babfb7 make uses of it, the creation process fails with a not-enough balance error.\r\n\r\nWill push the fix and expand + improve the test coverage a bit more.\r\nAnd.. most likely will decouple that last commit into a separate PR in few days. Have some further improvements locally for the wallet model area that can package out all together that aren't really part of the scope of this PR.\r\n(like a mutex to be able to access the model cached balance from different threads, connect it to the widgets etc..)",
      "created_at" : "2022-04-28T14:01:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#issuecomment-1112243680",
      "id" : 1112243680,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25005",
      "node_id" : "IC_kwDOABII585CS33g",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112243680/reactions"
      },
      "updated_at" : "2022-04-28T14:19:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112243680",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> 6) The GUI `WalletModel::prepareTransaction` will now use the cached balance to make the funds availability check if the user didn't manually selected outputs to spend. This will avoid an entire on-demand recalculation of the available balance which is quite expensive as the wallet has to walk through the entire txs map.\r\n\r\nDropped the last two commits that were implementing point (6) described above. They are now part of https://github.com/bitcoin-core/gui/pull/598",
      "created_at" : "2022-05-09T20:58:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#issuecomment-1121574208",
      "id" : 1121574208,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25005",
      "node_id" : "IC_kwDOABII585C2d1A",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1121574208/reactions"
      },
      "updated_at" : "2022-05-10T15:03:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1121574208",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r874124981"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874124981"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 2cdd2a1a5498cb8767799dd26a4082e9d3b064ee \"wallet: speedup 'GetAvailableBalance' filtering by spendable outputs only and using the 'AvailableCoins' retrieved total_amount.\"\r\n\r\nWhat is the purpose of the rename and making an empty `CCoinControl` here? `AvailableCoins` can take `nullptr` for `coinControl`.",
      "commit_id" : "2cdd2a1a5498cb8767799dd26a4082e9d3b064ee",
      "created_at" : "2022-05-16T20:23:45Z",
      "diff_hunk" : "@@ -225,17 +223,13 @@ CoinsResult AvailableCoins(const CWallet& wallet,\n     return result;\n }\n \n-CAmount GetAvailableBalance(const CWallet& wallet, const CCoinControl* coinControl)\n+CAmount GetAvailableBalance(const CWallet& wallet, const CCoinControl* _coinControl)\n {\n     LOCK(wallet.cs_wallet);\n-\n-    CAmount balance = 0;\n-    for (const COutput& out : AvailableCoins(wallet, coinControl).coins) {\n-        if (out.spendable) {\n-            balance += out.txout.nValue;\n-        }\n-    }\n-    return balance;\n+    // Copy to filter by spendable coins only\n+    CCoinControl coinControl = _coinControl ? *_coinControl : CCoinControl();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r874124981",
      "id" : 874124981,
      "line" : 230,
      "node_id" : "PRRC_kwDOABII5840Gha1",
      "original_commit_id" : "2cdd2a1a5498cb8767799dd26a4082e9d3b064ee",
      "original_line" : 230,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 40,
      "pull_request_review_id" : 974523072,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874124981/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-16T20:27:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/874124981",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Hey achow101, thanks for the review!\r\n\r\n> I don't quite understand the purpose of the first commit. It doesn't seem like it materially improves anything?\r\n\r\nWe are skipping the non-spendable coins that appear in `vCoins` (`AvailableCoins` result) later, in several parts of the `CreateTransaction` and `GetBalance` flows:\r\n\r\n1.  `GetAvailableBalance` was (1) getting all the available coins calling `AvailableCoins` and, right away, walking through the entire vector, skipping the non-spendable coins, to calculate the total balance.â¨\r\n\r\n2. Inside `CreateTransactionInternal` â> `SelectCoins(vCoins,...)`, we have several calls to `AttemptSelection` which, on each of them internally, we call twice to `GroupOutputs` which internally has two for-loops over the entire `vCoins` vector that skip the non-spendable coins.\r\n\r\nSo, the purpose is not add the non-spendable coins into the `AvailableCoins` result (`vCoins`) in the first place for the processes that arenât using them at all, so we donât waste resources skipping them later so many times.\r\n\r\nNote: this speedup is for all the processes that calls to `CreateTransaction` and `GetBalance*` internally.",
      "created_at" : "2022-05-21T17:54:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#issuecomment-1133735550",
      "id" : 1133735550,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25005",
      "node_id" : "IC_kwDOABII585Dk25-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1133735550/reactions"
      },
      "updated_at" : "2022-05-21T17:54:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1133735550",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r878744964"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/878744964"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The previous flow was:\r\n```c++\r\nstd::vector<COutput> vCoins;\r\nAvailableCoins(wallet, vCoins, coinControl);\r\nfor (const COutput& out : vCoins) {\r\n     if (out.spendable) { --> // this is the reason\r\n         balance += out.txout.nValue;\r\n     }\r\n}\r\n```\r\n\r\nTo remove the second unnecessary for-loop, as the function arg is `const CCoinControl*`, in order to continue having the same calculation (skipping the non-spendable coins), needed to create a local copy of the `coinControl` arg and set the new flag `m_include_only_spendable_outputs` to true (which by default is false).\r\n\r\nSo the coins vector and the total balance returned by `AvailableCoins` has all, and only, the spendable coins directly.\r\n\r\nIn the new flow:\r\n```c++\r\nCCoinControl coinControl = _coinControl ? *_coinControl : CCoinControl();\r\ncoinControl.m_include_only_spendable_outputs = true; // --> this enforces that non-spendable coins are filtered from `AvailableCoins` result.\r\nreturn AvailableCoins(wallet, &coinControl).total_amount;\r\n```\r\n",
      "commit_id" : "46ac311e0bf706482bb8d7001f6ff6825620caff",
      "created_at" : "2022-05-21T18:09:03Z",
      "diff_hunk" : "@@ -225,17 +223,13 @@ CoinsResult AvailableCoins(const CWallet& wallet,\n     return result;\n }\n \n-CAmount GetAvailableBalance(const CWallet& wallet, const CCoinControl* coinControl)\n+CAmount GetAvailableBalance(const CWallet& wallet, const CCoinControl* _coinControl)\n {\n     LOCK(wallet.cs_wallet);\n-\n-    CAmount balance = 0;\n-    for (const COutput& out : AvailableCoins(wallet, coinControl).coins) {\n-        if (out.spendable) {\n-            balance += out.txout.nValue;\n-        }\n-    }\n-    return balance;\n+    // Copy to filter by spendable coins only\n+    CCoinControl coinControl = _coinControl ? *_coinControl : CCoinControl();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r878744964",
      "id" : 878744964,
      "in_reply_to_id" : 874124981,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5840YJWE",
      "original_commit_id" : "2cdd2a1a5498cb8767799dd26a4082e9d3b064ee",
      "original_line" : 236,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 980866810,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/878744964/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-21T21:46:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/878744964",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased after #25083 merge. Conflicts solved.",
      "created_at" : "2022-05-23T18:18:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#issuecomment-1134992768",
      "id" : 1134992768,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25005",
      "node_id" : "IC_kwDOABII585Dpp2A",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1134992768/reactions"
      },
      "updated_at" : "2022-05-23T18:18:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1134992768",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888117918"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888117918"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 3082f2270fa96eaf2bd1d5e69d56fce9588a4f79 \"wallet: add 'm_include_only_spendable_outputs' filter to CoinControl\"\r\n\r\nInstead of setting this parameter all the way out here in the RPC, I think it would make more sense to set it closer to the places where it actually matters, e.g. in `CreateTransactionInternal` right before `AvailableCoins` is called. This way we won't have to remember to always set this option for every caller to `CreateTransaction`.",
      "commit_id" : "46ac311e0bf706482bb8d7001f6ff6825620caff",
      "created_at" : "2022-06-02T15:53:03Z",
      "diff_hunk" : "@@ -395,6 +396,8 @@ RPCHelpMan sendmany()\n         coin_control.m_signal_bip125_rbf = request.params[5].get_bool();\n     }\n \n+    coin_control.m_include_only_spendable_outputs = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888117918",
      "id" : 888117918,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584075qe",
      "original_commit_id" : "3082f2270fa96eaf2bd1d5e69d56fce9588a4f79",
      "original_line" : 399,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 993779961,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888117918/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-02T16:00:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888117918",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888119926"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888119926"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In aa0be53fcd85f8ad8102c5843baeec9d0740297a \"wallet::AvailableCoins, stop calling 'wtx.tx->vout[i]' multiple times.\"\r\n\r\nnit: const\r\n```suggestion\r\n            const COutPoint outpoint(wtxid, i);\r\n```",
      "commit_id" : "46ac311e0bf706482bb8d7001f6ff6825620caff",
      "created_at" : "2022-06-02T15:55:13Z",
      "diff_hunk" : "@@ -166,24 +166,27 @@ CoinsResult AvailableCoins(const CWallet& wallet,\n         bool tx_from_me = CachedTxIsFromMe(wallet, wtx, ISMINE_ALL);\n \n         for (unsigned int i = 0; i < wtx.tx->vout.size(); i++) {\n+            const CTxOut& output = wtx.tx->vout[i];\n+            COutPoint outpoint(wtxid, i);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888119926",
      "id" : 888119926,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584076J2",
      "original_commit_id" : "aa0be53fcd85f8ad8102c5843baeec9d0740297a",
      "original_line" : 170,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 993779961,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888119926/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-02T16:00:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888119926",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888123040"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888123040"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In da875e6e8008f9b7053b5ce42fade49a322e0a50 \"wallet::IsSpent accepting 'COutPoint' instead of hash:index.\"\r\n\r\nnit: inline\r\n```suggestion\r\n        if (!wallet.IsSpent(COutPoint(hashTx, i)) && (allow_used_addresses || !wallet.IsSpentKey(hashTx, i))) {\r\n```",
      "commit_id" : "46ac311e0bf706482bb8d7001f6ff6825620caff",
      "created_at" : "2022-06-02T15:58:31Z",
      "diff_hunk" : "@@ -204,9 +204,9 @@ CAmount CachedTxGetAvailableCredit(const CWallet& wallet, const CWalletTx& wtx,\n     bool allow_used_addresses = (filter & ISMINE_USED) || !wallet.IsWalletFlagSet(WALLET_FLAG_AVOID_REUSE);\n     CAmount nCredit = 0;\n     uint256 hashTx = wtx.GetHash();\n-    for (unsigned int i = 0; i < wtx.tx->vout.size(); i++)\n-    {\n-        if (!wallet.IsSpent(hashTx, i) && (allow_used_addresses || !wallet.IsSpentKey(hashTx, i))) {\n+    for (unsigned int i = 0; i < wtx.tx->vout.size(); i++)  {\n+        COutPoint outpoint(hashTx, i);\n+        if (!wallet.IsSpent(outpoint) && (allow_used_addresses || !wallet.IsSpentKey(hashTx, i))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888123040",
      "id" : 888123040,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5840766g",
      "original_commit_id" : "da875e6e8008f9b7053b5ce42fade49a322e0a50",
      "original_line" : 209,
      "original_position" : 9,
      "original_start_line" : 208,
      "path" : "src/wallet/receive.cpp",
      "position" : null,
      "pull_request_review_id" : 993779961,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888123040/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-06-02T16:00:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888123040",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888153750"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888153750"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I was doing it there first but the `CCoinControl` arg of `CreateTransactionInternal` is const. Options were (1) modify it by copying the coin control object to a temp variable or (2) change the function signature.\r\n\r\nAnd at least in this case, I wasn't totally good with those two options (not against neither, it was a \"maybe\"). But open for new thoughts, would you prefer option 1 more?",
      "commit_id" : "46ac311e0bf706482bb8d7001f6ff6825620caff",
      "created_at" : "2022-06-02T16:25:22Z",
      "diff_hunk" : "@@ -395,6 +396,8 @@ RPCHelpMan sendmany()\n         coin_control.m_signal_bip125_rbf = request.params[5].get_bool();\n     }\n \n+    coin_control.m_include_only_spendable_outputs = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888153750",
      "id" : 888153750,
      "in_reply_to_id" : 888117918,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58408CaW",
      "original_commit_id" : "3082f2270fa96eaf2bd1d5e69d56fce9588a4f79",
      "original_line" : 399,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 993829928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888153750/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-02T16:25:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888153750",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888192137"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888192137"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Actually, since this option is really just for `AvailableCoins` itself, it might make more sense to make it a parameter to `AvailableCoins` rather than having it in `CCoinControl`.",
      "commit_id" : "46ac311e0bf706482bb8d7001f6ff6825620caff",
      "created_at" : "2022-06-02T17:08:27Z",
      "diff_hunk" : "@@ -395,6 +396,8 @@ RPCHelpMan sendmany()\n         coin_control.m_signal_bip125_rbf = request.params[5].get_bool();\n     }\n \n+    coin_control.m_include_only_spendable_outputs = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888192137",
      "id" : 888192137,
      "in_reply_to_id" : 888117918,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58408LyJ",
      "original_commit_id" : "3082f2270fa96eaf2bd1d5e69d56fce9588a4f79",
      "original_line" : 399,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 993884505,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888192137/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-02T17:08:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888192137",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888245468"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888245468"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ðð¼ , added it in 2afd32f.",
      "commit_id" : "46ac311e0bf706482bb8d7001f6ff6825620caff",
      "created_at" : "2022-06-02T18:02:46Z",
      "diff_hunk" : "@@ -395,6 +396,8 @@ RPCHelpMan sendmany()\n         coin_control.m_signal_bip125_rbf = request.params[5].get_bool();\n     }\n \n+    coin_control.m_include_only_spendable_outputs = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#discussion_r888245468",
      "id" : 888245468,
      "in_reply_to_id" : 888117918,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58408Yzc",
      "original_commit_id" : "3082f2270fa96eaf2bd1d5e69d56fce9588a4f79",
      "original_line" : 399,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 993957994,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25005",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888245468/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-02T18:02:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/888245468",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Ready, feedback applied:\r\n\r\n- Moved `only_spendable` from be a `CoinControl` field to be a `AvailableCoins` param.\r\n- Nits tackled.",
      "created_at" : "2022-06-02T18:06:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25005#issuecomment-1145160959",
      "id" : 1145160959,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25005",
      "node_id" : "IC_kwDOABII585EQcT_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145160959/reactions"
      },
      "updated_at" : "2022-06-02T18:06:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145160959",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   }
]
