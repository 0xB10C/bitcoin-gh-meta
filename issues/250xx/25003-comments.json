[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Good catch!\r\n\r\nI'm not sure about the original intention (maybe also the documentation is imprecise?), but if `aps_create_tx_internal` is called irrespective of the second `CreateTransactionInternal` result now, I don't see a point in having the `attempting_aps_create_tx` tracepoint anymore.",
      "created_at" : "2022-04-27T15:19:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25003#issuecomment-1111131858",
      "id" : 1111131858,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25003",
      "node_id" : "IC_kwDOABII585COobS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1111131858/reactions"
      },
      "updated_at" : "2022-04-27T15:39:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1111131858",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I'm not sure about the original intention (maybe also the documentation is imprecise?), but if `aps_create_tx_internal` is called irrespective of the second `CreateTransactionInternal` result now, I don't see a point in having the `attempting_aps_create_tx` tracepoint anymore.\r\n\r\nOh, I didn't see that we have this `attempting_aps_create_tx` tracepoint to be honest. So there is already an implicit way to see if the second `CreateTransactionInternal` call failed, and it could indeed be that the documentation is not clear enough. What made me sceptical about the conditional tracepoint call though is the fact that there is a \"succeeded\" parameter (where currently the result of the _first_ `CreateTransactionInternal` is passed, i.e. always \"true\").\r\n\r\nI'd conclude then that we can remove either\r\n- the `attempting_aps_create_tx` tracepoint (if this PR is preferred), or\r\n- the success parameter from the `aps_create_tx_internal ` tracepoint (with an according documentation update, e.g. \"is called when completed successfully\")",
      "created_at" : "2022-04-27T16:03:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25003#issuecomment-1111180680",
      "id" : 1111180680,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25003",
      "node_id" : "IC_kwDOABII585CO0WI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1111180680/reactions"
      },
      "updated_at" : "2022-04-27T16:04:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1111180680",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I'm not sure about the original intention (maybe also the documentation is imprecise?), but if `aps_create_tx_internal` is called irrespective of the second `CreateTransactionInternal` result now, I don't see a point in having the `attempting_aps_create_tx` tracepoint anymore.\r\n\r\nIt helps us know whether the selected_coins tracepoint (that will happen within CreateTransactionInternal) is for the APS CreateTransactionInternal without having to look backwards when `aps_create_tx_internal` is seen.",
      "created_at" : "2022-04-27T16:27:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25003#issuecomment-1111207055",
      "id" : 1111207055,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25003",
      "node_id" : "IC_kwDOABII585CO6yP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1111207055/reactions"
      },
      "updated_at" : "2022-04-27T16:27:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1111207055",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 5849fa0ed9049468d7a350e289069522b3a21dbf",
      "created_at" : "2022-04-27T16:27:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25003#issuecomment-1111207797",
      "id" : 1111207797,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25003",
      "node_id" : "IC_kwDOABII585CO691",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1111207797/reactions"
      },
      "updated_at" : "2022-04-27T16:27:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1111207797",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24897](https://github.com/bitcoin/bitcoin/pull/24897) ([Draft / POC] Silent Payments by w0xlt)\n* [#24845](https://github.com/bitcoin/bitcoin/pull/24845) (wallet: createTransaction, return proper error description for  \"too-long-mempool-chain\" + introduce generic Result classes by furszy)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-04-28T02:03:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25003#issuecomment-1111659401",
      "id" : 1111659401,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25003",
      "node_id" : "IC_kwDOABII585CQpOJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1111659401/reactions"
      },
      "updated_at" : "2022-04-28T02:03:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1111659401",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25003#discussion_r864932839"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25003"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/864932839"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "small off-topic question (that has nothing to do with this PR) is why this trace context is called \"coin_selection\" when `CreateTransactionInternal` could fail for other reasons (like missing solving data, signing, etc).",
      "commit_id" : "5849fa0ed9049468d7a350e289069522b3a21dbf",
      "created_at" : "2022-05-04T14:49:46Z",
      "diff_hunk" : "@@ -994,17 +994,19 @@ bool CreateTransaction(\n         CTransactionRef tx2;\n         int nChangePosInOut2 = nChangePosIn;\n         bilingual_str error2; // fired and forgotten; if an error occurs, we discard the results\n-        if (CreateTransactionInternal(wallet, vecSend, tx2, nFeeRet2, nChangePosInOut2, error2, tmp_cc, fee_calc_out, sign)) {\n+        bool use_aps{false};\n+        bool res2 = CreateTransactionInternal(wallet, vecSend, tx2, nFeeRet2, nChangePosInOut2, error2, tmp_cc, fee_calc_out, sign);\n+        if (res2) {\n             // if fee of this alternative one is within the range of the max fee, we use this one\n-            const bool use_aps = nFeeRet2 <= nFeeRet + wallet.m_max_aps_fee;\n+            use_aps = nFeeRet2 <= nFeeRet + wallet.m_max_aps_fee;\n             wallet.WalletLogPrintf(\"Fee non-grouped = %lld, grouped = %lld, using %s\\n\", nFeeRet, nFeeRet2, use_aps ? \"grouped\" : \"non-grouped\");\n-            TRACE5(coin_selection, aps_create_tx_internal, wallet.GetName().c_str(), use_aps, res, nFeeRet2, nChangePosInOut2);\n             if (use_aps) {\n                 tx = tx2;\n                 nFeeRet = nFeeRet2;\n                 nChangePosInOut = nChangePosInOut2;\n             }\n         }\n+        TRACE5(coin_selection, aps_create_tx_internal, wallet.GetName().c_str(), use_aps, res2, nFeeRet2, nChangePosInOut2);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25003#discussion_r864932839",
      "id" : 864932839,
      "line" : 1009,
      "node_id" : "PRRC_kwDOABII584zjdPn",
      "original_commit_id" : "5849fa0ed9049468d7a350e289069522b3a21dbf",
      "original_line" : 1009,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 19,
      "pull_request_review_id" : 962009360,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25003",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/864932839/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-04T14:50:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/864932839",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   }
]
