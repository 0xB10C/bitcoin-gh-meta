[
   {
      "author_association" : "NONE",
      "body" : "I tried the workaround I suggested in the bug report, by removing the earlier of the rev*.dat files to free  up the required space to download all blocks, and then removing all rev*.dat files forcing a reindex but the result is the same. On the Mac Mini I get to 83% when the disk is full. So achieving a full node on the Mac Mini with 480 GB free space to begin with _seems_ impossible.\r\n\r\n```\r\nblocks % pwd\r\n\r\n/Users/erik/Library/Application Support/Bitcoin/blocks\r\n\r\nblocks % du -h .\r\n\r\n 90M\t./index\r\n391G\t.\r\n\r\n% df -h\r\n\r\nFilesystem          Size   Used  Avail Capacity iused      ifree %iused  Mounted on\r\n/dev/disk1s5       466Gi   10Gi   52Gi    17%  484073 4881333367    0%   /\r\ndevfs              233Ki  233Ki    0Bi   100%     808          0  100%   /dev\r\n/dev/disk1s1       466Gi  401Gi   52Gi    89%  142604 4881674836    0%   /System/Volumes/Data\r\n/dev/disk1s4       466Gi  2.0Gi   52Gi     4%       2 4881817438    0%   /private/var/vm\r\nmap auto_home        0Bi    0Bi    0Bi   100%       0          0  100%   /System/Volumes/Data/home\r\n\r\nblocks % du -ch rev*.dat | sort -n\r\n\r\n 17M\trev01912.dat\r\n 19M\trev00000.dat\r\n 32M\trev00002.dat\r\n ...\r\n 210M\trev01291.dat\r\n 250M\trev01036.dat\r\n152G\ttotal\r\n\r\nblocks % du -ch blk*.dat\r\n\r\n128M\tblk00000.dat\r\n128M\tblk00001.dat\r\n128M\tblk00002.dat\r\n...\r\n128M\tblk01912.dat\r\n125M\tblk01913.dat\r\n238G\ttotal\r\n\r\nblocks % rm rev*.dat\r\n\r\n% df -h\r\n\r\nFilesystem          Size   Used  Avail Capacity iused      ifree %iused  Mounted on\r\n/dev/disk1s5       466Gi   10Gi  204Gi     5%  484073 4881333367    0%   /\r\ndevfs              233Ki  233Ki    0Bi   100%     808          0  100%   /dev\r\n/dev/disk1s1       466Gi  248Gi  204Gi    55%  141579 4881675861    0%   /System/Volumes/Data\r\n/dev/disk1s4       466Gi  2.0Gi  204Gi     1%       2 4881817438    0%   /private/var/vm\r\nmap auto_home        0Bi    0Bi    0Bi   100%       0          0  100%   /System/Volumes/Data/home\r\n```\r\n\r\nStarted Bitcoin Core and clicked OK to rebuild the block database.\r\n\r\n![corrupted-block-database-detected](https://user-images.githubusercontent.com/20860124/71611833-e97aee00-2ba4-11ea-942b-df3d7bebeb3e.png)\r\n\r\n![reindexing-blocks-on-disk](https://user-images.githubusercontent.com/20860124/71611857-116a5180-2ba5-11ea-9e91-25c160c011b6.png)\r\n\r\n![processing-blocks-on-disk](https://user-images.githubusercontent.com/20860124/71611861-17603280-2ba5-11ea-8dd0-9101bb29712d.png)\r\n\r\n```\r\n% tail debug.log\r\n\r\n2019-12-31T04:32:26Z UpdateTip: new best=00000000000000000016319a033ba5a534d962bf17077825634a0bbcce5dbf48 height=573963 version=0x20000000 log2_work=90.59244 tx=408110896 date='2019-04-30T19:18:40Z' progress=0.832507 cache=726.0MiB(5526596txo)\r\n2019-12-31T04:32:26Z *** Disk space is too low!\r\n2019-12-31T04:32:26Z Error: Disk space is too low!\r\n2019-12-31T04:52:10Z socket sending timeout: 1201s\r\n2019-12-31T04:52:10Z socket sending timeout: 1201s\r\n2019-12-31T04:52:10Z socket sending timeout: 1201s\r\n2019-12-31T04:52:10Z socket sending timeout: 1201s\r\n2019-12-31T04:52:10Z socket sending timeout: 1201s\r\n2019-12-31T04:52:10Z socket sending timeout: 1201s\r\n2019-12-31T04:52:10Z socket sending timeout: 1201s\r\n2019-12-31T04:52:10Z socket sending timeout: 1201s\r\n2019-12-31T04:52:10Z socket sending timeout: 1201s\r\n2019-12-31T04:52:13Z socket sending timeout: 1201s\r\n2019-12-31T06:02:11Z Failed to connect best block (Disk space is too low! (code 0))\r\n2019-12-31T06:02:11Z tor: Thread interrupt\r\n2019-12-31T06:02:11Z Shutdown: In progress...\r\n2019-12-31T06:02:11Z torcontrol thread exit\r\n2019-12-31T06:02:11Z addcon thread exit\r\n2019-12-31T06:02:11Z opencon thread exit\r\n2019-12-31T06:02:11Z msghand thread exit\r\n2019-12-31T06:02:11Z net thread exit\r\n2019-12-31T06:02:11Z scheduler thread interrupt\r\n2019-12-31T06:02:11Z *** Disk space is too low!\r\n2019-12-31T06:02:11Z Error: Disk space is too low!\r\n2019-12-31T06:02:11Z ForceFlushStateToDisk: failed to flush state (Disk space is too low! (code 0))\r\n2019-12-31T06:02:11Z *** Disk space is too low!\r\n2019-12-31T06:02:11Z Error: Disk space is too low!\r\n2019-12-31T06:02:11Z ForceFlushStateToDisk: failed to flush state (Disk space is too low! (code 0))\r\n2019-12-31T06:02:12Z [default wallet] Releasing wallet\r\n2019-12-31T06:02:12Z Shutdown: done\r\n```\r\n\r\nOnce again the rev*.dat files uses 205G of disk space, the sizes range from 0B to 231M.\r\n```\r\nblocks % du -ch rev*.dat | sort -n\r\n\r\n  0B\trev01623.dat\r\n  0B\trev01624.dat\r\n  0B\trev01625.dat\r\n  0B\trev01626.dat\r\n  0B\trev01627.dat\r\n  0B\trev01628.dat\r\n...\r\n210M\trev00349.dat\r\n210M\trev00350.dat\r\n210M\trev00352.dat\r\n210M\trev00353.dat\r\n210M\trev00432.dat\r\n229M\trev00337.dat\r\n231M\trev00333.dat\r\n231M\trev00336.dat\r\n205G\ttotal\r\n\r\n% df -h\r\n                     \r\nFilesystem          Size   Used  Avail Capacity iused      ifree %iused  Mounted on\r\n/dev/disk1s5       466Gi   10Gi  247Mi    98%  484073 4881333367    0%   /\r\ndevfs              233Ki  233Ki    0Bi   100%     808          0  100%   /dev\r\n/dev/disk1s1       466Gi  452Gi  247Mi   100%  143019 4881674421    0%   /System/Volumes/Data\r\n/dev/disk1s4       466Gi  2.0Gi  247Mi    90%       2 4881817438    0%   /private/var/vm\r\nmap auto_home        0Bi    0Bi    0Bi   100%       0          0  100%   /System/Volumes/Data/home\r\n```",
      "created_at" : "2019-12-31T06:23:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/17827#issuecomment-569872745",
      "id" : 569872745,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17827",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2OTg3Mjc0NQ==",
      "updated_at" : "2019-12-31T06:23:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/569872745",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/20860124?v=4",
         "events_url" : "https://api.github.com/users/eriknylund/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eriknylund/followers",
         "following_url" : "https://api.github.com/users/eriknylund/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eriknylund/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eriknylund",
         "id" : 20860124,
         "login" : "eriknylund",
         "node_id" : "MDQ6VXNlcjIwODYwMTI0",
         "organizations_url" : "https://api.github.com/users/eriknylund/orgs",
         "received_events_url" : "https://api.github.com/users/eriknylund/received_events",
         "repos_url" : "https://api.github.com/users/eriknylund/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eriknylund/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eriknylund/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eriknylund"
      }
   }
]
