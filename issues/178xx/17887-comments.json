[
   {
      "author_association" : "MEMBER",
      "body" : "So this code has been wrong for 7 years? Why do we only notice the effect now?",
      "created_at" : "2020-01-07T13:31:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-571586468",
      "id" : 571586468,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MTU4NjQ2OA==",
      "updated_at" : "2020-01-07T13:31:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571586468",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> So this code has been wrong for 7 years? Why do we only notice the effect now?\r\n\r\nItâs likely this issue only started occurring with the introduction of APFS, which is quite recent.",
      "created_at" : "2020-01-07T13:32:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-571587229",
      "id" : 571587229,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MTU4NzIyOQ==",
      "updated_at" : "2020-01-07T13:32:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571587229",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa I suspect the OS eventually reclaims pre-allocated space, but it seems block files are not suffering from this kind of issue, so I'm honestly not sure. The docs clearly indicate we were using it wrong, though.\r\n\r\nEdit:\r\n> Itâs likely this issue only started occurring with the introduction of APFS, which is quite recent.\r\n\r\nThat is probably more likely.",
      "created_at" : "2020-01-07T13:33:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-571587438",
      "id" : 571587438,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MTU4NzQzOA==",
      "updated_at" : "2020-01-07T13:34:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571587438",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "On my machine (APFS encrypted volume), I was seeing rev00002.dat hitting 20 MB around block 135k. After this patch (running up to block 191106, then shutting down) I see\r\n```Bash\r\n$ du -ch *.dat\r\n128M\tblk00000.dat\r\n128M\tblk00001.dat\r\n128M\tblk00002.dat\r\n128M\tblk00003.dat\r\n128M\tblk00004.dat\r\n128M\tblk00005.dat\r\n128M\tblk00006.dat\r\n128M\tblk00007.dat\r\n128M\tblk00008.dat\r\n128M\tblk00009.dat\r\n128M\tblk00010.dat\r\n128M\tblk00011.dat\r\n128M\tblk00012.dat\r\n128M\tblk00013.dat\r\n128M\tblk00014.dat\r\n128M\tblk00015.dat\r\n128M\tblk00016.dat\r\n 48M\tblk00017.dat\r\n 20M\trev00000.dat\r\n 17M\trev00001.dat\r\n 17M\trev00002.dat\r\n 17M\trev00003.dat\r\n 17M\trev00004.dat\r\n 18M\trev00005.dat\r\n 18M\trev00006.dat\r\n 19M\trev00007.dat\r\n 19M\trev00008.dat\r\n 18M\trev00009.dat\r\n 18M\trev00010.dat\r\n 19M\trev00011.dat\r\n 19M\trev00012.dat\r\n 19M\trev00013.dat\r\n 19M\trev00014.dat\r\n 18M\trev00015.dat\r\n 19M\trev00016.dat\r\n5.1M\trev00017.dat\r\n2.5G\ttotal\r\n```\r\n\r\nMaster (~same block, after shutdown):\r\n```Bash\r\n$ du -ch *.dat\r\n128M\tblk00000.dat\r\n128M\tblk00001.dat\r\n128M\tblk00002.dat\r\n128M\tblk00003.dat\r\n128M\tblk00004.dat\r\n128M\tblk00005.dat\r\n128M\tblk00006.dat\r\n128M\tblk00007.dat\r\n128M\tblk00008.dat\r\n128M\tblk00009.dat\r\n128M\tblk00010.dat\r\n128M\tblk00011.dat\r\n128M\tblk00012.dat\r\n128M\tblk00013.dat\r\n128M\tblk00014.dat\r\n128M\tblk00015.dat\r\n128M\tblk00016.dat\r\n144M\tblk00017.dat\r\n 19M\trev00000.dat\r\n 17M\trev00001.dat\r\n 16M\trev00002.dat\r\n 17M\trev00003.dat\r\n 17M\trev00004.dat\r\n 18M\trev00005.dat\r\n 18M\trev00006.dat\r\n 36M\trev00007.dat\r\n 51M\trev00008.dat\r\n 18M\trev00009.dat\r\n 18M\trev00010.dat\r\n 18M\trev00011.dat\r\n162M\trev00012.dat\r\n 67M\trev00013.dat\r\n126M\trev00014.dat\r\n 51M\trev00015.dat\r\n 67M\trev00016.dat\r\n 21M\trev00017.dat\r\n3.0G\ttotal\r\n```\r\n\r\nBoth runs were after `rm -rf $BITCOINDIR`.\r\n\r\n`grep 'Pre-allocating'` results for master run, minus a small part of the start: https://pastebin.com/dXLLcRQa\r\n\r\nLooking closely at the run on master, the files are blowing up 2x in size until they are no longer used, at which point they are **sometimes** truncated to their actual size. The blow-up applies to blk files as well, but these are always truncated down after use (see blk00017.dat, which is too large because it isn't finished yet; this was after shutting Bitcoin Core down).\r\n\r\nRunning on this PR, the 2x blowup is not occurring for either files.\r\n\r\nRunning macos 10.14.6 (Mojave). User is running Catalina, so perhaps I would see the problem more often if I upgraded.",
      "created_at" : "2020-01-07T13:43:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-571591432",
      "id" : 571591432,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MTU5MTQzMg==",
      "updated_at" : "2020-01-07T15:33:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571591432",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "created_at" : "2020-01-07T13:54:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-571595731",
      "id" : 571595731,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MTU5NTczMQ==",
      "updated_at" : "2020-01-07T23:17:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571595731",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Enlightening read: https://www.mail-archive.com/filesystem-dev@lists.apple.com/msg00226.html",
      "created_at" : "2020-01-07T16:11:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-571654678",
      "id" : 571654678,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MTY1NDY3OA==",
      "updated_at" : "2020-01-07T16:11:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571654678",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Tested on MacOS 10.15.2 on an APFS volume and the problem disappears. Also tested on a mounted HFS+ disk volume and the problem disappears.",
      "created_at" : "2020-01-07T19:03:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-571725182",
      "id" : 571725182,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MTcyNTE4Mg==",
      "updated_at" : "2020-01-07T19:03:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571725182",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/54533?v=4",
         "events_url" : "https://api.github.com/users/IPGlider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/IPGlider/followers",
         "following_url" : "https://api.github.com/users/IPGlider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/IPGlider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/IPGlider",
         "id" : 54533,
         "login" : "IPGlider",
         "node_id" : "MDQ6VXNlcjU0NTMz",
         "organizations_url" : "https://api.github.com/users/IPGlider/orgs",
         "received_events_url" : "https://api.github.com/users/IPGlider/received_events",
         "repos_url" : "https://api.github.com/users/IPGlider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/IPGlider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/IPGlider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/IPGlider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-01-08T02:45:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-571867237",
      "id" : 571867237,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MTg2NzIzNw==",
      "updated_at" : "2020-01-08T02:45:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571867237",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I ran this on machine 2 in the issue report and can confirm that there is no blowup.\r\n\r\n- MacBook Pro (15-inch, 2018)\r\n- 2,6 GHz 6-Core Intel Core i7\r\n- 32 GB 2400 MHz DDR4\r\n- macOS Catalina 10.15.2 (upgraded from Mojave)\r\n\r\nTested on an APFS unencrypted disk image with 3 GB in size and let it run until the image was full:\r\n```\r\n$ ./bitcoind -datadir=/Volumes/APFS\r\n2020-01-09T19:43:17Z UpdateTip: \r\nnew best=000000000000059cfb1620756c7a88b679dfcbedc1d3c255dbc0f09481f8021b\r\nheight=191055 version=0x00000001 log2_work=68.451374 tx=5349799 \r\ndate='2012-07-27T17:15:53Z' progress=0.010844 cache=292.8MiB(2160691txo)\r\n2020-01-09T19:43:19Z *** Disk space is too low!\r\n\r\n$ cd /Volumes/APFS/blocks/\r\n\r\n$ du -ch *.dat\r\n128M\tblk00000.dat\r\n128M\tblk00001.dat\r\n128M\tblk00002.dat\r\n128M\tblk00003.dat\r\n128M\tblk00004.dat\r\n128M\tblk00005.dat\r\n128M\tblk00006.dat\r\n128M\tblk00007.dat\r\n128M\tblk00008.dat\r\n128M\tblk00009.dat\r\n128M\tblk00010.dat\r\n128M\tblk00011.dat\r\n128M\tblk00012.dat\r\n128M\tblk00013.dat\r\n128M\tblk00014.dat\r\n128M\tblk00015.dat\r\n128M\tblk00016.dat\r\n 48M\tblk00017.dat\r\n 20M\trev00000.dat\r\n 17M\trev00001.dat\r\n 16M\trev00002.dat\r\n 17M\trev00003.dat\r\n 18M\trev00004.dat\r\n 18M\trev00005.dat\r\n 19M\trev00006.dat\r\n 18M\trev00007.dat\r\n 19M\trev00008.dat\r\n 18M\trev00009.dat\r\n 19M\trev00010.dat\r\n 18M\trev00011.dat\r\n 18M\trev00012.dat\r\n 18M\trev00013.dat\r\n 19M\trev00014.dat\r\n 18M\trev00015.dat\r\n 19M\trev00016.dat\r\n5.0M\trev00017.dat\r\n2.5G\ttotal\r\n```\r\n\r\nTested on a Mac OS Extended (HFS+) unencrypted disk image with 3 GB in size:\r\n```\r\n$ ./bitcoind -datadir=/Volumes/HFS+/\r\n2020-01-09T20:13:51Z UpdateTip: \r\nnew best=00000000000004e055fbb153a6371891f7dc52adbe525b3a5cf3b9413fde7551 \r\nheight=189775 version=0x00000001 log2_work=68.414219 tx=5084658 \r\ndate='2012-07-19T07:39:48Z' progress=0.010306 cache=285.6MiB(2101977txo)\r\n2020-01-09T20:13:51Z Error: Disk space is too low!\r\n\r\n$ cd /Volumes/HFS+/blocks/\r\n\r\n$ du -ch *.dat\r\n128M\tblk00000.dat\r\n128M\tblk00001.dat\r\n128M\tblk00002.dat\r\n128M\tblk00003.dat\r\n128M\tblk00004.dat\r\n128M\tblk00005.dat\r\n128M\tblk00006.dat\r\n128M\tblk00007.dat\r\n128M\tblk00008.dat\r\n128M\tblk00009.dat\r\n128M\tblk00010.dat\r\n128M\tblk00011.dat\r\n128M\tblk00012.dat\r\n128M\tblk00013.dat\r\n128M\tblk00014.dat\r\n128M\tblk00015.dat\r\n 64M\tblk00016.dat\r\n 19M\trev00000.dat\r\n 17M\trev00001.dat\r\n 16M\trev00002.dat\r\n 16M\trev00003.dat\r\n 17M\trev00004.dat\r\n 17M\trev00005.dat\r\n 18M\trev00006.dat\r\n 18M\trev00007.dat\r\n 18M\trev00008.dat\r\n 18M\trev00009.dat\r\n 18M\trev00010.dat\r\n 18M\trev00011.dat\r\n 18M\trev00012.dat\r\n 18M\trev00013.dat\r\n 18M\trev00014.dat\r\n 18M\trev00015.dat\r\n8.0M\trev00016.dat\r\n2.3G\ttotal\r\n```",
      "created_at" : "2020-01-09T20:18:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-572737177",
      "id" : 572737177,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MjczNzE3Nw==",
      "updated_at" : "2020-01-09T20:18:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/572737177",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/20860124?v=4",
         "events_url" : "https://api.github.com/users/eriknylund/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eriknylund/followers",
         "following_url" : "https://api.github.com/users/eriknylund/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eriknylund/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eriknylund",
         "id" : 20860124,
         "login" : "eriknylund",
         "node_id" : "MDQ6VXNlcjIwODYwMTI0",
         "organizations_url" : "https://api.github.com/users/eriknylund/orgs",
         "received_events_url" : "https://api.github.com/users/eriknylund/received_events",
         "repos_url" : "https://api.github.com/users/eriknylund/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eriknylund/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eriknylund/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eriknylund"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I also built a Bitcoin-Qt.dmg and started a fresh download on machine 1 in the issue report, to verify that I can successfully complete the initial block download on the Mac mini with 480 GB of free disk space at the start. ETA 3 days.",
      "created_at" : "2020-01-09T20:44:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-572746538",
      "id" : 572746538,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3Mjc0NjUzOA==",
      "updated_at" : "2020-01-09T20:44:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/572746538",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/20860124?v=4",
         "events_url" : "https://api.github.com/users/eriknylund/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eriknylund/followers",
         "following_url" : "https://api.github.com/users/eriknylund/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eriknylund/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eriknylund",
         "id" : 20860124,
         "login" : "eriknylund",
         "node_id" : "MDQ6VXNlcjIwODYwMTI0",
         "organizations_url" : "https://api.github.com/users/eriknylund/orgs",
         "received_events_url" : "https://api.github.com/users/eriknylund/received_events",
         "repos_url" : "https://api.github.com/users/eriknylund/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eriknylund/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eriknylund/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eriknylund"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've just finished a from scratch sync using this PR + 17892, on an macOS (APFS) machine. Data directory is the expected size. No longer seeing very large rev*.dat files, most are between 16 and 21mb.",
      "created_at" : "2020-01-10T05:06:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-572875388",
      "id" : 572875388,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3Mjg3NTM4OA==",
      "updated_at" : "2020-01-10T05:06:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/572875388",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> I also built a Bitcoin-Qt.dmg and started a fresh download on machine 1 in the issue report, to verify that I can successfully complete the initial block download on the Mac mini with 480 GB of free disk space at the start. ETA 3 days.\r\n\r\n> I've just finished a from scratch sync using this PR + 17892, on an macOS (APFS) machine. Data directory is the expected size. No longer seeing very large rev*.dat files, most are between 16 and 21mb.\r\n\r\nThe IBD is now complete and the estimate is spot on. 280 GB of disk space is used. The rev*.dat file sizes are in the range 12-27 MB.\r\n```\r\nBitcoin % pwd\r\n/Users/erik/Library/Application Support/Bitcoin\r\n\r\nBitcoin % du -h .\r\n 92M\t./blocks/index\r\n276G\t./blocks\r\n3.7G\t./chainstate\r\n2.0M\t./wallets/database\r\n4.0M\t./wallets\r\n280G\t.\r\n\r\nBitcoin % tail debug.log\r\n2020-01-12T17:17:44Z UpdateTip: \r\nnew best=000000000000000000141d63c0a927235c7e21b39f8c632f9b7e70a9f3fb1659 \r\nheight=612543 version=0x3fffe000 log2_work=91.544872 tx=492581053 \r\ndate='2020-01-12T17:17:13Z' progress=1.000000 cache=259.8MiB(1712729txo) \r\nwarning='71 of last 100 blocks have unexpected version'\r\n\r\nBitcoin % du -ch blocks/rev*.dat | sort -n\r\n 12M\tblocks/rev00311.dat\r\n 12M\tblocks/rev01927.dat\r\n 14M\tblocks/rev00314.dat\r\n...\r\n 23M\tblocks/rev00337.dat\r\n 24M\tblocks/rev01037.dat\r\n 27M\tblocks/rev01036.dat\r\n 35G\ttotal\r\n```",
      "created_at" : "2020-01-12T17:24:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-573437436",
      "id" : 573437436,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MzQzNzQzNg==",
      "updated_at" : "2020-01-12T17:58:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/573437436",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/20860124?v=4",
         "events_url" : "https://api.github.com/users/eriknylund/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eriknylund/followers",
         "following_url" : "https://api.github.com/users/eriknylund/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eriknylund/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eriknylund",
         "id" : 20860124,
         "login" : "eriknylund",
         "node_id" : "MDQ6VXNlcjIwODYwMTI0",
         "organizations_url" : "https://api.github.com/users/eriknylund/orgs",
         "received_events_url" : "https://api.github.com/users/eriknylund/received_events",
         "repos_url" : "https://api.github.com/users/eriknylund/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eriknylund/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eriknylund/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eriknylund"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Looking a bit more into the rev files I see what is most likely the truncation issue @kallewoof discovered in https://github.com/bitcoin/bitcoin/issues/17890\r\n```\r\nBitcoin % du -h blocks/rev00337.dat blocks/rev01037.dat blocks/rev01036.dat\r\n 23M\tblocks/rev00337.dat\r\n 24M\tblocks/rev01037.dat\r\n 27M\tblocks/rev01036.dat\r\nBitcoin % ls -lh blocks/rev00337.dat blocks/rev01037.dat blocks/rev01036.dat\r\n-rw-------  1 erik  staff    21M Jan 10 10:46 blocks/rev00337.dat\r\n-rw-------  1 erik  staff    23M Jan 11 12:56 blocks/rev01036.dat\r\n-rw-------  1 erik  staff    21M Jan 11 12:58 blocks/rev01037.dat\r\n```",
      "created_at" : "2020-01-12T19:57:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-573451085",
      "id" : 573451085,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MzQ1MTA4NQ==",
      "updated_at" : "2020-01-12T19:57:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/573451085",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/20860124?v=4",
         "events_url" : "https://api.github.com/users/eriknylund/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eriknylund/followers",
         "following_url" : "https://api.github.com/users/eriknylund/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eriknylund/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eriknylund",
         "id" : 20860124,
         "login" : "eriknylund",
         "node_id" : "MDQ6VXNlcjIwODYwMTI0",
         "organizations_url" : "https://api.github.com/users/eriknylund/orgs",
         "received_events_url" : "https://api.github.com/users/eriknylund/received_events",
         "repos_url" : "https://api.github.com/users/eriknylund/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eriknylund/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eriknylund/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eriknylund"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks! Yeah, we will have to do a one time run-through of all the rev files to clean up the excess use, or we will end up with wasted space for everyone.. I'm honestly not sure why this isn't affecting other systems though. The finalize issue is not mac specific (only the over-preallocating issue is).",
      "created_at" : "2020-01-13T04:28:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-573503652",
      "id" : 573503652,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MzUwMzY1Mg==",
      "updated_at" : "2020-01-13T04:28:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/573503652",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This made me realize that this actually is a bug in the operating system. I couldn't explain why this didn't happen to earlier versions, but I believe I can now.\r\n\r\nThe bug is that ftruncate does not return pre-allocated disk space.\r\n\r\nBefore, we would over-preallocate and then immediately truncate back down to the expected size. This worked in pre-APFS land, but APFS has a bug which leaves the pre-allocated space as occupied by the file, even though we call ftruncate.\r\n\r\nI will make a minimal test case displaying this behavior and submit a report to Apple.\r\n\r\nEdit: https://openradar.appspot.com/radar?id=4930713610616832\r\n\r\nEdit: I updated the bug report above with information on `F_PUNCHHOLE`, which appears to be the way to un-preallocate (return) space; this does nothing, however.",
      "created_at" : "2020-01-13T04:36:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-573504904",
      "id" : 573504904,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MzUwNDkwNA==",
      "updated_at" : "2020-01-14T09:00:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/573504904",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17887#discussion_r366013822"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17887"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366013822"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: could `static_cast`",
      "commit_id" : "2db88bd17d67d0f6efbdaa9c6072aab7bead6dd0",
      "created_at" : "2020-01-13T20:33:40Z",
      "diff_hunk" : "@@ -978,13 +978,13 @@ void AllocateFileRange(FILE *file, unsigned int offset, unsigned int length) {\n     fst.fst_flags = F_ALLOCATECONTIG;\n     fst.fst_posmode = F_PEOFPOSMODE;\n     fst.fst_offset = 0;\n-    fst.fst_length = (off_t)offset + length;\n+    fst.fst_length = length; // mac os fst_length takes the # of free bytes to allocate, not desired file size\n     fst.fst_bytesalloc = 0;\n     if (fcntl(fileno(file), F_PREALLOCATE, &fst) == -1) {\n         fst.fst_flags = F_ALLOCATEALL;\n         fcntl(fileno(file), F_PREALLOCATE, &fst);\n     }\n-    ftruncate(fileno(file), fst.fst_length);\n+    ftruncate(fileno(file), (off_t)offset + length);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#discussion_r366013822",
      "id" : 366013822,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjAxMzgyMg==",
      "original_commit_id" : "5de93dced1a2d10b21ce0afa3bfb293cf58071e9",
      "original_position" : 12,
      "path" : "src/util/system.cpp",
      "position" : null,
      "pull_request_review_id" : 342120365,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17887",
      "updated_at" : "2020-01-14T02:02:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366013822",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK https://github.com/bitcoin/bitcoin/pull/17887/commits/5de93dced1a2d10b21ce0afa3bfb293cf58071e9 also checked `man fcntl` locally",
      "created_at" : "2020-01-13T20:35:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-573858010",
      "id" : 573858010,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3Mzg1ODAxMA==",
      "updated_at" : "2020-01-13T20:35:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/573858010",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17887#discussion_r366122599"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17887"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366122599"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "2db88bd17d67d0f6efbdaa9c6072aab7bead6dd0",
      "created_at" : "2020-01-14T02:08:42Z",
      "diff_hunk" : "@@ -978,13 +978,13 @@ void AllocateFileRange(FILE *file, unsigned int offset, unsigned int length) {\n     fst.fst_flags = F_ALLOCATECONTIG;\n     fst.fst_posmode = F_PEOFPOSMODE;\n     fst.fst_offset = 0;\n-    fst.fst_length = (off_t)offset + length;\n+    fst.fst_length = length; // mac os fst_length takes the # of free bytes to allocate, not desired file size\n     fst.fst_bytesalloc = 0;\n     if (fcntl(fileno(file), F_PREALLOCATE, &fst) == -1) {\n         fst.fst_flags = F_ALLOCATEALL;\n         fcntl(fileno(file), F_PREALLOCATE, &fst);\n     }\n-    ftruncate(fileno(file), fst.fst_length);\n+    ftruncate(fileno(file), (off_t)offset + length);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#discussion_r366122599",
      "id" : 366122599,
      "in_reply_to_id" : 366013822,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjEyMjU5OQ==",
      "original_commit_id" : "5de93dced1a2d10b21ce0afa3bfb293cf58071e9",
      "original_position" : 12,
      "path" : "src/util/system.cpp",
      "position" : null,
      "pull_request_review_id" : 342255134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17887",
      "updated_at" : "2020-01-14T02:08:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366122599",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@arvidn Any chance you could comment here, given you patched an [APFS related issue in libtorrent](https://github.com/arvidn/libtorrent/pull/2450) some time ago?",
      "created_at" : "2020-01-14T12:27:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-574151224",
      "id" : 574151224,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NDE1MTIyNA==",
      "updated_at" : "2020-01-14T12:27:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/574151224",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "This patch changes the behavior of `AllocateFileRange()`, which is documented to:\r\n\r\n> this function tries to make a particular range of a file allocated (corresponding to disk space) it is advisory, and the range specified in the arguments will never contain live data\r\n\r\nIt doesn't seem like this patch correctly implements the documented behavior. It might fix an issue in how `AllocateFileRange()` is used, but there still seems to be a mismatch in how `AllocateFileRange()` behaves on other operating systems and what it's documented to do.\r\n\r\nIf I understand the mailing list post Dominic Giampaolo correctly, in order to implement the documented behavior of `AllocateFileRange()` you would also need to `stat()` the file and set:\r\n\r\n```\r\nfst.fst_length = offset + length - st_size;\r\n```\r\n\r\nand if `offset + length` < `st_size`, skip the `fcntl()` call entirely.",
      "created_at" : "2020-01-14T13:17:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-574168424",
      "id" : 574168424,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NDE2ODQyNA==",
      "updated_at" : "2020-01-14T13:17:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/574168424",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/661450?v=4",
         "events_url" : "https://api.github.com/users/arvidn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/arvidn/followers",
         "following_url" : "https://api.github.com/users/arvidn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/arvidn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/arvidn",
         "id" : 661450,
         "login" : "arvidn",
         "node_id" : "MDQ6VXNlcjY2MTQ1MA==",
         "organizations_url" : "https://api.github.com/users/arvidn/orgs",
         "received_events_url" : "https://api.github.com/users/arvidn/received_events",
         "repos_url" : "https://api.github.com/users/arvidn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/arvidn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/arvidn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/arvidn"
      }
   }
]
