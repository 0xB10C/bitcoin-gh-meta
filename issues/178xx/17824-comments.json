[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#17621](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17621.html) (IsUsedDestination should count any known single-key address by instagibbs)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-12-29T04:48:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17824#issuecomment-569474624",
      "id" : 569474624,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17824",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2OTQ3NDYyNA==",
      "updated_at" : "2019-12-29T04:48:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/569474624",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r362013208"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362013208"
         }
      },
      "author_association" : "MEMBER",
      "body" : "what assumptions does this test have?\r\n\r\nSeems like it assumes the wallet has no more than 10*21 BTC? In other words, those sends completely drain the wallet of other UTXO addresses. This should be asserted and/or programmatically done.",
      "commit_id" : "6004cce8747629b91dd71b43949e01342e4ff334",
      "created_at" : "2019-12-30T15:18:40Z",
      "diff_hunk" : "@@ -240,5 +242,26 @@ def test_fund_send_fund_send(self):\n         assert_approx(self.nodes[1].getbalance(), 1, 0.001)\n         assert_approx(self.nodes[1].getbalance(avoid_reuse=False), 11, 0.001)\n \n+    def test_destination_groupings(self):\n+        '''\n+        If a destination has more than 10 outputs, exactly 10 outputs should",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r362013208",
      "id" : 362013208,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjAxMzIwOA==",
      "original_commit_id" : "6004cce8747629b91dd71b43949e01342e4ff334",
      "original_position" : 15,
      "path" : "test/functional/wallet_avoidreuse.py",
      "position" : 15,
      "pull_request_review_id" : 337139160,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
      "updated_at" : "2019-12-30T15:18:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362013208",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r362064719"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362064719"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ISTM a cleaner approach would be to move `groups` down before the return and just keep everything in the map. When there are more than 10 outputs in a group, just stop adding to the group. This would also handle the case of 20 outputs.\r\n\r\nUnless our goal is to have multiple groups when more than 10 outputs for a destination?\r\n\r\ncc @kallewoof ",
      "commit_id" : "6004cce8747629b91dd71b43949e01342e4ff334",
      "created_at" : "2019-12-30T18:43:26Z",
      "diff_hunk" : "@@ -3977,6 +3977,7 @@ std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outpu\n     std::vector<OutputGroup> groups;\n     std::map<CTxDestination, OutputGroup> gmap;\n     CTxDestination dst;\n+    std::set<CTxDestination> full_groups;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r362064719",
      "id" : 362064719,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjA2NDcxOQ==",
      "original_commit_id" : "6004cce8747629b91dd71b43949e01342e4ff334",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : 4,
      "pull_request_review_id" : 337201270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
      "updated_at" : "2019-12-30T18:43:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362064719",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r362143748"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362143748"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The intention was that if there were a ton of spends to the same address, these would be chunked into randomized 10 UTXO chunks, to avoid creating too large transactions. So yeah, the intention was to have multiple groups for the same destination in cases where there were 11+ UTXOs for it.",
      "commit_id" : "6004cce8747629b91dd71b43949e01342e4ff334",
      "created_at" : "2019-12-31T03:49:54Z",
      "diff_hunk" : "@@ -3977,6 +3977,7 @@ std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outpu\n     std::vector<OutputGroup> groups;\n     std::map<CTxDestination, OutputGroup> gmap;\n     CTxDestination dst;\n+    std::set<CTxDestination> full_groups;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r362143748",
      "id" : 362143748,
      "in_reply_to_id" : 362064719,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjE0Mzc0OA==",
      "original_commit_id" : "6004cce8747629b91dd71b43949e01342e4ff334",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : 4,
      "pull_request_review_id" : 337291810,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
      "updated_at" : "2019-12-31T03:49:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362143748",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The reported issue seems like things are not working as they should for sure, but I don't see how this code fixes it. Ultimately, if I want to send 10.5 bitcoin to you, and I have 500 UTXO:s of  1 BTC each all sending to A, the grouping part should result in 50 groups of 10 random UTXO:s each (each group worth 10 BTC), and two of these should be selected when sending, and ALL of the outputs should be marked as used afterwards.\r\n\r\nYour code seems to change this behavior to only result in one 10 BTC group per destination, which means the above send will result in \"insufficient funds\".",
      "created_at" : "2019-12-31T03:55:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17824#issuecomment-569858933",
      "id" : 569858933,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17824",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2OTg1ODkzMw==",
      "updated_at" : "2019-12-31T03:55:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/569858933",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   }
]
