[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21055 ([Bundle 3/n] Prune remaining g_chainman usage in validation functions by dongcarl)\n* #20556 (rpc: Properly document return values (submitblock, gettxout, getblocktemplate, scantxoutset) by MarcoFalke)\n* #20354 (test: Add feature_taproot.py --previous_release by MarcoFalke)\n* #20158 (tree-wide: De-globalize ChainstateManager by dongcarl)\n* #19438 (Introduce deploymentstatus by ajtowns)\n* #10102 ([experimental] Multiprocess bitcoin by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-07-24T03:31:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19573#issuecomment-663332066",
      "id" : 663332066,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19573",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2MzMzMjA2Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-04T16:30:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/663332066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and updated with some of @aj's changes to BIP 8.\r\n\r\nThis is probably still not the final form of BIP 8 (see https://github.com/bitcoin/bips/pull/950), but merging this sooner means we have fewer changes to backport together with the activation parameters later on.\r\n\r\n(It also means the RPC interfaces are updated now instead of later)",
      "created_at" : "2020-10-15T18:30:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19573#issuecomment-709512644",
      "id" : 709512644,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19573",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwOTUxMjY0NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-15T18:30:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/709512644",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19573#discussion_r507418503"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19573"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507418503"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe `DeploymentParams` ? Might be good to do as many of the renames as possible via scripted-diff.",
      "commit_id" : "6f27bdeba74d8dca680efc32b16226d255eec19d",
      "created_at" : "2020-10-19T03:44:17Z",
      "diff_hunk" : "@@ -20,24 +20,29 @@ enum DeploymentPos\n };\n \n /**\n- * Struct for each individual consensus rule change using BIP9.\n+ * Struct for each individual consensus rule change using version bits (BIP 8).\n  */\n-struct BIP9Deployment {\n+struct VBitsDeployment {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19573#discussion_r507418503",
      "id" : 507418503,
      "line" : 25,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQxODUwMw==",
      "original_commit_id" : "22f81eaebef2a548ed2ddd7a8a8d1b23b3eb73db",
      "original_line" : 25,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 8,
      "pull_request_review_id" : 511393873,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19573",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-07T19:53:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507418503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19573#discussion_r507435498"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19573"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507435498"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe both startheight and timeoutheight should be set to ALWAYS_ACTIVE in the same way they are for NEVER_ACTIVE.",
      "commit_id" : "6f27bdeba74d8dca680efc32b16226d255eec19d",
      "created_at" : "2020-10-19T04:15:43Z",
      "diff_hunk" : "@@ -20,24 +20,29 @@ enum DeploymentPos\n };\n \n /**\n- * Struct for each individual consensus rule change using BIP9.\n+ * Struct for each individual consensus rule change using version bits (BIP 8).\n  */\n-struct BIP9Deployment {\n+struct VBitsDeployment {\n     /** Bit position to select the particular bit in nVersion. */\n     int bit;\n-    /** Start MedianTime for version bits miner confirmation. Can be a date in the past */\n-    int64_t nStartTime;\n-    /** Timeout/expiry MedianTime for the deployment attempt. */\n-    int64_t nTimeout;\n+    /** Start block height for version bits miner confirmation. Should be a retarget block, can be in the past. */\n+    int64_t startheight;\n+    /** Timeout/expiry block height for the deployment attempt. Should be a retarget block. */\n+    int64_t timeoutheight;\n+    /** If true, final period before timeout will transition to MUST_SIGNAL. */\n+    bool lockinontimeout{false};\n \n-    /** Constant for nTimeout very far in the future. */\n+    /** Constant for timeoutheight very far in the future. */\n     static constexpr int64_t NO_TIMEOUT = std::numeric_limits<int64_t>::max();\n \n-    /** Special value for nStartTime indicating that the deployment is always active.\n+    /** Special value for startheight indicating that the deployment is always active.\n      *  This is useful for testing, as it means tests don't need to deal with the activation\n-     *  process (which takes at least 3 BIP9 intervals). Only tests that specifically test the\n+     *  process (which takes at least 3 intervals). Only tests that specifically test the\n      *  behaviour during activation cannot use this. */\n     static constexpr int64_t ALWAYS_ACTIVE = -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19573#discussion_r507435498",
      "id" : 507435498,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQzNTQ5OA==",
      "original_commit_id" : "22f81eaebef2a548ed2ddd7a8a8d1b23b3eb73db",
      "original_line" : 42,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : null,
      "pull_request_review_id" : 511393873,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19573",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-07T19:53:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507435498",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19573#discussion_r507607219"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19573"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507607219"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is no longer `mainnet` params...",
      "commit_id" : "6f27bdeba74d8dca680efc32b16226d255eec19d",
      "created_at" : "2020-10-19T09:35:04Z",
      "diff_hunk" : "@@ -249,100 +261,67 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n {\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n+    const auto period = CreateChainParams(*m_node.args, CBaseChainParams::REGTEST)->GetConsensus().nMinerConfirmationWindow;\n+    gArgs.ForceSetArg(\"-vbparams\", strprintf(\"testdummy:@%s:@%s\", period, period * 2));\n+    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::REGTEST);\n     const Consensus::Params &mainnetParams = chainParams->GetConsensus();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19573#discussion_r507607219",
      "id" : 507607219,
      "line" : 249,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYwNzIxOQ==",
      "original_commit_id" : "22f81eaebef2a548ed2ddd7a8a8d1b23b3eb73db",
      "original_line" : 249,
      "original_position" : 186,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 302,
      "pull_request_review_id" : 511393873,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19573",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-07T19:53:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/507607219",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19573#discussion_r509038469"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19573"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509038469"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not sure why it's a new error, but clang insists that these need to be initialised, and is causing travis to fail.",
      "commit_id" : "6f27bdeba74d8dca680efc32b16226d255eec19d",
      "created_at" : "2020-10-21T07:09:33Z",
      "diff_hunk" : "@@ -475,21 +480,21 @@ void CRegTestParams::UpdateActivationParametersFromArgs(const ArgsManager& args)\n         std::vector<std::string> vDeploymentParams;\n         boost::split(vDeploymentParams, strDeployment, boost::is_any_of(\":\"));\n         if (vDeploymentParams.size() != 3) {\n-            throw std::runtime_error(\"Version bits parameters malformed, expecting deployment:start:end\");\n+            throw std::runtime_error(\"Version bits parameters malformed, expecting deployment:@startheight:@timeoutheight\");\n         }\n-        int64_t nStartTime, nTimeout;\n-        if (!ParseInt64(vDeploymentParams[1], &nStartTime)) {\n-            throw std::runtime_error(strprintf(\"Invalid nStartTime (%s)\", vDeploymentParams[1]));\n+        int64_t startheight, timeoutheight;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19573#discussion_r509038469",
      "id" : 509038469,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAzODQ2OQ==",
      "original_commit_id" : "22f81eaebef2a548ed2ddd7a8a8d1b23b3eb73db",
      "original_line" : 485,
      "original_position" : 119,
      "original_start_line" : null,
      "path" : "src/chainparams.cpp",
      "position" : null,
      "pull_request_review_id" : 511393873,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19573",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-07T19:53:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509038469",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19573#discussion_r509038840"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19573"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509038840"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Need to also special case `NEVER_ACTIVE` here.",
      "commit_id" : "6f27bdeba74d8dca680efc32b16226d255eec19d",
      "created_at" : "2020-10-21T07:10:15Z",
      "diff_hunk" : "@@ -9,11 +9,12 @@ ThresholdState AbstractThresholdConditionChecker::GetStateFor(const CBlockIndex*\n {\n     int nPeriod = Period(params);\n     int nThreshold = Threshold(params);\n-    int64_t nTimeStart = BeginTime(params);\n-    int64_t nTimeTimeout = EndTime(params);\n+    int64_t height_start = StartHeight(params);\n+    int64_t height_timeout = TimeoutHeight(params);\n+    const bool lockinontimeout = LockinOnTimeout(params);\n \n     // Check if this deployment is always active.\n-    if (nTimeStart == Consensus::BIP9Deployment::ALWAYS_ACTIVE) {\n+    if (height_start == Consensus::VBitsDeployment::ALWAYS_ACTIVE) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19573#discussion_r509038840",
      "id" : 509038840,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAzODg0MA==",
      "original_commit_id" : "22f81eaebef2a548ed2ddd7a8a8d1b23b3eb73db",
      "original_line" : 17,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : null,
      "pull_request_review_id" : 511393873,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19573",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-07T19:53:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509038840",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19573#discussion_r509222807"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19573"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509222807"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`startheight = 144` would be more accurate, it can't actually start at height 0.\r\n\r\n(This caused a weird bug in `validation_blocks_tests` when I tried implementing bitcoin/bips#1023 and it was able to go to STARTED in the first block; didn't track down exactly what the issue was though)",
      "commit_id" : "6f27bdeba74d8dca680efc32b16226d255eec19d",
      "created_at" : "2020-10-21T12:07:28Z",
      "diff_hunk" : "@@ -388,11 +393,11 @@ class CRegTestParams : public CChainParams {\n         consensus.nRuleChangeActivationThreshold = 108; // 75% for testchains\n         consensus.nMinerConfirmationWindow = 144; // Faster than normal for regtest (144 instead of 2016)\n         consensus.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit = 28;\n-        consensus.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime = 0;\n-        consensus.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout = Consensus::BIP9Deployment::NO_TIMEOUT;\n+        consensus.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].startheight = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19573#discussion_r509222807",
      "id" : 509222807,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTIyMjgwNw==",
      "original_commit_id" : "22f81eaebef2a548ed2ddd7a8a8d1b23b3eb73db",
      "original_line" : 396,
      "original_position" : 85,
      "original_start_line" : null,
      "path" : "src/chainparams.cpp",
      "position" : null,
      "pull_request_review_id" : 511393873,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19573",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-07T19:53:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509222807",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-11-09T16:54:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19573#issuecomment-724138406",
      "id" : 724138406,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19573",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyNDEzODQwNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-09T16:54:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/724138406",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. \r\n\r\nSince revised BIP 8 is a strict improvement on BIP 9 it doesn't hurt to replace BIP 9 logic with revised BIP 8 logic. AJ has [highlighted](https://github.com/bitcoin/bitcoin/pull/19573#pullrequestreview-511393873) some bugs, improvements that haven't been addressed yet. I also don't know if you are waiting for revised BIP 8 to be finalized at this point before a rebased version of this is ready to be merged.",
      "created_at" : "2021-02-01T10:14:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19573#issuecomment-770742005",
      "id" : 770742005,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19573",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MDc0MjAwNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-01T10:14:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/770742005",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased, merged in @ajtowns's fixes and other changes, and got CI passing.",
      "created_at" : "2021-02-08T04:45:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19573#issuecomment-774861919",
      "id" : 774861919,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19573",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NDg2MTkxOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-08T04:45:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/774861919",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19573#discussion_r572579383"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19573"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572579383"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Test should be `thresholdState != ThresholdState::LOCKED_IN` -- now that https://github.com/bitcoin/bips/pull/1021/ is merged, threshold is still relevant during MUST_SIGNAL phase.",
      "commit_id" : "6f27bdeba74d8dca680efc32b16226d255eec19d",
      "created_at" : "2021-02-09T04:05:52Z",
      "diff_hunk" : "@@ -1211,46 +1211,48 @@ static void BuriedForkDescPushBack(UniValue& softforks, const std::string &name,\n     softforks.pushKV(name, rv);\n }\n \n-static void BIP9SoftForkDescPushBack(UniValue& softforks, const std::string &name, const Consensus::Params& consensusParams, Consensus::DeploymentPos id) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+static void VBitsSoftForkDescPushBack(UniValue& softforks, const std::string &name, const Consensus::Params& consensusParams, Consensus::DeploymentPos id) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n {\n-    // For BIP9 deployments.\n+    // For versionbits deployments.\n     // Deployments (e.g. testdummy) with timeout value before Jan 1, 2009 are hidden.\n     // A timeout value of 0 guarantees a softfork will never be activated.\n     // This is used when merging logic to implement a proposed softfork without a specified deployment schedule.\n-    if (consensusParams.vDeployments[id].nTimeout <= 1230768000) return;\n+    if (consensusParams.vDeployments[id].IsNeverActive()) return;\n \n-    UniValue bip9(UniValue::VOBJ);\n+    UniValue details(UniValue::VOBJ);\n     const ThresholdState thresholdState = VersionBitsTipState(consensusParams, id);\n     switch (thresholdState) {\n-    case ThresholdState::DEFINED: bip9.pushKV(\"status\", \"defined\"); break;\n-    case ThresholdState::STARTED: bip9.pushKV(\"status\", \"started\"); break;\n-    case ThresholdState::LOCKED_IN: bip9.pushKV(\"status\", \"locked_in\"); break;\n-    case ThresholdState::ACTIVE: bip9.pushKV(\"status\", \"active\"); break;\n-    case ThresholdState::FAILED: bip9.pushKV(\"status\", \"failed\"); break;\n-    }\n-    if (ThresholdState::STARTED == thresholdState)\n-    {\n-        bip9.pushKV(\"bit\", consensusParams.vDeployments[id].bit);\n-    }\n-    bip9.pushKV(\"start_time\", consensusParams.vDeployments[id].nStartTime);\n-    bip9.pushKV(\"timeout\", consensusParams.vDeployments[id].nTimeout);\n+    case ThresholdState::DEFINED: details.pushKV(\"status\", \"defined\"); break;\n+    case ThresholdState::STARTED: details.pushKV(\"status\", \"started\"); break;\n+    case ThresholdState::MUST_SIGNAL: details.pushKV(\"status\", \"must_signal\"); break;\n+    case ThresholdState::LOCKED_IN: details.pushKV(\"status\", \"locked_in\"); break;\n+    case ThresholdState::ACTIVE: details.pushKV(\"status\", \"active\"); break;\n+    case ThresholdState::FAILED: details.pushKV(\"status\", \"failed\"); break;\n+    }\n+    if (ThresholdState::STARTED == thresholdState || ThresholdState::MUST_SIGNAL == thresholdState || ThresholdState::LOCKED_IN == thresholdState) {\n+        details.pushKV(\"bit\", consensusParams.vDeployments[id].bit);\n+    }\n+    details.pushKV(\"startheight\", consensusParams.vDeployments[id].startheight);\n+    details.pushKV(\"timeoutheight\", consensusParams.vDeployments[id].timeoutheight);\n+    details.pushKV(\"lockinontimeout\", consensusParams.vDeployments[id].lockinontimeout);\n     int64_t since_height = VersionBitsTipStateSinceHeight(consensusParams, id);\n-    bip9.pushKV(\"since\", since_height);\n-    if (ThresholdState::STARTED == thresholdState)\n-    {\n+    details.pushKV(\"since\", since_height);\n+    if (ThresholdState::STARTED == thresholdState || ThresholdState::MUST_SIGNAL == thresholdState || ThresholdState::LOCKED_IN == thresholdState) {\n         UniValue statsUV(UniValue::VOBJ);\n-        BIP9Stats statsStruct = VersionBitsTipStatistics(consensusParams, id);\n+        VBitsStats statsStruct = VersionBitsTipStatistics(consensusParams, id);\n         statsUV.pushKV(\"period\", statsStruct.period);\n-        statsUV.pushKV(\"threshold\", statsStruct.threshold);\n+        if (ThresholdState::STARTED == thresholdState) {\n+            statsUV.pushKV(\"threshold\", statsStruct.threshold);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19573#discussion_r572579383",
      "id" : 572579383,
      "line" : 1245,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjU3OTM4Mw==",
      "original_commit_id" : "6f27bdeba74d8dca680efc32b16226d255eec19d",
      "original_line" : 1245,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 56,
      "pull_request_review_id" : 586163827,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19573",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T04:17:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572579383",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   }
]
