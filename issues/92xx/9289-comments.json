[
   {
      "body" : "Concept ACK",
      "created_at" : "2016-12-06T12:24:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-265137401",
      "id" : 265137401,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-06T12:24:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265137401",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Would it make sense to introduce a utility function like MilliSleep which takes a reference to a condition variable and an atomic flag? The pattern that replaces the MilliSleep calls is pretty complicated and repeats several times.",
      "created_at" : "2016-12-06T19:35:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-265249618",
      "id" : 265249618,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-06T19:35:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265249618",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Concept ACK",
      "created_at" : "2016-12-07T10:57:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-265417999",
      "id" : 265417999,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-07T10:57:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265417999",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=3",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "body" : "@sipa Sure, will do.",
      "created_at" : "2016-12-08T14:05:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-265747217",
      "id" : 265747217,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-08T14:05:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265747217",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "@sipa done. I'm not sure if it's generic enough to add to utiltime, happy to move it back to net if that makes more sense.\r\n\r\nAlso fixed up the TODO that I was mistaken about.",
      "created_at" : "2016-12-09T01:07:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-265904134",
      "id" : 265904134,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-09T01:07:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265904134",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "Just noticed that this PR would've broken interruptible proxy recvs, so I pushed a commit to fix that. The proxy code will soon be dumped anyway, so I'm ok with the hackish global there for now.\r\n\r\nAlso squashed down the header fix while I was at it.",
      "created_at" : "2016-12-16T00:51:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-267488595",
      "id" : 267488595,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-16T00:51:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/267488595",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "@TheBlueMatt I think you might be confused as to how the atomic flags are used in this code. They're used in \"clear triggered mode\", so there is no need to reset them after every check. The other usage (\"test_and_set triggered mode\") would introduce race conditions when the checking thread clears the flag as a concurrent interrupt could be cleared.",
      "created_at" : "2016-12-21T06:51:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-268450262",
      "id" : 268450262,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-21T06:51:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268450262",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "body" : "@JeremyRubin I see how they're used, am only commenting on the likelihood of this pattern introducing future bugs. Eg someone uses break instead of return and then a loop gets moved around, making the thread no longer exit.\n\nOn December 20, 2016 10:51:14 PM PST, Jeremy Rubin <notifications@github.com> wrote:\n>@TheBlueMatt I think you might be confused as to how the atomic flags\n>are used in this code. They're used in \"clear triggered mode\", so there\n>is no need to reset them after every check. The other usage\n>(\"test_and_set triggered mode\") would introduce race conditions when\n>the checking thread clears the flag as a concurrent interrupt could be\n>cleared.\n>\n>-- \n>You are receiving this because you were mentioned.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-268450262\n",
      "created_at" : "2016-12-21T08:50:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-268469097",
      "id" : 268469097,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-21T08:50:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268469097",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@TheBlueMatt ok I was responding to \"atomic_flags and resetting them to dont-wake every time you check them.\", not sure what you meant by that if not my earlier interpretation.\r\n\r\nI agree with you on the semantics being off if your worry is future code breaking it. We should either make it throw an Interruption, or call std::terminate. Changing it to an atomic_bool will not have any effect on reducing likelihood future code changes don't break intended behavior. Implemented here for comparison https://github.com/theuni/bitcoin/compare/connman-threads...JeremyRubin:connman-threads The only negative of this approach is that local cleanup can't be handled as neatly.",
      "created_at" : "2016-12-21T19:19:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-268614837",
      "id" : 268614837,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-21T19:19:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268614837",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "body" : "@JeremyRubin sadly I'm not sure about the execution propagation from within condition_variable...cppreference seems to indicate it was cleaned up in C++14, but its unclear if its guaranteed to propagation from the predicate or if it just \"may\".",
      "created_at" : "2016-12-21T20:06:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-268625684",
      "id" : 268625684,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-21T20:06:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268625684",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Thanks for clarifying the kind of bug you were imagining, I had a different type of bug in mind (there being no code flow which can cause a termination, rather than being catchable on the next iteration).\r\n\r\nYou're absolutely right on the \"may\" for exceptions thrown from wait_for.  Semantics should be fixed now (moved InterruptibleSleep into interruption_point and made the throwing external to wait_for).",
      "created_at" : "2016-12-21T20:59:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-268638123",
      "id" : 268638123,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-21T20:59:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268638123",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "body" : "@JeremyRubin ehh, I mean yes regaring wrappers, no regarding exceptions - I think its generally accepted that using exceptions in C++ is bad, and I'm not sure we want to add any more uses than we already have.",
      "created_at" : "2016-12-21T21:28:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-268644797",
      "id" : 268644797,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-21T21:28:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268644797",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@JeremyRubin and @TheBlueMatt Thanks for having a look.\r\n\r\nAfter a debate (probably more than necessary), and running it by a third party, I think I'll concede and just use an atomic bool instead. The convincing argument was that a bool allows us to deviate from the current \"got an interrupt, bail from thread!\", and lets us do quick on-thread teardown post-interruption. It will need to stay in check though, our usages of Interrupt() assume that it won't block.",
      "created_at" : "2016-12-22T02:43:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-268704281",
      "id" : 268704281,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-22T02:43:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268704281",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "@TheBlueMatt I pushed up a new attempt to  https://github.com/theuni/bitcoin/commits/connman-threads-redo. I think you'll like that much better.\r\n\r\nI need to split a few non-obvious things into different commits, but mind having a quick look at the concept?\r\n\r\nI borrowed @JeremyRubin's wrapper idea but implemented it a bit differently: https://github.com/theuni/bitcoin/commit/7b4d8f608cca17fba7311c310e74c4cbd7671b73#diff-09404f8fdd1f69609d329cb0b1f1252e\r\n\r\nThe usage is (imo) pretty straightforward: https://github.com/theuni/bitcoin/commit/7b4d8f608cca17fba7311c310e74c4cbd7671b73#diff-9a82240fe7dfe86564178691cc57f2f1L1660",
      "created_at" : "2016-12-22T07:19:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-268735467",
      "id" : 268735467,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-22T07:34:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268735467",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "@theuni Yup, really like that version.",
      "created_at" : "2016-12-22T18:17:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-268858517",
      "id" : 268858517,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-22T18:17:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268858517",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9289#discussion_r93713812"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93713812"
         }
      },
      "body" : "Generally, I think it might make sense to just rename this \"InterruptibleSleeper\" and have it own the mutex and condition_variable. Then you dont have to have its owner own memory it points to and should still be able to keep +/- the same API.",
      "commit_id" : "992bbc01a0d33fdf47a55336f82825f43ad29522",
      "created_at" : "2016-12-22T23:34:10Z",
      "diff_hunk" : "@@ -0,0 +1,51 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <mutex>\n+#include <condition_variable>\n+#include <atomic>\n+\n+class CThreadInterrupt",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#discussion_r93713812",
      "id" : 93713812,
      "original_commit_id" : "e0bdb1d62ca62c9eae570a5d3dde3267672f5ce0",
      "original_position" : 10,
      "path" : "src/threadinterrupt.h",
      "position" : null,
      "pull_request_review_id" : 14247718,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9289",
      "updated_at" : "2016-12-24T03:57:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93713812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9289#discussion_r93713941"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93713941"
         }
      },
      "body" : "Can we just move this into a member function of the class?\r\n\r\nAlso, does it need to be a template? I think if you set Duration to something that the various durations can be converted into it should do so intelligently. Would mean less stuff to compile in headers.",
      "commit_id" : "992bbc01a0d33fdf47a55336f82825f43ad29522",
      "created_at" : "2016-12-22T23:35:30Z",
      "diff_hunk" : "@@ -0,0 +1,51 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <mutex>\n+#include <condition_variable>\n+#include <atomic>\n+\n+class CThreadInterrupt\n+{\n+public:\n+    CThreadInterrupt(std::condition_variable& condIn, std::mutex& mutIn) : cond(condIn), mut(mutIn), val(false) {}\n+    void reset()\n+    {\n+        val.store(false, std::memory_order_release);\n+    }\n+    void operator()()\n+    {\n+        {\n+            std::unique_lock<std::mutex> lock(mut);\n+            val.store(true, std::memory_order_release);\n+        }\n+        cond.notify_all();\n+    }\n+    explicit operator bool() const\n+    {\n+        return val.load(std::memory_order_acquire) == true;\n+    }\n+\n+private:\n+    std::condition_variable& cond;\n+    std::mutex& mut;\n+    std::atomic<bool> val;\n+\n+    template <typename Duration>\n+    friend bool InterruptibleSleep(const Duration&, CThreadInterrupt&);\n+};\n+\n+/*\n+ * Sleep for the stated period of time, interruptible by clearing the flag and notifying the condvar.\n+ * @param   rel_time maximum time to wait. Should be a std::chrono::duration.\n+ * @param   threadInterrupt The interrupt that may wake the sleep\n+ * @returns false if the sleep was interrupted, true otherwise\n+ */\n+template <typename Duration>\n+bool InterruptibleSleep(const Duration& rel_time, CThreadInterrupt& threadInterrupt)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#discussion_r93713941",
      "id" : 93713941,
      "original_commit_id" : "e0bdb1d62ca62c9eae570a5d3dde3267672f5ce0",
      "original_position" : 47,
      "path" : "src/threadinterrupt.h",
      "position" : null,
      "pull_request_review_id" : 14247718,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9289",
      "updated_at" : "2016-12-24T03:57:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93713941",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9289#discussion_r93713996"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93713996"
         }
      },
      "body" : "Please no new implementations-in-headers. I know its mostly single-line stuff but we're fighting to reduce compile-time memory usage, so every little bit helps. :)",
      "commit_id" : "992bbc01a0d33fdf47a55336f82825f43ad29522",
      "created_at" : "2016-12-22T23:36:08Z",
      "diff_hunk" : "@@ -0,0 +1,51 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <mutex>\n+#include <condition_variable>\n+#include <atomic>\n+\n+class CThreadInterrupt\n+{\n+public:\n+    CThreadInterrupt(std::condition_variable& condIn, std::mutex& mutIn) : cond(condIn), mut(mutIn), val(false) {}\n+    void reset()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#discussion_r93713996",
      "id" : 93713996,
      "original_commit_id" : "e0bdb1d62ca62c9eae570a5d3dde3267672f5ce0",
      "original_position" : 14,
      "path" : "src/threadinterrupt.h",
      "position" : null,
      "pull_request_review_id" : 14247718,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9289",
      "updated_at" : "2016-12-24T03:57:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93713996",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9289#discussion_r93714848"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93714848"
         }
      },
      "body" : "Sometimes you'll want a real interruptible condvar, though. See https://github.com/theuni/bitcoin/commit/da68e3cf5832878fbb1951eb1eeb01d8cd22d1e1#diff-9a82240fe7dfe86564178691cc57f2f1R1887.\r\n\r\nThe alternative would be to add wait_for/wait_until/notify_one/notify_all to CThreadInterrupt, then just forward them to the condvar. But for that, you'd still need to expose the mutex.",
      "commit_id" : "992bbc01a0d33fdf47a55336f82825f43ad29522",
      "created_at" : "2016-12-22T23:45:19Z",
      "diff_hunk" : "@@ -0,0 +1,51 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <mutex>\n+#include <condition_variable>\n+#include <atomic>\n+\n+class CThreadInterrupt",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#discussion_r93714848",
      "id" : 93714848,
      "original_commit_id" : "e0bdb1d62ca62c9eae570a5d3dde3267672f5ce0",
      "original_position" : 10,
      "path" : "src/threadinterrupt.h",
      "position" : null,
      "pull_request_review_id" : 14248684,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9289",
      "updated_at" : "2016-12-24T03:57:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93714848",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9289#discussion_r93714949"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93714949"
         }
      },
      "body" : "Sure. Though some of these need to be inlined. I figured someone would yell if I added a .cpp with 2 functions :p",
      "commit_id" : "992bbc01a0d33fdf47a55336f82825f43ad29522",
      "created_at" : "2016-12-22T23:46:27Z",
      "diff_hunk" : "@@ -0,0 +1,51 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <mutex>\n+#include <condition_variable>\n+#include <atomic>\n+\n+class CThreadInterrupt\n+{\n+public:\n+    CThreadInterrupt(std::condition_variable& condIn, std::mutex& mutIn) : cond(condIn), mut(mutIn), val(false) {}\n+    void reset()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#discussion_r93714949",
      "id" : 93714949,
      "original_commit_id" : "e0bdb1d62ca62c9eae570a5d3dde3267672f5ce0",
      "original_position" : 14,
      "path" : "src/threadinterrupt.h",
      "position" : null,
      "pull_request_review_id" : 14248778,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9289",
      "updated_at" : "2016-12-24T03:57:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93714949",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9289#discussion_r93715113"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93715113"
         }
      },
      "body" : "This started out as a member function, but interrupt.sleep_for() felt awkward conceptually.\r\n\r\nWe can probably just force this to milliseconds. If we need microsecond precision later, we can just add another function.",
      "commit_id" : "992bbc01a0d33fdf47a55336f82825f43ad29522",
      "created_at" : "2016-12-22T23:48:17Z",
      "diff_hunk" : "@@ -0,0 +1,51 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <mutex>\n+#include <condition_variable>\n+#include <atomic>\n+\n+class CThreadInterrupt\n+{\n+public:\n+    CThreadInterrupt(std::condition_variable& condIn, std::mutex& mutIn) : cond(condIn), mut(mutIn), val(false) {}\n+    void reset()\n+    {\n+        val.store(false, std::memory_order_release);\n+    }\n+    void operator()()\n+    {\n+        {\n+            std::unique_lock<std::mutex> lock(mut);\n+            val.store(true, std::memory_order_release);\n+        }\n+        cond.notify_all();\n+    }\n+    explicit operator bool() const\n+    {\n+        return val.load(std::memory_order_acquire) == true;\n+    }\n+\n+private:\n+    std::condition_variable& cond;\n+    std::mutex& mut;\n+    std::atomic<bool> val;\n+\n+    template <typename Duration>\n+    friend bool InterruptibleSleep(const Duration&, CThreadInterrupt&);\n+};\n+\n+/*\n+ * Sleep for the stated period of time, interruptible by clearing the flag and notifying the condvar.\n+ * @param   rel_time maximum time to wait. Should be a std::chrono::duration.\n+ * @param   threadInterrupt The interrupt that may wake the sleep\n+ * @returns false if the sleep was interrupted, true otherwise\n+ */\n+template <typename Duration>\n+bool InterruptibleSleep(const Duration& rel_time, CThreadInterrupt& threadInterrupt)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#discussion_r93715113",
      "id" : 93715113,
      "original_commit_id" : "e0bdb1d62ca62c9eae570a5d3dde3267672f5ce0",
      "original_position" : 47,
      "path" : "src/threadinterrupt.h",
      "position" : null,
      "pull_request_review_id" : 14248926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9289",
      "updated_at" : "2016-12-24T03:57:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93715113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "Socket handler moved up just so that there's a consistent start/stop order.\r\n\r\nThanks for pointing out the MilliSleep, definitely not intentional!",
      "created_at" : "2016-12-22T23:51:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-268916125",
      "id" : 268916125,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-22T23:51:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268916125",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9289#discussion_r93715557"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9289"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93715557"
         }
      },
      "body" : "I suppose this could be rigged up with a separate condvar/mutex and some additional manual isinterruped checks.",
      "commit_id" : "992bbc01a0d33fdf47a55336f82825f43ad29522",
      "created_at" : "2016-12-22T23:53:23Z",
      "diff_hunk" : "@@ -0,0 +1,51 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <mutex>\n+#include <condition_variable>\n+#include <atomic>\n+\n+class CThreadInterrupt",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#discussion_r93715557",
      "id" : 93715557,
      "original_commit_id" : "e0bdb1d62ca62c9eae570a5d3dde3267672f5ce0",
      "original_position" : 10,
      "path" : "src/threadinterrupt.h",
      "position" : null,
      "pull_request_review_id" : 14249348,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9289",
      "updated_at" : "2016-12-24T03:57:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93715557",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "Yes, I guess my conception is different - if we make it a generic wrapper for condition variables then moving sleep into it would make sense. I thought some about what that would mean for net_processing, but missed that you'd need to expose the lock (exposing interrupt seems otherwise reasonable to me).\n\nNo longer convinced which one is nicer, up to you.\n\nOn December 22, 2016 3:48:21 PM PST, Cory Fields <notifications@github.com> wrote:\n>theuni commented on this pull request.\n>\n>\n>\n>> +    std::condition_variable& cond;\n>+    std::mutex& mut;\n>+    std::atomic<bool> val;\n>+\n>+    template <typename Duration>\n>+    friend bool InterruptibleSleep(const Duration&,\n>CThreadInterrupt&);\n>+};\n>+\n>+/*\n>+ * Sleep for the stated period of time, interruptible by clearing the\n>flag and notifying the condvar.\n>+ * @param   rel_time maximum time to wait. Should be a\n>std::chrono::duration.\n>+ * @param   threadInterrupt The interrupt that may wake the sleep\n>+ * @returns false if the sleep was interrupted, true otherwise\n>+ */\n>+template <typename Duration>\n>+bool InterruptibleSleep(const Duration& rel_time, CThreadInterrupt&\n>threadInterrupt)\n>\n>This started out as a member function, but interrupt.sleep_for() felt\n>awkward conceptually.\n>\n>We can probably just force this to milliseconds. If we need microsecond\n>precision later, we can just add another function.\n>\n>-- \n>You are receiving this because you were mentioned.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/9289\n",
      "created_at" : "2016-12-23T00:04:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-268917829",
      "id" : 268917829,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-23T00:04:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268917829",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Actually, I'm not sure you need to expose the lock, you just need to take the lock on the notifying thread prior to the notify but after setting the wakeup condition.\n\nIf you want to try it this way, I'd say you'd want to have two wakeup conditions, a wake-up and an interrupt condition, and just expose the various operations that you need. Not sure it's worth it, but I think that would be the cleanest API (modulo the too-much-wrapper potential issue).\n\nOn December 22, 2016 3:53:28 PM PST, Cory Fields <notifications@github.com> wrote:\n>theuni commented on this pull request.\n>\n>\n>\n>> @@ -0,0 +1,51 @@\n>+// Copyright (c) 2009-2010 Satoshi Nakamoto\n>+// Copyright (c) 2009-2016 The Bitcoin Core developers\n>+// Distributed under the MIT software license, see the accompanying\n>+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n>+\n>+#include <mutex>\n>+#include <condition_variable>\n>+#include <atomic>\n>+\n>+class CThreadInterrupt\n>\n>I suppose this could be rigged up with a separate condvar/mutex and\n>some additional manual isinterruped checks.\n>\n>-- \n>You are receiving this because you were mentioned.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/9289\n",
      "created_at" : "2016-12-23T00:19:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-268919416",
      "id" : 268919416,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-23T00:19:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268919416",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "That would require the wakeup condition to be atomic, no?",
      "created_at" : "2016-12-23T01:02:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-268923628",
      "id" : 268923628,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-23T01:02:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268923628",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "Yes, I believe that implies the wakeup condition must be atomic, but it can be release/acquire since a mutex unlock implies a full memory barrier.\n\nIn the other case that I proposed (doing it with two atomics - one for wake-up and one for interruption all hidden inside the object they would both be atomic and you'd want ClearWakeupState() and Wake() functions).\n\nOn December 22, 2016 5:02:46 PM PST, Cory Fields <notifications@github.com> wrote:\n>That would require the wakeup condition to be atomic, no?\n>\n>-- \n>You are receiving this because you were mentioned.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-268923628\n",
      "created_at" : "2016-12-23T02:16:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-268930136",
      "id" : 268930136,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-23T02:16:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268930136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@TheBlueMatt Pushed a round of changes after last night's IRC discussion. I hope we can compromise on this approach.",
      "created_at" : "2016-12-24T01:49:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-269063437",
      "id" : 269063437,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-24T01:49:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/269063437",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "Looks good, will do a more thourough review when you add threadinterrupt.cpp to git :)",
      "created_at" : "2016-12-24T02:05:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-269063960",
      "id" : 269063960,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-24T02:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/269063960",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "grr.. added.",
      "created_at" : "2016-12-24T04:00:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-269067788",
      "id" : 269067788,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-24T04:00:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/269067788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "utACK 992bbc01a0d33fdf47a55336f82825f43ad29522\r\nYou can remove the boost/thread.hpp include in netbase now, I believe.",
      "created_at" : "2016-12-24T18:39:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289#issuecomment-269095615",
      "id" : 269095615,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
      "updated_at" : "2016-12-24T18:39:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/269095615",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   }
]
