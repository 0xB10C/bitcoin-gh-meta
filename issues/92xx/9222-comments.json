[
   {
      "body" : "Concept ACK.",
      "created_at" : "2016-11-26T06:54:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#issuecomment-263048115",
      "id" : 263048115,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9222",
      "updated_at" : "2016-11-26T06:54:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/263048115",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Nice. Concept ACK.\r\nNeeds test.",
      "created_at" : "2016-11-26T08:29:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#issuecomment-263051382",
      "id" : 263051382,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9222",
      "updated_at" : "2016-11-26T08:29:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/263051382",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@jonasschnelli I tried finding the fundrawtransaction tests but couldn't. Where are they?\r\n\r\nsrc/test/rpc_tests.cpp seems like the natural place for them, but I see no 'fund' in there at all.",
      "created_at" : "2016-11-26T08:45:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#issuecomment-263051967",
      "id" : 263051967,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9222",
      "updated_at" : "2016-11-26T08:45:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/263051967",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "body" : "@dooglus \r\nThere is one at `./qa/rpc-tests/fundrawtransaction.py`.\r\nThe tests should make sure that the `subtractFeeFromAmount` option work in conjunction with the custom feerate option (haven't look at your code so far).",
      "created_at" : "2016-11-26T09:01:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#issuecomment-263052532",
      "id" : 263052532,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9222",
      "updated_at" : "2016-11-26T09:01:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/263052532",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@jonasschnelli Thanks for pointing me at the `qa/` directory. I hadn't noticed it before.\r\n\r\nI have added tests for `subtractFeeFromAmount`, including checking that it works in combination with custom feerate.",
      "created_at" : "2016-11-27T09:21:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#issuecomment-263111374",
      "id" : 263111374,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9222",
      "updated_at" : "2016-11-27T09:21:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/263111374",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "body" : "Concept ACK",
      "created_at" : "2016-11-28T07:23:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#issuecomment-263200387",
      "id" : 263200387,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9222",
      "updated_at" : "2016-11-28T07:23:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/263200387",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9222#discussion_r89728445"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9222"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89728445"
         }
      },
      "body" : "This will thrown an exception if one of the elements in the array is numeric. But I think this is okay.",
      "commit_id" : "6a41954895460a033afc352af5c137418591cc6b",
      "created_at" : "2016-11-28T07:32:02Z",
      "diff_hunk" : "@@ -2553,6 +2561,19 @@ UniValue fundrawtransaction(const JSONRPCRequest& request)\n             feeRate = CFeeRate(AmountFromValue(options[\"feeRate\"]));\n             overrideEstimatedFeerate = true;\n         }\n+\n+        if (options.exists(\"subtractFeeFromAmount\")) {\n+            subtractFeeFromAmount = options[\"subtractFeeFromAmount\"].get_array();\n+            for (unsigned int idx = 0; idx < subtractFeeFromAmount.size(); idx++) {\n+                string strAddress(subtractFeeFromAmount[idx].get_str());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#discussion_r89728445",
      "id" : 89728445,
      "original_commit_id" : "a979010c80d5875ab26c9cdd5401e2b2905dd572",
      "original_position" : 47,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 47,
      "pull_request_review_id" : 10264915,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9222",
      "updated_at" : "2016-11-29T21:48:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89728445",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Code Review ACK a979010c80d5875ab26c9cdd5401e2b2905dd572.\r\nSquash required.",
      "created_at" : "2016-11-28T07:36:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#issuecomment-263202152",
      "id" : 263202152,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9222",
      "updated_at" : "2016-11-28T07:36:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/263202152",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "To 'squash' the commits do I just rewrite the same branch with a `push --force`? Or make a new branch and a new pull request?",
      "created_at" : "2016-11-28T07:47:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#issuecomment-263203903",
      "id" : 263203903,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9222",
      "updated_at" : "2016-11-28T07:47:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/263203903",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "body" : "@dooglus: Yes. I normally do a `git rebase -I head~<amount-of-commits>`, find the commit you'd like to squash to and mark all later commits with a `s`. Then `git push --force`.",
      "created_at" : "2016-11-28T07:49:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#issuecomment-263204233",
      "id" : 263204233,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9222",
      "updated_at" : "2016-11-28T07:49:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/263204233",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@jonasschnelli Thanks. The 'i' is lowercase and the 'HEAD' is uppercase but it was close enough.\r\n\r\nI used `git rebase -i HEAD~3` and it appears to have worked.",
      "created_at" : "2016-11-28T08:20:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#issuecomment-263209117",
      "id" : 263209117,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9222",
      "updated_at" : "2016-11-28T08:20:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/263209117",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "body" : "utACK",
      "created_at" : "2016-11-28T20:41:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#issuecomment-263387858",
      "id" : 263387858,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9222",
      "updated_at" : "2016-11-28T20:41:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/263387858",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9222#discussion_r90076856"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9222"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90076856"
         }
      },
      "body" : "nit: you can condense this to: \r\nassert(result[0]['fee']==result[1]['fee']== result[2]['fee']==result[3]['fee'])",
      "commit_id" : "6a41954895460a033afc352af5c137418591cc6b",
      "created_at" : "2016-11-29T18:42:10Z",
      "diff_hunk" : "@@ -643,5 +643,127 @@ def run_test(self):\n         assert_fee_amount(result2['fee'], count_bytes(result2['hex']), 2 * result_fee_rate)\n         assert_fee_amount(result3['fee'], count_bytes(result3['hex']), 10 * result_fee_rate)\n \n+        #####################################\n+        # Test subtractFeeFromAmount option #\n+        #####################################\n+\n+        # Make sure there is exactly one input so coin selection can't skew the result\n+        assert_equal(len(self.nodes[3].listunspent(1)), 1)\n+\n+        inputs = []\n+        addr1 = self.nodes[2].getnewaddress()\n+        addr2 = self.nodes[2].getnewaddress()\n+        outputs = {addr1: 1}\n+        rawtx = self.nodes[3].createrawtransaction(inputs, outputs)\n+\n+        result = [self.nodes[3].fundrawtransaction(rawtx), # uses min_relay_tx_fee (set by settxfee)\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"subtractFeeFromAmount\": []}), # empty subtraction list\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"subtractFeeFromAmount\": [addr2]}), # addr2 isn't an output, so no subtraction\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"subtractFeeFromAmount\": [addr1]}), # uses min_relay_tx_fee (set by settxfee)\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"feeRate\": 2*min_relay_tx_fee}),\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"feeRate\": 2*min_relay_tx_fee, \"subtractFeeFromAmount\": [addr1]})]\n+\n+        dec_tx = [self.nodes[3].decoderawtransaction(result[0]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[1]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[2]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[3]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[4]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[5]['hex'])]\n+\n+        output = [dec_tx[0]['vout'][1 - result[0]['changepos']]['value'],\n+                  dec_tx[1]['vout'][1 - result[1]['changepos']]['value'],\n+                  dec_tx[2]['vout'][1 - result[2]['changepos']]['value'],\n+                  dec_tx[3]['vout'][1 - result[3]['changepos']]['value'],\n+                  dec_tx[4]['vout'][1 - result[4]['changepos']]['value'],\n+                  dec_tx[5]['vout'][1 - result[5]['changepos']]['value']]\n+\n+        change = [dec_tx[0]['vout'][result[0]['changepos']]['value'],\n+                  dec_tx[1]['vout'][result[1]['changepos']]['value'],\n+                  dec_tx[2]['vout'][result[2]['changepos']]['value'],\n+                  dec_tx[3]['vout'][result[3]['changepos']]['value'],\n+                  dec_tx[4]['vout'][result[4]['changepos']]['value'],\n+                  dec_tx[5]['vout'][result[5]['changepos']]['value']]\n+\n+        # total fee isn't affected by the subtractFeeFromAmount option\n+        assert(result[0]['fee'] == result[1]['fee'])\n+        assert(result[0]['fee'] == result[2]['fee'])\n+        assert(result[0]['fee'] == result[3]['fee'])\n+        assert(result[4]['fee'] == result[5]['fee'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#discussion_r90076856",
      "id" : 90076856,
      "original_commit_id" : "64955cf43033ee93ea2462368270908bd2ab670a",
      "original_position" : 49,
      "path" : "qa/rpc-tests/fundrawtransaction.py",
      "position" : null,
      "pull_request_review_id" : 10601899,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9222",
      "updated_at" : "2016-11-29T21:48:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90076856",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7504522?v=3",
         "events_url" : "https://api.github.com/users/mrbandrews/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mrbandrews/followers",
         "following_url" : "https://api.github.com/users/mrbandrews/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mrbandrews/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mrbandrews",
         "id" : 7504522,
         "login" : "mrbandrews",
         "organizations_url" : "https://api.github.com/users/mrbandrews/orgs",
         "received_events_url" : "https://api.github.com/users/mrbandrews/received_events",
         "repos_url" : "https://api.github.com/users/mrbandrews/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mrbandrews/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mrbandrews/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mrbandrews"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9222#discussion_r90077024"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9222"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90077024"
         }
      },
      "body" : "same",
      "commit_id" : "6a41954895460a033afc352af5c137418591cc6b",
      "created_at" : "2016-11-29T18:42:47Z",
      "diff_hunk" : "@@ -643,5 +643,127 @@ def run_test(self):\n         assert_fee_amount(result2['fee'], count_bytes(result2['hex']), 2 * result_fee_rate)\n         assert_fee_amount(result3['fee'], count_bytes(result3['hex']), 10 * result_fee_rate)\n \n+        #####################################\n+        # Test subtractFeeFromAmount option #\n+        #####################################\n+\n+        # Make sure there is exactly one input so coin selection can't skew the result\n+        assert_equal(len(self.nodes[3].listunspent(1)), 1)\n+\n+        inputs = []\n+        addr1 = self.nodes[2].getnewaddress()\n+        addr2 = self.nodes[2].getnewaddress()\n+        outputs = {addr1: 1}\n+        rawtx = self.nodes[3].createrawtransaction(inputs, outputs)\n+\n+        result = [self.nodes[3].fundrawtransaction(rawtx), # uses min_relay_tx_fee (set by settxfee)\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"subtractFeeFromAmount\": []}), # empty subtraction list\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"subtractFeeFromAmount\": [addr2]}), # addr2 isn't an output, so no subtraction\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"subtractFeeFromAmount\": [addr1]}), # uses min_relay_tx_fee (set by settxfee)\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"feeRate\": 2*min_relay_tx_fee}),\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"feeRate\": 2*min_relay_tx_fee, \"subtractFeeFromAmount\": [addr1]})]\n+\n+        dec_tx = [self.nodes[3].decoderawtransaction(result[0]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[1]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[2]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[3]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[4]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[5]['hex'])]\n+\n+        output = [dec_tx[0]['vout'][1 - result[0]['changepos']]['value'],\n+                  dec_tx[1]['vout'][1 - result[1]['changepos']]['value'],\n+                  dec_tx[2]['vout'][1 - result[2]['changepos']]['value'],\n+                  dec_tx[3]['vout'][1 - result[3]['changepos']]['value'],\n+                  dec_tx[4]['vout'][1 - result[4]['changepos']]['value'],\n+                  dec_tx[5]['vout'][1 - result[5]['changepos']]['value']]\n+\n+        change = [dec_tx[0]['vout'][result[0]['changepos']]['value'],\n+                  dec_tx[1]['vout'][result[1]['changepos']]['value'],\n+                  dec_tx[2]['vout'][result[2]['changepos']]['value'],\n+                  dec_tx[3]['vout'][result[3]['changepos']]['value'],\n+                  dec_tx[4]['vout'][result[4]['changepos']]['value'],\n+                  dec_tx[5]['vout'][result[5]['changepos']]['value']]\n+\n+        # total fee isn't affected by the subtractFeeFromAmount option\n+        assert(result[0]['fee'] == result[1]['fee'])\n+        assert(result[0]['fee'] == result[2]['fee'])\n+        assert(result[0]['fee'] == result[3]['fee'])\n+        assert(result[4]['fee'] == result[5]['fee'])\n+\n+        # change amounts in result 0, 1, and 2 are the same\n+        assert(change[0] == change[1])\n+        assert(change[0] == change[2])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#discussion_r90077024",
      "id" : 90077024,
      "original_commit_id" : "64955cf43033ee93ea2462368270908bd2ab670a",
      "original_position" : 53,
      "path" : "qa/rpc-tests/fundrawtransaction.py",
      "position" : null,
      "pull_request_review_id" : 10602066,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9222",
      "updated_at" : "2016-11-29T21:48:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90077024",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7504522?v=3",
         "events_url" : "https://api.github.com/users/mrbandrews/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mrbandrews/followers",
         "following_url" : "https://api.github.com/users/mrbandrews/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mrbandrews/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mrbandrews",
         "id" : 7504522,
         "login" : "mrbandrews",
         "organizations_url" : "https://api.github.com/users/mrbandrews/orgs",
         "received_events_url" : "https://api.github.com/users/mrbandrews/received_events",
         "repos_url" : "https://api.github.com/users/mrbandrews/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mrbandrews/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mrbandrews/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mrbandrews"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9222#discussion_r90100155"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9222"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90100155"
         }
      },
      "body" : "Should it throw an error if the given address is valid but is not among the outputs? (would have to check for this below, after retrieving the transaction).  It seems like in this case, the user is trying to pay the fee with one of the outputs but has made an error. ",
      "commit_id" : "6a41954895460a033afc352af5c137418591cc6b",
      "created_at" : "2016-11-29T20:01:57Z",
      "diff_hunk" : "@@ -2553,6 +2561,19 @@ UniValue fundrawtransaction(const JSONRPCRequest& request)\n             feeRate = CFeeRate(AmountFromValue(options[\"feeRate\"]));\n             overrideEstimatedFeerate = true;\n         }\n+\n+        if (options.exists(\"subtractFeeFromAmount\")) {\n+            subtractFeeFromAmount = options[\"subtractFeeFromAmount\"].get_array();\n+            for (unsigned int idx = 0; idx < subtractFeeFromAmount.size(); idx++) {\n+                string strAddress(subtractFeeFromAmount[idx].get_str());\n+                CBitcoinAddress address(strAddress);\n+                if (!address.IsValid())\n+                    throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, string(\"Invalid Bitcoin address: \")+strAddress);\n+                if (setSubtractFeeFromAmount.count(strAddress))\n+                    throw JSONRPCError(RPC_INVALID_PARAMETER, string(\"Invalid parameter, duplicated address: \")+strAddress);\n+                setSubtractFeeFromAmount.insert(strAddress);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#discussion_r90100155",
      "id" : 90100155,
      "original_commit_id" : "64955cf43033ee93ea2462368270908bd2ab670a",
      "original_position" : 53,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 53,
      "pull_request_review_id" : 10624630,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9222",
      "updated_at" : "2016-11-29T21:48:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90100155",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7504522?v=3",
         "events_url" : "https://api.github.com/users/mrbandrews/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mrbandrews/followers",
         "following_url" : "https://api.github.com/users/mrbandrews/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mrbandrews/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mrbandrews",
         "id" : 7504522,
         "login" : "mrbandrews",
         "organizations_url" : "https://api.github.com/users/mrbandrews/orgs",
         "received_events_url" : "https://api.github.com/users/mrbandrews/received_events",
         "repos_url" : "https://api.github.com/users/mrbandrews/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mrbandrews/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mrbandrews/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mrbandrews"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9222#discussion_r90118751"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9222"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90118751"
         }
      },
      "body" : "Interesting. I didn't know Python did that. I will do as you suggest.",
      "commit_id" : "6a41954895460a033afc352af5c137418591cc6b",
      "created_at" : "2016-11-29T21:32:57Z",
      "diff_hunk" : "@@ -643,5 +643,127 @@ def run_test(self):\n         assert_fee_amount(result2['fee'], count_bytes(result2['hex']), 2 * result_fee_rate)\n         assert_fee_amount(result3['fee'], count_bytes(result3['hex']), 10 * result_fee_rate)\n \n+        #####################################\n+        # Test subtractFeeFromAmount option #\n+        #####################################\n+\n+        # Make sure there is exactly one input so coin selection can't skew the result\n+        assert_equal(len(self.nodes[3].listunspent(1)), 1)\n+\n+        inputs = []\n+        addr1 = self.nodes[2].getnewaddress()\n+        addr2 = self.nodes[2].getnewaddress()\n+        outputs = {addr1: 1}\n+        rawtx = self.nodes[3].createrawtransaction(inputs, outputs)\n+\n+        result = [self.nodes[3].fundrawtransaction(rawtx), # uses min_relay_tx_fee (set by settxfee)\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"subtractFeeFromAmount\": []}), # empty subtraction list\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"subtractFeeFromAmount\": [addr2]}), # addr2 isn't an output, so no subtraction\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"subtractFeeFromAmount\": [addr1]}), # uses min_relay_tx_fee (set by settxfee)\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"feeRate\": 2*min_relay_tx_fee}),\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"feeRate\": 2*min_relay_tx_fee, \"subtractFeeFromAmount\": [addr1]})]\n+\n+        dec_tx = [self.nodes[3].decoderawtransaction(result[0]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[1]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[2]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[3]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[4]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[5]['hex'])]\n+\n+        output = [dec_tx[0]['vout'][1 - result[0]['changepos']]['value'],\n+                  dec_tx[1]['vout'][1 - result[1]['changepos']]['value'],\n+                  dec_tx[2]['vout'][1 - result[2]['changepos']]['value'],\n+                  dec_tx[3]['vout'][1 - result[3]['changepos']]['value'],\n+                  dec_tx[4]['vout'][1 - result[4]['changepos']]['value'],\n+                  dec_tx[5]['vout'][1 - result[5]['changepos']]['value']]\n+\n+        change = [dec_tx[0]['vout'][result[0]['changepos']]['value'],\n+                  dec_tx[1]['vout'][result[1]['changepos']]['value'],\n+                  dec_tx[2]['vout'][result[2]['changepos']]['value'],\n+                  dec_tx[3]['vout'][result[3]['changepos']]['value'],\n+                  dec_tx[4]['vout'][result[4]['changepos']]['value'],\n+                  dec_tx[5]['vout'][result[5]['changepos']]['value']]\n+\n+        # total fee isn't affected by the subtractFeeFromAmount option\n+        assert(result[0]['fee'] == result[1]['fee'])\n+        assert(result[0]['fee'] == result[2]['fee'])\n+        assert(result[0]['fee'] == result[3]['fee'])\n+        assert(result[4]['fee'] == result[5]['fee'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#discussion_r90118751",
      "id" : 90118751,
      "original_commit_id" : "64955cf43033ee93ea2462368270908bd2ab670a",
      "original_position" : 49,
      "path" : "qa/rpc-tests/fundrawtransaction.py",
      "position" : null,
      "pull_request_review_id" : 10643287,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9222",
      "updated_at" : "2016-11-29T21:48:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90118751",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9222#discussion_r90118788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9222"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90118788"
         }
      },
      "body" : "Yes. Addressed in 6a41954.",
      "commit_id" : "6a41954895460a033afc352af5c137418591cc6b",
      "created_at" : "2016-11-29T21:33:07Z",
      "diff_hunk" : "@@ -643,5 +643,127 @@ def run_test(self):\n         assert_fee_amount(result2['fee'], count_bytes(result2['hex']), 2 * result_fee_rate)\n         assert_fee_amount(result3['fee'], count_bytes(result3['hex']), 10 * result_fee_rate)\n \n+        #####################################\n+        # Test subtractFeeFromAmount option #\n+        #####################################\n+\n+        # Make sure there is exactly one input so coin selection can't skew the result\n+        assert_equal(len(self.nodes[3].listunspent(1)), 1)\n+\n+        inputs = []\n+        addr1 = self.nodes[2].getnewaddress()\n+        addr2 = self.nodes[2].getnewaddress()\n+        outputs = {addr1: 1}\n+        rawtx = self.nodes[3].createrawtransaction(inputs, outputs)\n+\n+        result = [self.nodes[3].fundrawtransaction(rawtx), # uses min_relay_tx_fee (set by settxfee)\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"subtractFeeFromAmount\": []}), # empty subtraction list\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"subtractFeeFromAmount\": [addr2]}), # addr2 isn't an output, so no subtraction\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"subtractFeeFromAmount\": [addr1]}), # uses min_relay_tx_fee (set by settxfee)\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"feeRate\": 2*min_relay_tx_fee}),\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"feeRate\": 2*min_relay_tx_fee, \"subtractFeeFromAmount\": [addr1]})]\n+\n+        dec_tx = [self.nodes[3].decoderawtransaction(result[0]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[1]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[2]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[3]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[4]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[5]['hex'])]\n+\n+        output = [dec_tx[0]['vout'][1 - result[0]['changepos']]['value'],\n+                  dec_tx[1]['vout'][1 - result[1]['changepos']]['value'],\n+                  dec_tx[2]['vout'][1 - result[2]['changepos']]['value'],\n+                  dec_tx[3]['vout'][1 - result[3]['changepos']]['value'],\n+                  dec_tx[4]['vout'][1 - result[4]['changepos']]['value'],\n+                  dec_tx[5]['vout'][1 - result[5]['changepos']]['value']]\n+\n+        change = [dec_tx[0]['vout'][result[0]['changepos']]['value'],\n+                  dec_tx[1]['vout'][result[1]['changepos']]['value'],\n+                  dec_tx[2]['vout'][result[2]['changepos']]['value'],\n+                  dec_tx[3]['vout'][result[3]['changepos']]['value'],\n+                  dec_tx[4]['vout'][result[4]['changepos']]['value'],\n+                  dec_tx[5]['vout'][result[5]['changepos']]['value']]\n+\n+        # total fee isn't affected by the subtractFeeFromAmount option\n+        assert(result[0]['fee'] == result[1]['fee'])\n+        assert(result[0]['fee'] == result[2]['fee'])\n+        assert(result[0]['fee'] == result[3]['fee'])\n+        assert(result[4]['fee'] == result[5]['fee'])\n+\n+        # change amounts in result 0, 1, and 2 are the same\n+        assert(change[0] == change[1])\n+        assert(change[0] == change[2])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#discussion_r90118788",
      "id" : 90118788,
      "original_commit_id" : "64955cf43033ee93ea2462368270908bd2ab670a",
      "original_position" : 53,
      "path" : "qa/rpc-tests/fundrawtransaction.py",
      "position" : null,
      "pull_request_review_id" : 10643325,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9222",
      "updated_at" : "2016-11-29T21:49:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90118788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9222#discussion_r90120089"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9222"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90120089"
         }
      },
      "body" : "I wanted it to behave the same as it does [in `sendmany`](https://github.com/bitcoin/bitcoin/blob/v0.13.1/src/wallet/rpcwallet.cpp#L931), where it doesn't complain if you include an address that isn't a recipient at all.\r\n\r\nThe user could have a list of addresses which should pay fees when sent to, and use that same list as their `subtractFeeFromAmount` parameter whichever addresses they are sending to.",
      "commit_id" : "6a41954895460a033afc352af5c137418591cc6b",
      "created_at" : "2016-11-29T21:39:23Z",
      "diff_hunk" : "@@ -2553,6 +2561,19 @@ UniValue fundrawtransaction(const JSONRPCRequest& request)\n             feeRate = CFeeRate(AmountFromValue(options[\"feeRate\"]));\n             overrideEstimatedFeerate = true;\n         }\n+\n+        if (options.exists(\"subtractFeeFromAmount\")) {\n+            subtractFeeFromAmount = options[\"subtractFeeFromAmount\"].get_array();\n+            for (unsigned int idx = 0; idx < subtractFeeFromAmount.size(); idx++) {\n+                string strAddress(subtractFeeFromAmount[idx].get_str());\n+                CBitcoinAddress address(strAddress);\n+                if (!address.IsValid())\n+                    throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, string(\"Invalid Bitcoin address: \")+strAddress);\n+                if (setSubtractFeeFromAmount.count(strAddress))\n+                    throw JSONRPCError(RPC_INVALID_PARAMETER, string(\"Invalid parameter, duplicated address: \")+strAddress);\n+                setSubtractFeeFromAmount.insert(strAddress);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#discussion_r90120089",
      "id" : 90120089,
      "original_commit_id" : "64955cf43033ee93ea2462368270908bd2ab670a",
      "original_position" : 53,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 53,
      "pull_request_review_id" : 10644592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9222",
      "updated_at" : "2016-11-29T21:48:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90120089",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9222#discussion_r90122153"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9222"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90122153"
         }
      },
      "body" : "Addressed in 6a41954.",
      "commit_id" : "6a41954895460a033afc352af5c137418591cc6b",
      "created_at" : "2016-11-29T21:49:37Z",
      "diff_hunk" : "@@ -643,5 +643,127 @@ def run_test(self):\n         assert_fee_amount(result2['fee'], count_bytes(result2['hex']), 2 * result_fee_rate)\n         assert_fee_amount(result3['fee'], count_bytes(result3['hex']), 10 * result_fee_rate)\n \n+        #####################################\n+        # Test subtractFeeFromAmount option #\n+        #####################################\n+\n+        # Make sure there is exactly one input so coin selection can't skew the result\n+        assert_equal(len(self.nodes[3].listunspent(1)), 1)\n+\n+        inputs = []\n+        addr1 = self.nodes[2].getnewaddress()\n+        addr2 = self.nodes[2].getnewaddress()\n+        outputs = {addr1: 1}\n+        rawtx = self.nodes[3].createrawtransaction(inputs, outputs)\n+\n+        result = [self.nodes[3].fundrawtransaction(rawtx), # uses min_relay_tx_fee (set by settxfee)\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"subtractFeeFromAmount\": []}), # empty subtraction list\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"subtractFeeFromAmount\": [addr2]}), # addr2 isn't an output, so no subtraction\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"subtractFeeFromAmount\": [addr1]}), # uses min_relay_tx_fee (set by settxfee)\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"feeRate\": 2*min_relay_tx_fee}),\n+                  self.nodes[3].fundrawtransaction(rawtx, {\"feeRate\": 2*min_relay_tx_fee, \"subtractFeeFromAmount\": [addr1]})]\n+\n+        dec_tx = [self.nodes[3].decoderawtransaction(result[0]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[1]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[2]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[3]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[4]['hex']),\n+                  self.nodes[3].decoderawtransaction(result[5]['hex'])]\n+\n+        output = [dec_tx[0]['vout'][1 - result[0]['changepos']]['value'],\n+                  dec_tx[1]['vout'][1 - result[1]['changepos']]['value'],\n+                  dec_tx[2]['vout'][1 - result[2]['changepos']]['value'],\n+                  dec_tx[3]['vout'][1 - result[3]['changepos']]['value'],\n+                  dec_tx[4]['vout'][1 - result[4]['changepos']]['value'],\n+                  dec_tx[5]['vout'][1 - result[5]['changepos']]['value']]\n+\n+        change = [dec_tx[0]['vout'][result[0]['changepos']]['value'],\n+                  dec_tx[1]['vout'][result[1]['changepos']]['value'],\n+                  dec_tx[2]['vout'][result[2]['changepos']]['value'],\n+                  dec_tx[3]['vout'][result[3]['changepos']]['value'],\n+                  dec_tx[4]['vout'][result[4]['changepos']]['value'],\n+                  dec_tx[5]['vout'][result[5]['changepos']]['value']]\n+\n+        # total fee isn't affected by the subtractFeeFromAmount option\n+        assert(result[0]['fee'] == result[1]['fee'])\n+        assert(result[0]['fee'] == result[2]['fee'])\n+        assert(result[0]['fee'] == result[3]['fee'])\n+        assert(result[4]['fee'] == result[5]['fee'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#discussion_r90122153",
      "id" : 90122153,
      "original_commit_id" : "64955cf43033ee93ea2462368270908bd2ab670a",
      "original_position" : 49,
      "path" : "qa/rpc-tests/fundrawtransaction.py",
      "position" : null,
      "pull_request_review_id" : 10646607,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9222",
      "updated_at" : "2016-11-29T21:49:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90122153",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "body" : "Addressed @mrbandrews' nits. Should I re-squash now, or leave the 'nit' commit separate for a while?",
      "created_at" : "2016-11-29T21:51:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9222#issuecomment-263710894",
      "id" : 263710894,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9222",
      "updated_at" : "2016-11-29T21:51:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/263710894",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   }
]
