[
   {
      "body" : "Hmm, there are a few races that can be seen on disconnect that need fixing (eg #9671 and one to be fixed a bit later), but its not clear that that would have caused this situation unless there were some pending writes to debug.log that were lost :/. Was there any non-standard configuration at the time I could try to reproduce in helgrind/valgrind (even strange distro or so).",
      "created_at" : "2017-02-04T03:46:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/9683#issuecomment-277416130",
      "id" : 277416130,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9683",
      "updated_at" : "2017-02-04T03:46:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/277416130",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "The configuraton is pretty standard. I pasted in it [this comment](https://github.com/bitcoin/bitcoin/issues/9684#issuecomment-277427399).\r\n\r\nI was restarting bitcoind and bitcoin-qt over and over to investigate the compacting issue (#9684). I didn't change anything (other than switching between bitcoind and bitcoin-qt), and only saw this crash once, shortly after a restart - it seems to have crashed after just 15 seconds.\r\n\r\nI'm running on debian stable, with bdb 5.3.28. I don't think anything's unusual with my build other than that.\r\n\r\nI'll rebuild from the master HEAD and report back if I see anything like this again.\r\n\r\nIs there an option that will cause `debug.log` to be flushed after each write? I don't want to be losing unbuffered log messages to a crash.",
      "created_at" : "2017-02-04T19:33:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/9683#issuecomment-277469410",
      "id" : 277469410,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9683",
      "updated_at" : "2017-02-04T19:33:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/277469410",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "body" : "> Is there an option that will cause debug.log to be flushed after each write? I don't want to be losing unbuffered log messages to a crash.\r\n\r\nTo answer my own question, it appears that the `debug.log` file is unbuffered by default:\r\n\r\nFrom `OpenDebugLog()` in `src/util.cpp`:\r\n\r\n    boost::filesystem::path pathDebug = GetDataDir() / \"debug.log\";\r\n    fileout = fopen(pathDebug.string().c_str(), \"a\");\r\n    if (fileout) setbuf(fileout, NULL); // unbuffered\r\n",
      "created_at" : "2017-02-04T20:35:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/9683#issuecomment-277475554",
      "id" : 277475554,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9683",
      "updated_at" : "2017-02-04T20:35:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/277475554",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "body" : "Crashes such as this (in libc itself, or segmentation faults) won't log anything to the debug log.\r\n\r\nPersonally I always run bitcoind in gdb: https://gist.github.com/laanwj/29bc141fb8d10608651c . \r\n\r\nAnother option to allow for post-mortem debugging is to configure your OS to save core dumps properly, but a lot of modern Linux distros and such eat these by default.",
      "created_at" : "2017-02-07T11:39:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/9683#issuecomment-277974448",
      "id" : 277974448,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9683",
      "updated_at" : "2017-02-07T11:39:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/277974448",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Closing, as there is no way to reproduce this and not enough information for diagnosing what caused the crash.",
      "created_at" : "2017-08-24T08:50:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/9683#issuecomment-324574620",
      "id" : 324574620,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9683",
      "updated_at" : "2017-08-24T08:50:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/324574620",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I still regularly get crashes like this, but cannot find a way to reproduce them reliably. I wrote a script to repeatably start and stop bitcoin-qt and it usually crashes within 10 restarts. I've not been able to get it to crash even once running bitcoind, so it looks like it's related to the GUI version only.\r\n\r\nIs there any interest in fixing the problem? All my reports of crashes seem to get closed without being fixed, which is a little discouraging.",
      "created_at" : "2017-08-24T17:41:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/9683#issuecomment-324705948",
      "id" : 324705948,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9683",
      "updated_at" : "2017-08-24T17:41:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/324705948",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/573356?v=4",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "body" : "I'll rebuild from the `v0.15.0rc2` tag and try to get a backtrace from a crash in gdb...",
      "created_at" : "2017-08-24T17:42:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/9683#issuecomment-324706154",
      "id" : 324706154,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9683",
      "updated_at" : "2017-08-24T17:42:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/324706154",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/573356?v=4",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "body" : "> Is there any interest in fixing the problem? All my reports of crashes seem to get closed without being fixed, which is a little discouraging.\r\n\r\nI understand. But if there is no way to reproduce for us, and crash reports don't have enough information to trace the crash to a certain point in the code, at some point there's no use in keeping it open. There's just nothing we can do.\r\n",
      "created_at" : "2017-08-24T17:43:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/9683#issuecomment-324706586",
      "id" : 324706586,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9683",
      "updated_at" : "2017-08-24T17:43:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/324706586",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
