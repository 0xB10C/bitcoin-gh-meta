[
   {
      "author_association" : "MEMBER",
      "body" : "~~ACK fa8d6bfb6f6f391a3a6af1fb47b9ca5f53344f1b assuming Travis is also happy: diff looks correct~~\r\n\r\nConcept ACK",
      "created_at" : "2019-11-19T17:16:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17517#issuecomment-555612040",
      "id" : 555612040,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17517",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NTYxMjA0MA==",
      "updated_at" : "2019-11-19T20:18:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/555612040",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Seeing some Travis failures in the asan build:\r\n```bash\r\nserialize.h:211:93: runtime error: implicit conversion from type 'int64_t' (aka 'long') of value -1 (64-bit, signed) to type 'uint64_t' (aka 'unsigned long') changed the value to 18446744073709551615 (64-bit, unsigned)\r\n    #0 0x55cb0c158d0b in void Serialize<CSizeComputer>(CSizeComputer&, long) /home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-pc-linux-gnu/src/./serialize.h:211:93\r\n    #1 0x55cb0c158b45 in void SerializeMany<CSizeComputer, long>(CSizeComputer&, long const&) /home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-pc-linux-gnu/src/./serialize.h:964:5\r\n    #2 0x55cb0c158b45 in void SerReadWriteMany<CSizeComputer, long>(CSizeComputer&, CSerActionSerialize, long const&) /home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-pc-linux-gnu/src/./serialize.h:983\r\n    #3 0x55cb0c158b45 in void CTxOut::SerializationOp<CSizeComputer, CSerActionSerialize>(CSizeComputer&, CSerActionSerialize) /home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-pc-linux-gnu/src/./primitives/transaction.h:150\r\n    #4 0x55cb0c42df66 in void CTxOut::Serialize<CSizeComputer>(CSizeComputer&) const /home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-pc-linux-gnu/src/./primitives/transaction.h:146:5\r\n    #5 0x55cb0c42df66 in void Serialize<CSizeComputer, CTxOut>(CSizeComputer&, CTxOut const&) /home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-pc-linux-gnu/src/./serialize.h:602\r\n    #6 0x55cb0c42df66 in CSizeComputer& CSizeComputer::operator<<<CTxOut>(CTxOut const&) /home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-pc-linux-gnu/src/./serialize.h:945\r\n    #7 0x55cb0c42aeae in unsigned long GetSerializeSize<CTxOut>(CTxOut const&, int) /home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-pc-linux-gnu/src/./serialize.h:1006:37\r\n    #8 0x55cb0b9ea299 in __cxx_global_var_init.12 /home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-pc-linux-gnu/src/coins.cpp:249:76\r\n    #9 0x55cb0b9ea299 in _GLOBAL__sub_I_coins.cpp /home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-pc-linux-gnu/src/coins.cpp\r\n    #10 0x55cb0d26c32c in __libc_csu_init (/home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-pc-linux-gnu/src/qt/test/test_bitcoin-qt+0x3b5e32c)\r\n    #11 0x7effa9a2db27 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b27)\r\n    #12 0x55cb0b9ecaa9 in _start (/home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-pc-linux-gnu/src/qt/test/test_bitcoin-qt+0x22deaa9)\r\n```\r\n\r\n```\r\ntest/crypto_tests.cpp:192:16: runtime error: implicit conversion from type 'unsigned char' of value 128 (8-bit, unsigned) to type 'char' changed the value to -128 (8-bit, signed)\r\n    #0 0x55f6ff14f838 in crypto_tests::LongTestString[abi:cxx11]() /home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-pc-linux-gnu/src/test/crypto_tests.cpp:192:16\r\n    #1 0x55f6fecc8ae1 in __cxx_global_var_init.14 /home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-pc-linux-gnu/src/test/crypto_tests.cpp:201:27\r\n    #2 0x55f6fecc8ae1 in _GLOBAL__sub_I_crypto_tests.cpp /home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-pc-linux-gnu/src/test/crypto_tests.cpp\r\n    #3 0x55f700b1339c in __libc_csu_init (/home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-pc-linux-gnu/src/test/test_bitcoin+0x491a39c)\r\n    #4 0x7f4f5878eb27 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b27)\r\n    #5 0x55f6fed0ea99 in _start (/home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-pc-linux-gnu/src/test/test_bitcoin+0x2b15a99)\r\n```",
      "created_at" : "2019-11-19T20:01:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17517#issuecomment-555685695",
      "id" : 555685695,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17517",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NTY4NTY5NQ==",
      "updated_at" : "2019-11-19T20:01:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/555685695",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "created_at" : "2019-11-19T22:09:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17517#issuecomment-555739112",
      "id" : 555739112,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17517",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NTczOTExMg==",
      "updated_at" : "2019-11-20T19:28:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/555739112",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-11-20T16:11:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17517#issuecomment-556077579",
      "id" : 556077579,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17517",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NjA3NzU3OQ==",
      "updated_at" : "2019-11-20T16:11:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/556077579",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@practicalswift I am having issues adding suppressions. See\r\n\r\nhttps://travis-ci.org/bitcoin/bitcoin/jobs/614670639#L4122\r\nhttps://github.com/bitcoin/bitcoin/pull/17517/commits/a9b6a758e38f42d56d11ad890cdbd0480c9c6114#diff-782c38017801582a8e7fe8245d9d0b15R48\r\n\r\nAny idea what I could have made wrong?",
      "created_at" : "2019-11-20T19:29:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17517#issuecomment-556284661",
      "id" : 556284661,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17517",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NjI4NDY2MQ==",
      "updated_at" : "2019-11-20T19:29:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/556284661",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke I think this is a UBSan suppressions bug in Clang 8 which I believe has been fixed in later versions.\r\n\r\nI think the best way to work around the bug is to apply sanitization opt-outs for the triggering functions using `__attribute__((no_sanitize(\"integer\")))`.\r\n\r\n---\r\n\r\nThis illustrates the bug and also the workaround.\r\n\r\nA testcase and the suppresions file:\r\n\r\n```\r\n$ cat implicit.cpp\r\nsigned char f(unsigned int i) { return i; }\r\n\r\nint main() { return f(254); }\r\n$ cat ubsan\r\nimplicit-signed-integer-truncation:implicit.cpp\r\n```\r\n\r\nThe runtime suppression `implicit-signed-integer-truncation` is not applied when the binary is compiled with `-fsanitize=integer`:\r\n\r\n```\r\n$ clang++-8 -g -fsanitize=integer -o implicit-sanitize-integer implicit.cpp\r\n$ ./implicit-sanitize-integer\r\nimplicit.cpp:1:40: runtime error: implicit conversion from type 'unsigned int' of value 254 (32-bit, unsigned) to type 'signed char' changed the value to -2 (8-bit, signed)\r\n$ UBSAN_OPTIONS=suppressions=ubsan ./implicit-sanitize-integer\r\nimplicit.cpp:1:40: runtime error: implicit conversion from type 'unsigned int' of value 254 (32-bit, unsigned) to type 'signed char' changed the value to -2 (8-bit, signed)\r\n$\r\n```\r\n\r\nOn the other hand when using the more fine grained `-fsanitize=implicit-integer-truncation` (a subset of `-fsanitize=integer`) the suppression works as expected:\r\n\r\n```\r\n$ clang++-8 -g -fsanitize=implicit-integer-truncation -o implicit-sanitize-implicit-integer-truncation implicit.cpp\r\n$ ./implicit-sanitize-implicit-integer-truncation\r\nimplicit.cpp:1:40: runtime error: implicit conversion from type 'unsigned int' of value 254 (32-bit, unsigned) to type 'signed char' changed the value to -2 (8-bit, signed)\r\n$ UBSAN_OPTIONS=suppressions=ubsan ./implicit-sanitize-implicit-integer-truncation\r\n$\r\n```\r\n\r\nThe problem is that we don't want to limit us to`-fsanitize=integer` (and `-fsanitize=integer,implicit-integer-truncation` does not work unfortunately), so the best we can do is:\r\n\r\n```\r\n$ cat implicit-with-opt-out.cpp\r\n#if defined(__clang__)\r\n__attribute__((no_sanitize(\"integer\")))\r\n#endif\r\nsigned char f(unsigned int i) { return i; }\r\n\r\nint main() { return f(254); }\r\n$ clang++-8 -g -fsanitize=integer -o implicit-with-opt-out implicit-with-opt-out.cpp\r\n$ ./implicit-with-opt-out\r\n$\r\n```\r\n\r\nPerhaps an annotation macro `INTEGER_SANITIZATION_OPT_OUT` can be introduced making it `INTEGER_SANITIZATION_OPT_OUT signed char f(unsigned int i)`.",
      "created_at" : "2019-11-21T09:21:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17517#issuecomment-556993861",
      "id" : 556993861,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17517",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1Njk5Mzg2MQ==",
      "updated_at" : "2019-11-21T09:22:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/556993861",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke The `UBSAN_OPTIONS=report_error_type=1` could perhaps be helpful too. It will print the correct suppression code as part of error output. IIRC that option was present but broken in Clang 8, and fixed in later versions.",
      "created_at" : "2019-11-21T17:41:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17517#issuecomment-557195190",
      "id" : 557195190,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17517",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NzE5NTE5MA==",
      "updated_at" : "2019-11-21T17:41:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557195190",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
