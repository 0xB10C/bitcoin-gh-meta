[
   {
      "body" : "I wanted to open this issue a while ago but thought maybe I don't understand something. But that's true, the message is wrong when you've caught up. I've done a bit of grepping of the source and found the related function, it's BitcoinGUI::setNumBlocks(int count, int nTotalBlocks) on line 500 @ src/qt/bitcoingui.cpp. The problem is that it sets the tooltip just when the block is received and the time is (QDateTime::currentDateTime - lastBlockDate). Obviously, it's the time between block generation and receiving by your node thereby it's pretty useless. I propose calling this function on several events from labelBlocksIcon, progressBarLabel and progressBar. Maybe onMouseMove or onTooltip. I'm not into Qt at all and I don't know which events can be processed and how they're called. I'll try to implement this myself, should be pretty straightforward but I don't promise anything.",
      "created_at" : "2013-03-03T09:56:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2334#issuecomment-14344511",
      "id" : 14344511,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2334",
      "updated_at" : "2013-03-03T09:59:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/14344511",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/184066?v=3",
         "events_url" : "https://api.github.com/users/rkfg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkfg/followers",
         "following_url" : "https://api.github.com/users/rkfg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkfg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkfg",
         "id" : 184066,
         "login" : "rkfg",
         "organizations_url" : "https://api.github.com/users/rkfg/orgs",
         "received_events_url" : "https://api.github.com/users/rkfg/received_events",
         "repos_url" : "https://api.github.com/users/rkfg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkfg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkfg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkfg"
      }
   },
   {
      "body" : "Well, here's a little patch to make it work as expected. It forces updating the block count and time since the last block every 10 seconds (20*500ms).\r\n\r\n```diff\r\ndiff --git a/src/qt/clientmodel.cpp b/src/qt/clientmodel.cpp\r\nindex 084ad12..d7fe156 100644\r\n--- a/src/qt/clientmodel.cpp\r\n+++ b/src/qt/clientmodel.cpp\r\n@@ -17,6 +17,7 @@ ClientModel::ClientModel(OptionsModel *optionsModel, QObject *parent) :\r\n     QObject(parent), optionsModel(optionsModel),\r\n     cachedNumBlocks(0), cachedNumBlocksOfPeers(0), numBlocksAtStartup(-1), pollTimer(0)\r\n {\r\n+    forceUpdateCounter = 0;\r\n     pollTimer = new QTimer(this);\r\n     pollTimer->setInterval(MODEL_UPDATE_DELAY);\r\n     pollTimer->start();\r\n@@ -61,13 +62,14 @@ void ClientModel::updateTimer()\r\n     int newNumBlocks = getNumBlocks();\r\n     int newNumBlocksOfPeers = getNumBlocksOfPeers();\r\n \r\n-    if(cachedNumBlocks != newNumBlocks || cachedNumBlocksOfPeers != newNumBlocksOfPeers)\r\n+    if(cachedNumBlocks != newNumBlocks || cachedNumBlocksOfPeers != newNumBlocksOfPeers || ++forceUpdateCounter == FORCE_UPDATE_COUNTER)\r\n     {\r\n         cachedNumBlocks = newNumBlocks;\r\n         cachedNumBlocksOfPeers = newNumBlocksOfPeers;\r\n \r\n         // ensure we return the maximum of newNumBlocksOfPeers and newNumBlocks to not create weird displays in the GUI\r\n         emit numBlocksChanged(newNumBlocks, std::max(newNumBlocksOfPeers, newNumBlocks));\r\n+        forceUpdateCounter = 0;\r\n     }\r\n }\r\n \r\ndiff --git a/src/qt/clientmodel.h b/src/qt/clientmodel.h\r\nindex 1afccb7..c25a173 100644\r\n--- a/src/qt/clientmodel.h\r\n+++ b/src/qt/clientmodel.h\r\n@@ -62,6 +62,7 @@ private:\r\n     int numBlocksAtStartup;\r\n \r\n     QTimer *pollTimer;\r\n+    int forceUpdateCounter;\r\n \r\n     void subscribeToCoreSignals();\r\n     void unsubscribeFromCoreSignals();\r\ndiff --git a/src/qt/guiconstants.h b/src/qt/guiconstants.h\r\nindex 405ba39..9799f95 100644\r\n--- a/src/qt/guiconstants.h\r\n+++ b/src/qt/guiconstants.h\r\n@@ -3,6 +3,7 @@\r\n \r\n /* Milliseconds between model updates */\r\n static const int MODEL_UPDATE_DELAY = 500;\r\n+static const int FORCE_UPDATE_COUNTER = 20;\r\n \r\n /* AskPassphraseDialog -- Maximum passphrase length */\r\n static const int MAX_PASSPHRASE_SIZE = 1024;\r\n```",
      "created_at" : "2013-03-03T10:39:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2334#issuecomment-14344974",
      "id" : 14344974,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2334",
      "updated_at" : "2013-03-03T10:39:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/14344974",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/184066?v=3",
         "events_url" : "https://api.github.com/users/rkfg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkfg/followers",
         "following_url" : "https://api.github.com/users/rkfg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkfg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkfg",
         "id" : 184066,
         "login" : "rkfg",
         "organizations_url" : "https://api.github.com/users/rkfg/orgs",
         "received_events_url" : "https://api.github.com/users/rkfg/received_events",
         "repos_url" : "https://api.github.com/users/rkfg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkfg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkfg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkfg"
      }
   },
   {
      "body" : "Indeed, the underlying problem is that the tooltip is generated when a block comes in, not when the tooltip is requested to be rendered. @eurekafag's patch works around this by sending the numBlockChanged signal even though the number of blocks hasn't changed (which is contrary to the principle of least surprise, I'd say).\r\n\r\nAnother related problem is that the tooltip is never updated while it is visible. This is a qt limitation. I suppose to really fix this the tooltip should be drawn manually.\r\n\r\nEdit: issue #2233 was about the same problem",
      "created_at" : "2013-03-03T13:16:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2334#issuecomment-14346784",
      "id" : 14346784,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2334",
      "updated_at" : "2013-03-03T13:17:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/14346784",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Maybe it would be good to split the setNumBlocks function in two, one for setting the block count and another for updating the tooltip with time passed since the last block. Then we can update only the time once in a while following \"the least surprise\" principle as you said. I set 10 seconds to clearly see the update process but it may be as well 60 seconds since the tooltip doesn't show seconds after the first minute. I understand that the code sanity is a priority over features so my dirty hack definitely needs variables renaming and such to comply with the project's guidelines. But at least it's something working already.",
      "created_at" : "2013-03-03T14:04:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2334#issuecomment-14347318",
      "id" : 14347318,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2334",
      "updated_at" : "2013-03-03T14:42:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/14347318",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/184066?v=3",
         "events_url" : "https://api.github.com/users/rkfg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkfg/followers",
         "following_url" : "https://api.github.com/users/rkfg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkfg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkfg",
         "id" : 184066,
         "login" : "rkfg",
         "organizations_url" : "https://api.github.com/users/rkfg/orgs",
         "received_events_url" : "https://api.github.com/users/rkfg/received_events",
         "repos_url" : "https://api.github.com/users/rkfg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkfg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkfg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkfg"
      }
   },
   {
      "body" : "I don't know anything about Qt, but according to your principal of least surprise it would be better not to mention the time since the last block was received at all than to use a value that could be out by several hours.\r\n\r\nMy Internet was down all night.  When it comes back, sometimes bitcoin-qt doesn't resume downloading blocks.  I hover over the checkmark and see that the last block was generated 15 minutes ago.  It's pretty damn surprising when I find out that that actually means \"last block was generated 15 minutes ago from 12 hours ago\".",
      "created_at" : "2013-03-03T21:54:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2334#issuecomment-14356388",
      "id" : 14356388,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2334",
      "updated_at" : "2013-03-03T21:54:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/14356388",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "body" : "How about including the time and date that the last block was received?\r\n\r\nCurrently I hover over the green checkmark and see \"last received block was generated 9 seconds ago\".\r\n\r\nI have no idea whether that was today or yesterday.  Sometimes the client takes a long time to even notice that it's out of date, so it sits there says \"9 seconds ago\" when it's actually 24 hours out of date (since I've been offline for 24 hours).\r\n\r\nIf the tooltip included the date and time that the block was received, I'd be able to tell if the client was up to date or not.  That should be a trivial code change.",
      "created_at" : "2013-04-23T17:35:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2334#issuecomment-16873658",
      "id" : 16873658,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2334",
      "updated_at" : "2013-04-23T17:35:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/16873658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "body" : "It used to show a time and date, and then people wanted it this way. There\nis just no way to satisfy everyone, sorry.",
      "created_at" : "2013-04-24T08:34:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2334#issuecomment-16914231",
      "id" : 16914231,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2334",
      "updated_at" : "2013-04-24T08:34:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/16914231",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Of course, there's a way. It's called \"options\". Just add an option to show the time in a \"date\" form or \"x y ago\" form which I personally hate because it's too rough and often even seconds matter. It's outrageous that even github adopted this format for comments and even commits which is too bad. But some people are ok with this so it needs to become an option in the settings.",
      "created_at" : "2013-04-24T08:46:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2334#issuecomment-16914692",
      "id" : 16914692,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2334",
      "updated_at" : "2013-04-24T08:46:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/16914692",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/184066?v=3",
         "events_url" : "https://api.github.com/users/rkfg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkfg/followers",
         "following_url" : "https://api.github.com/users/rkfg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkfg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkfg",
         "id" : 184066,
         "login" : "rkfg",
         "organizations_url" : "https://api.github.com/users/rkfg/orgs",
         "received_events_url" : "https://api.github.com/users/rkfg/received_events",
         "repos_url" : "https://api.github.com/users/rkfg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkfg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkfg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkfg"
      }
   },
   {
      "body" : "We won't add options for every trivial ui decision. That's a\nmaintainability and testing nightmare. We are understaffed in that regard\nalready.\n\nThis issue must be solved nevertheless, and you are right in that simply\nshowing a date is the most straightforward path to that if we don't want to\nmess with qt internals for real-time tooltip updates. Hmm...",
      "created_at" : "2013-04-24T09:53:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2334#issuecomment-16917499",
      "id" : 16917499,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2334",
      "updated_at" : "2013-04-24T09:53:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/16917499",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "> It used to show a time and date, and then people wanted it this way.\r\n\r\nI don't think that's really accurate.  I can understand if people wanted it to say \"3 minutes ago\" instead of showing a time that is 3 minutes earlier than the current time, but I doubt anyone wants the current system which is to show \"3 minutes ago\" and keep it showing \"3 minutes ago\" until the next block is received, which could be days later if I go offline.\r\n\r\nI would prefer \"x ago\" instead of a timestamp if the x was true, but \"x ago\" where x is calculated once and never updated is truly useless, and reminds me of an old bug from 1957: http://youtu.be/-tjHlFPTwVk",
      "created_at" : "2013-04-24T18:55:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2334#issuecomment-16956982",
      "id" : 16956982,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2334",
      "updated_at" : "2013-04-24T18:55:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/16956982",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "body" : "This is no problem anymore (starting from commit 24cde0b7d1ad014ffca5d0af896bc50b30e5ddcd) as the smallest granularity of generated XXX ago is in weeks, not minutes or seconds.",
      "created_at" : "2013-11-11T15:14:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2334#issuecomment-28207536",
      "id" : 28207536,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2334",
      "updated_at" : "2013-11-11T15:14:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/28207536",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
