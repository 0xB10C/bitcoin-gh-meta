[
   {
      "author_association" : "MEMBER",
      "body" : "I agree with the concept.  I wish we could announce our own addresses to these peers, but I think doing so results in a topology leak. :(   The reason I'd like this is that if an attacker eclipses a node except for its blocks only links it will eventually eclipse its blocks-only links too through control of the addrman state.",
      "created_at" : "2019-04-05T19:40:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15759#issuecomment-480398699",
      "id" : 480398699,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15759",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4MDM5ODY5OQ==",
      "updated_at" : "2019-04-05T19:40:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480398699",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This approach was motivated by the [TxProbe paper.](https://arxiv.org/pdf/1812.00942.pdf)  Fundamentally, transaction relay is going to leak information about our node's peers (as long as we care about not wasting bandwidth).  Rather than combat transaction-relay based inferences, which I think is a lost cause in the long-run even if there are improvements we can make in the short-term, I figure we can directly address why we care about keeping the graph private.\r\n\r\nSome considerations I had while working on this:\r\n\r\n * Is 2 the right number of blocks-only connections?  From a robustness standpoint, more connections like this are better; however there's a tradeoff with resource utilization.  Two resources that occurred to me to worry about were the memory used by each CNode object (hence the refactor commits that allow the transaction-relay data structures to not be instantiated for the blocks-only peers), and the number of connection slots on the network (I figure going from 8 to 10 is not that bad?).  I also did some simulations to verify that a random graph of 10000 peers would be fully connected if each peer makes 2 outbound connections to random other peers, which I thought was a good justification for 2 being a useful number of outbounds to add.\r\n\r\n * How should addrman interactions work on these blocks-only connections?  My approach attempts to leave addrman unchanged as a result of these connections, neither processing addr messages nor sending any, to avoid leaking information via addr messages that we relay to other peers.  But I have not given a lot of thought to what kind of attacks are possible using addrman, nor what the consequences are to not updating addrman with information from our blocks-only peers.\r\n",
      "created_at" : "2019-04-05T19:41:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15759#issuecomment-480398802",
      "id" : 480398802,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15759",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4MDM5ODgwMg==",
      "updated_at" : "2019-04-06T01:06:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480398802",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I also did some simulations to verify that a random graph of 10000 peers would be fully connected if each peer makes 2 outbound connections to random other peers,\r\n\r\nCan you run these simulations assuming x% of the 10,000 peers are black holes (don't connect the graph), for various values of x%?\r\n\r\n2 might be fine for now, but ultimately I'd like to optimize memory usage for both inbound and outbound blocksonly links, then at least double the inbound connection limit for blocks only links, and make 8 blocks only links.  (I suspect running that simulation assuming reasonable number of black hole peers will show that 2 is not really enough).     ",
      "created_at" : "2019-04-05T19:49:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15759#issuecomment-480400958",
      "id" : 480400958,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15759",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4MDQwMDk1OA==",
      "updated_at" : "2019-04-05T19:49:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480400958",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I figure we can directly address why we care about keeping the graph private\r\n\r\nTo the uninformed p2p reader this reason is?",
      "created_at" : "2019-04-05T20:15:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15759#issuecomment-480408075",
      "id" : 480408075,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15759",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4MDQwODA3NQ==",
      "updated_at" : "2019-04-05T20:15:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480408075",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#15502](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15502.html) (Speed up initial connection to p2p network by ajtowns)\n* [#15253](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15253.html) (Net: Consistently log outgoing INV messages by Empact)\n* [#14856](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14856.html) (net: remove more CConnman globals (theuni) by dongcarl)\n* [#14033](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14033.html) (p2p: Drop CADDR_TIME_VERSION checks now that MIN_PEER_PROTO_VERSION is greater by Empact)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-04-05T21:12:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15759#issuecomment-480423675",
      "id" : 480423675,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15759",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4MDQyMzY3NQ==",
      "updated_at" : "2019-04-09T07:00:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480423675",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> To the uninformed p2p reader this reason is?\r\n\r\n> (b) Knowledge of the network graph could be used to split a target node or\r\nnodes from the honest network (eg by knowing which peers to attack in order to\r\nachieve a network split).",
      "created_at" : "2019-04-05T21:37:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15759#issuecomment-480430294",
      "id" : 480430294,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15759",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4MDQzMDI5NA==",
      "updated_at" : "2019-04-05T21:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480430294",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Can you run these simulations assuming x% of the 10,000 peers are black holes (don't connect the graph), for various values of x%?\r\n\r\nThis table shows my simulation results for various black hole rates, with various values of how many outbound connections we make (k=2 is what I've implemented in this PR).  This is on a 10,000 node graph with no non-listening nodes.  Each table entry shows the success count (where success is defined as \"the subgraph of non-black-hole nodes is connected\") out of 1000 simulations.\r\n\r\n\r\nblack hole rate | k=2 | k=4 | k=6 | k=8\r\n-- | -- | -- | -- | --\r\n0 | 1000 | 1000 | 1000 | 1000\r\n5% | 30 | 998 | 1000 | 1000\r\n10% | 0 | 976 | 1000 | 1000\r\n15% | ÃÂ  | 867 | 999 | 1000\r\n20% | ÃÂ  | 598 | 994 | 1000\r\n25% | ÃÂ  | 229 | 978 | 1000\r\n30% | ÃÂ  | 33 | 928 | 998\r\n35% | ÃÂ  | 2 | 812 | 992\r\n\r\n\r\n> 2 might be fine for now, but ultimately I'd like to optimize memory usage for both inbound and outbound blocksonly links, then at least double the inbound connection limit for blocks only links, and make 8 blocks only links.\r\n\r\nThis is roughly what I have in mind as well.  I think we need a p2p protocol change to allow negotiating blocks-only links (so that the peer on the other side of our connection knows that the inbound peer won't turn transaction relay on later), so I figured we could start small for now.",
      "created_at" : "2019-04-08T14:59:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15759#issuecomment-480868516",
      "id" : 480868516,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15759",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4MDg2ODUxNg==",
      "updated_at" : "2019-04-08T14:59:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480868516",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sdaftuar Thanks for sharing the results of the analysis! Would you be willing to share the simulation scripts?",
      "created_at" : "2019-04-08T17:32:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15759#issuecomment-480928635",
      "id" : 480928635,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15759",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4MDkyODYzNQ==",
      "updated_at" : "2019-04-08T17:32:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480928635",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
