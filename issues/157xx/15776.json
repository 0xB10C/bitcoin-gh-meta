{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "I think #14897 introduces a livelock between peers -- if Alice sets the `fPauseSend` flag on Bob, then she will ignore `GETDATA` requests for tx info from Bob, which will cause Bob to leave that tx in the `TxDownloadState::m_tx_in_flight` set for Alice permanently. When that set grows to 100 (`MAX_PEER_TX_IN_FLIGHT`) Bob will cease sending `GETDATA` requests in response to `INV` notifications from Alice. If that happens to all Bob's peers, Bob won't receive any transaction data, only block data.\r\n\r\nI think this was what happened to my node this week, where despite having 8 legit peers and receiving lots of INV traffic, my mempool was empty and I was only requesting tx data when either a block arrived or it had been a long time since I'd seen a block and I added an extra peer. I haven't been able to reproduce this behaviour with just bitcoind (either in the wild or with regtest) though, so can't be sure it wasn't something else.\r\n\r\nPatches are:\r\n * debugging info for `getpeerinfo` to be able to tell if either of the queues are growing\r\n * (slow) test case using a fake p2p node that sends INV's but doesn't reply to GETDATA that shows the behaviour\r\n * fix to expire inflight tx's after 3 minutes (3 times the time when we would have tried getting the tx from a different peer)\r\n\r\n0.18rc3 does behave the same way",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 2,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15776/comments",
   "created_at" : "2019-04-09T12:22:51Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15776/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/15776",
   "id" : 430936986,
   "labels" : [
      {
         "color" : "006b75",
         "default" : false,
         "id" : 98298007,
         "name" : "P2P",
         "node_id" : "MDU6TGFiZWw5ODI5ODAwNw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15776/labels{/name}",
   "locked" : false,
   "milestone" : {
      "closed_at" : null,
      "closed_issues" : 168,
      "created_at" : "2018-05-03T15:34:54Z",
      "creator" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      },
      "description" : "",
      "due_on" : null,
      "html_url" : "https://github.com/bitcoin/bitcoin/milestone/35",
      "id" : 3318051,
      "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/35/labels",
      "node_id" : "MDk6TWlsZXN0b25lMzMxODA1MQ==",
      "number" : 35,
      "open_issues" : 5,
      "state" : "open",
      "title" : "0.18.0",
      "updated_at" : "2019-04-09T12:38:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/35"
   },
   "node_id" : "MDExOlB1bGxSZXF1ZXN0MjY4NzE0MjMz",
   "number" : 15776,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/15776.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15776",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/15776.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15776"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Expire inflight GETDATA requests",
   "updated_at" : "2019-04-09T12:45:16Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15776",
   "user" : {
      "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
      "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
      "followers_url" : "https://api.github.com/users/ajtowns/followers",
      "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
      "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/ajtowns",
      "id" : 127186,
      "login" : "ajtowns",
      "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
      "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
      "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
      "repos_url" : "https://api.github.com/users/ajtowns/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/ajtowns"
   }
}
