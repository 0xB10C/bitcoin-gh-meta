[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-07-30T15:43:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19628#issuecomment-666471177",
      "id" : 666471177,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19628",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NjQ3MTE3Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-30T15:43:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/666471177",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "[Filtered code coverage report](https://people.freebsd.org/~vd/pr19628_daa1d8b11_coverage/) (files not modified by this PR are omitted and not modified lines in files that are otherwise modified are dimmed).\r\n\r\n[List of modified and not covered lines](https://people.freebsd.org/~vd/pr19628_daa1d8b11_coverage/modified_and_not_covered.html).",
      "created_at" : "2020-07-30T16:01:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19628#issuecomment-666487671",
      "id" : 666487671,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19628",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NjQ4NzY3MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-30T16:01:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/666487671",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19415 (net: Make DNS lookup mockable, add fuzzing harness by practicalswift)\n* #18722 (addrman: improve performance by using more suitable containers by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-07-30T20:25:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19628#issuecomment-666670421",
      "id" : 666670421,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19628",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NjY3MDQyMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-30T20:25:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/666670421",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19628#discussion_r463949087"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463949087"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Are you sure the use of `prevector` is warranted here? Measurements would be nice.\r\n\r\nGenerally I think we should try stick with to the standard containers unless we have clear quantitative evidence showing that they are unsuitable for the scenario being considered. Reviewers, static analysers and compilers tend to be better at analysing use of the standard containers :)\r\n\r\nFWIW: \r\n\r\n```\r\n$ git grep -l prevector -- \"*.cpp\" \"*.h\" \":(exclude)src/bench/\" \":(exclude)src/test/\"\r\nsrc/hash.h\r\nsrc/memusage.h\r\nsrc/prevector.h\r\nsrc/script/script.h\r\nsrc/serialize.h\r\n```",
      "commit_id" : "daa1d8b114e5ed3c631a634e02ba0da392db6e8e",
      "created_at" : "2020-08-01T10:36:13Z",
      "diff_hunk" : "@@ -49,18 +51,50 @@ enum Network\n     NET_MAX,\n };\n \n+/// If an IPv6 address begins with this, then we treat the rest of it as IPv4 address.\n+static constexpr uint8_t IPv4_IN_IPv6_PREFIX[12] = {\n+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF\n+};\n+\n+/// If an IPv6 address begins with this, then we treat the rest of it as TORv2 address.\n+static constexpr uint8_t TORv2_IN_IPv6_PREFIX[6] = {\n+    0xFD, 0x87, 0xD8, 0x7E, 0xEB, 0x43\n+};\n+\n+/// If an IPv6 address begins with this, then we treat the rest of it as an internal address.\n+static constexpr uint8_t INTERNAL_IN_IPv6_PREFIX[6] = {\n+    0xFD, 0x6B, 0x88, 0xC0, 0x87, 0x24 // 0xFD + sha256(\"bitcoin\")[0:5].\n+};\n+\n+/// Size of IPv4 address (in bytes).\n+static constexpr size_t ADDR_IPv4_SIZE = 4;\n+\n+/// Size of IPv6 address (in bytes).\n+static constexpr size_t ADDR_IPv6_SIZE = 16;\n+\n+/// Size of TORv2 address (in bytes).\n+static constexpr size_t ADDR_TORv2_SIZE = 10;\n+\n+/// Size of \"internal\" (NET_INTERNAL) address (in bytes).\n+static constexpr size_t ADDR_INTERNAL_SIZE = 10;\n+\n /**\n  * Network address.\n  */\n class CNetAddr\n {\n     protected:\n+        /**\n+         * Raw representation of the network address.\n+         * In network byte order (big endian) for IPv4 and IPv6.\n+         */\n+        prevector<ADDR_IPv6_SIZE, uint8_t> m_addr{ADDR_IPv6_SIZE, 0x0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19628#discussion_r463949087",
      "id" : 463949087,
      "line" : 91,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk0OTA4Nw==",
      "original_commit_id" : "daa1d8b114e5ed3c631a634e02ba0da392db6e8e",
      "original_line" : 91,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/netaddress.h",
      "position" : 51,
      "pull_request_review_id" : 459569784,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19628",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-01T11:37:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463949087",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19628#discussion_r463984610"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19628"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463984610"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I suggested this, so let me back it up.\r\n\r\nCurrently an address in CAddrMan consumes 256 bytes (cost in mapInfo and mapAddr together, plus allocation overhead).\r\n\r\nThis PR as-is raises that to 288 bytes, for addresses that take up to 16 bytes (which is all of them, for now).\r\n\r\nUsing an `std::vector<uint8_t>` instead would change that to 352 bytes per address, or an extra 64 on top. It would also increase memory fragmentation and (slightly) increase CPU usage because of two malloc's per address.\r\n\r\nFTR, my node has 69691 addresses in CAddrMan.",
      "commit_id" : "daa1d8b114e5ed3c631a634e02ba0da392db6e8e",
      "created_at" : "2020-08-01T17:52:19Z",
      "diff_hunk" : "@@ -49,18 +51,50 @@ enum Network\n     NET_MAX,\n };\n \n+/// If an IPv6 address begins with this, then we treat the rest of it as IPv4 address.\n+static constexpr uint8_t IPv4_IN_IPv6_PREFIX[12] = {\n+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF\n+};\n+\n+/// If an IPv6 address begins with this, then we treat the rest of it as TORv2 address.\n+static constexpr uint8_t TORv2_IN_IPv6_PREFIX[6] = {\n+    0xFD, 0x87, 0xD8, 0x7E, 0xEB, 0x43\n+};\n+\n+/// If an IPv6 address begins with this, then we treat the rest of it as an internal address.\n+static constexpr uint8_t INTERNAL_IN_IPv6_PREFIX[6] = {\n+    0xFD, 0x6B, 0x88, 0xC0, 0x87, 0x24 // 0xFD + sha256(\"bitcoin\")[0:5].\n+};\n+\n+/// Size of IPv4 address (in bytes).\n+static constexpr size_t ADDR_IPv4_SIZE = 4;\n+\n+/// Size of IPv6 address (in bytes).\n+static constexpr size_t ADDR_IPv6_SIZE = 16;\n+\n+/// Size of TORv2 address (in bytes).\n+static constexpr size_t ADDR_TORv2_SIZE = 10;\n+\n+/// Size of \"internal\" (NET_INTERNAL) address (in bytes).\n+static constexpr size_t ADDR_INTERNAL_SIZE = 10;\n+\n /**\n  * Network address.\n  */\n class CNetAddr\n {\n     protected:\n+        /**\n+         * Raw representation of the network address.\n+         * In network byte order (big endian) for IPv4 and IPv6.\n+         */\n+        prevector<ADDR_IPv6_SIZE, uint8_t> m_addr{ADDR_IPv6_SIZE, 0x0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19628#discussion_r463984610",
      "id" : 463984610,
      "in_reply_to_id" : 463949087,
      "line" : 91,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk4NDYxMA==",
      "original_commit_id" : "daa1d8b114e5ed3c631a634e02ba0da392db6e8e",
      "original_line" : 91,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/netaddress.h",
      "position" : 51,
      "pull_request_review_id" : 459593442,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19628",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-01T17:52:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463984610",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
