[
   {
      "author_association" : "MEMBER",
      "body" : "Friendly ping @ajtowns @vasild ",
      "created_at" : "2020-08-05T12:44:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19668#issuecomment-669171329",
      "id" : 669171329,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19668",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2OTE3MTMyOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-05T12:44:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669171329",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19668#discussion_r465738894"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/465738894"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It seems a layer-violation to import the validation lock cs_main into the net.h header to annotate this function. Also, this approach doesn't seem like it scales, since it has to be done for each mutex that is held during a call to `ForEachNode`.",
      "commit_id" : "fcf6569d2e6d55411773d06380770b0c355408b9",
      "created_at" : "2020-08-05T13:47:31Z",
      "diff_hunk" : "@@ -208,8 +210,18 @@ class CConnman\n \n     void PushMessage(CNode* pnode, CSerializedNetMsg&& msg);\n \n-    template<typename Callable>\n-    void ForEachNode(Callable&& func)\n+    template <typename Callable>\n+    void ForEachNodeUnlocked(Callable&& func) EXCLUSIVE_LOCKS_REQUIRED(!::cs_main)\n+    {\n+        LOCK(cs_vNodes);\n+        for (auto&& node : vNodes) {\n+            if (NodeFullyConnected(node))\n+                func(node);\n+        }\n+    };\n+\n+    template <typename Callable>\n+    void ForEachNode(Callable&& func) EXCLUSIVE_LOCKS_REQUIRED(::cs_main)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19668#discussion_r465738894",
      "id" : 465738894,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTczODg5NA==",
      "original_commit_id" : "5d64c6b18f158986e757e1d1f8e06b9a5ff22b48",
      "original_line" : 224,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 461680445,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19668",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-06T06:06:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/465738894",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated fa9157916514903cd7b526375597b1de0d8df8f0 -> 3f00515e92e7b6aed97c126592ad94b8a52a0e18 ([pr19668.01](https://github.com/hebasto/bitcoin/commits/pr19668.01) -> [pr19668.02](https://github.com/hebasto/bitcoin/commits/pr19668.02), [diff](https://github.com/hebasto/bitcoin/compare/pr19668.01..pr19668.02)).\r\n\r\nThis is an alternative approach without issues [mentioned](https://github.com/bitcoin/bitcoin/pull/19668#discussion_r465738894) by @MarcoFalke:\r\n> It seems a layer-violation to import the validation lock cs_main into the net.h header to annotate this function. Also, this approach doesn't seem like it scales, since it has to be done for each mutex that is held during a call to `ForEachNode`.\r\n\r\n",
      "created_at" : "2020-08-05T14:38:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19668#issuecomment-669231930",
      "id" : 669231930,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19668",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2OTIzMTkzMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-05T14:43:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669231930",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke \r\n> weak Concept ACK. Will review some more later\r\n\r\nUpdated motivation in the OP.",
      "created_at" : "2020-08-05T14:42:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19668#issuecomment-669233841",
      "id" : 669233841,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19668",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2OTIzMzg0MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-05T14:42:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669233841",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19668#discussion_r465779202"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/465779202"
         }
      },
      "author_association" : "MEMBER",
      "body" : "[Updated](https://github.com/bitcoin/bitcoin/pull/19668#issuecomment-669231930).",
      "commit_id" : "fcf6569d2e6d55411773d06380770b0c355408b9",
      "created_at" : "2020-08-05T14:43:17Z",
      "diff_hunk" : "@@ -208,8 +210,18 @@ class CConnman\n \n     void PushMessage(CNode* pnode, CSerializedNetMsg&& msg);\n \n-    template<typename Callable>\n-    void ForEachNode(Callable&& func)\n+    template <typename Callable>\n+    void ForEachNodeUnlocked(Callable&& func) EXCLUSIVE_LOCKS_REQUIRED(!::cs_main)\n+    {\n+        LOCK(cs_vNodes);\n+        for (auto&& node : vNodes) {\n+            if (NodeFullyConnected(node))\n+                func(node);\n+        }\n+    };\n+\n+    template <typename Callable>\n+    void ForEachNode(Callable&& func) EXCLUSIVE_LOCKS_REQUIRED(::cs_main)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19668#discussion_r465779202",
      "id" : 465779202,
      "in_reply_to_id" : 465738894,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc3OTIwMg==",
      "original_commit_id" : "5d64c6b18f158986e757e1d1f8e06b9a5ff22b48",
      "original_line" : 224,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 461734281,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19668",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-06T06:06:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/465779202",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK.\r\n\r\nI'd suggest going further and annotating the `AssertLock(Not)Held` calls with `EXCLUSIVE_LOCKS_REQUIRED(cs)` (or `!cs`) too. This catches existing missing annotations in `validation.cpp:CheckSequenceLocks` and `wallet/scriptpubkeyman.cpp:DescriptorScriptPubKeyMan::AddDescriptKeyWithDb` so seems worthwhile. Patch at https://github.com/ajtowns/bitcoin/commits/202008-assertlockheld",
      "created_at" : "2020-08-05T17:01:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19668#issuecomment-669312538",
      "id" : 669312538,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19668",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2OTMxMjUzOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-05T17:01:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669312538",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ajtowns \r\n> I'd suggest going further and annotating the `AssertLock(Not)Held` calls with `EXCLUSIVE_LOCKS_REQUIRED(cs)` (or `!cs`) too. This catches existing missing annotations in `validation.cpp:CheckSequenceLocks` and `wallet/scriptpubkeyman.cpp:DescriptorScriptPubKeyMan::AddDescriptKeyWithDb` so seems worthwhile. Patch at https://github.com/ajtowns/bitcoin/commits/202008-assertlockheld\r\n\r\nThanks! Done.\r\n",
      "created_at" : "2020-08-05T17:30:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19668#issuecomment-669326867",
      "id" : 669326867,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19668",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2OTMyNjg2Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-05T17:30:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669326867",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Might be good to fix up the lock annotations before removing the ASSERT annotation on AssertLockHeldInternal so you can compile successfully at each commit? Otherwise looks good to me.",
      "created_at" : "2020-08-06T06:01:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19668#issuecomment-669720297",
      "id" : 669720297,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19668",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2OTcyMDI5Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-06T06:01:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669720297",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ajtowns \r\n> Might be good to fix up the lock annotations before removing the ASSERT annotation on AssertLockHeldInternal so you can compile successfully at each commit? Otherwise looks good to me.\r\n\r\nDone, commits are reordered now.",
      "created_at" : "2020-08-06T06:07:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19668#issuecomment-669722304",
      "id" : 669722304,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19668",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2OTcyMjMwNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-06T06:07:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669722304",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Perhaps the **Locking/mutex usage notes** section of developer-notes.md should be updated with the current best practice for annotating/asserting locks.",
      "created_at" : "2020-08-07T10:56:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19668#issuecomment-670459278",
      "id" : 670459278,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19668",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MDQ1OTI3OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-07T10:56:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/670459278",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery \r\n> Concept ACK. Perhaps the **Locking/mutex usage notes** section of developer-notes.md should be updated with the current best practice for annotating/asserting locks.\r\n\r\nYou read my mind :)\r\n\r\nDo you want me adding a doc commit to this PR?",
      "created_at" : "2020-08-07T11:18:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19668#issuecomment-670467580",
      "id" : 670467580,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19668",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MDQ2NzU4MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-07T11:18:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/670467580",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Do you want me adding a doc commit to this PR?\r\n\r\nI think it's fine to add it to this PR.",
      "created_at" : "2020-08-07T12:09:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19668#issuecomment-670485238",
      "id" : 670485238,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19668",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MDQ4NTIzOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-07T12:09:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/670485238",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19668#discussion_r467045878"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/467045878"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "These can also be tagged with `ASSERT_EXCLUSIVE_LOCK`.\r\n\r\n```suggestion\r\nvoid AssertLockHeldInternal(const char* pszName, const char* pszFile, int nLine, MutexType* cs) ASSERT_EXCLUSIVE_LOCK(cs) EXCLUSIVE_LOCKS_REQUIRED(cs);\r\ntemplate <typename MutexType>\r\nvoid AssertLockNotHeldInternal(const char* pszName, const char* pszFile, int nLine, MutexType* cs) ASSERT_EXCLUSIVE_LOCK(cs) EXCLUSIVE_LOCKS_REQUIRED(!cs);\r\n```",
      "commit_id" : "fcf6569d2e6d55411773d06380770b0c355408b9",
      "created_at" : "2020-08-07T13:38:33Z",
      "diff_hunk" : "@@ -53,8 +53,9 @@ void LeaveCritical();\n void CheckLastCritical(void* cs, std::string& lockname, const char* guardname, const char* file, int line);\n std::string LocksHeld();\n template <typename MutexType>\n-void AssertLockHeldInternal(const char* pszName, const char* pszFile, int nLine, MutexType* cs) ASSERT_EXCLUSIVE_LOCK(cs);\n-void AssertLockNotHeldInternal(const char* pszName, const char* pszFile, int nLine, void* cs);\n+void AssertLockHeldInternal(const char* pszName, const char* pszFile, int nLine, MutexType* cs) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+template <typename MutexType>\n+void AssertLockNotHeldInternal(const char* pszName, const char* pszFile, int nLine, MutexType* cs) EXCLUSIVE_LOCKS_REQUIRED(!cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19668#discussion_r467045878",
      "id" : 467045878,
      "line" : 58,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA0NTg3OA==",
      "original_commit_id" : "fcf6569d2e6d55411773d06380770b0c355408b9",
      "original_line" : 58,
      "original_position" : 8,
      "original_start_line" : 56,
      "path" : "src/sync.h",
      "position" : 8,
      "pull_request_review_id" : 463319254,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19668",
      "side" : "RIGHT",
      "start_line" : 56,
      "start_side" : "RIGHT",
      "updated_at" : "2020-08-07T13:38:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/467045878",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19668#discussion_r467244459"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/467244459"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I tried the following with `AssertLockHeldInternal() EXCLUSIVE_LOCKS_REQUIRED(cs) ASSERT_EXCLUSIVE_LOCK(cs);`:\r\n\r\n```cpp\r\nvoid f()\r\n{\r\n    // The following line produces a warning due to the EXCLUSIVE_LOCKS_REQUIRED attribute:\r\n    // Calling function 'AssertLockHeldInternal<AnnotatedMixin<std:: __1::recursive_mutex>>' requires holding mutex 'cs_main' exclusively [-Wthread-safety-analysis]\r\n    AssertLockHeld(cs_main);\r\n\r\n    // The following line produces a warning due to the ASSERT_EXCLUSIVE_LOCK attribute:\r\n    // Acquiring mutex 'cs_main' that is already held\r\n    LOCK(cs_main);\r\n}\r\n```\r\n\r\nHowever if the assert attribute is defined first: `ASSERT_EXCLUSIVE_LOCK(cs) EXCLUSIVE_LOCKS_REQUIRED(cs)` then only the second warning is generated (`EXCLUSIVE_LOCKS_REQUIRED` is ignored in this case).",
      "commit_id" : "fcf6569d2e6d55411773d06380770b0c355408b9",
      "created_at" : "2020-08-07T20:04:10Z",
      "diff_hunk" : "@@ -53,8 +53,9 @@ void LeaveCritical();\n void CheckLastCritical(void* cs, std::string& lockname, const char* guardname, const char* file, int line);\n std::string LocksHeld();\n template <typename MutexType>\n-void AssertLockHeldInternal(const char* pszName, const char* pszFile, int nLine, MutexType* cs) ASSERT_EXCLUSIVE_LOCK(cs);\n-void AssertLockNotHeldInternal(const char* pszName, const char* pszFile, int nLine, void* cs);\n+void AssertLockHeldInternal(const char* pszName, const char* pszFile, int nLine, MutexType* cs) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+template <typename MutexType>\n+void AssertLockNotHeldInternal(const char* pszName, const char* pszFile, int nLine, MutexType* cs) EXCLUSIVE_LOCKS_REQUIRED(!cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19668#discussion_r467244459",
      "id" : 467244459,
      "in_reply_to_id" : 467045878,
      "line" : 58,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI0NDQ1OQ==",
      "original_commit_id" : "fcf6569d2e6d55411773d06380770b0c355408b9",
      "original_line" : 58,
      "original_position" : 8,
      "original_start_line" : 56,
      "path" : "src/sync.h",
      "position" : 8,
      "pull_request_review_id" : 463579951,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19668",
      "side" : "RIGHT",
      "start_line" : 56,
      "start_side" : "RIGHT",
      "updated_at" : "2020-08-07T20:04:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/467244459",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19668#discussion_r467261327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/467261327"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> These can also be tagged with `ASSERT_EXCLUSIVE_LOCK`.\r\n\r\nWhat are expected benefits?",
      "commit_id" : "fcf6569d2e6d55411773d06380770b0c355408b9",
      "created_at" : "2020-08-07T20:47:08Z",
      "diff_hunk" : "@@ -53,8 +53,9 @@ void LeaveCritical();\n void CheckLastCritical(void* cs, std::string& lockname, const char* guardname, const char* file, int line);\n std::string LocksHeld();\n template <typename MutexType>\n-void AssertLockHeldInternal(const char* pszName, const char* pszFile, int nLine, MutexType* cs) ASSERT_EXCLUSIVE_LOCK(cs);\n-void AssertLockNotHeldInternal(const char* pszName, const char* pszFile, int nLine, void* cs);\n+void AssertLockHeldInternal(const char* pszName, const char* pszFile, int nLine, MutexType* cs) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+template <typename MutexType>\n+void AssertLockNotHeldInternal(const char* pszName, const char* pszFile, int nLine, MutexType* cs) EXCLUSIVE_LOCKS_REQUIRED(!cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19668#discussion_r467261327",
      "id" : 467261327,
      "in_reply_to_id" : 467045878,
      "line" : 58,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI2MTMyNw==",
      "original_commit_id" : "fcf6569d2e6d55411773d06380770b0c355408b9",
      "original_line" : 58,
      "original_position" : 8,
      "original_start_line" : 56,
      "path" : "src/sync.h",
      "position" : 8,
      "pull_request_review_id" : 463601724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19668",
      "side" : "RIGHT",
      "start_line" : 56,
      "start_side" : "RIGHT",
      "updated_at" : "2020-08-07T20:47:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/467261327",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   }
]
