[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Could we change `BerkeleyBatch::WriteKey` to return an enum describing the error? that will be inconsistent with the current API though.\r\nbut it will allow us to print a good error for the user, as he should probably know he already have that descriptor ",
      "created_at" : "2020-08-03T12:09:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19651#issuecomment-667987452",
      "id" : 667987452,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19651",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2Nzk4NzQ1Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-03T12:09:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/667987452",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think we should go with option 2: To update the existing spkman. The keys should either already exist or are being imported at that time. I don't think it's good to add keys in memory and not write them to disk as this could potentially result in lost keys.",
      "created_at" : "2020-08-03T16:07:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19651#issuecomment-668107138",
      "id" : 668107138,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19651",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2ODEwNzEzOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-03T16:07:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/668107138",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Could we change `BerkeleyBatch::WriteKey` to return an enum describing the error? that will be inconsistent with the current API though.\r\n> but it will allow us to print a good error for the user, as he should probably know he already have that descriptor\r\n\r\n@elichai I believe it's better to process the command rather than just show better error message, because it allows to modify some meta data: for example descriptor's range. However I added a trivial commit to make error message less misleading.\r\n\r\n> I think we should go with option 2: To update the existing spkman. The keys should either already exist or are being imported at that time. I don't think it's good to add keys in memory and not write them to disk as this could potentially result in lost keys.\r\n\r\n@achow101 Indeed, this aligns with my intuition as well. I changed the implementation and it looks cleaner to me. Hope I got the update semantics correct for the `DescriptorScriptPubKeyMan`. Could you please check?\r\n\r\n\r\n\r\n",
      "created_at" : "2020-08-06T08:45:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19651#issuecomment-669798234",
      "id" : 669798234,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19651",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2OTc5ODIzNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-06T08:45:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669798234",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19602 (wallet: Migrate legacy wallets to descriptor wallets by achow101)\n* #19136 (wallet: add parent_desc to getaddressinfo by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-08-06T13:36:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19651#issuecomment-669930910",
      "id" : 669930910,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19651",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2OTkzMDkxMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-06T13:36:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669930910",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19651#discussion_r466555962"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19651"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466555962"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We also need to check that new range_end >= old range_end.",
      "commit_id" : "d8eb7b54060e1dc3d3bf38d152deebe7855ac5b9",
      "created_at" : "2020-08-06T17:03:17Z",
      "diff_hunk" : "@@ -2254,3 +2254,22 @@ const std::vector<CScript> DescriptorScriptPubKeyMan::GetScriptPubKeys() const\n     }\n     return script_pub_keys;\n }\n+\n+void DescriptorScriptPubKeyMan::UpdateDescriptor(WalletDescriptor& descriptor)\n+{\n+    LOCK(cs_desc_man);\n+    if (!HasWalletDescriptor(descriptor)) {\n+        throw std::runtime_error(std::string(__func__) + \": can only update matching descriptor\");\n+    }\n+    if (descriptor.range_start > m_wallet_descriptor.range_start) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19651#discussion_r466555962",
      "id" : 466555962,
      "line" : 2264,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU1NTk2Mg==",
      "original_commit_id" : "d95d9b706007ba83c6c355f4fdabcd16d0bbfdb3",
      "original_line" : 2264,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 11,
      "pull_request_review_id" : 462706376,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19651",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-06T17:11:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466555962",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
