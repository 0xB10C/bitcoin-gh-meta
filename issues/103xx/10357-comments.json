[
   {
      "body" : "Yea, sure, conceptack as a hidden setting.",
      "created_at" : "2017-05-08T21:22:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10357#issuecomment-299994877",
      "id" : 299994877,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10357",
      "updated_at" : "2017-05-08T21:22:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/299994877",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "I just realized this doesn't quite work cleanly with #10345; closing for now.",
      "created_at" : "2017-05-09T11:59:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10357#issuecomment-300141728",
      "id" : 300141728,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10357",
      "updated_at" : "2017-05-09T11:59:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/300141728",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r120998668"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120998668"
         }
      },
      "body" : "I suggest:\r\n- always log the nMinimumChainWork and default value (even if it hasn't been overwritten in config) \r\n- issue a stronger warning in the log if `-minimumchainwork` is set lower than the default value eg \"nMinimumChainWork is set below the default value. This node may sync to a chain which is not the known most-work blockchain.\"",
      "commit_id" : "f1041efca442dd0b56dbfdd99dedcef333a90e75",
      "created_at" : "2017-06-08T21:04:47Z",
      "diff_hunk" : "@@ -973,6 +976,11 @@ bool AppInitParameterInteraction()\n     else\n         LogPrintf(\"Validating signatures for all blocks.\\n\");\n \n+    nMinimumChainWork = UintToArith256(uint256S(GetArg(\"-minimumchainwork\", chainparams.GetConsensus().nMinimumChainWork.GetHex())));\n+    if (nMinimumChainWork != UintToArith256(chainparams.GetConsensus().nMinimumChainWork)) {\n+        LogPrintf(\"Setting nMinimumChainWork=%s (%s default value)\\n\", nMinimumChainWork.GetHex(), (nMinimumChainWork < UintToArith256(chainparams.GetConsensus().nMinimumChainWork)) ? \"below\" : \"above\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r120998668",
      "id" : 120998668,
      "original_commit_id" : "87fb774569a61d3a9c5b774f438d4f342bc7554e",
      "original_position" : 16,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 43013428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357",
      "updated_at" : "2017-06-13T21:37:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120998668",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r120998733"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120998733"
         }
      },
      "body" : "suggest \"Minimum work assumed to exist on a valid chain *in hex*\"",
      "commit_id" : "f1041efca442dd0b56dbfdd99dedcef333a90e75",
      "created_at" : "2017-06-08T21:05:10Z",
      "diff_hunk" : "@@ -355,6 +355,9 @@ std::string HelpMessage(HelpMessageMode mode)\n     strUsage += HelpMessageOpt(\"-maxorphantx=<n>\", strprintf(_(\"Keep at most <n> unconnectable transactions in memory (default: %u)\"), DEFAULT_MAX_ORPHAN_TRANSACTIONS));\n     strUsage += HelpMessageOpt(\"-maxmempool=<n>\", strprintf(_(\"Keep the transaction memory pool below <n> megabytes (default: %u)\"), DEFAULT_MAX_MEMPOOL_SIZE));\n     strUsage += HelpMessageOpt(\"-mempoolexpiry=<n>\", strprintf(_(\"Do not keep transactions in the mempool longer than <n> hours (default: %u)\"), DEFAULT_MEMPOOL_EXPIRY));\n+    if (showDebug) {\n+        strUsage += HelpMessageOpt(\"-minimumchainwork\", strprintf(\"Minimum work assumed to exist on a valid chain (default: %s, testnet: %s)\", Params(CBaseChainParams::MAIN).GetConsensus().nMinimumChainWork.GetHex(), Params(CBaseChainParams::TESTNET).GetConsensus().nMinimumChainWork.GetHex()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r120998733",
      "id" : 120998733,
      "original_commit_id" : "87fb774569a61d3a9c5b774f438d4f342bc7554e",
      "original_position" : 5,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 43013428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357",
      "updated_at" : "2017-06-13T21:37:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120998733",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r121001613"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121001613"
         }
      },
      "body" : "default number of nodes in the base class is 4, so you don't need to override this here.",
      "commit_id" : "f1041efca442dd0b56dbfdd99dedcef333a90e75",
      "created_at" : "2017-06-08T21:19:57Z",
      "diff_hunk" : "@@ -0,0 +1,81 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test logic for setting nMinimumChainWork on command line.\n+\n+Nodes don't consider themselves out of \"initial block download\" until\n+their active chain has more work than nMinimumChainWork.\n+\n+While in initial block download, nodes won't relay blocks to their peers, so\n+test that this parameter functions as intended by verifying that block relay\n+only succeeds past a given node once its nMinimumChainWork has been exceeded.\n+\"\"\"\n+\n+import time\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import sync_blocks, connect_nodes\n+\n+# 2 hashes required per regtest block (with no difficulty adjustment)\n+REGTEST_WORK_PER_BLOCK = 2\n+\n+class MinimumChainWorkTest(BitcoinTestFramework):\n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 4",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r121001613",
      "id" : 121001613,
      "original_commit_id" : "87fb774569a61d3a9c5b774f438d4f342bc7554e",
      "original_position" : 27,
      "path" : "test/functional/minchainwork.py",
      "position" : null,
      "pull_request_review_id" : 43013428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357",
      "updated_at" : "2017-06-13T21:37:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121001613",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r121002605"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121002605"
         }
      },
      "body" : "The default test topology is a chain node0 <-> node1 <-> node2 <-> node3, so you don't need to override this method. You may want to move the comment into the module docstring.",
      "commit_id" : "f1041efca442dd0b56dbfdd99dedcef333a90e75",
      "created_at" : "2017-06-08T21:25:10Z",
      "diff_hunk" : "@@ -0,0 +1,81 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test logic for setting nMinimumChainWork on command line.\n+\n+Nodes don't consider themselves out of \"initial block download\" until\n+their active chain has more work than nMinimumChainWork.\n+\n+While in initial block download, nodes won't relay blocks to their peers, so\n+test that this parameter functions as intended by verifying that block relay\n+only succeeds past a given node once its nMinimumChainWork has been exceeded.\n+\"\"\"\n+\n+import time\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import sync_blocks, connect_nodes\n+\n+# 2 hashes required per regtest block (with no difficulty adjustment)\n+REGTEST_WORK_PER_BLOCK = 2\n+\n+class MinimumChainWorkTest(BitcoinTestFramework):\n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 4\n+        self.extra_args = [[], [\"-minimumchainwork=0x65\"], [\"-minimumchainwork=0xff\"], [\"-minimumchainwork=0x01ff\"]]\n+        self.node_min_work = [0, 101, 255, 511]\n+\n+    def setup_network(self):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r121002605",
      "id" : 121002605,
      "original_commit_id" : "87fb774569a61d3a9c5b774f438d4f342bc7554e",
      "original_position" : 31,
      "path" : "test/functional/minchainwork.py",
      "position" : null,
      "pull_request_review_id" : 43013428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357",
      "updated_at" : "2017-06-13T21:37:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121002605",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r121002725"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121002725"
         }
      },
      "body" : "Use `REGTEST_WORK_PER_BLOCK` instead of hardcoding this?",
      "commit_id" : "f1041efca442dd0b56dbfdd99dedcef333a90e75",
      "created_at" : "2017-06-08T21:25:43Z",
      "diff_hunk" : "@@ -0,0 +1,81 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test logic for setting nMinimumChainWork on command line.\n+\n+Nodes don't consider themselves out of \"initial block download\" until\n+their active chain has more work than nMinimumChainWork.\n+\n+While in initial block download, nodes won't relay blocks to their peers, so\n+test that this parameter functions as intended by verifying that block relay\n+only succeeds past a given node once its nMinimumChainWork has been exceeded.\n+\"\"\"\n+\n+import time\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import sync_blocks, connect_nodes\n+\n+# 2 hashes required per regtest block (with no difficulty adjustment)\n+REGTEST_WORK_PER_BLOCK = 2\n+\n+class MinimumChainWorkTest(BitcoinTestFramework):\n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 4\n+        self.extra_args = [[], [\"-minimumchainwork=0x65\"], [\"-minimumchainwork=0xff\"], [\"-minimumchainwork=0x01ff\"]]\n+        self.node_min_work = [0, 101, 255, 511]\n+\n+    def setup_network(self):\n+        # This test relies on the chain setup being:\n+        # node0 <- node1 <- node2 <- node3\n+        # Before leaving IBD, nodes prefer to download blocks from outbound\n+        # peers, so ensure that we're mining on an outbound peer and testing\n+        # block relay to inbound peers.\n+        self.setup_nodes()\n+        for i in range(self.num_nodes-1):\n+            connect_nodes(self.nodes[i+1], i)\n+\n+    def run_test(self):\n+        # Start building a chain on node0.  node2 shouldn't be able to sync until node1's\n+        # minchainwork is exceeded; node3 shouldn't be able to sync until node2's minchainwork\n+        # is exceeded.\n+        cumulative_chain_work = 2 # Genesis block's work",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r121002725",
      "id" : 121002725,
      "original_commit_id" : "87fb774569a61d3a9c5b774f438d4f342bc7554e",
      "original_position" : 45,
      "path" : "test/functional/minchainwork.py",
      "position" : null,
      "pull_request_review_id" : 43013428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357",
      "updated_at" : "2017-06-13T21:37:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121002725",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r121002803"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121002803"
         }
      },
      "body" : "I think this `2` refers to work per block? In that case, replace with `REGTEST_WORK_PER_BLOCK`",
      "commit_id" : "f1041efca442dd0b56dbfdd99dedcef333a90e75",
      "created_at" : "2017-06-08T21:26:05Z",
      "diff_hunk" : "@@ -0,0 +1,81 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test logic for setting nMinimumChainWork on command line.\n+\n+Nodes don't consider themselves out of \"initial block download\" until\n+their active chain has more work than nMinimumChainWork.\n+\n+While in initial block download, nodes won't relay blocks to their peers, so\n+test that this parameter functions as intended by verifying that block relay\n+only succeeds past a given node once its nMinimumChainWork has been exceeded.\n+\"\"\"\n+\n+import time\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import sync_blocks, connect_nodes\n+\n+# 2 hashes required per regtest block (with no difficulty adjustment)\n+REGTEST_WORK_PER_BLOCK = 2\n+\n+class MinimumChainWorkTest(BitcoinTestFramework):\n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 4\n+        self.extra_args = [[], [\"-minimumchainwork=0x65\"], [\"-minimumchainwork=0xff\"], [\"-minimumchainwork=0x01ff\"]]\n+        self.node_min_work = [0, 101, 255, 511]\n+\n+    def setup_network(self):\n+        # This test relies on the chain setup being:\n+        # node0 <- node1 <- node2 <- node3\n+        # Before leaving IBD, nodes prefer to download blocks from outbound\n+        # peers, so ensure that we're mining on an outbound peer and testing\n+        # block relay to inbound peers.\n+        self.setup_nodes()\n+        for i in range(self.num_nodes-1):\n+            connect_nodes(self.nodes[i+1], i)\n+\n+    def run_test(self):\n+        # Start building a chain on node0.  node2 shouldn't be able to sync until node1's\n+        # minchainwork is exceeded; node3 shouldn't be able to sync until node2's minchainwork\n+        # is exceeded.\n+        cumulative_chain_work = 2 # Genesis block's work\n+        for i in [1,2]:\n+            self.log.info(\"Testing relay across node %d (minChainWork = %d)\", i, self.node_min_work[i])\n+\n+            starting_blockcount = self.nodes[i+1].getblockcount()\n+\n+            num_blocks_to_generate = int((self.node_min_work[i] - cumulative_chain_work) / 2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r121002803",
      "id" : 121002803,
      "original_commit_id" : "87fb774569a61d3a9c5b774f438d4f342bc7554e",
      "original_position" : 51,
      "path" : "test/functional/minchainwork.py",
      "position" : null,
      "pull_request_review_id" : 43013428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357",
      "updated_at" : "2017-06-13T21:37:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121002803",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r121803599"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121803599"
         }
      },
      "body" : "Regarding the stronger warning: it's hard to exactly say what may happen if nMinimumChainWork is too low, as it's just an anti-DoS threshold.  There's no reason to think that we would then sync to something that's not the most-work blockchain, unless there were some other attack going on.\r\n\r\nI decided that since this is already a hidden option it's sufficient to just log a warning if the value is below the default, without specifying the risk.",
      "commit_id" : "f1041efca442dd0b56dbfdd99dedcef333a90e75",
      "created_at" : "2017-06-13T21:36:57Z",
      "diff_hunk" : "@@ -973,6 +976,11 @@ bool AppInitParameterInteraction()\n     else\n         LogPrintf(\"Validating signatures for all blocks.\\n\");\n \n+    nMinimumChainWork = UintToArith256(uint256S(GetArg(\"-minimumchainwork\", chainparams.GetConsensus().nMinimumChainWork.GetHex())));\n+    if (nMinimumChainWork != UintToArith256(chainparams.GetConsensus().nMinimumChainWork)) {\n+        LogPrintf(\"Setting nMinimumChainWork=%s (%s default value)\\n\", nMinimumChainWork.GetHex(), (nMinimumChainWork < UintToArith256(chainparams.GetConsensus().nMinimumChainWork)) ? \"below\" : \"above\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r121803599",
      "id" : 121803599,
      "original_commit_id" : "87fb774569a61d3a9c5b774f438d4f342bc7554e",
      "original_position" : 16,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 43862338,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357",
      "updated_at" : "2017-06-13T21:37:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121803599",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r121803608"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121803608"
         }
      },
      "body" : "I ended up changing this test to use 3 nodes, but I wanted to fully specify the topology since the test depends on it -- eg if someone were to change the default I thought it would be unfortunate if the test then broke.",
      "commit_id" : "f1041efca442dd0b56dbfdd99dedcef333a90e75",
      "created_at" : "2017-06-13T21:36:59Z",
      "diff_hunk" : "@@ -0,0 +1,81 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test logic for setting nMinimumChainWork on command line.\n+\n+Nodes don't consider themselves out of \"initial block download\" until\n+their active chain has more work than nMinimumChainWork.\n+\n+While in initial block download, nodes won't relay blocks to their peers, so\n+test that this parameter functions as intended by verifying that block relay\n+only succeeds past a given node once its nMinimumChainWork has been exceeded.\n+\"\"\"\n+\n+import time\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import sync_blocks, connect_nodes\n+\n+# 2 hashes required per regtest block (with no difficulty adjustment)\n+REGTEST_WORK_PER_BLOCK = 2\n+\n+class MinimumChainWorkTest(BitcoinTestFramework):\n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 4",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r121803608",
      "id" : 121803608,
      "original_commit_id" : "87fb774569a61d3a9c5b774f438d4f342bc7554e",
      "original_position" : 27,
      "path" : "test/functional/minchainwork.py",
      "position" : null,
      "pull_request_review_id" : 43862350,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357",
      "updated_at" : "2017-06-13T21:37:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121803608",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "This needed a rebase.\r\n\r\n@jnewbery Thanks for the review.  I addressed or responded to most of your comments.  I think the only thing I didn't do was require that the `-minimumchainwork` command line value start with \"0x\", mostly because I struggled to (a) figure out how to concisely explain that to the user in the help message, and (b) I noticed that GetHex() already doesn't print a \"0x\", so it would be extra confusing that the defaults don't match the specification if we required \"0x.\" ",
      "created_at" : "2017-06-13T21:42:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10357#issuecomment-308257212",
      "id" : 308257212,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10357",
      "updated_at" : "2017-06-13T21:42:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/308257212",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r121938454"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121938454"
         }
      },
      "body" : "On further thought, perhaps I should add a warning if you set it above the default value?  Because that could actually prevent you from syncing.",
      "commit_id" : "f1041efca442dd0b56dbfdd99dedcef333a90e75",
      "created_at" : "2017-06-14T12:59:04Z",
      "diff_hunk" : "@@ -973,6 +976,11 @@ bool AppInitParameterInteraction()\n     else\n         LogPrintf(\"Validating signatures for all blocks.\\n\");\n \n+    nMinimumChainWork = UintToArith256(uint256S(GetArg(\"-minimumchainwork\", chainparams.GetConsensus().nMinimumChainWork.GetHex())));\n+    if (nMinimumChainWork != UintToArith256(chainparams.GetConsensus().nMinimumChainWork)) {\n+        LogPrintf(\"Setting nMinimumChainWork=%s (%s default value)\\n\", nMinimumChainWork.GetHex(), (nMinimumChainWork < UintToArith256(chainparams.GetConsensus().nMinimumChainWork)) ? \"below\" : \"above\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r121938454",
      "id" : 121938454,
      "original_commit_id" : "87fb774569a61d3a9c5b774f438d4f342bc7554e",
      "original_position" : 16,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 44007718,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357",
      "updated_at" : "2017-06-14T12:59:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121938454",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r122022548"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122022548"
         }
      },
      "body" : "If someone changed the default topology, it'd be unfortunate if a lot of tests *didn't* break! (since the topology is fundamental assumption for how the test nodes should behave)\r\n\r\nAnyway, this was just a style nit - I have no objection to keeping the `setup_network()` override.",
      "commit_id" : "f1041efca442dd0b56dbfdd99dedcef333a90e75",
      "created_at" : "2017-06-14T18:07:33Z",
      "diff_hunk" : "@@ -0,0 +1,81 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test logic for setting nMinimumChainWork on command line.\n+\n+Nodes don't consider themselves out of \"initial block download\" until\n+their active chain has more work than nMinimumChainWork.\n+\n+While in initial block download, nodes won't relay blocks to their peers, so\n+test that this parameter functions as intended by verifying that block relay\n+only succeeds past a given node once its nMinimumChainWork has been exceeded.\n+\"\"\"\n+\n+import time\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import sync_blocks, connect_nodes\n+\n+# 2 hashes required per regtest block (with no difficulty adjustment)\n+REGTEST_WORK_PER_BLOCK = 2\n+\n+class MinimumChainWorkTest(BitcoinTestFramework):\n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 4",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10357#discussion_r122022548",
      "id" : 122022548,
      "original_commit_id" : "87fb774569a61d3a9c5b774f438d4f342bc7554e",
      "original_position" : 27,
      "path" : "test/functional/minchainwork.py",
      "position" : null,
      "pull_request_review_id" : 44101175,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10357",
      "updated_at" : "2017-06-14T18:07:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122022548",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "tested ACK https://github.com/bitcoin/bitcoin/pull/10357/commits/f1041efca442dd0b56dbfdd99dedcef333a90e75. Very nice work with the test coverage for the new `IsHexNumber()` util function.\r\n\r\nAs for not requiring a leading `0x`, I think that's fine. The only minor problem I could see is someone entering a decimal number and the parser interpreting it as hex. That's now mitigated by:\r\n- the help text saying the number should be hex\r\n- the log message always printing out the minimum chain work in hex",
      "created_at" : "2017-06-14T18:11:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10357#issuecomment-308513984",
      "id" : 308513984,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10357",
      "updated_at" : "2017-06-14T18:11:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/308513984",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
