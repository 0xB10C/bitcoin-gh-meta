[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10372#discussion_r115778800"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10372"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115778800"
         }
      },
      "body" : "I don't think you actually need these casts.",
      "commit_id" : "1dd6c6151381a39d4f734e05a38f71021c9c719c",
      "created_at" : "2017-05-10T15:49:30Z",
      "diff_hunk" : "@@ -207,6 +207,30 @@ static std::mutex cs_rng_state;\n static unsigned char rng_state[32] = {0};\n static uint64_t rng_counter = 0;\n \n+void RandAddSeedSleep()\n+{\n+    int64_t nPerfCounter1 = GetPerformanceCounter();\n+    std::this_thread::sleep_for(std::chrono::milliseconds(1));\n+    int64_t nPerfCounter2 = GetPerformanceCounter();\n+\n+    unsigned char buf[64];\n+    CSHA512 hasher;\n+    // Combine with and update state\n+    {\n+        std::unique_lock<std::mutex> lock(cs_rng_state);\n+        hasher.Write(rng_state, sizeof(rng_state));\n+        hasher.Write((const unsigned char*)&rng_counter, sizeof(rng_counter));\n+        ++rng_counter;\n+        hasher.Write((const unsigned char*)&nPerfCounter1, sizeof(nPerfCounter1));\n+        hasher.Write((const unsigned char*)&nPerfCounter2, sizeof(nPerfCounter2));\n+        hasher.Finalize(buf);\n+        memcpy(rng_state, buf + 32, 32);\n+    }\n+    memory_cleanse((void*)&nPerfCounter1, sizeof(nPerfCounter1));\n+    memory_cleanse((void*)&nPerfCounter2, sizeof(nPerfCounter2));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10372#discussion_r115778800",
      "id" : 115778800,
      "original_commit_id" : "addee9fe03d4529b3e13c829861f98374f6f0d92",
      "original_position" : 24,
      "path" : "src/random.cpp",
      "position" : null,
      "pull_request_review_id" : 37347367,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10372",
      "updated_at" : "2017-05-10T18:10:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115778800",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10372#discussion_r115778934"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10372"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115778934"
         }
      },
      "body" : "Maybe move declaration up nearer to `RandAddSeed()`",
      "commit_id" : "1dd6c6151381a39d4f734e05a38f71021c9c719c",
      "created_at" : "2017-05-10T15:50:00Z",
      "diff_hunk" : "@@ -24,6 +24,13 @@ int GetRandInt(int nMax);\n uint256 GetRandHash();\n \n /**\n+ * Add a little bit of randomness to the output of GetStrongRangBytes.\n+ * This sleeps for a millisecond, so should only be called when there is\n+ * no other work to be done.\n+ */\n+void RandAddSeedSleep();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10372#discussion_r115778934",
      "id" : 115778934,
      "original_commit_id" : "addee9fe03d4529b3e13c829861f98374f6f0d92",
      "original_position" : 8,
      "path" : "src/random.h",
      "position" : 8,
      "pull_request_review_id" : 37347367,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10372",
      "updated_at" : "2017-05-10T18:10:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115778934",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10372#discussion_r115812809"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10372"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115812809"
         }
      },
      "body" : "Removed, I had just copied code from above.",
      "commit_id" : "1dd6c6151381a39d4f734e05a38f71021c9c719c",
      "created_at" : "2017-05-10T18:10:35Z",
      "diff_hunk" : "@@ -207,6 +207,30 @@ static std::mutex cs_rng_state;\n static unsigned char rng_state[32] = {0};\n static uint64_t rng_counter = 0;\n \n+void RandAddSeedSleep()\n+{\n+    int64_t nPerfCounter1 = GetPerformanceCounter();\n+    std::this_thread::sleep_for(std::chrono::milliseconds(1));\n+    int64_t nPerfCounter2 = GetPerformanceCounter();\n+\n+    unsigned char buf[64];\n+    CSHA512 hasher;\n+    // Combine with and update state\n+    {\n+        std::unique_lock<std::mutex> lock(cs_rng_state);\n+        hasher.Write(rng_state, sizeof(rng_state));\n+        hasher.Write((const unsigned char*)&rng_counter, sizeof(rng_counter));\n+        ++rng_counter;\n+        hasher.Write((const unsigned char*)&nPerfCounter1, sizeof(nPerfCounter1));\n+        hasher.Write((const unsigned char*)&nPerfCounter2, sizeof(nPerfCounter2));\n+        hasher.Finalize(buf);\n+        memcpy(rng_state, buf + 32, 32);\n+    }\n+    memory_cleanse((void*)&nPerfCounter1, sizeof(nPerfCounter1));\n+    memory_cleanse((void*)&nPerfCounter2, sizeof(nPerfCounter2));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10372#discussion_r115812809",
      "id" : 115812809,
      "original_commit_id" : "addee9fe03d4529b3e13c829861f98374f6f0d92",
      "original_position" : 24,
      "path" : "src/random.cpp",
      "position" : null,
      "pull_request_review_id" : 37384862,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10372",
      "updated_at" : "2017-05-10T18:10:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115812809",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10372#discussion_r115813035"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10372"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115813035"
         }
      },
      "body" : "I deliberately left it down by the GetStrongRandBytes instead of up by the RAND_add stuff. I'll let @sipa handle moving things around when he removes OpenSSL's rng.",
      "commit_id" : "1dd6c6151381a39d4f734e05a38f71021c9c719c",
      "created_at" : "2017-05-10T18:11:41Z",
      "diff_hunk" : "@@ -24,6 +24,13 @@ int GetRandInt(int nMax);\n uint256 GetRandHash();\n \n /**\n+ * Add a little bit of randomness to the output of GetStrongRangBytes.\n+ * This sleeps for a millisecond, so should only be called when there is\n+ * no other work to be done.\n+ */\n+void RandAddSeedSleep();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10372#discussion_r115813035",
      "id" : 115813035,
      "original_commit_id" : "addee9fe03d4529b3e13c829861f98374f6f0d92",
      "original_position" : 8,
      "path" : "src/random.h",
      "position" : 8,
      "pull_request_review_id" : 37385124,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10372",
      "updated_at" : "2017-05-10T18:11:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115813035",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   }
]
