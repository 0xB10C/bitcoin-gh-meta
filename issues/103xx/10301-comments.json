[
   {
      "body" : "utACK (can someone on MacOSX 10.12+ test this please?)",
      "created_at" : "2017-05-01T07:11:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10301#issuecomment-298297226",
      "id" : 298297226,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10301",
      "updated_at" : "2017-05-01T10:36:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298297226",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I tested this on MacOSX 10.12.4 myself, should we have a runtime /dev/random fallback for getentropy like we do for the linux SYS_getrandom?",
      "created_at" : "2017-05-01T14:09:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10301#issuecomment-298339546",
      "id" : 298339546,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10301",
      "updated_at" : "2017-05-01T14:09:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298339546",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3298484?v=3",
         "events_url" : "https://api.github.com/users/jameshilliard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jameshilliard/followers",
         "following_url" : "https://api.github.com/users/jameshilliard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jameshilliard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jameshilliard",
         "id" : 3298484,
         "login" : "jameshilliard",
         "organizations_url" : "https://api.github.com/users/jameshilliard/orgs",
         "received_events_url" : "https://api.github.com/users/jameshilliard/received_events",
         "repos_url" : "https://api.github.com/users/jameshilliard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jameshilliard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jameshilliard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jameshilliard"
      }
   },
   {
      "body" : "> I tested this on MacOSX 10.12.4 myself, should we have a runtime /dev/random fallback for getentropy like we do for the linux SYS_getrandom?\r\n\r\nAs I understand it, MacOSX guarantees that anything compiled with the MacOSX 10.12 SDK, which is necessary to get autotools to detect this in the first place doesn't work on earlier versions of the OS. In which case this would be unnecessary.\r\n\r\nFeel free to correct me though @jonasschnelli @theuni.",
      "created_at" : "2017-05-01T14:26:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10301#issuecomment-298342471",
      "id" : 298342471,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10301",
      "updated_at" : "2017-05-01T14:26:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298342471",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj macOS uses weak imports for new symbols. They're fine to use as long as they're checked at runtime. This is how we're able to build with 10.11 (soon 10.12), but remain back-compat to 10.8. See an example of runtime handling at ```MacNotificationHandler::hasUserNotificationCenterSupport```.\r\n\r\ngetentropy does not exist in the 10.11 sdk. So I'm assuming that it is a weak import introduced in 10.12. Meaning that this would (I believe) blow up at runtime on <= 10.11 when built with 10.12.",
      "created_at" : "2017-05-01T18:29:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10301#issuecomment-298395527",
      "id" : 298395527,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10301",
      "updated_at" : "2017-05-01T18:29:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298395527",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "@theuni I'm unsure whether your comment above means that this PR is fine or the opposite.",
      "created_at" : "2017-05-01T22:55:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10301#issuecomment-298454264",
      "id" : 298454264,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10301",
      "updated_at" : "2017-05-01T22:55:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298454264",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa Sorry for being unclear. Cautiously, the opposite. I believe that this PR would cause runtime crashes when building with SDK >= 10.12, and running on < 10.12. We definitely need someone to test that scenario before merge, as 10.12 will likely be the SDK we use for 0.15.",
      "created_at" : "2017-05-02T00:00:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10301#issuecomment-298463853",
      "id" : 298463853,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10301",
      "updated_at" : "2017-05-02T00:00:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298463853",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "@theuni so this means we need to do a runtime check and fallback like we do for SYS_getrandom?\r\n\r\nSomething like this maybe?\r\n```c++\r\nif (getentropy != NULL) {\r\n    if (getentropy(ent32, NUM_OS_RANDOM_BYTES) != 0) {\r\n        RandFailure();\r\n    }\r\n} else {\r\n    GetDevURandom(ent32);\r\n}\r\n```",
      "created_at" : "2017-05-02T00:02:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10301#issuecomment-298464124",
      "id" : 298464124,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10301",
      "updated_at" : "2017-05-02T00:16:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298464124",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3298484?v=3",
         "events_url" : "https://api.github.com/users/jameshilliard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jameshilliard/followers",
         "following_url" : "https://api.github.com/users/jameshilliard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jameshilliard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jameshilliard",
         "id" : 3298484,
         "login" : "jameshilliard",
         "organizations_url" : "https://api.github.com/users/jameshilliard/orgs",
         "received_events_url" : "https://api.github.com/users/jameshilliard/received_events",
         "repos_url" : "https://api.github.com/users/jameshilliard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jameshilliard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jameshilliard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jameshilliard"
      }
   },
   {
      "body" : "@jameshilliard Yes. According to the [apple docs](https://developer.apple.com/library/content/documentation/MacOSX/Conceptual/BPFrameworks/Concepts/WeakLinking.html#//apple_ref/doc/uid/20002378-106633-CJBGFCAC) it would look something like:\r\n```c++\r\n#if defined(HAVE_GETENTROPY_RAND)\r\n#if defined(MAC_OSX)\r\nif (getentropy != NULL) {\r\n    getentropy(foo, bar);\r\n} else {\r\n// fallback\r\n}\r\n#else\r\ngetentropy(foo, bar);\r\n#endif\r\n#endif\r\n```",
      "created_at" : "2017-05-02T00:21:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10301#issuecomment-298466675",
      "id" : 298466675,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10301",
      "updated_at" : "2017-05-02T00:21:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298466675",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   }
]
