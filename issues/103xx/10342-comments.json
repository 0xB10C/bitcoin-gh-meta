[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10342#discussion_r115041391"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10342"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115041391"
         }
      },
      "body" : "Does the `wait_until` accomplish anything here, or at line 80 below?  Either the mempool will be empty when this RPC is first invoked, in which case the wait_until will immediately return, or else it will have something -- in which case waiting and then failing later doesn't seem useful?",
      "commit_id" : "86a5f0dcf90f8a9847952b10e7523591af7768e0",
      "created_at" : "2017-05-05T16:51:26Z",
      "diff_hunk" : "@@ -72,20 +66,24 @@ def run_test(self):\n         self.nodes = []\n         self.nodes.append(start_node(0, self.options.tmpdir))\n         self.nodes.append(start_node(1, self.options.tmpdir))\n-        assert_equal(len(self.nodes[0].getrawmempool()), 5)\n-        assert_equal(len(self.nodes[1].getrawmempool()), 0)\n+        # Give bitcoind a second to reload the mempool\n+        time.sleep(1)\n+        assert wait_until(lambda: len(self.nodes[0].getrawmempool()) == 5)\n+        assert wait_until(lambda: len(self.nodes[1].getrawmempool()) == 0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10342#discussion_r115041391",
      "id" : 115041391,
      "original_commit_id" : "86a5f0dcf90f8a9847952b10e7523591af7768e0",
      "original_position" : 40,
      "path" : "test/functional/mempool_persist.py",
      "position" : 40,
      "pull_request_review_id" : 36556970,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10342",
      "updated_at" : "2017-05-05T16:51:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115041391",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10342#discussion_r115044882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10342"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115044882"
         }
      },
      "body" : "No - this could just as well be a straight assert that node1's mempool is empty. The `time.sleep(1)` above is what actually guarantees that we're not just hitting a window before node1's mempool fills up.\r\n\r\nI changed this to a `wait_until()` call for consistency with the line above, but could quite easily change it back if you think that would be clearer for the reader.",
      "commit_id" : "86a5f0dcf90f8a9847952b10e7523591af7768e0",
      "created_at" : "2017-05-05T17:09:18Z",
      "diff_hunk" : "@@ -72,20 +66,24 @@ def run_test(self):\n         self.nodes = []\n         self.nodes.append(start_node(0, self.options.tmpdir))\n         self.nodes.append(start_node(1, self.options.tmpdir))\n-        assert_equal(len(self.nodes[0].getrawmempool()), 5)\n-        assert_equal(len(self.nodes[1].getrawmempool()), 0)\n+        # Give bitcoind a second to reload the mempool\n+        time.sleep(1)\n+        assert wait_until(lambda: len(self.nodes[0].getrawmempool()) == 5)\n+        assert wait_until(lambda: len(self.nodes[1].getrawmempool()) == 0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10342#discussion_r115044882",
      "id" : 115044882,
      "original_commit_id" : "86a5f0dcf90f8a9847952b10e7523591af7768e0",
      "original_position" : 40,
      "path" : "test/functional/mempool_persist.py",
      "position" : 40,
      "pull_request_review_id" : 36560786,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10342",
      "updated_at" : "2017-05-05T17:09:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115044882",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
