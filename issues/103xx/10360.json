{
   "assignee" : null,
   "assignees" : [],
   "body" : "Previous fee-targeting behavior lead to needless looping, excessive fees, and surprising behavior. \r\n\r\nThis PR changes the \"fee targeting\" algorithm by considering \"effective value\" of considered inputs instead of simply trying to hit an absolute fee, seeing if it failed, then trying again with the estimated total fee at the end of the loop.\r\n\r\nIn short:\r\n`effectiveValue = nValue - feeRate*num_bytes_for_signed_input`\r\n\r\nSee https://github.com/bitcoin/bitcoin/issues/10247 , https://github.com/bitcoin/bitcoin/issues/7664 \r\n\r\nTo do:\r\n1) Do we want `SelectCoins` to simply ignore negative effectual value? I'd say \"yes obviously\" but I was attempting to change the coin selection algorithm strategy itself as little as possible(exact match, lowerValue, coinLowestLarger, etc). If obvious to everyone else, an easy change.\r\n2) Right now I'm just duping the last output to pretend we have a change output, but clearly this should be the actual change. This is intertwined with https://github.com/bitcoin/bitcoin/pull/10333 which simply assumes there is a change output, then adjusts the actual fee at the end depending on what is actually required. A move-only commit should be enough to do so, but waiting to get feedback on the pair of PRs before bothering.\r\n3) Previously the wallet just kept stuffing fees until it succeeded. In this PR there is no strict sanity checks on the loop, so if there is some error where we are just shy and cannot re-balance change output to pay for it, it will look forever(I have no idea if this is possible since we should be over-estimating at worst). We should probably have something like https://github.com/bitcoin/bitcoin/pull/10333 for re-balancing, and then a sanity check to error out if a specified feerate cannot be hit for some reason post-coin selection, perhaps after a fixed number of tries. ",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10360/comments",
   "created_at" : "2017-05-08T17:37:44Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10360/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/10360",
   "id" : 227119139,
   "labels" : [
      {
         "color" : "02d7e1",
         "default" : false,
         "id" : 149424,
         "name" : "Wallet",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10360/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 10360,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/10360.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10360",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/10360.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10360"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "[WIP] [Wallet] Target effective value during transaction creation",
   "updated_at" : "2017-05-08T19:10:02Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10360",
   "user" : {
      "avatar_url" : "https://avatars3.githubusercontent.com/u/5767891?v=3",
      "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
      "followers_url" : "https://api.github.com/users/instagibbs/followers",
      "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/instagibbs",
      "id" : 5767891,
      "login" : "instagibbs",
      "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
      "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
      "repos_url" : "https://api.github.com/users/instagibbs/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/instagibbs"
   }
}
