[
   {
      "body" : "Rebased, overhauled and removed WIP tag.\r\nConforms now to BIP159.\r\nAdded 0.16 milestone tag.",
      "created_at" : "2017-08-08T20:53:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-321078772",
      "id" : 321078772,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
      "updated_at" : "2017-08-08T20:53:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/321078772",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Added a fingerprinting counter-measure which protects from leaking the prune depth by finding it through getdata requests (21c347c8c1a9ee4803b8f8f124185c218e01db76).",
      "created_at" : "2017-08-11T19:34:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-321900407",
      "id" : 321900407,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
      "updated_at" : "2017-08-11T19:34:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/321900407",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r140946427"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140946427"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: sending",
      "commit_id" : "abd60f63ac533c6b984cadbec56155b940f7fb9e",
      "created_at" : "2017-09-26T02:46:55Z",
      "diff_hunk" : "@@ -1006,6 +1020,13 @@ void static ProcessGetData(CNode* pfrom, const Consensus::Params& consensusParam\n                     pfrom->fDisconnect = true;\n                     send = false;\n                 }\n+                // Avoid leaking prune-height by never send blocks below the NODE_NETWORK_LIMITED threshold",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r140946427",
      "id" : 140946427,
      "original_commit_id" : "3fedeac1dbb845e5529dbe6ba7e0929abcf299c6",
      "original_position" : 25,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 65089115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-01T04:20:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140946427",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r140946594"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140946594"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/to must be available/required",
      "commit_id" : "abd60f63ac533c6b984cadbec56155b940f7fb9e",
      "created_at" : "2017-09-26T02:48:51Z",
      "diff_hunk" : "@@ -203,6 +203,8 @@ extern bool fPruneMode;\n extern uint64_t nPruneTarget;\n /** Block files containing a block-height within MIN_BLOCKS_TO_KEEP of chainActive.Tip() will not be pruned. */\n static const unsigned int MIN_BLOCKS_TO_KEEP = 288;\n+/** Minimum blocks to must be available to signal NODE_NETWORK_LIMITED */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r140946594",
      "id" : 140946594,
      "original_commit_id" : "3fedeac1dbb845e5529dbe6ba7e0929abcf299c6",
      "original_position" : 4,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 65089320,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-01T04:20:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140946594",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fixed travis trailing whitespace in test issue.",
      "created_at" : "2017-09-28T04:10:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-332722581",
      "id" : 332722581,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
      "updated_at" : "2017-09-28T04:10:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/332722581",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141752640"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141752640"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Looks like a rebase error - these functions were moved to the PeerLogicValidation.",
      "commit_id" : "abd60f63ac533c6b984cadbec56155b940f7fb9e",
      "created_at" : "2017-09-28T22:35:51Z",
      "diff_hunk" : "@@ -61,4 +61,17 @@ bool GetNodeStateStats(NodeId nodeid, CNodeStateStats &stats);\n /** Increase a node's misbehavior score. */\n void Misbehaving(NodeId nodeid, int howmuch);\n \n+/** Process protocol messages received from a given node */\n+bool ProcessMessages(CNode* pfrom, CConnman& connman, const std::atomic<bool>& interrupt);\n+/**\n+ * Send queued protocol messages to be sent to a give node.\n+ *\n+ * @param[in]   pto             The node which we are sending messages to.\n+ * @param[in]   connman         The connection manager for that node.\n+ * @param[in]   interrupt       Interrupt condition for processing threads\n+ * @return                      True if there is more work to be done\n+ */\n+bool SendMessages(CNode* pto, CConnman& connman, const std::atomic<bool>& interrupt);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141752640",
      "id" : 141752640,
      "original_commit_id" : "837ef7497f2e0e0d3530d0de9bdbd59a9acc8946",
      "original_position" : 14,
      "path" : "src/net_processing.h",
      "position" : null,
      "pull_request_review_id" : 66018463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-01T04:20:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141752640",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141753062"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141753062"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm, this feels pretty strange to me. Service bits indicate a commitment to provide certain services, not your current state. More importantly, IBD is always neccessarily fuzzy - we can't know how \"in sync\" we are.",
      "commit_id" : "abd60f63ac533c6b984cadbec56155b940f7fb9e",
      "created_at" : "2017-09-28T22:38:53Z",
      "diff_hunk" : "@@ -3305,6 +3314,43 @@ bool PeerLogicValidation::SendMessages(CNode* pto, std::atomic<bool>& interruptM\n     return true;\n }\n \n+void CheckLocalServices(ServiceFlags& nLocalServices) {\n+    if (fPruneMode) {\n+        LOCK(cs_main);\n+\n+        // make sure NODE_NETWORK is disabled\n+        nLocalServices = ServiceFlags(nLocalServices & ~NODE_NETWORK);\n+\n+        // don't signal NODE_NETWORK_LIMITED during initial block download\n+        if (IsInitialBlockDownload()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141753062",
      "id" : 141753062,
      "original_commit_id" : "837ef7497f2e0e0d3530d0de9bdbd59a9acc8946",
      "original_position" : 28,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 66018463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-01T04:20:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141753062",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141753516"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141753516"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why? The BIP seems somewhat unclear here, but I'd stronlgy prefer that NODE_NETWORK_LIMITED simply be always set to indicate that we can always provide the most recent 288 blocks, irrespective of if we're pruned or not.",
      "commit_id" : "abd60f63ac533c6b984cadbec56155b940f7fb9e",
      "created_at" : "2017-09-28T22:42:05Z",
      "diff_hunk" : "@@ -3305,6 +3314,43 @@ bool PeerLogicValidation::SendMessages(CNode* pto, std::atomic<bool>& interruptM\n     return true;\n }\n \n+void CheckLocalServices(ServiceFlags& nLocalServices) {\n+    if (fPruneMode) {\n+        LOCK(cs_main);\n+\n+        // make sure NODE_NETWORK is disabled\n+        nLocalServices = ServiceFlags(nLocalServices & ~NODE_NETWORK);\n+\n+        // don't signal NODE_NETWORK_LIMITED during initial block download\n+        if (IsInitialBlockDownload()) {\n+            return;\n+        }\n+\n+        // check how many blocks we have available (backwards from tip)\n+        // don't go futher down then chainActive.Height()-NODE_NETWORK_LIMITED\n+        CBlockIndex *block = chainActive.Tip();\n+        unsigned int chainHeight = (unsigned int) chainActive.Height();\n+        while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && chainHeight - block->nHeight < (NODE_NETWORK_LIMITED_MIN_BLOCKS + 1)) {\n+            block = block->pprev;\n+        }\n+        unsigned int height = (unsigned int) block->nHeight;\n+\n+        // set NODE_NETWORK_LIMITED flag based on the available blocks\n+        if (chainHeight - height >= NODE_NETWORK_LIMITED_MIN_BLOCKS) {\n+            nLocalServices = ServiceFlags(nLocalServices | NODE_NETWORK_LIMITED);\n+        }\n+\n+        // don't set NODE_NETWORK if manual pruning is enabled and no blocks have been pruned.\n+        // A manual prune will be very likely\n+    }\n+    else {\n+        // currently, the prune mode can't be changed during runtime\n+        // implement the service bit switch for possible future flexibility\n+        nLocalServices = ServiceFlags(nLocalServices | NODE_NETWORK);\n+        nLocalServices = ServiceFlags(nLocalServices & ~NODE_NETWORK_LIMITED);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141753516",
      "id" : 141753516,
      "original_commit_id" : "837ef7497f2e0e0d3530d0de9bdbd59a9acc8946",
      "original_position" : 53,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 66018463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-01T04:20:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141753516",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141754105"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141754105"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This seems entirely redundant - even if by super rare chance we end up due to reorg short of 288 blocks, we won't be *very* short of 288 blocks, and will be caught back up within the next block or two, might as well just always set NODE_NETWORK_LIMITED (you can static_assert MIN_BLOCKS_TO_KEEP is at least 288 if you really want to have a check).",
      "commit_id" : "abd60f63ac533c6b984cadbec56155b940f7fb9e",
      "created_at" : "2017-09-28T22:45:31Z",
      "diff_hunk" : "@@ -3305,6 +3314,43 @@ bool PeerLogicValidation::SendMessages(CNode* pto, std::atomic<bool>& interruptM\n     return true;\n }\n \n+void CheckLocalServices(ServiceFlags& nLocalServices) {\n+    if (fPruneMode) {\n+        LOCK(cs_main);\n+\n+        // make sure NODE_NETWORK is disabled\n+        nLocalServices = ServiceFlags(nLocalServices & ~NODE_NETWORK);\n+\n+        // don't signal NODE_NETWORK_LIMITED during initial block download\n+        if (IsInitialBlockDownload()) {\n+            return;\n+        }\n+\n+        // check how many blocks we have available (backwards from tip)\n+        // don't go futher down then chainActive.Height()-NODE_NETWORK_LIMITED",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141754105",
      "id" : 141754105,
      "original_commit_id" : "837ef7497f2e0e0d3530d0de9bdbd59a9acc8946",
      "original_position" : 33,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 66018463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-01T04:20:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141754105",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141755077"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755077"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If you're gonna update this maybe overhaul the text? The concept of \"want network services but don't provide them\" doesn't really make sense anymore (especially with NODE_NETWORK_LIMITED). Maybe just say \"indicates peer is capable of serving the full historical block chain\".",
      "commit_id" : "abd60f63ac533c6b984cadbec56155b940f7fb9e",
      "created_at" : "2017-09-28T22:52:04Z",
      "diff_hunk" : "@@ -250,8 +250,8 @@ enum ServiceFlags : uint64_t {\n     // Nothing\n     NODE_NONE = 0,\n     // NODE_NETWORK means that the node is capable of serving the block chain. It is currently\n-    // set by all Bitcoin Core nodes, and is unset by SPV clients or other peers that just want\n-    // network services but don't provide them.\n+    // set by all Bitcoin Core non pruned nodes, and is unset by SPV clients or other peers\n+    // that just want network services but don't provide them.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141755077",
      "id" : 141755077,
      "original_commit_id" : "e08e49f8991564d2e9115a074b7d38af3af11664",
      "original_position" : 7,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 66018463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-01T04:20:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755077",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141755735"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755735"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm entirely unconvinced NODE_NETWORK_LIMITED needs this (and would prefer to avoid adding it until we need it, though its no big deal to add it).",
      "commit_id" : "abd60f63ac533c6b984cadbec56155b940f7fb9e",
      "created_at" : "2017-09-28T22:55:49Z",
      "diff_hunk" : "@@ -2672,6 +2672,11 @@ ServiceFlags CConnman::GetLocalServices() const\n     return nLocalServices;\n }\n \n+void CConnman::SetLocalServices(ServiceFlags flagsIn)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141755735",
      "id" : 141755735,
      "original_commit_id" : "62cdcc6ec2facdcd50fea9a20a268d94bb981d19",
      "original_position" : 4,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 66018463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-01T04:20:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755735",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141755926"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755926"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why do we need to do this? You can't prune deeper than 128 and NODE_NETWORK is already unset for manually-pruned nodes.",
      "commit_id" : "abd60f63ac533c6b984cadbec56155b940f7fb9e",
      "created_at" : "2017-09-28T22:56:51Z",
      "diff_hunk" : "@@ -895,6 +897,13 @@ UniValue pruneblockchain(const JSONRPCRequest& request)\n     }\n \n     PruneBlockFilesManual(height);\n+\n+    // check if we need to change the local service flags in order to signal NODE_NETWORK_LIMITED flags\n+    if(g_connman) {\n+        ServiceFlags nFlags = g_connman->GetLocalServices();\n+        CheckLocalServices(nFlags);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141755926",
      "id" : 141755926,
      "original_commit_id" : "6aae1785542eb7f79d5c08e53862476e22ac46c6",
      "original_position" : 17,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 66018463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-01T04:20:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755926",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141756696"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141756696"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This should use pfrom->GetLocalServices() not connman->GetLocalServices() - our decisions should be based on what we told the peer we support, not what we would tell a new peer to support.",
      "commit_id" : "abd60f63ac533c6b984cadbec56155b940f7fb9e",
      "created_at" : "2017-09-28T23:01:50Z",
      "diff_hunk" : "@@ -1020,6 +1020,13 @@ void static ProcessGetData(CNode* pfrom, const Consensus::Params& consensusParam\n                     pfrom->fDisconnect = true;\n                     send = false;\n                 }\n+                // Avoid leaking prune-height by never send blocks below the NODE_NETWORK_LIMITED threshold\n+                if (send && !pfrom->fWhitelisted && (\n+                        (((connman->GetLocalServices() & NODE_NETWORK_LIMITED) == NODE_NETWORK_LIMITED) && (chainActive.Tip()->nHeight - mi->second->nHeight > (int)NODE_NETWORK_LIMITED_MIN_BLOCKS) )",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141756696",
      "id" : 141756696,
      "original_commit_id" : "39926136e6fb8d38e3da8b9aee697cd5c4c4a04c",
      "original_position" : 6,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 66018463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-01T04:20:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141756696",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review @TheBlueMatt. I agree with all you points and most things can now go away since the NODE_NETWORK_LIMITED_HIGH flag (1152 blocks minimum) is gone.\r\n\r\nWill overhaul and simplify it now.",
      "created_at" : "2017-09-29T02:56:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-333018185",
      "id" : 333018185,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
      "updated_at" : "2017-09-29T02:56:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333018185",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Simplified the PR and addressed @TheBlueMatt and @fanquake points.",
      "created_at" : "2017-10-01T04:22:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-333352493",
      "id" : 333352493,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
      "updated_at" : "2017-10-01T04:22:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333352493",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142410638"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142410638"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm, I thought we were just going to alays set this? Why bother *only* setting it when pruned - a node that is not pruned is also capable of serving the last 288 blocks, which is the way I read the definition of NODE_NETWORK_LIMITED.",
      "commit_id" : "abd60f63ac533c6b984cadbec56155b940f7fb9e",
      "created_at" : "2017-10-03T14:02:04Z",
      "diff_hunk" : "@@ -1590,6 +1590,8 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n     if (fPruneMode) {\n         LogPrintf(\"Unsetting NODE_NETWORK on prune mode\\n\");\n         nLocalServices = ServiceFlags(nLocalServices & ~NODE_NETWORK);\n+        // always set NODE_NETWORK_LIMITED (BIP159) in pruned mode\n+        nLocalServices = ServiceFlags(nLocalServices | NODE_NETWORK_LIMITED);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142410638",
      "id" : 142410638,
      "original_commit_id" : "78011f7e2a703afc17a7c53923d89729ce3be91a",
      "original_position" : 5,
      "path" : "src/init.cpp",
      "position" : 21,
      "pull_request_review_id" : 66766749,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-03T14:02:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142410638",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   }
]
