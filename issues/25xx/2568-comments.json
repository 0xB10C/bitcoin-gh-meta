[
   {
      "body" : "We should probably be clamping max connections at FD_SETSIZE-MIN_CORE_FILEDESCRIPTORS otherwise you get fun stuff like select becoming crashy.",
      "created_at" : "2013-04-25T23:12:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2568#issuecomment-17046528",
      "id" : 17046528,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2568",
      "updated_at" : "2013-04-25T23:12:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/17046528",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "ACK\r\n",
      "created_at" : "2013-04-25T23:16:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2568#issuecomment-17046681",
      "id" : 17046681,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2568",
      "updated_at" : "2013-04-25T23:16:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/17046681",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "ACK",
      "created_at" : "2013-04-26T12:06:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2568#issuecomment-17071033",
      "id" : 17071033,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2568",
      "updated_at" : "2013-04-26T12:06:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/17071033",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "@gavinandresen Have you tested whether this compiles on OSX?",
      "created_at" : "2013-04-26T12:21:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2568#issuecomment-17071510",
      "id" : 17071510,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2568",
      "updated_at" : "2013-04-26T12:21:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/17071510",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa : yes, compiles fine, unit tests run, bitcoind -testnet runs on OSX",
      "created_at" : "2013-04-26T15:56:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2568#issuecomment-17083117",
      "id" : 17083117,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2568",
      "updated_at" : "2013-04-26T15:56:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/17083117",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "@gavinandresen  can you try running \r\n\r\n(for i in {1..220000} ; do export bh=`./bitcoind getblockhash $i` ; for tx in `./bitcoind getblock $bh | grep '     \"' | cut -d'\"' -f2` ; do  ./bitcoind getrawtransaction $tx > /dev/null  ; done   ; done)\r\n\r\nOn a OSX mainnet node with this patch and txindex=1 when you get a chance?  It should causes about 500 FDs to be used.\r\n",
      "created_at" : "2013-04-26T16:03:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2568#issuecomment-17083541",
      "id" : 17083541,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2568",
      "updated_at" : "2013-04-26T16:03:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/17083541",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Refactored the code into a RaiseFileDescriptorLimit in util, and added a windows implementation.\r\nAlso added Gregory's suggestion to clamp maxconnections, according to the size of FD_SETSIZE.\r\n\r\nMinimal test plan:\r\n* Start the client with increasingly higher -maxconnections=X values\r\n* Look for the line \"Using at most Y connections (Z file descriptors available)\" in debug.log\r\n* Without specific hard ulimits, requests for up to ~1000 connections should be granted (X=Y), and Z should always be at least 150 higher than Y. \r\n\r\nI'd like to see at least some proof that this works on Windows on OSX. For Windows, #2569 is needed to get more than 63 connections.\r\n",
      "created_at" : "2013-04-27T23:48:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2568#issuecomment-17125478",
      "id" : 17125478,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2568",
      "updated_at" : "2013-04-27T23:50:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/17125478",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2568#discussion_r3992373"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2568"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/3992373"
         }
      },
      "body" : "Is this correct? MSDN says: \"Up to 2,048 files can be open simultaneously at the lowio level (that is, opened and accessed by means of the _open, _read, _write, and so forth family of I/O functions). Up to 512 files can be open simultaneously at the stdio level (that is, opened and accessed by means of the fopen, fgetc, fputc, and so forth family of functions). The limit of 512 open files at the stdio level can be increased to a maximum of 2,048 by means of the _setmaxstdio function.\"\r\n\r\nIs the 2048 limit on a lowio level or stdio level? If the later we need to call _setmaxstdio(2048) here?\r\nhttp://msdn.microsoft.com/en-us/library/6e3b887c.aspx",
      "commit_id" : "ba29a5590bc4479d74454f0b9fdaf007d9d80221",
      "created_at" : "2013-04-28T21:02:49Z",
      "diff_hunk" : "@@ -1167,6 +1168,28 @@ bool TruncateFile(FILE *file, unsigned int length) {\n #endif\n }\n \n+\n+// this function tries to raise the file descriptor limit to the requested number.\n+// It returns the actual file descriptor limit (which may be more or less than nMinFD)\n+int RaiseFileDescriptorLimit(int nMinFD) {\n+#if defined(WIN32)\n+    return 2048;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2568#discussion_r3992373",
      "id" : 3992373,
      "original_commit_id" : "6cc7faccc2e34781c52471fe7e74f870d370fc1d",
      "original_position" : 17,
      "path" : "src/util.cpp",
      "position" : 17,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2568",
      "updated_at" : "2013-04-28T23:46:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/3992373",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2568#discussion_r3992516"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2568"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/3992516"
         }
      },
      "body" : "It's a bit fuzzy, as things don't match exactly, but file descriptors correspond to the lowio level. However, the win32 leveldb implementation uses kernel calls directly, bypassing both stdio and lowio, so we don't actually need to count those. On the other hand, for block and undo files, we do use the stdio level...",
      "commit_id" : "ba29a5590bc4479d74454f0b9fdaf007d9d80221",
      "created_at" : "2013-04-28T21:37:49Z",
      "diff_hunk" : "@@ -1167,6 +1168,28 @@ bool TruncateFile(FILE *file, unsigned int length) {\n #endif\n }\n \n+\n+// this function tries to raise the file descriptor limit to the requested number.\n+// It returns the actual file descriptor limit (which may be more or less than nMinFD)\n+int RaiseFileDescriptorLimit(int nMinFD) {\n+#if defined(WIN32)\n+    return 2048;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2568#discussion_r3992516",
      "id" : 3992516,
      "original_commit_id" : "6cc7faccc2e34781c52471fe7e74f870d370fc1d",
      "original_position" : 17,
      "path" : "src/util.cpp",
      "position" : 17,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2568",
      "updated_at" : "2013-04-28T23:46:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/3992516",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/ba29a5590bc4479d74454f0b9fdaf007d9d80221 for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.",
      "created_at" : "2013-04-29T00:26:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2568#issuecomment-17145999",
      "id" : 17145999,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2568",
      "updated_at" : "2013-04-29T00:26:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/17145999",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "body" : "ACK.  @gmaxwell : successfully ran (a modified version of) your stress test on OSX with this patch and -txindex=1.\r\n",
      "created_at" : "2013-04-29T14:29:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2568#issuecomment-17169878",
      "id" : 17169878,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2568",
      "updated_at" : "2013-04-29T14:29:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/17169878",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "ACK.",
      "created_at" : "2013-04-29T19:54:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2568#issuecomment-17190035",
      "id" : 17190035,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2568",
      "updated_at" : "2013-04-29T19:54:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/17190035",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   }
]
