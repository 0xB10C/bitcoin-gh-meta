[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27920#discussion_r1235770904"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27920"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235770904"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 080ecd855bc4194396c58e71677a3e50c7b0abff \"wallet: do not allow loading descriptor with an invalid ID\"\r\n\r\nThe pattern we use for errors in `ReadKeyValue` is to assign the `strErr` rather than `return error(\"...\")`.\r\n\r\n```suggestion\r\n                strErr = \"The descriptor ID calculated by the wallet differs from the one in DB\");\r\n                return false\r\n```",
      "commit_id" : "0f294a7ef362611b70cfa87a6eb757825bca986e",
      "created_at" : "2023-06-20T20:04:17Z",
      "diff_hunk" : "@@ -664,6 +664,12 @@ ReadKeyValue(CWallet* pwallet, DataStream& ssKey, CDataStream& ssValue,\n                 wss.m_descriptor_caches[id] = DescriptorCache();\n             }\n             pwallet->LoadDescriptorScriptPubKeyMan(id, desc);\n+\n+            // Prior to doing anything with this spkm, verify ID calculation is always the same.\n+            if (id != pwallet->GetDescriptorScriptPubKeyMan(desc)->GetID()) {\n+                wss.descriptor_unknown = true;\n+                return error(\"The descriptor ID calculated by the wallet differs from the one in DB\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27920#discussion_r1235770904",
      "id" : 1235770904,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JqF4Y",
      "original_commit_id" : "080ecd855bc4194396c58e71677a3e50c7b0abff",
      "original_line" : 671,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 1488934451,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27920",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235770904/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-20T20:07:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235770904",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27920#discussion_r1235773231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27920"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235773231"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 494fa79a421c7384fdecacc7b42ae0dbe66668f2 \"wallet: bugfix, always use apostrophe for spkm descriptor ID\"\r\n\r\nThis name is misleading as it doesn't actually return an id, just the string we hash for it. I would actually prefer just adding a parameter to `ToString()` rather than a whole new function.",
      "commit_id" : "0f294a7ef362611b70cfa87a6eb757825bca986e",
      "created_at" : "2023-06-20T20:07:08Z",
      "diff_hunk" : "@@ -108,6 +108,9 @@ struct Descriptor {\n     /** Convert the descriptor back to a string, undoing parsing. */\n     virtual std::string ToString() const = 0;\n \n+    /* Constant descriptor ID. */\n+    virtual std::string GetID() const = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27920#discussion_r1235773231",
      "id" : 1235773231,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JqGcv",
      "original_commit_id" : "494fa79a421c7384fdecacc7b42ae0dbe66668f2",
      "original_line" : 112,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/script/descriptor.h",
      "position" : null,
      "pull_request_review_id" : 1488934451,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27920",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235773231/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-20T20:07:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235773231",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27920#discussion_r1235801022"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27920"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235801022"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, I did it on purpose, so the error is actually logged. The `descriptor_unknown` field overwrites `strErr` with another message.\r\n\r\nBut, what could do is actually change the `descriptor_unknown` logging so it appends the error at the end (it will also log the currently not logged  `std::ios_base::failure` error that is above).",
      "commit_id" : "0f294a7ef362611b70cfa87a6eb757825bca986e",
      "created_at" : "2023-06-20T20:36:20Z",
      "diff_hunk" : "@@ -664,6 +664,12 @@ ReadKeyValue(CWallet* pwallet, DataStream& ssKey, CDataStream& ssValue,\n                 wss.m_descriptor_caches[id] = DescriptorCache();\n             }\n             pwallet->LoadDescriptorScriptPubKeyMan(id, desc);\n+\n+            // Prior to doing anything with this spkm, verify ID calculation is always the same.\n+            if (id != pwallet->GetDescriptorScriptPubKeyMan(desc)->GetID()) {\n+                wss.descriptor_unknown = true;\n+                return error(\"The descriptor ID calculated by the wallet differs from the one in DB\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27920#discussion_r1235801022",
      "id" : 1235801022,
      "in_reply_to_id" : 1235770904,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JqNO-",
      "original_commit_id" : "080ecd855bc4194396c58e71677a3e50c7b0abff",
      "original_line" : 671,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 1488978044,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27920",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235801022/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-20T20:37:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235801022",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27920#discussion_r1235805345"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27920"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235805345"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not sure that `descriptor_unknown` needs to be set here. The descriptor isn't really unknown, just our computed id doesn't match the stored one. This is more on the level of a critical corruption error, in the same way that invalid keys are.\r\n\r\nError handling here should be a lot easier with #24914.",
      "commit_id" : "0f294a7ef362611b70cfa87a6eb757825bca986e",
      "created_at" : "2023-06-20T20:41:15Z",
      "diff_hunk" : "@@ -664,6 +664,12 @@ ReadKeyValue(CWallet* pwallet, DataStream& ssKey, CDataStream& ssValue,\n                 wss.m_descriptor_caches[id] = DescriptorCache();\n             }\n             pwallet->LoadDescriptorScriptPubKeyMan(id, desc);\n+\n+            // Prior to doing anything with this spkm, verify ID calculation is always the same.\n+            if (id != pwallet->GetDescriptorScriptPubKeyMan(desc)->GetID()) {\n+                wss.descriptor_unknown = true;\n+                return error(\"The descriptor ID calculated by the wallet differs from the one in DB\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27920#discussion_r1235805345",
      "id" : 1235805345,
      "in_reply_to_id" : 1235770904,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JqOSh",
      "original_commit_id" : "080ecd855bc4194396c58e71677a3e50c7b0abff",
      "original_line" : 671,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 1488984245,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27920",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235805345/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-20T20:41:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235805345",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27920#discussion_r1235816435"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27920"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235816435"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I'm not sure that descriptor_unknown needs to be set here. The descriptor isn't really unknown, just our computed id doesn't match the stored one. This is more on the level of a critical corruption error, in the same way that invalid keys are.\r\n\r\nYeah, but we don't have a way to set a corruption error right now. If the function only return false with the strErr, it will be tagged as a non-critical error. Thus why re-used the `descriptor_unknown` flag.\r\n\r\n> Error handling here should be a lot easier with https://github.com/bitcoin/bitcoin/pull/24914.\r\n\r\nyessss. Thus why I didn't care much on adding more code to it. While it works, should be fine.",
      "commit_id" : "0f294a7ef362611b70cfa87a6eb757825bca986e",
      "created_at" : "2023-06-20T20:53:18Z",
      "diff_hunk" : "@@ -664,6 +664,12 @@ ReadKeyValue(CWallet* pwallet, DataStream& ssKey, CDataStream& ssValue,\n                 wss.m_descriptor_caches[id] = DescriptorCache();\n             }\n             pwallet->LoadDescriptorScriptPubKeyMan(id, desc);\n+\n+            // Prior to doing anything with this spkm, verify ID calculation is always the same.\n+            if (id != pwallet->GetDescriptorScriptPubKeyMan(desc)->GetID()) {\n+                wss.descriptor_unknown = true;\n+                return error(\"The descriptor ID calculated by the wallet differs from the one in DB\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27920#discussion_r1235816435",
      "id" : 1235816435,
      "in_reply_to_id" : 1235770904,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JqQ_z",
      "original_commit_id" : "080ecd855bc4194396c58e71677a3e50c7b0abff",
      "original_line" : 671,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 1489000460,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27920",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235816435/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-20T20:53:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235816435",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27920#discussion_r1235823528"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27920"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235823528"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I did that first, but didn't like to add a `force_apostrophe` argument to it. The apostrophe existence is internal to the bip32 `PubKeyProvider` only and not really a concept that the `Descriptor` class should know about. \r\nEven other pub key providers shouldn't be aware of the apostrophe format neither.\r\n\r\nThe idea behind the `GeID()` method was to have a function that we treat differently and think twice before change anything inside it.\r\n\r\nSaid that, I'm not that strong over it neither. Could use the same `ID` concept for the `ToString` parameter too.",
      "commit_id" : "0f294a7ef362611b70cfa87a6eb757825bca986e",
      "created_at" : "2023-06-20T20:59:13Z",
      "diff_hunk" : "@@ -108,6 +108,9 @@ struct Descriptor {\n     /** Convert the descriptor back to a string, undoing parsing. */\n     virtual std::string ToString() const = 0;\n \n+    /* Constant descriptor ID. */\n+    virtual std::string GetID() const = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27920#discussion_r1235823528",
      "id" : 1235823528,
      "in_reply_to_id" : 1235773231,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JqSuo",
      "original_commit_id" : "494fa79a421c7384fdecacc7b42ae0dbe66668f2",
      "original_line" : 112,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/script/descriptor.h",
      "position" : null,
      "pull_request_review_id" : 1489010106,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27920",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235823528/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-20T20:59:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235823528",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27920#discussion_r1235824649"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27920"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235824649"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Yeah, but we don't have a way to set a corruption error right now. If the function only return false with the strErr, it will be tagged as a non-critical error. Thus why re-used the `descriptor_unknown` flag.\r\n\r\nCould add `DBKeys::WALLETDESCRIPTOR` to https://github.com/bitcoin/bitcoin/blob/d1ae96755a0f9d7e12c3f6741c030d8ea6d0416f/src/wallet/walletdb.cpp#L867",
      "commit_id" : "0f294a7ef362611b70cfa87a6eb757825bca986e",
      "created_at" : "2023-06-20T20:59:31Z",
      "diff_hunk" : "@@ -664,6 +664,12 @@ ReadKeyValue(CWallet* pwallet, DataStream& ssKey, CDataStream& ssValue,\n                 wss.m_descriptor_caches[id] = DescriptorCache();\n             }\n             pwallet->LoadDescriptorScriptPubKeyMan(id, desc);\n+\n+            // Prior to doing anything with this spkm, verify ID calculation is always the same.\n+            if (id != pwallet->GetDescriptorScriptPubKeyMan(desc)->GetID()) {\n+                wss.descriptor_unknown = true;\n+                return error(\"The descriptor ID calculated by the wallet differs from the one in DB\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27920#discussion_r1235824649",
      "id" : 1235824649,
      "in_reply_to_id" : 1235770904,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JqTAJ",
      "original_commit_id" : "080ecd855bc4194396c58e71677a3e50c7b0abff",
      "original_line" : 671,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 1489011388,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27920",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235824649/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-20T20:59:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235824649",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27920#discussion_r1238542196"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27920"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238542196"
         }
      },
      "author_association" : "MEMBER",
      "body" : "7455e836018d30574f290c92c1df631ffafc8105 nit: move comment above to below `} else if {`",
      "commit_id" : "0f294a7ef362611b70cfa87a6eb757825bca986e",
      "created_at" : "2023-06-22T13:36:30Z",
      "diff_hunk" : "@@ -861,10 +861,18 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n                     strErr += \"The wallet might have been tampered with or created with malicious intent.\";\n                     pwallet->WalletLogPrintf(\"%s\\n\", strErr);\n                     return DBErrors::UNEXPECTED_LEGACY_ENTRY;\n+                } else if (wss.descriptor_unknown) {\n+                    strErr = strprintf(\"Error: Unrecognized descriptor found in wallet %s. \", pwallet->GetName());\n+                    strErr += (last_client > CLIENT_VERSION) ? \"The wallet might had been created on a newer version. \"\n+                                                             :\n+                              \"The database might be corrupted or the software version is not compatible with one of your wallet descriptors. \";\n+                    strErr += \"Please try running the latest software version\";\n+                    pwallet->WalletLogPrintf(\"%s\\n\", strErr);\n+                    return DBErrors::UNKNOWN_DESCRIPTOR;\n                 }\n                 // losing keys is considered a catastrophic error, anything else\n                 // we assume the user can live with:\n-                if (IsKeyType(strType) || strType == DBKeys::DEFAULTKEY) {\n+                else if (IsKeyType(strType) || strType == DBKeys::DEFAULTKEY) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27920#discussion_r1238542196",
      "id" : 1238542196,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585J0qd0",
      "original_commit_id" : "7455e836018d30574f290c92c1df631ffafc8105",
      "original_line" : 875,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 1493213013,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27920",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238542196/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-22T13:46:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238542196",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
