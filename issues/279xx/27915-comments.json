[
   {
      "author_association" : "MEMBER",
      "body" : "Does it also happen the other way around?\r\n\r\nNothing in that PR should change the key material, so the cache of derived keys should be the same too. I'll investigate and add an explicit test for this case.\r\n\r\nOne place to look at would be the descriptor identifier, which is a hash of the string. We don't touch the descriptor itself during upgrade, let alone during downgrade, but perhaps we accidentally broke how the identifier is calculated.",
      "created_at" : "2023-06-20T07:13:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27915#issuecomment-1598236499",
      "id" : 1598236499,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27915",
      "node_id" : "IC_kwDOABII585fQydT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1598236499/reactions"
      },
      "updated_at" : "2023-06-20T07:18:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1598236499",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Does it also happen the other way around?\r\n\r\nNo, wallets created in 25.2 are loaded without problems in master for me.",
      "created_at" : "2023-06-20T14:31:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27915#issuecomment-1598909877",
      "id" : 1598909877,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27915",
      "node_id" : "IC_kwDOABII585fTW21",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1598909877/reactions"
      },
      "updated_at" : "2023-06-20T14:31:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1598909877",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sjors, the issue is indeed on the descriptor's ID. The calculation differs between master and 25.2.\r\n\r\nCan check it by applying this into the v25.2 branch and follow @mzumsande steps:\r\n```diff\r\ndiff --git a/src/wallet/walletdb.cpp b/src/wallet/walletdb.cpp\r\n--- a/src/wallet/walletdb.cpp\t(revision 8996da626d68784aaaccd96d3459c805b578f759)\r\n+++ b/src/wallet/walletdb.cpp\t(date 1687271655072)\r\n@@ -651,6 +651,9 @@\r\n                 wss.m_descriptor_caches[id] = DescriptorCache();\r\n             }\r\n             pwallet->LoadDescriptorScriptPubKeyMan(id, desc);\r\n+            const auto* spkm = pwallet->GetDescriptorScriptPubKeyMan(desc);\r\n+            assert(id == spkm->GetID());\r\n         } else if (strType == DBKeys::WALLETDESCRIPTORCACHE) {\r\n             bool parent = true;\r\n             uint256 desc_id;\r\n```\r\n\r\nIt happens because the spkm writes the descriptor record after topping up the wallet.\r\n\r\nThe `BIP32PubkeyProvider::ToString` in v25.2 uses apostrophe (because it has no notion of the `h`) while in master the string is formatted with the `h` .\r\n\r\nBecause we cannot change the past, to stay compatible, we need to always use the apostrophe version for the spkm ID.\r\nHappy to hear yours thoughts before moving forward with the fix PR.",
      "created_at" : "2023-06-20T14:56:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27915#issuecomment-1598958676",
      "id" : 1598958676,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27915",
      "node_id" : "IC_kwDOABII585fTixU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1598958676/reactions"
      },
      "updated_at" : "2023-06-20T14:56:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1598958676",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Can someone clarify what version(s) we are talking about here. 25.2 doesn't exist. There is currently \"master\", 25.x, 25.0, 24.x, 24.1. etc",
      "created_at" : "2023-06-20T15:47:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27915#issuecomment-1599055655",
      "id" : 1599055655,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27915",
      "node_id" : "IC_kwDOABII585fT6cn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1599055655/reactions"
      },
      "updated_at" : "2023-06-20T15:47:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1599055655",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Sorry, I meant v25.0rc2",
      "created_at" : "2023-06-20T15:48:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27915#issuecomment-1599056468",
      "id" : 1599056468,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27915",
      "node_id" : "IC_kwDOABII585fT6pU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1599056468/reactions"
      },
      "updated_at" : "2023-06-20T15:48:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1599056468",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@mzumsande give #27920 a try please. It fixes the issue for me.\r\nStill, while in a first glance looks ok, will think more about it.",
      "created_at" : "2023-06-20T15:53:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27915#issuecomment-1599067318",
      "id" : 1599067318,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27915",
      "node_id" : "IC_kwDOABII585fT9S2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1599067318/reactions"
      },
      "updated_at" : "2023-06-20T15:53:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1599067318",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Can't we derive the ID from the literal string as stored in the wallet database? \r\n\r\nCurrently `WalletDescriptor` is parsed when read from the database and then `ToString()` is called when storing it. It seems less brittle if we add `std::string m_raw_descriptor` and hold on to the original there. Presumably that means `ToString()` is only used once at generation time.\r\n\r\nThis would however break if you downgrade ~and then upgrade again. That in turn could be fixed by detecting the error condition, recalculating the hash (and wiping or modifying the cache records).~\r\n\r\n~In other words when loading a descriptor, if the hash is wrong, try replacing `'` with `h` and see if that works. If so, modify the record.~ (<- I don't think this works, but leaving the thought)\r\n\r\nThere's a similar downgrade - upgrade breakage introduced by #26728, although it's much harder to hit (you have to downgrade, encrypt and then upgrade). That PR introduces a new flag which is currently optional, but it's an option (though not ideal) to make it mandatory. Thereby preventing a downgrade.",
      "created_at" : "2023-06-20T17:15:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27915#issuecomment-1599198953",
      "id" : 1599198953,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27915",
      "node_id" : "IC_kwDOABII585fUdbp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1599198953/reactions"
      },
      "updated_at" : "2023-06-20T17:32:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1599198953",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@achow101 wrote in the PR:\r\n\r\n> Once we assign the id, we should just store it and remember what it is rather than regenerating it whenever we want it.\r\n\r\nThis seems better than my suggestion above to store the raw string.",
      "created_at" : "2023-06-20T17:34:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27915#issuecomment-1599229386",
      "id" : 1599229386,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27915",
      "node_id" : "IC_kwDOABII585fUk3K",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1599229386/reactions"
      },
      "updated_at" : "2023-06-20T17:34:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1599229386",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> achow101 wrote in the PR:\r\n> \r\n> > Once we assign the id, we should just store it and remember what it is rather than regenerating it whenever we want it.\r\n> \r\n> This seems better than my suggestion above to store the raw string.\r\n\r\nThat would work for newer versions, not for the previous ones. We can't do much there. Old releases will still read the descriptor, and calculate the id by hashing the apostrophe formatted descriptor string.\r\n\r\nThe main point here is that every single descriptor record in the wallet database is keyed by the descriptor id. So.. if we change the spkm id calculation in newer versions, old software versions will not be able to connect the descriptor entries: keys, caches, etc. with the descriptor itself.\r\nAnd, even worst, after finish the loading process, the wallet will store a new descriptor entry (because the wallet re-writes the descriptor post `TopUp()`), keyed by the hash of the apostrophe formatted descriptor string... which conflicts with the string inside the descriptor, which is what causes this unrecoverable state.\r\n\r\nOverall, I don't think that there is a good workaround for the downgrading topic. We cannot change the past, unless we make people migrate to a newer database format, or..  we store records duplicated in the db.. with the two possible ids.. but that would be the dirties thing ever.\r\n\r\nSo, I think that we will have to live with the apostrophe formatted descriptor string IDs for now. Which is not ideal, but.. it isn't really an issue anyway.",
      "created_at" : "2023-06-20T23:07:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27915#issuecomment-1599696501",
      "id" : 1599696501,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27915",
      "node_id" : "IC_kwDOABII585fWW51",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1599696501/reactions"
      },
      "updated_at" : "2023-06-20T23:29:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1599696501",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Living with apostrophe is one option, but the other is to prevent downgrades. This can be done by making `WALLET_FLAG_GLOBAL_HD_KEY` mandatory, see https://github.com/bitcoin/bitcoin/pull/26728/files#r1081289252. That only works if that PR lands before the 26 branch-off. We can leave this PR open in case #26728 doesn't make it in time.\r\n\r\nThe third option is to revert #26076 which would be my least favourite.",
      "created_at" : "2023-06-22T10:26:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27915#issuecomment-1602395862",
      "id" : 1602395862,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27915",
      "node_id" : "IC_kwDOABII585fgp7W",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1602395862/reactions"
      },
      "updated_at" : "2023-06-22T10:26:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1602395862",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Living with apostrophe is one option, but the other is to prevent downgrades.\r\n\r\nHaven't seen #26728 yet but preventing downgrades on descriptors wallets sounds bad for me. Users already face enough difficulties with their legacy wallets and the migration process for now. We should try to avoid breaking the descriptors wallet compatibility now too.\r\n\r\nFurthermore, I believe this isn't a major problem really, we just had a bad design decision by making the software calculate the db key on-demand, but it is not the end of the world. We can stick to the current implementation and clearly state that descriptor IDs are calculated by hashing the apostrophe-formatted descriptor string. And, in the future, if we ever want to replace the db key for something better, we can take the opportunity to propose a better overall database format and implement the changes all at once.",
      "created_at" : "2023-06-22T13:16:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27915#issuecomment-1602622357",
      "id" : 1602622357,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27915",
      "node_id" : "IC_kwDOABII585fhhOV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1602622357/reactions"
      },
      "updated_at" : "2023-06-22T13:16:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1602622357",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm still worried that something like this will happen again because it's so brittle. E.g. if we change something in miniscript.",
      "created_at" : "2023-06-22T13:23:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27915#issuecomment-1602634032",
      "id" : 1602634032,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27915",
      "node_id" : "IC_kwDOABII585fhkEw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1602634032/reactions"
      },
      "updated_at" : "2023-06-22T13:23:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1602634032",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I'm still worried that something like this will happen again because it's so brittle. E.g. if we change something in miniscript.\r\n\r\nYou mean changing the string representation of a miniscript output descriptor between releases will cause the same issue that we are having here with the hd path. Hmm, that opens a bigger can of worms. Good that we are now aware of it and changes there can be treated carefully.\r\n\r\nMaybe not for the next release (because I think that we are not planning to introduce new miniscript changes for now) but.. the incompatibility idea started getting more traction on me too.. this might also suit well for a new record type and an automatic migration process.\r\n\r\nWill keep thinking about it.\r\n\r\nAt least with #27920, and as long as we don't introduce changes in the descriptor string representation, we gain time to figure out the best way to solve this.",
      "created_at" : "2023-06-22T14:58:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27915#issuecomment-1602792848",
      "id" : 1602792848,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27915",
      "node_id" : "IC_kwDOABII585fiK2Q",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1602792848/reactions"
      },
      "updated_at" : "2023-06-22T15:01:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1602792848",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Maybe we should consider it an error to load a wallet if the descriptors can't all be round-tripped? (and consider it a bugfix for 25.x, while also trying to avoid triggering it for a while)",
      "created_at" : "2023-06-24T14:33:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27915#issuecomment-1605556090",
      "id" : 1605556090,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27915",
      "node_id" : "IC_kwDOABII585fstd6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1605556090/reactions"
      },
      "updated_at" : "2023-06-24T14:33:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1605556090",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Maybe we should consider it an error to load a wallet if the descriptors can't all be round-tripped? (and consider it a bugfix for 25.x, while also trying to avoid triggering it for a while)\r\n\r\nYeah, that is already done in #27920 (fc5565eb). It will prevent undesirable stuff from happening from now on.",
      "created_at" : "2023-06-24T14:39:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27915#issuecomment-1605559145",
      "id" : 1605559145,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27915",
      "node_id" : "IC_kwDOABII585fsuNp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1605559145/reactions"
      },
      "updated_at" : "2023-06-24T14:57:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1605559145",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   }
]
