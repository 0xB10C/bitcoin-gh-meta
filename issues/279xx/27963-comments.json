[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\nBuild Options:\r\n  with external callbacks = no\r\n  with benchmarks         = no\r\n  with tests              = yes\r\n  with ctime tests        = no\r\n  with coverage           = no\r\n  with examples           = no\r\n  module ecdh             = no\r\n  module recovery         = yes\r\n  module extrakeys        = yes\r\n  module schnorrsig       = yes\r\n\r\n  asm                     = no\r\n  ecmult window size      = 15\r\n  ecmult gen prec. bits   = 4\r\n\r\n  valgrind                = no\r\n  CC                      = gcc\r\n  CPPFLAGS                =\r\n  SECP_CFLAGS             = -O2  -std=c89 -pedantic -Wno-long-long -Wnested-externs -Wshadow -Wstrict-prototypes -Wundef -Wno-overlength-strings -Wall -Wno-unused-function -Wextra -Wcast-align -Wconditional-uninitialized -Wreserved-identifier -fvisibility=hidden\r\n  CFLAGS                  = -g -O2\r\n  LDFLAGS                 =\r\n\r\nOptions used to compile and link:\r\n  external signer = yes\r\n  multiprocess    = no\r\n  with experimental syscall sandbox support = no\r\n  with libs       = yes\r\n  with wallet     = yes\r\n    with sqlite   = yes\r\n    with bdb      = no\r\n  with gui / qt   = no\r\n  with zmq        = yes\r\n  with test       = yes\r\n  with fuzz binary = yes\r\n  with bench      = yes\r\n  with upnp       = no\r\n  with natpmp     = no\r\n  use asm         = yes\r\n  USDT tracing    = no\r\n  sanitizers      =\r\n  debug enabled   = no\r\n  gprof enabled   = no\r\n  werror          = no\r\n  LTO             = no\r\n\r\n  target os       = darwin22.5.0\r\n  build os        = darwin22.5.0\r\n\r\n  CC              = gcc\r\n  CFLAGS          = -pthread -g -O2\r\n  CPPFLAGS        =   -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=3  -DHAVE_BUILD_INFO -Xclang -internal-isystem/usr/local/include -DMAC_OSX -DOBJC_OLD_DISPATCH_PROTOTYPES=0 -DPROVIDE_FUZZ_MAIN_FUNCTION\r\n  CXX             = g++ -std=c++17\r\n  CXXFLAGS        =    -Wstack-protector -fstack-protector-all  -Wall -Wextra -Wgnu -Wformat -Wformat-security -Wvla -Wshadow-field -Wthread-safety -Wloop-analysis -Wredundant-decls -Wunused-member-function -Wdate-time -Wconditional-uninitialized -Woverloaded-virtual -Wsuggest-override -Wunreachable-code-loop-increment -Wimplicit-fallthrough -Wdocumentation  -Wno-unused-parameter -Wno-self-assign    -g -O2\r\n  LDFLAGS         =  -lpthread  -Wl,-bind_at_load   -Wl,-headerpad_max_install_names -Wl,-dead_strip -Wl,-dead_strip_dylibs\r\n  AR              = /usr/bin/ar\r\n  ARFLAGS         = cr",
      "created_at" : "2023-06-25T07:14:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27963#issuecomment-1605906878",
      "id" : 1605906878,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27963",
      "node_id" : "IC_kwDOABII585fuDG-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1605906878/reactions"
      },
      "updated_at" : "2023-06-25T07:15:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1605906878",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/551068?v=4",
         "events_url" : "https://api.github.com/users/FelixWeis/events{/privacy}",
         "followers_url" : "https://api.github.com/users/FelixWeis/followers",
         "following_url" : "https://api.github.com/users/FelixWeis/following{/other_user}",
         "gists_url" : "https://api.github.com/users/FelixWeis/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/FelixWeis",
         "id" : 551068,
         "login" : "FelixWeis",
         "node_id" : "MDQ6VXNlcjU1MTA2OA==",
         "organizations_url" : "https://api.github.com/users/FelixWeis/orgs",
         "received_events_url" : "https://api.github.com/users/FelixWeis/received_events",
         "repos_url" : "https://api.github.com/users/FelixWeis/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/FelixWeis/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/FelixWeis/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/FelixWeis"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">  around 40 hours after IBD crashed with the asseration fail.\r\n\r\nI guess this makes it hard to reproduce with gdb attached or with more logging enabled?\r\n\r\nGlancing at the code, I don't see how this could happen unless macOS `send` returned a value larger than the `len` passed in?\r\n\r\nhttps://github.com/bitcoin/bitcoin/blame/d1ae96755a0f9d7e12c3f6741c030d8ea6d0416f/src/net.cpp#L837\r\n\r\nThe last change in the function was https://github.com/bitcoin/bitcoin/commit/691eaf8873fe2f189153ca637506a0291504c97a but that shouldn't be the (direct) cause of the assert failure.",
      "created_at" : "2023-06-25T08:39:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27963#issuecomment-1605939843",
      "id" : 1605939843,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27963",
      "node_id" : "IC_kwDOABII585fuLKD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1605939843/reactions"
      },
      "updated_at" : "2023-06-25T08:39:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1605939843",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If I read correctly it happened _after_ IBD.\r\n\r\nI guess `-debug=net` would useful here, if you can ever reproduce it. It might give us a hint which message we were about to react to.\r\n\r\nAs an aside, since you configured the wallet, be careful loading descriptor wallets on master until #27915 is resolved.",
      "created_at" : "2023-06-26T14:41:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27963#issuecomment-1607633650",
      "id" : 1607633650,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27963",
      "node_id" : "IC_kwDOABII585f0ory",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1607633650/reactions"
      },
      "updated_at" : "2023-06-26T14:41:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1607633650",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I guess -debug=net would useful here, if you can ever reproduce it. It might give us a hint which message we were about to react to.\r\n\r\nIf you do this, make sure to add additional logging (maybe `nBytes`, `data.size()`, and `node.nSendOffset` after the `Send()`?) in the function that asserted, because there is none.",
      "created_at" : "2023-06-26T14:53:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27963#issuecomment-1607655279",
      "id" : 1607655279,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27963",
      "node_id" : "IC_kwDOABII585f0t9v",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1607655279/reactions"
      },
      "updated_at" : "2023-06-26T14:53:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1607655279",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2023-06-26T19:44:34.554349Z [net] received: tx (313 bytes) peer=44\r\n2023-06-26T19:44:34.554644Z [mempool] AcceptToMemoryPool: peer=44: accepted 783c947208643cb757b916a9693fcbbac89ae4059ec748ff8c78735739c831bc (poolsz 21998 txn, 70199 kB)\r\n2023-06-26T19:44:34.554678Z [net] received: tx (313 bytes) peer=44\r\n2023-06-26T19:44:34.554966Z [mempool] AcceptToMemoryPool: peer=44: accepted ccec8d2d77fcfca2386280efaff17fa5b3011d8bae3b91a2fdd2345a1ee9e5b8 (poolsz 21999 txn, 70200 kB)\r\n2023-06-26T19:44:34.554993Z [net] received: tx (266 bytes) peer=44\r\n2023-06-26T19:44:34.555309Z [mempool] AcceptToMemoryPool: peer=44: accepted 62e9ed54e4a48ceb8958c1bc37144a72b61043c1bcdeb0002fa7ea63bc0169fb (poolsz 22000 txn, 70201 kB)\r\n2023-06-26T19:44:34.555345Z [net] received: tx (266 bytes) peer=44\r\n2023-06-26T19:44:34.555626Z [mempool] AcceptToMemoryPool: peer=44: accepted 8ef118ace1c5019d6e77f9ad216612abe66745f40b8c5f9630f14bf97f90c3f9 (poolsz 22001 txn, 70202 kB)\r\n2023-06-26T19:44:34.660816Z [net] sending inv (1261 bytes) peer=49\r\n2023-06-26T19:44:34.767010Z [net] sending inv (1261 bytes) peer=61\r\n2023-06-26T19:44:35.286961Z [net] sending inv (1261 bytes) peer=59\r\n2023-06-26T19:44:35.599720Z [net] sending inv (1261 bytes) peer=43\r\n2023-06-26T19:44:35.601098Z [net] sending inv (1261 bytes) peer=82\r\n2023-06-26T19:44:35.807384Z [net] sending inv (541 bytes) peer=61\r\n2023-06-26T19:44:36.464645Z [net] sending inv (541 bytes) peer=49\r\nAssertion failed: (data.size() > node.nSendOffset), function SocketSendData, file net.cpp, line 837.\r\nzsh: abort      ./src/bitcoind -txindex -rest -debug=mempool -debug=net -logtimemicros\r\n```\r\ncrashed a few times now. ",
      "created_at" : "2023-06-26T22:08:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27963#issuecomment-1608385210",
      "id" : 1608385210,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27963",
      "node_id" : "IC_kwDOABII585f3gK6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1608385210/reactions"
      },
      "updated_at" : "2023-06-26T22:08:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1608385210",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/551068?v=4",
         "events_url" : "https://api.github.com/users/FelixWeis/events{/privacy}",
         "followers_url" : "https://api.github.com/users/FelixWeis/followers",
         "following_url" : "https://api.github.com/users/FelixWeis/following{/other_user}",
         "gists_url" : "https://api.github.com/users/FelixWeis/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/FelixWeis",
         "id" : 551068,
         "login" : "FelixWeis",
         "node_id" : "MDQ6VXNlcjU1MTA2OA==",
         "organizations_url" : "https://api.github.com/users/FelixWeis/orgs",
         "received_events_url" : "https://api.github.com/users/FelixWeis/received_events",
         "repos_url" : "https://api.github.com/users/FelixWeis/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/FelixWeis/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/FelixWeis/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/FelixWeis"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Can you try with my suggested diff?\r\n\r\n```diff\r\ndiff --git a/src/net.cpp b/src/net.cpp\r\nindex a96ffcfbe9..6c9f928f0d 100644\r\n--- a/src/net.cpp\r\n+++ b/src/net.cpp\r\n@@ -854,6 +854,10 @@ size_t CConnman::SocketSendData(CNode& node) const\r\n             node.nSendBytes += nBytes;\r\n             node.nSendOffset += nBytes;\r\n             nSentSize += nBytes;\r\n+            if (node.nSendOffset > data.size()) {\r\n+            LogPrint(BCLog::NET, \"socket sent %s bytes (total: %s, offset: %s) for peer=%d.\\n\", nBytes, data.size(), node.nSendOffset, node.GetId());\r\n+            assert(false);\r\n+            }\r\n             if (node.nSendOffset == data.size()) {\r\n                 node.nSendOffset = 0;\r\n                 node.nSendSize -= data.size();\r\n",
      "created_at" : "2023-06-27T04:29:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27963#issuecomment-1608779293",
      "id" : 1608779293,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27963",
      "node_id" : "IC_kwDOABII585f5AYd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1608779293/reactions"
      },
      "updated_at" : "2023-06-27T04:29:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1608779293",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@FelixWeis do you have inbound peers? After you've tried with the extra logging, maybe also try with `-listen=0`.\r\n\r\nI'm running master @ 679f825ba3aae45af4476f357a67f8e6ec9483e2 now with this patch on an Intel macOS 13.4.1. Will update here if something happens. I haven't noticed  such crashes with v25.0 which I've run for multiple days.",
      "created_at" : "2023-06-27T07:40:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27963#issuecomment-1608964595",
      "id" : 1608964595,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27963",
      "node_id" : "IC_kwDOABII585f5tnz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1608964595/reactions"
      },
      "updated_at" : "2023-06-27T07:40:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1608964595",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
