[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19621 ([RFC] Package-relay:  sender-initiated by ariard)\n* #19619 (Remove wallet.dat path handling from wallet.cpp, rpcwallet.cpp by ryanofsky)\n* #19611 (p2p: refactor CInv::type from public int to private uint32_t by jonatack)\n* #19610 (p2p, refactor: add `CInv` block message helpers; use in net processing by jonatack)\n* #19604 (Pass mempool pointer to UnloadBlockIndex/GetCoinsCacheSizeState by MarcoFalke)\n* #19590 (p2p, refactor: add `CInv` transaction message helpers; use in net processing by jonatack)\n* #19569 (Enable fetching of orphan parents from wtxid peers by sipa)\n* #19340 (Preserve the `LockData` initial state if \"potential deadlock detected\" exception thrown by hebasto)\n* #19337 (sync: detect double lock from the same thread by vasild)\n* #19306 (refactor: Replace RecursiveMutex with Mutex in CTxMemPool by hebasto)\n* #19271 (validation: Warm coins cache during prevalidation to connect blocks faster by andrewtoth)\n* #19099 (refactor: Move wallet methods out of chain.h and node.h by ryanofsky)\n* #19098 (test: Remove duplicate NodeContext hacks by ryanofsky)\n* #19064 (refactor: Cleanup thread ctor calls by hebasto)\n* #18731 (refactor: Make CCheckQueue RAII-styled by hebasto)\n* #18710 (Add local thread pool to CCheckQueue by hebasto)\n* #18354 (Use shared pointers only in validation interface by bvbfan)\n* #18245 (Test some transaction creation with non-empty fee estimator by instagibbs)\n* #18017 (txmempool: split epoch logic into class by ajtowns)\n* #17786 (refactor: Nuke policy/fees->mempool circular dependencies by hebasto)\n* #15719 (Wallet passive startup by ryanofsky)\n* #15367 (feature: Added ability for users to add a startup command by benthecarman)\n* #13990 (Allow fee estimation to work with lower fees by ajtowns)\n* #10443 (Add fee_est tool for debugging fee estimation code by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-04-25T17:36:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-619414860",
      "id" : 619414860,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxOTQxNDg2MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-30T03:48:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/619414860",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r415650678"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415650678"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why read the file then? You could early check like:\r\n```cpp\r\n// Don't initialize fee estimation if we don't relay transactions.\r\nif (!g_relay_txes) {\r\n    fs::path est_path = GetDataDir() / FEE_ESTIMATES_FILENAME;\r\n    CAutoFile est_filein(fsbridge::fopen(est_path, \"rb\"), SER_DISK, CLIENT_VERSION);\r\n    if (!est_filein.IsNull()) ::feeEstimator.Read(est_filein);\r\n    fFeeEstimatesInitialized = true;\r\n}\r\n```\r\nThis also avoids writing to estimates file in `Shutdown`.",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-04-27T09:20:00Z",
      "diff_hunk" : "@@ -1750,8 +1750,10 @@ bool AppInitMain(NodeContext& node)\n \n     fs::path est_path = GetDataDir() / FEE_ESTIMATES_FILENAME;\n     CAutoFile est_filein(fsbridge::fopen(est_path, \"rb\"), SER_DISK, CLIENT_VERSION);\n-    // Allowed to fail as this file IS missing on first startup.\n-    if (!est_filein.IsNull())\n+    // Allowed to fail as this file IS missing on first startup. Also, don't initialize\n+    // fee estimation with old data if we don't relay transactions, as they would never be\n+    // updated.\n+    if (!est_filein.IsNull() && g_relay_txes)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r415650678",
      "id" : 415650678,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY1MDY3OA==",
      "original_commit_id" : "9cf5c47e351054a2557f10732080d0abd7ce85be",
      "original_line" : 1756,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 400772886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415650678",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r415668117"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415668117"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think\r\n```cpp\r\nfFeeEstimatesInitialized = true;\r\n```\r\nshould be set anyway ?\r\n\r\nWhat do you think about this conceptually ?",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-04-27T09:45:46Z",
      "diff_hunk" : "@@ -1750,8 +1750,10 @@ bool AppInitMain(NodeContext& node)\n \n     fs::path est_path = GetDataDir() / FEE_ESTIMATES_FILENAME;\n     CAutoFile est_filein(fsbridge::fopen(est_path, \"rb\"), SER_DISK, CLIENT_VERSION);\n-    // Allowed to fail as this file IS missing on first startup.\n-    if (!est_filein.IsNull())\n+    // Allowed to fail as this file IS missing on first startup. Also, don't initialize\n+    // fee estimation with old data if we don't relay transactions, as they would never be\n+    // updated.\n+    if (!est_filein.IsNull() && g_relay_txes)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r415668117",
      "id" : 415668117,
      "in_reply_to_id" : 415650678,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY2ODExNw==",
      "original_commit_id" : "9cf5c47e351054a2557f10732080d0abd7ce85be",
      "original_line" : 1756,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 400792228,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415668117",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r415672000"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415672000"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think `fFeeEstimatesInitialized` exists to handle early shutdowns. But if you don't read estimates then writing will clear it right?",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-04-27T09:51:31Z",
      "diff_hunk" : "@@ -1750,8 +1750,10 @@ bool AppInitMain(NodeContext& node)\n \n     fs::path est_path = GetDataDir() / FEE_ESTIMATES_FILENAME;\n     CAutoFile est_filein(fsbridge::fopen(est_path, \"rb\"), SER_DISK, CLIENT_VERSION);\n-    // Allowed to fail as this file IS missing on first startup.\n-    if (!est_filein.IsNull())\n+    // Allowed to fail as this file IS missing on first startup. Also, don't initialize\n+    // fee estimation with old data if we don't relay transactions, as they would never be\n+    // updated.\n+    if (!est_filein.IsNull() && g_relay_txes)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r415672000",
      "id" : 415672000,
      "in_reply_to_id" : 415650678,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY3MjAwMA==",
      "original_commit_id" : "9cf5c47e351054a2557f10732080d0abd7ce85be",
      "original_line" : 1756,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 400796497,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415672000",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r415677781"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415677781"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm right",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-04-27T10:00:03Z",
      "diff_hunk" : "@@ -1750,8 +1750,10 @@ bool AppInitMain(NodeContext& node)\n \n     fs::path est_path = GetDataDir() / FEE_ESTIMATES_FILENAME;\n     CAutoFile est_filein(fsbridge::fopen(est_path, \"rb\"), SER_DISK, CLIENT_VERSION);\n-    // Allowed to fail as this file IS missing on first startup.\n-    if (!est_filein.IsNull())\n+    // Allowed to fail as this file IS missing on first startup. Also, don't initialize\n+    // fee estimation with old data if we don't relay transactions, as they would never be\n+    // updated.\n+    if (!est_filein.IsNull() && g_relay_txes)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r415677781",
      "id" : 415677781,
      "in_reply_to_id" : 415650678,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY3Nzc4MQ==",
      "original_commit_id" : "9cf5c47e351054a2557f10732080d0abd7ce85be",
      "original_line" : 1756,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 400802965,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415677781",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@promag : addressed your feedback. Would be interested about what do you think about disabling the fee estimation in `blocksonly` conceptually though.",
      "created_at" : "2020-04-27T10:28:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-619889201",
      "id" : 619889201,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxOTg4OTIwMQ==",
      "updated_at" : "2020-04-27T10:28:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/619889201",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK / Sounds reasonable.",
      "created_at" : "2020-04-30T17:37:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-621999260",
      "id" : 621999260,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMTk5OTI2MA==",
      "updated_at" : "2020-04-30T17:37:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/621999260",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. ",
      "created_at" : "2020-05-01T10:48:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-622341098",
      "id" : 622341098,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjM0MTA5OA==",
      "updated_at" : "2020-05-01T10:48:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622341098",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, but I don't know enough about the underlying mechanism to be sure if this is a reasonable way to accomplish it.",
      "created_at" : "2020-05-04T14:37:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-623503344",
      "id" : 623503344,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzUwMzM0NA==",
      "updated_at" : "2020-05-04T14:37:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623503344",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Would be interested about what do you think about disabling the fee estimation in `blocksonly` conceptually though.\r\n\r\nSame opinion as above.",
      "created_at" : "2020-05-04T14:48:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-623509291",
      "id" : 623509291,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzUwOTI5MQ==",
      "updated_at" : "2020-05-04T14:48:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623509291",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, while the fee estimation should work for some limited time after the mempool has been turned off (see https://github.com/bitcoin/bitcoin/issues/16840#issuecomment-529904220), I can see the point to fail early on startup instead of later at runtime.",
      "created_at" : "2020-05-04T15:03:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-623518006",
      "id" : 623518006,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzUxODAwNg==",
      "updated_at" : "2020-05-04T15:03:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623518006",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK 33ca35902435a162c526bf6c8bd82145585dfbd9",
      "created_at" : "2020-05-04T15:04:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-623518645",
      "id" : 623518645,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzUxODY0NQ==",
      "updated_at" : "2020-05-04T15:04:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623518645",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sdaftuar (ping because you reviewed the previous PR) : what do you think of this approach compared to the previous one ?\r\n\r\n@morcos (ping because you implemented the fee estimation) : what do you think of it implementation-wise ?",
      "created_at" : "2020-06-12T09:14:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-643168066",
      "id" : 643168066,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MzE2ODA2Ng==",
      "updated_at" : "2020-06-12T09:14:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/643168066",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This was intended to be a \"quick fix\", but the approach seems to be too much of a workaround.\r\n\r\nI've reworked this to opt for a more involved approach based on #19556. This now:\r\n- Removes the fee estimator related globals.\r\n- Conditionally creates the fee estimator: if we don't relay transactions we don't even bother to allocate the `CBlockPolicyEstimator`.\r\n\r\nThis is rebased on top of #19556 (which i itself rebased on top of #19604).",
      "created_at" : "2020-07-29T16:14:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-665759886",
      "id" : 665759886,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NTc1OTg4Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-29T16:14:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/665759886",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-07-30T14:29:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-666400604",
      "id" : 666400604,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NjQwMDYwNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-30T14:29:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/666400604",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased on  #19556 now that the remove-mempool-global series is almost over.",
      "created_at" : "2020-09-06T20:07:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-687887730",
      "id" : 687887730,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4Nzg4NzczMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-06T20:07:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687887730",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, will review after 19556 goes in. ",
      "created_at" : "2020-09-06T20:16:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-687889938",
      "id" : 687889938,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4Nzg4OTkzOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-06T20:16:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687889938",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-09-06T20:31:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-687893655",
      "id" : 687893655,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4Nzg5MzY1NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-06T20:31:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687893655",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Intuitively, I don't think the mempool should 'own' the fee estimator, but rather I see the fee estimator as a client of the mempool. I'd suggest constructing the fee estimator in `AppInitMain()` and owning the memory in `NodeContext`, like the other components.",
      "created_at" : "2020-09-06T20:52:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-687898700",
      "id" : 687898700,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4Nzg5ODcwMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-06T20:52:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687898700",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-09-07T09:15:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-688189666",
      "id" : 688189666,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4ODE4OTY2Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-07T09:15:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/688189666",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Intuitively, I don't think the mempool should 'own' the fee estimator, but rather I see the fee estimator as a client of the mempool. I'd suggest constructing the fee estimator in AppInitMain() and owning the memory in NodeContext, like the other components.\r\n\r\nIt seems more intuitive to me for the mempool to own the fee estimator as the latter can not exist without the former, and it would otherwise be a potentially-uninitialized globally-accessible \"second class\" object ? I think of this as \"the mempool *may* provide fee estimation\".",
      "created_at" : "2020-09-08T10:04:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-688764055",
      "id" : 688764055,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4ODc2NDA1NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-08T10:04:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/688764055",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> it would otherwise be a potentially-uninitialized globally-accessible \"second class\" object\r\n\r\nThat depends on how you write the code. `NodeContext` holds (mostly) unique ptrs which may or may not be initialized. It's up to the components to make sure that they're using a component that is enabled (see, for example, the usage of banman in net_processing).\r\n\r\nFee estimator is currently a separate component from the mempool. Let's not add unnecessary coupling between the components by moving it inside the mempool. Decoupled components with well defined interfaces make it easier to reason about and test the code.",
      "created_at" : "2020-09-08T10:30:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-688777863",
      "id" : 688777863,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4ODc3Nzg2Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-08T10:30:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/688777863",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Refactored to keep the feeEstimator as a separate component as per @jnewbery request (spoiler: it's cleaner now, i could even squash the first two commits).",
      "created_at" : "2020-09-08T17:07:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-689015609",
      "id" : 689015609,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4OTAxNTYwOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-09T09:16:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/689015609",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485454601"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485454601"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is unused.",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T09:02:00Z",
      "diff_hunk" : "@@ -577,6 +578,9 @@ class CTxMemPool\n     typedef std::set<txiter, CompareIteratorByHash> setEntries;\n \n     uint64_t CalculateDescendantMaximum(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n+\n+    void initFeeEstimator(CAutoFile& est_file);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485454601",
      "id" : 485454601,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ1NDYwMQ==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 582,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 484805297,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485454601",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485456244"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485456244"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why is this added?",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T09:04:29Z",
      "diff_hunk" : "@@ -20,6 +20,7 @@\n #include <optional.h>\n #include <policy/feerate.h>\n #include <primitives/transaction.h>\n+#include <streams.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485456244",
      "id" : 485456244,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ1NjI0NA==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 23,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 484805297,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485456244",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485458249"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485458249"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Join lines to fix up with current code style:\r\n\r\n`if (node.feeEstimator) {`\r\n\r\n(see https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#coding-style-c)",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T09:07:22Z",
      "diff_hunk" : "@@ -235,18 +234,18 @@ void Shutdown(NodeContext& node)\n         DumpMempool(*node.mempool);\n     }\n \n-    if (fFeeEstimatesInitialized)\n+    if (node.feeEstimator)\n     {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485458249",
      "id" : 485458249,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ1ODI0OQ==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 238,
      "original_position" : 14,
      "original_start_line" : 237,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 484805297,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485458249",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485458615"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485458615"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Again, fix up braces when touching adjacent lines.",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T09:07:52Z",
      "diff_hunk" : "@@ -235,18 +234,18 @@ void Shutdown(NodeContext& node)\n         DumpMempool(*node.mempool);\n     }\n \n-    if (fFeeEstimatesInitialized)\n+    if (node.feeEstimator)\n     {\n-        ::feeEstimator.FlushUnconfirmed();\n+        node.feeEstimator->FlushUnconfirmed();\n         fs::path est_path = GetDataDir() / FEE_ESTIMATES_FILENAME;\n         CAutoFile est_fileout(fsbridge::fopen(est_path, \"wb\"), SER_DISK, CLIENT_VERSION);\n         if (!est_fileout.IsNull())\n-            ::feeEstimator.Write(est_fileout);\n+            node.feeEstimator->Write(est_fileout);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485458615",
      "id" : 485458615,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ1ODYxNQ==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 242,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 484805297,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485458615",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485459450"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485459450"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think only `g_relay_txes` needs to be moved up here.",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T09:09:07Z",
      "diff_hunk" : "@@ -1356,15 +1355,27 @@ bool AppInitMain(const util::Ref& context, NodeContext& node, interfaces::BlockA\n     // is not yet setup and may end up being set up twice if we\n     // need to reindex later.\n \n+    // see Step 2: parameter interactions for more information about these",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485459450",
      "id" : 485459450,
      "line" : 1348,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ1OTQ1MA==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 1348,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 49,
      "pull_request_review_id" : 484805297,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485459450",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485459823"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485459823"
         }
      },
      "author_association" : "MEMBER",
      "body" : "use braces for if block.",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T09:09:36Z",
      "diff_hunk" : "@@ -1768,9 +1774,8 @@ bool AppInitMain(const util::Ref& context, NodeContext& node, interfaces::BlockA\n     fs::path est_path = GetDataDir() / FEE_ESTIMATES_FILENAME;\n     CAutoFile est_filein(fsbridge::fopen(est_path, \"rb\"), SER_DISK, CLIENT_VERSION);\n     // Allowed to fail as this file IS missing on first startup.\n-    if (!est_filein.IsNull())\n-        ::feeEstimator.Read(est_filein);\n-    fFeeEstimatesInitialized = true;\n+    if (node.feeEstimator && !est_filein.IsNull())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485459823",
      "id" : 485459823,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ1OTgyMw==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 1777,
      "original_position" : 79,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 484805297,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485459823",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485460221"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485460221"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think you can just use default initialization of `CFeeRate`:\r\n\r\n```suggestion\r\n        if (!m_node.feeEstimator) return {};\r\n```",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T09:10:11Z",
      "diff_hunk" : "@@ -327,11 +327,13 @@ class ChainImpl : public Chain\n     }\n     CFeeRate estimateSmartFee(int num_blocks, bool conservative, FeeCalculation* calc) override\n     {\n-        return ::feeEstimator.estimateSmartFee(num_blocks, calc, conservative);\n+        if (!m_node.feeEstimator) return CFeeRate(0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485460221",
      "id" : 485460221,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ2MDIyMQ==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 330,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/interfaces/chain.cpp",
      "position" : null,
      "pull_request_review_id" : 484805297,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485460221",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485460740"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485460740"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why does this need to be shared? `NodeContext` should have unique ownership of the feeEstimator object.",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T09:10:54Z",
      "diff_hunk" : "@@ -36,6 +37,7 @@ class WalletClient;\n struct NodeContext {\n     std::unique_ptr<CConnman> connman;\n     std::unique_ptr<CTxMemPool> mempool;\n+    std::shared_ptr<CBlockPolicyEstimator> feeEstimator;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485460740",
      "id" : 485460740,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ2MDc0MA==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 40,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/node/context.h",
      "position" : null,
      "pull_request_review_id" : 484805297,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485460740",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485461954"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485461954"
         }
      },
      "author_association" : "MEMBER",
      "body" : "How about extracting this to an `EnsureFeeEstimator()` function? (see `EnsureMemPool` and `EnsureChainman`)",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T09:12:40Z",
      "diff_hunk" : "@@ -1064,7 +1064,13 @@ static RPCHelpMan estimatesmartfee()\n {\n     RPCTypeCheck(request.params, {UniValue::VNUM, UniValue::VSTR});\n     RPCTypeCheckArgument(request.params[0], UniValue::VNUM);\n-    unsigned int max_target = ::feeEstimator.HighestTargetTracked(FeeEstimateHorizon::LONG_HALFLIFE);\n+\n+    NodeContext& node = EnsureNodeContext(request.context);\n+    if (!node.feeEstimator) {\n+        throw JSONRPCError(RPC_INTERNAL_ERROR, \"Fee estimation disabled\");\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485461954",
      "id" : 485461954,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ2MTk1NA==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 1071,
      "original_position" : 9,
      "original_start_line" : 1068,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 484805297,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485461954",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485464307"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485464307"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You don't need to make this change. The fee estimator's memory/lifetime is owned by `NodeContext`. This can continue being a raw pointer to that object (in the same way that `PeerManager` holds pointers and references to other components).\r\n\r\nNot making this change should reduce the diff of this PR considerably.",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T09:15:57Z",
      "diff_hunk" : "@@ -331,7 +331,7 @@ void CTxMemPoolEntry::UpdateAncestorState(int64_t modifySize, CAmount modifyFee,\n     assert(int(nSigOpCostWithAncestors) >= 0);\n }\n \n-CTxMemPool::CTxMemPool(CBlockPolicyEstimator* estimator)\n+CTxMemPool::CTxMemPool(std::shared_ptr<CBlockPolicyEstimator> estimator)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485464307",
      "id" : 485464307,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ2NDMwNw==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 334,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 484805297,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485464307",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485466714"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485466714"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Consider joining into one line for simple one-statement if blocks:\r\n\r\n```suggestion\r\n    if (g_relay_txes) node.feeEstimator = std::make_shared<CBlockPolicyEstimator>();\r\n```",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T09:19:45Z",
      "diff_hunk" : "@@ -1356,15 +1355,27 @@ bool AppInitMain(const util::Ref& context, NodeContext& node, interfaces::BlockA\n     // is not yet setup and may end up being set up twice if we\n     // need to reindex later.\n \n+    // see Step 2: parameter interactions for more information about these\n+    fListen = args.GetBoolArg(\"-listen\", DEFAULT_LISTEN);\n+    fDiscover = args.GetBoolArg(\"-discover\", true);\n+    g_relay_txes = !args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY);\n+\n     assert(!node.banman);\n     node.banman = MakeUnique<BanMan>(GetDataDir() / \"banlist.dat\", &uiInterface, args.GetArg(\"-bantime\", DEFAULT_MISBEHAVING_BANTIME));\n     assert(!node.connman);\n     node.connman = MakeUnique<CConnman>(GetRand(std::numeric_limits<uint64_t>::max()), GetRand(std::numeric_limits<uint64_t>::max()), args.GetBoolArg(\"-networkactive\", true));\n \n+    // Don't initialize fee estimation with old data if we don't relay transactions,\n+    // as they would never get updated.\n+    assert(!node.feeEstimator);\n+    if (g_relay_txes) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485466714",
      "id" : 485466714,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ2NjcxNA==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 1362,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 484805297,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485466714",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485467428"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485467428"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You're constructing the fee estimator here. You should destruct it on shutdown. At line 304 (after the `node.mempool` unique ptr is reset), you should reset this ptr too.",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T09:20:51Z",
      "diff_hunk" : "@@ -1356,15 +1355,27 @@ bool AppInitMain(const util::Ref& context, NodeContext& node, interfaces::BlockA\n     // is not yet setup and may end up being set up twice if we\n     // need to reindex later.\n \n+    // see Step 2: parameter interactions for more information about these\n+    fListen = args.GetBoolArg(\"-listen\", DEFAULT_LISTEN);\n+    fDiscover = args.GetBoolArg(\"-discover\", true);\n+    g_relay_txes = !args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY);\n+\n     assert(!node.banman);\n     node.banman = MakeUnique<BanMan>(GetDataDir() / \"banlist.dat\", &uiInterface, args.GetArg(\"-bantime\", DEFAULT_MISBEHAVING_BANTIME));\n     assert(!node.connman);\n     node.connman = MakeUnique<CConnman>(GetRand(std::numeric_limits<uint64_t>::max()), GetRand(std::numeric_limits<uint64_t>::max()), args.GetBoolArg(\"-networkactive\", true));\n \n+    // Don't initialize fee estimation with old data if we don't relay transactions,\n+    // as they would never get updated.\n+    assert(!node.feeEstimator);\n+    if (g_relay_txes) {\n+        node.feeEstimator = std::make_shared<CBlockPolicyEstimator>();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485467428",
      "id" : 485467428,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ2NzQyOA==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 1372,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 484805297,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485467428",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485468022"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485468022"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You only need to test this on one node.",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T09:21:54Z",
      "diff_hunk" : "@@ -263,6 +264,13 @@ def run_test(self):\n         self.log.info(\"Final estimates after emptying mempools\")\n         check_estimates(self.nodes[1], self.fees_per_kb)\n \n+        self.log.info(\"Testing that fee estimation is disabled in blocksonly.\")\n+        self.stop_nodes()\n+        self.start_nodes(extra_args=[[\"-blocksonly\"]] * len(self.nodes))\n+        for node in self.nodes:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485468022",
      "id" : 485468022,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ2ODAyMg==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 270,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "test/functional/feature_fee_estimation.py",
      "position" : null,
      "pull_request_review_id" : 484805297,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485468022",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485469249"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485469249"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Argh, leftover from the refactor..",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T09:23:48Z",
      "diff_hunk" : "@@ -577,6 +578,9 @@ class CTxMemPool\n     typedef std::set<txiter, CompareIteratorByHash> setEntries;\n \n     uint64_t CalculateDescendantMaximum(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n+\n+    void initFeeEstimator(CAutoFile& est_file);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485469249",
      "id" : 485469249,
      "in_reply_to_id" : 485454601,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ2OTI0OQ==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 582,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 484823756,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485469249",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485469773"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485469773"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Same, was for CAutoFile",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T09:24:36Z",
      "diff_hunk" : "@@ -20,6 +20,7 @@\n #include <optional.h>\n #include <policy/feerate.h>\n #include <primitives/transaction.h>\n+#include <streams.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485469773",
      "id" : 485469773,
      "in_reply_to_id" : 485456244,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ2OTc3Mw==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 23,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 484824437,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485469773",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485471403"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485471403"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah but it made sense to keep them all grouped imho",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T09:27:00Z",
      "diff_hunk" : "@@ -1356,15 +1355,27 @@ bool AppInitMain(const util::Ref& context, NodeContext& node, interfaces::BlockA\n     // is not yet setup and may end up being set up twice if we\n     // need to reindex later.\n \n+    // see Step 2: parameter interactions for more information about these",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485471403",
      "id" : 485471403,
      "in_reply_to_id" : 485459450,
      "line" : 1348,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ3MTQwMw==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 1348,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 49,
      "pull_request_review_id" : 484826364,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485471403",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485472650"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485472650"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I thought `EnsureXX()` were used for components that should not be absent, while the fee estimator may be ?",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T09:29:03Z",
      "diff_hunk" : "@@ -1064,7 +1064,13 @@ static RPCHelpMan estimatesmartfee()\n {\n     RPCTypeCheck(request.params, {UniValue::VNUM, UniValue::VSTR});\n     RPCTypeCheckArgument(request.params[0], UniValue::VNUM);\n-    unsigned int max_target = ::feeEstimator.HighestTargetTracked(FeeEstimateHorizon::LONG_HALFLIFE);\n+\n+    NodeContext& node = EnsureNodeContext(request.context);\n+    if (!node.feeEstimator) {\n+        throw JSONRPCError(RPC_INTERNAL_ERROR, \"Fee estimation disabled\");\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485472650",
      "id" : 485472650,
      "in_reply_to_id" : 485461954,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ3MjY1MA==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 1071,
      "original_position" : 9,
      "original_start_line" : 1068,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 484827984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485472650",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485474344"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485474344"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Dropped this somehow.. Fixing now.",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T09:31:45Z",
      "diff_hunk" : "@@ -1356,15 +1355,27 @@ bool AppInitMain(const util::Ref& context, NodeContext& node, interfaces::BlockA\n     // is not yet setup and may end up being set up twice if we\n     // need to reindex later.\n \n+    // see Step 2: parameter interactions for more information about these\n+    fListen = args.GetBoolArg(\"-listen\", DEFAULT_LISTEN);\n+    fDiscover = args.GetBoolArg(\"-discover\", true);\n+    g_relay_txes = !args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY);\n+\n     assert(!node.banman);\n     node.banman = MakeUnique<BanMan>(GetDataDir() / \"banlist.dat\", &uiInterface, args.GetArg(\"-bantime\", DEFAULT_MISBEHAVING_BANTIME));\n     assert(!node.connman);\n     node.connman = MakeUnique<CConnman>(GetRand(std::numeric_limits<uint64_t>::max()), GetRand(std::numeric_limits<uint64_t>::max()), args.GetBoolArg(\"-networkactive\", true));\n \n+    // Don't initialize fee estimation with old data if we don't relay transactions,\n+    // as they would never get updated.\n+    assert(!node.feeEstimator);\n+    if (g_relay_txes) {\n+        node.feeEstimator = std::make_shared<CBlockPolicyEstimator>();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485474344",
      "id" : 485474344,
      "in_reply_to_id" : 485467428,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ3NDM0NA==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 1372,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 484830116,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485474344",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485477681"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485477681"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it's fine to add `EnsureXX()` for components that may not be enabled. Does that sound right to you @MarcoFalke ?",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T09:37:18Z",
      "diff_hunk" : "@@ -1064,7 +1064,13 @@ static RPCHelpMan estimatesmartfee()\n {\n     RPCTypeCheck(request.params, {UniValue::VNUM, UniValue::VSTR});\n     RPCTypeCheckArgument(request.params[0], UniValue::VNUM);\n-    unsigned int max_target = ::feeEstimator.HighestTargetTracked(FeeEstimateHorizon::LONG_HALFLIFE);\n+\n+    NodeContext& node = EnsureNodeContext(request.context);\n+    if (!node.feeEstimator) {\n+        throw JSONRPCError(RPC_INTERNAL_ERROR, \"Fee estimation disabled\");\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485477681",
      "id" : 485477681,
      "in_reply_to_id" : 485461954,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ3NzY4MQ==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 1071,
      "original_position" : 9,
      "original_start_line" : 1068,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 484834509,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485477681",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485492587"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485492587"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It doesn't make sense to call `estimatesmartfee` without the fee estimator. So yes, `EnsureFeeEstimator` is the way to go right now. (In the future the fee estimator can register the RPC itself, so when it is missing, the RPC won't even be there)",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T10:02:11Z",
      "diff_hunk" : "@@ -1064,7 +1064,13 @@ static RPCHelpMan estimatesmartfee()\n {\n     RPCTypeCheck(request.params, {UniValue::VNUM, UniValue::VSTR});\n     RPCTypeCheckArgument(request.params[0], UniValue::VNUM);\n-    unsigned int max_target = ::feeEstimator.HighestTargetTracked(FeeEstimateHorizon::LONG_HALFLIFE);\n+\n+    NodeContext& node = EnsureNodeContext(request.context);\n+    if (!node.feeEstimator) {\n+        throw JSONRPCError(RPC_INTERNAL_ERROR, \"Fee estimation disabled\");\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485492587",
      "id" : 485492587,
      "in_reply_to_id" : 485461954,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ5MjU4Nw==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 1071,
      "original_position" : 9,
      "original_start_line" : 1068,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 484853837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485492587",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485494099"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485494099"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right, fixed",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T10:04:46Z",
      "diff_hunk" : "@@ -36,6 +37,7 @@ class WalletClient;\n struct NodeContext {\n     std::unique_ptr<CConnman> connman;\n     std::unique_ptr<CTxMemPool> mempool;\n+    std::shared_ptr<CBlockPolicyEstimator> feeEstimator;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485494099",
      "id" : 485494099,
      "in_reply_to_id" : 485460740,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ5NDA5OQ==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 40,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/node/context.h",
      "position" : null,
      "pull_request_review_id" : 484855831,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485494099",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485500587"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485500587"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> In the future the fee estimator can register the RPC itself, so when it is missing, the RPC won't even be there\r\n\r\nHmm that would be particularly nice, as for example applications up the stack relying on fee estimation would be able to just error at startup rather than \"check and see if it errors\". Might propose a follow-up implementing this.",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T10:15:59Z",
      "diff_hunk" : "@@ -1064,7 +1064,13 @@ static RPCHelpMan estimatesmartfee()\n {\n     RPCTypeCheck(request.params, {UniValue::VNUM, UniValue::VSTR});\n     RPCTypeCheckArgument(request.params[0], UniValue::VNUM);\n-    unsigned int max_target = ::feeEstimator.HighestTargetTracked(FeeEstimateHorizon::LONG_HALFLIFE);\n+\n+    NodeContext& node = EnsureNodeContext(request.context);\n+    if (!node.feeEstimator) {\n+        throw JSONRPCError(RPC_INTERNAL_ERROR, \"Fee estimation disabled\");\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485500587",
      "id" : 485500587,
      "in_reply_to_id" : 485461954,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUwMDU4Nw==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 1071,
      "original_position" : 9,
      "original_start_line" : 1068,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 484863980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485500587",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485503096"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485503096"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, amended to only start and test on one node.",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T10:20:47Z",
      "diff_hunk" : "@@ -263,6 +264,13 @@ def run_test(self):\n         self.log.info(\"Final estimates after emptying mempools\")\n         check_estimates(self.nodes[1], self.fees_per_kb)\n \n+        self.log.info(\"Testing that fee estimation is disabled in blocksonly.\")\n+        self.stop_nodes()\n+        self.start_nodes(extra_args=[[\"-blocksonly\"]] * len(self.nodes))\n+        for node in self.nodes:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485503096",
      "id" : 485503096,
      "in_reply_to_id" : 485468022,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUwMzA5Ng==",
      "original_commit_id" : "3ac3a2f3c8ad24567ad0c961f8815af71912eda4",
      "original_line" : 270,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "test/functional/feature_fee_estimation.py",
      "position" : null,
      "pull_request_review_id" : 484867155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485503096",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485543436"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485543436"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this flag might protect us from overwriting the estimates.dat file in case we abort start-up for some reason. Rather than removing it entirely, I think it should be moved to CBlockPolicyEstimator, and then checked on destruction.\r\n\r\nIf you really wanted to encaptulate this better, you could move this file read logic to the feeEstimator constructor, and the flush logic to a public flush method in CBlockPolicyEstimator, and hide all the construction/destruction logic from init.cpp.",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T11:39:31Z",
      "diff_hunk" : "@@ -1768,10 +1774,9 @@ bool AppInitMain(const util::Ref& context, NodeContext& node, interfaces::BlockA\n     fs::path est_path = GetDataDir() / FEE_ESTIMATES_FILENAME;\n     CAutoFile est_filein(fsbridge::fopen(est_path, \"rb\"), SER_DISK, CLIENT_VERSION);\n     // Allowed to fail as this file IS missing on first startup.\n-    if (!est_filein.IsNull())\n-        ::feeEstimator.Read(est_filein);\n-    fFeeEstimatesInitialized = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485543436",
      "id" : 485543436,
      "line" : 1773,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU0MzQzNg==",
      "original_commit_id" : "6e3313019010c27868da4925bf48d141c3e0208c",
      "original_line" : 1773,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 92,
      "pull_request_review_id" : 484919437,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485543436",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485588776"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485588776"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    std::unique_ptr<CBlockPolicyEstimator> fee_estimator;\r\n```\r\nfor new code",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T12:56:14Z",
      "diff_hunk" : "@@ -36,6 +37,7 @@ class WalletClient;\n struct NodeContext {\n     std::unique_ptr<CConnman> connman;\n     std::unique_ptr<CTxMemPool> mempool;\n+    std::unique_ptr<CBlockPolicyEstimator> feeEstimator;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485588776",
      "id" : 485588776,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU4ODc3Ng==",
      "original_commit_id" : "6e3313019010c27868da4925bf48d141c3e0208c",
      "original_line" : 40,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/node/context.h",
      "position" : null,
      "pull_request_review_id" : 484978123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485588776",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485590033"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485590033"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    CBlockPolicyEstimator& fee_estimator = EnsureFeeEstimator(request.context);\r\n```\r\n\r\nsnake case for new code ;)",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T12:58:13Z",
      "diff_hunk" : "@@ -1064,7 +1064,10 @@ static RPCHelpMan estimatesmartfee()\n {\n     RPCTypeCheck(request.params, {UniValue::VNUM, UniValue::VSTR});\n     RPCTypeCheckArgument(request.params[0], UniValue::VNUM);\n-    unsigned int max_target = ::feeEstimator.HighestTargetTracked(FeeEstimateHorizon::LONG_HALFLIFE);\n+\n+    CBlockPolicyEstimator& feeEstimator = EnsureFeeEstimator(request.context);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485590033",
      "id" : 485590033,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU5MDAzMw==",
      "original_commit_id" : "6e3313019010c27868da4925bf48d141c3e0208c",
      "original_line" : 1068,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 484979800,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485590033",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485626919"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485626919"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good catch. Went for the encapsulation way, will push a commit.",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T13:49:44Z",
      "diff_hunk" : "@@ -1768,10 +1774,9 @@ bool AppInitMain(const util::Ref& context, NodeContext& node, interfaces::BlockA\n     fs::path est_path = GetDataDir() / FEE_ESTIMATES_FILENAME;\n     CAutoFile est_filein(fsbridge::fopen(est_path, \"rb\"), SER_DISK, CLIENT_VERSION);\n     // Allowed to fail as this file IS missing on first startup.\n-    if (!est_filein.IsNull())\n-        ::feeEstimator.Read(est_filein);\n-    fFeeEstimatesInitialized = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485626919",
      "id" : 485626919,
      "in_reply_to_id" : 485543436,
      "line" : 1773,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYyNjkxOQ==",
      "original_commit_id" : "6e3313019010c27868da4925bf48d141c3e0208c",
      "original_line" : 1773,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 92,
      "pull_request_review_id" : 485028663,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485626919",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485655086"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485655086"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks! Amended",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T14:26:06Z",
      "diff_hunk" : "@@ -1064,7 +1064,10 @@ static RPCHelpMan estimatesmartfee()\n {\n     RPCTypeCheck(request.params, {UniValue::VNUM, UniValue::VSTR});\n     RPCTypeCheckArgument(request.params[0], UniValue::VNUM);\n-    unsigned int max_target = ::feeEstimator.HighestTargetTracked(FeeEstimateHorizon::LONG_HALFLIFE);\n+\n+    CBlockPolicyEstimator& feeEstimator = EnsureFeeEstimator(request.context);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485655086",
      "id" : 485655086,
      "in_reply_to_id" : 485590033,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY1NTA4Ng==",
      "original_commit_id" : "6e3313019010c27868da4925bf48d141c3e0208c",
      "original_line" : 1068,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 485066417,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485655086",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Amended to use snake case, and added a commit to encapsulate the management of the fee estimation file in `CBlockPolicyEstimator`.",
      "created_at" : "2020-09-09T15:35:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-689642600",
      "id" : 689642600,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4OTY0MjYwMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-09T15:35:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/689642600",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485720809"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485720809"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You don't need a separate function for this since it's only called in one place. You can just insert this code into the constructor.",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T15:53:27Z",
      "diff_hunk" : "@@ -886,8 +902,14 @@ bool CBlockPolicyEstimator::Write(CAutoFile& fileout) const\n     return true;\n }\n \n-bool CBlockPolicyEstimator::Read(CAutoFile& filein)\n-{\n+bool CBlockPolicyEstimator::ReadEstFile() {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485720809",
      "id" : 485720809,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcyMDgwOQ==",
      "original_commit_id" : "941806deef3224ae0e7548bc33abfd041b40730b",
      "original_line" : 905,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 485153270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485720809",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485721671"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485721671"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Moving this code to the destructor may be a behaviour change, since there will have been changes to the mempool in the intervening period. I suggest adding a public flush method and calling it here to avoid the behaviour change.",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T15:54:41Z",
      "diff_hunk" : "@@ -1768,10 +1774,9 @@ bool AppInitMain(const util::Ref& context, NodeContext& node, interfaces::BlockA\n     fs::path est_path = GetDataDir() / FEE_ESTIMATES_FILENAME;\n     CAutoFile est_filein(fsbridge::fopen(est_path, \"rb\"), SER_DISK, CLIENT_VERSION);\n     // Allowed to fail as this file IS missing on first startup.\n-    if (!est_filein.IsNull())\n-        ::feeEstimator.Read(est_filein);\n-    fFeeEstimatesInitialized = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485721671",
      "id" : 485721671,
      "in_reply_to_id" : 485543436,
      "line" : 1773,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcyMTY3MQ==",
      "original_commit_id" : "6e3313019010c27868da4925bf48d141c3e0208c",
      "original_line" : 1773,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 92,
      "pull_request_review_id" : 485153270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485721671",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485722181"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485722181"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can you move this line inside the constructor and avoid changing the signature of the constructor?",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T15:55:22Z",
      "diff_hunk" : "@@ -1356,15 +1344,27 @@ bool AppInitMain(const util::Ref& context, NodeContext& node, interfaces::BlockA\n     // is not yet setup and may end up being set up twice if we\n     // need to reindex later.\n \n+    // see Step 2: parameter interactions for more information about these\n+    fListen = args.GetBoolArg(\"-listen\", DEFAULT_LISTEN);\n+    fDiscover = args.GetBoolArg(\"-discover\", true);\n+    g_relay_txes = !args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY);\n+\n     assert(!node.banman);\n     node.banman = MakeUnique<BanMan>(GetDataDir() / \"banlist.dat\", &uiInterface, args.GetArg(\"-bantime\", DEFAULT_MISBEHAVING_BANTIME));\n     assert(!node.connman);\n     node.connman = MakeUnique<CConnman>(GetRand(std::numeric_limits<uint64_t>::max()), GetRand(std::numeric_limits<uint64_t>::max()), args.GetBoolArg(\"-networkactive\", true));\n \n+    // Don't initialize fee estimation with old data if we don't relay transactions,\n+    // as they would never get updated.\n+    if (g_relay_txes) {\n+        fs::path est_path = GetDataDir() / FEE_ESTIMATES_FILENAME;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485722181",
      "id" : 485722181,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcyMjE4MQ==",
      "original_commit_id" : "941806deef3224ae0e7548bc33abfd041b40730b",
      "original_line" : 1363,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 485153270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485722181",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485734447"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485734447"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thought it would be better to keep the filename constants in init ?..",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T16:09:50Z",
      "diff_hunk" : "@@ -1356,15 +1344,27 @@ bool AppInitMain(const util::Ref& context, NodeContext& node, interfaces::BlockA\n     // is not yet setup and may end up being set up twice if we\n     // need to reindex later.\n \n+    // see Step 2: parameter interactions for more information about these\n+    fListen = args.GetBoolArg(\"-listen\", DEFAULT_LISTEN);\n+    fDiscover = args.GetBoolArg(\"-discover\", true);\n+    g_relay_txes = !args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY);\n+\n     assert(!node.banman);\n     node.banman = MakeUnique<BanMan>(GetDataDir() / \"banlist.dat\", &uiInterface, args.GetArg(\"-bantime\", DEFAULT_MISBEHAVING_BANTIME));\n     assert(!node.connman);\n     node.connman = MakeUnique<CConnman>(GetRand(std::numeric_limits<uint64_t>::max()), GetRand(std::numeric_limits<uint64_t>::max()), args.GetBoolArg(\"-networkactive\", true));\n \n+    // Don't initialize fee estimation with old data if we don't relay transactions,\n+    // as they would never get updated.\n+    if (g_relay_txes) {\n+        fs::path est_path = GetDataDir() / FEE_ESTIMATES_FILENAME;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485734447",
      "id" : 485734447,
      "in_reply_to_id" : 485722181,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTczNDQ0Nw==",
      "original_commit_id" : "941806deef3224ae0e7548bc33abfd041b40730b",
      "original_line" : 1363,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 485179727,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485734447",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485741177"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485741177"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, i initially swapped the two calls to `reset()`, but as you prefer.",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T16:16:54Z",
      "diff_hunk" : "@@ -1768,10 +1774,9 @@ bool AppInitMain(const util::Ref& context, NodeContext& node, interfaces::BlockA\n     fs::path est_path = GetDataDir() / FEE_ESTIMATES_FILENAME;\n     CAutoFile est_filein(fsbridge::fopen(est_path, \"rb\"), SER_DISK, CLIENT_VERSION);\n     // Allowed to fail as this file IS missing on first startup.\n-    if (!est_filein.IsNull())\n-        ::feeEstimator.Read(est_filein);\n-    fFeeEstimatesInitialized = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485741177",
      "id" : 485741177,
      "in_reply_to_id" : 485543436,
      "line" : 1773,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc0MTE3Nw==",
      "original_commit_id" : "6e3313019010c27868da4925bf48d141c3e0208c",
      "original_line" : 1773,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 92,
      "pull_request_review_id" : 485185677,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485741177",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485748468"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485748468"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No need. If it's only used in policy/fees.cpp you can move the constant there.",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-09T16:25:16Z",
      "diff_hunk" : "@@ -1356,15 +1344,27 @@ bool AppInitMain(const util::Ref& context, NodeContext& node, interfaces::BlockA\n     // is not yet setup and may end up being set up twice if we\n     // need to reindex later.\n \n+    // see Step 2: parameter interactions for more information about these\n+    fListen = args.GetBoolArg(\"-listen\", DEFAULT_LISTEN);\n+    fDiscover = args.GetBoolArg(\"-discover\", true);\n+    g_relay_txes = !args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY);\n+\n     assert(!node.banman);\n     node.banman = MakeUnique<BanMan>(GetDataDir() / \"banlist.dat\", &uiInterface, args.GetArg(\"-bantime\", DEFAULT_MISBEHAVING_BANTIME));\n     assert(!node.connman);\n     node.connman = MakeUnique<CConnman>(GetRand(std::numeric_limits<uint64_t>::max()), GetRand(std::numeric_limits<uint64_t>::max()), args.GetBoolArg(\"-networkactive\", true));\n \n+    // Don't initialize fee estimation with old data if we don't relay transactions,\n+    // as they would never get updated.\n+    if (g_relay_txes) {\n+        fs::path est_path = GetDataDir() / FEE_ESTIMATES_FILENAME;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r485748468",
      "id" : 485748468,
      "in_reply_to_id" : 485722181,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc0ODQ2OA==",
      "original_commit_id" : "941806deef3224ae0e7548bc33abfd041b40730b",
      "original_line" : 1363,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 485192508,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485748468",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This is very confusing. In your latest branch you're now calling `FlushUnconfirmed()` twice, which is definitely a behaviour change. I don't think you need to change the dtor at all, or the interface for the ctor.\r\n\r\nSee https://github.com/jnewbery/bitcoin/tree/pr18766.1. The only thing that has to change is a new `flush()` function is added and some logic is moved inside the `CBlockPolicyEstimator` class.",
      "created_at" : "2020-09-10T09:47:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-690120291",
      "id" : 690120291,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MDEyMDI5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-10T09:47:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/690120291",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> This is very confusing. In your latest branch you're now calling FlushUnconfirmed() twice, which is definitely a behaviour change. I don't think you need to change the dtor at all, or the interface for the ctor.\r\n\r\nI pushed in a hurry yesterday, and noticed this afterwards. Will fix this and the rest as soon as possible, but want to take some time for that to avoid wasting your time (and potentially others' too) again by pushing half-baked patches. Coming back to it soon (:tm:)",
      "created_at" : "2020-09-10T10:42:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-690147319",
      "id" : 690147319,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MDE0NzMxOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-10T10:42:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/690147319",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r486319537"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486319537"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ok, done.",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-10T13:05:35Z",
      "diff_hunk" : "@@ -1356,15 +1344,27 @@ bool AppInitMain(const util::Ref& context, NodeContext& node, interfaces::BlockA\n     // is not yet setup and may end up being set up twice if we\n     // need to reindex later.\n \n+    // see Step 2: parameter interactions for more information about these\n+    fListen = args.GetBoolArg(\"-listen\", DEFAULT_LISTEN);\n+    fDiscover = args.GetBoolArg(\"-discover\", true);\n+    g_relay_txes = !args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY);\n+\n     assert(!node.banman);\n     node.banman = MakeUnique<BanMan>(GetDataDir() / \"banlist.dat\", &uiInterface, args.GetArg(\"-bantime\", DEFAULT_MISBEHAVING_BANTIME));\n     assert(!node.connman);\n     node.connman = MakeUnique<CConnman>(GetRand(std::numeric_limits<uint64_t>::max()), GetRand(std::numeric_limits<uint64_t>::max()), args.GetBoolArg(\"-networkactive\", true));\n \n+    // Don't initialize fee estimation with old data if we don't relay transactions,\n+    // as they would never get updated.\n+    if (g_relay_txes) {\n+        fs::path est_path = GetDataDir() / FEE_ESTIMATES_FILENAME;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r486319537",
      "id" : 486319537,
      "in_reply_to_id" : 485722181,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjMxOTUzNw==",
      "original_commit_id" : "941806deef3224ae0e7548bc33abfd041b40730b",
      "original_line" : 1363,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 485907719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:05:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486319537",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Ok, it should be in a reviewable state now. This:\r\n- Moves the fee estimator from a global to the node context.\r\n- Encapsulates the `fee_estimates.dat` logic in CBlockPolicyEstimator.\r\n- Avoid creating the fee estimator at all if we don't relay transactions.",
      "created_at" : "2020-09-10T13:10:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#issuecomment-690276791",
      "id" : 690276791,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18766",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MDI3Njc5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-10T13:10:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/690276791",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r486334984"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486334984"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why are you moving this to the destructor? Are we sure that nothing happens to the fee estimator's state between  https://github.com/bitcoin/bitcoin/pull/18766/files#diff-c865a8939105e6350a50af02766291b7R236 and https://github.com/bitcoin/bitcoin/pull/18766/files#diff-c865a8939105e6350a50af02766291b7R294?",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-10T13:27:23Z",
      "diff_hunk" : "@@ -504,10 +507,27 @@ CBlockPolicyEstimator::CBlockPolicyEstimator()\n     feeStats = std::unique_ptr<TxConfirmStats>(new TxConfirmStats(buckets, bucketMap, MED_BLOCK_PERIODS, MED_DECAY, MED_SCALE));\n     shortStats = std::unique_ptr<TxConfirmStats>(new TxConfirmStats(buckets, bucketMap, SHORT_BLOCK_PERIODS, SHORT_DECAY, SHORT_SCALE));\n     longStats = std::unique_ptr<TxConfirmStats>(new TxConfirmStats(buckets, bucketMap, LONG_BLOCK_PERIODS, LONG_DECAY, LONG_SCALE));\n+\n+    // If the fee estimation file is present, read recorded estimations\n+    fs::path est_filepath = GetDataDir() / FEE_ESTIMATES_FILENAME;\n+    if (est_filepath.empty()) return;\n+\n+    CAutoFile est_file(fsbridge::fopen(est_filepath, \"rb\"), SER_DISK, CLIENT_VERSION);\n+    if (est_file.IsNull() || !Read(est_file)) {\n+        LogPrintf(\"%s: Failed to read fee estimates from %s\\n\", __func__, est_filepath.string());\n+    }\n }\n \n CBlockPolicyEstimator::~CBlockPolicyEstimator()\n {\n+    // If the fee estimation file is present, record current estimations\n+    fs::path est_filepath = GetDataDir() / FEE_ESTIMATES_FILENAME;\n+    if (est_filepath.empty()) return;\n+\n+    CAutoFile est_file(fsbridge::fopen(est_filepath, \"wb\"), SER_DISK, CLIENT_VERSION);\n+    if (est_file.IsNull() || !Write(est_file)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r486334984",
      "id" : 486334984,
      "line" : 528,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjMzNDk4NA==",
      "original_commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "original_line" : 528,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : 39,
      "pull_request_review_id" : 485927978,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T13:27:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486334984",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r486415217"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486415217"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right. What do you think of instead exposing a `RecordEstimation()` method to the `CBlockPolicyEstimator` ?",
      "commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "created_at" : "2020-09-10T15:01:58Z",
      "diff_hunk" : "@@ -504,10 +507,27 @@ CBlockPolicyEstimator::CBlockPolicyEstimator()\n     feeStats = std::unique_ptr<TxConfirmStats>(new TxConfirmStats(buckets, bucketMap, MED_BLOCK_PERIODS, MED_DECAY, MED_SCALE));\n     shortStats = std::unique_ptr<TxConfirmStats>(new TxConfirmStats(buckets, bucketMap, SHORT_BLOCK_PERIODS, SHORT_DECAY, SHORT_SCALE));\n     longStats = std::unique_ptr<TxConfirmStats>(new TxConfirmStats(buckets, bucketMap, LONG_BLOCK_PERIODS, LONG_DECAY, LONG_SCALE));\n+\n+    // If the fee estimation file is present, read recorded estimations\n+    fs::path est_filepath = GetDataDir() / FEE_ESTIMATES_FILENAME;\n+    if (est_filepath.empty()) return;\n+\n+    CAutoFile est_file(fsbridge::fopen(est_filepath, \"rb\"), SER_DISK, CLIENT_VERSION);\n+    if (est_file.IsNull() || !Read(est_file)) {\n+        LogPrintf(\"%s: Failed to read fee estimates from %s\\n\", __func__, est_filepath.string());\n+    }\n }\n \n CBlockPolicyEstimator::~CBlockPolicyEstimator()\n {\n+    // If the fee estimation file is present, record current estimations\n+    fs::path est_filepath = GetDataDir() / FEE_ESTIMATES_FILENAME;\n+    if (est_filepath.empty()) return;\n+\n+    CAutoFile est_file(fsbridge::fopen(est_filepath, \"wb\"), SER_DISK, CLIENT_VERSION);\n+    if (est_file.IsNull() || !Write(est_file)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18766#discussion_r486415217",
      "id" : 486415217,
      "in_reply_to_id" : 486334984,
      "line" : 528,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQxNTIxNw==",
      "original_commit_id" : "d84b4b9d66c06361c40f033bee0a6ddbddd549a4",
      "original_line" : 528,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : 39,
      "pull_request_review_id" : 486030196,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18766",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-10T15:01:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/486415217",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   }
]
