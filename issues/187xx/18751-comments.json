[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414103517"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414103517"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't understand this.",
      "commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "created_at" : "2020-04-23T20:31:46Z",
      "diff_hunk" : "@@ -67,7 +67,17 @@\n  * Thread-safe.\n  */\n void GetRandBytes(unsigned char* buf, int num) noexcept;\n+/** Generate a random integer in the range [0..range). Precondition: range > 0 */\n uint64_t GetRand(uint64_t nMax) noexcept;\n+// The following GetRand*(std::chrono::*) MUST NOT be templated on the type of\n+// the duration to prevent unsafe use at the call site. If it was templated, it\n+// would be impossible for the compiler to select the right template. E.g.\n+// assuming that a GetRand<T> exists for all duration types, then `foo` will",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414103517",
      "id" : 414103517,
      "line" : 75,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEwMzUxNw==",
      "original_commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "original_line" : 75,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 9,
      "pull_request_review_id" : 399453431,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T20:31:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414103517",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414105697"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414105697"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh you mean because it would use the type of the input (hours) as precision, effectively, and then converted to microseconds afterwards?\r\n\r\nThat's a very roundabout way of describing the problem, and wouldn't apply to a `GetRandMicros` that always interpreted the input as microseconds.",
      "commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "created_at" : "2020-04-23T20:35:36Z",
      "diff_hunk" : "@@ -67,7 +67,17 @@\n  * Thread-safe.\n  */\n void GetRandBytes(unsigned char* buf, int num) noexcept;\n+/** Generate a random integer in the range [0..range). Precondition: range > 0 */\n uint64_t GetRand(uint64_t nMax) noexcept;\n+// The following GetRand*(std::chrono::*) MUST NOT be templated on the type of\n+// the duration to prevent unsafe use at the call site. If it was templated, it\n+// would be impossible for the compiler to select the right template. E.g.\n+// assuming that a GetRand<T> exists for all duration types, then `foo` will",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414105697",
      "id" : 414105697,
      "in_reply_to_id" : 414103517,
      "line" : 75,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEwNTY5Nw==",
      "original_commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "original_line" : 75,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 9,
      "pull_request_review_id" : 399455968,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T20:35:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414105697",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414109709"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414109709"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I don't understand this.\r\n\r\n\r\nHere is the code. I am happy to remove the sentence and replace it with code instead.\r\n\r\n```cpp\r\ntemplate <typename D>\r\nD GetRandDur(const D& duration_max)\r\n{\r\n    return D{GetRand(duration_max.count())};\r\n}\r\n\r\nBOOST_AUTO_TEST_CASE(util_time_GetRandTime)\r\n{\r\n    std::chrono::seconds rand_hour = GetRandDur(std::chrono::hours{1});\r\n    // Want seconds to be in range [0..1hour), but always get zero :((((\r\n    BOOST_CHECK_EQUAL(rand_hour.count(), 0);\r\n}\r\n\r\n",
      "commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "created_at" : "2020-04-23T20:41:59Z",
      "diff_hunk" : "@@ -67,7 +67,17 @@\n  * Thread-safe.\n  */\n void GetRandBytes(unsigned char* buf, int num) noexcept;\n+/** Generate a random integer in the range [0..range). Precondition: range > 0 */\n uint64_t GetRand(uint64_t nMax) noexcept;\n+// The following GetRand*(std::chrono::*) MUST NOT be templated on the type of\n+// the duration to prevent unsafe use at the call site. If it was templated, it\n+// would be impossible for the compiler to select the right template. E.g.\n+// assuming that a GetRand<T> exists for all duration types, then `foo` will",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414109709",
      "id" : 414109709,
      "in_reply_to_id" : 414103517,
      "line" : 75,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEwOTcwOQ==",
      "original_commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "original_line" : 75,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 9,
      "pull_request_review_id" : 399460302,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T20:44:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414109709",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414111751"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414111751"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> That's a very roundabout way of describing the problem, and wouldn't apply to a GetRandMicros that always interpreted the input as microseconds.\r\n\r\nYes, that is the reason why I added GetRandMicros in fa883ab35ad2d4328e35b1e855d0833740a6b910, but I forgot to add documentation back then.",
      "commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "created_at" : "2020-04-23T20:45:26Z",
      "diff_hunk" : "@@ -67,7 +67,17 @@\n  * Thread-safe.\n  */\n void GetRandBytes(unsigned char* buf, int num) noexcept;\n+/** Generate a random integer in the range [0..range). Precondition: range > 0 */\n uint64_t GetRand(uint64_t nMax) noexcept;\n+// The following GetRand*(std::chrono::*) MUST NOT be templated on the type of\n+// the duration to prevent unsafe use at the call site. If it was templated, it\n+// would be impossible for the compiler to select the right template. E.g.\n+// assuming that a GetRand<T> exists for all duration types, then `foo` will",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414111751",
      "id" : 414111751,
      "in_reply_to_id" : 414103517,
      "line" : 75,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDExMTc1MQ==",
      "original_commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "original_line" : 75,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 9,
      "pull_request_review_id" : 399462615,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T20:45:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414111751",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414130756"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414130756"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, I understand now. You mean templatizing to avoid the \"Micros\" in the function name (and implicitly pass the resolution of the result that).\r\n\r\nThere's a rather crazy way to work around that:\r\n\r\n```c++\r\ntemplate<typename In, typename OutRep = typename In::rep, typename OutPeriod = typename In::period>\r\nstd::chrono::duration<OutRep, OutPeriod> GetRand(std::chrono::duration<OutRep, OutPeriod> arg) {\r\n    return arg;\r\n}\r\n```\r\nThat's a GetRand that only applies to durations, but you still always have to explicitly state the resolution you want (e.g. `GetRand<std::chrono::milliseconds>(SOME_CONSTANT_OF_TYPE_CHRONO_HOURS)` will work as expected; `GetRand(...)` won't compile).",
      "commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "created_at" : "2020-04-23T21:17:48Z",
      "diff_hunk" : "@@ -67,7 +67,17 @@\n  * Thread-safe.\n  */\n void GetRandBytes(unsigned char* buf, int num) noexcept;\n+/** Generate a random integer in the range [0..range). Precondition: range > 0 */\n uint64_t GetRand(uint64_t nMax) noexcept;\n+// The following GetRand*(std::chrono::*) MUST NOT be templated on the type of\n+// the duration to prevent unsafe use at the call site. If it was templated, it\n+// would be impossible for the compiler to select the right template. E.g.\n+// assuming that a GetRand<T> exists for all duration types, then `foo` will",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414130756",
      "id" : 414130756,
      "in_reply_to_id" : 414103517,
      "line" : 75,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEzMDc1Ng==",
      "original_commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "original_line" : 75,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 9,
      "pull_request_review_id" : 399483897,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:17:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414130756",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414132382"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414132382"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I doubt that's more appealing than just GetRandMicros, GetRandMillis, ... functions, though.",
      "commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "created_at" : "2020-04-23T21:20:45Z",
      "diff_hunk" : "@@ -67,7 +67,17 @@\n  * Thread-safe.\n  */\n void GetRandBytes(unsigned char* buf, int num) noexcept;\n+/** Generate a random integer in the range [0..range). Precondition: range > 0 */\n uint64_t GetRand(uint64_t nMax) noexcept;\n+// The following GetRand*(std::chrono::*) MUST NOT be templated on the type of\n+// the duration to prevent unsafe use at the call site. If it was templated, it\n+// would be impossible for the compiler to select the right template. E.g.\n+// assuming that a GetRand<T> exists for all duration types, then `foo` will",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414132382",
      "id" : 414132382,
      "in_reply_to_id" : 414103517,
      "line" : 75,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEzMjM4Mg==",
      "original_commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "original_line" : 75,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 9,
      "pull_request_review_id" : 399485719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:20:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414132382",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414819576"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414819576"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "My knowledge is pretty limited, but maybe I can make a suggestion for clearer wording?\r\n\r\nIt seems like the issue is that, if `GetRand*(std::chrono::*)` is templated with this implementation, the `max_duration`'s count() is used as-is instead of converting between the argument type and return type like we would expect it to. Instead, the conversion happens at the end. In simple terms, the `std::chrono` types won't convert nicely which means we lose precision if we want random small units of time over the duration of a large unit of time (which I'm guessing is a common use case). For example, when you try to get random seconds over the duration of 1 hour, the only return value you can get is 0 hours = 0 seconds.\r\n\r\nOther example: `std::chrono::seconds rand_seconds = GetRandDur(std::chrono::hours{4});` can return non-zero values, but only at the precision of hours (i.e. 0, 3600, 7200, or 10800 seconds). \r\n\r\nIf you were to make a template, it only necessarily works as intended if you pass in a `max_duration` of strictly the same type (or @sipa's workaround).",
      "commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "created_at" : "2020-04-24T19:42:30Z",
      "diff_hunk" : "@@ -67,7 +67,17 @@\n  * Thread-safe.\n  */\n void GetRandBytes(unsigned char* buf, int num) noexcept;\n+/** Generate a random integer in the range [0..range). Precondition: range > 0 */\n uint64_t GetRand(uint64_t nMax) noexcept;\n+// The following GetRand*(std::chrono::*) MUST NOT be templated on the type of\n+// the duration to prevent unsafe use at the call site. If it was templated, it",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414819576",
      "id" : 414819576,
      "line" : 73,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxOTU3Ng==",
      "original_commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "original_line" : 73,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 7,
      "pull_request_review_id" : 400223405,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-24T19:53:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414819576",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/gzhao408/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gzhao408/followers",
         "following_url" : "https://api.github.com/users/gzhao408/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gzhao408/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gzhao408",
         "id" : 25183001,
         "login" : "gzhao408",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/gzhao408/orgs",
         "received_events_url" : "https://api.github.com/users/gzhao408/received_events",
         "repos_url" : "https://api.github.com/users/gzhao408/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gzhao408/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gzhao408/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gzhao408"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414833700"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414833700"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think this is true? its just random in relation to the duration type of the input. \r\n\r\neg. `std::chrono::seconds foo = GetRand(std::chrono::hours{5})`\r\nmight return 3600, 7200, 10800 etc.",
      "commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "created_at" : "2020-04-24T20:09:04Z",
      "diff_hunk" : "@@ -67,7 +67,17 @@\n  * Thread-safe.\n  */\n void GetRandBytes(unsigned char* buf, int num) noexcept;\n+/** Generate a random integer in the range [0..range). Precondition: range > 0 */\n uint64_t GetRand(uint64_t nMax) noexcept;\n+// The following GetRand*(std::chrono::*) MUST NOT be templated on the type of\n+// the duration to prevent unsafe use at the call site. If it was templated, it\n+// would be impossible for the compiler to select the right template. E.g.\n+// assuming that a GetRand<T> exists for all duration types, then `foo` will\n+// always be set to a constant, not a random duration.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414833700",
      "id" : 414833700,
      "line" : 76,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzMzcwMA==",
      "original_commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "original_line" : 76,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 10,
      "pull_request_review_id" : 400238797,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-24T20:15:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414833700",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414836790"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414836790"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "is it impossible, or does the compiler just select template duration of param thats passed & then tries to convert afterwards? \r\n\r\nseems that way to me because `std::chrono::seconds val = GetRandDur(std::chrono::hours)` gives a type conversion error",
      "commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "created_at" : "2020-04-24T20:15:11Z",
      "diff_hunk" : "@@ -67,7 +67,17 @@\n  * Thread-safe.\n  */\n void GetRandBytes(unsigned char* buf, int num) noexcept;\n+/** Generate a random integer in the range [0..range). Precondition: range > 0 */\n uint64_t GetRand(uint64_t nMax) noexcept;\n+// The following GetRand*(std::chrono::*) MUST NOT be templated on the type of\n+// the duration to prevent unsafe use at the call site. If it was templated, it\n+// would be impossible for the compiler to select the right template. E.g.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414836790",
      "id" : 414836790,
      "line" : 74,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzNjc5MA==",
      "original_commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "original_line" : 74,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 8,
      "pull_request_review_id" : 400238797,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-24T20:15:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414836790",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414856381"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414856381"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No it doesn't give a type conversion error.\r\n\r\nThis compiles fine for me and the test pass:\r\n\r\n```cpp\r\ntemplate <typename D>\r\nD GetRandDur(const D& duration_max)\r\n{\r\n    return D{GetRand(duration_max.count())};\r\n}\r\n\r\nBOOST_AUTO_TEST_CASE(util_time_GetRandTime)\r\n{\r\n    std::chrono::seconds rand_hour = GetRandDur(std::chrono::hours{1});\r\n    // Want seconds to be in range [0..1hour), but always get zero :((((\r\n    BOOST_CHECK_EQUAL(rand_hour.count(), 0);\r\n}",
      "commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "created_at" : "2020-04-24T20:53:14Z",
      "diff_hunk" : "@@ -67,7 +67,17 @@\n  * Thread-safe.\n  */\n void GetRandBytes(unsigned char* buf, int num) noexcept;\n+/** Generate a random integer in the range [0..range). Precondition: range > 0 */\n uint64_t GetRand(uint64_t nMax) noexcept;\n+// The following GetRand*(std::chrono::*) MUST NOT be templated on the type of\n+// the duration to prevent unsafe use at the call site. If it was templated, it\n+// would be impossible for the compiler to select the right template. E.g.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414856381",
      "id" : 414856381,
      "in_reply_to_id" : 414836790,
      "line" : 74,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg1NjM4MQ==",
      "original_commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "original_line" : 74,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 8,
      "pull_request_review_id" : 400263471,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-24T20:53:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414856381",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414856628"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414856628"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any suggestions to improve the wording? Something with \"quantized\", maybe?",
      "commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "created_at" : "2020-04-24T20:53:42Z",
      "diff_hunk" : "@@ -67,7 +67,17 @@\n  * Thread-safe.\n  */\n void GetRandBytes(unsigned char* buf, int num) noexcept;\n+/** Generate a random integer in the range [0..range). Precondition: range > 0 */\n uint64_t GetRand(uint64_t nMax) noexcept;\n+// The following GetRand*(std::chrono::*) MUST NOT be templated on the type of\n+// the duration to prevent unsafe use at the call site. If it was templated, it\n+// would be impossible for the compiler to select the right template. E.g.\n+// assuming that a GetRand<T> exists for all duration types, then `foo` will\n+// always be set to a constant, not a random duration.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18751#discussion_r414856628",
      "id" : 414856628,
      "in_reply_to_id" : 414833700,
      "line" : 76,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg1NjYyOA==",
      "original_commit_id" : "333393d96dff6c05831d09bc5d9bc2b2c3754ea8",
      "original_line" : 76,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 10,
      "pull_request_review_id" : 400263724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18751",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-24T20:53:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414856628",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
