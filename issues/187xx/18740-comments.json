[
   {
      "author_association" : "MEMBER",
      "body" : "> Instead [...] void*, which isn't type safe, it uses a small new util::Ref \r\n\r\nWhy not `NodeContext*`? That might seem like a layer violation reading the source code, but practically it does the same and the diff would be smaller.",
      "created_at" : "2020-04-22T16:26:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18740#issuecomment-617885783",
      "id" : 617885783,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18740",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNzg4NTc4Mw==",
      "updated_at" : "2020-04-22T16:26:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/617885783",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > Instead [...] void*, which isn't type safe, it uses a small new util::Ref\r\n> \r\n> Why not `NodeContext*`? That might seem like a layer violation reading the source code, but practically it does the same and the diff would be smaller.\r\n\r\nThis would allow only allow dropping the first commit. The later commits would look basically the same but with `s/util::Ref/NodeContext/`.\r\n\r\nThe practical reason I don't want to do this is I want to the be able to use the RPC server outside the node process. E.g. start a multiprocess wallet process and have it listen for wallet RPC requests. Maybe add more offline wallet support and be able to have wallet-tool respond to RPCs like `listtransactions`. In these cases, wallet code can't link against `src/node/context.cpp` and `NodeContext` is useless for passing wallet state (aside from just looking strange).\r\n\r\nAlso, RPC code in rpc/server and httprpc is mostly pretty generic and not bitcoin specific and personally I think it would be a shame to see bitcoin types leak into it.",
      "created_at" : "2020-04-22T16:49:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18740#issuecomment-617899166",
      "id" : 617899166,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18740",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNzg5OTE2Ng==",
      "updated_at" : "2020-04-22T16:49:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/617899166",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "From https://github.com/bitcoin/bitcoin/pull/18647#issuecomment-614059391\r\n\r\n> Wallet RPC methods shouldn't have access to NodeContext. At some point we should have WalletContext struct that will hold things like vpwallets and let us get rid of wallet globals, and it would make sense for wallet RPC methods to have access to this. That is why suggestion from #17548 was to just add a new member to JSONRPCRequest that could hold a generic context, not something tied to the wallet or node. Other advantage of using JSONRPCRequest is that you dont' have to change RPC method signatures.\r\n\r\nHow would you implement this? Make context a `map<string, any>`? And do `context[\"node\"].Has<NodeContext>()`?",
      "created_at" : "2020-04-22T17:05:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18740#issuecomment-617907818",
      "id" : 617907818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18740",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNzkwNzgxOA==",
      "updated_at" : "2020-04-22T17:06:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/617907818",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nVery happy to see `g_rpc_node` go!\r\n\r\nThanks for the great architectural work you are doing.",
      "created_at" : "2020-04-22T17:30:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18740#issuecomment-617921683",
      "id" : 617921683,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18740",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNzkyMTY4Mw==",
      "updated_at" : "2020-04-22T17:30:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/617921683",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> How would you implement this? Make context a `map<string, any>`? And do `context[\"node\"].Has<NodeContext>()`?\r\n\r\nNo need for multiple contexts in the same request. `interfaces::WalletClientImpl` can just pass an different context to wallet RPC methods. Passing an `interfaces::Chain` reference would be sufficient enough for `loadwallet` / `createwallet`. But I actually want to introduce a `WalletContext` struct in `src/wallet/context.h` analagous to the `NodeContext` struct in `src/node/context.h` which would hold things like the `Chain` interface pointer and `vpwallets` vector.",
      "created_at" : "2020-04-22T17:48:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18740#issuecomment-617931527",
      "id" : 617931527,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18740",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNzkzMTUyNw==",
      "updated_at" : "2020-04-22T17:54:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/617931527",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Actually @promag, it is a little clumsier than I thought. I should change this PR to pass context to rpc method register calls instead of the StartHTTPRPC call to make this more future-proof (should still be an improvement as is)",
      "created_at" : "2020-04-22T17:58:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18740#issuecomment-617936446",
      "id" : 617936446,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18740",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNzkzNjQ0Ng==",
      "updated_at" : "2020-04-22T17:58:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/617936446",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18699 (wallet: Avoid translating RPC errors by MarcoFalke)\n* #18698 (Make g_chainman internal to validation by MarcoFalke)\n* #18671 (wallet: Add BlockUntilSyncedToCurrentChain to dumpwallet by MarcoFalke)\n* #17356 (RPC: Internal named params by luke-jr)\n* #16224 (gui: Bilingual GUI error messages by hebasto)\n* #12674 (RPC: Support addnode onetry without making the connection priviliged by luke-jr)\n* #10102 ([experimental] Multiprocess bitcoin by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-04-22T19:37:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18740#issuecomment-617992041",
      "id" : 617992041,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18740",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNzk5MjA0MQ==",
      "updated_at" : "2020-04-22T19:37:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/617992041",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18740#discussion_r413428813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413428813"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Have you considered `EnsureNodeContext(const JSONRPCRequest& req)` instead? Same for `EnsureMemPool`. Could avoid forward declaration above.",
      "commit_id" : "41d5d651594c6c939add7a58b7e30c97dccdf24a",
      "created_at" : "2020-04-23T00:45:41Z",
      "diff_hunk" : "@@ -47,11 +50,7 @@ UniValue blockheaderToJSON(const CBlockIndex* tip, const CBlockIndex* blockindex\n /** Used by getblockstats to get feerates at different percentiles by weight  */\n void CalculatePercentilesByWeight(CAmount result[NUM_GETBLOCKSTATS_PERCENTILES], std::vector<std::pair<CAmount, int64_t>>& scores, int64_t total_weight);\n \n-//! Pointer to node state that needs to be declared as a global to be accessible\n-//! RPC methods. Due to limitations of the RPC framework, there's currently no\n-//! direct way to pass in state to RPC methods without globals.\n-extern NodeContext* g_rpc_node;\n-\n-CTxMemPool& EnsureMemPool();\n+NodeContext& EnsureNodeContext(const util::Ref& context);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18740#discussion_r413428813",
      "id" : 413428813,
      "line" : 53,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQyODgxMw==",
      "original_commit_id" : "fe333744b72c11030e5a06e904ba44cea167117b",
      "original_line" : 53,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.h",
      "position" : 20,
      "pull_request_review_id" : 398685773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18740",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-24T17:43:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413428813",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-04-23T02:45:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18740#issuecomment-618144500",
      "id" : 618144500,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18740",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxODE0NDUwMA==",
      "updated_at" : "2020-04-23T02:45:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618144500",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18740#discussion_r414772851"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414772851"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Heh, nice find. Maybe split this up as a separate pull request, since it seems unrelated to the changes here?",
      "commit_id" : "41d5d651594c6c939add7a58b7e30c97dccdf24a",
      "created_at" : "2020-04-24T18:18:37Z",
      "diff_hunk" : "@@ -610,7 +610,7 @@ static bool rest_blockhash_by_height(const util::Ref& context, HTTPRequest* req,\n     std::string height_str;\n     const RetFormat rf = ParseDataFormat(height_str, str_uri_part);\n \n-    int32_t blockheight;\n+    int32_t blockheight = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18740#discussion_r414772851",
      "id" : 414772851,
      "line" : 613,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3Mjg1MQ==",
      "original_commit_id" : "41d5d651594c6c939add7a58b7e30c97dccdf24a",
      "original_line" : 613,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 136,
      "pull_request_review_id" : 400171951,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18740",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-24T18:18:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414772851",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
