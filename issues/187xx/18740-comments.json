[
   {
      "author_association" : "MEMBER",
      "body" : "> Instead [...] void*, which isn't type safe, it uses a small new util::Ref \r\n\r\nWhy not `NodeContext*`? That might seem like a layer violation reading the source code, but practically it does the same and the diff would be smaller.",
      "created_at" : "2020-04-22T16:26:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18740#issuecomment-617885783",
      "id" : 617885783,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18740",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNzg4NTc4Mw==",
      "updated_at" : "2020-04-22T16:26:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/617885783",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > Instead [...] void*, which isn't type safe, it uses a small new util::Ref\r\n> \r\n> Why not `NodeContext*`? That might seem like a layer violation reading the source code, but practically it does the same and the diff would be smaller.\r\n\r\nThis would allow only allow dropping the first commit. The later commits would look basically the same but with `s/util::Ref/NodeContext/`.\r\n\r\nThe practical reason I don't want to do this is I want to the be able to use the RPC server outside the node process. E.g. start a multiprocess wallet process and have it listen for wallet RPC requests. Maybe add more offline wallet support and be able to have wallet-tool respond to RPCs like `listtransactions`. In these cases, wallet code can't link against `src/node/context.cpp` and `NodeContext` is useless for passing wallet state (aside from just looking strange).\r\n\r\nAlso, RPC code in rpc/server and httprpc is mostly pretty generic and not bitcoin specific and personally I think it would be a shame to see bitcoin types leak into it.",
      "created_at" : "2020-04-22T16:49:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18740#issuecomment-617899166",
      "id" : 617899166,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18740",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNzg5OTE2Ng==",
      "updated_at" : "2020-04-22T16:49:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/617899166",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "From https://github.com/bitcoin/bitcoin/pull/18647#issuecomment-614059391\r\n\r\n> Wallet RPC methods shouldn't have access to NodeContext. At some point we should have WalletContext struct that will hold things like vpwallets and let us get rid of wallet globals, and it would make sense for wallet RPC methods to have access to this. That is why suggestion from #17548 was to just add a new member to JSONRPCRequest that could hold a generic context, not something tied to the wallet or node. Other advantage of using JSONRPCRequest is that you dont' have to change RPC method signatures.\r\n\r\nHow would you implement this? Make context a `map<string, any>`? And do `context[\"node\"].Has<NodeContext>()`?",
      "created_at" : "2020-04-22T17:05:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18740#issuecomment-617907818",
      "id" : 617907818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18740",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNzkwNzgxOA==",
      "updated_at" : "2020-04-22T17:06:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/617907818",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nVery happy to see `g_rpc_node` go!\r\n\r\nThanks for the great architectural work you are doing.",
      "created_at" : "2020-04-22T17:30:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18740#issuecomment-617921683",
      "id" : 617921683,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18740",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNzkyMTY4Mw==",
      "updated_at" : "2020-04-22T17:30:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/617921683",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> How would you implement this? Make context a `map<string, any>`? And do `context[\"node\"].Has<NodeContext>()`?\r\n\r\nNo need for multiple contexts in the same request. `interfaces::WalletClientImpl` can just pass an different context to wallet RPC methods. Passing an `interfaces::Chain` reference would be sufficient enough for `loadwallet` / `createwallet`. But I actually want to introduce a `WalletContext` struct in `src/wallet/context.h` analagous to the `NodeContext` struct in `src/node/context.h` which would hold things like the `Chain` interface pointer and `vpwallets` vector.",
      "created_at" : "2020-04-22T17:48:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18740#issuecomment-617931527",
      "id" : 617931527,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18740",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNzkzMTUyNw==",
      "updated_at" : "2020-04-22T17:54:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/617931527",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Actually @promag, it is a little clumsier than I thought. I should change this PR to pass context to rpc method register calls instead of the StartHTTPRPC call to make this more future-proof (should still be an improvement as is)",
      "created_at" : "2020-04-22T17:58:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18740#issuecomment-617936446",
      "id" : 617936446,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18740",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNzkzNjQ0Ng==",
      "updated_at" : "2020-04-22T17:58:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/617936446",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
