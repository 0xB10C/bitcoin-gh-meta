{
   "assignee" : null,
   "assignees" : [],
   "body" : "Instead of using a 100ms sleep in the condition variable, this changes\r\n it to sleep for 100ms after the loop started, so if the loop takes a\r\n long time (e.g. due to waiting on the vnodes lock at the end) it will\r\n restart sooner.\r\n\r\nThis also makes the failure to obtain the send/recv locks skip the sleep.\r\n\r\nAlso avoids a potential 100ms delay before announcing a new block that\r\n arrived via submitblock, prevents delays in processing messages for\r\n early peers when they arrive part way through the message handler loop,\r\n and reruns the message handler when some peers don't finish sendmessages\r\n due to contention for cs_main.\r\n\r\nThe final commit  changes the message handling to only hold cs_vRecvMsg long enough to move out the message. This speeds up IBD up to 200k from a single peer over GbE compared to master by about 200%, by eliminating cs_vRecvMsg contention (that the prior commits happened to also make worse).",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 8,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9415/comments",
   "created_at" : "2016-12-23T22:17:13Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9415/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/9415",
   "id" : 197432325,
   "labels" : [
      {
         "color" : "006b75",
         "default" : false,
         "id" : 98298007,
         "name" : "P2P",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9415/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 9415,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/9415.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9415",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/9415.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9415"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Reduce latency of ThreadMessageHandler.",
   "updated_at" : "2016-12-29T09:30:37Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9415",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
      "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
      "followers_url" : "https://api.github.com/users/gmaxwell/followers",
      "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/gmaxwell",
      "id" : 858454,
      "login" : "gmaxwell",
      "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
      "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
      "repos_url" : "https://api.github.com/users/gmaxwell/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/gmaxwell"
   }
}
