[
   {
      "body" : "Is it still the case that the first peer to send us the header is the only peer we'll request the block from (with a timeout for non-response of 10 minutes)? ",
      "created_at" : "2016-12-21T16:18:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9400#issuecomment-268564171",
      "id" : 268564171,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9400",
      "updated_at" : "2016-12-21T16:18:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268564171",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "@rebroad This code doesn't change any inv behavior.",
      "created_at" : "2016-12-21T16:21:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9400#issuecomment-268565152",
      "id" : 268565152,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9400",
      "updated_at" : "2016-12-21T16:21:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268565152",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9400#discussion_r93580736"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9400"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93580736"
         }
      },
      "body" : "nit: maybe move the State() check inside MaybeSet...?",
      "commit_id" : "ee43109e6378c13ee5dff65053419daf2106f888",
      "created_at" : "2016-12-22T08:12:13Z",
      "diff_hunk" : "@@ -798,6 +803,11 @@ void PeerLogicValidation::BlockChecked(const CBlock& block, const CValidationSta\n                 Misbehaving(it->second.first, nDoS);\n         }\n     }\n+    else if (state.IsValid() && !IsInitialBlockDownload()) {\n+        if (it != mapBlockSource.end() && State(it->second.first)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9400#discussion_r93580736",
      "id" : 93580736,
      "original_commit_id" : "ee43109e6378c13ee5dff65053419daf2106f888",
      "original_position" : 61,
      "path" : "src/net_processing.cpp",
      "position" : 61,
      "pull_request_review_id" : 14110519,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9400",
      "updated_at" : "2016-12-22T08:27:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93580736",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9400#discussion_r93582234"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9400"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93582234"
         }
      },
      "body" : "Ideally this would go in UpdatedBlockTip instead. mapBlockSource wouldn't be available there, but BlockChecked isnt really capturing where we want this - we want to know that this is actually the best currently available block, not just a block that was just checked.\r\n\r\nNot really sure how to fix this - maybe just a mapBlocksInFlight.empty() is sufficient, but its still super ugly.",
      "commit_id" : "ee43109e6378c13ee5dff65053419daf2106f888",
      "created_at" : "2016-12-22T08:27:37Z",
      "diff_hunk" : "@@ -798,6 +803,11 @@ void PeerLogicValidation::BlockChecked(const CBlock& block, const CValidationSta\n                 Misbehaving(it->second.first, nDoS);\n         }\n     }\n+    else if (state.IsValid() && !IsInitialBlockDownload()) {\n+        if (it != mapBlockSource.end() && State(it->second.first)) {\n+            MaybeSetPeerAsAnnouncingHeaderAndIDs(it->second.first, *connman);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9400#discussion_r93582234",
      "id" : 93582234,
      "original_commit_id" : "ee43109e6378c13ee5dff65053419daf2106f888",
      "original_position" : 62,
      "path" : "src/net_processing.cpp",
      "position" : 62,
      "pull_request_review_id" : 14110519,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9400",
      "updated_at" : "2016-12-22T08:27:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93582234",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "On second thought, I suppose I could be convinced that using BlockChecked here was OK if there were very explicit documentation on when it is/isn't called in validationinterface.h and maybe some flags passed in to further disambiguate.\n\nOn December 21, 2016 8:22:02 AM PST, Gregory Sanders <notifications@github.com> wrote:\n>@rebroad This code doesn't change any inv behavior.\n>\n>-- \n>You are receiving this because you are subscribed to this thread.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/9400#issuecomment-268565152\n",
      "created_at" : "2016-12-22T08:54:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9400#issuecomment-268750400",
      "id" : 268750400,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9400",
      "updated_at" : "2016-12-22T08:54:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268750400",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9400#discussion_r93626388"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9400"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93626388"
         }
      },
      "body" : "Could we change the lifetime of mapBlockSource to keep it around until then? We could sweep it later.",
      "commit_id" : "ee43109e6378c13ee5dff65053419daf2106f888",
      "created_at" : "2016-12-22T13:53:36Z",
      "diff_hunk" : "@@ -798,6 +803,11 @@ void PeerLogicValidation::BlockChecked(const CBlock& block, const CValidationSta\n                 Misbehaving(it->second.first, nDoS);\n         }\n     }\n+    else if (state.IsValid() && !IsInitialBlockDownload()) {\n+        if (it != mapBlockSource.end() && State(it->second.first)) {\n+            MaybeSetPeerAsAnnouncingHeaderAndIDs(it->second.first, *connman);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9400#discussion_r93626388",
      "id" : 93626388,
      "original_commit_id" : "ee43109e6378c13ee5dff65053419daf2106f888",
      "original_position" : 62,
      "path" : "src/net_processing.cpp",
      "position" : 62,
      "pull_request_review_id" : 14158041,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9400",
      "updated_at" : "2016-12-22T13:53:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93626388",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   }
]
