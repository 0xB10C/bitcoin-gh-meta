[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9495#discussion_r95195260"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9495"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95195260"
         }
      },
      "body" : "Can you do this as a unique_lock field inside CCheckQueueControl (so we don't need to rely on an explicit destructor to be correct)?",
      "commit_id" : "2a58f73601ad36d0531fe9e69e1affd9229d8b96",
      "created_at" : "2017-01-09T16:49:18Z",
      "diff_hunk" : "@@ -185,8 +182,7 @@ class CCheckQueueControl\n     {\n         // passed queue is supposed to be unused, or NULL\n         if (pqueue != NULL) {\n-            bool isIdle = pqueue->IsIdle();\n-            assert(isIdle);\n+            ENTER_CRITICAL_SECTION(pqueue->ControlMutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9495#discussion_r95195260",
      "id" : 95195260,
      "original_commit_id" : "958ee1d3d844d1f2f07b271ad7ed9bb117e5a766",
      "original_position" : 29,
      "path" : "src/checkqueue.h",
      "position" : null,
      "pull_request_review_id" : 15742308,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9495",
      "updated_at" : "2017-01-11T22:24:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95195260",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9495#discussion_r95196950"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9495"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95196950"
         }
      },
      "body" : "Unfortunately this is the \"easiest\" way to take care of this given that we want debug order & the CMutex class has no default constructor/moveable semantics. Certainly can be fixed to RAII easily later.",
      "commit_id" : "2a58f73601ad36d0531fe9e69e1affd9229d8b96",
      "created_at" : "2017-01-09T16:56:54Z",
      "diff_hunk" : "@@ -185,8 +182,7 @@ class CCheckQueueControl\n     {\n         // passed queue is supposed to be unused, or NULL\n         if (pqueue != NULL) {\n-            bool isIdle = pqueue->IsIdle();\n-            assert(isIdle);\n+            ENTER_CRITICAL_SECTION(pqueue->ControlMutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9495#discussion_r95196950",
      "id" : 95196950,
      "original_commit_id" : "958ee1d3d844d1f2f07b271ad7ed9bb117e5a766",
      "original_position" : 29,
      "path" : "src/checkqueue.h",
      "position" : null,
      "pull_request_review_id" : 15744116,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9495",
      "updated_at" : "2017-01-11T22:24:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95196950",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9495#discussion_r95197559"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9495"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95197559"
         }
      },
      "body" : "Understood. Let's improve that in a separate PR later.",
      "commit_id" : "2a58f73601ad36d0531fe9e69e1affd9229d8b96",
      "created_at" : "2017-01-09T16:59:44Z",
      "diff_hunk" : "@@ -185,8 +182,7 @@ class CCheckQueueControl\n     {\n         // passed queue is supposed to be unused, or NULL\n         if (pqueue != NULL) {\n-            bool isIdle = pqueue->IsIdle();\n-            assert(isIdle);\n+            ENTER_CRITICAL_SECTION(pqueue->ControlMutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9495#discussion_r95197559",
      "id" : 95197559,
      "original_commit_id" : "958ee1d3d844d1f2f07b271ad7ed9bb117e5a766",
      "original_position" : 29,
      "path" : "src/checkqueue.h",
      "position" : null,
      "pull_request_review_id" : 15744774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9495",
      "updated_at" : "2017-01-11T22:24:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95197559",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9495#discussion_r95692510"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9495"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95692510"
         }
      },
      "body" : "Nit: I think you can drop the `<T>`",
      "commit_id" : "2a58f73601ad36d0531fe9e69e1affd9229d8b96",
      "created_at" : "2017-01-11T23:01:08Z",
      "diff_hunk" : "@@ -174,16 +174,19 @@ template <typename T>\n class CCheckQueueControl\n {\n private:\n-    CCheckQueue<T>* pqueue;\n+    CCheckQueue<T> * const pqueue;\n     bool fDone;\n \n public:\n-    CCheckQueueControl(CCheckQueue<T>* pqueueIn) : pqueue(pqueueIn), fDone(false)\n-    {\n-        // passed queue is supposed to be unused, or NULL\n-        if (pqueue != NULL) {\n-            ENTER_CRITICAL_SECTION(pqueue->ControlMutex);\n-        }\n+\tCCheckQueueControl<T>() = delete;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9495#discussion_r95692510",
      "id" : 95692510,
      "original_commit_id" : "2a58f73601ad36d0531fe9e69e1affd9229d8b96",
      "original_position" : 15,
      "path" : "src/checkqueue.h",
      "position" : null,
      "pull_request_review_id" : 16257013,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9495",
      "updated_at" : "2017-01-11T23:01:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95692510",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
