[
   {
      "body" : "What about \"rewriting\" the current python2 zmq example instead of creating a new one for python3? I don't think we need a python2 example.",
      "created_at" : "2017-01-07T12:45:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9485#issuecomment-271081796",
      "id" : 271081796,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9485",
      "updated_at" : "2017-01-07T12:45:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/271081796",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "For nearly a decade people have been \"avoiding\" upgrading to python 3.  I don't know what's wrong with these people.  They should probably see a psychologist and get a friendly lobotomy.\r\n\r\nObviously I think python3 and asyncio is the \"right way\" to do anything.  It has all the advantages of javascript's asynchronicity and event loop while not being a totally brain-dead language.\r\n\r\nTL;DR I'd be very happy to replace the current example with this python3 one...but people who need friendly lobotomies will complain.",
      "created_at" : "2017-01-07T13:18:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9485#issuecomment-271083354",
      "id" : 271083354,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9485",
      "updated_at" : "2017-01-07T13:18:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/271083354",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1746780?v=3",
         "events_url" : "https://api.github.com/users/mcelrath/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mcelrath/followers",
         "following_url" : "https://api.github.com/users/mcelrath/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mcelrath/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mcelrath",
         "id" : 1746780,
         "login" : "mcelrath",
         "organizations_url" : "https://api.github.com/users/mcelrath/orgs",
         "received_events_url" : "https://api.github.com/users/mcelrath/received_events",
         "repos_url" : "https://api.github.com/users/mcelrath/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mcelrath/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mcelrath/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mcelrath"
      }
   },
   {
      "body" : "Maybe mention that the old version can still be retrieved from git history?",
      "created_at" : "2017-01-07T14:02:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9485#issuecomment-271085520",
      "id" : 271085520,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9485",
      "updated_at" : "2017-01-07T14:02:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/271085520",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "Agree with re-writing to use Python3, I don't think we need to keep examples for both in the repo.",
      "created_at" : "2017-01-08T11:43:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9485#issuecomment-271145840",
      "id" : 271145840,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9485",
      "updated_at" : "2017-01-08T11:43:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/271145840",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=3",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "body" : "Agreed that a Python3 version is preferable. Python2 support for ZMQ libraries > 3 is uncertain and attempts to script for both Py2 and Py3 will run into incompatibilities of hex encoding, as well as pickle protocol limitations in Py2's pyzmq module.",
      "created_at" : "2017-01-08T12:22:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9485#issuecomment-271147654",
      "id" : 271147654,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9485",
      "updated_at" : "2017-01-08T12:22:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/271147654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6916056?v=3",
         "events_url" : "https://api.github.com/users/venzen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/venzen/followers",
         "following_url" : "https://api.github.com/users/venzen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/venzen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/venzen",
         "id" : 6916056,
         "login" : "venzen",
         "organizations_url" : "https://api.github.com/users/venzen/orgs",
         "received_events_url" : "https://api.github.com/users/venzen/received_events",
         "repos_url" : "https://api.github.com/users/venzen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/venzen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/venzen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/venzen"
      }
   },
   {
      "body" : "Since everyone here likes python3, I replaced the python2.7 file with the python3 example, and included a link to the python2.7 example in the git history.  I also removed the Polling wrapper class from the example, in favor of more direct use of asyncio primitives.\r\n\r\nAgain it's functionally identical to the original example.",
      "created_at" : "2017-01-09T22:27:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9485#issuecomment-271427952",
      "id" : 271427952,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9485",
      "updated_at" : "2017-01-09T22:27:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/271427952",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1746780?v=3",
         "events_url" : "https://api.github.com/users/mcelrath/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mcelrath/followers",
         "following_url" : "https://api.github.com/users/mcelrath/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mcelrath/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mcelrath",
         "id" : 1746780,
         "login" : "mcelrath",
         "organizations_url" : "https://api.github.com/users/mcelrath/orgs",
         "received_events_url" : "https://api.github.com/users/mcelrath/received_events",
         "repos_url" : "https://api.github.com/users/mcelrath/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mcelrath/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mcelrath/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mcelrath"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9485#discussion_r95293079"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9485"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95293079"
         }
      },
      "body" : "This function definition syntax is specific to Python 3.5 and throws an exception in Python 3.4. Perhaps a ```from __future__ import``` option exists that will allow compatibility with all Python 3 minor versions?",
      "commit_id" : "1cc48d30ada8b4528e65bf698b31442992081a48",
      "created_at" : "2017-01-10T03:01:11Z",
      "diff_hunk" : "@@ -1,44 +1,65 @@\n-#!/usr/bin/env python2\n+#!/usr/bin/env python3\n # Copyright (c) 2014-2016 The Bitcoin Core developers\n # Distributed under the MIT software license, see the accompanying\n # file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+# A blocking example using python 2.7 can be obtained from the git history:\n+# https://github.com/bitcoin/bitcoin/blob/37a7fe9e440b83e2364d5498931253937abe9294/contrib/zmq/zmq_sub.py\n+\n import array\n import binascii\n-import zmq\n+import asyncio, zmq, zmq.asyncio\n+import signal\n import struct\n \n port = 28332\n \n-zmqContext = zmq.Context()\n-zmqSubSocket = zmqContext.socket(zmq.SUB)\n-zmqSubSocket.setsockopt(zmq.SUBSCRIBE, \"hashblock\")\n-zmqSubSocket.setsockopt(zmq.SUBSCRIBE, \"hashtx\")\n-zmqSubSocket.setsockopt(zmq.SUBSCRIBE, \"rawblock\")\n-zmqSubSocket.setsockopt(zmq.SUBSCRIBE, \"rawtx\")\n-zmqSubSocket.connect(\"tcp://127.0.0.1:%i\" % port)\n-\n-try:\n-    while True:\n-        msg = zmqSubSocket.recv_multipart()\n-        topic = str(msg[0])\n+class ZMQHandler():\n+    def __init__(self):\n+        self.loop = zmq.asyncio.install()\n+        self.zmqContext = zmq.asyncio.Context()\n+\n+        self.zmqSubSocket = self.zmqContext.socket(zmq.SUB)\n+        self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"hashblock\")\n+        self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"hashtx\")\n+        self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"rawblock\")\n+        self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"rawtx\")\n+        self.zmqSubSocket.connect(\"tcp://127.0.0.1:%i\" % port)\n+\n+    async def handle(self) :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9485#discussion_r95293079",
      "id" : 95293079,
      "original_commit_id" : "e2773a2a7f3dc55348150a394b94a7b33e4f9052",
      "original_position" : 43,
      "path" : "contrib/zmq/zmq_sub.py",
      "position" : 48,
      "pull_request_review_id" : 15842228,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9485",
      "updated_at" : "2017-01-10T15:56:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95293079",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6916056?v=3",
         "events_url" : "https://api.github.com/users/venzen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/venzen/followers",
         "following_url" : "https://api.github.com/users/venzen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/venzen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/venzen",
         "id" : 6916056,
         "login" : "venzen",
         "organizations_url" : "https://api.github.com/users/venzen/orgs",
         "received_events_url" : "https://api.github.com/users/venzen/received_events",
         "repos_url" : "https://api.github.com/users/venzen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/venzen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/venzen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/venzen"
      }
   },
   {
      "body" : "Python 3.4 seems to be widely used while Python 3.5 is still pushing out the boat.\r\n\r\nDeprecating Python 2 in favor of version 3 has many benefits, yet, thinking about general usability, it would perhaps make sense to keep this script's functionality dependent on the *zmq* module and avoid adding *asyncio* dependency? Don't get me wrong - the use of *asyncio* in this script is clean and efficient - but it adds a dependency; an extra layer; and the need for the user (seeking a ZMQ example) to be familiar with *asyncio* (and its usage in Python 3.5).\r\n\r\nI suggest having two example scripts: a vanilla ZMQ SUBscriber compatible with Python 3.4 (and based on the previous 2.7 script) as well as the current (3.5) script using *asyncio* and compatible with Python 3.4, if possible.",
      "created_at" : "2017-01-10T03:08:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9485#issuecomment-271474525",
      "id" : 271474525,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9485",
      "updated_at" : "2017-01-10T03:11:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/271474525",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6916056?v=3",
         "events_url" : "https://api.github.com/users/venzen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/venzen/followers",
         "following_url" : "https://api.github.com/users/venzen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/venzen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/venzen",
         "id" : 6916056,
         "login" : "venzen",
         "organizations_url" : "https://api.github.com/users/venzen/orgs",
         "received_events_url" : "https://api.github.com/users/venzen/received_events",
         "repos_url" : "https://api.github.com/users/venzen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/venzen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/venzen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/venzen"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9485#discussion_r95295631"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9485"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95295631"
         }
      },
      "body" : "Asyncio was only introduced in 3.5 including these syntax enhancements and was \"provisional\".  It's now final that 3.6 was released a week ago, and backported (as final) to 3.5 point releases.  3.4 doesn't have it and never will.  But, it doesn't have anywhere near the user base of 2.7 and I don't think is worth supporting long term.\r\n\r\nI tried to install 3.4 while testing this, it's not even provided anymore by Ubuntu.\r\n\r\nhttp://stackoverflow.com/questions/30191556/coroutine-in-python-between-3-4-and-3-5-how-can-i-keep-backwords-compatibility",
      "commit_id" : "1cc48d30ada8b4528e65bf698b31442992081a48",
      "created_at" : "2017-01-10T03:38:36Z",
      "diff_hunk" : "@@ -1,44 +1,65 @@\n-#!/usr/bin/env python2\n+#!/usr/bin/env python3\n # Copyright (c) 2014-2016 The Bitcoin Core developers\n # Distributed under the MIT software license, see the accompanying\n # file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+# A blocking example using python 2.7 can be obtained from the git history:\n+# https://github.com/bitcoin/bitcoin/blob/37a7fe9e440b83e2364d5498931253937abe9294/contrib/zmq/zmq_sub.py\n+\n import array\n import binascii\n-import zmq\n+import asyncio, zmq, zmq.asyncio\n+import signal\n import struct\n \n port = 28332\n \n-zmqContext = zmq.Context()\n-zmqSubSocket = zmqContext.socket(zmq.SUB)\n-zmqSubSocket.setsockopt(zmq.SUBSCRIBE, \"hashblock\")\n-zmqSubSocket.setsockopt(zmq.SUBSCRIBE, \"hashtx\")\n-zmqSubSocket.setsockopt(zmq.SUBSCRIBE, \"rawblock\")\n-zmqSubSocket.setsockopt(zmq.SUBSCRIBE, \"rawtx\")\n-zmqSubSocket.connect(\"tcp://127.0.0.1:%i\" % port)\n-\n-try:\n-    while True:\n-        msg = zmqSubSocket.recv_multipart()\n-        topic = str(msg[0])\n+class ZMQHandler():\n+    def __init__(self):\n+        self.loop = zmq.asyncio.install()\n+        self.zmqContext = zmq.asyncio.Context()\n+\n+        self.zmqSubSocket = self.zmqContext.socket(zmq.SUB)\n+        self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"hashblock\")\n+        self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"hashtx\")\n+        self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"rawblock\")\n+        self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"rawtx\")\n+        self.zmqSubSocket.connect(\"tcp://127.0.0.1:%i\" % port)\n+\n+    async def handle(self) :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9485#discussion_r95295631",
      "id" : 95295631,
      "original_commit_id" : "e2773a2a7f3dc55348150a394b94a7b33e4f9052",
      "original_position" : 43,
      "path" : "contrib/zmq/zmq_sub.py",
      "position" : 48,
      "pull_request_review_id" : 15844812,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9485",
      "updated_at" : "2017-01-10T15:56:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95295631",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1746780?v=3",
         "events_url" : "https://api.github.com/users/mcelrath/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mcelrath/followers",
         "following_url" : "https://api.github.com/users/mcelrath/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mcelrath/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mcelrath",
         "id" : 1746780,
         "login" : "mcelrath",
         "organizations_url" : "https://api.github.com/users/mcelrath/orgs",
         "received_events_url" : "https://api.github.com/users/mcelrath/received_events",
         "repos_url" : "https://api.github.com/users/mcelrath/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mcelrath/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mcelrath/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mcelrath"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9485#discussion_r95295720"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9485"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95295720"
         }
      },
      "body" : "FYI the \"yield from\" syntax of 3.4 has been entirely deprecated.",
      "commit_id" : "1cc48d30ada8b4528e65bf698b31442992081a48",
      "created_at" : "2017-01-10T03:39:44Z",
      "diff_hunk" : "@@ -1,44 +1,65 @@\n-#!/usr/bin/env python2\n+#!/usr/bin/env python3\n # Copyright (c) 2014-2016 The Bitcoin Core developers\n # Distributed under the MIT software license, see the accompanying\n # file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+# A blocking example using python 2.7 can be obtained from the git history:\n+# https://github.com/bitcoin/bitcoin/blob/37a7fe9e440b83e2364d5498931253937abe9294/contrib/zmq/zmq_sub.py\n+\n import array\n import binascii\n-import zmq\n+import asyncio, zmq, zmq.asyncio\n+import signal\n import struct\n \n port = 28332\n \n-zmqContext = zmq.Context()\n-zmqSubSocket = zmqContext.socket(zmq.SUB)\n-zmqSubSocket.setsockopt(zmq.SUBSCRIBE, \"hashblock\")\n-zmqSubSocket.setsockopt(zmq.SUBSCRIBE, \"hashtx\")\n-zmqSubSocket.setsockopt(zmq.SUBSCRIBE, \"rawblock\")\n-zmqSubSocket.setsockopt(zmq.SUBSCRIBE, \"rawtx\")\n-zmqSubSocket.connect(\"tcp://127.0.0.1:%i\" % port)\n-\n-try:\n-    while True:\n-        msg = zmqSubSocket.recv_multipart()\n-        topic = str(msg[0])\n+class ZMQHandler():\n+    def __init__(self):\n+        self.loop = zmq.asyncio.install()\n+        self.zmqContext = zmq.asyncio.Context()\n+\n+        self.zmqSubSocket = self.zmqContext.socket(zmq.SUB)\n+        self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"hashblock\")\n+        self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"hashtx\")\n+        self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"rawblock\")\n+        self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"rawtx\")\n+        self.zmqSubSocket.connect(\"tcp://127.0.0.1:%i\" % port)\n+\n+    async def handle(self) :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9485#discussion_r95295720",
      "id" : 95295720,
      "original_commit_id" : "e2773a2a7f3dc55348150a394b94a7b33e4f9052",
      "original_position" : 43,
      "path" : "contrib/zmq/zmq_sub.py",
      "position" : 48,
      "pull_request_review_id" : 15844903,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9485",
      "updated_at" : "2017-01-10T15:56:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95295720",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1746780?v=3",
         "events_url" : "https://api.github.com/users/mcelrath/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mcelrath/followers",
         "following_url" : "https://api.github.com/users/mcelrath/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mcelrath/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mcelrath",
         "id" : 1746780,
         "login" : "mcelrath",
         "organizations_url" : "https://api.github.com/users/mcelrath/orgs",
         "received_events_url" : "https://api.github.com/users/mcelrath/received_events",
         "repos_url" : "https://api.github.com/users/mcelrath/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mcelrath/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mcelrath/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mcelrath"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9485#discussion_r95326421"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9485"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95326421"
         }
      },
      "body" : "Useful to know and thanks for the info & link @mcelrath \r\n\r\nPython 3.5 will undoubtedly become the de facto standard, as you imply. In providing example scripts it seems reasonable that Bitcoin cater to the common denominator. It's probably safe to assume that most nodes out there are not running on the latest OS versions and that Ubuntu 14.04 and even 12.04 (in some cases) are the majority. From this perspective catering for Python 3.4 is useful since it is both repository standard and supported.\r\n\r\nYour 3.5 approach using asyncio is great. My comments are really just thinking about ease of use and compatibility, hence the suggestion to cater for 3.4 and the inevitable 3.5 future",
      "commit_id" : "1cc48d30ada8b4528e65bf698b31442992081a48",
      "created_at" : "2017-01-10T09:28:52Z",
      "diff_hunk" : "@@ -1,44 +1,65 @@\n-#!/usr/bin/env python2\n+#!/usr/bin/env python3\n # Copyright (c) 2014-2016 The Bitcoin Core developers\n # Distributed under the MIT software license, see the accompanying\n # file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+# A blocking example using python 2.7 can be obtained from the git history:\n+# https://github.com/bitcoin/bitcoin/blob/37a7fe9e440b83e2364d5498931253937abe9294/contrib/zmq/zmq_sub.py\n+\n import array\n import binascii\n-import zmq\n+import asyncio, zmq, zmq.asyncio\n+import signal\n import struct\n \n port = 28332\n \n-zmqContext = zmq.Context()\n-zmqSubSocket = zmqContext.socket(zmq.SUB)\n-zmqSubSocket.setsockopt(zmq.SUBSCRIBE, \"hashblock\")\n-zmqSubSocket.setsockopt(zmq.SUBSCRIBE, \"hashtx\")\n-zmqSubSocket.setsockopt(zmq.SUBSCRIBE, \"rawblock\")\n-zmqSubSocket.setsockopt(zmq.SUBSCRIBE, \"rawtx\")\n-zmqSubSocket.connect(\"tcp://127.0.0.1:%i\" % port)\n-\n-try:\n-    while True:\n-        msg = zmqSubSocket.recv_multipart()\n-        topic = str(msg[0])\n+class ZMQHandler():\n+    def __init__(self):\n+        self.loop = zmq.asyncio.install()\n+        self.zmqContext = zmq.asyncio.Context()\n+\n+        self.zmqSubSocket = self.zmqContext.socket(zmq.SUB)\n+        self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"hashblock\")\n+        self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"hashtx\")\n+        self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"rawblock\")\n+        self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"rawtx\")\n+        self.zmqSubSocket.connect(\"tcp://127.0.0.1:%i\" % port)\n+\n+    async def handle(self) :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9485#discussion_r95326421",
      "id" : 95326421,
      "original_commit_id" : "e2773a2a7f3dc55348150a394b94a7b33e4f9052",
      "original_position" : 43,
      "path" : "contrib/zmq/zmq_sub.py",
      "position" : 48,
      "pull_request_review_id" : 15875993,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9485",
      "updated_at" : "2017-01-10T15:56:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95326421",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6916056?v=3",
         "events_url" : "https://api.github.com/users/venzen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/venzen/followers",
         "following_url" : "https://api.github.com/users/venzen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/venzen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/venzen",
         "id" : 6916056,
         "login" : "venzen",
         "organizations_url" : "https://api.github.com/users/venzen/orgs",
         "received_events_url" : "https://api.github.com/users/venzen/received_events",
         "repos_url" : "https://api.github.com/users/venzen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/venzen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/venzen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/venzen"
      }
   },
   {
      "body" : "Bah, I think we should support 3.4 for the forseeable future. I don't care about 2.x compatibility.\r\n\r\nCan't we make asyncio usage dependent on Python version or something? Is it hard to make a fallback, to support both, use the fancy new i/o system on 3.5+?",
      "created_at" : "2017-01-10T14:16:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9485#issuecomment-271585760",
      "id" : 271585760,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9485",
      "updated_at" : "2017-01-10T14:17:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/271585760",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "See I told ya this would result in a python version fight...I just didn't anticipate anyone wanting 3.4! :-P\r\n\r\nPython 3.4 was last released in Ubuntu in version 14.04.  It has been excluded in 14.10, 15.04, 15.10, 16.04 LTS, and 16.10.  It's ancient history.  The python project itself has designated 3.4 as \"security fixes only\" and is no longer producing binaries for it.\r\n\r\nThe syntax change is, unfortunately, not backwards compatible, and results in a syntax error on 3.4.  Consequently there is no `from __future__` for it.  It took the python guys some time to settle on a reasonable syntax, adding the `async` keyword instead of the @coroutine decorator, and `yield from`.\r\n\r\nI literally don't have any machines at my disposal with python3.4 on them.  I added a second example which should work on both python 3.4 and 3.5.  Could one of you 3.4 aficionados test it please?",
      "created_at" : "2017-01-10T15:58:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9485#issuecomment-271614406",
      "id" : 271614406,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9485",
      "updated_at" : "2017-01-10T15:58:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/271614406",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1746780?v=3",
         "events_url" : "https://api.github.com/users/mcelrath/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mcelrath/followers",
         "following_url" : "https://api.github.com/users/mcelrath/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mcelrath/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mcelrath",
         "id" : 1746780,
         "login" : "mcelrath",
         "organizations_url" : "https://api.github.com/users/mcelrath/orgs",
         "received_events_url" : "https://api.github.com/users/mcelrath/received_events",
         "repos_url" : "https://api.github.com/users/mcelrath/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mcelrath/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mcelrath/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mcelrath"
      }
   },
   {
      "body" : "Concept ACK, cannot test this right now, may do so later (I do have an Ubuntu Trusty/14.04 instance to test, note that we also use this version of Ubuntu on Travis and to build gitian releases).",
      "created_at" : "2017-01-11T13:04:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9485#issuecomment-271863242",
      "id" : 271863242,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9485",
      "updated_at" : "2017-01-11T13:07:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/271863242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Needs rebase.\r\n\r\nMaybe also squash the first two commits?",
      "created_at" : "2017-01-18T10:07:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9485#issuecomment-273435050",
      "id" : 273435050,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9485",
      "updated_at" : "2017-01-18T10:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/273435050",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
