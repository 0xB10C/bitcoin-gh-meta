[
   {
      "body" : "I think what you are referring to are VPATH builds. I put a merge request in ages ago for this very issue.\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/6336\r\n\r\nWhat needs to get adjusted is LevelDB's custom makefile (it should have a configure.ac at the very least). Since LevelDB is a Google project, it should be fixed there, but Google isn't really maintaining this project anymore, IIRC. And, since LevelDB was not submoduled into Bitcoin, but copied in and maintained by hand, this is difficult. My merge request addressed the issue of using LevelDB within the context of well-behaved autotools projects like Bitcoin. I would be happy to update the merge request and resubmit.",
      "created_at" : "2016-02-04T14:52:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7466#issuecomment-179880885",
      "id" : 179880885,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7466",
      "updated_at" : "2016-02-04T14:52:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/179880885",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/12446?v=3",
         "events_url" : "https://api.github.com/users/kleetus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kleetus/followers",
         "following_url" : "https://api.github.com/users/kleetus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kleetus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kleetus",
         "id" : 12446,
         "login" : "kleetus",
         "organizations_url" : "https://api.github.com/users/kleetus/orgs",
         "received_events_url" : "https://api.github.com/users/kleetus/received_events",
         "repos_url" : "https://api.github.com/users/kleetus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kleetus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kleetus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kleetus"
      }
   },
   {
      "body" : "I think you misread my comment there.\n\nWe have our own slightly modified branch of LevelDB, in\nhttps://github.com/bitcoin/leveldb. If we want to change LevelDB's build\nsystem, we can do it there, and update the subtree in Bitcoin.\n\nThe question is just whether we want to maintain our own modified build\nsystem for LevelDB. I think doing so deserves being discussed at least, as\nLevelDB is hardly making any changes anymore, and it is an often seen\nproblem.\n\nIt would be better to get google/leveldb to use a more modern build system,\nbut it sounds unlikely to be accepted.\n",
      "created_at" : "2016-02-04T15:04:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7466#issuecomment-179886773",
      "id" : 179886773,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7466",
      "updated_at" : "2016-02-04T15:04:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/179886773",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Thanks! I did a search of prior issues but somehow missed that one.\r\n\r\nI'd prefer an upstream solution too, but that doesn't seem to be coming. As you say [LevelDB upstream](https://github.com/google/leveldb/commits/master) is only intermittently maintained - though it seems there is a flurry of activity now.\r\n\r\nWe already have some custom changes in https://github.com/bitcoin/leveldb/, maybe it could be added there for now.\r\n",
      "created_at" : "2016-02-04T15:04:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7466#issuecomment-179886807",
      "id" : 179886807,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7466",
      "updated_at" : "2016-02-04T15:04:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/179886807",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@sipa I did misread your comment, thanks for pointing that out. I wasn't sure of the mechanism that bitcoin/leveldb gets pulled into Bitcoin. The hand-rolled makefile in both google/leveldb and bitcoin/leveldb work pretty well in their own context. It seems to me that someone is tasked with cherry-picking in files from github's bitcoin/leveldb to the bitcoin/src/leveldb directory. This might be similar to the way libsecp256k1works as well, but this is a little off-topic. My suggestion would be to convert bitcoin/leveldb into a \"well-behaved\" autotools project (like libsecp256k1 is now). I would be happy to do this if someone has not committed to this work already. \r\n\r\nAt the same time, I would like to suggest that libsecp256k1 and leveldb become git submodules instead of code that needs to be copied into the project by hand (if this in fact what happens). My apologies for the slight derailment. \r\n\r\n",
      "created_at" : "2016-02-04T15:35:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7466#issuecomment-179903607",
      "id" : 179903607,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7466",
      "updated_at" : "2016-02-04T15:35:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/179903607",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/12446?v=3",
         "events_url" : "https://api.github.com/users/kleetus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kleetus/followers",
         "following_url" : "https://api.github.com/users/kleetus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kleetus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kleetus",
         "id" : 12446,
         "login" : "kleetus",
         "organizations_url" : "https://api.github.com/users/kleetus/orgs",
         "received_events_url" : "https://api.github.com/users/kleetus/received_events",
         "repos_url" : "https://api.github.com/users/kleetus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kleetus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kleetus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kleetus"
      }
   },
   {
      "body" : "They are not just copied into the tree. They are git subtrees, and have\nseveral advantages over submodules.\n\nIf updates are made to the bitcoin/leveldb repository, we can easily pull\nthem into Bitcoin Core, in a verifiable manner.\n",
      "created_at" : "2016-02-04T15:38:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7466#issuecomment-179904468",
      "id" : 179904468,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7466",
      "updated_at" : "2016-02-04T15:38:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/179904468",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "> My suggestion would be to convert bitcoin/leveldb into a \"well-behaved\" autotools project (like libsecp256k1 is now). I would be happy to do this if someone has not committed to this work already.\r\n\r\nSounds good to me. Seems like the cleanest solution.\r\n",
      "created_at" : "2016-02-04T15:44:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7466#issuecomment-179908152",
      "id" : 179908152,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7466",
      "updated_at" : "2016-02-04T15:44:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/179908152",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I've added this merge request to bitcoin/leveldb:\r\n\r\nhttps://github.com/bitcoin/leveldb/pull/11\r\n\r\nif/when this is merged and pulled into Bitcoin's src/leveldb, then I can and will put in a merge request for Bitcoin's configure.ac for a one line change:\r\n\r\nAC_CONFIG_SUBDIRS([src/leveldb])",
      "created_at" : "2016-02-05T19:56:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7466#issuecomment-180533885",
      "id" : 180533885,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7466",
      "updated_at" : "2016-02-05T19:56:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/180533885",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/12446?v=3",
         "events_url" : "https://api.github.com/users/kleetus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kleetus/followers",
         "following_url" : "https://api.github.com/users/kleetus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kleetus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kleetus",
         "id" : 12446,
         "login" : "kleetus",
         "organizations_url" : "https://api.github.com/users/kleetus/orgs",
         "received_events_url" : "https://api.github.com/users/kleetus/received_events",
         "repos_url" : "https://api.github.com/users/kleetus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kleetus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kleetus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kleetus"
      }
   },
   {
      "body" : "Thanks, looks good to me, I'll test later\r\n\r\n@theuni can you take a look?\r\n",
      "created_at" : "2016-02-08T07:54:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7466#issuecomment-181245312",
      "id" : 181245312,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7466",
      "updated_at" : "2016-02-08T07:54:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/181245312",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "> AC_CONFIG_SUBDIRS([src/leveldb])\r\n\r\nTested ACK. Both in-tree and out-of-tree builds work after importing https://github.com/bitcoin/leveldb/pull/11 and adding this to `configure.ac`.\r\n",
      "created_at" : "2016-02-10T14:58:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7466#issuecomment-182408931",
      "id" : 182408931,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7466",
      "updated_at" : "2016-02-10T14:58:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/182408931",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I'd really like to move this forward, we should pick one of the alternatives and merge it:\r\n- https://github.com/bitcoin/leveldb/pull/11 - Autotools/vpath support in leveldb\r\n- https://github.com/bitcoin/leveldb/pull/11#issuecomment-185373114 - Integrate leveldb into our build\r\n",
      "created_at" : "2016-03-30T08:00:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7466#issuecomment-203308261",
      "id" : 203308261,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7466",
      "updated_at" : "2016-03-30T08:00:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/203308261",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
