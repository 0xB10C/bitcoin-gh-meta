[
   {
      "body" : "This is an error that only appears with `-DDEBUG_LOCKORDER`, which is enabled by `--enable-debug`. Did you perhaps enable this recently?\r\n\r\nHaven't checked whether this is a real issue or not, but the try_lock deadlock detection seems to sometimes give false positives.\r\n\r\n> I've been considering doing a blockchain redownload, but I don't want to if it won't fix anything.\r\n\r\nNo, this looks like an issue in the networking code redownloading the block chain shouldn't have a single effect on this.\r\n",
      "created_at" : "2016-02-05T02:56:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7470#issuecomment-180169589",
      "id" : 180169589,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7470",
      "updated_at" : "2016-02-05T02:58:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/180169589",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Changes to main.cpp in rc3 versus rc2:\r\n```diff\r\ndiff --git a/src/main.cpp b/src/main.cpp\r\nindex d1b0fba..3591679 100644\r\n--- a/src/main.cpp\r\n+++ b/src/main.cpp\r\n@@ -75,7 +75,7 @@ bool fCheckpointsEnabled = DEFAULT_CHECKPOINTS_ENABLED;\r\n size_t nCoinCacheUsage = 5000 * 300;\r\n uint64_t nPruneTarget = 0;\r\n bool fAlerts = DEFAULT_ALERTS;\r\n-bool fPermitReplacement = DEFAULT_PERMIT_REPLACEMENT;\r\n+bool fEnableReplacement = DEFAULT_ENABLE_REPLACEMENT;\r\n \r\n /** Fees smaller than this (in satoshi) are considered zero fee (for relaying, mining and transaction creation) */\r\n CFeeRate minRelayTxFee = CFeeRate(DEFAULT_MIN_RELAY_TX_FEE);\r\n@@ -866,7 +866,7 @@ bool AcceptToMemoryPoolWorker(CTxMemPool& pool, CValidationState &state, const C\r\n                 // unconfirmed ancestors anyway; doing otherwise is hopelessly\r\n                 // insecure.\r\n                 bool fReplacementOptOut = true;\r\n-                if (fPermitReplacement)\r\n+                if (fEnableReplacement)\r\n                 {\r\n                     BOOST_FOREACH(const CTxIn &txin, ptxConflicting->vin)\r\n                     {\r\n@@ -4497,8 +4497,8 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\r\n \r\n         bool fBlocksOnly = GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY);\r\n \r\n-        // Allow whitelisted peers to send data other than blocks in blocks only mode if whitelistalwaysrelay is true\r\n-        if (pfrom->fWhitelisted && GetBoolArg(\"-whitelistalwaysrelay\", DEFAULT_WHITELISTALWAYSRELAY))\r\n+        // Allow whitelisted peers to send data other than blocks in blocks only mode if whitelistrelay is true\r\n+        if (pfrom->fWhitelisted && GetBoolArg(\"-whitelistrelay\", DEFAULT_WHITELISTRELAY))\r\n             fBlocksOnly = false;\r\n \r\n         LOCK(cs_main);\r\n@@ -4677,8 +4677,8 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\r\n     else if (strCommand == NetMsgType::TX)\r\n     {\r\n         // Stop processing the transaction early if\r\n-        // We are in blocks only mode and peer is either not whitelisted or whitelistalwaysrelay is off\r\n-        if (GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY) && (!pfrom->fWhitelisted || !GetBoolArg(\"-whitelistalwaysrelay\", DEFAULT_WHITELISTALWAYSRELAY)))\r\n+        // We are in blocks only mode and peer is either not whitelisted or whitelistrelay is off\r\n+        if (GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY) && (!pfrom->fWhitelisted || !GetBoolArg(\"-whitelistrelay\", DEFAULT_WHITELISTRELAY)))\r\n         {\r\n             LogPrint(\"net\", \"transaction sent in violation of protocol peer=%d\\n\", pfrom->id);\r\n             return true;\r\n@@ -4778,7 +4778,7 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\r\n             assert(recentRejects);\r\n             recentRejects->insert(tx.GetHash());\r\n \r\n-            if (pfrom->fWhitelisted && GetBoolArg(\"-whitelistalwaysrelay\", DEFAULT_WHITELISTALWAYSRELAY)) {\r\n+            if (pfrom->fWhitelisted && GetBoolArg(\"-whitelistforcerelay\", DEFAULT_WHITELISTFORCERELAY)) {\r\n                 // Always relay transactions received from whitelisted peers, even\r\n                 // if they were already in the mempool or rejected from it due\r\n                 // to policy, allowing the node to function as a gateway for\r\n```\r\nChanges to net.cpp in rc3 versus rc2:\r\n```diff\r\ndiff --git a/src/net.cpp b/src/net.cpp\r\nindex 8abfc4b..2f60cfa 100644\r\n--- a/src/net.cpp\r\n+++ b/src/net.cpp\r\n@@ -884,8 +884,6 @@ static bool AttemptToEvictConnection(bool fPreferNewConnection) {\r\n                 continue;\r\n             if (node->fDisconnect)\r\n                 continue;\r\n-            if (node->addr.IsLocal())\r\n-                continue;\r\n             vEvictionCandidates.push_back(CNodeRef(node));\r\n         }\r\n     }\r\n@@ -916,15 +914,20 @@ static bool AttemptToEvictConnection(bool fPreferNewConnection) {\r\n \r\n     if (vEvictionCandidates.empty()) return false;\r\n \r\n-    // Identify the network group with the most connections\r\n+    // Identify the network group with the most connections and youngest member.\r\n+    // (vEvictionCandidates is already sorted by reverse connect time)\r\n     std::vector<unsigned char> naMostConnections;\r\n     unsigned int nMostConnections = 0;\r\n+    int64_t nMostConnectionsTime = 0;\r\n     std::map<std::vector<unsigned char>, std::vector<CNodeRef> > mapAddrCounts;\r\n     BOOST_FOREACH(const CNodeRef &node, vEvictionCandidates) {\r\n         mapAddrCounts[node->addr.GetGroup()].push_back(node);\r\n+        int64_t grouptime = mapAddrCounts[node->addr.GetGroup()][0]->nTimeConnected;\r\n+        size_t groupsize = mapAddrCounts[node->addr.GetGroup()].size();\r\n \r\n-        if (mapAddrCounts[node->addr.GetGroup()].size() > nMostConnections) {\r\n-            nMostConnections = mapAddrCounts[node->addr.GetGroup()].size();\r\n+        if (groupsize > nMostConnections || (groupsize == nMostConnections && grouptime > nMostConnectionsTime)) {\r\n+            nMostConnections = groupsize;\r\n+            nMostConnectionsTime = grouptime;\r\n             naMostConnections = node->addr.GetGroup();\r\n         }\r\n     }\r\n@@ -932,14 +935,13 @@ static bool AttemptToEvictConnection(bool fPreferNewConnection) {\r\n     // Reduce to the network group with the most connections\r\n     vEvictionCandidates = mapAddrCounts[naMostConnections];\r\n \r\n-    // Do not disconnect peers if there is only 1 connection from their network group\r\n+    // Do not disconnect peers if there is only one unprotected connection from their network group.\r\n     if (vEvictionCandidates.size() <= 1)\r\n         // unless we prefer the new connection (for whitelisted peers)\r\n         if (!fPreferNewConnection)\r\n             return false;\r\n \r\n-    // Disconnect the most recent connection from the network group with the most connections\r\n-    std::sort(vEvictionCandidates.begin(), vEvictionCandidates.end(), ReverseCompareNodeTimeConnected);\r\n+    // Disconnect from the network group with the most connections\r\n     vEvictionCandidates[0]->fDisconnect = true;\r\n \r\n     return true;\r\n```\r\nAs far as I see it, nothing with the locks in question changed.",
      "created_at" : "2016-02-05T03:05:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7470#issuecomment-180171366",
      "id" : 180171366,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7470",
      "updated_at" : "2016-02-05T03:05:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/180171366",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I have two aliases for configuring:\n\nalias configurestd=\"./configure --prefix='$HOME/.local'\"\nalias configuredev=\"./configure --enable-debug --program-prefix=dev --prefix='$HOME/.local'\"\n\nI ran \"configurestd\" before \"make && make install\" so I figured that'd disable \"--enable-debug\". Other than that, I don't have any debugging flags anywhere.",
      "created_at" : "2016-02-05T03:05:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7470#issuecomment-180171403",
      "id" : 180171403,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7470",
      "updated_at" : "2016-02-05T03:05:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/180171403",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16140350?v=3",
         "events_url" : "https://api.github.com/users/GIJensen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/GIJensen/followers",
         "following_url" : "https://api.github.com/users/GIJensen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/GIJensen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/GIJensen",
         "id" : 16140350,
         "login" : "GIJensen",
         "organizations_url" : "https://api.github.com/users/GIJensen/orgs",
         "received_events_url" : "https://api.github.com/users/GIJensen/received_events",
         "repos_url" : "https://api.github.com/users/GIJensen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/GIJensen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/GIJensen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/GIJensen"
      }
   },
   {
      "body" : "Is it possible the issue existed before but never came up because I never reindexed? Should I try to build older commits?",
      "created_at" : "2016-02-05T03:19:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7470#issuecomment-180173276",
      "id" : 180173276,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7470",
      "updated_at" : "2016-02-05T03:19:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/180173276",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16140350?v=3",
         "events_url" : "https://api.github.com/users/GIJensen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/GIJensen/followers",
         "following_url" : "https://api.github.com/users/GIJensen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/GIJensen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/GIJensen",
         "id" : 16140350,
         "login" : "GIJensen",
         "organizations_url" : "https://api.github.com/users/GIJensen/orgs",
         "received_events_url" : "https://api.github.com/users/GIJensen/received_events",
         "repos_url" : "https://api.github.com/users/GIJensen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/GIJensen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/GIJensen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/GIJensen"
      }
   },
   {
      "body" : "Yes, that is possible. Try cleaning your tree then rebuildilng without --enable-debug, then reindexing.\r\n",
      "created_at" : "2016-02-05T03:20:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7470#issuecomment-180173404",
      "id" : 180173404,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7470",
      "updated_at" : "2016-02-05T03:20:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/180173404",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Okay, already doing that!\r\n\r\nBTW I'm running Debian Jessie 64- bit. Just in case that ends up being relevant.",
      "created_at" : "2016-02-05T03:23:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7470#issuecomment-180173805",
      "id" : 180173805,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7470",
      "updated_at" : "2016-02-05T03:23:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/180173805",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16140350?v=3",
         "events_url" : "https://api.github.com/users/GIJensen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/GIJensen/followers",
         "following_url" : "https://api.github.com/users/GIJensen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/GIJensen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/GIJensen",
         "id" : 16140350,
         "login" : "GIJensen",
         "organizations_url" : "https://api.github.com/users/GIJensen/orgs",
         "received_events_url" : "https://api.github.com/users/GIJensen/received_events",
         "repos_url" : "https://api.github.com/users/GIJensen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/GIJensen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/GIJensen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/GIJensen"
      }
   },
   {
      "body" : "I have trouble parsing *which* locks are conflicting from that log message. It's supposed to detect A->B  B->A lock conflicts, but it looks like, except cs_main the two sequences have nothing in common?\r\n\r\n@TheBlueMatt @cfields you touched that deadlock detection code most recently AFAIK, any idea what is going on here?\r\n",
      "created_at" : "2016-02-05T03:27:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7470#issuecomment-180174529",
      "id" : 180174529,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7470",
      "updated_at" : "2016-02-05T03:27:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/180174529",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Seems to run fine now anyways, no crash yet!",
      "created_at" : "2016-02-05T06:02:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7470#issuecomment-180213977",
      "id" : 180213977,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7470",
      "updated_at" : "2016-02-05T06:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/180213977",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16140350?v=3",
         "events_url" : "https://api.github.com/users/GIJensen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/GIJensen/followers",
         "following_url" : "https://api.github.com/users/GIJensen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/GIJensen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/GIJensen",
         "id" : 16140350,
         "login" : "GIJensen",
         "organizations_url" : "https://api.github.com/users/GIJensen/orgs",
         "received_events_url" : "https://api.github.com/users/GIJensen/received_events",
         "repos_url" : "https://api.github.com/users/GIJensen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/GIJensen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/GIJensen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/GIJensen"
      }
   }
]
