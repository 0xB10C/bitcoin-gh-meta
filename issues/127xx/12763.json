{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "Summary\r\n====\r\n\r\nThis patch adds the RPC whitelisting feature requested in #12248. RPC Whitelists help enforce application policies for services being built on top of Bitcoin Core (e.g., your Lightning Node maybe shouldn't be adding new peers). The aim of this PR is not to make it advisable to connect your Bitcoin node to arbitrary services, but to reduce risk and prevent unintended access.\r\n\r\nUsing RPC Whitelists\r\n====\r\nThe way it works is you specify (in your bitcoin.conf) configurations such as\r\n\r\n```\r\nrpcauth=user1:4cc74397d6e9972e5ee7671fd241$11849357f26a5be7809c68a032bc2b16ab5dcf6348ef3ed1cf30dae47b8bcc71\r\nrpcauth=user2:181b4a25317bff60f3749adee7d6bca0$d9c331474f1322975fa170a2ffbcb176ba11644211746b27c1d317f265dd4ada\r\nrpcauth=user3:a6c8a511b53b1edcf69c36984985e$13cfba0e626db19061c9d61fa58e712d0319c11db97ad845fa84517f454f6675\r\nrpcwhitelist=user1:getnetworkinfo\r\nrpcwhitelist=user2:getnetworkinfo,getwalletinfo, getbestblockhash\r\nrpcwhitelistdefault=0\r\n```\r\n\r\nNow user1 can only call getnetworkinfo, user2 can only call getnetworkinfo or getwalletinfo, while user3 can still call all RPCs. \r\n\r\nIf any rpcwhitelist is set, act as if all users are subject to whitelists unless rpcwhitelistdefault is set to 0. If rpcwhitelistdefault is set to 1 and no rpcwhitelist is set, act as if all users are subject to whitelists.\r\n\r\n\r\nReview Request\r\n=====\r\nIn addition to normal review, would love specific review from someone working on LN (e.g., @roasbeef) and someone working on an infrastructure team at an exchange (e.g., @jimpo) to check that this works well with their system.\r\n\r\nNotes\r\n=====\r\n\r\nThe rpc list is spelling sensitive -- whitespace is stripped though. Spelling errors fail towards the RPC call being blocked, which is safer.\r\n\r\nIt was unclear to me if HTTPReq_JSONRPC is the best function to patch this functionality into, or if it would be better to place it in exec or somewhere else.\r\n\r\nIt was also unclear to me if it would be preferred to cache the whitelists on startup or parse them on every RPC as is done with multiUserAuthorized. I opted for the cached approach as I thought it was a bit cleaner.\r\n\r\n\r\nFuture Work\r\n=====\r\n\r\nIn a future PR, I would like to add an inheritance scheme. This seemed more controversial so I didn't want to include that here. Inheritance semantics are tricky, but it would also make these whitelists easier to read.\r\n\r\nIt also might be good to add a `getrpcwhitelist` command to facilitate permission discovery.\r\n\r\nBefore Merge\r\n=====\r\nI'm opening the PR now for general feedback, but I should add a couple tests before merge. I'd prefer to do documentation as a separate PR, but it can be added in this PR if preferred.\r\n\r\n",
   "closed_at" : null,
   "closed_by" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
      "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
      "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/JeremyRubin",
      "id" : 886523,
      "login" : "JeremyRubin",
      "node_id" : "MDQ6VXNlcjg4NjUyMw==",
      "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
      "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
      "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/JeremyRubin"
   },
   "comments" : 29,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12763/comments",
   "created_at" : "2018-03-23T04:42:40Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12763/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/12763",
   "id" : 307900921,
   "labels" : [
      {
         "color" : "cccccc",
         "default" : false,
         "id" : 955867938,
         "name" : "Needs rebase",
         "node_id" : "MDU6TGFiZWw5NTU4Njc5Mzg=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase"
      },
      {
         "color" : "0052cc",
         "default" : false,
         "id" : 98279177,
         "name" : "RPC/REST/ZMQ",
         "node_id" : "MDU6TGFiZWw5ODI3OTE3Nw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ"
      },
      {
         "color" : "99a810",
         "default" : false,
         "id" : 749416508,
         "name" : "Up for grabs",
         "node_id" : "MDU6TGFiZWw3NDk0MTY1MDg=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Up%20for%20grabs"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12763/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0MTc2OTcyMzk1",
   "number" : 12763,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/12763.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12763",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/12763.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12763"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Add RPC Whitelist Feature from #12248",
   "updated_at" : "2018-11-08T23:11:33Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12763",
   "user" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
      "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
      "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
      "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
      "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/JeremyRubin",
      "id" : 886523,
      "login" : "JeremyRubin",
      "node_id" : "MDQ6VXNlcjg4NjUyMw==",
      "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
      "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
      "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/JeremyRubin"
   }
}
