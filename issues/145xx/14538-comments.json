[
   {
      "author_association" : "MEMBER",
      "body" : "I confirm the crash.",
      "created_at" : "2018-10-21T19:30:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14538#issuecomment-431696977",
      "id" : 431696977,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14538",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMTY5Njk3Nw==",
      "updated_at" : "2018-10-21T19:30:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/431696977",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@promag ~~I assume this is broken duplicate fileid detection, so #14320 might fix the issue.~~ Nope. It still exist on master.",
      "created_at" : "2018-10-22T02:56:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14538#issuecomment-431731066",
      "id" : 431731066,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14538",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMTczMTA2Ng==",
      "updated_at" : "2018-10-23T09:00:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/431731066",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Fix from ken2812221 looks right, but I would want to tweak it a bit so `wallet.dat` is handled at the database layer. I'll post a suggestion in #14552.\r\n\r\nThis issue was really confusing to debug. We have two different checks to prevent opening the same wallet multiple times, and this is slipping between the two checks. The more general check is in CheckUniqueFileid:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/b3f377daaa86cd7755a552fa3adfeb195835f58e/src/wallet/db.cpp#L506-L508\r\n\r\nbut because it runs lazily, it is skipped if the btree path is already open:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/b3f377daaa86cd7755a552fa3adfeb195835f58e/src/wallet/db.cpp#L467\r\n\r\nWe have a different check in CWallet::Verify which checks for duplicate paths:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/b3f377daaa86cd7755a552fa3adfeb195835f58e/src/wallet/wallet.cpp#L3846\r\n\r\nBut it is somewhat broken and #14552 fixes it. The actual crash (at least the crash triggered by the test in #14552) happens in an assert here:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/b3f377daaa86cd7755a552fa3adfeb195835f58e/src/wallet/db.cpp#L236",
      "created_at" : "2018-10-23T19:23:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14538#issuecomment-432384697",
      "id" : 432384697,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14538",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMjM4NDY5Nw==",
      "updated_at" : "2018-10-23T19:25:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/432384697",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
