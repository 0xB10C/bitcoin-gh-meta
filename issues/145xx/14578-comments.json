[
   {
      "author_association" : "NONE",
      "body" : "**I tried to find the reference links, but I can't.** I will keep searching, but I have bugs to fix in EasyNOMP.\r\n\r\nYou should be able to easily reproduce the two problems (both related to batch transactions)\r\n1) Make batch payment for 50 miners (this should be well over the limit that causes the failure)\r\n2) Make batch payment to 10 people, but make one of the 10 people have an invalid receiving address (try changing one letter, and also try something completeley wrong like \"123456\")\r\n\r\nYou should get a failure on the entire batch of payments in both cases.\r\n\r\n**This is a security issue for pools, as an attacker can deny payment services by simply mining one or two shares to an invalid receiving address.**\r\n\r\nWhat _should_ happen, is the daemon should process each transaction that it can, but fail only the one transaction with the problem. Also batch transactions should support at least 150 transactions to be worth having a \"batching\" feature (think of how many tx a pool would send!).\r\n\r\nNOMP is also responsible, as it never had address validation prior to making payments. Address validation should be done on both sides. I will be patching this in NOMP shortly.\r\n\r\n**Thanks**",
      "created_at" : "2018-10-26T22:37:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14578#issuecomment-433561391",
      "id" : 433561391,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14578",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMzU2MTM5MQ==",
      "updated_at" : "2018-10-26T22:45:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/433561391",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/43627985?v=4",
         "events_url" : "https://api.github.com/users/leshacat/events{/privacy}",
         "followers_url" : "https://api.github.com/users/leshacat/followers",
         "following_url" : "https://api.github.com/users/leshacat/following{/other_user}",
         "gists_url" : "https://api.github.com/users/leshacat/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/leshacat",
         "id" : 43627985,
         "login" : "leshacat",
         "node_id" : "MDQ6VXNlcjQzNjI3OTg1",
         "organizations_url" : "https://api.github.com/users/leshacat/orgs",
         "received_events_url" : "https://api.github.com/users/leshacat/received_events",
         "repos_url" : "https://api.github.com/users/leshacat/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/leshacat/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/leshacat/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/leshacat"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Also batch transactions should support at least 150 transactions to be worth having a \"batching\" feature (think of how many tx a pool would send!).\r\n\r\nThe limit is due to the maximum size of bitcoin transactions, and depends on the number of inputs your transactions has. Certain 150 outputs is not a problem in general, but if you need 1000s of inputs to pay that much, then yes. Sorry, nothing Bitcoin Core can do about that.\r\n\r\n> You should get a failure on the entire batch of payments in both cases.\r\n\r\nBatches are not atomic. They're executed one by one. Changing that would require a major redesign of how the RPC system works.\r\n\r\n> What should happen, is the daemon should process each transaction that it can, but fail only the one transaction with the problem.\r\n\r\nPerhaps that is reasonable for `sendmany`, and perhaps not. I think it's generally safer to fail as much as possible when part of the input is invalid (in line with your earlier request, except we can't do it across RPC calls). It certainly isn't reasonable in general (for example, if that's what we'd do for `createrawtransaction` you'd end up paying the failed amounts as fee!).\r\n\r\nReally, I think there is no solution except validating your inputs.",
      "created_at" : "2018-10-26T23:22:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14578#issuecomment-433568076",
      "id" : 433568076,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14578",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMzU2ODA3Ng==",
      "updated_at" : "2018-10-26T23:23:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/433568076",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "**@sipa - thank you for your speedy reply!**\r\n\r\n>The limit is due to the maximum size of bitcoin transactions, and depends on the number of inputs your transactions has. Certain 150 outputs is not a problem in general, but if you need 1000s of inputs to pay that much, then yes. Sorry, nothing Bitcoin Core can do about that.\r\n\r\n**So what is the upper limit on how many transactions can fit into one batch RPC call?** I need to know so I can manually batch my transactions...\r\n\r\n>>You should get a failure on the entire batch of payments in both cases.\r\n\r\n>Batches are not atomic. They're executed one by one. Changing that would require a major redesign of how the RPC system works.\r\n\r\nI meant to say \"you should NOT get a failure on the entire batch, it should process the other transactions in the batch and return the failed transaction in the JSON return value\"\r\n\r\n**Example of 'sendmany' failure response:**\r\n>\"result\": {\r\n>    error: true,\r\n>    successes: 52\r\n>    failures: 3\r\n>    failures: {\r\n>        {\"1PvSxjrpzNXpuBHCupAGuuzeUk5DE7kB7H\", 10.83746523, \"invalid address\", etc},\r\n>        {\"1PvwxjrTzNXpuBHCupAGuuzeik5DE7kB7H\", 5.42042020, \"insufficient funds\", etc},\r\n>        {\"1PvuxjrpzNlpuBHCupAGuuzeUk5DE7kB7H\", 10000.00000000, \"fee too low\", etc}\r\n>    }\r\n>}\r\n\r\nI must be unaware of how the RPC system works and ties into other systems. Was it intended to be designed so that the entire batch fails if one single address is wrong?\r\n\r\n>Perhaps that is reasonable for sendmany, and perhaps not. I think it's generally safer to fail as much as possible when part of the input is invalid (in line with your earlier request, except we can't do it across RPC calls). It certainly isn't reasonable in general (for example, if that's what we'd do for createrawtransaction you'd end up paying the failed amounts as fee!).\r\nDefinitely would not want to pay the failed amount as a fee... My goal is to track the failed amounts, and give it to the pool as donation.\r\n\r\n**So should I just switch it back to send one single transaction at a time then? Or is there a way to tell which transaction is the one that failed?**",
      "created_at" : "2018-10-27T22:09:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14578#issuecomment-433659038",
      "id" : 433659038,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14578",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMzY1OTAzOA==",
      "updated_at" : "2018-10-27T22:21:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/433659038",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/43627985?v=4",
         "events_url" : "https://api.github.com/users/leshacat/events{/privacy}",
         "followers_url" : "https://api.github.com/users/leshacat/followers",
         "following_url" : "https://api.github.com/users/leshacat/following{/other_user}",
         "gists_url" : "https://api.github.com/users/leshacat/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/leshacat",
         "id" : 43627985,
         "login" : "leshacat",
         "node_id" : "MDQ6VXNlcjQzNjI3OTg1",
         "organizations_url" : "https://api.github.com/users/leshacat/orgs",
         "received_events_url" : "https://api.github.com/users/leshacat/received_events",
         "repos_url" : "https://api.github.com/users/leshacat/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/leshacat/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/leshacat/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/leshacat"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm confused now. Which RPCs are you using?",
      "created_at" : "2018-10-27T22:14:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14578#issuecomment-433659330",
      "id" : 433659330,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14578",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMzY1OTMzMA==",
      "updated_at" : "2018-10-27T22:14:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/433659330",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
