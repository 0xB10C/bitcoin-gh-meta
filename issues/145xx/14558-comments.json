[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2018-10-24T07:11:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14558#issuecomment-432539534",
      "id" : 432539534,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14558",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMjUzOTUzNA==",
      "updated_at" : "2018-10-24T07:11:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/432539534",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14558#discussion_r227708275"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14558"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227708275"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason to not move these to `AllUsedKeyStore`?",
      "commit_id" : "7b93302c48cb67b16093da9ec4394b671fb11779",
      "created_at" : "2018-10-24T09:22:07Z",
      "diff_hunk" : "@@ -805,6 +805,111 @@ UniValue dumpwallet(const JSONRPCRequest& request)\n     return reply;\n }\n \n+struct UsageMaps {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14558#discussion_r227708275",
      "id" : 227708275,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNzcwODI3NQ==",
      "original_commit_id" : "45a5d3d989124e1c496de5b4f4e77c670e3cf193",
      "original_position" : 4,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 4,
      "pull_request_review_id" : 167808800,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14558",
      "updated_at" : "2018-10-24T09:22:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227708275",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14558#discussion_r227786140"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14558"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227786140"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes. The functions `GetKey`, `GetPubKey`, and `GetCScript` are all const functions and need to be in order to override the `CBasicKeyStore` versions of them. However, those functions need to modify the usage maps. If they were in `AllUsedKeyStore`, those functions would not be const. By having them in a separate struct that has a pointer in `AllUsedKeyStore`, the functions can remain const but still allow us to update the usage info.",
      "commit_id" : "7b93302c48cb67b16093da9ec4394b671fb11779",
      "created_at" : "2018-10-24T13:25:13Z",
      "diff_hunk" : "@@ -805,6 +805,111 @@ UniValue dumpwallet(const JSONRPCRequest& request)\n     return reply;\n }\n \n+struct UsageMaps {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14558#discussion_r227786140",
      "id" : 227786140,
      "in_reply_to_id" : 227708275,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNzc4NjE0MA==",
      "original_commit_id" : "45a5d3d989124e1c496de5b4f4e77c670e3cf193",
      "original_position" : 4,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 4,
      "pull_request_review_id" : 167904841,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14558",
      "updated_at" : "2018-10-24T13:25:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227786140",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14558#discussion_r227789618"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14558"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227789618"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Got it, thanks. ",
      "commit_id" : "7b93302c48cb67b16093da9ec4394b671fb11779",
      "created_at" : "2018-10-24T13:33:36Z",
      "diff_hunk" : "@@ -805,6 +805,111 @@ UniValue dumpwallet(const JSONRPCRequest& request)\n     return reply;\n }\n \n+struct UsageMaps {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14558#discussion_r227789618",
      "id" : 227789618,
      "in_reply_to_id" : 227708275,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNzc4OTYxOA==",
      "original_commit_id" : "45a5d3d989124e1c496de5b4f4e77c670e3cf193",
      "original_position" : 4,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 4,
      "pull_request_review_id" : 167909269,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14558",
      "updated_at" : "2018-10-24T13:33:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227789618",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14558#discussion_r227789783"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14558"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227789783"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is leaking.",
      "commit_id" : "7b93302c48cb67b16093da9ec4394b671fb11779",
      "created_at" : "2018-10-24T13:33:59Z",
      "diff_hunk" : "@@ -805,35 +805,190 @@ UniValue dumpwallet(const JSONRPCRequest& request)\n     return reply;\n }\n \n+struct UsageMaps {\n+    using ScriptUseMap = std::map<CScriptID, bool>;\n+    using WatchKeyUseMap = std::map<CKeyID, bool>;\n+    using KeyUseMap = std::map<CKeyID, bool>;\n+\n+    WatchKeyUseMap map_watch_key_use;\n+    ScriptUseMap map_script_use;\n+    KeyUseMap map_key_use;\n+};\n+\n+// Class which remembers whether every script and public key was used\n+class AllUsedKeyStore : public CBasicKeyStore\n+{\n+private:\n+    struct UsageMaps* usage = new UsageMaps();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14558#discussion_r227789783",
      "id" : 227789783,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNzc4OTc4Mw==",
      "original_commit_id" : "7b93302c48cb67b16093da9ec4394b671fb11779",
      "original_position" : 18,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 18,
      "pull_request_review_id" : 167909481,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14558",
      "updated_at" : "2018-10-24T13:34:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227789783",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14558#discussion_r227790036"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14558"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227790036"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit, could remove struct?",
      "commit_id" : "7b93302c48cb67b16093da9ec4394b671fb11779",
      "created_at" : "2018-10-24T13:34:29Z",
      "diff_hunk" : "@@ -805,35 +805,190 @@ UniValue dumpwallet(const JSONRPCRequest& request)\n     return reply;\n }\n \n+struct UsageMaps {\n+    using ScriptUseMap = std::map<CScriptID, bool>;\n+    using WatchKeyUseMap = std::map<CKeyID, bool>;\n+    using KeyUseMap = std::map<CKeyID, bool>;\n+\n+    WatchKeyUseMap map_watch_key_use;\n+    ScriptUseMap map_script_use;\n+    KeyUseMap map_key_use;\n+};\n+\n+// Class which remembers whether every script and public key was used\n+class AllUsedKeyStore : public CBasicKeyStore\n+{\n+private:\n+    struct UsageMaps* usage = new UsageMaps();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14558#discussion_r227790036",
      "id" : 227790036,
      "in_reply_to_id" : 227789783,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNzc5MDAzNg==",
      "original_commit_id" : "7b93302c48cb67b16093da9ec4394b671fb11779",
      "original_position" : 18,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 18,
      "pull_request_review_id" : 167909481,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14558",
      "updated_at" : "2018-10-24T13:34:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/227790036",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
