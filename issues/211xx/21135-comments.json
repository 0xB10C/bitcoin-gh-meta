[
   {
      "author_association" : "MEMBER",
      "body" : "Aside from the missing test additions, this approach is currently too naive. There is likely to be the presence of `endbr64` instructions in the .text section, which we do not control (i.e from libc). I'm also not sure that targeting a specific symbol via objdump will work, as that will still dump all output after the symbol (and may require a too newer version of objdump).",
      "created_at" : "2021-02-10T07:59:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21135#issuecomment-776518855",
      "id" : 776518855,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21135",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NjUxODg1NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-10T07:59:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/776518855",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> There is likely to be the presence of endbr64 instructions in the .text section, which we do not control (i.e from libc). \r\n\r\nThe check is naive, but maybe enough. Let's update test-security-check for it and see if it distinguishes between the hardening flag being present or not?\r\n\r\nRemember that we do not link libc statically at this point so there should be no instructions from libc in the binary.\r\n",
      "created_at" : "2021-02-10T10:07:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21135#issuecomment-776596749",
      "id" : 776596749,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21135",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NjU5Njc0OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-10T10:07:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/776596749",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21135#discussion_r573599866"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21135"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/573599866"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Does PE have a `.text` section?",
      "commit_id" : "27e98161c63dcbde09893bd015eda5e6b7aabf6a",
      "created_at" : "2021-02-10T10:08:20Z",
      "diff_hunk" : "@@ -184,6 +198,14 @@ def check_PE_NX(executable) -> bool:\n     bits = get_PE_dll_characteristics(executable)\n     return (bits & IMAGE_DLL_CHARACTERISTICS_NX_COMPAT) == IMAGE_DLL_CHARACTERISTICS_NX_COMPAT\n \n+def check_PE_control_flow_instrumentation(executable) -> bool:\n+    stdout = run_command([OBJDUMP_CMD, '-d', '--section=.text', executable])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21135#discussion_r573599866",
      "id" : 573599866,
      "line" : 202,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzU5OTg2Ng==",
      "original_commit_id" : "27e98161c63dcbde09893bd015eda5e6b7aabf6a",
      "original_line" : 202,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "contrib/devtools/security-check.py",
      "position" : 26,
      "pull_request_review_id" : 587441005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21135",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-10T10:08:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/573599866",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21135#discussion_r573608783"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21135"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/573608783"
         }
      },
      "author_association" : "MEMBER",
      "body" : "At some point we might want to add a 'skipped' return status for checks that could not be performed for a platform (they would count as true for the final return value, but might be displayed differently).",
      "commit_id" : "27e98161c63dcbde09893bd015eda5e6b7aabf6a",
      "created_at" : "2021-02-10T10:21:31Z",
      "diff_hunk" : "@@ -143,6 +143,20 @@ def check_ELF_separate_code(executable):\n                 return False\n     return True\n \n+def check_ELF_control_flow_instrumentation(executable) -> bool:\n+\n+    elf = pixie.load(executable)\n+\n+    if elf.hdr.e_machine is not pixie.EM_X86_64:\n+        return True",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21135#discussion_r573608783",
      "id" : 573608783,
      "line" : 151,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzYwODc4Mw==",
      "original_commit_id" : "27e98161c63dcbde09893bd015eda5e6b7aabf6a",
      "original_line" : 151,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "contrib/devtools/security-check.py",
      "position" : 9,
      "pull_request_review_id" : 587452671,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21135",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-10T10:21:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/573608783",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21135#discussion_r573609698"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21135"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/573609698"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's too bad that x86 has variable-length instructions (so it's tricky to find instruction boundaries), or we could just look in the section contents for the raw instruction instead of parsing text.",
      "commit_id" : "27e98161c63dcbde09893bd015eda5e6b7aabf6a",
      "created_at" : "2021-02-10T10:22:54Z",
      "diff_hunk" : "@@ -184,6 +198,14 @@ def check_PE_NX(executable) -> bool:\n     bits = get_PE_dll_characteristics(executable)\n     return (bits & IMAGE_DLL_CHARACTERISTICS_NX_COMPAT) == IMAGE_DLL_CHARACTERISTICS_NX_COMPAT\n \n+def check_PE_control_flow_instrumentation(executable) -> bool:\n+    stdout = run_command([OBJDUMP_CMD, '-d', '--section=.text', executable])\n+\n+    for line in stdout.splitlines():\n+        if 'endbr64' in line:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21135#discussion_r573609698",
      "id" : 573609698,
      "line" : 205,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzYwOTY5OA==",
      "original_commit_id" : "27e98161c63dcbde09893bd015eda5e6b7aabf6a",
      "original_line" : 205,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "contrib/devtools/security-check.py",
      "position" : 29,
      "pull_request_review_id" : 587453861,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21135",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-10T10:23:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/573609698",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
