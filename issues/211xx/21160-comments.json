[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#22850](https://github.com/bitcoin/bitcoin/pull/22850) (net: Make m_mempool optional in PeerManager by sriramdvt)\n* [#22791](https://github.com/bitcoin/bitcoin/pull/22791) (init: Fix asmap/addrman initialization order bug by jnewbery)\n* [#22778](https://github.com/bitcoin/bitcoin/pull/22778) (net processing: Reduce resource usage for inbound block-relay-only connections by jnewbery)\n* [#22777](https://github.com/bitcoin/bitcoin/pull/22777) (net processing: don't request tx relay on feeler connections by jnewbery)\n* [#22053](https://github.com/bitcoin/bitcoin/pull/22053) (refactor: Release cs_main before MaybeSendFeefilter by MarcoFalke)\n* [#21954](https://github.com/bitcoin/bitcoin/pull/21954) (Some minor code changes to improve efficiency of processing TXs by rebroad)\n* [#21527](https://github.com/bitcoin/bitcoin/pull/21527) (net_processing: lock clean up by ajtowns)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-02-12T22:39:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-778494756",
      "id" : 778494756,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3ODQ5NDc1Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-01T18:05:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/778494756",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on master to pick up fix for interface_zmq.py in #21008.",
      "created_at" : "2021-02-22T08:48:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-783204949",
      "id" : 783204949,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4MzIwNDk0OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-22T08:48:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/783204949",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebase resulted in silent merge conflict with 9476886353dffb730dcb75799f2bd5e143425795. I'll fix tomorrow.",
      "created_at" : "2021-02-22T19:10:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-783605323",
      "id" : 783605323,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4MzYwNTMyMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-22T19:10:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/783605323",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've rebased this and moved it out of draft. It's now ready for review.",
      "created_at" : "2021-03-18T11:06:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-801832376",
      "id" : 801832376,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMTgzMjM3Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-18T11:06:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/801832376",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597635838"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597635838"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "\r\n```suggestion\r\n    /** Whether we should relay transactions to this peer (he asked us to in his version message and this is not a `ConnectionType::BLOCK_RELAY` connection). This only changes from\r\n```",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-19T12:23:21Z",
      "diff_hunk" : "@@ -551,34 +549,14 @@ class CNode\n     std::chrono::microseconds m_next_addr_send GUARDED_BY(cs_sendProcessing){0};\n     std::chrono::microseconds m_next_local_addr_send GUARDED_BY(cs_sendProcessing){0};\n \n-    struct TxRelay {\n-        mutable RecursiveMutex cs_filter;\n-        // We use fRelayTxes for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n-        bool fRelayTxes GUARDED_BY(cs_filter){false};\n-        std::unique_ptr<CBloomFilter> pfilter PT_GUARDED_BY(cs_filter) GUARDED_BY(cs_filter){nullptr};\n-\n-        mutable RecursiveMutex cs_tx_inventory;\n-        CRollingBloomFilter filterInventoryKnown GUARDED_BY(cs_tx_inventory){50000, 0.000001};\n-        // Set of transaction ids we still have to announce.\n-        // They are sorted by the mempool before relay, so the order is not important.\n-        std::set<uint256> setInventoryTxToSend;\n-        // Used for BIP35 mempool sending\n-        bool fSendMempool GUARDED_BY(cs_tx_inventory){false};\n-        // Last time a \"MEMPOOL\" request was serviced.\n-        std::atomic<std::chrono::seconds> m_last_mempool_req{0s};\n-        std::chrono::microseconds nNextInvSend{0};\n-\n-        /** Minimum fee rate with which to filter inv's to this node */\n-        std::atomic<CAmount> minFeeFilter{0};\n-        CAmount lastSentFeeFilter{0};\n-        std::chrono::microseconds m_next_send_feefilter{0};\n-    };\n+    /** Whether this peer asked us to relay transactions. This only changes from",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597635838",
      "id" : 597635838,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzYzNTgzOA==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 552,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 616342920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597635838",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597653259"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597653259"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "_(comment on irrelevant line)_\r\n\r\nIn the commit message of 465e9da51c56beaa97f5ffcdf2132471b591a8d5 `[net] Add CNode.m_relays_txs and CNode.m_bloom_filter_loaded`:\r\n\r\n```diff\r\n     This is currently redundant information with m_tx_relay->fRelayTxes,\r\n-    but m_tx_relay is moved into net_processing, then we'll need these\r\n+    but when m_tx_relay is moved into net_processing, then we'll need these\r\n     separate fields in CNode.\r\n```",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-19T12:52:41Z",
      "diff_hunk" : "@@ -565,12 +565,6 @@ void CNode::copyStats(CNodeStats &stats, const std::vector<bool> &m_asmap)\n     X(addrBind);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597653259",
      "id" : 597653259,
      "line" : 570,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzY1MzI1OQ==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 570,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 1,
      "pull_request_review_id" : 616342920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597653259",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597670155"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597670155"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This can be reduced to just:\r\n```cpp\r\nvEvictionCandidates.push_back(*node);\r\n```\r\nBy using a [conversion function](https://en.cppreference.com/w/cpp/language/cast_operator) from `CNode` to `NodeEvictionCandidate`.\r\n\r\nMaybe out of the scope of this PR.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-19T13:18:41Z",
      "diff_hunk" : "@@ -974,18 +963,11 @@ bool CConnman::AttemptToEvictConnection()\n                 continue;\n             if (node->fDisconnect)\n                 continue;\n-            bool peer_relay_txes = false;\n-            bool peer_filter_not_null = false;\n-            if (node->m_tx_relay != nullptr) {\n-                LOCK(node->m_tx_relay->cs_filter);\n-                peer_relay_txes = node->m_tx_relay->fRelayTxes;\n-                peer_filter_not_null = node->m_tx_relay->pfilter != nullptr;\n-            }\n             NodeEvictionCandidate candidate = {node->GetId(), node->nTimeConnected, node->m_min_ping_time,\n                                                node->nLastBlockTime, node->nLastTXTime,\n                                                HasAllDesirableServiceFlags(node->nServices),\n-                                               peer_relay_txes, peer_filter_not_null, node->nKeyedNetGroup,\n-                                               node->m_prefer_evict, node->addr.IsLocal()};\n+                                               node->m_relays_txs.load(), node->m_bloom_filter_loaded.load(),\n+                                               node->nKeyedNetGroup, node->m_prefer_evict, node->addr.IsLocal()};\n             vEvictionCandidates.push_back(candidate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597670155",
      "id" : 597670155,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzY3MDE1NQ==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 1008,
      "original_position" : 70,
      "original_start_line" : 966,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 616342920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597670155",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597701349"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597701349"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    for (auto& [node_id, peer] : m_peer_map) {\r\n```",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-19T14:00:58Z",
      "diff_hunk" : "@@ -1460,17 +1508,16 @@ void PeerManagerImpl::SendPings()\n \n void PeerManagerImpl::RelayTransaction(const uint256& txid, const uint256& wtxid)\n {\n-    m_connman.ForEachNode([&txid, &wtxid](CNode* pnode) EXCLUSIVE_LOCKS_REQUIRED(::cs_main) {\n-        AssertLockHeld(::cs_main);\n-\n-        CNodeState* state = State(pnode->GetId());\n-        if (state == nullptr) return;\n-        if (state->m_wtxid_relay) {\n-            pnode->PushTxInventory(wtxid);\n-        } else {\n-            pnode->PushTxInventory(txid);\n+    LOCK(m_peer_mutex);\n+    for(auto& it : m_peer_map) {\n+        Peer& peer = *it.second;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597701349",
      "id" : 597701349,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzcwMTM0OQ==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 1566,
      "original_position" : 184,
      "original_start_line" : 1512,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 616342920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597701349",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597719018"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597719018"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This was moved from below without the accompanying assert, better move the assert with it.\r\n```suggestion\r\n        m_wtxid_relay_peers -= peer->m_wtxid_relay;\r\n        assert(m_wtxid_relay_peers >= 0);\r\n```",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-19T14:24:01Z",
      "diff_hunk" : "@@ -983,6 +1023,7 @@ void PeerManagerImpl::FinalizeNode(const CNode& node, bool& fUpdateConnectionTim\n         PeerRef peer = RemovePeer(nodeid);\n         assert(peer != nullptr);\n         misbehavior = WITH_LOCK(peer->m_misbehavior_mutex, return peer->m_misbehavior_score);\n+        m_wtxid_relay_peers -= peer->m_wtxid_relay;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597719018",
      "id" : 597719018,
      "line" : 1085,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzcxOTAxOA==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 1085,
      "original_position" : 142,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 142,
      "pull_request_review_id" : 616342920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597719018",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597719805"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597719805"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This assert can/should be moved up, where the decrement was moved to.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-19T14:25:04Z",
      "diff_hunk" : "@@ -1006,7 +1047,6 @@ void PeerManagerImpl::FinalizeNode(const CNode& node, bool& fUpdateConnectionTim\n     assert(nPeersWithValidatedDownloads >= 0);\n     m_outbound_peers_with_protect_from_disconnect -= state->m_chain_sync.m_protect;\n     assert(m_outbound_peers_with_protect_from_disconnect >= 0);\n-    m_wtxid_relay_peers -= state->m_wtxid_relay;\n     assert(m_wtxid_relay_peers >= 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597719805",
      "id" : 597719805,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzcxOTgwNQ==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 1050,
      "original_position" : 151,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 616342920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597719805",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597787675"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597787675"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Just a note:\r\n\r\nBefore this change both `CNodeState::m_wtxid_relay` and `PeerManagerImpl::m_wtxid_relay_peers` would have been modified under `cs_main`. After this change `Peer::m_wtxid_relay` and `PeerManagerImpl::m_wtxid_relay_peers` are not anymore modified together under `cs_main`.\r\n\r\nThis means that after `peer->m_wtxid_relay = true` and before `m_wtxid_relay_peers++` the system is in an observable state where the sum of all `Peer::m_wtxid_relay` does not equal `PeerManagerImpl::m_wtxid_relay_peers`.\r\n\r\nI think this is ok - couldn't find any code that would be upset by that.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-19T15:49:46Z",
      "diff_hunk" : "@@ -2597,9 +2645,8 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             return;\n         }\n         if (pfrom.GetCommonVersion() >= WTXID_RELAY_VERSION) {\n-            LOCK(cs_main);\n-            if (!State(pfrom.GetId())->m_wtxid_relay) {\n-                State(pfrom.GetId())->m_wtxid_relay = true;\n+            if (!peer->m_wtxid_relay) {\n+                peer->m_wtxid_relay = true;\n                 m_wtxid_relay_peers++;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597787675",
      "id" : 597787675,
      "line" : 2674,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5Nzc4NzY3NQ==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 2674,
      "original_position" : 271,
      "original_start_line" : 2600,
      "path" : "src/net_processing.cpp",
      "position" : 274,
      "pull_request_review_id" : 616342920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : 2622,
      "start_side" : "LEFT",
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597787675",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597797245"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597797245"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`explicit` can be removed because now we have 2 arguments.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-19T16:02:38Z",
      "diff_hunk" : "@@ -217,7 +250,10 @@ struct Peer {\n     /** Work queue of items requested by this peer **/\n     std::deque<CInv> m_getdata_requests GUARDED_BY(m_getdata_requests_mutex);\n \n-    explicit Peer(NodeId id) : m_id(id) {}\n+    explicit Peer(NodeId id, bool blocks_only)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597797245",
      "id" : 597797245,
      "line" : 255,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5Nzc5NzI0NQ==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 255,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 45,
      "pull_request_review_id" : 616342920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597797245",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597800447"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597800447"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why not a `Peer` method?",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-19T16:07:01Z",
      "diff_hunk" : "@@ -610,6 +643,14 @@ static CNodeState *State(NodeId pnode) EXCLUSIVE_LOCKS_REQUIRED(cs_main) {\n     return &it->second;\n }\n \n+static void AddKnownTx(Peer& peer, const uint256& hash)\n+{\n+    if (peer.m_tx_relay != nullptr) {\n+        LOCK(peer.m_tx_relay->m_tx_inventory_mutex);\n+        peer.m_tx_relay->m_tx_inventory_known_filter.insert(hash);\n+    }\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597800447",
      "id" : 597800447,
      "line" : 713,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzgwMDQ0Nw==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 713,
      "original_position" : 90,
      "original_start_line" : 646,
      "path" : "src/net_processing.cpp",
      "position" : 90,
      "pull_request_review_id" : 616342920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : 707,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597800447",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597817303"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597817303"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I think the rest of the code around `m_tx_relay` uses `== nullptr` or `!= nullptr`.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-19T16:30:30Z",
      "diff_hunk" : "@@ -1460,17 +1508,16 @@ void PeerManagerImpl::SendPings()\n \n void PeerManagerImpl::RelayTransaction(const uint256& txid, const uint256& wtxid)\n {\n-    m_connman.ForEachNode([&txid, &wtxid](CNode* pnode) EXCLUSIVE_LOCKS_REQUIRED(::cs_main) {\n-        AssertLockHeld(::cs_main);\n-\n-        CNodeState* state = State(pnode->GetId());\n-        if (state == nullptr) return;\n-        if (state->m_wtxid_relay) {\n-            pnode->PushTxInventory(wtxid);\n-        } else {\n-            pnode->PushTxInventory(txid);\n+    LOCK(m_peer_mutex);\n+    for(auto& it : m_peer_map) {\n+        Peer& peer = *it.second;\n+        if (!peer.m_tx_relay) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597817303",
      "id" : 597817303,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzgxNzMwMw==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 1524,
      "original_position" : 185,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 616342920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597817303",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597825250"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597825250"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This comment `// Use half...` was removed from `master` when `{INBOUND,OUTBOUND}_INVENTORY_BROADCAST_INTERVAL` were introduced. I think it better be removed because it implies OUTBOUND is INBOUND/2.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-19T16:42:31Z",
      "diff_hunk" : "@@ -4443,83 +4492,84 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             }\n             peer->m_blocks_for_inv_relay.clear();\n \n-            if (pto->m_tx_relay != nullptr) {\n-                LOCK(pto->m_tx_relay->cs_tx_inventory);\n+            if (peer->m_tx_relay != nullptr) {\n+                LOCK(peer->m_tx_relay->m_tx_inventory_mutex);\n                 // Check whether periodic sends should happen\n                 bool fSendTrickle = pto->HasPermission(PF_NOBAN);\n-                if (pto->m_tx_relay->nNextInvSend < current_time) {\n+                if (peer->m_tx_relay->m_next_inv_send_time < current_time) {\n                     fSendTrickle = true;\n                     if (pto->IsInboundConn()) {\n-                        pto->m_tx_relay->nNextInvSend = m_connman.PoissonNextSendInbound(current_time, INBOUND_INVENTORY_BROADCAST_INTERVAL);\n+                        peer->m_tx_relay->m_next_inv_send_time = m_connman.PoissonNextSendInbound(current_time, INBOUND_INVENTORY_BROADCAST_INTERVAL);\n                     } else {\n-                        pto->m_tx_relay->nNextInvSend = PoissonNextSend(current_time, OUTBOUND_INVENTORY_BROADCAST_INTERVAL);\n+                        // Use half the delay for outbound peers, as there is less privacy concern for them.\n+                        peer->m_tx_relay->m_next_inv_send_time = PoissonNextSend(current_time, OUTBOUND_INVENTORY_BROADCAST_INTERVAL);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597825250",
      "id" : 597825250,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzgyNTI1MA==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 4513,
      "original_position" : 443,
      "original_start_line" : 4455,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 616342920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597825250",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597831033"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597831033"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This change would only set the text if `stats->fNodeStateStatsAvailable` is `true` and will leave it \"uninitialized\" otherwise. What would be displayed in that case? Empty? Should something like `n/a` be displayed?\r\n\r\nThis looks like a regression in the UI - previously that text would always have been set (it was always known) and now - not anymore.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-19T16:50:30Z",
      "diff_hunk" : "@@ -1114,7 +1114,6 @@ void RPCConsole::updateDetailWidget()\n         peerAddrDetails += \"<br />\" + tr(\"via %1\").arg(QString::fromStdString(stats->nodeStats.addrLocal));\n     ui->peerHeading->setText(peerAddrDetails);\n     ui->peerServices->setText(GUIUtil::formatServicesStr(stats->nodeStats.nServices));\n-    ui->peerRelayTxes->setText(stats->nodeStats.fRelayTxes ? ts.yes : ts.no);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597831033",
      "id" : 597831033,
      "line" : 1031,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzgzMTAzMw==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 1031,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/qt/rpcconsole.cpp",
      "position" : 4,
      "pull_request_review_id" : 616342920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597831033",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597832782"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597832782"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Similarly to the UI - the fields `relaytxes` and `minfeefilter` would have always been present before and now - only if `fStateStats` is `true`.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-19T16:53:06Z",
      "diff_hunk" : "@@ -193,7 +193,6 @@ static RPCHelpMan getpeerinfo()\n         }\n         obj.pushKV(\"services\", strprintf(\"%016x\", stats.nServices));\n         obj.pushKV(\"servicesnames\", GetServicesNames(stats.nServices));\n-        obj.pushKV(\"relaytxes\", stats.fRelayTxes);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597832782",
      "id" : 597832782,
      "line" : 208,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzgzMjc4Mg==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 208,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 4,
      "pull_request_review_id" : 616342920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597832782",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-03-19T19:09:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-803051226",
      "id" : 803051226,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMzA1MTIyNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-19T19:09:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/803051226",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598088245"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598088245"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That means node_id is unused, which causes warnings depending on your compiler flags.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-20T09:29:33Z",
      "diff_hunk" : "@@ -1460,17 +1508,16 @@ void PeerManagerImpl::SendPings()\n \n void PeerManagerImpl::RelayTransaction(const uint256& txid, const uint256& wtxid)\n {\n-    m_connman.ForEachNode([&txid, &wtxid](CNode* pnode) EXCLUSIVE_LOCKS_REQUIRED(::cs_main) {\n-        AssertLockHeld(::cs_main);\n-\n-        CNodeState* state = State(pnode->GetId());\n-        if (state == nullptr) return;\n-        if (state->m_wtxid_relay) {\n-            pnode->PushTxInventory(wtxid);\n-        } else {\n-            pnode->PushTxInventory(txid);\n+    LOCK(m_peer_mutex);\n+    for(auto& it : m_peer_map) {\n+        Peer& peer = *it.second;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598088245",
      "id" : 598088245,
      "in_reply_to_id" : 597701349,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODA4ODI0NQ==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 1566,
      "original_position" : 184,
      "original_start_line" : 1512,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 616898279,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598088245",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598088432"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598088432"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We don't have a project style on whether to compare to `nullptr` or use a pointer's bool conversion. Both are fine.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-20T09:31:42Z",
      "diff_hunk" : "@@ -1460,17 +1508,16 @@ void PeerManagerImpl::SendPings()\n \n void PeerManagerImpl::RelayTransaction(const uint256& txid, const uint256& wtxid)\n {\n-    m_connman.ForEachNode([&txid, &wtxid](CNode* pnode) EXCLUSIVE_LOCKS_REQUIRED(::cs_main) {\n-        AssertLockHeld(::cs_main);\n-\n-        CNodeState* state = State(pnode->GetId());\n-        if (state == nullptr) return;\n-        if (state->m_wtxid_relay) {\n-            pnode->PushTxInventory(wtxid);\n-        } else {\n-            pnode->PushTxInventory(txid);\n+    LOCK(m_peer_mutex);\n+    for(auto& it : m_peer_map) {\n+        Peer& peer = *it.second;\n+        if (!peer.m_tx_relay) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598088432",
      "id" : 598088432,
      "in_reply_to_id" : 597817303,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODA4ODQzMg==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 1524,
      "original_position" : 185,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 616898381,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598088432",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2021-03-20T09:31:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-803279260",
      "id" : 803279260,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMzI3OTI2MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-20T09:31:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/803279260",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Doesn't compile",
      "created_at" : "2021-03-22T08:31:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-803869071",
      "id" : 803869071,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMzg2OTA3MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-22T08:31:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/803869071",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks Marco. Bad rebase should be fixed now.",
      "created_at" : "2021-03-22T09:34:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-803914027",
      "id" : 803914027,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMzkxNDAyNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-22T09:34:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/803914027",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review @vasild! I think I've addressed all of your review comments now.",
      "created_at" : "2021-03-22T09:54:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-803929392",
      "id" : 803929392,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMzkyOTM5Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-22T09:54:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/803929392",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567367"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567367"
         }
      },
      "author_association" : "MEMBER",
      "body" : "As above for the gui peer console.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-22T09:54:28Z",
      "diff_hunk" : "@@ -193,7 +193,6 @@ static RPCHelpMan getpeerinfo()\n         }\n         obj.pushKV(\"services\", strprintf(\"%016x\", stats.nServices));\n         obj.pushKV(\"servicesnames\", GetServicesNames(stats.nServices));\n-        obj.pushKV(\"relaytxes\", stats.fRelayTxes);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567367",
      "id" : 598567367,
      "in_reply_to_id" : 597832782,
      "line" : 208,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODU2NzM2Nw==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 208,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 4,
      "pull_request_review_id" : 617328539,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567367",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567395"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567395"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In reality, I think `fNodeStateStatsAvailable` will almost always be true, so this isn't a big issue (if it was, then the other stats in `nodeStateStats` not being available would also be an issue).",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-22T09:54:29Z",
      "diff_hunk" : "@@ -1114,7 +1114,6 @@ void RPCConsole::updateDetailWidget()\n         peerAddrDetails += \"<br />\" + tr(\"via %1\").arg(QString::fromStdString(stats->nodeStats.addrLocal));\n     ui->peerHeading->setText(peerAddrDetails);\n     ui->peerServices->setText(GUIUtil::formatServicesStr(stats->nodeStats.nServices));\n-    ui->peerRelayTxes->setText(stats->nodeStats.fRelayTxes ? ts.yes : ts.no);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567395",
      "id" : 598567395,
      "in_reply_to_id" : 597831033,
      "line" : 1031,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODU2NzM5NQ==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 1031,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/qt/rpcconsole.cpp",
      "position" : 4,
      "pull_request_review_id" : 617328577,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567395",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567467"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567467"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oops! Thank you. Removed.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-22T09:54:35Z",
      "diff_hunk" : "@@ -4443,83 +4492,84 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             }\n             peer->m_blocks_for_inv_relay.clear();\n \n-            if (pto->m_tx_relay != nullptr) {\n-                LOCK(pto->m_tx_relay->cs_tx_inventory);\n+            if (peer->m_tx_relay != nullptr) {\n+                LOCK(peer->m_tx_relay->m_tx_inventory_mutex);\n                 // Check whether periodic sends should happen\n                 bool fSendTrickle = pto->HasPermission(PF_NOBAN);\n-                if (pto->m_tx_relay->nNextInvSend < current_time) {\n+                if (peer->m_tx_relay->m_next_inv_send_time < current_time) {\n                     fSendTrickle = true;\n                     if (pto->IsInboundConn()) {\n-                        pto->m_tx_relay->nNextInvSend = m_connman.PoissonNextSendInbound(current_time, INBOUND_INVENTORY_BROADCAST_INTERVAL);\n+                        peer->m_tx_relay->m_next_inv_send_time = m_connman.PoissonNextSendInbound(current_time, INBOUND_INVENTORY_BROADCAST_INTERVAL);\n                     } else {\n-                        pto->m_tx_relay->nNextInvSend = PoissonNextSend(current_time, OUTBOUND_INVENTORY_BROADCAST_INTERVAL);\n+                        // Use half the delay for outbound peers, as there is less privacy concern for them.\n+                        peer->m_tx_relay->m_next_inv_send_time = PoissonNextSend(current_time, OUTBOUND_INVENTORY_BROADCAST_INTERVAL);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567467",
      "id" : 598567467,
      "in_reply_to_id" : 597825250,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODU2NzQ2Nw==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 4513,
      "original_position" : 443,
      "original_start_line" : 4455,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 617328685,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567467",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567518"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567518"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm trying to keep `Peer` as a data structure without any internal logic.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-22T09:54:39Z",
      "diff_hunk" : "@@ -610,6 +643,14 @@ static CNodeState *State(NodeId pnode) EXCLUSIVE_LOCKS_REQUIRED(cs_main) {\n     return &it->second;\n }\n \n+static void AddKnownTx(Peer& peer, const uint256& hash)\n+{\n+    if (peer.m_tx_relay != nullptr) {\n+        LOCK(peer.m_tx_relay->m_tx_inventory_mutex);\n+        peer.m_tx_relay->m_tx_inventory_known_filter.insert(hash);\n+    }\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567518",
      "id" : 598567518,
      "in_reply_to_id" : 597800447,
      "line" : 713,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODU2NzUxOA==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 713,
      "original_position" : 90,
      "original_start_line" : 646,
      "path" : "src/net_processing.cpp",
      "position" : 90,
      "pull_request_review_id" : 617328754,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : 707,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567518",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567565"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567565"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nice! Removed.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-22T09:54:42Z",
      "diff_hunk" : "@@ -217,7 +250,10 @@ struct Peer {\n     /** Work queue of items requested by this peer **/\n     std::deque<CInv> m_getdata_requests GUARDED_BY(m_getdata_requests_mutex);\n \n-    explicit Peer(NodeId id) : m_id(id) {}\n+    explicit Peer(NodeId id, bool blocks_only)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567565",
      "id" : 598567565,
      "in_reply_to_id" : 597797245,
      "line" : 255,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODU2NzU2NQ==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 255,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 45,
      "pull_request_review_id" : 617328814,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567565",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567603"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567603"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, that's a good observation. I agree that this is totally fine, and the fields don't need to be atomically updated under cs_main.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-22T09:54:45Z",
      "diff_hunk" : "@@ -2597,9 +2645,8 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             return;\n         }\n         if (pfrom.GetCommonVersion() >= WTXID_RELAY_VERSION) {\n-            LOCK(cs_main);\n-            if (!State(pfrom.GetId())->m_wtxid_relay) {\n-                State(pfrom.GetId())->m_wtxid_relay = true;\n+            if (!peer->m_wtxid_relay) {\n+                peer->m_wtxid_relay = true;\n                 m_wtxid_relay_peers++;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567603",
      "id" : 598567603,
      "in_reply_to_id" : 597787675,
      "line" : 2674,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODU2NzYwMw==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 2674,
      "original_position" : 271,
      "original_start_line" : 2600,
      "path" : "src/net_processing.cpp",
      "position" : 274,
      "pull_request_review_id" : 617328872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : 2622,
      "start_side" : "LEFT",
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567603",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567662"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567662"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-22T09:54:49Z",
      "diff_hunk" : "@@ -1006,7 +1047,6 @@ void PeerManagerImpl::FinalizeNode(const CNode& node, bool& fUpdateConnectionTim\n     assert(nPeersWithValidatedDownloads >= 0);\n     m_outbound_peers_with_protect_from_disconnect -= state->m_chain_sync.m_protect;\n     assert(m_outbound_peers_with_protect_from_disconnect >= 0);\n-    m_wtxid_relay_peers -= state->m_wtxid_relay;\n     assert(m_wtxid_relay_peers >= 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567662",
      "id" : 598567662,
      "in_reply_to_id" : 597719805,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODU2NzY2Mg==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 1050,
      "original_position" : 151,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 617328945,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567662",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567706"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567706"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-22T09:54:52Z",
      "diff_hunk" : "@@ -983,6 +1023,7 @@ void PeerManagerImpl::FinalizeNode(const CNode& node, bool& fUpdateConnectionTim\n         PeerRef peer = RemovePeer(nodeid);\n         assert(peer != nullptr);\n         misbehavior = WITH_LOCK(peer->m_misbehavior_mutex, return peer->m_misbehavior_score);\n+        m_wtxid_relay_peers -= peer->m_wtxid_relay;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567706",
      "id" : 598567706,
      "in_reply_to_id" : 597719018,
      "line" : 1085,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODU2NzcwNg==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 1085,
      "original_position" : 142,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 142,
      "pull_request_review_id" : 617329003,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567706",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567747"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567747"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Seems reasonable, but I agree it's out of scope for this PR.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-22T09:54:56Z",
      "diff_hunk" : "@@ -974,18 +963,11 @@ bool CConnman::AttemptToEvictConnection()\n                 continue;\n             if (node->fDisconnect)\n                 continue;\n-            bool peer_relay_txes = false;\n-            bool peer_filter_not_null = false;\n-            if (node->m_tx_relay != nullptr) {\n-                LOCK(node->m_tx_relay->cs_filter);\n-                peer_relay_txes = node->m_tx_relay->fRelayTxes;\n-                peer_filter_not_null = node->m_tx_relay->pfilter != nullptr;\n-            }\n             NodeEvictionCandidate candidate = {node->GetId(), node->nTimeConnected, node->m_min_ping_time,\n                                                node->nLastBlockTime, node->nLastTXTime,\n                                                HasAllDesirableServiceFlags(node->nServices),\n-                                               peer_relay_txes, peer_filter_not_null, node->nKeyedNetGroup,\n-                                               node->m_prefer_evict, node->addr.IsLocal()};\n+                                               node->m_relays_txs.load(), node->m_bloom_filter_loaded.load(),\n+                                               node->nKeyedNetGroup, node->m_prefer_evict, node->addr.IsLocal()};\n             vEvictionCandidates.push_back(candidate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567747",
      "id" : 598567747,
      "in_reply_to_id" : 597670155,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODU2Nzc0Nw==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 1008,
      "original_position" : 70,
      "original_start_line" : 966,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 617329063,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567747",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567802"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567802"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! Fixed.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-22T09:55:00Z",
      "diff_hunk" : "@@ -565,12 +565,6 @@ void CNode::copyStats(CNodeStats &stats, const std::vector<bool> &m_asmap)\n     X(addrBind);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567802",
      "id" : 598567802,
      "in_reply_to_id" : 597653259,
      "line" : 570,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODU2NzgwMg==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 570,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 1,
      "pull_request_review_id" : 617329134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567802",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567849"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567849"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's better. I've updated the comment.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-22T09:55:04Z",
      "diff_hunk" : "@@ -551,34 +549,14 @@ class CNode\n     std::chrono::microseconds m_next_addr_send GUARDED_BY(cs_sendProcessing){0};\n     std::chrono::microseconds m_next_local_addr_send GUARDED_BY(cs_sendProcessing){0};\n \n-    struct TxRelay {\n-        mutable RecursiveMutex cs_filter;\n-        // We use fRelayTxes for two purposes -\n-        // a) it allows us to not relay tx invs before receiving the peer's version message\n-        // b) the peer may tell us in its version message that we should not relay tx invs\n-        //    unless it loads a bloom filter.\n-        bool fRelayTxes GUARDED_BY(cs_filter){false};\n-        std::unique_ptr<CBloomFilter> pfilter PT_GUARDED_BY(cs_filter) GUARDED_BY(cs_filter){nullptr};\n-\n-        mutable RecursiveMutex cs_tx_inventory;\n-        CRollingBloomFilter filterInventoryKnown GUARDED_BY(cs_tx_inventory){50000, 0.000001};\n-        // Set of transaction ids we still have to announce.\n-        // They are sorted by the mempool before relay, so the order is not important.\n-        std::set<uint256> setInventoryTxToSend;\n-        // Used for BIP35 mempool sending\n-        bool fSendMempool GUARDED_BY(cs_tx_inventory){false};\n-        // Last time a \"MEMPOOL\" request was serviced.\n-        std::atomic<std::chrono::seconds> m_last_mempool_req{0s};\n-        std::chrono::microseconds nNextInvSend{0};\n-\n-        /** Minimum fee rate with which to filter inv's to this node */\n-        std::atomic<CAmount> minFeeFilter{0};\n-        CAmount lastSentFeeFilter{0};\n-        std::chrono::microseconds m_next_send_feefilter{0};\n-    };\n+    /** Whether this peer asked us to relay transactions. This only changes from",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r598567849",
      "id" : 598567849,
      "in_reply_to_id" : 597635838,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODU2Nzg0OQ==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 552,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 617329188,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598567849",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> It seems sub-optimal that new fields are added - CNode::m_relays_txs and CNode::m_bloom_filter_loaded that are redundant/duplicates of Peer::TxRelay::m_relay_txs and Peer::TxRelay::m_bloom_filter != nullptr. This could be confusing and leaves a chance that in the future they go out of sync. Can the duplicates be avoided somehow?\r\n\r\nThat does seem a bit of a shame, but note that even though the data seems redundant, it's used for different purposes in net_processing and net. TxRelay in net_processing is data that is used in relaying transactions to that peer. `m_relay_txs` and `m_bloom_filter` in net are simply metrics used in the eviction logic. net_processing informs net of any events that might be used in net's eviction logic (e.g. min ping time, last tx received, last block received), and these new metrics (m_relay_txs and m_bloom_filter) are no different from those.",
      "created_at" : "2021-03-22T09:57:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-803931983",
      "id" : 803931983,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMzkzMTk4Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-22T09:57:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/803931983",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r599373279"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/599373279"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Which compiler flags produce a warning? I don't get any with either clang 12 or gcc 10:\r\n```cpp\r\n    std::map<int, int> m;\r\n    for (const auto& [x, y] : m) { // no warning\r\n        std::cout << x;\r\n    } \r\n    for (const auto& [x, y] : m) { // warning: unused structured binding declaration [-Wunused-variable]\r\n    } \r\n```",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-23T08:49:31Z",
      "diff_hunk" : "@@ -1460,17 +1508,16 @@ void PeerManagerImpl::SendPings()\n \n void PeerManagerImpl::RelayTransaction(const uint256& txid, const uint256& wtxid)\n {\n-    m_connman.ForEachNode([&txid, &wtxid](CNode* pnode) EXCLUSIVE_LOCKS_REQUIRED(::cs_main) {\n-        AssertLockHeld(::cs_main);\n-\n-        CNodeState* state = State(pnode->GetId());\n-        if (state == nullptr) return;\n-        if (state->m_wtxid_relay) {\n-            pnode->PushTxInventory(wtxid);\n-        } else {\n-            pnode->PushTxInventory(txid);\n+    LOCK(m_peer_mutex);\n+    for(auto& it : m_peer_map) {\n+        Peer& peer = *it.second;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r599373279",
      "id" : 599373279,
      "in_reply_to_id" : 597701349,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5OTM3MzI3OQ==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 1566,
      "original_position" : 184,
      "original_start_line" : 1512,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 618332615,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/599373279",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r599387582"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/599387582"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Now the move of the decrement happens in commit\r\n`[net processing] Move m_wtxid_relay to Peer`\r\nwhile the move of the assert happens in\r\n`[net processing] Move tx relay data to Peer`.\r\n\r\nI think both moves belong to the first commit.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-23T09:09:31Z",
      "diff_hunk" : "@@ -983,6 +1023,7 @@ void PeerManagerImpl::FinalizeNode(const CNode& node, bool& fUpdateConnectionTim\n         PeerRef peer = RemovePeer(nodeid);\n         assert(peer != nullptr);\n         misbehavior = WITH_LOCK(peer->m_misbehavior_mutex, return peer->m_misbehavior_score);\n+        m_wtxid_relay_peers -= peer->m_wtxid_relay;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r599387582",
      "id" : 599387582,
      "in_reply_to_id" : 597719018,
      "line" : 1085,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5OTM4NzU4Mg==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 1085,
      "original_position" : 142,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 142,
      "pull_request_review_id" : 618351297,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/599387582",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Reviewed 66baf28fe2b76d3f214714604e9e24e83f16c20e - the patch looks correct and I do not think it introduces bugs.\r\n\r\nI will try to see when the [UI](https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597831033) and [RPC](https://github.com/bitcoin/bitcoin/pull/21160#discussion_r597832782) fields could become empty/missing when they would have been filled/present before this PR.",
      "created_at" : "2021-03-23T09:18:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-804745886",
      "id" : 804745886,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwNDc0NTg4Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-23T09:18:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/804745886",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r599446966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/599446966"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmmm, if you search for \"c++ structured binding unused variable\", there do seem to be a lot of people claiming that they've encountered this warning. Like you, I've been unable to reproduce it, either locally or on godbolt.org with various compiler versions.\r\n\r\nIn any case, I'm going to leave this as it is, since it's only one more line and no less clear to explicitly declare the `Peer` object. Thank you for pointing this out though!",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-23T10:30:53Z",
      "diff_hunk" : "@@ -1460,17 +1508,16 @@ void PeerManagerImpl::SendPings()\n \n void PeerManagerImpl::RelayTransaction(const uint256& txid, const uint256& wtxid)\n {\n-    m_connman.ForEachNode([&txid, &wtxid](CNode* pnode) EXCLUSIVE_LOCKS_REQUIRED(::cs_main) {\n-        AssertLockHeld(::cs_main);\n-\n-        CNodeState* state = State(pnode->GetId());\n-        if (state == nullptr) return;\n-        if (state->m_wtxid_relay) {\n-            pnode->PushTxInventory(wtxid);\n-        } else {\n-            pnode->PushTxInventory(txid);\n+    LOCK(m_peer_mutex);\n+    for(auto& it : m_peer_map) {\n+        Peer& peer = *it.second;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r599446966",
      "id" : 599446966,
      "in_reply_to_id" : 597701349,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5OTQ0Njk2Ng==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 1566,
      "original_position" : 184,
      "original_start_line" : 1512,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 618428982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/599446966",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r599449012"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/599449012"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oops. Now fixed. Thank you!",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-23T10:33:53Z",
      "diff_hunk" : "@@ -983,6 +1023,7 @@ void PeerManagerImpl::FinalizeNode(const CNode& node, bool& fUpdateConnectionTim\n         PeerRef peer = RemovePeer(nodeid);\n         assert(peer != nullptr);\n         misbehavior = WITH_LOCK(peer->m_misbehavior_mutex, return peer->m_misbehavior_score);\n+        m_wtxid_relay_peers -= peer->m_wtxid_relay;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r599449012",
      "id" : 599449012,
      "in_reply_to_id" : 597719018,
      "line" : 1085,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5OTQ0OTAxMg==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 1085,
      "original_position" : 142,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 142,
      "pull_request_review_id" : 618431751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/599449012",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the re-review @vasild. I've updated the commits to address https://github.com/bitcoin/bitcoin/pull/21160#discussion_r599387582.",
      "created_at" : "2021-03-23T10:35:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-804795139",
      "id" : 804795139,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwNDc5NTEzOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-23T10:35:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/804795139",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r601883666"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/601883666"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I thought this could be `const` because you'd get the info from the `VERSION` and it wouldn't ever change, but then I realized the `Peer` struct is created before then, so it couldn't be const... is that accurate?",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-03-25T22:38:28Z",
      "diff_hunk" : "@@ -209,6 +209,39 @@ struct Peer {\n     /** Whether a ping has been requested by the user */\n     std::atomic<bool> m_ping_queued{false};\n \n+    /** Whether this peer relays txs via wtxid */\n+    bool m_wtxid_relay{false};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r601883666",
      "id" : 601883666,
      "line" : 215,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMTg4MzY2Ng==",
      "original_commit_id" : "72182a950c3bfb83d488f0cf0e4a7df1a663e36a",
      "original_line" : 215,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 5,
      "pull_request_review_id" : 621634594,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/601883666",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-03-29T10:12:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-809257844",
      "id" : 809257844,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwOTI1Nzg0NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-29T10:12:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/809257844",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2021-03-29T11:30:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-809304938",
      "id" : 809304938,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwOTMwNDkzOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-29T11:30:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/809304938",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-03-30T15:25:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-810353468",
      "id" : 810353468,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMDM1MzQ2OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-30T15:25:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/810353468",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased",
      "created_at" : "2021-03-30T15:48:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-810374111",
      "id" : 810374111,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMDM3NDExMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-30T15:48:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/810374111",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2021-04-01T08:16:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-811736077",
      "id" : 811736077,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMTczNjA3Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-01T08:16:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/811736077",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r623300544"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623300544"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why'd you delete the `explicit`?",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-04-29T18:39:04Z",
      "diff_hunk" : "@@ -218,7 +251,10 @@ struct Peer {\n     /** Work queue of items requested by this peer **/\n     std::deque<CInv> m_getdata_requests GUARDED_BY(m_getdata_requests_mutex);\n \n-    explicit Peer(NodeId id) : m_id(id) {}\n+    Peer(NodeId id, bool blocks_only)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r623300544",
      "id" : 623300544,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzMwMDU0NA==",
      "original_commit_id" : "6976a1c02ad0ea3a5c993b4ae886d4a86d458aa6",
      "original_line" : 254,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 621634594,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623300544",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r623305322"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623305322"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why is this `return` instead of `break`? Maybe I'm misunderstanding what this is doing, but I thought that we'd continue iterating through the others to relay to them, but returning seems like we're just skipping over the rest?",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-04-29T18:46:46Z",
      "diff_hunk" : "@@ -1470,17 +1518,16 @@ void PeerManagerImpl::SendPings()\n \n void PeerManagerImpl::RelayTransaction(const uint256& txid, const uint256& wtxid)\n {\n-    m_connman.ForEachNode([&txid, &wtxid](CNode* pnode) EXCLUSIVE_LOCKS_REQUIRED(::cs_main) {\n-        AssertLockHeld(::cs_main);\n-\n-        CNodeState* state = State(pnode->GetId());\n-        if (state == nullptr) return;\n-        if (state->m_wtxid_relay) {\n-            pnode->PushTxInventory(wtxid);\n-        } else {\n-            pnode->PushTxInventory(txid);\n+    LOCK(m_peer_mutex);\n+    for(auto& it : m_peer_map) {\n+        Peer& peer = *it.second;\n+        if (!peer.m_tx_relay) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r623305322",
      "id" : 623305322,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzMwNTMyMg==",
      "original_commit_id" : "6976a1c02ad0ea3a5c993b4ae886d4a86d458aa6",
      "original_line" : 1524,
      "original_position" : 187,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 621634594,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623305322",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r623676922"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623676922"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Correct. The `Peer` object is constructed before we receive the `wtxidrelay` message, so we can't make this const.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-04-30T07:35:55Z",
      "diff_hunk" : "@@ -209,6 +209,39 @@ struct Peer {\n     /** Whether a ping has been requested by the user */\n     std::atomic<bool> m_ping_queued{false};\n \n+    /** Whether this peer relays txs via wtxid */\n+    bool m_wtxid_relay{false};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r623676922",
      "id" : 623676922,
      "in_reply_to_id" : 601883666,
      "line" : 215,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzY3NjkyMg==",
      "original_commit_id" : "72182a950c3bfb83d488f0cf0e4a7df1a663e36a",
      "original_line" : 215,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 5,
      "pull_request_review_id" : 648957979,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623676922",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r623748168"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623748168"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No good reason. I've put it back.",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-04-30T09:37:42Z",
      "diff_hunk" : "@@ -218,7 +251,10 @@ struct Peer {\n     /** Work queue of items requested by this peer **/\n     std::deque<CInv> m_getdata_requests GUARDED_BY(m_getdata_requests_mutex);\n \n-    explicit Peer(NodeId id) : m_id(id) {}\n+    Peer(NodeId id, bool blocks_only)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r623748168",
      "id" : 623748168,
      "in_reply_to_id" : 623300544,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzc0ODE2OA==",
      "original_commit_id" : "6976a1c02ad0ea3a5c993b4ae886d4a86d458aa6",
      "original_line" : 254,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 649049041,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:37:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623748168",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r623748907"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623748907"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yikes. Good catch. In a previous iteration of this PR, I had a `ForEachPeer()` helper that took a lambda, and this `return` was effectively a `continue` (the lambda would return and then be called for the remaining peers). Now fixed!",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-04-30T09:39:02Z",
      "diff_hunk" : "@@ -1470,17 +1518,16 @@ void PeerManagerImpl::SendPings()\n \n void PeerManagerImpl::RelayTransaction(const uint256& txid, const uint256& wtxid)\n {\n-    m_connman.ForEachNode([&txid, &wtxid](CNode* pnode) EXCLUSIVE_LOCKS_REQUIRED(::cs_main) {\n-        AssertLockHeld(::cs_main);\n-\n-        CNodeState* state = State(pnode->GetId());\n-        if (state == nullptr) return;\n-        if (state->m_wtxid_relay) {\n-            pnode->PushTxInventory(wtxid);\n-        } else {\n-            pnode->PushTxInventory(txid);\n+    LOCK(m_peer_mutex);\n+    for(auto& it : m_peer_map) {\n+        Peer& peer = *it.second;\n+        if (!peer.m_tx_relay) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r623748907",
      "id" : 623748907,
      "in_reply_to_id" : 623305322,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzc0ODkwNw==",
      "original_commit_id" : "6976a1c02ad0ea3a5c993b4ae886d4a86d458aa6",
      "original_line" : 1524,
      "original_position" : 187,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 649050014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T09:39:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623748907",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review @glozow. I've rebased on master and addressed your review comments.\r\n\r\n#21527 moves around the locks in net_processing, which interacts a bit with how this PR moves `m_wtxid_relay` around. I think it makes sense to focus on merging that PR first, since that could simplify the locking here a bit.",
      "created_at" : "2021-04-30T09:50:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-829980035",
      "id" : 829980035,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyOTk4MDAzNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-30T09:50:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/829980035",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--4a62be1de6b64f3ed646cdc7932c8cf5-->\nðµï¸ @sipa has been requested to review this pull request as specified in the REVIEWERS file.",
      "created_at" : "2021-05-03T09:34:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-831142707",
      "id" : 831142707,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzMTE0MjcwNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-03T09:34:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/831142707",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'll rebase this after #21527 is merged",
      "created_at" : "2021-05-03T10:55:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-831184841",
      "id" : 831184841,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzMTE4NDg0MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-03T10:55:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/831184841",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r628113336"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628113336"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`explicit` prevents implicit conversions for _single-argument_ constructors. After the change above, the constructor has 2 arguments. See https://stackoverflow.com/a/121163",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-05-07T10:49:52Z",
      "diff_hunk" : "@@ -218,7 +251,10 @@ struct Peer {\n     /** Work queue of items requested by this peer **/\n     std::deque<CInv> m_getdata_requests GUARDED_BY(m_getdata_requests_mutex);\n \n-    explicit Peer(NodeId id) : m_id(id) {}\n+    Peer(NodeId id, bool blocks_only)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r628113336",
      "id" : 628113336,
      "in_reply_to_id" : 623300544,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyODExMzMzNg==",
      "original_commit_id" : "6976a1c02ad0ea3a5c993b4ae886d4a86d458aa6",
      "original_line" : 254,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 654326462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-07T10:49:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628113336",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r628132981"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628132981"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`explicit` will also prevent implicit conversion for multiple-argument constructors. Is there a reason why {int,bool} should implicitly be converted into Peer?",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-05-07T11:22:14Z",
      "diff_hunk" : "@@ -218,7 +251,10 @@ struct Peer {\n     /** Work queue of items requested by this peer **/\n     std::deque<CInv> m_getdata_requests GUARDED_BY(m_getdata_requests_mutex);\n \n-    explicit Peer(NodeId id) : m_id(id) {}\n+    Peer(NodeId id, bool blocks_only)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r628132981",
      "id" : 628132981,
      "in_reply_to_id" : 623300544,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyODEzMjk4MQ==",
      "original_commit_id" : "6976a1c02ad0ea3a5c993b4ae886d4a86d458aa6",
      "original_line" : 254,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 654352154,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-07T11:22:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628132981",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r628152277"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628152277"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Alright: https://stackoverflow.com/questions/39122101/explicit-constructor-taking-multiple-arguments",
      "commit_id" : "f4199182e1e240786df897e16ac3810393a93aa0",
      "created_at" : "2021-05-07T11:57:06Z",
      "diff_hunk" : "@@ -218,7 +251,10 @@ struct Peer {\n     /** Work queue of items requested by this peer **/\n     std::deque<CInv> m_getdata_requests GUARDED_BY(m_getdata_requests_mutex);\n \n-    explicit Peer(NodeId id) : m_id(id) {}\n+    Peer(NodeId id, bool blocks_only)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r628152277",
      "id" : 628152277,
      "in_reply_to_id" : 623300544,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyODE1MjI3Nw==",
      "original_commit_id" : "6976a1c02ad0ea3a5c993b4ae886d4a86d458aa6",
      "original_line" : 254,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 654377665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-07T11:57:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628152277",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've rebased this on top of the _net_processing: add m_mutex_message_handling_ commit from #21527. I'm leaving as WIP for now, but it's in a state where people can review it. I'll move it out of draft as soon as #21527 or #22053 is merged (should be a trivial rebase).",
      "created_at" : "2021-05-28T10:14:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-850312983",
      "id" : 850312983,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1MDMxMjk4Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-28T14:54:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/850312983",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'd rebased this on top of some of the work in #21527, since they conflicted a little. However, it seems that 21527 has now been abandoned, so I've removed that commit and marked this PR ready for review again. If 21527 does get picked up again and merged, then it should be easy enough to rebase this on top of it.",
      "created_at" : "2021-08-13T10:25:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-898357737",
      "id" : 898357737,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "IC_kwDOABII5841i9np",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-13T10:25:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/898357737",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r689506531"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689506531"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I have a question about this code (not related to this PR though) - why don't we lock `m_tx_inventory_mutex` here?",
      "commit_id" : "2533ea5161d2cb15b3a43e0fea9b146f525aea97",
      "created_at" : "2021-08-16T12:48:58Z",
      "diff_hunk" : "@@ -4710,83 +4745,83 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             peer->m_blocks_for_inv_relay.clear();\n         }\n \n-        if (pto->m_tx_relay != nullptr) {\n-                LOCK(pto->m_tx_relay->cs_tx_inventory);\n+        if (peer->m_tx_relay != nullptr) {\n+                LOCK(peer->m_tx_relay->m_tx_inventory_mutex);\n                 // Check whether periodic sends should happen\n                 bool fSendTrickle = pto->HasPermission(NetPermissionFlags::NoBan);\n-                if (pto->m_tx_relay->nNextInvSend < current_time) {\n+                if (peer->m_tx_relay->m_next_inv_send_time < current_time) {\n                     fSendTrickle = true;\n                     if (pto->IsInboundConn()) {\n-                        pto->m_tx_relay->nNextInvSend = m_connman.PoissonNextSendInbound(current_time, INBOUND_INVENTORY_BROADCAST_INTERVAL);\n+                        peer->m_tx_relay->m_next_inv_send_time = m_connman.PoissonNextSendInbound(current_time, INBOUND_INVENTORY_BROADCAST_INTERVAL);\n                     } else {\n-                        pto->m_tx_relay->nNextInvSend = PoissonNextSend(current_time, OUTBOUND_INVENTORY_BROADCAST_INTERVAL);\n+                        peer->m_tx_relay->m_next_inv_send_time = PoissonNextSend(current_time, OUTBOUND_INVENTORY_BROADCAST_INTERVAL);\n                     }\n                 }\n \n                 // Time to send but the peer has requested we not relay transactions.\n                 if (fSendTrickle) {\n-                    LOCK(pto->m_tx_relay->cs_filter);\n-                    if (!pto->m_tx_relay->fRelayTxes) pto->m_tx_relay->setInventoryTxToSend.clear();\n+                    LOCK(peer->m_tx_relay->m_bloom_filter_mutex);\n+                    if (!peer->m_tx_relay->m_relay_txs) peer->m_tx_relay->m_tx_inventory_to_send.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r689506531",
      "id" : 689506531,
      "line" : 4762,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTUwNjUzMQ==",
      "original_commit_id" : "cef5afc817214aa3f5e60fa1fd4a64872d6ee9a4",
      "original_line" : 4762,
      "original_position" : 557,
      "original_start_line" : 4728,
      "path" : "src/net_processing.cpp",
      "position" : 557,
      "pull_request_review_id" : 730672874,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : 4725,
      "start_side" : "LEFT",
      "updated_at" : "2021-08-16T16:50:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689506531",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on master",
      "created_at" : "2021-08-16T13:32:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-899514121",
      "id" : 899514121,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "IC_kwDOABII5841nX8J",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-16T13:32:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/899514121",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r689641819"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689641819"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 203bfe156b0a25a36c19fba397c8b2577bab1e9b: Noted that the line `LOCK2(cs_main, g_cs_orphans)` was moved down a few lines, and my reasoning for why this is okay was:\r\n\r\n- Whether a peer does wtxid relay, i.e. the value of `peer->m_wtxid_relay`, wouldn't change, and either way wouldn't require `cs_main` or `g_cs_orphans`\r\n- The peer inventory data is guarded by `cs_tx_inventory` and that's grabbed within `AddKnownTx`",
      "commit_id" : "2533ea5161d2cb15b3a43e0fea9b146f525aea97",
      "created_at" : "2021-08-16T15:32:36Z",
      "diff_hunk" : "@@ -3212,6 +3205,8 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             pfrom.AddKnownTx(txid);\n         }\n \n+        LOCK2(cs_main, g_cs_orphans);\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r689641819",
      "id" : 689641819,
      "line" : 3245,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTY0MTgxOQ==",
      "original_commit_id" : "203bfe156b0a25a36c19fba397c8b2577bab1e9b",
      "original_line" : 3209,
      "original_position" : 155,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 371,
      "pull_request_review_id" : 730672874,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-16T16:50:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689641819",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r689646357"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689646357"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 203bfe156b0a25a36c19fba397c8b2577bab1e9b: not changed in this PR, but it's odd to me that we're subtracting a bool from an int? Why isn't it `if (peer->m_wtxid_relay) m_wtxid_relay_peers -= 1;` ?",
      "commit_id" : "2533ea5161d2cb15b3a43e0fea9b146f525aea97",
      "created_at" : "2021-08-16T15:38:21Z",
      "diff_hunk" : "@@ -1199,6 +1195,8 @@ void PeerManagerImpl::FinalizeNode(const CNode& node)\n         PeerRef peer = RemovePeer(nodeid);\n         assert(peer != nullptr);\n         misbehavior = WITH_LOCK(peer->m_misbehavior_mutex, return peer->m_misbehavior_score);\n+        m_wtxid_relay_peers -= peer->m_wtxid_relay;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r689646357",
      "id" : 689646357,
      "line" : 1237,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTY0NjM1Nw==",
      "original_commit_id" : "203bfe156b0a25a36c19fba397c8b2577bab1e9b",
      "original_line" : 1198,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 162,
      "pull_request_review_id" : 730672874,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-16T16:50:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689646357",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r689696008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689696008"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 2533ea5161d2cb15b3a43e0fea9b146f525aea97\r\n\r\nNoting that we have 3 variables named `m_relay_txs`: in `NodeEvictionCandidate`, `Peer.TxRelay`, and `CNodeStateStats`. And we have a `CNode.m_relays_txs` (very similar but not same name) where `CNode.m_relays_txs == Peer.m_tx_relay.m_relay_txs` always, and they are not the same thing as `Peer.m_tx_relay != nullptr`.",
      "commit_id" : "2533ea5161d2cb15b3a43e0fea9b146f525aea97",
      "created_at" : "2021-08-16T16:44:26Z",
      "diff_hunk" : "@@ -227,28 +227,28 @@ struct Peer {\n     bool m_wtxid_relay{false};\n \n     struct TxRelay {\n-        mutable RecursiveMutex cs_filter;\n-        // We use fRelayTxes for two purposes -\n+        mutable RecursiveMutex m_bloom_filter_mutex;\n+        // We use m_relay_txs for two purposes -\n         // a) it allows us to not relay tx invs before receiving the peer's version message\n         // b) the peer may tell us in its version message that we should not relay tx invs\n         //    unless it loads a bloom filter.\n-        bool fRelayTxes GUARDED_BY(cs_filter){false};\n-        std::unique_ptr<CBloomFilter> pfilter PT_GUARDED_BY(cs_filter) GUARDED_BY(cs_filter){nullptr};\n+        bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r689696008",
      "id" : 689696008,
      "line" : 235,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTY5NjAwOA==",
      "original_commit_id" : "2533ea5161d2cb15b3a43e0fea9b146f525aea97",
      "original_line" : 235,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 13,
      "pull_request_review_id" : 730672874,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-16T16:50:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/689696008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r690220985"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690220985"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmmm, actually `m_tx_inventory_mutex` is held at this point (see line 4747 above):\r\n\r\n```c++\r\n        if (peer->m_tx_relay != nullptr) {\r\n                LOCK(peer->m_tx_relay->m_tx_inventory_mutex);\r\n                ...\r\n```\r\n\r\nIn fact, all access of `m_tx_inventory_to_send` (and `setInventoryTxToSend` in master) is guarded by `m_tx_inventory_mutex` (`cs_tx_inventory` in master). It looks like an oversight in #13123 that a lock annotation wasn't added to `setInventoryTxToSend`. It could also be added to ` m_next_inv_send_time` (`nNextInvSend` in master).\r\n\r\nWe could add those annotations in a follow-up, since this branch is simply moving the data members and not changing any behavior here. I also have a separate follow-up branch that rationalizes these mutexes to a single mutex.",
      "commit_id" : "2533ea5161d2cb15b3a43e0fea9b146f525aea97",
      "created_at" : "2021-08-17T10:00:33Z",
      "diff_hunk" : "@@ -4710,83 +4745,83 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             peer->m_blocks_for_inv_relay.clear();\n         }\n \n-        if (pto->m_tx_relay != nullptr) {\n-                LOCK(pto->m_tx_relay->cs_tx_inventory);\n+        if (peer->m_tx_relay != nullptr) {\n+                LOCK(peer->m_tx_relay->m_tx_inventory_mutex);\n                 // Check whether periodic sends should happen\n                 bool fSendTrickle = pto->HasPermission(NetPermissionFlags::NoBan);\n-                if (pto->m_tx_relay->nNextInvSend < current_time) {\n+                if (peer->m_tx_relay->m_next_inv_send_time < current_time) {\n                     fSendTrickle = true;\n                     if (pto->IsInboundConn()) {\n-                        pto->m_tx_relay->nNextInvSend = m_connman.PoissonNextSendInbound(current_time, INBOUND_INVENTORY_BROADCAST_INTERVAL);\n+                        peer->m_tx_relay->m_next_inv_send_time = m_connman.PoissonNextSendInbound(current_time, INBOUND_INVENTORY_BROADCAST_INTERVAL);\n                     } else {\n-                        pto->m_tx_relay->nNextInvSend = PoissonNextSend(current_time, OUTBOUND_INVENTORY_BROADCAST_INTERVAL);\n+                        peer->m_tx_relay->m_next_inv_send_time = PoissonNextSend(current_time, OUTBOUND_INVENTORY_BROADCAST_INTERVAL);\n                     }\n                 }\n \n                 // Time to send but the peer has requested we not relay transactions.\n                 if (fSendTrickle) {\n-                    LOCK(pto->m_tx_relay->cs_filter);\n-                    if (!pto->m_tx_relay->fRelayTxes) pto->m_tx_relay->setInventoryTxToSend.clear();\n+                    LOCK(peer->m_tx_relay->m_bloom_filter_mutex);\n+                    if (!peer->m_tx_relay->m_relay_txs) peer->m_tx_relay->m_tx_inventory_to_send.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r690220985",
      "id" : 690220985,
      "in_reply_to_id" : 689506531,
      "line" : 4762,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MDIyMDk4NQ==",
      "original_commit_id" : "cef5afc817214aa3f5e60fa1fd4a64872d6ee9a4",
      "original_line" : 4762,
      "original_position" : 557,
      "original_start_line" : 4728,
      "path" : "src/net_processing.cpp",
      "position" : 557,
      "pull_request_review_id" : 731568701,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : 4725,
      "start_side" : "LEFT",
      "updated_at" : "2021-08-17T10:00:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690220985",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r690222852"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690222852"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Right. This `LOCK(cs_main)` was required to access the `CNodeState` in the line below. Now that `m_wtxid_relay` is in `Peer`, we don't need to hold `cs_main` until a little bit later (when we access `m_txrequest`).",
      "commit_id" : "2533ea5161d2cb15b3a43e0fea9b146f525aea97",
      "created_at" : "2021-08-17T10:03:11Z",
      "diff_hunk" : "@@ -3212,6 +3205,8 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             pfrom.AddKnownTx(txid);\n         }\n \n+        LOCK2(cs_main, g_cs_orphans);\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r690222852",
      "id" : 690222852,
      "in_reply_to_id" : 689641819,
      "line" : 3245,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MDIyMjg1Mg==",
      "original_commit_id" : "203bfe156b0a25a36c19fba397c8b2577bab1e9b",
      "original_line" : 3209,
      "original_position" : 155,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 371,
      "pull_request_review_id" : 731571308,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-17T10:03:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690222852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r690224534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690224534"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree that would be clearer.",
      "commit_id" : "2533ea5161d2cb15b3a43e0fea9b146f525aea97",
      "created_at" : "2021-08-17T10:05:30Z",
      "diff_hunk" : "@@ -1199,6 +1195,8 @@ void PeerManagerImpl::FinalizeNode(const CNode& node)\n         PeerRef peer = RemovePeer(nodeid);\n         assert(peer != nullptr);\n         misbehavior = WITH_LOCK(peer->m_misbehavior_mutex, return peer->m_misbehavior_score);\n+        m_wtxid_relay_peers -= peer->m_wtxid_relay;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r690224534",
      "id" : 690224534,
      "in_reply_to_id" : 689646357,
      "line" : 1237,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MDIyNDUzNA==",
      "original_commit_id" : "203bfe156b0a25a36c19fba397c8b2577bab1e9b",
      "original_line" : 1198,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 162,
      "pull_request_review_id" : 731573586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-17T10:05:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690224534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r690225534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690225534"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, this is slightly unfortunate. Please let me know if you have suggestions for improving the naming.",
      "commit_id" : "2533ea5161d2cb15b3a43e0fea9b146f525aea97",
      "created_at" : "2021-08-17T10:07:03Z",
      "diff_hunk" : "@@ -227,28 +227,28 @@ struct Peer {\n     bool m_wtxid_relay{false};\n \n     struct TxRelay {\n-        mutable RecursiveMutex cs_filter;\n-        // We use fRelayTxes for two purposes -\n+        mutable RecursiveMutex m_bloom_filter_mutex;\n+        // We use m_relay_txs for two purposes -\n         // a) it allows us to not relay tx invs before receiving the peer's version message\n         // b) the peer may tell us in its version message that we should not relay tx invs\n         //    unless it loads a bloom filter.\n-        bool fRelayTxes GUARDED_BY(cs_filter){false};\n-        std::unique_ptr<CBloomFilter> pfilter PT_GUARDED_BY(cs_filter) GUARDED_BY(cs_filter){nullptr};\n+        bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r690225534",
      "id" : 690225534,
      "in_reply_to_id" : 689696008,
      "line" : 235,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MDIyNTUzNA==",
      "original_commit_id" : "2533ea5161d2cb15b3a43e0fea9b146f525aea97",
      "original_line" : 235,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 13,
      "pull_request_review_id" : 731575017,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-17T10:07:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690225534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r691926265"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691926265"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Commit 203bfe156b0a25a36c19fba397c8b2577bab1e9b `[net processing] Move m_wtxid_relay to Peer` introduces a usage of `CConnMan::ForEachNode()` with a lambda that returns `true` and `false`, however it should have a return type of `void`.\r\n\r\nThis is later removed in a subsequent commit.",
      "commit_id" : "a192c23b2cb45e7c9a06bb00714347ef38df701f",
      "created_at" : "2021-08-19T09:03:40Z",
      "diff_hunk" : "@@ -1666,22 +1706,17 @@ void PeerManagerImpl::SendPings()\n \n void PeerManagerImpl::RelayTransaction(const uint256& txid, const uint256& wtxid)\n {\n-    WITH_LOCK(cs_main, _RelayTransaction(txid, wtxid););\n-}\n-\n-void PeerManagerImpl::_RelayTransaction(const uint256& txid, const uint256& wtxid)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r691926265",
      "id" : 691926265,
      "line" : 1672,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTkyNjI2NQ==",
      "original_commit_id" : "2533ea5161d2cb15b3a43e0fea9b146f525aea97",
      "original_line" : 1672,
      "original_position" : 195,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 195,
      "pull_request_review_id" : 733743042,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-19T11:57:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691926265",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r692115126"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692115126"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fixed.",
      "commit_id" : "a192c23b2cb45e7c9a06bb00714347ef38df701f",
      "created_at" : "2021-08-19T13:33:54Z",
      "diff_hunk" : "@@ -1666,22 +1706,17 @@ void PeerManagerImpl::SendPings()\n \n void PeerManagerImpl::RelayTransaction(const uint256& txid, const uint256& wtxid)\n {\n-    WITH_LOCK(cs_main, _RelayTransaction(txid, wtxid););\n-}\n-\n-void PeerManagerImpl::_RelayTransaction(const uint256& txid, const uint256& wtxid)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r692115126",
      "id" : 692115126,
      "in_reply_to_id" : 691926265,
      "line" : 1672,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MjExNTEyNg==",
      "original_commit_id" : "2533ea5161d2cb15b3a43e0fea9b146f525aea97",
      "original_line" : 1672,
      "original_position" : 195,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 195,
      "pull_request_review_id" : 733994263,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-19T13:33:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692115126",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review @vasild. I understand your arguments about the extra fields in `CNode` and removing the stats from the GUI and RPC when they're not available. I don't have anything to add beyond my responses from the first time you raised those points.",
      "created_at" : "2021-08-19T13:40:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-901924846",
      "id" : 901924846,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "IC_kwDOABII5841wkfu",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-19T13:40:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/901924846",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r692284808"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692284808"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, this change is a bit surprising.  FWIW I found that I needed to add null-checking for the new `m_addr_*` statestats in #22501 to avoid parsing errors.",
      "commit_id" : "a192c23b2cb45e7c9a06bb00714347ef38df701f",
      "created_at" : "2021-08-19T16:18:13Z",
      "diff_hunk" : "@@ -1114,7 +1114,6 @@ void RPCConsole::updateDetailWidget()\n         peerAddrDetails += \"<br />\" + tr(\"via %1\").arg(QString::fromStdString(stats->nodeStats.addrLocal));\n     ui->peerHeading->setText(peerAddrDetails);\n     ui->peerServices->setText(GUIUtil::formatServicesStr(stats->nodeStats.nServices));\n-    ui->peerRelayTxes->setText(stats->nodeStats.fRelayTxes ? ts.yes : ts.no);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r692284808",
      "id" : 692284808,
      "in_reply_to_id" : 597831033,
      "line" : 1138,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MjI4NDgwOA==",
      "original_commit_id" : "0fb9ffba48215bb8b0ff4a56e253bc7c7678ef85",
      "original_line" : 1138,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/qt/rpcconsole.cpp",
      "position" : 4,
      "pull_request_review_id" : 734214143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-19T18:31:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/692284808",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Thanks for the review @vasild. I understand your arguments about the extra fields in `CNode` and removing the stats from the GUI and RPC when they're not available.\r\n\r\n(If helpful, mentioning https://github.com/bitcoin/bitcoin/pull/21160#discussion_r692284808 here, as that thread is closed as resolved.)",
      "created_at" : "2021-08-19T16:22:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-902052740",
      "id" : 902052740,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "IC_kwDOABII5841xDuE",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-19T16:22:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/902052740",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r693531183"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693531183"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there a reason for the bool to exist? What would happen if we delayed initialization of the whole txrelay struct to when the version message is received?\r\n\r\nSomething similar is done for address relay, IIRC.",
      "commit_id" : "a192c23b2cb45e7c9a06bb00714347ef38df701f",
      "created_at" : "2021-08-22T17:15:50Z",
      "diff_hunk" : "@@ -227,28 +227,28 @@ struct Peer {\n     bool m_wtxid_relay{false};\n \n     struct TxRelay {\n-        mutable RecursiveMutex cs_filter;\n-        // We use fRelayTxes for two purposes -\n+        mutable RecursiveMutex m_bloom_filter_mutex;\n+        // We use m_relay_txs for two purposes -\n         // a) it allows us to not relay tx invs before receiving the peer's version message\n         // b) the peer may tell us in its version message that we should not relay tx invs\n         //    unless it loads a bloom filter.\n-        bool fRelayTxes GUARDED_BY(cs_filter){false};\n-        std::unique_ptr<CBloomFilter> pfilter PT_GUARDED_BY(cs_filter) GUARDED_BY(cs_filter){nullptr};\n+        bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r693531183",
      "id" : 693531183,
      "in_reply_to_id" : 689696008,
      "line" : 235,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzUzMTE4Mw==",
      "original_commit_id" : "2533ea5161d2cb15b3a43e0fea9b146f525aea97",
      "original_line" : 235,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 13,
      "pull_request_review_id" : 735595446,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-22T17:16:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693531183",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "re ACK a192c23b2cb45e7c9a06bb00714347ef38df701f via `git range-diff 2533ea5...a192c23`, no overall changes, diff moved between 2 commits.",
      "created_at" : "2021-08-23T08:51:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-903570095",
      "id" : 903570095,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "IC_kwDOABII584122Kv",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-23T08:51:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903570095",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r693924430"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693924430"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke yes, that's the plan. This PR is intended to be a simple refactor, and delaying initialization of the `TxRelay` struct requires more focused discussion so should be done in a separate PR.\r\n\r\nI've opened PR #22778, which implements delaying constructing `m_tx_relay` until the `version` message is received. Note however that `m_relay_txs` is still required - a peer that we've offered `NODE_BLOOM` services to may send us a version with `fRelay=0`, but later request that we start announcing transactions by sending `filterload` or `filterclear`, so we need to initialize the `TxRelay` struct during `version` handling but use `m_relay_txs` to gate whether we announce transactions.\r\n\r\nI'm going to mark this conversation as resolved, but please let me know in #22778 if you have any other thoughts/feedback.",
      "commit_id" : "a192c23b2cb45e7c9a06bb00714347ef38df701f",
      "created_at" : "2021-08-23T12:25:59Z",
      "diff_hunk" : "@@ -227,28 +227,28 @@ struct Peer {\n     bool m_wtxid_relay{false};\n \n     struct TxRelay {\n-        mutable RecursiveMutex cs_filter;\n-        // We use fRelayTxes for two purposes -\n+        mutable RecursiveMutex m_bloom_filter_mutex;\n+        // We use m_relay_txs for two purposes -\n         // a) it allows us to not relay tx invs before receiving the peer's version message\n         // b) the peer may tell us in its version message that we should not relay tx invs\n         //    unless it loads a bloom filter.\n-        bool fRelayTxes GUARDED_BY(cs_filter){false};\n-        std::unique_ptr<CBloomFilter> pfilter PT_GUARDED_BY(cs_filter) GUARDED_BY(cs_filter){nullptr};\n+        bool m_relay_txs GUARDED_BY(m_bloom_filter_mutex){false};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r693924430",
      "id" : 693924430,
      "in_reply_to_id" : 689696008,
      "line" : 235,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MzkyNDQzMA==",
      "original_commit_id" : "2533ea5161d2cb15b3a43e0fea9b146f525aea97",
      "original_line" : 235,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 13,
      "pull_request_review_id" : 736057234,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-23T12:26:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693924430",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-08-23T17:17:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-903962651",
      "id" : 903962651,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "IC_kwDOABII58414WAb",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-23T17:17:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903962651",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased",
      "created_at" : "2021-08-23T17:18:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-903963368",
      "id" : 903963368,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "IC_kwDOABII58414WLo",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-23T17:18:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903963368",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "concept ACK ",
      "created_at" : "2021-08-25T18:45:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-905784695",
      "id" : 905784695,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "IC_kwDOABII5841_S13",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-25T18:45:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/905784695",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased",
      "created_at" : "2021-08-27T10:00:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-907082625",
      "id" : 907082625,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "IC_kwDOABII5842EPuB",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-27T10:00:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/907082625",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "reACK 34bd2711e7ffa0d5a7b563d15d79f8ae1d8cef43 via `git range-diff a192c23...34bd271`",
      "created_at" : "2021-09-01T10:58:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-910169620",
      "id" : 910169620,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "IC_kwDOABII5842QBYU",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-01T10:58:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910169620",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.",
      "created_at" : "2021-09-01T11:02:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-910173096",
      "id" : 910173096,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "IC_kwDOABII5842QCOo",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-01T11:02:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910173096",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r701003777"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701003777"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit bc3bc6ceb7265b8ea9f530066e6b79c75881f2e4: Is there a reason to not use the shorter and more clear version `pfrom.m_relays_txs = fRelay`?",
      "commit_id" : "34bd2711e7ffa0d5a7b563d15d79f8ae1d8cef43",
      "created_at" : "2021-09-02T11:44:15Z",
      "diff_hunk" : "@@ -2593,6 +2593,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         if (pfrom.m_tx_relay != nullptr) {\n             LOCK(pfrom.m_tx_relay->cs_filter);\n             pfrom.m_tx_relay->fRelayTxes = fRelay; // set to true after we get the first filter* message\n+            if (fRelay) pfrom.m_relays_txs = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r701003777",
      "id" : 701003777,
      "line" : 2631,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTAwMzc3Nw==",
      "original_commit_id" : "bc3bc6ceb7265b8ea9f530066e6b79c75881f2e4",
      "original_line" : 2596,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 293,
      "pull_request_review_id" : 744953268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T14:29:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701003777",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r701105613"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701105613"
         }
      },
      "author_association" : "MEMBER",
      "body" : "c46d1f5eef34ec210a21d4700d6f2d4ca0b6941a: Is there some intuition available why this doesn't need any Mutex or atomic? The other members seem to have one.",
      "commit_id" : "34bd2711e7ffa0d5a7b563d15d79f8ae1d8cef43",
      "created_at" : "2021-09-02T13:53:14Z",
      "diff_hunk" : "@@ -223,6 +223,9 @@ struct Peer {\n     /** Whether a ping has been requested by the user */\n     std::atomic<bool> m_ping_queued{false};\n \n+    /** Whether this peer relays txs via wtxid */\n+    bool m_wtxid_relay{false};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r701105613",
      "id" : 701105613,
      "line" : 227,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTEwNTYxMw==",
      "original_commit_id" : "c46d1f5eef34ec210a21d4700d6f2d4ca0b6941a",
      "original_line" : 227,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 5,
      "pull_request_review_id" : 744953268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T14:29:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701105613",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r701114184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701114184"
         }
      },
      "author_association" : "MEMBER",
      "body" : "eeb0e84fc5c259dfd00f7673ad4a51582b100282: Would be nice to not break the fuzz test. Maybe a test-only mock method on PeerMan can do this?",
      "commit_id" : "34bd2711e7ffa0d5a7b563d15d79f8ae1d8cef43",
      "created_at" : "2021-09-02T14:01:56Z",
      "diff_hunk" : "@@ -204,18 +204,13 @@ void FillNode(FuzzedDataProvider& fuzzed_data_provider, CNode& node, bool init_v\n     const ServiceFlags remote_services = ConsumeWeakEnum(fuzzed_data_provider, ALL_SERVICE_FLAGS);\n     const NetPermissionFlags permission_flags = ConsumeWeakEnum(fuzzed_data_provider, ALL_NET_PERMISSION_FLAGS);\n     const int32_t version = fuzzed_data_provider.ConsumeIntegralInRange<int32_t>(MIN_PEER_PROTO_VERSION, std::numeric_limits<int32_t>::max());\n-    const bool filter_txs = fuzzed_data_provider.ConsumeBool();\n \n     node.nServices = remote_services;\n     node.m_permissionFlags = permission_flags;\n     if (init_version) {\n         node.nVersion = version;\n         node.SetCommonVersion(std::min(version, PROTOCOL_VERSION));\n     }\n-    if (node.m_tx_relay != nullptr) {\n-        LOCK(node.m_tx_relay->cs_filter);\n-        node.m_tx_relay->fRelayTxes = filter_txs;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r701114184",
      "id" : 701114184,
      "line" : 217,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTExNDE4NA==",
      "original_commit_id" : "eeb0e84fc5c259dfd00f7673ad4a51582b100282",
      "original_line" : 217,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/fuzz/util.cpp",
      "position" : 14,
      "pull_request_review_id" : 744953268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T14:29:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701114184",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r701118395"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701118395"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Was this addressed?",
      "commit_id" : "34bd2711e7ffa0d5a7b563d15d79f8ae1d8cef43",
      "created_at" : "2021-09-02T14:06:18Z",
      "diff_hunk" : "@@ -218,7 +251,10 @@ struct Peer {\n     /** Work queue of items requested by this peer **/\n     std::deque<CInv> m_getdata_requests GUARDED_BY(m_getdata_requests_mutex);\n \n-    explicit Peer(NodeId id) : m_id(id) {}\n+    Peer(NodeId id, bool blocks_only)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r701118395",
      "id" : 701118395,
      "in_reply_to_id" : 623300544,
      "line" : 317,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTExODM5NQ==",
      "original_commit_id" : "6976a1c02ad0ea3a5c993b4ae886d4a86d458aa6",
      "original_line" : 317,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 45,
      "pull_request_review_id" : 744953268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T14:29:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701118395",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r701121335"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701121335"
         }
      },
      "author_association" : "MEMBER",
      "body" : "eeb0e84fc5c259dfd00f7673ad4a51582b100282: Would be nice to rename this from `blocks_only` to `initialize_tx_relay` (or similar). `blocks_only` is confusingly similar named to the setting `-blocksonly`, but it really means block-relay-only.\r\n\r\nMoreover, the details *why* tx relay isn't initialized here don't matter *here*, so a bool with a more general name seems fine.",
      "commit_id" : "34bd2711e7ffa0d5a7b563d15d79f8ae1d8cef43",
      "created_at" : "2021-09-02T14:09:23Z",
      "diff_hunk" : "@@ -284,8 +314,9 @@ struct Peer {\n     /** Work queue of items requested by this peer **/\n     std::deque<CInv> m_getdata_requests GUARDED_BY(m_getdata_requests_mutex);\n \n-    explicit Peer(NodeId id)\n+    Peer(NodeId id, bool blocks_only)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r701121335",
      "id" : 701121335,
      "line" : 317,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTEyMTMzNQ==",
      "original_commit_id" : "eeb0e84fc5c259dfd00f7673ad4a51582b100282",
      "original_line" : 317,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 45,
      "pull_request_review_id" : 744953268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T14:29:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701121335",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r701123514"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701123514"
         }
      },
      "author_association" : "MEMBER",
      "body" : "eeb0e84fc5c259dfd00f7673ad4a51582b100282: any reason to make this code more fragile by removing the `else` in the move? The `else` used to set those to `false`, and `0`, respectively.",
      "commit_id" : "34bd2711e7ffa0d5a7b563d15d79f8ae1d8cef43",
      "created_at" : "2021-09-02T14:11:39Z",
      "diff_hunk" : "@@ -1286,6 +1325,11 @@ bool PeerManagerImpl::GetNodeStateStats(NodeId nodeid, CNodeStateStats& stats) c\n         ping_wait = GetTime<std::chrono::microseconds>() - peer->m_ping_start.load();\n     }\n \n+    if (peer->m_tx_relay != nullptr) {\n+        stats.fRelayTxes = WITH_LOCK(peer->m_tx_relay->cs_filter, return peer->m_tx_relay->fRelayTxes);\n+        stats.minFeeFilter = peer->m_tx_relay->minFeeFilter.load();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r701123514",
      "id" : 701123514,
      "line" : 1331,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTEyMzUxNA==",
      "original_commit_id" : "eeb0e84fc5c259dfd00f7673ad4a51582b100282",
      "original_line" : 1331,
      "original_position" : 123,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 183,
      "pull_request_review_id" : 744953268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T14:29:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701123514",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r701125057"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701125057"
         }
      },
      "author_association" : "MEMBER",
      "body" : "eeb0e84fc5c259dfd00f7673ad4a51582b100282: Why not `-1` (an impossible number), like the height values above? Or  maybe leave it uninitialized to make memory sanitizers more useful?",
      "commit_id" : "34bd2711e7ffa0d5a7b563d15d79f8ae1d8cef43",
      "created_at" : "2021-09-02T14:13:23Z",
      "diff_hunk" : "@@ -29,6 +29,8 @@ struct CNodeStateStats {\n     int m_starting_height = -1;\n     std::chrono::microseconds m_ping_wait;\n     std::vector<int> vHeightInFlight;\n+    bool fRelayTxes{false};\n+    CAmount minFeeFilter{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#discussion_r701125057",
      "id" : 701125057,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTEyNTA1Nw==",
      "original_commit_id" : "eeb0e84fc5c259dfd00f7673ad4a51582b100282",
      "original_line" : 33,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : null,
      "pull_request_review_id" : 744953268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21160",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T14:29:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701125057",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-09-06T10:59:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21160#issuecomment-913555312",
      "id" : 913555312,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21160",
      "node_id" : "IC_kwDOABII5842c79w",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-06T10:59:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/913555312",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
