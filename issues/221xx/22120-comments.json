[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Two concept ACKs, but this needs review comments addressing, added \"waiting for author\" https://github.com/bitcoin/bitcoin/pull/17872#issuecomment-815473116\r\n\r\nConcept ACK, cool you picked this up.\r\n\r\nnit: I think the title should be `test:` or `qa:` ie lower case rather than upper case\r\n\r\n> test, qa or ci for changes to the unit tests, QA tests or CI code test, https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#creating-the-pull-request",
      "created_at" : "2021-06-01T18:23:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22120#issuecomment-852348017",
      "id" : 852348017,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22120",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1MjM0ODAxNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-01T18:27:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/852348017",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22120#discussion_r643767595"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22120"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/643767595"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is a comment, there's no need to say \"NOTE\"\r\n```suggestion\r\n        # Need force_send because the block will get rejected without a getdata otherwise\r\n```",
      "commit_id" : "1e9796e31f8c8cc980688d2cf1fce60204fce03a",
      "created_at" : "2021-06-02T09:06:02Z",
      "diff_hunk" : "@@ -133,5 +136,19 @@ def run_test(self):\n         self.log.info(\"Test inflation by duplicating input\")\n         peer.send_blocks_and_test([block4], node, success=False,  reject_reason='bad-txns-inputs-duplicate')\n \n+\n+        self.log.info(\"Test accepting identical block after rejecting it due to a future timestamp.\")\n+\n+        t = int(time.time())\n+        node.setmocktime(t)\n+        block = create_block(tip, create_coinbase(height), t + 7201)\n+        block.hashMerkleRoot = block.calc_merkle_root()\n+        block.solve()\n+        # NOTE: Need force_send because the block will get rejected without a getdata otherwise",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22120#discussion_r643767595",
      "id" : 643767595,
      "line" : 147,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0Mzc2NzU5NQ==",
      "original_commit_id" : "1e9796e31f8c8cc980688d2cf1fce60204fce03a",
      "original_line" : 147,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "test/functional/p2p_invalid_block.py",
      "position" : 24,
      "pull_request_review_id" : 673937371,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22120",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-02T09:30:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/643767595",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22120#discussion_r643768936"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22120"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/643768936"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'd prefer referencing the p2p object directly instead of through the node's p2p list, similar to the code above. If a subtest is added that connects/disconnects peers, this index could no longer refer to the peer you want.\r\n\r\n```suggestion\r\n        peer.send_blocks_and_test([block], node, force_send=True, success=False, reject_reason='time-too-new')\r\n\r\n        node.setmocktime(t + 1)\r\n        peer.send_blocks_and_test([block], node, success=True, timeout=5)\r\n```",
      "commit_id" : "1e9796e31f8c8cc980688d2cf1fce60204fce03a",
      "created_at" : "2021-06-02T09:07:55Z",
      "diff_hunk" : "@@ -133,5 +136,19 @@ def run_test(self):\n         self.log.info(\"Test inflation by duplicating input\")\n         peer.send_blocks_and_test([block4], node, success=False,  reject_reason='bad-txns-inputs-duplicate')\n \n+\n+        self.log.info(\"Test accepting identical block after rejecting it due to a future timestamp.\")\n+\n+        t = int(time.time())\n+        node.setmocktime(t)\n+        block = create_block(tip, create_coinbase(height), t + 7201)\n+        block.hashMerkleRoot = block.calc_merkle_root()\n+        block.solve()\n+        # NOTE: Need force_send because the block will get rejected without a getdata otherwise\n+        node.p2ps[0].send_blocks_and_test([block], node, force_send=True, success=False, reject_reason='time-too-new')\n+\n+        node.setmocktime(t + 1)\n+        node.p2ps[0].send_blocks_and_test([block], node, success=True, timeout=5)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22120#discussion_r643768936",
      "id" : 643768936,
      "line" : 151,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0Mzc2ODkzNg==",
      "original_commit_id" : "1e9796e31f8c8cc980688d2cf1fce60204fce03a",
      "original_line" : 151,
      "original_position" : 28,
      "original_start_line" : 148,
      "path" : "test/functional/p2p_invalid_block.py",
      "position" : 28,
      "pull_request_review_id" : 673937371,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22120",
      "side" : "RIGHT",
      "start_line" : 148,
      "start_side" : "RIGHT",
      "updated_at" : "2021-06-02T09:30:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/643768936",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22120#discussion_r643774433"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22120"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/643774433"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is 1 second away from the cutoff right? Perhaps a slightly larger buffer would be better because the functional tests usually run multithreaded.",
      "commit_id" : "1e9796e31f8c8cc980688d2cf1fce60204fce03a",
      "created_at" : "2021-06-02T09:15:37Z",
      "diff_hunk" : "@@ -133,5 +136,19 @@ def run_test(self):\n         self.log.info(\"Test inflation by duplicating input\")\n         peer.send_blocks_and_test([block4], node, success=False,  reject_reason='bad-txns-inputs-duplicate')\n \n+\n+        self.log.info(\"Test accepting identical block after rejecting it due to a future timestamp.\")\n+\n+        t = int(time.time())\n+        node.setmocktime(t)\n+        block = create_block(tip, create_coinbase(height), t + 7201)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22120#discussion_r643774433",
      "id" : 643774433,
      "line" : 144,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0Mzc3NDQzMw==",
      "original_commit_id" : "1e9796e31f8c8cc980688d2cf1fce60204fce03a",
      "original_line" : 144,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/p2p_invalid_block.py",
      "position" : 21,
      "pull_request_review_id" : 673937371,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22120",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-02T09:30:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/643774433",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22120#discussion_r643778376"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22120"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/643778376"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Another small suggestion, using `2 * 60 * 60` or `MAX_FUTURE_BLOCK_TIME` instead of a magic number might be a bit more clear",
      "commit_id" : "1e9796e31f8c8cc980688d2cf1fce60204fce03a",
      "created_at" : "2021-06-02T09:21:05Z",
      "diff_hunk" : "@@ -133,5 +136,19 @@ def run_test(self):\n         self.log.info(\"Test inflation by duplicating input\")\n         peer.send_blocks_and_test([block4], node, success=False,  reject_reason='bad-txns-inputs-duplicate')\n \n+\n+        self.log.info(\"Test accepting identical block after rejecting it due to a future timestamp.\")\n+\n+        t = int(time.time())\n+        node.setmocktime(t)\n+        block = create_block(tip, create_coinbase(height), t + 7201)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22120#discussion_r643778376",
      "id" : 643778376,
      "in_reply_to_id" : 643774433,
      "line" : 144,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0Mzc3ODM3Ng==",
      "original_commit_id" : "1e9796e31f8c8cc980688d2cf1fce60204fce03a",
      "original_line" : 144,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/p2p_invalid_block.py",
      "position" : 21,
      "pull_request_review_id" : 673937371,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22120",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-02T09:30:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/643778376",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   }
]
