[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19438 (Introduce deploymentstatus by ajtowns)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-06-04T03:32:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22141#issuecomment-854332605",
      "id" : 854332605,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22141",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1NDMzMjYwNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-04T03:32:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/854332605",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22141#discussion_r645283961"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/645283961"
         }
      },
      "author_association" : "MEMBER",
      "body" : "How dare you make this ancient code so... readable?",
      "commit_id" : "2f4ad6b7efa408b8a858e87499bf6cfcdf936d73",
      "created_at" : "2021-06-04T04:40:23Z",
      "diff_hunk" : "@@ -768,23 +768,29 @@ bool PeerManagerImpl::IsBlockRequested(const uint256& hash)\n \n void PeerManagerImpl::MarkBlockAsReceived(const uint256& hash)\n {\n-    std::map<uint256, std::pair<NodeId, std::list<QueuedBlock>::iterator> >::iterator itInFlight = mapBlocksInFlight.find(hash);\n-    if (itInFlight != mapBlocksInFlight.end()) {\n-        CNodeState *state = State(itInFlight->second.first);\n-        assert(state != nullptr);\n-        if (state->vBlocksInFlight.begin() == itInFlight->second.second) {\n-            // First block on the queue was received, update the start download time for the next one\n-            state->m_downloading_since = std::max(state->m_downloading_since, GetTime<std::chrono::microseconds>());\n-        }\n-        state->vBlocksInFlight.erase(itInFlight->second.second);\n-        state->nBlocksInFlight--;\n-        if (state->nBlocksInFlight == 0) {\n-            // Last validated block on the queue was received.\n-            m_peers_downloading_from--;\n-        }\n-        state->m_stalling_since = 0us;\n-        mapBlocksInFlight.erase(itInFlight);\n+    auto it = mapBlocksInFlight.find(hash);\n+    if (it == mapBlocksInFlight.end()) {\n+        // Block was not requested\n+        return;\n+    }\n+\n+    auto [node_id, list_it] = it->second;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22141#discussion_r645283961",
      "id" : 645283961,
      "line" : 777,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NTI4Mzk2MQ==",
      "original_commit_id" : "2c45f832e87acd11fbd144cc0bb8e49816933c70",
      "original_line" : 777,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 94,
      "pull_request_review_id" : 675911344,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22141",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-04T04:43:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/645283961",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
