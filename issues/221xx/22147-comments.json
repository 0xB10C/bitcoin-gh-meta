[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22147#discussion_r645778792"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22147"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/645778792"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Optional, if retouch perhaps hoist the `3` here and in line 854 to a constexpr.",
      "commit_id" : "6efbcec4ded6116a42d2783c96c60ef0f255a1b2",
      "created_at" : "2021-06-04T18:41:23Z",
      "diff_hunk" : "@@ -825,12 +825,27 @@ void PeerManagerImpl::MaybeSetPeerAsAnnouncingHeaderAndIDs(NodeId nodeid)\n         return;\n     }\n     if (nodestate->fProvidesHeaderAndIDs) {\n+        int num_outbound_hb_peers = 0;\n         for (std::list<NodeId>::iterator it = lNodesAnnouncingHeaderAndIDs.begin(); it != lNodesAnnouncingHeaderAndIDs.end(); it++) {\n             if (*it == nodeid) {\n                 lNodesAnnouncingHeaderAndIDs.erase(it);\n                 lNodesAnnouncingHeaderAndIDs.push_back(nodeid);\n                 return;\n             }\n+            CNodeState *state = State(*it);\n+            if (state != nullptr && !state->m_is_inbound) ++num_outbound_hb_peers;\n+        }\n+        if (nodestate->m_is_inbound) {\n+            // If we're adding an inbound HB peer, make sure we're not removing\n+            // our last outbound HB peer in the process.\n+            if (lNodesAnnouncingHeaderAndIDs.size() >= 3 && num_outbound_hb_peers == 1) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22147#discussion_r645778792",
      "id" : 645778792,
      "line" : 841,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NTc3ODc5Mg==",
      "original_commit_id" : "6efbcec4ded6116a42d2783c96c60ef0f255a1b2",
      "original_line" : 841,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 17,
      "pull_request_review_id" : 676572076,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22147",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-04T18:48:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/645778792",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 6efbcec\r\n\r\nAs jonatack mentioned, I think extending the existing functional test would be good.",
      "created_at" : "2021-06-06T18:04:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22147#issuecomment-855438190",
      "id" : 855438190,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22147",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1NTQzODE5MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-06T18:04:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/855438190",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15145615?v=4",
         "events_url" : "https://api.github.com/users/Crypt-iQ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Crypt-iQ/followers",
         "following_url" : "https://api.github.com/users/Crypt-iQ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Crypt-iQ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Crypt-iQ",
         "id" : 15145615,
         "login" : "Crypt-iQ",
         "node_id" : "MDQ6VXNlcjE1MTQ1NjE1",
         "organizations_url" : "https://api.github.com/users/Crypt-iQ/orgs",
         "received_events_url" : "https://api.github.com/users/Crypt-iQ/received_events",
         "repos_url" : "https://api.github.com/users/Crypt-iQ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Crypt-iQ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Crypt-iQ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Crypt-iQ"
      }
   }
]
