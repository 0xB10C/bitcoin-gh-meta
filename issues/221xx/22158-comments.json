[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22158#discussion_r645929210"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/645929210"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Won't this fail on systems without rdrand?",
      "commit_id" : "5d407e4ef8e3a73c203f670c6a17cca50f7bd4fe",
      "created_at" : "2021-06-05T02:38:51Z",
      "diff_hunk" : "@@ -0,0 +1,72 @@\n+// Copyright (c) 2011-2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+//\n+#include <test/util/setup_common.h>\n+#include <boost/test/unit_test.hpp>\n+\n+#include <random.cpp>\n+\n+using namespace std;\n+\n+BOOST_FIXTURE_TEST_SUITE(hwrand_tests, BasicTestingSetup)\n+\n+BOOST_AUTO_TEST_CASE(rdx86seedhwslow_test)\n+{\n+    const size_t DIGEST_LEN = 512/8; // 512 bits = 64 bytes\n+\n+    unsigned char emptyoutput[DIGEST_LEN];\n+    memset(emptyoutput, 0, DIGEST_LEN);\n+    CSHA512 emptyhasher;\n+    emptyhasher.Finalize(emptyoutput);\n+\n+    for (int i = 0; i < 5; i++)\n+    {\n+        CSHA512 hasher;\n+        unsigned char output[DIGEST_LEN];\n+        memset(output, 0, DIGEST_LEN);\n+\n+        SeedHardwareSlow(hasher);\n+        hasher.Finalize(output);\n+        \n+        #if defined(__x86_64__) || defined(__amd64__) || defined(__i386__) || (defined(_MSC_VER) && (defined(_M_IX86) || defined(_M_X64)))\n+            bool isNotEqual = (memcmp(output, emptyoutput, DIGEST_LEN) != 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22158#discussion_r645929210",
      "id" : 645929210,
      "line" : 33,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NTkyOTIxMA==",
      "original_commit_id" : "507e0710fa2833a5a5ef7b13356451dc51a76fdf",
      "original_line" : 33,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/test/hwrand_tests.cpp",
      "position" : 33,
      "pull_request_review_id" : 676742660,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-05T02:38:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/645929210",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22158#discussion_r645930501"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/645930501"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yep on older x86 CPUs that don't support rdseed/rdrand, good catch!  Let me add a check for `g_rdrand_supported` and `g_rdseed_supported`",
      "commit_id" : "5d407e4ef8e3a73c203f670c6a17cca50f7bd4fe",
      "created_at" : "2021-06-05T02:52:55Z",
      "diff_hunk" : "@@ -0,0 +1,72 @@\n+// Copyright (c) 2011-2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+//\n+#include <test/util/setup_common.h>\n+#include <boost/test/unit_test.hpp>\n+\n+#include <random.cpp>\n+\n+using namespace std;\n+\n+BOOST_FIXTURE_TEST_SUITE(hwrand_tests, BasicTestingSetup)\n+\n+BOOST_AUTO_TEST_CASE(rdx86seedhwslow_test)\n+{\n+    const size_t DIGEST_LEN = 512/8; // 512 bits = 64 bytes\n+\n+    unsigned char emptyoutput[DIGEST_LEN];\n+    memset(emptyoutput, 0, DIGEST_LEN);\n+    CSHA512 emptyhasher;\n+    emptyhasher.Finalize(emptyoutput);\n+\n+    for (int i = 0; i < 5; i++)\n+    {\n+        CSHA512 hasher;\n+        unsigned char output[DIGEST_LEN];\n+        memset(output, 0, DIGEST_LEN);\n+\n+        SeedHardwareSlow(hasher);\n+        hasher.Finalize(output);\n+        \n+        #if defined(__x86_64__) || defined(__amd64__) || defined(__i386__) || (defined(_MSC_VER) && (defined(_M_IX86) || defined(_M_X64)))\n+            bool isNotEqual = (memcmp(output, emptyoutput, DIGEST_LEN) != 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22158#discussion_r645930501",
      "id" : 645930501,
      "in_reply_to_id" : 645929210,
      "line" : 33,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NTkzMDUwMQ==",
      "original_commit_id" : "507e0710fa2833a5a5ef7b13356451dc51a76fdf",
      "original_line" : 33,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/test/hwrand_tests.cpp",
      "position" : 33,
      "pull_request_review_id" : 676743492,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-05T03:02:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/645930501",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "node_id" : "MDQ6VXNlcjI3NDgxNA==",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   }
]
