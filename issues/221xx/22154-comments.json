[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20191 (wallet, refactor: make DescriptorScriptPubKeyMan agnostic of internal flag by S3RK)\n* #19602 (wallet: Migrate legacy wallets to descriptor wallets by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-06-05T05:28:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22154#issuecomment-855186772",
      "id" : 855186772,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22154",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1NTE4Njc3Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-05T05:28:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/855186772",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r646014986"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/646014986"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Do we intend to ever create those through this RPC? I think you'd use `deriveaddress` or so instead.",
      "commit_id" : "3f68bb5d6403d148930d7888c03e60fb00317acd",
      "created_at" : "2021-06-05T17:24:12Z",
      "diff_hunk" : "@@ -131,6 +131,9 @@ static RPCHelpMan createmultisig()\n         if (!ParseOutputType(request.params[2].get_str(), output_type)) {\n             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, strprintf(\"Unknown address type '%s'\", request.params[2].get_str()));\n         }\n+        if (output_type == OutputType::BECH32M) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Bech32m multisig addresses cannot be created yet\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r646014986",
      "id" : 646014986,
      "line" : 135,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NjAxNDk4Ng==",
      "original_commit_id" : "3f68bb5d6403d148930d7888c03e60fb00317acd",
      "original_line" : 135,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/misc.cpp",
      "position" : 5,
      "pull_request_review_id" : 676796365,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-05T17:24:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/646014986",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r646178016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/646178016"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Probably not. Changed the message.",
      "commit_id" : "73ddcb81fcff5f10429ef6e78efa14c09e95807f",
      "created_at" : "2021-06-06T19:41:36Z",
      "diff_hunk" : "@@ -131,6 +131,9 @@ static RPCHelpMan createmultisig()\n         if (!ParseOutputType(request.params[2].get_str(), output_type)) {\n             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, strprintf(\"Unknown address type '%s'\", request.params[2].get_str()));\n         }\n+        if (output_type == OutputType::BECH32M) {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Bech32m multisig addresses cannot be created yet\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r646178016",
      "id" : 646178016,
      "in_reply_to_id" : 646014986,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NjE3ODAxNg==",
      "original_commit_id" : "3f68bb5d6403d148930d7888c03e60fb00317acd",
      "original_line" : 135,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/misc.cpp",
      "position" : null,
      "pull_request_review_id" : 676897208,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-06T19:41:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/646178016",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r649585829"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649585829"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: could use `constexpr` I think",
      "commit_id" : "05ff76c3aad6905d984ba1764c8045ca530fbf8f",
      "created_at" : "2021-06-10T23:02:19Z",
      "diff_hunk" : "@@ -254,6 +254,13 @@ class ScriptPubKeyMan\n     boost::signals2::signal<void ()> NotifyCanGetAddressesChanged;\n };\n \n+/** OutputTypes supported by the LegacyScriptPubKeyMan */\n+static const std::unordered_set<OutputType> LEGACY_OUTPUT_TYPES {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r649585829",
      "id" : 649585829,
      "line" : 258,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTU4NTgyOQ==",
      "original_commit_id" : "fe7f3ee0e7b4a8718435711fa5b775620b5434f3",
      "original_line" : 258,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : 14,
      "pull_request_review_id" : 681325969,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-13T00:36:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649585829",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r649597195"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649597195"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hm, these error messages could be more clear, even if they are only temporary since they will be probably what people might run into with 0.22. Maybe return something similar as the log info above in both cases if the in this case?",
      "commit_id" : "05ff76c3aad6905d984ba1764c8045ca530fbf8f",
      "created_at" : "2021-06-10T23:37:23Z",
      "diff_hunk" : "@@ -373,5 +373,15 @@ def run_test(self):\n         self.test_address(4, self.nodes[4].getrawchangeaddress(), multisig=False, typ='p2sh-segwit')\n         self.test_address(4, self.nodes[4].getrawchangeaddress('bech32'), multisig=False, typ='bech32')\n \n+        if self.options.descriptors:\n+            self.log.info(\"Descriptor wallets do not have bech32m addreses by default yet\")\n+            # TODO: Remove this when they do\n+            assert_raises_rpc_error(-12, \"Error: No bech32m addresses available\", self.nodes[0].getnewaddress, \"\", \"bech32m\")\n+            assert_raises_rpc_error(-12, \"Error: Keypool ran out, please call keypoolrefill first\", self.nodes[0].getrawchangeaddress, \"bech32m\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r649597195",
      "id" : 649597195,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTU5NzE5NQ==",
      "original_commit_id" : "73ddcb81fcff5f10429ef6e78efa14c09e95807f",
      "original_line" : 380,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "test/functional/wallet_address_types.py",
      "position" : null,
      "pull_request_review_id" : 681325969,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-13T00:36:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649597195",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r649597262"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649597262"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "addresses",
      "commit_id" : "05ff76c3aad6905d984ba1764c8045ca530fbf8f",
      "created_at" : "2021-06-10T23:37:38Z",
      "diff_hunk" : "@@ -373,5 +373,15 @@ def run_test(self):\n         self.test_address(4, self.nodes[4].getrawchangeaddress(), multisig=False, typ='p2sh-segwit')\n         self.test_address(4, self.nodes[4].getrawchangeaddress('bech32'), multisig=False, typ='bech32')\n \n+        if self.options.descriptors:\n+            self.log.info(\"Descriptor wallets do not have bech32m addreses by default yet\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r649597262",
      "id" : 649597262,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTU5NzI2Mg==",
      "original_commit_id" : "73ddcb81fcff5f10429ef6e78efa14c09e95807f",
      "original_line" : 377,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/wallet_address_types.py",
      "position" : null,
      "pull_request_review_id" : 681325969,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-13T00:36:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649597262",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r650449568"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650449568"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Have you thought about placing asserts in `LegacyScriptPubKeyMan::KeepDestination`, `LegacyScriptPubKeyMan::GetKeyFromPool`, and `LegacyScriptPubKeyMan::LearnRelatedScripts`?",
      "commit_id" : "05ff76c3aad6905d984ba1764c8045ca530fbf8f",
      "created_at" : "2021-06-13T00:08:01Z",
      "diff_hunk" : "@@ -23,6 +23,11 @@ const uint32_t BIP32_HARDENED_KEY_LIMIT = 0x80000000;\n \n bool LegacyScriptPubKeyMan::GetNewDestination(const OutputType type, CTxDestination& dest, std::string& error)\n {\n+    if (LEGACY_OUTPUT_TYPES.count(type) == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r650449568",
      "id" : 650449568,
      "line" : 26,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDQ0OTU2OA==",
      "original_commit_id" : "fe7f3ee0e7b4a8718435711fa5b775620b5434f3",
      "original_line" : 26,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 4,
      "pull_request_review_id" : 681325969,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-13T00:36:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650449568",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r650449876"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650449876"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Can be `const`",
      "commit_id" : "05ff76c3aad6905d984ba1764c8045ca530fbf8f",
      "created_at" : "2021-06-13T00:12:02Z",
      "diff_hunk" : "@@ -1906,7 +1906,12 @@ OutputType CWallet::TransactionChangeType(const std::optional<OutputType>& chang\n         // Check if any destination contains a witness program:\n         int witnessversion = 0;\n         std::vector<unsigned char> witnessprogram;\n-        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {\n+        bool is_wit = recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r650449876",
      "id" : 650449876,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDQ0OTg3Ng==",
      "original_commit_id" : "26597ff64d82d6f6da39ca6f92fe66dce632c304",
      "original_line" : 1909,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 681325969,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-13T00:36:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650449876",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r650453322"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650453322"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Tried that but it doesn't work.",
      "commit_id" : "05ff76c3aad6905d984ba1764c8045ca530fbf8f",
      "created_at" : "2021-06-13T01:04:43Z",
      "diff_hunk" : "@@ -254,6 +254,13 @@ class ScriptPubKeyMan\n     boost::signals2::signal<void ()> NotifyCanGetAddressesChanged;\n };\n \n+/** OutputTypes supported by the LegacyScriptPubKeyMan */\n+static const std::unordered_set<OutputType> LEGACY_OUTPUT_TYPES {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r650453322",
      "id" : 650453322,
      "in_reply_to_id" : 649585829,
      "line" : 258,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDQ1MzMyMg==",
      "original_commit_id" : "fe7f3ee0e7b4a8718435711fa5b775620b5434f3",
      "original_line" : 258,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : 14,
      "pull_request_review_id" : 682362813,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-13T01:04:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650453322",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r650455933"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650455933"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You can't `constexpr` things that need allocation. You could use an array instead of an unordered_set, and use `std::find` to look up (which will likely be faster too, due to the tiny size), but it really doesn't matter here.",
      "commit_id" : "05ff76c3aad6905d984ba1764c8045ca530fbf8f",
      "created_at" : "2021-06-13T01:44:36Z",
      "diff_hunk" : "@@ -254,6 +254,13 @@ class ScriptPubKeyMan\n     boost::signals2::signal<void ()> NotifyCanGetAddressesChanged;\n };\n \n+/** OutputTypes supported by the LegacyScriptPubKeyMan */\n+static const std::unordered_set<OutputType> LEGACY_OUTPUT_TYPES {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r650455933",
      "id" : 650455933,
      "in_reply_to_id" : 649585829,
      "line" : 258,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDQ1NTkzMw==",
      "original_commit_id" : "fe7f3ee0e7b4a8718435711fa5b775620b5434f3",
      "original_line" : 258,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : 14,
      "pull_request_review_id" : 682364076,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-13T01:44:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650455933",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r650456180"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650456180"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've added a commit which allows `GetReservedDestination` to return real error messages. So this is now `No bech32m addresses available`.",
      "commit_id" : "05ff76c3aad6905d984ba1764c8045ca530fbf8f",
      "created_at" : "2021-06-13T01:48:24Z",
      "diff_hunk" : "@@ -373,5 +373,15 @@ def run_test(self):\n         self.test_address(4, self.nodes[4].getrawchangeaddress(), multisig=False, typ='p2sh-segwit')\n         self.test_address(4, self.nodes[4].getrawchangeaddress('bech32'), multisig=False, typ='bech32')\n \n+        if self.options.descriptors:\n+            self.log.info(\"Descriptor wallets do not have bech32m addreses by default yet\")\n+            # TODO: Remove this when they do\n+            assert_raises_rpc_error(-12, \"Error: No bech32m addresses available\", self.nodes[0].getnewaddress, \"\", \"bech32m\")\n+            assert_raises_rpc_error(-12, \"Error: Keypool ran out, please call keypoolrefill first\", self.nodes[0].getrawchangeaddress, \"bech32m\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r650456180",
      "id" : 650456180,
      "in_reply_to_id" : 649597195,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDQ1NjE4MA==",
      "original_commit_id" : "73ddcb81fcff5f10429ef6e78efa14c09e95807f",
      "original_line" : 380,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "test/functional/wallet_address_types.py",
      "position" : null,
      "pull_request_review_id" : 682364214,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-13T01:48:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650456180",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r650456184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650456184"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "05ff76c3aad6905d984ba1764c8045ca530fbf8f",
      "created_at" : "2021-06-13T01:48:29Z",
      "diff_hunk" : "@@ -373,5 +373,15 @@ def run_test(self):\n         self.test_address(4, self.nodes[4].getrawchangeaddress(), multisig=False, typ='p2sh-segwit')\n         self.test_address(4, self.nodes[4].getrawchangeaddress('bech32'), multisig=False, typ='bech32')\n \n+        if self.options.descriptors:\n+            self.log.info(\"Descriptor wallets do not have bech32m addreses by default yet\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r650456184",
      "id" : 650456184,
      "in_reply_to_id" : 649597262,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDQ1NjE4NA==",
      "original_commit_id" : "73ddcb81fcff5f10429ef6e78efa14c09e95807f",
      "original_line" : 377,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/wallet_address_types.py",
      "position" : null,
      "pull_request_review_id" : 682364218,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-13T01:48:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650456184",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r650456334"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650456334"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added asserts for all of the `LegacyScriptPubKeyMan` functions which take an `OutputType`.",
      "commit_id" : "05ff76c3aad6905d984ba1764c8045ca530fbf8f",
      "created_at" : "2021-06-13T01:50:23Z",
      "diff_hunk" : "@@ -23,6 +23,11 @@ const uint32_t BIP32_HARDENED_KEY_LIMIT = 0x80000000;\n \n bool LegacyScriptPubKeyMan::GetNewDestination(const OutputType type, CTxDestination& dest, std::string& error)\n {\n+    if (LEGACY_OUTPUT_TYPES.count(type) == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r650456334",
      "id" : 650456334,
      "in_reply_to_id" : 650449568,
      "line" : 26,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDQ1NjMzNA==",
      "original_commit_id" : "fe7f3ee0e7b4a8718435711fa5b775620b5434f3",
      "original_line" : 26,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 4,
      "pull_request_review_id" : 682364298,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-13T01:50:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650456334",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r650456336"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650456336"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "05ff76c3aad6905d984ba1764c8045ca530fbf8f",
      "created_at" : "2021-06-13T01:50:27Z",
      "diff_hunk" : "@@ -1906,7 +1906,12 @@ OutputType CWallet::TransactionChangeType(const std::optional<OutputType>& chang\n         // Check if any destination contains a witness program:\n         int witnessversion = 0;\n         std::vector<unsigned char> witnessprogram;\n-        if (recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) {\n+        bool is_wit = recipient.scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22154#discussion_r650456336",
      "id" : 650456336,
      "in_reply_to_id" : 650449876,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDQ1NjMzNg==",
      "original_commit_id" : "26597ff64d82d6f6da39ca6f92fe66dce632c304",
      "original_line" : 1909,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 682364300,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22154",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-13T01:50:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650456336",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
