{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "This PR is a proof of concept for using [LIEF](https://github.com/lief-project/LIEF) for the PE and MACHO symbol and security checks. It replaces our current approach of manually parsing the output of `objdump` & `otool`. If the consensus is that using LIEF is ok, then I also plan on replacing [pixie.py](https://github.com/bitcoin/bitcoin/blob/master/contrib/devtools/pixie.py), and using LIEF for all checks. LIEF for Linux is also currently blocked (on the next release, unless we want to build master) on one change for RISC-V that I [sent upstream](https://github.com/lief-project/LIEF/pull/562).\r\n\r\nLIEF is seemingly well maintained, and is the basis for a number of other tools. It also has some very nice documentation; i.e the [Python API for ELF](https://lief.quarkslab.com/doc/latest/api/python/elf.html). It also has many builtins we can take advantage of. i.e [`is_pie`](https://lief.quarkslab.com/doc/latest/api/python/macho.html#lief.MachO.Binary.is_pie), [`has_nx`](https://lief.quarkslab.com/doc/latest/api/python/macho.html#lief.MachO.Binary.has_nx) etc. This means we can [consolidate some of our checks](https://github.com/bitcoin/bitcoin/commit/9c5eeb54848f428109ec24dff55f189a5358e9bc). If/when end up using LIEF for lightning then we can consolidate further, and cleanup these scripts. i.e to not parse the binary inside the checks, but once at the start of the script.\r\n\r\nGuix builds:\r\n```bash\r\n# find guix-build-$(git rev-parse --short=12 HEAD)/output/ -type f -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\r\n87c3856adb9bac6b5cc2ad440b928a495b84491bfaf89222b07f674b32264237  guix-build-9c5eeb54848f/output/aarch64-linux-gnu/bitcoin-9c5eeb54848f-aarch64-linux-gnu-debug.tar.gz\r\nfed2d30720bafb8a80adf73557eae4c1440dba76d35e609234a81b03bd9dc0f9  guix-build-9c5eeb54848f/output/aarch64-linux-gnu/bitcoin-9c5eeb54848f-aarch64-linux-gnu.tar.gz\r\ne4763300c5220ea6c3617b89da791f77b538beba3e0f14618aec1e41a3af07ec  guix-build-9c5eeb54848f/output/arm-linux-gnueabihf/bitcoin-9c5eeb54848f-arm-linux-gnueabihf-debug.tar.gz\r\na9ab02f44f8324b328687d5f1bb11e5d3db6010825755386292f31b3ac8db2b1  guix-build-9c5eeb54848f/output/arm-linux-gnueabihf/bitcoin-9c5eeb54848f-arm-linux-gnueabihf.tar.gz\r\nab3b8eaef7f15ae68dbea2a95dffbca1688558b6ac97c6fd1132a00268d39602  guix-build-9c5eeb54848f/output/dist-archive/bitcoin-9c5eeb54848f.tar.gz\r\n8f4b873a5ebf9c3c5690c242d8050b30879bbe5ed4c5bad2e02208dbbecf12a7  guix-build-9c5eeb54848f/output/powerpc64-linux-gnu/bitcoin-9c5eeb54848f-powerpc64-linux-gnu-debug.tar.gz\r\nb3551817a96c6f38ae2839ba0c1172aff270c7d275f6c6e9ee1aa9f037e769d9  guix-build-9c5eeb54848f/output/powerpc64-linux-gnu/bitcoin-9c5eeb54848f-powerpc64-linux-gnu.tar.gz\r\nffb371f95e878ffe15f592b99f870f45ee30c23bc15d69736ef2f00d8b0778bb  guix-build-9c5eeb54848f/output/powerpc64le-linux-gnu/bitcoin-9c5eeb54848f-powerpc64le-linux-gnu-debug.tar.gz\r\nc983b5973aba7095a1b30d67525a286c64aaba8fa5ea9004e6f35e470e7a257d  guix-build-9c5eeb54848f/output/powerpc64le-linux-gnu/bitcoin-9c5eeb54848f-powerpc64le-linux-gnu.tar.gz\r\n49f2062871bac870a643412bd73ad3208662a804987022aea38c33fa71b7017b  guix-build-9c5eeb54848f/output/riscv64-linux-gnu/bitcoin-9c5eeb54848f-riscv64-linux-gnu-debug.tar.gz\r\n0767b69334079c99358e8255e4b551d8042a95e31af109c81c7b4a3715b8f152  guix-build-9c5eeb54848f/output/riscv64-linux-gnu/bitcoin-9c5eeb54848f-riscv64-linux-gnu.tar.gz\r\n0e6ed0cefabba736c0c720ecf9e6280a517f1f881daf7e5e6ed273e8b8224501  guix-build-9c5eeb54848f/output/x86_64-apple-darwin18/bitcoin-9c5eeb54848f-osx-unsigned.dmg\r\na5042d916d709d032e8671913caf4330127454e5e6471630d495b085150027ec  guix-build-9c5eeb54848f/output/x86_64-apple-darwin18/bitcoin-9c5eeb54848f-osx-unsigned.tar.gz\r\n34f86071eafd69797166b95e7a53a25118fa26bbab8eda57f6be04e20068ea06  guix-build-9c5eeb54848f/output/x86_64-apple-darwin18/bitcoin-9c5eeb54848f-osx64.tar.gz\r\n00561ab6b2855e2e5c6751dc9eea59f056f76fb6b862911e3a17d21cc6600e8b  guix-build-9c5eeb54848f/output/x86_64-linux-gnu/bitcoin-9c5eeb54848f-x86_64-linux-gnu-debug.tar.gz\r\n1358fcdaf5887b6f8c47561f8e6c3299b85d9b74f843b818622ebb1308625d47  guix-build-9c5eeb54848f/output/x86_64-linux-gnu/bitcoin-9c5eeb54848f-x86_64-linux-gnu.tar.gz\r\n93a522386b3c845ee7b278e1c49fff71541988478573e01a5dfbbd013dacb9d8  guix-build-9c5eeb54848f/output/x86_64-w64-mingw32/bitcoin-9c5eeb54848f-win-unsigned.tar.gz\r\nc1af15e81cb9b468846f20a365b0cbdf284fd4d492a7d01ab18b37eb9a7dcdcd  guix-build-9c5eeb54848f/output/x86_64-w64-mingw32/bitcoin-9c5eeb54848f-win64-debug.zip\r\ncfca49fa7b950b8ca8a7ee8834b165d7caaa98541b4299ef54ea8db2def35032  guix-build-9c5eeb54848f/output/x86_64-w64-mingw32/bitcoin-9c5eeb54848f-win64-setup-unsigned.exe\r\n60409a138d7e9f9e27ac8349000342f75d6a1489a79450a44b0d8d0142f8c39d  guix-build-9c5eeb54848f/output/x86_64-w64-mingw32/bitcoin-9c5eeb54848f-win64.zip\r\n```\r\n\r\nGitian builds:\r\n```bash\r\n# macOS:\r\nGenerating report\r\ncf31d3a71e044be421f26209d3a02cfcdcb3ba3ae1f949245c75bca428e12acc  bitcoin-9c5eeb54848f-osx-unsigned.dmg\r\nd0069732786c58847633da1afa620c3ec937d09580152048246f9b96b621c96d  bitcoin-9c5eeb54848f-osx-unsigned.tar.gz\r\n81c2dbc8a611c5a0142d0d67bcb02262e53ef06d371670e79c81f34a240ba34b  bitcoin-9c5eeb54848f-osx64.tar.gz\r\nab3b8eaef7f15ae68dbea2a95dffbca1688558b6ac97c6fd1132a00268d39602  src/bitcoin-9c5eeb54848f.tar.gz\r\na0bebe66e717ba201a4cf3d2431ccb8d47417eb05e3d9e6de3eef85c6cef40c6  bitcoin-core-osx-22-res.yml\r\nDone.\r\n\r\n# Windows:\r\nGenerating report\r\n8e8527decaf106128b0e3de3bb2f08eacdd6b25d8a20458446402426be9a214e  bitcoin-9c5eeb54848f-win-unsigned.tar.gz\r\nc8c620fb6fbd023d4a442b97baf20b71a71379ef484b43e95144ce2a1f42a3e9  bitcoin-9c5eeb54848f-win64-debug.zip\r\n5b7268f1dc27ea2935c2a5ebbb2a93323be95c57fd1a76e160d24a02dc9b3e84  bitcoin-9c5eeb54848f-win64-setup-unsigned.exe\r\nc0960265ab3bc5298b65b9fdf2897af134ec518f9dc661c39edf8f6d6f5c968e  bitcoin-9c5eeb54848f-win64.zip\r\nab3b8eaef7f15ae68dbea2a95dffbca1688558b6ac97c6fd1132a00268d39602  src/bitcoin-9c5eeb54848f.tar.gz\r\nbd53d15c0b8a127afadbb189ca2c2627c7b83653afbdd61804ca2fe12d88c6b0  bitcoin-core-win-22-res.yml\r\nDone.\r\n\r\n# Linux:\r\nGenerating report\r\n19b21a601cad62d6055d9146c5e179cc74d0aa6f7a70b418e0c4dca67b76f769  bitcoin-9c5eeb54848f-aarch64-linux-gnu-debug.tar.gz\r\n5c033a76a87655ce00c3ccd12a80e0b1d39be62c387356edaf57f1e0bfabe636  bitcoin-9c5eeb54848f-aarch64-linux-gnu.tar.gz\r\n83cf1a098a70d936ecdd9fd761a9604558512188c37b51e290e7021a0c34a125  bitcoin-9c5eeb54848f-arm-linux-gnueabihf-debug.tar.gz\r\na5d11e6604615a2c1c5ba63767ca6d7cb62c9ce9191c851eee08717246c44e54  bitcoin-9c5eeb54848f-arm-linux-gnueabihf.tar.gz\r\n32f753e07533464a96383796b898d64375cb8aec03163b90f2a7d85f1bffb256  bitcoin-9c5eeb54848f-powerpc64-linux-gnu-debug.tar.gz\r\n3c802461f9767e16fa798ce3e0e58944ce6ba0fde960c82896f06c158e13a1cf  bitcoin-9c5eeb54848f-powerpc64-linux-gnu.tar.gz\r\n5c434f52fac1d8d3066d660905ca9e151ff166b27b3fa62367d61f90e2c21ed4  bitcoin-9c5eeb54848f-powerpc64le-linux-gnu-debug.tar.gz\r\ncf0cd49ae2f192bc55f277f162ea40bc6c38855b4401d92c00079eac30e67d30  bitcoin-9c5eeb54848f-powerpc64le-linux-gnu.tar.gz\r\ncf6e1a47d027480fdcd332be9daeb67a493fd1d4ed005b40614b5ed1e0c67a1e  bitcoin-9c5eeb54848f-riscv64-linux-gnu-debug.tar.gz\r\n1090aae9cefc7b123d52aac9c2a0dbc8ee26db6d8164816beb20fcf01fda96e5  bitcoin-9c5eeb54848f-riscv64-linux-gnu.tar.gz\r\nda9984fb85d28a0fa5041f1c04de63acfd5603cded71a4f2d82adf41212481f5  bitcoin-9c5eeb54848f-x86_64-linux-gnu-debug.tar.gz\r\nc111a61d72fc4d47e7f93bd2d2db0087687b0d698066aa79ecaee21d565697c2  bitcoin-9c5eeb54848f-x86_64-linux-gnu.tar.gz\r\nab3b8eaef7f15ae68dbea2a95dffbca1688558b6ac97c6fd1132a00268d39602  src/bitcoin-9c5eeb54848f.tar.gz\r\n2f60c85c4ff83cad721994a1c8d5c457384cabdb218cfa168b313a4e4a63f608  bitcoin-core-linux-22-res.yml\r\nDone.\r\n```\r\n\r\n",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21664/comments",
   "created_at" : "2021-04-13T03:08:09Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21664/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/21664",
   "id" : 856524031,
   "labels" : [
      {
         "color" : "5319e7",
         "default" : false,
         "description" : null,
         "id" : 61889416,
         "name" : "Build system",
         "node_id" : "MDU6TGFiZWw2MTg4OTQxNg==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Build%20system"
      },
      {
         "color" : "bfd4f2",
         "default" : false,
         "description" : "",
         "id" : 1947349437,
         "name" : "Needs Guix build",
         "node_id" : "MDU6TGFiZWwxOTQ3MzQ5NDM3",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20Guix%20build"
      },
      {
         "color" : "8c9e07",
         "default" : false,
         "description" : "",
         "id" : 997854106,
         "name" : "Needs gitian build",
         "node_id" : "MDU6TGFiZWw5OTc4NTQxMDY=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20gitian%20build"
      },
      {
         "color" : "ffffee",
         "default" : false,
         "description" : null,
         "id" : 231994551,
         "name" : "Scripts and tools",
         "node_id" : "MDU6TGFiZWwyMzE5OTQ1NTE=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Scripts%20and%20tools"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21664/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NjE0MDg3MDIy",
   "number" : 21664,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/21664.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21664",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/21664.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21664"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "contrib: use LIEF for macOS and Windows symbol & security checks",
   "updated_at" : "2021-04-13T03:08:09Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21664",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
      "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fanquake/followers",
      "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fanquake",
      "id" : 863730,
      "login" : "fanquake",
      "node_id" : "MDQ6VXNlcjg2MzczMA==",
      "organizations_url" : "https://api.github.com/users/fanquake/orgs",
      "received_events_url" : "https://api.github.com/users/fanquake/received_events",
      "repos_url" : "https://api.github.com/users/fanquake/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fanquake"
   }
}
