[
   {
      "author_association" : "MEMBER",
      "body" : "Can you share the last lines from debug.log?",
      "created_at" : "2021-04-05T16:17:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/21605#issuecomment-813480631",
      "id" : 813480631,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzQ4MDYzMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-05T16:17:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813480631",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Sure.\r\n\r\n2021-04-05T16:28:49Z Pre-allocating up to position 0xc00000 in rev01085.dat\r\n2021-04-05T16:28:49Z UpdateTip: new best=00000000000000000028b02bad2699993a82fc52e73936b96226296a803b6d6e height=497387 version=0x20000000 log2_work=87.579934 tx=277599023 date='2017-12-03T15:22:54Z' progress=0.440660 cache=85.0MiB(640030txo)\r\n2021-04-05T16:28:51Z UpdateTip: new best=0000000000000000004ea0ab05d11e558456e12e80b1e3a11614d44ea401cbdb height=497388 version=0x20000000 log2_work=87.579971 tx=277600074 date='2017-12-03T15:23:16Z' progress=0.440662 cache=85.8MiB(645919txo)\r\n2021-04-05T16:28:52Z UpdateTip: new best=0000000000000000003b383f9dc396a6bf46d980fa4872bdace5ecd56736a613 height=497389 version=0x20000000 log2_work=87.580007 tx=277602786 date='2017-12-03T15:27:40Z' progress=0.440666 cache=86.4MiB(650778txo)",
      "created_at" : "2021-04-05T16:30:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/21605#issuecomment-813487822",
      "id" : 813487822,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzQ4NzgyMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-05T16:30:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813487822",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/9349074?v=4",
         "events_url" : "https://api.github.com/users/rednil/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rednil/followers",
         "following_url" : "https://api.github.com/users/rednil/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rednil/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rednil",
         "id" : 9349074,
         "login" : "rednil",
         "node_id" : "MDQ6VXNlcjkzNDkwNzQ=",
         "organizations_url" : "https://api.github.com/users/rednil/orgs",
         "received_events_url" : "https://api.github.com/users/rednil/received_events",
         "repos_url" : "https://api.github.com/users/rednil/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rednil/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rednil/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rednil"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Annotation of the backtrace address using the gitian debug information for 0.21.0 x86_64:\r\n```\r\n(gdb) info line *0x0000555555c2ba7b\r\nLine 360 of \"wallet/scriptpubkeyman.cpp\" starts at address 0x555555c2ba79 <LegacyScriptPubKeyMan::MarkUnusedAddresses(CScript const&)+873>\r\n   and ends at 0x555555c2ba82 <LegacyScriptPubKeyMan::MarkUnusedAddresses(CScript const&)+882>.\r\n\r\n(gdb) info line *0x0000555555c4d72d \r\nLine 287 of \"/usr/include/c++/7/bits/stl_tree.h\" starts at address 0x555555c4d72d <CWallet::AddToWalletIfInvolvingMe(std::shared_ptr<CTransaction const> const&, CWalletTx::Confirmation, bool)+925>\r\n   and ends at 0x555555c4d735 <CWallet::AddToWalletIfInvolvingMe(std::shared_ptr<CTransaction const> const&, CWalletTx::Confirmation, bool)+933>.\r\n\r\n(gdb) info line *0x0000555555c4e03d\r\nLine 1152 of \"wallet/wallet.cpp\" starts at address 0x555555c4e02f <CWallet::SyncTransaction(std::shared_ptr<CTransaction const> const&, CWalletTx::Confirmation, bool)+95>\r\n   and ends at 0x555555c4e045 <CWallet::SyncTransaction(std::shared_ptr<CTransaction const> const&, CWalletTx::Confirmation, bool)+117>.\r\n\r\n(gdb) info line *0x0000555555c4e454\r\nLine 1217 of \"wallet/wallet.cpp\" starts at address 0x555555c4e42c <CWallet::blockConnected(CBlock const&, int)+220> and ends at 0x555555c4e458 <CWallet::blockConnected(CBlock const&, int)+264>.\r\n\r\n(gdb) info line *0x0000555555ac964b\r\nLine 222 of \"validationinterface.cpp\"\r\n   starts at address 0x555555ac9638 <std::_Function_handler<void(), CMainSignals::BlockConnected(const std::shared_ptr<const CBlock>&, const CBlockIndex*)::<lambda()> >::_M_invoke(const std::_Any_data &)+760>\r\n   and ends at 0x555555ac9670 <std::_Function_handler<void(), CMainSignals::BlockConnected(const std::shared_ptr<const CBlock>&, const CBlockIndex*)::<lambda()> >::_M_invoke(const std::_Any_data &)+816>.\r\n```\r\nSo this line: https://github.com/bitcoin/bitcoin/blob/v0.21.0/src/wallet/scriptpubkeyman.cpp#L360\r\n\r\nThe only thing I can think of is some kind of out of bounds access. E.g. as far as I see it doesn't check `meta.has_key_origin`, nor the length of `meta.key_origin.path`.\r\n```c++\r\nbool internal = (meta.key_origin.path[1] & ~BIP32_HARDENED_KEY_LIMIT) != 0;\r\n```\r\n",
      "created_at" : "2021-04-05T17:32:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/21605#issuecomment-813522494",
      "id" : 813522494,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21605",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzUyMjQ5NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-05T17:42:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813522494",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
