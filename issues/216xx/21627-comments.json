[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@BradSwain Thanks a lot for reporting!\r\n\r\nI love when our code base is analysed using new static analysis tools: the more the merrier! Did you find any other data race issues? Can you share your results in a gist or similar?\r\n\r\nUnfortunately we're doing CI testing with quite a few ThreadSanitizer suppressions in https://github.com/bitcoin/bitcoin/blob/master/test/sanitizer_suppressions/tsan. Were you able to replicate any of those finds?\r\n\r\nI think we should try to more clearly categorise our suppressions as \"benign\" vs. impactful: currently it is a mix of both which makes it hard to reason about the potential worst-case impact of each case. \r\n\r\nLast week a technical report on related work in the Firefox project was published: [\"Eliminating Data Races in Firefox â A Technical Report\"](https://hacks.mozilla.org/2021/04/eliminating-data-races-in-firefox-a-technical-report/). I think this makes sense:\r\n\r\n> While benign data races do exist, we found (in agreement with previous work on this subject [1] [2]) that data races are very easily misclassified as benign. The reasons for this are clear: It is hard to reason about what compilers can and will optimize, and confirmation for certain âbenignâ data races requires you to look at the assembler code that the compiler finally produces.\r\n> \r\n> Needless to say, this procedure is often much more time consuming than fixing the actual data race and also not future-proof. As a result, we decided that the ultimate goal should be a âno data racesâ policy that declares even benign data races as undesirable due to their risk of misclassification, the required time for investigation and the potential risk from future compilers (with better optimizations) or future platforms (e.g. ARM).\r\n\r\n",
      "created_at" : "2021-04-09T06:05:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/21627#issuecomment-816433376",
      "id" : 816433376,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21627",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNjQzMzM3Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-09T06:05:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/816433376",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
