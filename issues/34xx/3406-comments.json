[
   {
      "body" : "I've erred on the safe side. None of the functions in the table with ENABLE_WALLET make use of the pWalletMain object. I've checked this by looking at link-time references to the actual wallet, which is arguably even more fool proof than blindly relying on that row (which I did look at).\r\n\r\n- `settxfee` doesn't require the wallet. You might argue that it is pointless without wallet functionality though.\r\n\r\nOn the other hand, other functions use the wallet 'under the hood':\r\n\r\n- `setgenerate` and `getgenerate` **do require the wallet**, they are part of the \"wallet enabled mining\" functions. At least `setgenerate` does an internal check for the wallet, and `getgenerate` is kind of pointless without it.\r\n\r\nYou're correct that three calls that could be included are missing:\r\n\r\n- `validateaddress` can optionally use the wallet (and was excluded because it happened to be in rpcwallet.cpp).\r\n\r\n- `verifymessage` was excluded because it happened to be in rpcwallet.cpp\r\n\r\n- `creatmultisig` was excluded because it happened to be in rpcwallet.cpp\r\n\r\nI could move these to another rpcXXX file and enable them. But I thought people using bitcoin as P2P node only wouldn't be too interested in these.\r\n",
      "created_at" : "2013-12-13T03:58:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3406#issuecomment-30484747",
      "id" : 30484747,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3406",
      "updated_at" : "2013-12-13T04:00:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/30484747",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I vote for allowing all calls that are possible with a disabled wallet.",
      "created_at" : "2013-12-13T07:10:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3406#issuecomment-30490864",
      "id" : 30490864,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3406",
      "updated_at" : "2013-12-13T07:10:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/30490864",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "body" : "For `verifymessage` and `createmultisig` there is no argument against. But let me give some background, --disable-wallet is part of a project of me trying to modularize bitcoind.\r\n\r\nThe first (and currently only) module is to be the current wallet, which provides certain RPC functions related to the wallet. I already have code in another branch that registers RPC calls dynamically and gets rid of all but one of the #ifdef ENABLE_WALLETs sprinkled throughout `init.cpp` and some of `rpc*.cpp`.\r\n\r\n`validateaddress` has different functionality depending on whether a wallet is used or not. With a wallet it checks for validity and whether the address is in the wallet or not, without wallet it checks only for validity. This complicates modularization.\r\n\r\n- The most straightforward way to handle this would be to have a base implementation of `validateaddress` that is overridden when the wallet module is used. \r\n- Another way would be a module entry point AddressIsMine or something like that, that is called from  a common `validateaddress` implementation.\r\n\r\nIn any case, it's a complicating factor.\r\n",
      "created_at" : "2013-12-13T08:01:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3406#issuecomment-30492536",
      "id" : 30492536,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3406",
      "updated_at" : "2013-12-13T08:01:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/30492536",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Ok my suggestion for the short-term fix would be:\r\n\r\n- move `verifymessage`, `createmultisig`, `validateaddress` as well as `getinfo` (which is currently in `rpcnet.cpp` where it doesn't really belong) to a new implementation file `rpcmisc.cpp` as they don't belong in any of the other `rpc*.cpp`.\r\n- then remove them from the #ifdef ENABLE_WALLET in `rpcserver.cpp`\r\n- add a #ifdef ENABLE_WALLET to `validateaddress` around the wallet-using part, so it also works when compiling with --disable-wallet\r\n- move `settxfee` to `rpcwallet.cpp` and move it into the #ifdef ENABLE_WALLET in `rpcserver.cpp`\r\n",
      "created_at" : "2013-12-13T10:55:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3406#issuecomment-30501310",
      "id" : 30501310,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3406",
      "updated_at" : "2013-12-13T11:21:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/30501310",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "RE setgenerate and getgenerate: not true.  Look closely, they do \"work\" without a wallet, in that, they provide a sane return value in the absence of a wallet, rather than simply being missing.\r\n\r\nACK your proposed short-term fix, @laanwj ",
      "created_at" : "2013-12-13T15:29:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3406#issuecomment-30517346",
      "id" : 30517346,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3406",
      "updated_at" : "2013-12-13T15:29:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/30517346",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "setgenerate simply raises an exception without wallet, just as if it doesn't exist:\r\n\r\n    if (pwalletMain == NULL)\r\n        throw JSONRPCError(RPC_METHOD_NOT_FOUND, \"Method not found (disabled)\");\r\n\r\ngetgenerate returns a value, sure, but that value is always 0. I don't see any point in including them in non-wallet builds.\r\n",
      "created_at" : "2013-12-13T15:32:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3406#issuecomment-30517625",
      "id" : 30517625,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3406",
      "updated_at" : "2013-12-13T15:32:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/30517625",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "See #3412 \r\n",
      "created_at" : "2013-12-13T15:39:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3406#issuecomment-30518147",
      "id" : 30518147,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3406",
      "updated_at" : "2013-12-13T15:39:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/30518147",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I have a solution for the modular case as well. The Module Interface (to replace the ui_interface) already needs a few entry points so that modules can add information to the `getinfo`, `getmining` RPC calls\r\n\r\n    GetInfo(Object &obj)\r\n    GetMiningInfo(Object &obj)\r\n\r\nSo let's just add one for `validateaddress` too\r\n\r\n    GetDestinationInfo(Object &obj, const CTxDestination *dest)\r\n\r\n`getgenerate`/`setgenerate`/`gethashespersec`/`getwork` would ideally belong in a different module `internalminer` which requires a wallet (or at least, some interface to pull new public keys from), not in the wallet module itself.\r\n",
      "created_at" : "2013-12-14T09:41:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3406#issuecomment-30563828",
      "id" : 30563828,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3406",
      "updated_at" : "2013-12-14T09:45:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/30563828",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
