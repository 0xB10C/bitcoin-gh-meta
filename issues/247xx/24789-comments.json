[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24830](https://github.com/bitcoin/bitcoin/pull/24830) (init: Allow -proxy=\"\" setting values by ryanofsky)\n* [#24630](https://github.com/bitcoin/bitcoin/pull/24630) (index: reset indexes when running reindex-chainstate by mzumsande)\n* [#22072](https://github.com/bitcoin/bitcoin/pull/22072) (Add reindex=auto flag to automatically reindex corrupt data by AaronDewes)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-04-06T18:59:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24789#issuecomment-1090636839",
      "id" : 1090636839,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24789",
      "node_id" : "IC_kwDOABII585BAcwn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1090636839/reactions"
      },
      "updated_at" : "2022-04-12T19:30:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1090636839",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Seems ok (with the noted provision that it is a temporary state of affairs). Theoretially `-reindex-chainstate` is supposed to be simply a faster `-reindex` that doesn't rebuild the block index, and work exactly the same otherwise. But if it doesn't work that way, it's better to disable the combination for now than have corruption and errors.",
      "created_at" : "2022-04-07T11:20:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24789#issuecomment-1091613555",
      "id" : 1091613555,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24789",
      "node_id" : "IC_kwDOABII585BELNz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1091613555/reactions"
      },
      "updated_at" : "2022-04-07T11:21:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1091613555",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ok with this temporarily, but I think we should [really fix the issue](https://github.com/bitcoin/bitcoin/pull/24630#issuecomment-1079587504) instead long-term.",
      "created_at" : "2022-04-12T21:03:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24789#issuecomment-1097214328",
      "id" : 1097214328,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24789",
      "node_id" : "IC_kwDOABII585BZil4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1097214328/reactions"
      },
      "updated_at" : "2022-04-12T21:03:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1097214328",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24789#discussion_r853621604"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24789"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853621604"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"init: disallow reindex-chainstate with optional indexes\" (93fa8f651242af5354ba92f7aaec18e878d4f840)\r\n\r\nIt would be good to replace `args.IsArgSet(\"-reindex-chainstate\")` with `args.GetBoolArg(\"-reindex-chainstate\", false)` because otherwise this will wrongly trigger for `-noreindex-chainstate`.\r\n\r\n(In general, it's good to avoid the `IsArgSet` function. It's frequently misused and leads to minor bugs like this.)",
      "commit_id" : "93fa8f651242af5354ba92f7aaec18e878d4f840",
      "created_at" : "2022-04-20T00:15:46Z",
      "diff_hunk" : "@@ -1031,6 +1031,19 @@ bool AppInitParameterInteraction(const ArgsManager& args, bool use_syscall_sandb\n         return InitError(_(\"No proxy server specified. Use -proxy=<ip> or -proxy=<ip:port>.\"));\n     }\n \n+    if (args.IsArgSet(\"-reindex-chainstate\")) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24789#discussion_r853621604",
      "id" : 853621604,
      "line" : 1034,
      "node_id" : "PRRC_kwDOABII584y4Ttk",
      "original_commit_id" : "93fa8f651242af5354ba92f7aaec18e878d4f840",
      "original_line" : 1034,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 13,
      "pull_request_review_id" : 946461589,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24789",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853621604/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-20T00:59:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853621604",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24789#discussion_r853628252"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24789"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853628252"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"init: disallow reindex-chainstate with optional indexes\" (93fa8f651242af5354ba92f7aaec18e878d4f840)\r\n\r\nCurious, but do you know how or whether txindex gets corrupted? #24630 only mentions the other two indexes. I guess even if the txindex doesn't get corrupted, it is probably still good to prevent `-reindex-chainstate` and `-txindex` from being used together if the current implementation is wastefully slow and inefficient, until we properly make the options more compatible.",
      "commit_id" : "93fa8f651242af5354ba92f7aaec18e878d4f840",
      "created_at" : "2022-04-20T00:25:19Z",
      "diff_hunk" : "@@ -1031,6 +1031,19 @@ bool AppInitParameterInteraction(const ArgsManager& args, bool use_syscall_sandb\n         return InitError(_(\"No proxy server specified. Use -proxy=<ip> or -proxy=<ip:port>.\"));\n     }\n \n+    if (args.IsArgSet(\"-reindex-chainstate\")) {\n+        // indexes that must be deactivated to prevent index corruption, see #24630\n+        if (args.GetBoolArg(\"-coinstatsindex\", DEFAULT_COINSTATSINDEX)) {\n+            return InitError(_(\"reindex-chainstate with active coinstatsindex is not possible. Please deactivate the index temporarily or perform a full -reindex, which will also rebuild the index.\"));\n+        }\n+        if (g_enabled_filter_types.count(BlockFilterType::BASIC)) {\n+            return InitError(_(\"reindex-chainstate with active blockfilterindex is not possible. Please deactivate the index temporarily or perform a full -reindex, which will also rebuild the index.\"));\n+        }\n+        if (args.GetBoolArg(\"-txindex\", DEFAULT_TXINDEX)) {\n+            return InitError(_(\"reindex-chainstate with active txindex is not possible. Please deactivate the index temporarily or perform a full -reindex, which will also rebuild the index.\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24789#discussion_r853628252",
      "id" : 853628252,
      "line" : 1043,
      "node_id" : "PRRC_kwDOABII584y4VVc",
      "original_commit_id" : "93fa8f651242af5354ba92f7aaec18e878d4f840",
      "original_line" : 1043,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 24,
      "pull_request_review_id" : 946461589,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24789",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853628252/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-20T00:59:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853628252",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24789#discussion_r853637267"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24789"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853637267"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"init: disallow reindex-chainstate with optional indexes\" (93fa8f651242af5354ba92f7aaec18e878d4f840)\r\n\r\nMinor: Here and below I think you could make recommendations more explicit. I would say \"-reindex-chainstate option is not compatible with -coinstatsindex. Please temporarily disable -coinstatsindex while using -reindex-chainstate, or replace -reindex-chainstate with -reindex to fully rebuild all indexes.\" But current wording is also OK if you prefer it.",
      "commit_id" : "93fa8f651242af5354ba92f7aaec18e878d4f840",
      "created_at" : "2022-04-20T00:46:25Z",
      "diff_hunk" : "@@ -1031,6 +1031,19 @@ bool AppInitParameterInteraction(const ArgsManager& args, bool use_syscall_sandb\n         return InitError(_(\"No proxy server specified. Use -proxy=<ip> or -proxy=<ip:port>.\"));\n     }\n \n+    if (args.IsArgSet(\"-reindex-chainstate\")) {\n+        // indexes that must be deactivated to prevent index corruption, see #24630\n+        if (args.GetBoolArg(\"-coinstatsindex\", DEFAULT_COINSTATSINDEX)) {\n+            return InitError(_(\"reindex-chainstate with active coinstatsindex is not possible. Please deactivate the index temporarily or perform a full -reindex, which will also rebuild the index.\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24789#discussion_r853637267",
      "id" : 853637267,
      "line" : 1037,
      "node_id" : "PRRC_kwDOABII584y4XiT",
      "original_commit_id" : "93fa8f651242af5354ba92f7aaec18e878d4f840",
      "original_line" : 1037,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 18,
      "pull_request_review_id" : 946461589,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24789",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853637267/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-20T00:59:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/853637267",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
