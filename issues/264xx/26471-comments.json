[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for your review at this conceptual stage @stickies-v. Your understanding of the problem and solution matches my own, although I had not fully considered the knock-on effect that:\r\n\r\n> users can't really replicate current behaviour even if they're aware of the change ... without increasing the dbcache by a total of 600MB - 1.2GB?\r\n\r\nI also concur with you that altering default `dbcache` size for users who enable `blocksonly` seems kind of messy, although it could be made to work.\r\n\r\nTherefore I see x options available from here:\r\n\r\n1) Keep current behaviour, document it better, and close https://github.com/bitcoin/bitcoin/issues/9526 as wontfix\r\n2) Implement (something like) this change which introduces the performance reduction in IBD for `blocksonly` nodes and document it\r\n3) Add special-casing for `dbcache` size when nodes are run in `blocksonly` mode.\r\n\r\nIn writing the options out like that, my first preference might actually be 1), followed by 3) and last 2).",
      "created_at" : "2022-11-11T11:16:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#issuecomment-1311565859",
      "id" : 1311565859,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26471",
      "node_id" : "IC_kwDOABII585OLOgj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311565859/reactions"
      },
      "updated_at" : "2022-11-11T11:16:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311565859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Therefore I see x options available from here:\r\n\r\nI think I'm not in favour of 1 & 3. Imo the direction should always be to reduce exceptional behaviour, if the short-term cost of that change is not exorbitant. I think in this case, the cost (potentially slower IBD which can be fixed with user config) is not exorbitant and increased stability (because of reduction of unexpected behaviour) is a worthwhile improvement.\r\n\r\nI can think of two other alternatives, both building on top of what you've currently implemented:\r\n\r\n4. add a `-increase-coins-cache=<n>` parameter to allow users keeping the current behaviour (and maybe even set it to 300 by default if `-blocksonly` in the first release to give users time to transition, and then change it to 0 in the release after. Pretty user-friendly/straightforward option, but it introduces another kinda one-off parameter.\r\n \r\n5. Allowing users to manually define sub-cache allocations (overriding the defaults), e.g. through `-dbcache.coins=<n|f>` where `n` is an absolute amount and `f` a 0-1 float indicating a percentage of total `dbcache`. This seems like the most transparent and generic solution, but probably at the cost of reduced user-friendliness. It would also be a significantly bigger code change introducing the new parameters as well as a bunch of validation, and allowing the auto-allocation to deal with partial specification (e.g. only `coins` and `tx_index` are specified but not the other ones)",
      "created_at" : "2022-11-11T12:47:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#issuecomment-1311659320",
      "id" : 1311659320,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26471",
      "node_id" : "IC_kwDOABII585OLlU4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311659320/reactions"
      },
      "updated_at" : "2022-11-11T12:47:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311659320",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   }
]
