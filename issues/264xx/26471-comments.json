[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1019443822"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019443822"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    if (gArgs.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)) {\r\n```",
      "commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "created_at" : "2022-11-10T17:48:00Z",
      "diff_hunk" : "@@ -2336,8 +2336,16 @@ CoinsCacheSizeState Chainstate::GetCoinsCacheSizeState(\n     AssertLockHeld(::cs_main);\n     const int64_t nMempoolUsage = m_mempool ? m_mempool->DynamicMemoryUsage() : 0;\n     int64_t cacheSize = CoinsTip().DynamicMemoryUsage();\n-    int64_t nTotalSpace =\n-        max_coins_cache_size_bytes + std::max<int64_t>(int64_t(max_mempool_size_bytes) - nMempoolUsage, 0);\n+    int64_t nTotalSpace;\n+    // Don't share unused mempool space with dbcache in blocksonly mode to avoid surprising resource usage\n+    // Keeping the mempool enabled will still permit transaction relay for whitelisted peers\n+    if (gArgs.GetBoolArg(\"-blocksonly\", false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1019443822",
      "id" : 1019443822,
      "line" : 2342,
      "node_id" : "PRRC_kwDOABII5848w3pu",
      "original_commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "original_line" : 2342,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 9,
      "pull_request_review_id" : 1176240824,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019443822/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-10T20:19:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019443822",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1019447582"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019447582"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    int64_t nTotalSpace{max_coins_cache_size_bytes};\r\n    // Don't share unused mempool space with dbcache in blocksonly mode to avoid surprising resource usage\r\n    // Keeping the mempool enabled will still permit transaction relay for whitelisted peers\r\n    if (!gArgs.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)) {\r\n        nTotalSpace += std::max<int64_t>(int64_t(max_mempool_size_bytes) - nMempoolUsage, 0);\r\n    }\r\n```",
      "commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "created_at" : "2022-11-10T17:52:06Z",
      "diff_hunk" : "@@ -2336,8 +2336,16 @@ CoinsCacheSizeState Chainstate::GetCoinsCacheSizeState(\n     AssertLockHeld(::cs_main);\n     const int64_t nMempoolUsage = m_mempool ? m_mempool->DynamicMemoryUsage() : 0;\n     int64_t cacheSize = CoinsTip().DynamicMemoryUsage();\n-    int64_t nTotalSpace =\n-        max_coins_cache_size_bytes + std::max<int64_t>(int64_t(max_mempool_size_bytes) - nMempoolUsage, 0);\n+    int64_t nTotalSpace;\n+    // Don't share unused mempool space with dbcache in blocksonly mode to avoid surprising resource usage\n+    // Keeping the mempool enabled will still permit transaction relay for whitelisted peers\n+    if (gArgs.GetBoolArg(\"-blocksonly\", false)) {\n+        nTotalSpace =\n+            max_coins_cache_size_bytes;\n+    } else {\n+        nTotalSpace =\n+            max_coins_cache_size_bytes + std::max<int64_t>(int64_t(max_mempool_size_bytes) - nMempoolUsage, 0);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1019447582",
      "id" : 1019447582,
      "line" : 2348,
      "node_id" : "PRRC_kwDOABII5848w4ke",
      "original_commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "original_line" : 2348,
      "original_position" : 15,
      "original_start_line" : 2339,
      "path" : "src/validation.cpp",
      "position" : 15,
      "pull_request_review_id" : 1176240824,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019447582/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2339,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-10T20:19:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019447582",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1019448405"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019448405"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    float shared_mempool_space{args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY) ? 0 : mempool_opts.max_size_bytes * (1.0 / 1024 / 1024)};\r\n```",
      "commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "created_at" : "2022-11-10T17:53:00Z",
      "diff_hunk" : "@@ -1467,7 +1467,8 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     if (mempool_opts.max_size_bytes < 0 || mempool_opts.max_size_bytes < descendant_limit_bytes) {\n         return InitError(strprintf(_(\"-maxmempool must be at least %d MB\"), std::ceil(descendant_limit_bytes / 1'000'000.0)));\n     }\n-    LogPrintf(\"* Using %.1f MiB for in-memory UTXO set (plus up to %.1f MiB of unused mempool space)\\n\", cache_sizes.coins * (1.0 / 1024 / 1024), mempool_opts.max_size_bytes * (1.0 / 1024 / 1024));\n+    float shared_mempool_space = args.GetBoolArg(\"-blocksonly\", false) ? 0 : mempool_opts.max_size_bytes * (1.0 / 1024 / 1024);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1019448405",
      "id" : 1019448405,
      "line" : 1470,
      "node_id" : "PRRC_kwDOABII5848w4xV",
      "original_commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "original_line" : 1470,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 5,
      "pull_request_review_id" : 1176240824,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019448405/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-10T20:19:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019448405",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for your review at this conceptual stage @stickies-v. Your understanding of the problem and solution matches my own, although I had not fully considered the knock-on effect that:\r\n\r\n> users can't really replicate current behaviour even if they're aware of the change ... without increasing the dbcache by a total of 600MB - 1.2GB?\r\n\r\nI also concur with you that altering default `dbcache` size for users who enable `blocksonly` seems kind of messy, although it could be made to work.\r\n\r\nTherefore I see x options available from here:\r\n\r\n1) Keep current behaviour, document it better, and close https://github.com/bitcoin/bitcoin/issues/9526 as wontfix\r\n2) Implement (something like) this change which introduces the performance reduction in IBD for `blocksonly` nodes and document it\r\n3) Add special-casing for `dbcache` size when nodes are run in `blocksonly` mode.\r\n\r\nIn writing the options out like that, my first preference might actually be 1), followed by 3) and last 2).",
      "created_at" : "2022-11-11T11:16:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#issuecomment-1311565859",
      "id" : 1311565859,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26471",
      "node_id" : "IC_kwDOABII585OLOgj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311565859/reactions"
      },
      "updated_at" : "2022-11-11T11:16:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311565859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Therefore I see x options available from here:\r\n\r\nI think I'm not in favour of 1 & 3. Imo the direction should always be to reduce exceptional behaviour, if the short-term cost of that change is not exorbitant. I think in this case, the cost (potentially slower IBD which can be fixed with user config) is not exorbitant and increased stability (because of reduction of unexpected behaviour) is a worthwhile improvement.\r\n\r\nI can think of two other alternatives, both building on top of what you've currently implemented:\r\n\r\n4. add a `-increase-coins-cache=<n>` parameter to allow users keeping the current behaviour (and maybe even set it to 300 by default if `-blocksonly` in the first release to give users time to transition, and then change it to 0 in the release after. Pretty user-friendly/straightforward option, but it introduces another kinda one-off parameter.\r\n \r\n5. Allowing users to manually define sub-cache allocations (overriding the defaults), e.g. through `-dbcache.coins=<n|f>` where `n` is an absolute amount and `f` a 0-1 float indicating a percentage of total `dbcache`. This seems like the most transparent and generic solution, but probably at the cost of reduced user-friendliness. It would also be a significantly bigger code change introducing the new parameters as well as a bunch of validation, and allowing the auto-allocation to deal with partial specification (e.g. only `coins` and `tx_index` are specified but not the other ones)",
      "created_at" : "2022-11-11T12:47:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#issuecomment-1311659320",
      "id" : 1311659320,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26471",
      "node_id" : "IC_kwDOABII585OLlU4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311659320/reactions"
      },
      "updated_at" : "2022-11-11T12:47:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311659320",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes 4) is a possible solution.\r\n\r\nIMO by the time we hit 5), we're probably almost talking about people who have such an understanding of the system (developers) that they can most likely make the change to the source themselves before compiling if they truely need such fine-grained settings changes.\r\n\r\nWill leave it as is to see if we get any other suggestions, and mull it over myself...",
      "created_at" : "2022-11-11T13:38:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#issuecomment-1311706344",
      "id" : 1311706344,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26471",
      "node_id" : "IC_kwDOABII585OLwzo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311706344/reactions"
      },
      "updated_at" : "2022-11-11T13:38:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311706344",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1020227691"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1020227691"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is in net.h, which I don't really want to add as a new dependency for validation.cpp ð¤ ",
      "commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "created_at" : "2022-11-11T13:39:35Z",
      "diff_hunk" : "@@ -2336,8 +2336,16 @@ CoinsCacheSizeState Chainstate::GetCoinsCacheSizeState(\n     AssertLockHeld(::cs_main);\n     const int64_t nMempoolUsage = m_mempool ? m_mempool->DynamicMemoryUsage() : 0;\n     int64_t cacheSize = CoinsTip().DynamicMemoryUsage();\n-    int64_t nTotalSpace =\n-        max_coins_cache_size_bytes + std::max<int64_t>(int64_t(max_mempool_size_bytes) - nMempoolUsage, 0);\n+    int64_t nTotalSpace;\n+    // Don't share unused mempool space with dbcache in blocksonly mode to avoid surprising resource usage\n+    // Keeping the mempool enabled will still permit transaction relay for whitelisted peers\n+    if (gArgs.GetBoolArg(\"-blocksonly\", false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1020227691",
      "id" : 1020227691,
      "in_reply_to_id" : 1019443822,
      "line" : 2342,
      "node_id" : "PRRC_kwDOABII5848z3Br",
      "original_commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "original_line" : 2342,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 9,
      "pull_request_review_id" : 1177352470,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1020227691/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-11T13:39:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1020227691",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1020254514"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1020254514"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fair enough, but then I think `DEFAULT_BLOCKSONLY` should be declared in a different header (not too sure where that would be, hopefully someone more familiar can chime in). Redeclaring default values in multiple locations scares me.",
      "commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "created_at" : "2022-11-11T14:13:27Z",
      "diff_hunk" : "@@ -2336,8 +2336,16 @@ CoinsCacheSizeState Chainstate::GetCoinsCacheSizeState(\n     AssertLockHeld(::cs_main);\n     const int64_t nMempoolUsage = m_mempool ? m_mempool->DynamicMemoryUsage() : 0;\n     int64_t cacheSize = CoinsTip().DynamicMemoryUsage();\n-    int64_t nTotalSpace =\n-        max_coins_cache_size_bytes + std::max<int64_t>(int64_t(max_mempool_size_bytes) - nMempoolUsage, 0);\n+    int64_t nTotalSpace;\n+    // Don't share unused mempool space with dbcache in blocksonly mode to avoid surprising resource usage\n+    // Keeping the mempool enabled will still permit transaction relay for whitelisted peers\n+    if (gArgs.GetBoolArg(\"-blocksonly\", false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1020254514",
      "id" : 1020254514,
      "in_reply_to_id" : 1019443822,
      "line" : 2342,
      "node_id" : "PRRC_kwDOABII5848z9ky",
      "original_commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "original_line" : 2342,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 9,
      "pull_request_review_id" : 1177392924,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1020254514/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-11T14:13:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1020254514",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> The intuitive solution would be to increase -dbcache by -maxmempool, however, dbcache is shared by multiple caches, of which the coins cache receives 25-50%. It seems there's no way to allocate an extra 300MB (assuming default) to just the coins cache without increasing the dbcache by a total of 600MB - 1.2GB?\r\n\r\nFWIW, I have a related thought process for Knots, where it makes sense to leave the coins cache unlimited (and let memory pressure trigger flushing), yet it isn't sane to just increase `-dbcache` to the system memory size, because that would also increase other cache sizes which aren't handled when under memory pressure.\r\n\r\n>Therefore I see x options available from here:\r\n\r\n6) support specifying \"+mempool\" on the end of the `-dbcache` option to get the current behaviour even in blocksonly mode.\r\n",
      "created_at" : "2022-11-14T23:13:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#issuecomment-1314530791",
      "id" : 1314530791,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26471",
      "node_id" : "IC_kwDOABII585OWiXn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1314530791/reactions"
      },
      "updated_at" : "2022-11-14T23:13:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1314530791",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It seems the key issue is \"surprising memory usage,\" i.e. `-dbcache=n -blocksonly` can use n+300 while the user may have expected n. The trick of using `-blocksonly` to add mempool's memory to the coins cache seems quite esoteric (lmk if I'm mistaken), so preserving it would be a bit less important imo.\r\n\r\n> the current (surprising) behaviour of having a functional mempool in -blocksonly mode\r\n\r\nGiven how surprising this is to so many people (including those affected by this problem), I can see how disabling mempool in blocksonly would be the easiest option. But can also see how it's not acceptable for users that rely on the current whitelist relay behavior according to #9569.\r\n\r\n7. Perhaps setting a very small mempool `m_max_size_bytes` when in blocksonly mode unless overridden by `-maxmempool`, would be one solution? That seems to preserve the trick for those using it intentionally, while reducing the amount of \"surprising memory usage\" for those that assume 0 memory for `-blocksonly`. Those who benefit from the extra 300MB by accident can perhaps get their answer from the release notes if they see a performance reduction. If they want to continue doing what they were doing, they just need to set `-maxmempool`.",
      "created_at" : "2023-01-12T17:01:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#issuecomment-1380727257",
      "id" : 1380727257,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26471",
      "node_id" : "IC_kwDOABII585STDnZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1380727257/reactions"
      },
      "updated_at" : "2023-01-12T17:01:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1380727257",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Ignored review | [stickies-v](https://github.com/bitcoin/bitcoin/pull/26471#pullrequestreview-1176240824) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2023-01-12T17:01:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#issuecomment-1380727341",
      "id" : 1380727341,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26471",
      "node_id" : "IC_kwDOABII585STDot",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 1,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1380727341/reactions"
      },
      "updated_at" : "2023-01-16T07:48:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1380727341",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> 7. Perhaps setting a very small mempool `m_max_size_bytes` when in blocksonly mode unless overridden by `-maxmempool`, would be one solution? That seems to preserve the trick for those using it intentionally, while reducing the amount of \"surprising memory usage\" for those that assume 0 memory for `-blocksonly`. Those who benefit from the extra 300MB by accident can perhaps get their answer from the release notes if they see a performance reduction. If they want to continue doing what they were doing, they just need to set `-maxmempool`.\r\n\r\nI think this is a neat solution which covers all requirements so implemented it [in this second branch](https://github.com/bitcoin/bitcoin/compare/master...willcl-ark:bitcoin:blocksonly_mempool_cache_7) (it's also much cleaner implementation-wise).\r\n\r\nThe only question I had was how small is \"smaller\"? I opted for 5MB in blocksonly mode as this should be enough for quite a few transactions to be relayed for whitelisted peers, I think...\r\n\r\nIf this is preferred I will move it over to this branch...?",
      "created_at" : "2023-01-13T19:54:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#issuecomment-1382323564",
      "id" : 1382323564,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26471",
      "node_id" : "IC_kwDOABII585SZJVs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1382323564/reactions"
      },
      "updated_at" : "2023-01-16T07:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1382323564",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1071341512"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071341512"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ideally we should probably remove Chainstate's dependency on `ArgsManager` and introduce some chainstate options. That should probably happen in a separate PR though.",
      "commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "created_at" : "2023-01-16T15:02:59Z",
      "diff_hunk" : "@@ -2336,8 +2336,16 @@ CoinsCacheSizeState Chainstate::GetCoinsCacheSizeState(\n     AssertLockHeld(::cs_main);\n     const int64_t nMempoolUsage = m_mempool ? m_mempool->DynamicMemoryUsage() : 0;\n     int64_t cacheSize = CoinsTip().DynamicMemoryUsage();\n-    int64_t nTotalSpace =\n-        max_coins_cache_size_bytes + std::max<int64_t>(int64_t(max_mempool_size_bytes) - nMempoolUsage, 0);\n+    int64_t nTotalSpace;\n+    // Don't share unused mempool space with dbcache in blocksonly mode to avoid surprising resource usage\n+    // Keeping the mempool enabled will still permit transaction relay for whitelisted peers\n+    if (gArgs.GetBoolArg(\"-blocksonly\", false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1071341512",
      "id" : 1071341512,
      "in_reply_to_id" : 1019443822,
      "line" : 2342,
      "node_id" : "PRRC_kwDOABII584_21_I",
      "original_commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "original_line" : 2342,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 9,
      "pull_request_review_id" : 1250318830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071341512/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-16T15:03:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071341512",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> The only question I had was how small is \"smaller\"? I opted for 5MB in blocksonly mode as this should be enough for quite a few transactions to be relayed for whitelisted peers, I think...\r\n\r\nThat definitely seems sufficient, and they can still make it higher if they need to. 5MB is the minimum `-maxmempool` config allowed as well, as the smaller the mempool size, the easier it is for your mempool min feerate to get driven up really high. Thinking out loud I guess this isn't as much of a concern for `-blocksonly` since you won't consider any transactions from strangers, so maybe smaller would be okay... but I can't say a different number with confidence.\r\n\r\n> If this is preferred I will move it over to this branch...?\r\n\r\nI think it's a relatively simple change to lessen this problem with minimal side effects? :shrug: though I don't know if we could say we've completely fixed it. fwiw I think it's sensible regardless since we're probably unlikely to need 300MB in blocksonly mode.",
      "created_at" : "2023-01-16T15:05:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#issuecomment-1384189101",
      "id" : 1384189101,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26471",
      "node_id" : "IC_kwDOABII585SgQyt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1384189101/reactions"
      },
      "updated_at" : "2023-01-16T15:05:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1384189101",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "OK I have moved the commits across, and updated the PR title and description. I also added a new release note commit which I thought was worth it, but happy to be persuaded otherwise.",
      "created_at" : "2023-01-17T09:12:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#issuecomment-1385066164",
      "id" : 1385066164,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26471",
      "node_id" : "IC_kwDOABII585Sjm60",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1385066164/reactions"
      },
      "updated_at" : "2023-01-17T09:12:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1385066164",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1071982767"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071982767"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in 4a17be6d4d025e1381fc37e43794a413b3654b6d: Now that you're in `init.cpp` you can use `DEFAULT_BLOCKSONLY`.\r\n\r\n```suggestion\r\n    if (args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY) && !args.IsArgSet(\"-maxmempool\")) {\r\n```\r\n",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T09:44:54Z",
      "diff_hunk" : "@@ -1467,7 +1467,16 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     if (mempool_opts.max_size_bytes < 0 || mempool_opts.max_size_bytes < descendant_limit_bytes) {\n         return InitError(strprintf(_(\"-maxmempool must be at least %d MB\"), std::ceil(descendant_limit_bytes / 1'000'000.0)));\n     }\n-    LogPrintf(\"* Using %.1f MiB for in-memory UTXO set (plus up to %.1f MiB of unused mempool space)\\n\", cache_sizes.coins * (1.0 / 1024 / 1024), mempool_opts.max_size_bytes * (1.0 / 1024 / 1024));\n+    // If we are running in blocksonly mode don't allocate the default 300MB of space for mempool\n+    // unless the user specifies -maxmempool, as otherwise it will leak into dbcache allowance.\n+    // Keeping the mempool enabled will still permit transaction relay for whitelisted peers\n+    if (args.GetBoolArg(\"-blocksonly\", 0) && !args.IsArgSet(\"-maxmempool\")) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1071982767",
      "id" : 1071982767,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_5Siv",
      "original_commit_id" : "4a17be6d4d025e1381fc37e43794a413b3654b6d",
      "original_line" : 1473,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 1251221155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071982767/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T10:13:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071982767",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1071988837"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071988837"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in a0af9931bc84f44a64daa87860c524eab44c76b1\r\n```suggestion\r\n- To disable mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions, except from whitelisted peers and as part of blocks.\r\n```",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T09:50:17Z",
      "diff_hunk" : "@@ -16,10 +16,14 @@ The size of some in-memory caches can be reduced. As caches trade off memory usa\n   - The minimum value for `-maxmempool` is 5.\n   - A lower maximum mempool size means that transactions will be evicted sooner. This will affect any uses of `bitcoind` that process unconfirmed transactions.\n \n-- To completely disable mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions completely, except as part of blocks.\n+- To disable mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions, except for from whitelisted peers and as part of blocks.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1071988837",
      "id" : 1071988837,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_5UBl",
      "original_commit_id" : "a0af9931bc84f44a64daa87860c524eab44c76b1",
      "original_line" : 19,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/reduce-memory.md",
      "position" : null,
      "pull_request_review_id" : 1251221155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071988837/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T10:13:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1071988837",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072010938"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072010938"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `descendant_limit_bytes` is around 3.9MB and not 5MB as claimed. Should the documentation be changed to reflect this or it doesn't really matter?",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T10:07:01Z",
      "diff_hunk" : "@@ -1467,7 +1467,16 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     if (mempool_opts.max_size_bytes < 0 || mempool_opts.max_size_bytes < descendant_limit_bytes) {\n         return InitError(strprintf(_(\"-maxmempool must be at least %d MB\"), std::ceil(descendant_limit_bytes / 1'000'000.0)));\n     }\n-    LogPrintf(\"* Using %.1f MiB for in-memory UTXO set (plus up to %.1f MiB of unused mempool space)\\n\", cache_sizes.coins * (1.0 / 1024 / 1024), mempool_opts.max_size_bytes * (1.0 / 1024 / 1024));\n+    // If we are running in blocksonly mode don't allocate the default 300MB of space for mempool\n+    // unless the user specifies -maxmempool, as otherwise it will leak into dbcache allowance.\n+    // Keeping the mempool enabled will still permit transaction relay for whitelisted peers\n+    if (args.GetBoolArg(\"-blocksonly\", 0) && !args.IsArgSet(\"-maxmempool\")) {\n+        // Re-use descendant_limit_bytes as the minimum mempool size\n+        mempool_opts.max_size_bytes = descendant_limit_bytes;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072010938",
      "id" : 1072010938,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_5Za6",
      "original_commit_id" : "4a17be6d4d025e1381fc37e43794a413b3654b6d",
      "original_line" : 1475,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 1251221155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072010938/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T10:13:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072010938",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072017880"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072017880"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Maybe also add a note saying that setting `-limitdescendantsize` can also alter the cache size with `-blocksonly`?\r\n\r\n`./src/bitcoind -limitdescendantsize=0`\r\n> Using 440.0 MiB for in-memory UTXO set (plus up to 286.1 MiB of unused mempool space)\r\n\r\n`./src/bitcoind -limitdescendantsize=300`\r\n> Using 440.0 MiB for in-memory UTXO set (plus up to 286.1 MiB of unused mempool space)\r\n\r\n---\r\n`./src/bitcoind -limitdescendantsize=0 -blocksonly`\r\n> Using 440.0 MiB for in-memory UTXO set (plus up to 0.0 MiB of unused mempool space)\r\n\r\n`./src/bitcoind -limitdescendantsize=300 -blocksonly`\r\n> Using 440.0 MiB for in-memory UTXO set (plus up to 11.4 MiB of unused mempool space)",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T10:13:25Z",
      "diff_hunk" : "@@ -16,10 +16,14 @@ The size of some in-memory caches can be reduced. As caches trade off memory usa\n   - The minimum value for `-maxmempool` is 5.\n   - A lower maximum mempool size means that transactions will be evicted sooner. This will affect any uses of `bitcoind` that process unconfirmed transactions.\n \n-- To completely disable mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions completely, except as part of blocks.\n+- To disable mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions, except for from whitelisted peers and as part of blocks.\n \n   - Do not use this when using the client to broadcast transactions as any transaction sent will stick out like a sore thumb, affecting privacy. When used with the wallet it should be combined with `-walletbroadcast=0` and `-spendzeroconfchange=0`. Another mechanism for broadcasting outgoing transactions (if any) should be used.\n \n+  - In `-blocksonly` mode the node will by default use a 5MB mempool size, avoiding unexpected memory usage from dbcache sharing the 300MB default mempool cache size.\n+\n+  - If you would like to continue using the mempool cache allocation for dbcache in `-blocksonly` mode then you can specify the mempool size using the `maxmempoolsize` option.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072017880",
      "id" : 1072017880,
      "line" : 25,
      "node_id" : "PRRC_kwDOABII584_5bHY",
      "original_commit_id" : "dd4325981bc79759d40e67cda91447a3da9fe083",
      "original_line" : 25,
      "original_position" : 11,
      "original_start_line" : 23,
      "path" : "doc/reduce-memory.md",
      "position" : 11,
      "pull_request_review_id" : 1251221155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072017880/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 23,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-17T10:13:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072017880",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072020217"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072020217"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah yes indeed. Thanks!",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T10:15:35Z",
      "diff_hunk" : "@@ -1467,7 +1467,16 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     if (mempool_opts.max_size_bytes < 0 || mempool_opts.max_size_bytes < descendant_limit_bytes) {\n         return InitError(strprintf(_(\"-maxmempool must be at least %d MB\"), std::ceil(descendant_limit_bytes / 1'000'000.0)));\n     }\n-    LogPrintf(\"* Using %.1f MiB for in-memory UTXO set (plus up to %.1f MiB of unused mempool space)\\n\", cache_sizes.coins * (1.0 / 1024 / 1024), mempool_opts.max_size_bytes * (1.0 / 1024 / 1024));\n+    // If we are running in blocksonly mode don't allocate the default 300MB of space for mempool\n+    // unless the user specifies -maxmempool, as otherwise it will leak into dbcache allowance.\n+    // Keeping the mempool enabled will still permit transaction relay for whitelisted peers\n+    if (args.GetBoolArg(\"-blocksonly\", 0) && !args.IsArgSet(\"-maxmempool\")) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072020217",
      "id" : 1072020217,
      "in_reply_to_id" : 1071982767,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584_5br5",
      "original_commit_id" : "4a17be6d4d025e1381fc37e43794a413b3654b6d",
      "original_line" : 1473,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 1251274711,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072020217/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T10:15:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072020217",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072021960"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072021960"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmmm you are right. I wanted to avoid another magic constant if possible, but this does indeed have unintended side effects. I am going to revert it to 5MB for now",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T10:17:08Z",
      "diff_hunk" : "@@ -16,10 +16,14 @@ The size of some in-memory caches can be reduced. As caches trade off memory usa\n   - The minimum value for `-maxmempool` is 5.\n   - A lower maximum mempool size means that transactions will be evicted sooner. This will affect any uses of `bitcoind` that process unconfirmed transactions.\n \n-- To completely disable mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions completely, except as part of blocks.\n+- To disable mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions, except for from whitelisted peers and as part of blocks.\n \n   - Do not use this when using the client to broadcast transactions as any transaction sent will stick out like a sore thumb, affecting privacy. When used with the wallet it should be combined with `-walletbroadcast=0` and `-spendzeroconfchange=0`. Another mechanism for broadcasting outgoing transactions (if any) should be used.\n \n+  - In `-blocksonly` mode the node will by default use a 5MB mempool size, avoiding unexpected memory usage from dbcache sharing the 300MB default mempool cache size.\n+\n+  - If you would like to continue using the mempool cache allocation for dbcache in `-blocksonly` mode then you can specify the mempool size using the `maxmempoolsize` option.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072021960",
      "id" : 1072021960,
      "in_reply_to_id" : 1072017880,
      "line" : 25,
      "node_id" : "PRRC_kwDOABII584_5cHI",
      "original_commit_id" : "dd4325981bc79759d40e67cda91447a3da9fe083",
      "original_line" : 25,
      "original_position" : 11,
      "original_start_line" : 23,
      "path" : "doc/reduce-memory.md",
      "position" : 11,
      "pull_request_review_id" : 1251277203,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072021960/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 23,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-17T10:17:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072021960",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072063828"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072063828"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: This should probably be stored as a constant such as `DEFAULT_BLOCKSONLY_MEMPOOL_MAX_SIZE`.",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T10:57:59Z",
      "diff_hunk" : "@@ -1467,7 +1467,15 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     if (mempool_opts.max_size_bytes < 0 || mempool_opts.max_size_bytes < descendant_limit_bytes) {\n         return InitError(strprintf(_(\"-maxmempool must be at least %d MB\"), std::ceil(descendant_limit_bytes / 1'000'000.0)));\n     }\n-    LogPrintf(\"* Using %.1f MiB for in-memory UTXO set (plus up to %.1f MiB of unused mempool space)\\n\", cache_sizes.coins * (1.0 / 1024 / 1024), mempool_opts.max_size_bytes * (1.0 / 1024 / 1024));\n+    // If we are running in blocksonly mode don't allocate the default 300MB of space for mempool\n+    // unless the user specifies -maxmempool, as otherwise it will leak into dbcache allowance.\n+    // Keeping the mempool enabled will still permit transaction relay for whitelisted peers\n+    if (args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY) && !args.IsArgSet(\"-maxmempool\")) {\n+        mempool_opts.max_size_bytes = 5 * 1'000'000;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072063828",
      "id" : 1072063828,
      "line" : 1474,
      "node_id" : "PRRC_kwDOABII584_5mVU",
      "original_commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "original_line" : 1474,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 9,
      "pull_request_review_id" : 1251339051,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072063828/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T11:10:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072063828",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072124052"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072124052"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n- To disable most of the mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions, except from whitelisted peers and as part of blocks.\r\n```",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T12:03:28Z",
      "diff_hunk" : "@@ -16,10 +16,14 @@ The size of some in-memory caches can be reduced. As caches trade off memory usa\n   - The minimum value for `-maxmempool` is 5.\n   - A lower maximum mempool size means that transactions will be evicted sooner. This will affect any uses of `bitcoind` that process unconfirmed transactions.\n \n-- To completely disable mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions completely, except as part of blocks.\n+- To disable mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions, except from whitelisted peers and as part of blocks.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072124052",
      "id" : 1072124052,
      "line" : 19,
      "node_id" : "PRRC_kwDOABII584_51CU",
      "original_commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "original_line" : 19,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/reduce-memory.md",
      "position" : 5,
      "pull_request_review_id" : 1251428711,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072124052/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T12:39:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072124052",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072128199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072128199"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It seems we're not doing this in other parts of the document, but if we reference the constant ([suggested](https://github.com/bitcoin/bitcoin/pull/26471/files#r1072063828) by aureleoules which I +1) that would make it easier to keep the docs in sync with future changes to the constant? \r\n\r\n```suggestion\r\n  - In `-blocksonly` mode the node will by default use a 5MB mempool size (`DEFAULT_BLOCKSONLY_MEMPOOL_MAX_SIZE`), avoiding unexpected memory usage from dbcache sharing the 300MB default mempool cache size.\r\n```",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T12:08:04Z",
      "diff_hunk" : "@@ -16,10 +16,14 @@ The size of some in-memory caches can be reduced. As caches trade off memory usa\n   - The minimum value for `-maxmempool` is 5.\n   - A lower maximum mempool size means that transactions will be evicted sooner. This will affect any uses of `bitcoind` that process unconfirmed transactions.\n \n-- To completely disable mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions completely, except as part of blocks.\n+- To disable mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions, except from whitelisted peers and as part of blocks.\n \n   - Do not use this when using the client to broadcast transactions as any transaction sent will stick out like a sore thumb, affecting privacy. When used with the wallet it should be combined with `-walletbroadcast=0` and `-spendzeroconfchange=0`. Another mechanism for broadcasting outgoing transactions (if any) should be used.\n \n+  - In `-blocksonly` mode the node will by default use a 5MB mempool size, avoiding unexpected memory usage from dbcache sharing the 300MB default mempool cache size.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072128199",
      "id" : 1072128199,
      "line" : 23,
      "node_id" : "PRRC_kwDOABII584_52DH",
      "original_commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "original_line" : 23,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "doc/reduce-memory.md",
      "position" : 9,
      "pull_request_review_id" : 1251428711,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072128199/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T12:39:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072128199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072132472"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072132472"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n  - If you would like to continue using the mempool cache allocation for dbcache in `-blocksonly` mode then you can specify the mempool size using the `-maxmempool` option.\r\n```",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T12:12:40Z",
      "diff_hunk" : "@@ -16,10 +16,14 @@ The size of some in-memory caches can be reduced. As caches trade off memory usa\n   - The minimum value for `-maxmempool` is 5.\n   - A lower maximum mempool size means that transactions will be evicted sooner. This will affect any uses of `bitcoind` that process unconfirmed transactions.\n \n-- To completely disable mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions completely, except as part of blocks.\n+- To disable mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions, except from whitelisted peers and as part of blocks.\n \n   - Do not use this when using the client to broadcast transactions as any transaction sent will stick out like a sore thumb, affecting privacy. When used with the wallet it should be combined with `-walletbroadcast=0` and `-spendzeroconfchange=0`. Another mechanism for broadcasting outgoing transactions (if any) should be used.\n \n+  - In `-blocksonly` mode the node will by default use a 5MB mempool size, avoiding unexpected memory usage from dbcache sharing the 300MB default mempool cache size.\n+\n+  - If you would like to continue using the mempool cache allocation for dbcache in `-blocksonly` mode then you can specify the mempool size using the `maxmempoolsize` option.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072132472",
      "id" : 1072132472,
      "line" : 25,
      "node_id" : "PRRC_kwDOABII584_53F4",
      "original_commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "original_line" : 25,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "doc/reduce-memory.md",
      "position" : 11,
      "pull_request_review_id" : 1251428711,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072132472/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T12:39:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072132472",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072133159"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072133159"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n- Previously running with the `-blocksonly` option all but disabled the\r\n```",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T12:13:26Z",
      "diff_hunk" : "@@ -0,0 +1,14 @@\n+Updated settings\n+----------------\n+\n+- Previously running with the `-blocksonly` option effectively disabled the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072133159",
      "id" : 1072133159,
      "line" : 4,
      "node_id" : "PRRC_kwDOABII584_53Qn",
      "original_commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "original_line" : 4,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "doc/release-notes-26471.md",
      "position" : 4,
      "pull_request_review_id" : 1251428711,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072133159/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T12:39:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072133159",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072134429"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072134429"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n  shared with the dbcache. This might lead to nodes running with this\r\n  option using more resources than anticipated, especially during IBD.\r\n```",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T12:14:44Z",
      "diff_hunk" : "@@ -0,0 +1,14 @@\n+Updated settings\n+----------------\n+\n+- Previously running with the `-blocksonly` option effectively disabled the\n+  mempool but continued to allocate 300MB of cache for it, which would be\n+  shared with the dbcache. This might lead to unexpected resource usage of\n+  nodes running with this option during for example IBD.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072134429",
      "id" : 1072134429,
      "line" : 7,
      "node_id" : "PRRC_kwDOABII584_53kd",
      "original_commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "original_line" : 7,
      "original_position" : 7,
      "original_start_line" : 6,
      "path" : "doc/release-notes-26471.md",
      "position" : 7,
      "pull_request_review_id" : 1251428711,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072134429/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 6,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-17T12:39:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072134429",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072135993"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072135993"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n  whitelisted peers, but avoiding unexpected resource usage. It reduces the\r\n  available `dbcache` size by 295MB, impacting performance especially during\r\n  IBD.\r\n```",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T12:16:21Z",
      "diff_hunk" : "@@ -0,0 +1,14 @@\n+Updated settings\n+----------------\n+\n+- Previously running with the `-blocksonly` option effectively disabled the\n+  mempool but continued to allocate 300MB of cache for it, which would be\n+  shared with the dbcache. This might lead to unexpected resource usage of\n+  nodes running with this option during for example IBD.\n+\n+  In this release running with `-blocksonly` will only allocate 5MB to the\n+  mempool by default, permitting the use-case of relaying transactions from\n+  whitelisted peers, but avoiding unexpected resource usage.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072135993",
      "id" : 1072135993,
      "line" : 11,
      "node_id" : "PRRC_kwDOABII584_5385",
      "original_commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "original_line" : 11,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "doc/release-notes-26471.md",
      "position" : 11,
      "pull_request_review_id" : 1251428711,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072135993/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T12:39:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072135993",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072142630"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072142630"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In quite a few places we refer to mempool cache being added to dbcache, but it's added specifically to the coins/UTXO cache so I think our language should reflect that consistently? (here and in other places)\r\n\r\n```suggestion\r\n    // unless the user specifies -maxmempool, as otherwise it will leak into UTXO cache allowance.\r\n```",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T12:23:12Z",
      "diff_hunk" : "@@ -1467,7 +1467,15 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     if (mempool_opts.max_size_bytes < 0 || mempool_opts.max_size_bytes < descendant_limit_bytes) {\n         return InitError(strprintf(_(\"-maxmempool must be at least %d MB\"), std::ceil(descendant_limit_bytes / 1'000'000.0)));\n     }\n-    LogPrintf(\"* Using %.1f MiB for in-memory UTXO set (plus up to %.1f MiB of unused mempool space)\\n\", cache_sizes.coins * (1.0 / 1024 / 1024), mempool_opts.max_size_bytes * (1.0 / 1024 / 1024));\n+    // If we are running in blocksonly mode don't allocate the default 300MB of space for mempool\n+    // unless the user specifies -maxmempool, as otherwise it will leak into dbcache allowance.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072142630",
      "id" : 1072142630,
      "line" : 1471,
      "node_id" : "PRRC_kwDOABII584_55km",
      "original_commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "original_line" : 1471,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 6,
      "pull_request_review_id" : 1251428711,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072142630/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T12:39:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072142630",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072155280"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072155280"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Have you considered adding this logic to `mempool_args.cpp::ApplyArgsManOptions()` instead, so we don't set our `mempool_opts.max_size_bytes` in two different locations? I think this has the benefit of 1) being easier to understand why options are set to the values they are and 2) avoid unexpected issues/behaviour where `mempool_opts.max_size_bytes` is temporarily set to 300MB before being changed to 5MB.\r\n\r\nThe downside, [as previously discussed](https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1020227691), is including `net.h`, which probably needs fixing anyway (perhaps in separate PR?).\r\n\r\nI think I'd much prefer this approach.\r\n\r\n<details>\r\n<summary>git diff on 931924f5cc1dd9c82306a0ce59b62cf5c9276565</summary>\r\n\r\n```diff\r\ndiff --git a/src/init.cpp b/src/init.cpp\r\nindex c4b15392c..641fef81c 100644\r\n--- a/src/init.cpp\r\n+++ b/src/init.cpp\r\n@@ -1467,12 +1467,6 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\r\n     if (mempool_opts.max_size_bytes < 0 || mempool_opts.max_size_bytes < descendant_limit_bytes) {\r\n         return InitError(strprintf(_(\"-maxmempool must be at least %d MB\"), std::ceil(descendant_limit_bytes / 1'000'000.0)));\r\n     }\r\n-    // If we are running in blocksonly mode don't allocate the default 300MB of space for mempool\r\n-    // unless the user specifies -maxmempool, as otherwise it will leak into dbcache allowance.\r\n-    // Keeping the mempool enabled will still permit transaction relay for whitelisted peers\r\n-    if (args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY) && !args.IsArgSet(\"-maxmempool\")) {\r\n-        mempool_opts.max_size_bytes = 5 * 1'000'000;\r\n-    }\r\n     LogPrintf(\"* Using %.1f MiB for in-memory UTXO set (plus up to %.1f MiB of unused mempool space)\\n\",\r\n               cache_sizes.coins * (1.0 / 1024 / 1024),\r\n               mempool_opts.max_size_bytes * (1.0 / 1024 / 1024));\r\ndiff --git a/src/node/mempool_args.cpp b/src/node/mempool_args.cpp\r\nindex 8c929e5e0..b530ac981 100644\r\n--- a/src/node/mempool_args.cpp\r\n+++ b/src/node/mempool_args.cpp\r\n@@ -10,6 +10,7 @@\r\n #include <chainparams.h>\r\n #include <consensus/amount.h>\r\n #include <logging.h>\r\n+#include <net.h>\r\n #include <policy/feerate.h>\r\n #include <policy/policy.h>\r\n #include <script/standard.h>\r\n@@ -42,7 +43,14 @@ std::optional<bilingual_str> ApplyArgsManOptions(const ArgsManager& argsman, con\r\n {\r\n     mempool_opts.check_ratio = argsman.GetIntArg(\"-checkmempool\", mempool_opts.check_ratio);\r\n \r\n-    if (auto mb = argsman.GetIntArg(\"-maxmempool\")) mempool_opts.max_size_bytes = *mb * 1'000'000;\r\n+    if (auto mb = argsman.GetIntArg(\"-maxmempool\")) {\r\n+        mempool_opts.max_size_bytes = *mb * 1'000'000;\r\n+    } else if (argsman.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)) {\r\n+        // If we are running in blocksonly mode don't allocate the default 300MB of space for mempool\r\n+        // unless the user specifies -maxmempool, as otherwise it will leak into dbcache allowance.\r\n+        // Keeping the mempool enabled will still permit transaction relay for whitelisted peers\r\n+        mempool_opts.max_size_bytes = 5 * 1'000'000;\r\n+    }\r\n \r\n     if (auto hours = argsman.GetIntArg(\"-mempoolexpiry\")) mempool_opts.expiry = std::chrono::hours{*hours};\r\n ```\r\n</details>\r\n",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T12:36:24Z",
      "diff_hunk" : "@@ -1467,7 +1467,15 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     if (mempool_opts.max_size_bytes < 0 || mempool_opts.max_size_bytes < descendant_limit_bytes) {\n         return InitError(strprintf(_(\"-maxmempool must be at least %d MB\"), std::ceil(descendant_limit_bytes / 1'000'000.0)));\n     }\n-    LogPrintf(\"* Using %.1f MiB for in-memory UTXO set (plus up to %.1f MiB of unused mempool space)\\n\", cache_sizes.coins * (1.0 / 1024 / 1024), mempool_opts.max_size_bytes * (1.0 / 1024 / 1024));\n+    // If we are running in blocksonly mode don't allocate the default 300MB of space for mempool\n+    // unless the user specifies -maxmempool, as otherwise it will leak into dbcache allowance.\n+    // Keeping the mempool enabled will still permit transaction relay for whitelisted peers\n+    if (args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY) && !args.IsArgSet(\"-maxmempool\")) {\n+        mempool_opts.max_size_bytes = 5 * 1'000'000;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072155280",
      "id" : 1072155280,
      "line" : 1474,
      "node_id" : "PRRC_kwDOABII584_58qQ",
      "original_commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "original_line" : 1474,
      "original_position" : 9,
      "original_start_line" : 1473,
      "path" : "src/init.cpp",
      "position" : 9,
      "pull_request_review_id" : 1251428711,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072155280/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1473,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-17T12:39:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072155280",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072276959"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072276959"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The docstring can also be simplified now btw, since the described behaviour is in the same if/else",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T14:26:52Z",
      "diff_hunk" : "@@ -1467,7 +1467,15 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     if (mempool_opts.max_size_bytes < 0 || mempool_opts.max_size_bytes < descendant_limit_bytes) {\n         return InitError(strprintf(_(\"-maxmempool must be at least %d MB\"), std::ceil(descendant_limit_bytes / 1'000'000.0)));\n     }\n-    LogPrintf(\"* Using %.1f MiB for in-memory UTXO set (plus up to %.1f MiB of unused mempool space)\\n\", cache_sizes.coins * (1.0 / 1024 / 1024), mempool_opts.max_size_bytes * (1.0 / 1024 / 1024));\n+    // If we are running in blocksonly mode don't allocate the default 300MB of space for mempool\n+    // unless the user specifies -maxmempool, as otherwise it will leak into dbcache allowance.\n+    // Keeping the mempool enabled will still permit transaction relay for whitelisted peers\n+    if (args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY) && !args.IsArgSet(\"-maxmempool\")) {\n+        mempool_opts.max_size_bytes = 5 * 1'000'000;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072276959",
      "id" : 1072276959,
      "in_reply_to_id" : 1072155280,
      "line" : 1474,
      "node_id" : "PRRC_kwDOABII584_6aXf",
      "original_commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "original_line" : 1474,
      "original_position" : 9,
      "original_start_line" : 1473,
      "path" : "src/init.cpp",
      "position" : 9,
      "pull_request_review_id" : 1251655422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072276959/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1473,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-17T14:26:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072276959",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072302193"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072302193"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T14:47:24Z",
      "diff_hunk" : "@@ -16,10 +16,14 @@ The size of some in-memory caches can be reduced. As caches trade off memory usa\n   - The minimum value for `-maxmempool` is 5.\n   - A lower maximum mempool size means that transactions will be evicted sooner. This will affect any uses of `bitcoind` that process unconfirmed transactions.\n \n-- To completely disable mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions completely, except as part of blocks.\n+- To disable mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions, except from whitelisted peers and as part of blocks.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072302193",
      "id" : 1072302193,
      "in_reply_to_id" : 1072124052,
      "line" : 19,
      "node_id" : "PRRC_kwDOABII584_6ghx",
      "original_commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "original_line" : 19,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/reduce-memory.md",
      "position" : 5,
      "pull_request_review_id" : 1251694267,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072302193/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T14:47:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072302193",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072302491"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072302491"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done (for now, pending including net.h)",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T14:47:38Z",
      "diff_hunk" : "@@ -16,10 +16,14 @@ The size of some in-memory caches can be reduced. As caches trade off memory usa\n   - The minimum value for `-maxmempool` is 5.\n   - A lower maximum mempool size means that transactions will be evicted sooner. This will affect any uses of `bitcoind` that process unconfirmed transactions.\n \n-- To completely disable mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions completely, except as part of blocks.\n+- To disable mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions, except from whitelisted peers and as part of blocks.\n \n   - Do not use this when using the client to broadcast transactions as any transaction sent will stick out like a sore thumb, affecting privacy. When used with the wallet it should be combined with `-walletbroadcast=0` and `-spendzeroconfchange=0`. Another mechanism for broadcasting outgoing transactions (if any) should be used.\n \n+  - In `-blocksonly` mode the node will by default use a 5MB mempool size, avoiding unexpected memory usage from dbcache sharing the 300MB default mempool cache size.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072302491",
      "id" : 1072302491,
      "in_reply_to_id" : 1072128199,
      "line" : 23,
      "node_id" : "PRRC_kwDOABII584_6gmb",
      "original_commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "original_line" : 23,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "doc/reduce-memory.md",
      "position" : 9,
      "pull_request_review_id" : 1251694716,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072302491/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T14:47:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072302491",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072302695"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072302695"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Whoops, fixed.",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T14:47:49Z",
      "diff_hunk" : "@@ -16,10 +16,14 @@ The size of some in-memory caches can be reduced. As caches trade off memory usa\n   - The minimum value for `-maxmempool` is 5.\n   - A lower maximum mempool size means that transactions will be evicted sooner. This will affect any uses of `bitcoind` that process unconfirmed transactions.\n \n-- To completely disable mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions completely, except as part of blocks.\n+- To disable mempool functionality there is the option `-blocksonly`. This will make the client opt out of receiving (and thus relaying) transactions, except from whitelisted peers and as part of blocks.\n \n   - Do not use this when using the client to broadcast transactions as any transaction sent will stick out like a sore thumb, affecting privacy. When used with the wallet it should be combined with `-walletbroadcast=0` and `-spendzeroconfchange=0`. Another mechanism for broadcasting outgoing transactions (if any) should be used.\n \n+  - In `-blocksonly` mode the node will by default use a 5MB mempool size, avoiding unexpected memory usage from dbcache sharing the 300MB default mempool cache size.\n+\n+  - If you would like to continue using the mempool cache allocation for dbcache in `-blocksonly` mode then you can specify the mempool size using the `maxmempoolsize` option.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072302695",
      "id" : 1072302695,
      "in_reply_to_id" : 1072132472,
      "line" : 25,
      "node_id" : "PRRC_kwDOABII584_6gpn",
      "original_commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "original_line" : 25,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "doc/reduce-memory.md",
      "position" : 11,
      "pull_request_review_id" : 1251695065,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072302695/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T14:47:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072302695",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072303420"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072303420"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Personally I feel \"effectively disabled\" is cleared here, so I've left it as-is for now (but happy to be persuaded)",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T14:48:24Z",
      "diff_hunk" : "@@ -0,0 +1,14 @@\n+Updated settings\n+----------------\n+\n+- Previously running with the `-blocksonly` option effectively disabled the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072303420",
      "id" : 1072303420,
      "in_reply_to_id" : 1072133159,
      "line" : 4,
      "node_id" : "PRRC_kwDOABII584_6g08",
      "original_commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "original_line" : 4,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "doc/release-notes-26471.md",
      "position" : 4,
      "pull_request_review_id" : 1251696175,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072303420/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T14:48:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072303420",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072303555"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072303555"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T14:48:30Z",
      "diff_hunk" : "@@ -0,0 +1,14 @@\n+Updated settings\n+----------------\n+\n+- Previously running with the `-blocksonly` option effectively disabled the\n+  mempool but continued to allocate 300MB of cache for it, which would be\n+  shared with the dbcache. This might lead to unexpected resource usage of\n+  nodes running with this option during for example IBD.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072303555",
      "id" : 1072303555,
      "in_reply_to_id" : 1072134429,
      "line" : 7,
      "node_id" : "PRRC_kwDOABII584_6g3D",
      "original_commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "original_line" : 7,
      "original_position" : 7,
      "original_start_line" : 6,
      "path" : "doc/release-notes-26471.md",
      "position" : 7,
      "pull_request_review_id" : 1251696373,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072303555/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 6,
      "start_side" : "RIGHT",
      "updated_at" : "2023-01-17T14:48:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072303555",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072303774"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072303774"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T14:48:40Z",
      "diff_hunk" : "@@ -0,0 +1,14 @@\n+Updated settings\n+----------------\n+\n+- Previously running with the `-blocksonly` option effectively disabled the\n+  mempool but continued to allocate 300MB of cache for it, which would be\n+  shared with the dbcache. This might lead to unexpected resource usage of\n+  nodes running with this option during for example IBD.\n+\n+  In this release running with `-blocksonly` will only allocate 5MB to the\n+  mempool by default, permitting the use-case of relaying transactions from\n+  whitelisted peers, but avoiding unexpected resource usage.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072303774",
      "id" : 1072303774,
      "in_reply_to_id" : 1072135993,
      "line" : 11,
      "node_id" : "PRRC_kwDOABII584_6g6e",
      "original_commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "original_line" : 11,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "doc/release-notes-26471.md",
      "position" : 11,
      "pull_request_review_id" : 1251696680,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072303774/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T14:48:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072303774",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072304359"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072304359"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Agreed and changed.",
      "commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "created_at" : "2023-01-17T14:49:08Z",
      "diff_hunk" : "@@ -1467,7 +1467,15 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     if (mempool_opts.max_size_bytes < 0 || mempool_opts.max_size_bytes < descendant_limit_bytes) {\n         return InitError(strprintf(_(\"-maxmempool must be at least %d MB\"), std::ceil(descendant_limit_bytes / 1'000'000.0)));\n     }\n-    LogPrintf(\"* Using %.1f MiB for in-memory UTXO set (plus up to %.1f MiB of unused mempool space)\\n\", cache_sizes.coins * (1.0 / 1024 / 1024), mempool_opts.max_size_bytes * (1.0 / 1024 / 1024));\n+    // If we are running in blocksonly mode don't allocate the default 300MB of space for mempool\n+    // unless the user specifies -maxmempool, as otherwise it will leak into dbcache allowance.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1072304359",
      "id" : 1072304359,
      "in_reply_to_id" : 1072142630,
      "line" : 1471,
      "node_id" : "PRRC_kwDOABII584_6hDn",
      "original_commit_id" : "931924f5cc1dd9c82306a0ce59b62cf5c9276565",
      "original_line" : 1471,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 6,
      "pull_request_review_id" : 1251697562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072304359/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-17T14:49:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1072304359",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   }
]
