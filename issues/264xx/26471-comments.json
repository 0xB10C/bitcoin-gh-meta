[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1019443822"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019443822"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    if (gArgs.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)) {\r\n```",
      "commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "created_at" : "2022-11-10T17:48:00Z",
      "diff_hunk" : "@@ -2336,8 +2336,16 @@ CoinsCacheSizeState Chainstate::GetCoinsCacheSizeState(\n     AssertLockHeld(::cs_main);\n     const int64_t nMempoolUsage = m_mempool ? m_mempool->DynamicMemoryUsage() : 0;\n     int64_t cacheSize = CoinsTip().DynamicMemoryUsage();\n-    int64_t nTotalSpace =\n-        max_coins_cache_size_bytes + std::max<int64_t>(int64_t(max_mempool_size_bytes) - nMempoolUsage, 0);\n+    int64_t nTotalSpace;\n+    // Don't share unused mempool space with dbcache in blocksonly mode to avoid surprising resource usage\n+    // Keeping the mempool enabled will still permit transaction relay for whitelisted peers\n+    if (gArgs.GetBoolArg(\"-blocksonly\", false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1019443822",
      "id" : 1019443822,
      "line" : 2342,
      "node_id" : "PRRC_kwDOABII5848w3pu",
      "original_commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "original_line" : 2342,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 9,
      "pull_request_review_id" : 1176240824,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019443822/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-10T20:19:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019443822",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1019447582"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019447582"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    int64_t nTotalSpace{max_coins_cache_size_bytes};\r\n    // Don't share unused mempool space with dbcache in blocksonly mode to avoid surprising resource usage\r\n    // Keeping the mempool enabled will still permit transaction relay for whitelisted peers\r\n    if (!gArgs.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)) {\r\n        nTotalSpace += std::max<int64_t>(int64_t(max_mempool_size_bytes) - nMempoolUsage, 0);\r\n    }\r\n```",
      "commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "created_at" : "2022-11-10T17:52:06Z",
      "diff_hunk" : "@@ -2336,8 +2336,16 @@ CoinsCacheSizeState Chainstate::GetCoinsCacheSizeState(\n     AssertLockHeld(::cs_main);\n     const int64_t nMempoolUsage = m_mempool ? m_mempool->DynamicMemoryUsage() : 0;\n     int64_t cacheSize = CoinsTip().DynamicMemoryUsage();\n-    int64_t nTotalSpace =\n-        max_coins_cache_size_bytes + std::max<int64_t>(int64_t(max_mempool_size_bytes) - nMempoolUsage, 0);\n+    int64_t nTotalSpace;\n+    // Don't share unused mempool space with dbcache in blocksonly mode to avoid surprising resource usage\n+    // Keeping the mempool enabled will still permit transaction relay for whitelisted peers\n+    if (gArgs.GetBoolArg(\"-blocksonly\", false)) {\n+        nTotalSpace =\n+            max_coins_cache_size_bytes;\n+    } else {\n+        nTotalSpace =\n+            max_coins_cache_size_bytes + std::max<int64_t>(int64_t(max_mempool_size_bytes) - nMempoolUsage, 0);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1019447582",
      "id" : 1019447582,
      "line" : 2348,
      "node_id" : "PRRC_kwDOABII5848w4ke",
      "original_commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "original_line" : 2348,
      "original_position" : 15,
      "original_start_line" : 2339,
      "path" : "src/validation.cpp",
      "position" : 15,
      "pull_request_review_id" : 1176240824,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019447582/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2339,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-10T20:19:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019447582",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1019448405"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019448405"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    float shared_mempool_space{args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY) ? 0 : mempool_opts.max_size_bytes * (1.0 / 1024 / 1024)};\r\n```",
      "commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "created_at" : "2022-11-10T17:53:00Z",
      "diff_hunk" : "@@ -1467,7 +1467,8 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     if (mempool_opts.max_size_bytes < 0 || mempool_opts.max_size_bytes < descendant_limit_bytes) {\n         return InitError(strprintf(_(\"-maxmempool must be at least %d MB\"), std::ceil(descendant_limit_bytes / 1'000'000.0)));\n     }\n-    LogPrintf(\"* Using %.1f MiB for in-memory UTXO set (plus up to %.1f MiB of unused mempool space)\\n\", cache_sizes.coins * (1.0 / 1024 / 1024), mempool_opts.max_size_bytes * (1.0 / 1024 / 1024));\n+    float shared_mempool_space = args.GetBoolArg(\"-blocksonly\", false) ? 0 : mempool_opts.max_size_bytes * (1.0 / 1024 / 1024);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1019448405",
      "id" : 1019448405,
      "line" : 1470,
      "node_id" : "PRRC_kwDOABII5848w4xV",
      "original_commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "original_line" : 1470,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 5,
      "pull_request_review_id" : 1176240824,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019448405/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-10T20:19:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1019448405",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for your review at this conceptual stage @stickies-v. Your understanding of the problem and solution matches my own, although I had not fully considered the knock-on effect that:\r\n\r\n> users can't really replicate current behaviour even if they're aware of the change ... without increasing the dbcache by a total of 600MB - 1.2GB?\r\n\r\nI also concur with you that altering default `dbcache` size for users who enable `blocksonly` seems kind of messy, although it could be made to work.\r\n\r\nTherefore I see x options available from here:\r\n\r\n1) Keep current behaviour, document it better, and close https://github.com/bitcoin/bitcoin/issues/9526 as wontfix\r\n2) Implement (something like) this change which introduces the performance reduction in IBD for `blocksonly` nodes and document it\r\n3) Add special-casing for `dbcache` size when nodes are run in `blocksonly` mode.\r\n\r\nIn writing the options out like that, my first preference might actually be 1), followed by 3) and last 2).",
      "created_at" : "2022-11-11T11:16:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#issuecomment-1311565859",
      "id" : 1311565859,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26471",
      "node_id" : "IC_kwDOABII585OLOgj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311565859/reactions"
      },
      "updated_at" : "2022-11-11T11:16:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311565859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Therefore I see x options available from here:\r\n\r\nI think I'm not in favour of 1 & 3. Imo the direction should always be to reduce exceptional behaviour, if the short-term cost of that change is not exorbitant. I think in this case, the cost (potentially slower IBD which can be fixed with user config) is not exorbitant and increased stability (because of reduction of unexpected behaviour) is a worthwhile improvement.\r\n\r\nI can think of two other alternatives, both building on top of what you've currently implemented:\r\n\r\n4. add a `-increase-coins-cache=<n>` parameter to allow users keeping the current behaviour (and maybe even set it to 300 by default if `-blocksonly` in the first release to give users time to transition, and then change it to 0 in the release after. Pretty user-friendly/straightforward option, but it introduces another kinda one-off parameter.\r\n \r\n5. Allowing users to manually define sub-cache allocations (overriding the defaults), e.g. through `-dbcache.coins=<n|f>` where `n` is an absolute amount and `f` a 0-1 float indicating a percentage of total `dbcache`. This seems like the most transparent and generic solution, but probably at the cost of reduced user-friendliness. It would also be a significantly bigger code change introducing the new parameters as well as a bunch of validation, and allowing the auto-allocation to deal with partial specification (e.g. only `coins` and `tx_index` are specified but not the other ones)",
      "created_at" : "2022-11-11T12:47:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#issuecomment-1311659320",
      "id" : 1311659320,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26471",
      "node_id" : "IC_kwDOABII585OLlU4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311659320/reactions"
      },
      "updated_at" : "2022-11-11T12:47:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311659320",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes 4) is a possible solution.\r\n\r\nIMO by the time we hit 5), we're probably almost talking about people who have such an understanding of the system (developers) that they can most likely make the change to the source themselves before compiling if they truely need such fine-grained settings changes.\r\n\r\nWill leave it as is to see if we get any other suggestions, and mull it over myself...",
      "created_at" : "2022-11-11T13:38:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#issuecomment-1311706344",
      "id" : 1311706344,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26471",
      "node_id" : "IC_kwDOABII585OLwzo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311706344/reactions"
      },
      "updated_at" : "2022-11-11T13:38:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311706344",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1020227691"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1020227691"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is in net.h, which I don't really want to add as a new dependency for validation.cpp ð¤ ",
      "commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "created_at" : "2022-11-11T13:39:35Z",
      "diff_hunk" : "@@ -2336,8 +2336,16 @@ CoinsCacheSizeState Chainstate::GetCoinsCacheSizeState(\n     AssertLockHeld(::cs_main);\n     const int64_t nMempoolUsage = m_mempool ? m_mempool->DynamicMemoryUsage() : 0;\n     int64_t cacheSize = CoinsTip().DynamicMemoryUsage();\n-    int64_t nTotalSpace =\n-        max_coins_cache_size_bytes + std::max<int64_t>(int64_t(max_mempool_size_bytes) - nMempoolUsage, 0);\n+    int64_t nTotalSpace;\n+    // Don't share unused mempool space with dbcache in blocksonly mode to avoid surprising resource usage\n+    // Keeping the mempool enabled will still permit transaction relay for whitelisted peers\n+    if (gArgs.GetBoolArg(\"-blocksonly\", false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1020227691",
      "id" : 1020227691,
      "in_reply_to_id" : 1019443822,
      "line" : 2342,
      "node_id" : "PRRC_kwDOABII5848z3Br",
      "original_commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "original_line" : 2342,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 9,
      "pull_request_review_id" : 1177352470,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1020227691/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-11T13:39:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1020227691",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1020254514"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1020254514"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fair enough, but then I think `DEFAULT_BLOCKSONLY` should be declared in a different header (not too sure where that would be, hopefully someone more familiar can chime in). Redeclaring default values in multiple locations scares me.",
      "commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "created_at" : "2022-11-11T14:13:27Z",
      "diff_hunk" : "@@ -2336,8 +2336,16 @@ CoinsCacheSizeState Chainstate::GetCoinsCacheSizeState(\n     AssertLockHeld(::cs_main);\n     const int64_t nMempoolUsage = m_mempool ? m_mempool->DynamicMemoryUsage() : 0;\n     int64_t cacheSize = CoinsTip().DynamicMemoryUsage();\n-    int64_t nTotalSpace =\n-        max_coins_cache_size_bytes + std::max<int64_t>(int64_t(max_mempool_size_bytes) - nMempoolUsage, 0);\n+    int64_t nTotalSpace;\n+    // Don't share unused mempool space with dbcache in blocksonly mode to avoid surprising resource usage\n+    // Keeping the mempool enabled will still permit transaction relay for whitelisted peers\n+    if (gArgs.GetBoolArg(\"-blocksonly\", false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#discussion_r1020254514",
      "id" : 1020254514,
      "in_reply_to_id" : 1019443822,
      "line" : 2342,
      "node_id" : "PRRC_kwDOABII5848z9ky",
      "original_commit_id" : "d68dc8244d81f899b28e0e7ca25501c02e99a986",
      "original_line" : 2342,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 9,
      "pull_request_review_id" : 1177392924,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1020254514/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-11T14:13:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1020254514",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> The intuitive solution would be to increase -dbcache by -maxmempool, however, dbcache is shared by multiple caches, of which the coins cache receives 25-50%. It seems there's no way to allocate an extra 300MB (assuming default) to just the coins cache without increasing the dbcache by a total of 600MB - 1.2GB?\r\n\r\nFWIW, I have a related thought process for Knots, where it makes sense to leave the coins cache unlimited (and let memory pressure trigger flushing), yet it isn't sane to just increase `-dbcache` to the system memory size, because that would also increase other cache sizes which aren't handled when under memory pressure.\r\n\r\n>Therefore I see x options available from here:\r\n\r\n6) support specifying \"+mempool\" on the end of the `-dbcache` option to get the current behaviour even in blocksonly mode.\r\n",
      "created_at" : "2022-11-14T23:13:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#issuecomment-1314530791",
      "id" : 1314530791,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26471",
      "node_id" : "IC_kwDOABII585OWiXn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1314530791/reactions"
      },
      "updated_at" : "2022-11-14T23:13:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1314530791",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It seems the key issue is \"surprising memory usage,\" i.e. `-dbcache=n -blocksonly` can use n+300 while the user may have expected n. The trick of using `-blocksonly` to add mempool's memory to the coins cache seems quite esoteric (lmk if I'm mistaken), so preserving it would be a bit less important imo.\r\n\r\n> the current (surprising) behaviour of having a functional mempool in -blocksonly mode\r\n\r\nGiven how surprising this is to so many people (including those affected by this problem), I can see how disabling mempool in blocksonly would be the easiest option. But can also see how it's not acceptable for users that rely on the current whitelist relay behavior according to #9569.\r\n\r\n7. Perhaps setting a very small mempool `m_max_size_bytes` when in blocksonly mode unless overridden by `-maxmempool`, would be one solution? That seems to preserve the trick for those using it intentionally, while reducing the amount of \"surprising memory usage\" for those that assume 0 memory for `-blocksonly`. Those who benefit from the extra 300MB by accident can perhaps get their answer from the release notes if they see a performance reduction. If they want to continue doing what they were doing, they just need to set `-maxmempool`.",
      "created_at" : "2023-01-12T17:01:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#issuecomment-1380727257",
      "id" : 1380727257,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26471",
      "node_id" : "IC_kwDOABII585STDnZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1380727257/reactions"
      },
      "updated_at" : "2023-01-12T17:01:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1380727257",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Approach ACK | [stickies-v](https://github.com/bitcoin/bitcoin/pull/26471#pullrequestreview-1176240824) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2023-01-12T17:01:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26471#issuecomment-1380727341",
      "id" : 1380727341,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26471",
      "node_id" : "IC_kwDOABII585STDot",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 1,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1380727341/reactions"
      },
      "updated_at" : "2023-01-12T17:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1380727341",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
