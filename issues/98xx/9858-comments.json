[
   {
      "body" : "I can agree with the idea that BlockAssembler shouldn't need to resort to the heaviness of TestBlockValidity, but we do need _some_ checks here.\r\n\r\nAs to your points\r\n- Grinding for a minute on a block that will be rejected is not worse than an extra quick call to gbt?\r\n- cs_main is already locked. This change does not reduce locking, only shaves down the time that it's held. Also, technically, this change would make this validation-less mining :(\r\n- Your example uses TestBlockValidity :)",
      "created_at" : "2017-02-25T21:41:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9858#issuecomment-282514495",
      "id" : 282514495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9858",
      "updated_at" : "2017-02-25T21:41:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/282514495",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "Getting an invalid template here should never happen unless there is a bug within bitcoind, this TestBlockValidity call is only an internal sanity check, my definition of validationless mining would be mining on top of a block that you haven't validated, this does not change that.\r\n\r\n@luke-jr \r\n\r\n- Not all pool software is capable of bypassing GBT, that requires implementing p2p networking in the stratum server which adds quite a bit of complexity.\r\n\r\n- My point is that CNB is in the critical path for validating mining, at least for stratum servers that don't implement p2p themselves.\r\n\r\n@theuni \r\n\r\n- My assumption is that if TestBlockValidity fails subsequent calls are also likely to fail.\r\n\r\n- Yes, removing TestBlockValidity does however significantly reduce CreateNewBlock times from my testing, I'm assuming locking is a major factor since TestBlockValidity introduces a large amount of variance in CreateNewBlock times as well.",
      "created_at" : "2017-02-25T22:48:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9858#issuecomment-282518294",
      "id" : 282518294,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9858",
      "updated_at" : "2017-02-25T22:48:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/282518294",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3298484?v=3",
         "events_url" : "https://api.github.com/users/jameshilliard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jameshilliard/followers",
         "following_url" : "https://api.github.com/users/jameshilliard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jameshilliard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jameshilliard",
         "id" : 3298484,
         "login" : "jameshilliard",
         "organizations_url" : "https://api.github.com/users/jameshilliard/orgs",
         "received_events_url" : "https://api.github.com/users/jameshilliard/received_events",
         "repos_url" : "https://api.github.com/users/jameshilliard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jameshilliard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jameshilliard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jameshilliard"
      }
   },
   {
      "body" : "`blocknotify` should be sufficient to begin empty-block mining. But perhaps it would make sense to have bitcoind's GBT itself handle the empty template?",
      "created_at" : "2017-02-26T01:49:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9858#issuecomment-282526241",
      "id" : 282526241,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9858",
      "updated_at" : "2017-02-26T01:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/282526241",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "@luke-jr Well you would have to cache some things like nversion if you just use blocknotify right? CreateNewBlock itself seems to be quite fast without TestBlockValidity so I'm not sure sending empty blocks out first is worth the extra bandwidth/complexity.",
      "created_at" : "2017-02-26T02:37:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9858#issuecomment-282528064",
      "id" : 282528064,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9858",
      "updated_at" : "2017-02-26T02:37:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/282528064",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3298484?v=3",
         "events_url" : "https://api.github.com/users/jameshilliard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jameshilliard/followers",
         "following_url" : "https://api.github.com/users/jameshilliard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jameshilliard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jameshilliard",
         "id" : 3298484,
         "login" : "jameshilliard",
         "organizations_url" : "https://api.github.com/users/jameshilliard/orgs",
         "received_events_url" : "https://api.github.com/users/jameshilliard/received_events",
         "repos_url" : "https://api.github.com/users/jameshilliard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jameshilliard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jameshilliard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jameshilliard"
      }
   },
   {
      "body" : "I'm totally in favor of removing TBV from the critical-path, but only if we trigger some background checker that will print to debug.log (and probably assert) if it returned a template it later found to be invalid.",
      "created_at" : "2017-02-26T18:46:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9858#issuecomment-282577268",
      "id" : 282577268,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9858",
      "updated_at" : "2017-02-26T18:46:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/282577268",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   }
]
