[
   {
      "author_association" : "MEMBER",
      "body" : "Concept / code review ACK c7933899e93b38f444d87b12858fd5a124f2066c modulo someone testing that it does fix the performance issue linked",
      "created_at" : "2020-05-02T11:20:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18851#issuecomment-622938080",
      "id" : 622938080,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18851",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjkzODA4MA==",
      "updated_at" : "2020-05-02T11:20:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622938080",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK if this fixes the problem. Will test when my new hardware arrives",
      "created_at" : "2020-05-02T11:47:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18851#issuecomment-622941182",
      "id" : 622941182,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18851",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjk0MTE4Mg==",
      "updated_at" : "2020-05-02T11:47:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622941182",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If this doesn't solve the problem, then the problem isn't thread_local but looking up thread names in the first place, and we should remove thread name logging completely (as well as thread_local).\r\n\r\nA workaround then that would avoid the need for this bookkeeping at all would be:\r\n- Log thread names *once* with their associated ID after creation on thread name setting\r\n- Log thread IDs instead of names in log messages\r\n",
      "created_at" : "2020-05-02T11:57:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18851#issuecomment-622942365",
      "id" : 622942365,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18851",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjk0MjM2NQ==",
      "updated_at" : "2020-05-02T12:33:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622942365",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18849 (The Zero Allocations project by jb55)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-05-02T12:27:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18851#issuecomment-622946109",
      "id" : 622946109,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18851",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjk0NjEwOQ==",
      "updated_at" : "2020-05-02T12:27:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622946109",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Keep testing.",
      "created_at" : "2020-05-02T19:18:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18851#issuecomment-623001238",
      "id" : 623001238,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18851",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzAwMTIzOA==",
      "updated_at" : "2020-05-02T19:18:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623001238",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Testing on [ODROID-HC1](https://www.hardkernel.com/shop/odroid-hc1-home-cloud-one/):\r\n```\r\n$ uname -srm\r\nLinux 4.14.173-173 armv7l\r\n$ ./autogen.sh && ./configure --disable-wallet --disable-tests --disable-bench --disable-zmq --disable-man --disable-util-tx --disable-util-wallet --without-miniupnpc --without-libs --without-gui CC=clang-9 CXX=clang++-9 && make clean && time taskset --cpu-list 4-7 make --jobs=4\r\n```\r\n\r\nUPDATE: sorry, wrong branch compiled",
      "created_at" : "2020-05-02T20:40:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18851#issuecomment-623010434",
      "id" : 623010434,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18851",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzAxMDQzNA==",
      "updated_at" : "2020-05-02T20:48:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623010434",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Here are results of three consequent tests on [ODROID-HC1](https://www.hardkernel.com/shop/odroid-hc1-home-cloud-one/):\r\n```\r\n$ uname -srm\r\nLinux 4.14.173-173 armv7l\r\n$ date; time bitcoin-cli -rpcclienttimeout=10000 gettxoutsetinfoSat May  2 23:18:12 UTC 2020\r\n{\r\n  \"height\": 628635,\r\n  \"bestblock\": \"0000000000000000000210066becbfb2ebfdd957d3bdaec7190f46d87ce59b7a\",\r\n  \"transactions\": 39898110,\r\n  \"txouts\": 66828188,\r\n  \"bogosize\": 5019712922,\r\n  \"hash_serialized_2\": \"78c80aed68a14274a1dbadd9213ff6da55618d29c2b077c8f502ce5f900fcd03\",\r\n  \"disk_size\": 4027535280,\r\n  \"total_amount\": 18357767.32081895\r\n}\r\n\r\nreal\t6m32.011s\r\nuser\t0m0.030s\r\nsys\t0m0.020s\r\n$ date; time bitcoin-cli -rpcclienttimeout=10000 gettxoutsetinfoSat May  2 23:31:50 UTC 2020\r\n{\r\n  \"height\": 628635,\r\n  \"bestblock\": \"0000000000000000000210066becbfb2ebfdd957d3bdaec7190f46d87ce59b7a\",\r\n  \"transactions\": 39898110,\r\n  \"txouts\": 66828188,\r\n  \"bogosize\": 5019712922,\r\n  \"hash_serialized_2\": \"78c80aed68a14274a1dbadd9213ff6da55618d29c2b077c8f502ce5f900fcd03\",\r\n  \"disk_size\": 4035885849,\r\n  \"total_amount\": 18357767.32081895\r\n}\r\n\r\nreal\t9m48.031s\r\nuser\t0m0.004s\r\nsys\t0m0.040s\r\n$ date; time bitcoin-cli -rpcclienttimeout=10000 gettxoutsetinfoSat May  2 23:44:47 UTC 2020\r\n{\r\n  \"height\": 628636,\r\n  \"bestblock\": \"0000000000000000000e91c7a666359c09a405e3a5294181100a6aeb7d9d6427\",\r\n  \"transactions\": 39898996,\r\n  \"txouts\": 66829911,\r\n  \"bogosize\": 5019841104,\r\n  \"hash_serialized_2\": \"065cb1955ffc90c37ef293d8bee8e2ca9af9f9d87b0a50f8d58b4b874b642a82\",\r\n  \"disk_size\": 4030980759,\r\n  \"total_amount\": 18357779.82081895\r\n}\r\n\r\nreal\t53m16.860s\r\nuser\t0m0.008s\r\nsys\t0m0.035s\r\n```\r\n\r\nThe related log:\r\n```\r\n2020-05-02T21:11:03Z [init] Bitcoin Core version v0.20.99.0-c7933899e (release build)\r\n2020-05-02T21:11:03Z [init] InitParameterInteraction: parameter interaction: -externalip set -> setting -discover=0\r\n2020-05-02T21:11:03Z [init] Assuming ancestors of block 0000000000000000000f2adce67e49b0b6bdeb9de8b7c3d7e93b21e7fc1e819d have valid signatures.\r\n2020-05-02T21:11:03Z [init] Setting nMinimumChainWork=00000000000000000000000000000000000000000e1ab5ec9348e9f4b8eb8154\r\n2020-05-02T21:11:03Z [init] Using the 'standard' SHA256 implementation\r\n2020-05-02T21:11:03Z [init] Default data directory /home/core/.bitcoin\r\n2020-05-02T21:11:03Z [init] Using data directory /var/lib/bitcoind\r\n2020-05-02T21:11:03Z [init] Config file: /etc/bitcoin/bitcoin.conf\r\n2020-05-02T21:11:03Z [init] Config file arg: debug=\"rpc\"\r\n2020-05-02T21:11:03Z [init] Config file arg: externalip=\"95.164.65.194\"\r\n2020-05-02T21:11:03Z [init] Config file arg: listenonion=\"0\"\r\n2020-05-02T21:11:03Z [init] Config file arg: logthreadnames=\"1\"\r\n2020-05-02T21:11:03Z [init] Config file arg: par=\"4\"\r\n2020-05-02T21:11:03Z [init] Config file arg: rpcthreads=\"2\"\r\n2020-05-02T21:11:03Z [init] Config file arg: rpcworkqueue=\"1\"\r\n...\r\n2020-05-02T23:18:12Z [httpworker.0] ThreadRPCServer method=gettxoutsetinfo user=__cookie__\r\n2020-05-02T23:18:12Z [httpworker.0] FlushStateToDisk: write coins cache to disk (337567 coins, 39627kB) started\r\n2020-05-02T23:18:14Z [httpworker.0] FlushStateToDisk: write coins cache to disk (337567 coins, 39627kB) completed (2.05s)\r\n2020-05-02T23:31:50Z [httpworker.1] ThreadRPCServer method=gettxoutsetinfo user=__cookie__\r\n2020-05-02T23:31:51Z [httpworker.1] FlushStateToDisk: write coins cache to disk (3522 coins, 2177kB) started\r\n2020-05-02T23:31:51Z [httpworker.1] FlushStateToDisk: write coins cache to disk (3522 coins, 2177kB) completed (0.02s)\r\n2020-05-02T23:40:36Z [msghand] UpdateTip: new best=0000000000000000000e91c7a666359c09a405e3a5294181100a6aeb7d9d6427 height=628636 version=0x27ffe000 log2_work=91.914443 tx=526304521 date='2020-05-02T23:40:05Z' progress=1.000000 cache=3.2MiB(13600txo) warning='67 of last 100 blocks have unexpected version'\r\n2020-05-02T23:44:47Z [httpworker.0] ThreadRPCServer method=gettxoutsetinfo user=__cookie__\r\n2020-05-02T23:44:48Z [httpworker.0] FlushStateToDisk: write coins cache to disk (14579 coins, 3418kB) started\r\n2020-05-02T23:44:48Z [httpworker.0] FlushStateToDisk: write coins cache to disk (14579 coins, 3418kB) completed (0.09s)\r\n2020-05-02T23:59:13Z [msghand] UpdateTip: new best=000000000000000000034cd30624babe78f29f0944b2e73d784198d4fd1af594 height=628637 version=0x20000000 log2_work=91.914464 tx=526307327 date='2020-05-02T23:54:25Z' progress=0.999998 cache=3.1MiB(12818txo) warning='66 of last 100 blocks have unexpected version'\r\n2020-05-02T23:59:30Z [msghand] New outbound peer connected: version: 70015, blocks=628638, peer=1217 (full-relay)\r\n2020-05-03T00:08:15Z [msghand] UpdateTip: new best=0000000000000000000a9c8ea50980bece5f9168e962c868e2f9d9761d5ddb0c height=628638 version=0x20800000 log2_work=91.914485 tx=526308404 date='2020-05-02T23:54:28Z' progress=0.999995 cache=4.0MiB(21407txo) warning='67 of last 100 blocks have unexpected version'\r\n2020-05-03T00:08:15Z [net] socket sending timeout: 1382s\r\n2020-05-03T00:14:30Z [msghand] UpdateTip: new best=00000000000000000006ceea137d6caebd533d6fd95f8c1da6be15fe01c6d828 height=628639 version=0x20c00000 log2_work=91.914506 tx=526310651 date='2020-05-03T00:08:22Z' progress=0.999998 cache=5.0MiB(30426txo) warning='67 of last 100 blocks have unexpected version'\r\n2020-05-03T00:32:24Z [msghand] UpdateTip: new best=0000000000000000000d0ce69147e7c831a0ea999c5837667a2928960d538cce height=628640 version=0x37ffe000 log2_work=91.914527 tx=526313977 date='2020-05-03T00:31:10Z' progress=1.000000 cache=6.1MiB(41548txo) warning='67 of last 100 blocks have unexpected version'\r\n```",
      "created_at" : "2020-05-03T00:42:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18851#issuecomment-623035027",
      "id" : 623035027,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18851",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzAzNTAyNw==",
      "updated_at" : "2020-05-03T00:42:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623035027",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It seems `thread_local` is not the root of the performance degradation.\r\nPlease see https://github.com/bitcoin/bitcoin/issues/18538#issuecomment-623078397",
      "created_at" : "2020-05-03T09:05:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18851#issuecomment-623078614",
      "id" : 623078614,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18851",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzA3ODYxNA==",
      "updated_at" : "2020-05-03T09:05:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623078614",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   }
]
