[
   {
      "author_association" : "MEMBER",
      "body" : "cc @sipa",
      "created_at" : "2020-05-05T06:06:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18881#issuecomment-623871970",
      "id" : 623871970,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18881",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzg3MTk3MA==",
      "updated_at" : "2020-05-05T06:06:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623871970",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18881#discussion_r420013187"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18881"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420013187"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    static LockData* lockdata = new LockData();\r\n```\r\n\r\nnot sure why auto needs to hide both the type and the pointer-ness. The additional 5 chars don't seem overly verbose.",
      "commit_id" : "7e3f40dd594d81b37458f9f5d36d4d7df99f8917",
      "created_at" : "2020-05-05T10:35:42Z",
      "diff_hunk" : "@@ -78,21 +78,14 @@ typedef std::map<std::pair<void*, void*>, LockStack> LockOrders;\n typedef std::set<std::pair<void*, void*> > InvLockOrders;\n \n struct LockData {\n-    // Very ugly hack: as the global constructs and destructors run single\n-    // threaded, we use this boolean to know whether LockData still exists,\n-    // as DeleteLock can get called by global RecursiveMutex destructors\n-    // after LockData disappears.\n-    bool available;\n-    LockData() : available(true) {}\n-    ~LockData() { available = false; }\n-\n     LockOrders lockorders;\n     InvLockOrders invlockorders;\n     std::mutex dd_mutex;\n };\n LockData& GetLockData() {\n-    static LockData lockdata;\n-    return lockdata;\n+    // See doc/developers-notes.md#construct-on-first-use-idiom\n+    static auto lockdata = new LockData();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18881#discussion_r420013187",
      "id" : 420013187,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAxMzE4Nw==",
      "original_commit_id" : "5a406f76030263c1c4e5335cea3be022263426f2",
      "original_line" : 87,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/sync.cpp",
      "position" : null,
      "pull_request_review_id" : 405669322,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18881",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T10:49:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420013187",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated 5a406f76030263c1c4e5335cea3be022263426f2 -> 7e3f40dd594d81b37458f9f5d36d4d7df99f8917 ([pr18881.01](https://github.com/hebasto/bitcoin/commits/pr18881.01) -> [pr18881.02](https://github.com/hebasto/bitcoin/commits/pr18881.02), [diff](https://github.com/hebasto/bitcoin/compare/pr18881.01..pr18881.02)):\r\n\r\n- addressed @MarcoFalke's [comment](https://github.com/bitcoin/bitcoin/pull/18881#discussion_r420013187):\r\n> not sure why auto needs to hide both the type and the pointer-ness. The additional 5 chars don't seem overly verbose.",
      "created_at" : "2020-05-05T10:52:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18881#issuecomment-623985636",
      "id" : 623985636,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18881",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzk4NTYzNg==",
      "updated_at" : "2020-05-05T10:52:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623985636",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18881#discussion_r420022157"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18881"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420022157"
         }
      },
      "author_association" : "MEMBER",
      "body" : "[Updated](https://github.com/bitcoin/bitcoin/pull/18881#issuecomment-623985636).",
      "commit_id" : "7e3f40dd594d81b37458f9f5d36d4d7df99f8917",
      "created_at" : "2020-05-05T10:53:15Z",
      "diff_hunk" : "@@ -78,21 +78,14 @@ typedef std::map<std::pair<void*, void*>, LockStack> LockOrders;\n typedef std::set<std::pair<void*, void*> > InvLockOrders;\n \n struct LockData {\n-    // Very ugly hack: as the global constructs and destructors run single\n-    // threaded, we use this boolean to know whether LockData still exists,\n-    // as DeleteLock can get called by global RecursiveMutex destructors\n-    // after LockData disappears.\n-    bool available;\n-    LockData() : available(true) {}\n-    ~LockData() { available = false; }\n-\n     LockOrders lockorders;\n     InvLockOrders invlockorders;\n     std::mutex dd_mutex;\n };\n LockData& GetLockData() {\n-    static LockData lockdata;\n-    return lockdata;\n+    // See doc/developers-notes.md#construct-on-first-use-idiom\n+    static auto lockdata = new LockData();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18881#discussion_r420022157",
      "id" : 420022157,
      "in_reply_to_id" : 420013187,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAyMjE1Nw==",
      "original_commit_id" : "5a406f76030263c1c4e5335cea3be022263426f2",
      "original_line" : 87,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/sync.cpp",
      "position" : null,
      "pull_request_review_id" : 405679685,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18881",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-05T10:53:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420022157",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   }
]
