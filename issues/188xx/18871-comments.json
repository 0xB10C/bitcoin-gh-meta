[
   {
      "author_association" : "MEMBER",
      "body" : "This is still just defeating the linter, I'm afraid. It assumes that a .h file and a .cpp with the same name form a unit.\r\n\r\nThe question it's trying to answer is \"can you use module X without having module Y or the other way around\", where a module is seen as defined by F.cpp + F.h (if both exist).",
      "created_at" : "2020-05-04T22:20:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18871#issuecomment-623738446",
      "id" : 623738446,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18871",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzczODQ0Ng==",
      "updated_at" : "2020-05-04T22:20:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623738446",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> This is still just defeating the linter, I'm afraid. It assumes that a .h file and a .cpp with the same name form a unit.\r\n> \r\n> The question it's trying to answer is \"can you use module X without having module Y or the other way around\", where a module is seen as defined by F.cpp + F.h (if both exist).\r\n\r\nWhat if I would create rpc/interfaces.cpp that contains all the implementations?",
      "created_at" : "2020-05-04T22:21:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18871#issuecomment-623738924",
      "id" : 623738924,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18871",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzczODkyNA==",
      "updated_at" : "2020-05-04T22:21:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623738924",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> What if I would create rpc/interfaces.cpp that contains all the implementations?\r\n\r\nIf that works, it's a solution indeed.",
      "created_at" : "2020-05-04T22:22:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18871#issuecomment-623739364",
      "id" : 623739364,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18871",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzczOTM2NA==",
      "updated_at" : "2020-05-04T22:22:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623739364",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18606 (test: checks that bitcoin-cli autocomplete is in sync by pierreN)\n* #18531 (rpc: Assert that RPCArg names are equal to CRPCCommand ones by MarcoFalke)\n* #16365 (Log RPC parameters (arguments) if -debug=rpcparams by LarryRuane)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-05-05T00:31:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18871#issuecomment-623779949",
      "id" : 623779949,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18871",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzc3OTk0OQ==",
      "updated_at" : "2020-05-05T00:31:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623779949",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > What if I would create rpc/interfaces.cpp that contains all the implementations?\r\n> \r\n> If that works, it's a solution indeed.\r\n\r\nI have now extracted `CRPCCommand`, `CRPCTable`, various `RPCTimer*`-structures and `Status/WarmUp` functions from `rpc/server.cpp` into the new `rpc/interfaces.cpp`. \r\n\r\nI'm deliberately using the plural form \"interfaces\" to indicate that these are interfaces that deal with RPC Server, but could be later split up into even smaller units, if needed. \r\n\r\nAlso, the `shutdown.h/*.cpp` got removed to get rid of this linker error:\r\n\r\n```shell\r\n AR       libbitcoin_wallet.a\r\n  CXXLD    bitcoin-wallet\r\n  CXXLD    bitcoind\r\nUndefined symbols for architecture x86_64:\r\n  \"StartShutdown()\", referenced from:\r\n      stop(JSONRPCRequest const&) in libbitcoin_common.a(libbitcoin_common_a-interfaces.o)\r\nld: symbol(s) not found for architecture x86_64\r\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\r\n```\r\n\r\nI think that moving the shutdown functionality into `rpc/interfaces` is acceptable, because other server-control functions are located there as well, like `IsRPCRunning` and others.\r\n\r\nWhile I was working on `rpc/interfaces` I also got a chance to remove all those forward class declarations `class CRPCTable`, which btw. provoked warnings like these:\r\n\r\n```shell\r\nMaking all in src\r\n  CXX      wallet/libbitcoin_wallet_a-rpcwallet.o\r\n  AR       libbitcoin_wallet.a\r\n  CXXLD    bitcoind\r\n  CXXLD    bitcoin-wallet\r\nld: warning: duplicate symbol '_tableRPC' in:\r\n    libbitcoin_util.a(libbitcoin_util_a-interfaces.o)\r\n    libbitcoin_wallet.a(libbitcoin_wallet_a-rpcdump.o)\r\nld: warning: duplicate symbol '_tableRPC' in:\r\n    libbitcoin_wallet.a(libbitcoin_wallet_a-wallet.o)\r\n    libbitcoin_wallet.a(libbitcoin_wallet_a-rpcwallet.o)\r\nld: warning: duplicate symbol '_tableRPC' in:\r\n    libbitcoin_wallet.a(libbitcoin_wallet_a-rpcwallet.o)\r\n    libbitcoin_util.a(libbitcoin_util_a-interfaces.o)\r\nld: warning: duplicate symbol '_tableRPC' in:\r\n    libbitcoin_zmq.a(libbitcoin_zmq_a-zmqrpc.o)\r\n    libbitcoin_wallet.a(libbitcoin_wallet_a-wallet.o)\r\nld: warning: duplicate symbol '_tableRPC' in:\r\n    libbitcoin_zmq.a(libbitcoin_zmq_a-zmqrpc.o)\r\n    libbitcoin_wallet.a(libbitcoin_wallet_a-rpcdump.o)\r\nld: warning: duplicate symbol '_tableRPC' in:\r\n    libbitcoin_zmq.a(libbitcoin_zmq_a-zmqrpc.o)\r\n[...snip...]\r\n```\r\n\r\n`rpc/interfaces.cpp` is part of `libbitcoin_server_a_SOURCES` in `src/Makefile.am`\r\n\r\nAnd just to make it even more complex for me, I also stumbled upon yet another circular dependency. :)\r\n\r\n```shell\r\nnode/transaction -> validation -> rpc/interfaces -> rpc/util -> node/transaction\r\n```\r\nBut after I replaced `node/transaction.h` with `util/error.h` in `rpc/util.h`, it disappeared.\r\n\r\nI hope that this proposed solution makes more sense. There are other circular dependencies still, but those exist independently from the one I was chasing in the last few days.\r\n\r\n```shell\r\nCircular dependency: chainparamsbase -> util/system -> chainparamsbase\r\nCircular dependency: index/txindex -> validation -> index/txindex\r\nCircular dependency: policy/fees -> txmempool -> policy/fees\r\nCircular dependency: qt/addresstablemodel -> qt/walletmodel -> qt/addresstablemodel\r\nCircular dependency: qt/bitcoingui -> qt/walletframe -> qt/bitcoingui\r\nCircular dependency: qt/recentrequeststablemodel -> qt/walletmodel -> qt/recentrequeststablemodel\r\nCircular dependency: qt/sendcoinsdialog -> qt/walletmodel -> qt/sendcoinsdialog\r\nCircular dependency: qt/transactiontablemodel -> qt/walletmodel -> qt/transactiontablemodel\r\nCircular dependency: txmempool -> validation -> txmempool\r\nCircular dependency: wallet/fees -> wallet/wallet -> wallet/fees\r\nCircular dependency: wallet/wallet -> wallet/walletdb -> wallet/wallet\r\nCircular dependency: policy/fees -> txmempool -> validation -> policy/fees\r\n```",
      "created_at" : "2020-05-05T18:45:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18871#issuecomment-624237736",
      "id" : 624237736,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18871",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNDIzNzczNg==",
      "updated_at" : "2020-05-05T19:06:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/624237736",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   }
]
