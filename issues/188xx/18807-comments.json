[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "created_at" : "2020-04-29T02:42:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18807#issuecomment-620961027",
      "id" : 620961027,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18807",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMDk2MTAyNw==",
      "updated_at" : "2020-05-02T03:56:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/620961027",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-04-29T08:45:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18807#issuecomment-621070382",
      "id" : 621070382,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18807",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMTA3MDM4Mg==",
      "updated_at" : "2020-04-29T08:45:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/621070382",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18807#discussion_r417232333"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18807"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417232333"
         }
      },
      "author_association" : "MEMBER",
      "body" : "suggest s/approximately once a day/once every 12-36 hours/",
      "commit_id" : "0dd03ca9b3531ac8c4ede030bb075b882b588f79",
      "created_at" : "2020-04-29T11:02:58Z",
      "diff_hunk" : "@@ -87,6 +92,13 @@ New settings\n Wallet\n ------\n \n+- To improve wallet privacy, the frequency of wallet rebroadcast attempts has\n+  been reduced from approximately once every 15 minutes to approximately once a\n+  day. To maintain a similar level of guarantee for initial broadcast of wallet",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18807#discussion_r417232333",
      "id" : 417232333,
      "line" : 97,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzIzMjMzMw==",
      "original_commit_id" : "0dd03ca9b3531ac8c4ede030bb075b882b588f79",
      "original_line" : 97,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "doc/release-notes.md",
      "position" : 18,
      "pull_request_review_id" : 402563175,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18807",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T11:10:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417232333",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18807#discussion_r417234843"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18807"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417234843"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Suggestion as per https://github.com/bitcoin/bitcoin/pull/18038#discussion_r415750840 with only one call to `time.time()` and two info logging statements.\r\n\r\n```python\r\n        # Check transaction is rebroadcast in 12-36 hour time interval.\r\n        time_now = int(time.time())\r\n\r\n        self.log.info(\"Bump time 12 hours from now, check transaction is not yet rebroadcast\")\r\n        rebroadcast_time = time_now  + (12 * 60 * 60)\r\n        node.setmocktime(rebroadcast_time)\r\n        assert_equal(node.p2ps[1].tx_invs_received[txid], 0)\r\n\r\n        self.log.info(\"Bump time 36 hours from now, check transaction is rebroadcast\")\r\n        rebroadcast_time = time_now + (36 * 60 * 60)\r\n        node.setmocktime(rebroadcast_time)\r\n        wait_until(lambda: node.p2ps[1].tx_invs_received[txid] >= 1, lock=mininode_lock)\r\n```",
      "commit_id" : "0dd03ca9b3531ac8c4ede030bb075b882b588f79",
      "created_at" : "2020-04-29T11:08:10Z",
      "diff_hunk" : "@@ -69,9 +54,17 @@ def run_test(self):\n         node.p2ps[1].sync_with_ping()\n         assert_equal(node.p2ps[1].tx_invs_received[txid], 0)\n \n-        self.log.info(\"Transaction should be rebroadcast after 30 minutes\")\n-        # Use mocktime and give an extra 5 minutes to be sure.\n-        rebroadcast_time = int(time.time()) + 41 * 60\n+        # Bump time 12 hours to check the transaction is still not\n+        # rebroadcast\n+        rebroadcast_time = int(time.time()) + 12 * 60 * 60\n+        node.setmocktime(rebroadcast_time)\n+        node.p2ps[1].sync_with_ping()\n+        assert_equal(node.p2ps[1].tx_invs_received[txid], 0)\n+\n+        self.log.info(\"Bump time & check that transaction is rebroadcast\")\n+        # Transaction should be rebroadcast approximately 24 hours in the future,\n+        # but can range from 12-36. So bump 36 hours to be sure.\n+        rebroadcast_time = int(time.time()) + 36 * 60 * 60",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18807#discussion_r417234843",
      "id" : 417234843,
      "line" : 67,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzIzNDg0Mw==",
      "original_commit_id" : "0dd03ca9b3531ac8c4ede030bb075b882b588f79",
      "original_line" : 67,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 66,
      "pull_request_review_id" : 402563175,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18807",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T11:10:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417234843",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2020-04-29T16:34:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18807#issuecomment-621324706",
      "id" : 621324706,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18807",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMTMyNDcwNg==",
      "updated_at" : "2020-04-29T16:34:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/621324706",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK.\r\n\r\nBuilt, run and tested the code on macOS Catalina 10.15.4. Both tests were successful.\r\nCommit 0dd03ca9b3531ac8c4ede030bb075b882b588f79\r\n\r\n```shell\r\n./test/functional/mempool_unbroadcast.py   (13s 854ms) â\r\n2020-04-30T16:35:16.018000Z TestFramework (INFO): Initializing test directory /var/folders/7q/4ffytzk562dd2ky4bfg9_w7h0000gn/T/bitcoin_func_test_ngy9nfi0\r\n2020-04-30T16:35:19.438000Z TestFramework (INFO): Test that mempool reattempts delivery of locally submitted transaction\r\n2020-04-30T16:35:19.994000Z TestFramework (INFO): Generate transactions that only node 0 knows about\r\n2020-04-30T16:35:21.479000Z TestFramework (INFO): Reconnect nodes & check if they are sent to node 1\r\n2020-04-30T16:35:25.579000Z TestFramework (INFO): Add another connection & ensure transactions aren't broadcast again\r\n2020-04-30T16:35:27.753000Z TestFramework (INFO): Test that transactions removed from mempool are removed from unbroadcast set\r\n2020-04-30T16:35:28.071000Z TestFramework (INFO): Stopping nodes\r\n2020-04-30T16:35:28.595000Z TestFramework (INFO): Cleaning up /var/folders/7q/4ffytzk562dd2ky4bfg9_w7h0000gn/T/bitcoin_func_test_ngy9nfi0 on exit\r\n2020-04-30T16:35:28.596000Z TestFramework (INFO): Tests successful\r\n```\r\n\r\n```shell\r\n./test/functional/wallet_resendwallettransactions.py  (13s 961ms)  \r\n2020-04-30T16:36:05.847000Z TestFramework (INFO): Initializing test directory /var/folders/7q/4ffytzk562dd2ky4bfg9_w7h0000gn/T/bitcoin_func_test_k0jcybzc\r\n2020-04-30T16:36:07.329000Z TestFramework (INFO): Create a new transaction and wait until it's broadcast\r\n2020-04-30T16:36:17.090000Z TestFramework (INFO): Create a block\r\n2020-04-30T16:36:17.213000Z TestFramework (INFO): Bump time & check that transaction is rebroadcast\r\n2020-04-30T16:36:17.584000Z TestFramework (INFO): Stopping nodes\r\n2020-04-30T16:36:18.055000Z TestFramework (INFO): Cleaning up /var/folders/7q/4ffytzk562dd2ky4bfg9_w7h0000gn/T/bitcoin_func_test_k0jcybzc on exit\r\n2020-04-30T16:36:18.055000Z TestFramework (INFO): Tests successful\r\n```\r\n\r\nWill do a full review after rebase.",
      "created_at" : "2020-04-30T16:47:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18807#issuecomment-621971492",
      "id" : 621971492,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18807",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMTk3MTQ5Mg==",
      "updated_at" : "2020-04-30T16:47:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/621971492",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> the node will try to announce unbroadcast transactions until a peer requests it via a `GETDATA`\r\n\r\nIf I was a bully node, I would send a `GETDATA` back to any node who announces a transaction I haven't seen yet. Is that kind of behaviour punished at the p2p level? Would it make sense to require that the `GETDATA` comes from a node that we never told about the transaction? Or that it comes from at least two nodes?",
      "created_at" : "2020-05-04T18:53:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18807#issuecomment-623642094",
      "id" : 623642094,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18807",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzY0MjA5NA==",
      "updated_at" : "2020-05-04T18:53:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623642094",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@gzhao408 has kindly taken over the follow-ups that change the codebase functionality in #18807.\r\n\r\nI'll use this PR to focus on updates to tests & docs. but currently still WIP. \r\n\r\n-----\r\n\r\n@Sjors \r\n> If I was a bully node, I would send a GETDATA back to any node who announces a transaction I haven't seen yet. Is that kind of behaviour punished at the p2p level?\r\n\r\nnodes requesting announced txns they haven't seen is ... desired :) but I think what you're getting at is the attacker might request but then not propagate. I don't see a way a peer could directly know if the other node propagated the transaction. So yes, we'd have to use another heuristic to try to evaluate that question. \r\n\r\nbut something to keep in mind.. transactions on the unbroadcast set are queued for every peer (`ReattemptInitialBroadcast` calls `RelayTransaction` which iterates through each node). so the attacker sending back a `GETDATA` would also have to somehow interrupt me from sending out to the other peers, be my only connection, etc. \r\n\r\n> Would it make sense to require that the GETDATA comes from a node that we never told about the transaction?\r\n\r\nwe don't usually get unsolicited `GETDATA` messages, but maybe what you're considering here is getting an `INV` from a peer we didn't announce it to. I considered this sort of approach in earlier iterations of the design (announce to some peers, wait for it to come back from others), but it seems unnecessary & a significant change to current txn propagation. \r\n\r\n> Or that it comes from at least two nodes?\r\n\r\nalso considered this approach, but over the course of review comments it didn't seem necessary bc some of the reasons talked about above. all of this design discussion is scattered throughout #18038 if you're interested in digging deeper :) ",
      "created_at" : "2020-05-06T03:28:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18807#issuecomment-624423419",
      "id" : 624423419,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18807",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNDQyMzQxOQ==",
      "updated_at" : "2020-05-06T03:28:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/624423419",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   }
]
