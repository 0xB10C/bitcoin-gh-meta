[
   {
      "body" : "Needs rebase.",
      "created_at" : "2016-05-11T23:14:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7598#issuecomment-218617610",
      "id" : 218617610,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7598",
      "updated_at" : "2016-05-11T23:14:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/218617610",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "rebased",
      "created_at" : "2016-05-18T18:15:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7598#issuecomment-220112886",
      "id" : 220112886,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7598",
      "updated_at" : "2016-05-18T18:15:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/220112886",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7598#discussion_r64160653"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64160653"
         }
      },
      "body" : "Nit: whitespace.",
      "commit_id" : "4dc94d1036576fe988a066fdabc047350ccddda9",
      "created_at" : "2016-05-23T01:09:46Z",
      "diff_hunk" : "@@ -71,231 +71,299 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-CBlockTemplate* CreateNewBlock(const CChainParams& chainparams, const CScript& scriptPubKeyIn)\n+BlockAssembler::BlockAssembler(const CChainParams& _chainparams)\n+    : chainparams(_chainparams)\n {\n-    // Create new block\n-    std::unique_ptr<CBlockTemplate> pblocktemplate(new CBlockTemplate());\n+   // Largest block you're willing to create:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7598#discussion_r64160653",
      "id" : 64160653,
      "original_commit_id" : "4dc94d1036576fe988a066fdabc047350ccddda9",
      "original_position" : 10,
      "path" : "src/miner.cpp",
      "position" : 10,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598",
      "updated_at" : "2016-05-23T01:09:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64160653",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7598#discussion_r64160685"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64160685"
         }
      },
      "body" : "The old code deliberately unlocks before calling TestBlockValidity...I'm not actually sure its worth anything, but just noting that there is actually a behavior change here.",
      "commit_id" : "4dc94d1036576fe988a066fdabc047350ccddda9",
      "created_at" : "2016-05-23T01:10:42Z",
      "diff_hunk" : "@@ -71,231 +71,299 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-CBlockTemplate* CreateNewBlock(const CChainParams& chainparams, const CScript& scriptPubKeyIn)\n+BlockAssembler::BlockAssembler(const CChainParams& _chainparams)\n+    : chainparams(_chainparams)\n {\n-    // Create new block\n-    std::unique_ptr<CBlockTemplate> pblocktemplate(new CBlockTemplate());\n+   // Largest block you're willing to create:\n+    nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n+    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n+    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+\n+    // Minimum block size you want to create; block will be filled with free transactions\n+    // until there are no more or the block reaches this size:\n+    nBlockMinSize = GetArg(\"-blockminsize\", DEFAULT_BLOCK_MIN_SIZE);\n+    nBlockMinSize = std::min(nBlockMaxSize, nBlockMinSize);\n+}\n+\n+void BlockAssembler::resetBlock()\n+{\n+    inBlock.clear();\n+\n+    // Reserve space for coinbase tx\n+    nBlockSize = 1000;\n+    nBlockSigOps = 100;\n+\n+    // These counters do not include coinbase tx\n+    nBlockTx = 0;\n+    nFees = 0;\n+\n+    lastFewTxs = 0;\n+    blockFinished = false;\n+}\n+\n+CBlockTemplate* BlockAssembler::CreateNewBlock(const CScript& scriptPubKeyIn)\n+{\n+    resetBlock();\n+\n+    pblocktemplate.reset(new CBlockTemplate());\n+\n     if(!pblocktemplate.get())\n         return NULL;\n-    CBlock *pblock = &pblocktemplate->block; // pointer for convenience\n-\n-    // Create coinbase tx\n-    CMutableTransaction txNew;\n-    txNew.vin.resize(1);\n-    txNew.vin[0].prevout.SetNull();\n-    txNew.vout.resize(1);\n-    txNew.vout[0].scriptPubKey = scriptPubKeyIn;\n+    pblock = &pblocktemplate->block; // pointer for convenience\n \n     // Add dummy coinbase tx as first transaction\n     pblock->vtx.push_back(CTransaction());\n     pblocktemplate->vTxFees.push_back(-1); // updated at end\n     pblocktemplate->vTxSigOps.push_back(-1); // updated at end\n \n-    // Largest block you're willing to create:\n-    unsigned int nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n-    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n-    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+    LOCK2(cs_main, mempool.cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7598#discussion_r64160685",
      "id" : 64160685,
      "original_commit_id" : "4dc94d1036576fe988a066fdabc047350ccddda9",
      "original_position" : 64,
      "path" : "src/miner.cpp",
      "position" : 64,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598",
      "updated_at" : "2016-05-23T01:10:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64160685",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "utACK 4dc94d1036576fe988a066fdabc047350ccddda9 +/- whitespace.",
      "created_at" : "2016-05-23T01:13:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7598#issuecomment-220868794",
      "id" : 220868794,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7598",
      "updated_at" : "2016-05-23T01:13:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/220868794",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   }
]
