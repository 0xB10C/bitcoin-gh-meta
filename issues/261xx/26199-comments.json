[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "FYI @naumenkogs @dergoegge ",
      "created_at" : "2022-09-28T21:53:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1261503513",
      "id" : 1261503513,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26199",
      "node_id" : "IC_kwDOABII585LMQQZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1261503513/reactions"
      },
      "updated_at" : "2022-09-28T21:53:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1261503513",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2022-09-28T22:05:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1261511669",
      "id" : 1261511669,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26199",
      "node_id" : "IC_kwDOABII585LMSP1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1261511669/reactions"
      },
      "updated_at" : "2022-09-28T22:05:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1261511669",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25619](https://github.com/bitcoin/bitcoin/pull/25619) (net: avoid overriding non-virtual ToString() in CService and use better naming by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-09-28T23:18:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1261562279",
      "id" : 1261562279,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26199",
      "node_id" : "IC_kwDOABII585LMemn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1261562279/reactions"
      },
      "updated_at" : "2022-09-28T23:18:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1261562279",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r983176654"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983176654"
         }
      },
      "author_association" : "MEMBER",
      "body" : "1. `SetupAddressRelay` used to have a misleading comment: \"First addr message we have received from the peer, initialize m_addr_known\". We were not receiving any addr messages from the peer here, yet we initialized it. It seems like this was the case from the beginning.\r\n2. After this PR, calling `SetupAddressRelay` here seems unnecessary. If we drop it, the comment becomes valid :)\r\nAlthough the inconsistency is a good signal the comment is confusing, so perhaps we should drop it. Not very useful anyway, at least the current code is pretty readable.",
      "commit_id" : "3c43d9db1e0f84279b08a93afd730caeece061a9",
      "created_at" : "2022-09-29T07:43:43Z",
      "diff_hunk" : "@@ -3274,39 +3274,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             m_num_preferred_download_peers += state->fPreferredDownload;\n         }\n \n-        // Self advertisement & GETADDR logic\n         if (!pfrom.IsInboundConn() && SetupAddressRelay(pfrom, *peer)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r983176654",
      "id" : 983176654,
      "line" : 3277,
      "node_id" : "PRRC_kwDOABII5846mhXO",
      "original_commit_id" : "3c43d9db1e0f84279b08a93afd730caeece061a9",
      "original_line" : 3277,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 5,
      "pull_request_review_id" : 1124784756,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983176654/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T07:43:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983176654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r983177362"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983177362"
         }
      },
      "author_association" : "MEMBER",
      "body" : "So yeah: 1) Drop `SetupAddressRelay` here; 2) Possibly drop the useless comment from `SetupAddressRelay`?",
      "commit_id" : "3c43d9db1e0f84279b08a93afd730caeece061a9",
      "created_at" : "2022-09-29T07:44:19Z",
      "diff_hunk" : "@@ -3274,39 +3274,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             m_num_preferred_download_peers += state->fPreferredDownload;\n         }\n \n-        // Self advertisement & GETADDR logic\n         if (!pfrom.IsInboundConn() && SetupAddressRelay(pfrom, *peer)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r983177362",
      "id" : 983177362,
      "in_reply_to_id" : 983176654,
      "line" : 3277,
      "node_id" : "PRRC_kwDOABII5846mhiS",
      "original_commit_id" : "3c43d9db1e0f84279b08a93afd730caeece061a9",
      "original_line" : 3277,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 5,
      "pull_request_review_id" : 1124785556,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983177362/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T07:44:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983177362",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r983186308"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983186308"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Alright, this has side-effects. `MaybeSendAddr` (another self-ad) will stop working until we get an ADDR message from the peer (not the case before the change i suggest here).\r\n\r\nPerhaps this code should be:\r\n```\r\nif (!pfrom.IsInboundConn()) {\r\n    SetupAddressRelay(pfrom, *peer);\r\n    ....\r\n}",
      "commit_id" : "3c43d9db1e0f84279b08a93afd730caeece061a9",
      "created_at" : "2022-09-29T07:53:38Z",
      "diff_hunk" : "@@ -3274,39 +3274,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             m_num_preferred_download_peers += state->fPreferredDownload;\n         }\n \n-        // Self advertisement & GETADDR logic\n         if (!pfrom.IsInboundConn() && SetupAddressRelay(pfrom, *peer)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#discussion_r983186308",
      "id" : 983186308,
      "in_reply_to_id" : 983176654,
      "line" : 3277,
      "node_id" : "PRRC_kwDOABII5846mjuE",
      "original_commit_id" : "3c43d9db1e0f84279b08a93afd730caeece061a9",
      "original_line" : 3277,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 5,
      "pull_request_review_id" : 1124798191,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26199",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983186308/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T07:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983186308",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2022-09-30T08:47:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1263292453",
      "id" : 1263292453,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26199",
      "node_id" : "IC_kwDOABII585LTFAl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1263292453/reactions"
      },
      "updated_at" : "2022-09-30T08:47:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1263292453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I dunno if I'm supposed to ACK this since this is my commit, but I approve the changes 3c43d9db1e0f84279b08a93afd730caeece061a9 I guess :)\r\n\r\nAn easy way to look at this change is to notice that this code is almost entirely a subset of `MaybeSendAddr`. At the same time, it *heavily relies* on `MaybSendAddr` to actually do something, not much would change if you drop the duplicate subset (what this PR does).\r\n\r\nOne real difference this could make is that due to the \"makes a probabilistic decision to either advertise what they think we are or what we think we are\" of this behavior, we could have ended up having two self-ads in one ADDR message (one added here, one added in `MaybeSendAddr` if they are different). I don't think this is a show-stopper for this PR. I don't think we want to preserve this behavior.\r\n\r\nUPD:\r\n\r\nAnother important difference could be the time between the two calls. This might make sense if there's a risk of someone inserting our self-ad (`PushAddress`) with the wrong metadata, eg `nTime`. Then our latter self-ad insertion would be dismissed (because we just look up the key), while the VERSION-one is protected from this issue.\r\nI don't think this is a show-stopper for this PR, although this surface could indeed be improved (e.g., handle duplicates better, or handle other-nodes-announce-us-through-us differently).",
      "created_at" : "2022-09-30T09:39:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26199#issuecomment-1263346134",
      "id" : 1263346134,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26199",
      "node_id" : "IC_kwDOABII585LTSHW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1263346134/reactions"
      },
      "updated_at" : "2022-09-30T09:51:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1263346134",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   }
]
