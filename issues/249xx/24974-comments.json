[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24931](https://github.com/bitcoin/bitcoin/pull/24931) (Strengthen thread safety assertions by ajtowns)\n* [#24925](https://github.com/bitcoin/bitcoin/pull/24925) (refactor: make GetRand a template, remove GetRandInt by PastaPastaPasta)\n* [#24921](https://github.com/bitcoin/bitcoin/pull/24921) (Add time helpers for std::chrono::steady_clock and FastRandomContext::rand_uniform_delay by MarcoFalke)\n* [#24697](https://github.com/bitcoin/bitcoin/pull/24697) (refactor address relay time by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-04-25T17:48:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24974#issuecomment-1108862564",
      "id" : 1108862564,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24974",
      "node_id" : "IC_kwDOABII585CF-Zk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1108862564/reactions"
      },
      "updated_at" : "2022-05-04T12:35:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1108862564",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK fae94c6591231722f01ccde689f0b36febf824cc",
      "created_at" : "2022-04-29T13:54:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24974#issuecomment-1113339042",
      "id" : 1113339042,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24974",
      "node_id" : "IC_kwDOABII585CXDSi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113339042/reactions"
      },
      "updated_at" : "2022-04-29T13:54:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113339042",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ajtowns You might be interested in (N)ACKing this change, based on the conversation in https://github.com/bitcoin/bitcoin/pull/24697#discussion_r848094959",
      "created_at" : "2022-04-29T14:00:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24974#issuecomment-1113345946",
      "id" : 1113345946,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24974",
      "node_id" : "IC_kwDOABII585CXE-a",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113345946/reactions"
      },
      "updated_at" : "2022-04-29T14:00:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113345946",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r861932886"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/861932886"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think it makes sense to pass in a time point here; even if we used `sleep_until` that would just end up doing `now() + rand - now()` which seems silly.\r\n\r\nBut, rather than parameterise by a duration; we could parameterise by a Clock:\r\n\r\n```c++\r\n    template <typename C=std::chrono::steady_clock>\r\n    typename C::duration rand_uniform_duration(typename C::duration max) noexcept\r\n    {\r\n        assert(max.count() > 0);\r\n        return typename C::duration{GetRand(max.count())};\r\n    };\r\n```\r\nwhich would make it just be:\r\n\r\n```c++\r\n    if (!interruptNet.sleep_for(rng.rand_uniform_duration(FEELER_SLEEP_WINDOW)))\r\n```\r\n\r\n(That avoids the need for the `common_type` stuff too)\r\n\r\nAt least for me, `steady_clock` operates in nanoseconds, so the existing `sleep_for(millis)` doesn't work, but replacing the three `CThreadInterrupt::sleep_for` methods with a single one that accepts `std::chrono::steady_clock::duration rel_time` would fix that. Alternatively, so would:\r\n\r\n```c++\r\n    template <typename Dur>\r\n    bool sleep_for(Dur rel_time)\r\n    {\r\n        return sleep_for_ms(std::chrono::duration_cast<std::chrono::milliseconds>(rel_time));\r\n    }\r\n```",
      "commit_id" : "fa9970a769a2f03cd5c9b2f4a00e530d395d7ffb",
      "created_at" : "2022-04-29T15:49:53Z",
      "diff_hunk" : "@@ -2151,12 +2152,11 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         }\n \n         if (addrConnect.IsValid()) {\n-\n             if (fFeeler) {\n                 // Add small amount of random noise before connection to avoid synchronization.\n-                int randsleep = GetRandInt(FEELER_SLEEP_WINDOW * 1000);\n-                if (!interruptNet.sleep_for(std::chrono::milliseconds(randsleep)))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r861932886",
      "id" : 861932886,
      "line" : 2164,
      "node_id" : "PRRC_kwDOABII584zYA1W",
      "original_commit_id" : "fae94c6591231722f01ccde689f0b36febf824cc",
      "original_line" : 2164,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 27,
      "pull_request_review_id" : 957931396,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/861932886/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-29T16:01:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/861932886",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r862330618"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862330618"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, changed",
      "commit_id" : "fa9970a769a2f03cd5c9b2f4a00e530d395d7ffb",
      "created_at" : "2022-04-30T08:33:41Z",
      "diff_hunk" : "@@ -2151,12 +2152,11 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         }\n \n         if (addrConnect.IsValid()) {\n-\n             if (fFeeler) {\n                 // Add small amount of random noise before connection to avoid synchronization.\n-                int randsleep = GetRandInt(FEELER_SLEEP_WINDOW * 1000);\n-                if (!interruptNet.sleep_for(std::chrono::milliseconds(randsleep)))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r862330618",
      "id" : 862330618,
      "in_reply_to_id" : 861932886,
      "line" : 2164,
      "node_id" : "PRRC_kwDOABII584zZh76",
      "original_commit_id" : "fae94c6591231722f01ccde689f0b36febf824cc",
      "original_line" : 2164,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 27,
      "pull_request_review_id" : 958470493,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862330618/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-30T08:33:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862330618",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r862331287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862331287"
         }
      },
      "author_association" : "MEMBER",
      "body" : "review note: https://eel.is/c++draft/thread.condition.condvar#24",
      "commit_id" : "fac6af70fd14c380a016152ce38c20158da03136",
      "created_at" : "2022-04-30T08:41:57Z",
      "diff_hunk" : "@@ -19,13 +19,12 @@\n class CThreadInterrupt\n {\n public:\n+    using Clock = std::chrono::steady_clock;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r862331287",
      "id" : 862331287,
      "line" : 22,
      "node_id" : "PRRC_kwDOABII584zZiGX",
      "original_commit_id" : "fa9970a769a2f03cd5c9b2f4a00e530d395d7ffb",
      "original_line" : 22,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/threadinterrupt.h",
      "position" : 4,
      "pull_request_review_id" : 958471002,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862331287/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T13:58:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862331287",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-05-10T06:08:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24974#issuecomment-1121968018",
      "id" : 1121968018,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24974",
      "node_id" : "IC_kwDOABII585C39-S",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1121968018/reactions"
      },
      "updated_at" : "2022-05-10T06:08:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1121968018",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2022-05-10T07:24:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24974#issuecomment-1122025635",
      "id" : 1122025635,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24974",
      "node_id" : "IC_kwDOABII585C4MCj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1122025635/reactions"
      },
      "updated_at" : "2022-05-10T07:24:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1122025635",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r869264320"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869264320"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why support negative ranges?",
      "commit_id" : "fac6af70fd14c380a016152ce38c20158da03136",
      "created_at" : "2022-05-10T13:49:07Z",
      "diff_hunk" : "@@ -227,13 +228,19 @@ class FastRandomContext\n     template <typename Tp>\n     Tp rand_uniform_delay(const Tp& time, typename Tp::duration range)\n     {\n-        using Dur = typename Tp::duration;\n-        Dur dur{range.count() > 0 ? /* interval [0..range) */ Dur{randrange(range.count())} :\n-                range.count() < 0 ? /* interval (range..0] */ -Dur{randrange(-range.count())} :\n-                                    /* interval [0..0] */ Dur{0}};\n-        return time + dur;\n+        return time + rand_uniform_duration<Tp>(range);\n     }\n \n+    /** Generate a uniform random duration in the range from 0 (inclusive) to range (exclusive). */\n+    template <typename Chrono>\n+    typename Chrono::duration rand_uniform_duration(typename Chrono::duration range) noexcept\n+    {\n+        using Dur = typename Chrono::duration;\n+        return range.count() > 0 ? /* interval [0..range) */ Dur{randrange(range.count())} :\n+               range.count() < 0 ? /* interval (range..0] */ -Dur{randrange(-range.count())} :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r869264320",
      "id" : 869264320,
      "line" : 240,
      "node_id" : "PRRC_kwDOABII584zz-vA",
      "original_commit_id" : "fac6af70fd14c380a016152ce38c20158da03136",
      "original_line" : 240,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 26,
      "pull_request_review_id" : 967818872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869264320/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T13:49:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869264320",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r869277448"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869277448"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Some call sites may use a negative range. For example in addr relay, the timestamp of some address messages is randomly pushed into the past.\r\n\r\nAlso, it seems safer when the alternative is either unspecified behaviour, or a crash.",
      "commit_id" : "fac6af70fd14c380a016152ce38c20158da03136",
      "created_at" : "2022-05-10T13:59:27Z",
      "diff_hunk" : "@@ -227,13 +228,19 @@ class FastRandomContext\n     template <typename Tp>\n     Tp rand_uniform_delay(const Tp& time, typename Tp::duration range)\n     {\n-        using Dur = typename Tp::duration;\n-        Dur dur{range.count() > 0 ? /* interval [0..range) */ Dur{randrange(range.count())} :\n-                range.count() < 0 ? /* interval (range..0] */ -Dur{randrange(-range.count())} :\n-                                    /* interval [0..0] */ Dur{0}};\n-        return time + dur;\n+        return time + rand_uniform_duration<Tp>(range);\n     }\n \n+    /** Generate a uniform random duration in the range from 0 (inclusive) to range (exclusive). */\n+    template <typename Chrono>\n+    typename Chrono::duration rand_uniform_duration(typename Chrono::duration range) noexcept\n+    {\n+        using Dur = typename Chrono::duration;\n+        return range.count() > 0 ? /* interval [0..range) */ Dur{randrange(range.count())} :\n+               range.count() < 0 ? /* interval (range..0] */ -Dur{randrange(-range.count())} :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r869277448",
      "id" : 869277448,
      "in_reply_to_id" : 869264320,
      "line" : 240,
      "node_id" : "PRRC_kwDOABII584z0B8I",
      "original_commit_id" : "fac6af70fd14c380a016152ce38c20158da03136",
      "original_line" : 240,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 26,
      "pull_request_review_id" : 967837669,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869277448/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T13:59:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869277448",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r869286539"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869286539"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The behavior here still seems odd in those cases. I'd expect call sites that actually can result in negative range values to want \"rand_uniform_duration(T)\" to mean: \"give me a uniform duration not exceeding T\". If T is negative, that probably means just returning 0?",
      "commit_id" : "fac6af70fd14c380a016152ce38c20158da03136",
      "created_at" : "2022-05-10T14:07:24Z",
      "diff_hunk" : "@@ -227,13 +228,19 @@ class FastRandomContext\n     template <typename Tp>\n     Tp rand_uniform_delay(const Tp& time, typename Tp::duration range)\n     {\n-        using Dur = typename Tp::duration;\n-        Dur dur{range.count() > 0 ? /* interval [0..range) */ Dur{randrange(range.count())} :\n-                range.count() < 0 ? /* interval (range..0] */ -Dur{randrange(-range.count())} :\n-                                    /* interval [0..0] */ Dur{0}};\n-        return time + dur;\n+        return time + rand_uniform_duration<Tp>(range);\n     }\n \n+    /** Generate a uniform random duration in the range from 0 (inclusive) to range (exclusive). */\n+    template <typename Chrono>\n+    typename Chrono::duration rand_uniform_duration(typename Chrono::duration range) noexcept\n+    {\n+        using Dur = typename Chrono::duration;\n+        return range.count() > 0 ? /* interval [0..range) */ Dur{randrange(range.count())} :\n+               range.count() < 0 ? /* interval (range..0] */ -Dur{randrange(-range.count())} :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r869286539",
      "id" : 869286539,
      "in_reply_to_id" : 869264320,
      "line" : 240,
      "node_id" : "PRRC_kwDOABII584z0EKL",
      "original_commit_id" : "fac6af70fd14c380a016152ce38c20158da03136",
      "original_line" : 240,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 26,
      "pull_request_review_id" : 967851370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869286539/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T14:07:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869286539",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r869294988"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869294988"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, the interval is determined at run-time and the passed in value can either mean the start or the end of the interval, with the other value being `0`.\r\n\r\nI am not sure if mapping any negative value to a constant `0` is less confusing. And I couldn't find another solution that is well defined at run time (no unspecified behaviour, no crash).",
      "commit_id" : "fac6af70fd14c380a016152ce38c20158da03136",
      "created_at" : "2022-05-10T14:14:39Z",
      "diff_hunk" : "@@ -227,13 +228,19 @@ class FastRandomContext\n     template <typename Tp>\n     Tp rand_uniform_delay(const Tp& time, typename Tp::duration range)\n     {\n-        using Dur = typename Tp::duration;\n-        Dur dur{range.count() > 0 ? /* interval [0..range) */ Dur{randrange(range.count())} :\n-                range.count() < 0 ? /* interval (range..0] */ -Dur{randrange(-range.count())} :\n-                                    /* interval [0..0] */ Dur{0}};\n-        return time + dur;\n+        return time + rand_uniform_duration<Tp>(range);\n     }\n \n+    /** Generate a uniform random duration in the range from 0 (inclusive) to range (exclusive). */\n+    template <typename Chrono>\n+    typename Chrono::duration rand_uniform_duration(typename Chrono::duration range) noexcept\n+    {\n+        using Dur = typename Chrono::duration;\n+        return range.count() > 0 ? /* interval [0..range) */ Dur{randrange(range.count())} :\n+               range.count() < 0 ? /* interval (range..0] */ -Dur{randrange(-range.count())} :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r869294988",
      "id" : 869294988,
      "in_reply_to_id" : 869264320,
      "line" : 240,
      "node_id" : "PRRC_kwDOABII584z0GOM",
      "original_commit_id" : "fac6af70fd14c380a016152ce38c20158da03136",
      "original_line" : 240,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 26,
      "pull_request_review_id" : 967863809,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869294988/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T14:14:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869294988",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r869317017"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869317017"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, I'm not objecting to this change. It just strikes me as bizarre semantics; the simplest interpretation of a range is specifying how wide the window of possible values is - and that simply cannot be negative.\r\n\r\nAn alternative is always returning range itself if it is <= 0. That at least satisfies the constraint \"never return a value exceeding range\", and probably works just as well for the intended call sites (who I suspect use to determine how long to wait)?",
      "commit_id" : "fac6af70fd14c380a016152ce38c20158da03136",
      "created_at" : "2022-05-10T14:33:30Z",
      "diff_hunk" : "@@ -227,13 +228,19 @@ class FastRandomContext\n     template <typename Tp>\n     Tp rand_uniform_delay(const Tp& time, typename Tp::duration range)\n     {\n-        using Dur = typename Tp::duration;\n-        Dur dur{range.count() > 0 ? /* interval [0..range) */ Dur{randrange(range.count())} :\n-                range.count() < 0 ? /* interval (range..0] */ -Dur{randrange(-range.count())} :\n-                                    /* interval [0..0] */ Dur{0}};\n-        return time + dur;\n+        return time + rand_uniform_duration<Tp>(range);\n     }\n \n+    /** Generate a uniform random duration in the range from 0 (inclusive) to range (exclusive). */\n+    template <typename Chrono>\n+    typename Chrono::duration rand_uniform_duration(typename Chrono::duration range) noexcept\n+    {\n+        using Dur = typename Chrono::duration;\n+        return range.count() > 0 ? /* interval [0..range) */ Dur{randrange(range.count())} :\n+               range.count() < 0 ? /* interval (range..0] */ -Dur{randrange(-range.count())} :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r869317017",
      "id" : 869317017,
      "in_reply_to_id" : 869264320,
      "line" : 240,
      "node_id" : "PRRC_kwDOABII584z0LmZ",
      "original_commit_id" : "fac6af70fd14c380a016152ce38c20158da03136",
      "original_line" : 240,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 26,
      "pull_request_review_id" : 967896063,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869317017/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T14:33:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869317017",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r869337240"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869337240"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Again, I am not sure that returning any constant is less confusing for a random function that took a non-zero input.\r\n\r\nFor reference, one potential call site would be:\r\n\r\n```\r\naddr.nTime = GetTime() - rng.randrange(nOneWeek) - nOneWeek;\r\n```\r\n\r\nThis (and any other) call site can obviously be written without relying on a negative range, but we'd also need to avoid this with a compile error. Without `consteval`, this is probably only possible with some template magic?",
      "commit_id" : "fac6af70fd14c380a016152ce38c20158da03136",
      "created_at" : "2022-05-10T14:50:41Z",
      "diff_hunk" : "@@ -227,13 +228,19 @@ class FastRandomContext\n     template <typename Tp>\n     Tp rand_uniform_delay(const Tp& time, typename Tp::duration range)\n     {\n-        using Dur = typename Tp::duration;\n-        Dur dur{range.count() > 0 ? /* interval [0..range) */ Dur{randrange(range.count())} :\n-                range.count() < 0 ? /* interval (range..0] */ -Dur{randrange(-range.count())} :\n-                                    /* interval [0..0] */ Dur{0}};\n-        return time + dur;\n+        return time + rand_uniform_duration<Tp>(range);\n     }\n \n+    /** Generate a uniform random duration in the range from 0 (inclusive) to range (exclusive). */\n+    template <typename Chrono>\n+    typename Chrono::duration rand_uniform_duration(typename Chrono::duration range) noexcept\n+    {\n+        using Dur = typename Chrono::duration;\n+        return range.count() > 0 ? /* interval [0..range) */ Dur{randrange(range.count())} :\n+               range.count() < 0 ? /* interval (range..0] */ -Dur{randrange(-range.count())} :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r869337240",
      "id" : 869337240,
      "in_reply_to_id" : 869264320,
      "line" : 240,
      "node_id" : "PRRC_kwDOABII584z0QiY",
      "original_commit_id" : "fac6af70fd14c380a016152ce38c20158da03136",
      "original_line" : 240,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 26,
      "pull_request_review_id" : 967925108,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869337240/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T14:50:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869337240",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r869400677"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869400677"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think template magic works for this -- you get \"non-type template parameter\" errors trying to pass chrono::duration's as template parameters. I think you could do it with c++20 which allows \"literal class types\" as a non-type template parameter. https://en.cppreference.com/w/cpp/language/template_parameters",
      "commit_id" : "fac6af70fd14c380a016152ce38c20158da03136",
      "created_at" : "2022-05-10T15:39:39Z",
      "diff_hunk" : "@@ -227,13 +228,19 @@ class FastRandomContext\n     template <typename Tp>\n     Tp rand_uniform_delay(const Tp& time, typename Tp::duration range)\n     {\n-        using Dur = typename Tp::duration;\n-        Dur dur{range.count() > 0 ? /* interval [0..range) */ Dur{randrange(range.count())} :\n-                range.count() < 0 ? /* interval (range..0] */ -Dur{randrange(-range.count())} :\n-                                    /* interval [0..0] */ Dur{0}};\n-        return time + dur;\n+        return time + rand_uniform_duration<Tp>(range);\n     }\n \n+    /** Generate a uniform random duration in the range from 0 (inclusive) to range (exclusive). */\n+    template <typename Chrono>\n+    typename Chrono::duration rand_uniform_duration(typename Chrono::duration range) noexcept\n+    {\n+        using Dur = typename Chrono::duration;\n+        return range.count() > 0 ? /* interval [0..range) */ Dur{randrange(range.count())} :\n+               range.count() < 0 ? /* interval (range..0] */ -Dur{randrange(-range.count())} :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r869400677",
      "id" : 869400677,
      "in_reply_to_id" : 869264320,
      "line" : 240,
      "node_id" : "PRRC_kwDOABII584z0gBl",
      "original_commit_id" : "fac6af70fd14c380a016152ce38c20158da03136",
      "original_line" : 240,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 26,
      "pull_request_review_id" : 968017606,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869400677/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T15:39:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869400677",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r869427321"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869427321"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe `if (Assume(range.count()) > 0) { return Dur{randrange...}; } else { return range; }` ? I don't think we could make it a `consteval` function even with c++20, because `rng.randrange()` isn't going to be `consteval`?",
      "commit_id" : "fac6af70fd14c380a016152ce38c20158da03136",
      "created_at" : "2022-05-10T15:59:36Z",
      "diff_hunk" : "@@ -227,13 +228,19 @@ class FastRandomContext\n     template <typename Tp>\n     Tp rand_uniform_delay(const Tp& time, typename Tp::duration range)\n     {\n-        using Dur = typename Tp::duration;\n-        Dur dur{range.count() > 0 ? /* interval [0..range) */ Dur{randrange(range.count())} :\n-                range.count() < 0 ? /* interval (range..0] */ -Dur{randrange(-range.count())} :\n-                                    /* interval [0..0] */ Dur{0}};\n-        return time + dur;\n+        return time + rand_uniform_duration<Tp>(range);\n     }\n \n+    /** Generate a uniform random duration in the range from 0 (inclusive) to range (exclusive). */\n+    template <typename Chrono>\n+    typename Chrono::duration rand_uniform_duration(typename Chrono::duration range) noexcept\n+    {\n+        using Dur = typename Chrono::duration;\n+        return range.count() > 0 ? /* interval [0..range) */ Dur{randrange(range.count())} :\n+               range.count() < 0 ? /* interval (range..0] */ -Dur{randrange(-range.count())} :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r869427321",
      "id" : 869427321,
      "in_reply_to_id" : 869264320,
      "line" : 240,
      "node_id" : "PRRC_kwDOABII584z0mh5",
      "original_commit_id" : "fac6af70fd14c380a016152ce38c20158da03136",
      "original_line" : 240,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 26,
      "pull_request_review_id" : 968049722,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869427321/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T15:59:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869427321",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r870996381"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870996381"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It would be ideal to enforce non-negative at compile time, and then force every caller to switch to a non-negative construction.\r\n\r\nWhile I don't think how this is possible, I don't have much preference for the behavior if the value is negative. It is indeed annoying. We're not making it worse at least.\r\nPerhaps status quo makes more sense in this case.",
      "commit_id" : "fac6af70fd14c380a016152ce38c20158da03136",
      "created_at" : "2022-05-12T06:33:51Z",
      "diff_hunk" : "@@ -227,13 +228,19 @@ class FastRandomContext\n     template <typename Tp>\n     Tp rand_uniform_delay(const Tp& time, typename Tp::duration range)\n     {\n-        using Dur = typename Tp::duration;\n-        Dur dur{range.count() > 0 ? /* interval [0..range) */ Dur{randrange(range.count())} :\n-                range.count() < 0 ? /* interval (range..0] */ -Dur{randrange(-range.count())} :\n-                                    /* interval [0..0] */ Dur{0}};\n-        return time + dur;\n+        return time + rand_uniform_duration<Tp>(range);\n     }\n \n+    /** Generate a uniform random duration in the range from 0 (inclusive) to range (exclusive). */\n+    template <typename Chrono>\n+    typename Chrono::duration rand_uniform_duration(typename Chrono::duration range) noexcept\n+    {\n+        using Dur = typename Chrono::duration;\n+        return range.count() > 0 ? /* interval [0..range) */ Dur{randrange(range.count())} :\n+               range.count() < 0 ? /* interval (range..0] */ -Dur{randrange(-range.count())} :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24974#discussion_r870996381",
      "id" : 870996381,
      "in_reply_to_id" : 869264320,
      "line" : 240,
      "node_id" : "PRRC_kwDOABII584z6lmd",
      "original_commit_id" : "fac6af70fd14c380a016152ce38c20158da03136",
      "original_line" : 240,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/random.h",
      "position" : 26,
      "pull_request_review_id" : 970318092,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24974",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870996381/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-12T06:33:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870996381",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   }
]
