[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. The current naming is very confusing. There's even a comment in walletdb.h to say so:\r\n\r\n```\r\n/**\r\n * Overview of wallet database classes:\r\n *\r\n * - CDBEnv is an environment in which the database exists (has no analog in dbwrapper.h)\r\n * - CWalletDBWrapper represents a wallet database (similar to CDBWrapper in dbwrapper.h)\r\n * - CDB is a low-level database transaction (similar to CDBBatch in dbwrapper.h)\r\n * - CWalletDB is a modifier object for the wallet, and encapsulates a database\r\n *   transaction as well as methods to act on the database (no analog in\r\n *   dbwrapper.h)\r\n *\r\n * The latter two are named confusingly, in contrast to what the names CDB\r\n * and CWalletDB suggest they are transient transaction objects and don't\r\n * represent the database itself.\r\n */\r\n```\r\n\r\nThis should probably go in just before branching v0.16, since rebasing on top of this will be a pain.\r\n\r\nOther changes you could consider:\r\n\r\n- manually update that overview comment (and perhaps move to `wallet.h`?)\r\n- rename the `wallet/db` and `wallet/walletdb` files to be more descriptive. Perhaps `wallet/berkeley_db` and `wallet/db_checkpoint`, but I'm sure we could do better than that.\r\n\r\nI think your suggested class names are good ('checkpoint' is certainly better than 'transaction'!). I can't currently think of anything better.",
      "created_at" : "2017-12-08T13:23:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350261935",
      "id" : 350261935,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11851",
      "updated_at" : "2017-12-08T13:23:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/350261935",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> manually update that overview comment (and perhaps move to wallet.h?)\r\n\r\nAdded commit to fix the overview comment: 51eaec47ccb61de2d791c86b785ee4cf111c3b05. I didn't move it into `wallet.h` for now because it sounds from https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155354119 like a goal is to pull database reading and writing code out of main wallet class, which would make `wallet.h` not the right place for it.\r\n\r\n> rename the wallet/db and wallet/walletdb files to be more descriptive. Perhaps wallet/berkeley_db and wallet/db_checkpoint, but I'm sure we could do better than that.\r\n\r\nI'd be inclined to rename `wallet/db.h` to `wallet/db-berkeley.h`, leaving room for other implementations like `wallet/db-dummy.h`, `wallet/db-sqlite.h`, `wallet/db-log.h` (#5686), etc.\r\n\r\nI'd be inclined to rename `wallet/walletdb.h` something like `wallet/serialize.h`, `wallet/schema.h`, `wallet/kvschema.h`, `wallet/db.h`, or `wallet/db-keyvalue.h` since it's mainly responsible for key value serialization and mostly not tied to the berkeleydb backend. This would make more sense with the CWalletDB -> CDB dependency removed or reversed, though.\r\n\r\n---\r\n\r\nAdded 1 commits 003b6190e5a3d870a5eca3195e2381ee4b93de4d -> 51eaec47ccb61de2d791c86b785ee4cf111c3b05 ([pr/wren.1](https://github.com/ryanofsky/bitcoin/commits/pr/wren.1) -> [pr/wren.2](https://github.com/ryanofsky/bitcoin/commits/pr/wren.2), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/wren.1...pr/wren.2))",
      "created_at" : "2017-12-08T15:56:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350298479",
      "id" : 350298479,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11851",
      "updated_at" : "2017-12-08T15:56:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/350298479",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Nice! I find the \"WalletCheckpoint\" name kinda confusing, it is a DB batch/transaction, so I'd kinda prefer we stick with \"normal\" nomenclature there. I'm really not sure that \"BerkeleyCheckpoint\" makes all that much sense for CDB, either. I kinda wish we'd split it out into an interface and implementation, though not sure if its required for this PR, but its already essentially a pretty clean interface towards a wallet DB backend.",
      "created_at" : "2017-12-08T15:58:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350298811",
      "id" : 350298811,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11851",
      "updated_at" : "2017-12-08T15:58:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/350298811",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I find the \"WalletCheckpoint\" name kinda confusing\r\n\r\nYeah, actually checkpoint is a bad name. I just chose it because I saw a `txn_checkpoint` call in `CDB::Flush` and assumed \"checkpoint\" was some kind of BDB synonym for transaction. But it's really not. It would be good to avoid the word transaction so maybe the best thing to call this is something like `Batch` or `Update` or `Commit`.",
      "created_at" : "2017-12-08T16:04:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350300599",
      "id" : 350300599,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11851",
      "updated_at" : "2017-12-08T16:06:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/350300599",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Can you push your latest branch onto `pr/wren` so it shows up here?\r\n\r\nACK changing Checkpoint to Batch or Commit. Please just not transaction!\r\n\r\nACK your suggested filename changes. My preferences would be:\r\n- `wallet/db.h` *->* `wallet/db-berkeley.h`\r\n- `wallet/walletdb.h` *->* `wallet/schema.h`\r\n\r\nI've reviewed your commit changing the overview comment. I think it could be improved further by removing the 'analogous to x in dbwrapper.h' parts, and perhaps changing the ordering and wording, eg:\r\n\r\n```\r\n/**\r\n * Overview of wallet database classes:\r\n *\r\n * - WalletBatch is an abstract modifier object for the wallet database, and encapsulates a database\r\n *   batch update as well as methods to act on the database. It should be agnostic to the database implementation.\r\n *\r\n * The following classes are implementation specific:\r\n * - BerkeleyEnvironment is an environment in which the database exists.\r\n * - BerkeleyDatabase represents a wallet database.\r\n * - BerkeleyBatch is a low-level database batch update.\r\n */",
      "created_at" : "2017-12-08T17:23:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350320608",
      "id" : 350320608,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11851",
      "updated_at" : "2017-12-08T17:23:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/350320608",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> It would be good to avoid the word transaction so maybe the best thing to call this is something like Batch or Update or Commit.\r\n\r\nGood point. We use the term \"Batch\" in the context of LevelDB/CCoin stuff, so I'd vote for that.",
      "created_at" : "2017-12-08T17:28:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350321876",
      "id" : 350321876,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11851",
      "updated_at" : "2017-12-08T17:28:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/350321876",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   }
]
