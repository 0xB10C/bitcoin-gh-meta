[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11864#discussion_r156109807"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11864"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156109807"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would be good for a comment to explaining the lock. If I understand the PR description correctly, this is preventing concurrent fundraw transactions from spending the same outputs due to the delay between CreateTransaction and LockCoin below?",
      "commit_id" : "051aa180c0d5ed2f4254e9962faf1a346beabefa",
      "created_at" : "2017-12-11T15:44:30Z",
      "diff_hunk" : "@@ -2593,17 +2593,19 @@ bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nC\n     std::vector<CRecipient> vecSend;\n \n     // Turn the txout set into a CRecipient vector\n-    for (size_t idx = 0; idx < tx.vout.size(); idx++)\n-    {\n+    for (size_t idx = 0; idx < tx.vout.size(); idx++) {\n         const CTxOut& txOut = tx.vout[idx];\n         CRecipient recipient = {txOut.scriptPubKey, txOut.nValue, setSubtractFeeFromOutputs.count(idx) == 1};\n         vecSend.push_back(recipient);\n     }\n \n     coinControl.fAllowOtherInputs = true;\n \n-    for (const CTxIn& txin : tx.vin)\n+    for (const CTxIn& txin : tx.vin) {\n         coinControl.Select(txin.prevout);\n+    }\n+\n+    LOCK2(cs_main, cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11864#discussion_r156109807",
      "id" : 156109807,
      "original_commit_id" : "051aa180c0d5ed2f4254e9962faf1a346beabefa",
      "original_position" : 19,
      "path" : "src/wallet/wallet.cpp",
      "position" : 19,
      "pull_request_review_id" : 82534282,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11864",
      "updated_at" : "2017-12-11T15:44:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156109807",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11864#discussion_r156110766"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11864"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156110766"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, or concurrent fundrawtransaction and lockunspent. The problem may not be the delay, but when one releases the lock and the other acquires, for instance.\r\n\r\nI'll add the comment.",
      "commit_id" : "051aa180c0d5ed2f4254e9962faf1a346beabefa",
      "created_at" : "2017-12-11T15:47:31Z",
      "diff_hunk" : "@@ -2593,17 +2593,19 @@ bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nC\n     std::vector<CRecipient> vecSend;\n \n     // Turn the txout set into a CRecipient vector\n-    for (size_t idx = 0; idx < tx.vout.size(); idx++)\n-    {\n+    for (size_t idx = 0; idx < tx.vout.size(); idx++) {\n         const CTxOut& txOut = tx.vout[idx];\n         CRecipient recipient = {txOut.scriptPubKey, txOut.nValue, setSubtractFeeFromOutputs.count(idx) == 1};\n         vecSend.push_back(recipient);\n     }\n \n     coinControl.fAllowOtherInputs = true;\n \n-    for (const CTxIn& txin : tx.vin)\n+    for (const CTxIn& txin : tx.vin) {\n         coinControl.Select(txin.prevout);\n+    }\n+\n+    LOCK2(cs_main, cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11864#discussion_r156110766",
      "id" : 156110766,
      "in_reply_to_id" : 156109807,
      "original_commit_id" : "051aa180c0d5ed2f4254e9962faf1a346beabefa",
      "original_position" : 19,
      "path" : "src/wallet/wallet.cpp",
      "position" : 19,
      "pull_request_review_id" : 82535437,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11864",
      "updated_at" : "2017-12-11T15:47:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156110766",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
