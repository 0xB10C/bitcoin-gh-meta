[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK.\r\n\r\n@arnabsen1729 is working on this as part of his [summerofbitcoin.org](https://summerofbitcoin.org) project. I've mentored him along the way. Some earlier review is in https://github.com/0xB10C/bitcoin/pull/1.\r\n\r\nI suspect hooking into the `add` and `spend` tracepoints during IBD could have a noticeable performance impact. I'll test this. If is is the case, then it should be documented. Not hooking into the tracepoints shouldn't have any performance impact.\r\n",
      "created_at" : "2021-09-06T15:25:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-913726985",
      "id" : 913726985,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII5842dl4J",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-06T16:22:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/913726985",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703001878"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703001878"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "what's the purpose of this argument? ",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-06T16:26:26Z",
      "diff_hunk" : "@@ -2120,6 +2120,13 @@ bool CChainState::FlushStateToDisk(\n             nLastFlush = nNow;\n             full_flush_completed = true;\n         }\n+        TRACE6(utxocache, flush,\n+               (int64_t)(GetTimeMicros() - nNow.count()), // in microseconds (Âµs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703001878",
      "id" : 703001878,
      "line" : 2124,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMzAwMTg3OA==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 2124,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 5,
      "pull_request_review_id" : 747350284,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-06T16:38:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703001878",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703005689"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703005689"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "do we need the hash string here (and the ones below)? we should avoid doing non-negligible computations in traces.",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-06T16:36:38Z",
      "diff_hunk" : "@@ -95,6 +96,15 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n     it->second.coin = std::move(coin);\n     it->second.flags |= CCoinsCacheEntry::DIRTY | (fresh ? CCoinsCacheEntry::FRESH : 0);\n     cachedCoinsUsage += it->second.coin.DynamicMemoryUsage();\n+    TRACE8(utxocache, add,\n+           outpoint.hash.ToString().c_str(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703005689",
      "id" : 703005689,
      "line" : 100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMzAwNTY4OQ==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 100,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 13,
      "pull_request_review_id" : 747350284,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-06T16:38:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703005689",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703013754"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703013754"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We need if we want to support the current versions of `bpftrace` as it can't print binary data in hex (or at all really).\r\n\r\nrelated discussion https://github.com/bitcoin/bitcoin/pull/22006#discussion_r638775357 \r\n\r\nmight be worth thinking about adding support for this in `bpftrace` rather than this _work around_ here",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-06T17:01:01Z",
      "diff_hunk" : "@@ -95,6 +96,15 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n     it->second.coin = std::move(coin);\n     it->second.flags |= CCoinsCacheEntry::DIRTY | (fresh ? CCoinsCacheEntry::FRESH : 0);\n     cachedCoinsUsage += it->second.coin.DynamicMemoryUsage();\n+    TRACE8(utxocache, add,\n+           outpoint.hash.ToString().c_str(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703013754",
      "id" : 703013754,
      "in_reply_to_id" : 703005689,
      "line" : 100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMzAxMzc1NA==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 100,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 13,
      "pull_request_review_id" : 747363336,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-06T17:58:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703013754",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703014722"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703014722"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree that `outpoint.hash.ToString().c_str()` here is called _a lot_ more than the `hash.data().toString().c_str()` in the connect_block tracepoint. This could hurt performance. Might need to drop this. ",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-06T17:03:53Z",
      "diff_hunk" : "@@ -95,6 +96,15 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n     it->second.coin = std::move(coin);\n     it->second.flags |= CCoinsCacheEntry::DIRTY | (fresh ? CCoinsCacheEntry::FRESH : 0);\n     cachedCoinsUsage += it->second.coin.DynamicMemoryUsage();\n+    TRACE8(utxocache, add,\n+           outpoint.hash.ToString().c_str(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703014722",
      "id" : 703014722,
      "in_reply_to_id" : 703005689,
      "line" : 100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMzAxNDcyMg==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 100,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 13,
      "pull_request_review_id" : 747364330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-06T17:47:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703014722",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#9384](https://github.com/bitcoin/bitcoin/pull/9384) (CCoinsViewCache code cleanup & deduplication by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-09-07T00:28:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-913911250",
      "id" : 913911250,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII5842eS3S",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-07T00:28:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/913911250",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-09-08T07:58:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-915008258",
      "id" : 915008258,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII5842iesC",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-08T07:58:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/915008258",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-09-08T14:28:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-915289125",
      "id" : 915289125,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII5842jjQl",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-08T14:28:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/915289125",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r705041737"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/705041737"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "How about only using the first 64bit of the hash: `outpoint.hash.GetUint64(0)`. This should be very fast and maybe unique enough, at least for the purpose of tracing",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-09T07:12:38Z",
      "diff_hunk" : "@@ -95,6 +96,15 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n     it->second.coin = std::move(coin);\n     it->second.flags |= CCoinsCacheEntry::DIRTY | (fresh ? CCoinsCacheEntry::FRESH : 0);\n     cachedCoinsUsage += it->second.coin.DynamicMemoryUsage();\n+    TRACE8(utxocache, add,\n+           outpoint.hash.ToString().c_str(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r705041737",
      "id" : 705041737,
      "in_reply_to_id" : 703005689,
      "line" : 100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNTA0MTczNw==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 100,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 13,
      "pull_request_review_id" : 749964690,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-09T07:12:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/705041737",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r705047534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/705047534"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We already pass `outpoint.hash.data()` as the last argument, that's not the issue. The issue here is the `ToString()` part which might be to expensive in such a frequently called function while being only a work around for `bpftrace` not supporting hex-formatting.",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-09T07:19:16Z",
      "diff_hunk" : "@@ -95,6 +96,15 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n     it->second.coin = std::move(coin);\n     it->second.flags |= CCoinsCacheEntry::DIRTY | (fresh ? CCoinsCacheEntry::FRESH : 0);\n     cachedCoinsUsage += it->second.coin.DynamicMemoryUsage();\n+    TRACE8(utxocache, add,\n+           outpoint.hash.ToString().c_str(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r705047534",
      "id" : 705047534,
      "in_reply_to_id" : 703005689,
      "line" : 100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNTA0NzUzNA==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 100,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 13,
      "pull_request_review_id" : 749970539,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-09T07:30:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/705047534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r705176691"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/705176691"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I just came across https://github.com/iovisor/bpftrace/issues/659#issuecomment-568624842. We don't need to use the built-in hex-formatting as it's quite simple just `printf(\"%02x\")` each byte of the txid in an [`unroll () {...}`][1]. This even allows us to print the txids in big-endian (the block-explorer format). \r\n\r\n```\r\n  $p = $txid + 31;\r\n  unroll(32) {\r\n      $b = *(uint8*)$p;\r\n      printf(\"%02x\", $b);\r\n      $p-=1;\r\n  }\r\n```\r\n[1]: https://github.com/iovisor/bpftrace/blob/master/docs/reference_guide.md#9-unroll---unroll\r\n\r\nThis means we can drop the `outpoint.hash.ToString().c_str()` from the tracepoints added here and use the `outpoint.hash.data()` as the first argument. ",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-09T09:55:57Z",
      "diff_hunk" : "@@ -95,6 +96,15 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n     it->second.coin = std::move(coin);\n     it->second.flags |= CCoinsCacheEntry::DIRTY | (fresh ? CCoinsCacheEntry::FRESH : 0);\n     cachedCoinsUsage += it->second.coin.DynamicMemoryUsage();\n+    TRACE8(utxocache, add,\n+           outpoint.hash.ToString().c_str(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r705176691",
      "id" : 705176691,
      "in_reply_to_id" : 703005689,
      "line" : 100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNTE3NjY5MQ==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 100,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 13,
      "pull_request_review_id" : 750130308,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-09T09:55:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/705176691",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "My benchmarks (4x reindex-chainstate till block 500000 for both the mergebase 92aad5303b9b96c46015156b5dc96b48e9e7bc76 and 15b8ba500d59c6c5de764cd13c22d0cb44d6bd14) show that this PR increases time spent in `ConnectBlock` by about 3.4%. This is without hooking into the tracepoints. \r\n\r\n![image](https://user-images.githubusercontent.com/19157360/132832934-81727f02-0292-4530-95e7-7e754c843e18.png)\r\n\r\nAs discussed in https://github.com/bitcoin/bitcoin/pull/22902#discussion_r705176691 we can drop the first argument of the `add`, `spent`, and `uncache` tracepoints which should improve the performance. Will re-benchmark then.\r\n",
      "created_at" : "2021-09-10T09:32:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-916768924",
      "id" : 916768924,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII5842pMic",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-10T09:35:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/916768924",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r706044573"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706044573"
         }
      },
      "author_association" : "NONE",
      "body" : "The purpose was to get the duration of the flush, this value can be used for benchmarking purposes. \r\n\r\nThe `nNow` was declared here:\r\nhttps://github.com/bitcoin/bitcoin/blob/384d07601185d0779c324392e798da234163ca72/src/validation.cpp#L1969",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-10T09:40:10Z",
      "diff_hunk" : "@@ -2120,6 +2120,13 @@ bool CChainState::FlushStateToDisk(\n             nLastFlush = nNow;\n             full_flush_completed = true;\n         }\n+        TRACE6(utxocache, flush,\n+               (int64_t)(GetTimeMicros() - nNow.count()), // in microseconds (Âµs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r706044573",
      "id" : 706044573,
      "in_reply_to_id" : 703001878,
      "line" : 2124,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjA0NDU3Mw==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 2124,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 5,
      "pull_request_review_id" : 751233617,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-10T09:40:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706044573",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/51032928?v=4",
         "events_url" : "https://api.github.com/users/arnabsen1729/events{/privacy}",
         "followers_url" : "https://api.github.com/users/arnabsen1729/followers",
         "following_url" : "https://api.github.com/users/arnabsen1729/following{/other_user}",
         "gists_url" : "https://api.github.com/users/arnabsen1729/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/arnabsen1729",
         "id" : 51032928,
         "login" : "arnabsen1729",
         "node_id" : "MDQ6VXNlcjUxMDMyOTI4",
         "organizations_url" : "https://api.github.com/users/arnabsen1729/orgs",
         "received_events_url" : "https://api.github.com/users/arnabsen1729/received_events",
         "repos_url" : "https://api.github.com/users/arnabsen1729/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/arnabsen1729/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/arnabsen1729/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/arnabsen1729"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r706509325"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706509325"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nice, I was trying to use unroll like this for printing data in bpftrace but could never figure it out. I was never able to do it based on a length argument, probably because it wasn't a literal. This case works fine though since we know the length of the hash.",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-10T22:55:26Z",
      "diff_hunk" : "@@ -95,6 +96,15 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n     it->second.coin = std::move(coin);\n     it->second.flags |= CCoinsCacheEntry::DIRTY | (fresh ? CCoinsCacheEntry::FRESH : 0);\n     cachedCoinsUsage += it->second.coin.DynamicMemoryUsage();\n+    TRACE8(utxocache, add,\n+           outpoint.hash.ToString().c_str(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r706509325",
      "id" : 706509325,
      "in_reply_to_id" : 703005689,
      "line" : 100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjUwOTMyNQ==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 100,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 13,
      "pull_request_review_id" : 751844670,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-10T22:55:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706509325",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   }
]
