[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK.\r\n\r\n@arnabsen1729 is working on this as part of his [summerofbitcoin.org](https://summerofbitcoin.org) project. I've helped him along the way. Some earlier review is in https://github.com/0xB10C/bitcoin/pull/1.\r\n\r\nI suspect hooking into the `add` and `spend` tracepoints during IBD could have a noticeable performance impact. I'll test this. If is is the case, then it should be documented. Not hooking into the tracepoints shouldn't have any performance impact.\r\n",
      "created_at" : "2021-09-06T15:25:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#issuecomment-913726985",
      "id" : 913726985,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22902",
      "node_id" : "IC_kwDOABII5842dl4J",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-06T15:28:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/913726985",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703001878"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703001878"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "what's the purpose of this argument? ",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-06T16:26:26Z",
      "diff_hunk" : "@@ -2120,6 +2120,13 @@ bool CChainState::FlushStateToDisk(\n             nLastFlush = nNow;\n             full_flush_completed = true;\n         }\n+        TRACE6(utxocache, flush,\n+               (int64_t)(GetTimeMicros() - nNow.count()), // in microseconds (Âµs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703001878",
      "id" : 703001878,
      "line" : 2124,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMzAwMTg3OA==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 2124,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 5,
      "pull_request_review_id" : 747350284,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-06T16:38:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703001878",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703005689"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703005689"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "do we need the hash string here (and the ones below)? we should avoid doing non-negligible computations in traces.",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-06T16:36:38Z",
      "diff_hunk" : "@@ -95,6 +96,15 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n     it->second.coin = std::move(coin);\n     it->second.flags |= CCoinsCacheEntry::DIRTY | (fresh ? CCoinsCacheEntry::FRESH : 0);\n     cachedCoinsUsage += it->second.coin.DynamicMemoryUsage();\n+    TRACE8(utxocache, add,\n+           outpoint.hash.ToString().c_str(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703005689",
      "id" : 703005689,
      "line" : 100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMzAwNTY4OQ==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 100,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 13,
      "pull_request_review_id" : 747350284,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-06T16:38:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703005689",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703013754"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703013754"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We need if we want to support the current versions of `bpftrace` as it can't print binary data in hex (or at all really).\r\n\r\nrelated discussion https://github.com/bitcoin/bitcoin/pull/22006#discussion_r638775357 \r\n\r\nmight be worth thinking about adding support for this in `bpftrace` rather than this _work around_ here",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-06T17:01:01Z",
      "diff_hunk" : "@@ -95,6 +96,15 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n     it->second.coin = std::move(coin);\n     it->second.flags |= CCoinsCacheEntry::DIRTY | (fresh ? CCoinsCacheEntry::FRESH : 0);\n     cachedCoinsUsage += it->second.coin.DynamicMemoryUsage();\n+    TRACE8(utxocache, add,\n+           outpoint.hash.ToString().c_str(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703013754",
      "id" : 703013754,
      "in_reply_to_id" : 703005689,
      "line" : 100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMzAxMzc1NA==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 100,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 13,
      "pull_request_review_id" : 747363336,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-06T17:58:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703013754",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703014722"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703014722"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree that `outpoint.hash.ToString().c_str()` here is called _a lot_ more than the `hash.data().toString().c_str()` in the connect_block tracepoint. This could hurt performance. Might need to drop this. ",
      "commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "created_at" : "2021-09-06T17:03:53Z",
      "diff_hunk" : "@@ -95,6 +96,15 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n     it->second.coin = std::move(coin);\n     it->second.flags |= CCoinsCacheEntry::DIRTY | (fresh ? CCoinsCacheEntry::FRESH : 0);\n     cachedCoinsUsage += it->second.coin.DynamicMemoryUsage();\n+    TRACE8(utxocache, add,\n+           outpoint.hash.ToString().c_str(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22902#discussion_r703014722",
      "id" : 703014722,
      "in_reply_to_id" : 703005689,
      "line" : 100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMzAxNDcyMg==",
      "original_commit_id" : "15b8ba500d59c6c5de764cd13c22d0cb44d6bd14",
      "original_line" : 100,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/coins.cpp",
      "position" : 13,
      "pull_request_review_id" : 747364330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22902",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-06T17:47:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703014722",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   }
]
