[
   {
      "author_association" : "MEMBER",
      "body" : "Tests green. Added a commit to require `CBlockIndex::GetUndoPos()` to hold cs_main as well, if reviewers think it's a good idea.\r\n ",
      "created_at" : "2021-09-09T18:01:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22932#issuecomment-916318581",
      "id" : 916318581,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22932",
      "node_id" : "IC_kwDOABII5842nel1",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-09T18:01:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/916318581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#22564](https://github.com/bitcoin/bitcoin/pull/22564) ([WIP] refactor: Move mutable globals cleared in `::UnloadBlockIndex` to `BlockManager` by dongcarl)\n* [#21526](https://github.com/bitcoin/bitcoin/pull/21526) (validation: UpdateTip/CheckBlockIndex assumeutxo support by jamesob)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-09-12T16:00:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22932#issuecomment-917662835",
      "id" : 917662835,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22932",
      "node_id" : "IC_kwDOABII5842smxz",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-18T04:36:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/917662835",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased following the merge of #22895 that this was based on.",
      "created_at" : "2021-09-16T20:04:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22932#issuecomment-921206538",
      "id" : 921206538,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22932",
      "node_id" : "IC_kwDOABII58426H8K",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-16T20:04:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/921206538",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22932#discussion_r710934432"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22932"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/710934432"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is annotating the function, but not the underlying data member that needs the annotation.\r\n\r\nNot sure how involved it will be to annotate everything properly here. Also, given that cs_main is the validation lock, we should (eventually/ideally) have a separate node_storage lock. Though, this again requires a major validation/node_storage rewrite.\r\n\r\nHowever an argument against adding the lock annotation to the data member could be that `chain` is supposed to be a data-structure-only primitive, like `transaction` or `block`. In that case only annotating the getter and setter functions (and making them standalone) would seem appropriate.",
      "commit_id" : "285ecb2feeca7811292a103d1fedf70c7414ce33",
      "created_at" : "2021-09-17T10:17:17Z",
      "diff_hunk" : "@@ -212,7 +215,8 @@ class CBlockIndex\n     {\n     }\n \n-    FlatFilePos GetBlockPos() const {\n+    FlatFilePos GetBlockPos() const EXCLUSIVE_LOCKS_REQUIRED(cs_main)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22932#discussion_r710934432",
      "id" : 710934432,
      "line" : 218,
      "node_id" : "PRRC_kwDOABII584qX_-g",
      "original_commit_id" : "f6c2fdb0a59d61e2e5d6a5f4d3a3760c777a36ab",
      "original_line" : 218,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/chain.h",
      "position" : 31,
      "pull_request_review_id" : 757300647,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22932",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-17T10:17:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/710934432",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22932#discussion_r710942005"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22932"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/710942005"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: unit tests are single-threaded, so you can just take the lock for the whole function. It is likely that there are other lock violations anyway: See https://github.com/bitcoin/bitcoin/issues/17161#issuecomment-543151879",
      "commit_id" : "285ecb2feeca7811292a103d1fedf70c7414ce33",
      "created_at" : "2021-09-17T10:29:40Z",
      "diff_hunk" : "@@ -12,7 +12,7 @@\n bool ComputeFilter(BlockFilterType filter_type, const CBlockIndex* block_index, BlockFilter& filter)\n {\n     CBlock block;\n-    if (!ReadBlockFromDisk(block, block_index->GetBlockPos(), Params().GetConsensus())) {\n+    if (!ReadBlockFromDisk(block, WITH_LOCK(cs_main, return block_index->GetBlockPos()), Params().GetConsensus())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22932#discussion_r710942005",
      "id" : 710942005,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qYB01",
      "original_commit_id" : "f6c2fdb0a59d61e2e5d6a5f4d3a3760c777a36ab",
      "original_line" : 15,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/util/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 757310339,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22932",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-17T10:29:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/710942005",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22932#discussion_r710942658"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22932"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/710942658"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same: Can include this in the cs_main scope as well, I think.",
      "commit_id" : "285ecb2feeca7811292a103d1fedf70c7414ce33",
      "created_at" : "2021-09-17T10:30:50Z",
      "diff_hunk" : "@@ -86,7 +86,8 @@ BOOST_FIXTURE_TEST_CASE(scan_for_wallet_transactions, TestChain100Setup)\n {\n     // Cap last block file size, and mine new block in a new block file.\n     CBlockIndex* oldTip = m_node.chainman->ActiveChain().Tip();\n-    GetBlockFileInfo(oldTip->GetBlockPos().nFile)->nSize = MAX_BLOCKFILE_SIZE;\n+    const auto pos{WITH_LOCK(cs_main, return oldTip->GetBlockPos())};\n+    GetBlockFileInfo(pos.nFile)->nSize = MAX_BLOCKFILE_SIZE;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22932#discussion_r710942658",
      "id" : 710942658,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qYB_C",
      "original_commit_id" : "f6c2fdb0a59d61e2e5d6a5f4d3a3760c777a36ab",
      "original_line" : 90,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/test/wallet_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 757311214,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22932",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-17T10:30:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/710942658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22932#discussion_r711181854"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22932"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711181854"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "285ecb2feeca7811292a103d1fedf70c7414ce33",
      "created_at" : "2021-09-17T16:07:38Z",
      "diff_hunk" : "@@ -12,7 +12,7 @@\n bool ComputeFilter(BlockFilterType filter_type, const CBlockIndex* block_index, BlockFilter& filter)\n {\n     CBlock block;\n-    if (!ReadBlockFromDisk(block, block_index->GetBlockPos(), Params().GetConsensus())) {\n+    if (!ReadBlockFromDisk(block, WITH_LOCK(cs_main, return block_index->GetBlockPos()), Params().GetConsensus())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22932#discussion_r711181854",
      "id" : 711181854,
      "in_reply_to_id" : 710942005,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qY8Ye",
      "original_commit_id" : "f6c2fdb0a59d61e2e5d6a5f4d3a3760c777a36ab",
      "original_line" : 15,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/util/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 757634219,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22932",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-17T16:07:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711181854",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22932#discussion_r711187206"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22932"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711187206"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done, thank you",
      "commit_id" : "285ecb2feeca7811292a103d1fedf70c7414ce33",
      "created_at" : "2021-09-17T16:15:45Z",
      "diff_hunk" : "@@ -86,7 +86,8 @@ BOOST_FIXTURE_TEST_CASE(scan_for_wallet_transactions, TestChain100Setup)\n {\n     // Cap last block file size, and mine new block in a new block file.\n     CBlockIndex* oldTip = m_node.chainman->ActiveChain().Tip();\n-    GetBlockFileInfo(oldTip->GetBlockPos().nFile)->nSize = MAX_BLOCKFILE_SIZE;\n+    const auto pos{WITH_LOCK(cs_main, return oldTip->GetBlockPos())};\n+    GetBlockFileInfo(pos.nFile)->nSize = MAX_BLOCKFILE_SIZE;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22932#discussion_r711187206",
      "id" : 711187206,
      "in_reply_to_id" : 710942658,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qY9sG",
      "original_commit_id" : "f6c2fdb0a59d61e2e5d6a5f4d3a3760c777a36ab",
      "original_line" : 90,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/test/wallet_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 757641366,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22932",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-17T16:15:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711187206",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @MarcoFalke, updated with your suggestions per `git diff f6c2fdb e950f0e`\r\n\r\n<details><summary>diff</summary><p>\r\n\r\n```diff \r\ndiff --git a/src/test/util/blockfilter.cpp b/src/test/util/blockfilter.cpp\r\nindex 311913b5db..1a663bd0b3 100644\r\n--- a/src/test/util/blockfilter.cpp\r\n+++ b/src/test/util/blockfilter.cpp\r\n@@ -11,8 +11,10 @@\r\n \r\n bool ComputeFilter(BlockFilterType filter_type, const CBlockIndex* block_index, BlockFilter& filter)\r\n {\r\n+    LOCK(cs_main);\r\n+\r\n     CBlock block;\r\n-    if (!ReadBlockFromDisk(block, WITH_LOCK(cs_main, return block_index->GetBlockPos()), Params().GetConsensus())) {\r\n+    if (!ReadBlockFromDisk(block, block_index->GetBlockPos(), Params().GetConsensus())) {\r\n         return false;\r\n     }\r\n \r\ndiff --git a/src/wallet/test/wallet_tests.cpp b/src/wallet/test/wallet_tests.cpp\r\nindex 37fd52a5e7..4ac8936ee7 100644\r\n--- a/src/wallet/test/wallet_tests.cpp\r\n+++ b/src/wallet/test/wallet_tests.cpp\r\n@@ -86,8 +86,10 @@ BOOST_FIXTURE_TEST_CASE(scan_for_wallet_transactions, TestChain100Setup)\r\n {\r\n     // Cap last block file size, and mine new block in a new block file.\r\n     CBlockIndex* oldTip = m_node.chainman->ActiveChain().Tip();\r\n-    const auto pos{WITH_LOCK(cs_main, return oldTip->GetBlockPos())};\r\n-    GetBlockFileInfo(pos.nFile)->nSize = MAX_BLOCKFILE_SIZE;\r\n+    {\r\n+        LOCK(cs_main);\r\n+        GetBlockFileInfo(oldTip->GetBlockPos().nFile)->nSize = MAX_BLOCKFILE_SIZE;\r\n+    }\r\n     CreateAndProcessBlock({}, GetScriptForRawPubKey(coinbaseKey.GetPubKey()));\r\n     CBlockIndex* newTip = m_node.chainman->ActiveChain().Tip();\r\n```\r\n</p></details>\r\n",
      "created_at" : "2021-09-17T16:22:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22932#issuecomment-921923502",
      "id" : 921923502,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22932",
      "node_id" : "IC_kwDOABII584282-u",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-17T16:22:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/921923502",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22932#discussion_r711201778"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22932"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711201778"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Having a quick look at annotating `nStatus` to assess.",
      "commit_id" : "285ecb2feeca7811292a103d1fedf70c7414ce33",
      "created_at" : "2021-09-17T16:38:02Z",
      "diff_hunk" : "@@ -212,7 +215,8 @@ class CBlockIndex\n     {\n     }\n \n-    FlatFilePos GetBlockPos() const {\n+    FlatFilePos GetBlockPos() const EXCLUSIVE_LOCKS_REQUIRED(cs_main)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22932#discussion_r711201778",
      "id" : 711201778,
      "in_reply_to_id" : 710934432,
      "line" : 218,
      "node_id" : "PRRC_kwDOABII584qZBPy",
      "original_commit_id" : "f6c2fdb0a59d61e2e5d6a5f4d3a3760c777a36ab",
      "original_line" : 218,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/chain.h",
      "position" : 31,
      "pull_request_review_id" : 757661010,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22932",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-17T16:38:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711201778",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22932#discussion_r711225765"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22932"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711225765"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Appended an exploratory small commit guarding `CBlockIndex::nStatus` by `cs_main`.",
      "commit_id" : "285ecb2feeca7811292a103d1fedf70c7414ce33",
      "created_at" : "2021-09-17T17:17:27Z",
      "diff_hunk" : "@@ -212,7 +215,8 @@ class CBlockIndex\n     {\n     }\n \n-    FlatFilePos GetBlockPos() const {\n+    FlatFilePos GetBlockPos() const EXCLUSIVE_LOCKS_REQUIRED(cs_main)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22932#discussion_r711225765",
      "id" : 711225765,
      "in_reply_to_id" : 710934432,
      "line" : 218,
      "node_id" : "PRRC_kwDOABII584qZHGl",
      "original_commit_id" : "f6c2fdb0a59d61e2e5d6a5f4d3a3760c777a36ab",
      "original_line" : 218,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/chain.h",
      "position" : 31,
      "pull_request_review_id" : 757693855,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22932",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-17T17:17:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711225765",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-09-23T21:10:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22932#issuecomment-926163532",
      "id" : 926163532,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22932",
      "node_id" : "IC_kwDOABII5843NCJM",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-23T21:10:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/926163532",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased after the merge of #21526.",
      "created_at" : "2021-09-23T21:29:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22932#issuecomment-926175891",
      "id" : 926175891,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22932",
      "node_id" : "IC_kwDOABII5843NFKT",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-23T21:29:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/926175891",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
