[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22948#discussion_r706516144"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22948"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706516144"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "this check is actually probably superfluous with the iteration not including combos -1 (the all bits set).",
      "commit_id" : "7812cff7c3cd90235c4d8d7a74901d81ac239128",
      "created_at" : "2021-09-10T23:21:03Z",
      "diff_hunk" : "@@ -174,9 +174,29 @@ unsigned int FillFlags(unsigned int flags)\n // Assumes that mapFlagNames contains all script verify flags.\n std::set<unsigned int> ExcludeIndividualFlags(unsigned int flags)\n {\n+    std::vector<unsigned int> set_flags;\n+    const size_t n_flags = sizeof(unsigned int);\n+    set_flags.reserve(n_flags);\n+    for (size_t i = 0; i < n_flags; ++i) {\n+        auto flag = flags & (1 << i);\n+        if (flag) {\n+            set_flags.push_back(flag);\n+        }\n+    }\n+    const auto combos = 1 << set_flags.size();\n+    // skip last all set flags\n+    std::vector<unsigned int> all_flag_combos(combos-1);\n+    for (size_t i = 0; i < combos-1; ++i){\n+        for(size_t j = 0; j < set_flags.size(); ++j) {\n+            if (i & (1<<j)) {\n+                all_flag_combos[i] |= set_flags[j];\n+            }\n+        }\n+    }\n+\n     std::set<unsigned int> flags_combos;\n-    for (const auto& pair : mapFlagNames) {\n-        const unsigned int flags_excluding_one = TrimFlags(flags & ~(pair.second));\n+    for (const auto& excluded_flags : all_flag_combos) {\n+        const unsigned int flags_excluding_one = TrimFlags(excluded_flags);\n         if (flags != flags_excluding_one) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22948#discussion_r706516144",
      "id" : 706516144,
      "line" : 200,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjUxNjE0NA==",
      "original_commit_id" : "125fb1c8dce51b1992cee6aa2c5b6faa6bd97b1d",
      "original_line" : 200,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/test/transaction_tests.cpp",
      "position" : 29,
      "pull_request_review_id" : 751852066,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22948",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-10T23:21:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706516144",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22948#discussion_r706518296"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22948"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706518296"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "update: it's not, because of the TrimFlags",
      "commit_id" : "7812cff7c3cd90235c4d8d7a74901d81ac239128",
      "created_at" : "2021-09-10T23:30:25Z",
      "diff_hunk" : "@@ -174,9 +174,29 @@ unsigned int FillFlags(unsigned int flags)\n // Assumes that mapFlagNames contains all script verify flags.\n std::set<unsigned int> ExcludeIndividualFlags(unsigned int flags)\n {\n+    std::vector<unsigned int> set_flags;\n+    const size_t n_flags = sizeof(unsigned int);\n+    set_flags.reserve(n_flags);\n+    for (size_t i = 0; i < n_flags; ++i) {\n+        auto flag = flags & (1 << i);\n+        if (flag) {\n+            set_flags.push_back(flag);\n+        }\n+    }\n+    const auto combos = 1 << set_flags.size();\n+    // skip last all set flags\n+    std::vector<unsigned int> all_flag_combos(combos-1);\n+    for (size_t i = 0; i < combos-1; ++i){\n+        for(size_t j = 0; j < set_flags.size(); ++j) {\n+            if (i & (1<<j)) {\n+                all_flag_combos[i] |= set_flags[j];\n+            }\n+        }\n+    }\n+\n     std::set<unsigned int> flags_combos;\n-    for (const auto& pair : mapFlagNames) {\n-        const unsigned int flags_excluding_one = TrimFlags(flags & ~(pair.second));\n+    for (const auto& excluded_flags : all_flag_combos) {\n+        const unsigned int flags_excluding_one = TrimFlags(excluded_flags);\n         if (flags != flags_excluding_one) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22948#discussion_r706518296",
      "id" : 706518296,
      "in_reply_to_id" : 706516144,
      "line" : 200,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjUxODI5Ng==",
      "original_commit_id" : "125fb1c8dce51b1992cee6aa2c5b6faa6bd97b1d",
      "original_line" : 200,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/test/transaction_tests.cpp",
      "position" : 29,
      "pull_request_review_id" : 751854312,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22948",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-10T23:30:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706518296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   }
]
