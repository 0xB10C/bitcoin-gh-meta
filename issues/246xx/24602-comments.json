[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r831575175"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831575175"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think the waste should be computed for this result as well.",
      "commit_id" : "e21d0b9df86d9878e9a4e9380c3ebbfa6932ba5e",
      "created_at" : "2022-03-21T21:54:58Z",
      "diff_hunk" : "@@ -0,0 +1,95 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/feerate.h>\n+#include <primitives/transaction.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/coinselection.h>\n+\n+#include <vector>\n+\n+namespace wallet {\n+\n+static void AddCoin(std::vector<CInputCoin>& input_coins, const CAmount& nValue, const int nInput, const int nInputBytes, const int lockTime)\n+{\n+    CMutableTransaction tx;\n+    tx.vout.resize(nInput + 1);\n+    tx.vout[nInput].nValue = nValue;\n+    tx.nLockTime = lockTime; // all transactions get different hashes\n+    CInputCoin coin(MakeTransactionRef(tx), nInput);\n+    coin.m_input_bytes = nInputBytes;\n+    input_coins.push_back(coin);\n+}\n+\n+// Randomly distribute coins to OutputGroups\n+static void GroupCoins(FuzzedDataProvider& fuzzed_data_provider, std::vector<OutputGroup>& output_groups, const std::vector<CInputCoin>& coins, const CoinSelectionParams& coin_params, const bool positive_only)\n+{\n+    auto output_group = OutputGroup(coin_params);\n+    bool valid_outputgroup{false};\n+    for (auto& coin : coins) {\n+        output_group.Insert(coin, /*depth=*/0, /*from_me=*/true, /*ancestors=*/0, /*descendants=*/0, positive_only);\n+        valid_outputgroup = !positive_only || output_group.GetSelectionAmount() > 0;\n+        if (valid_outputgroup && fuzzed_data_provider.ConsumeBool()) {\n+            output_groups.push_back(output_group);\n+            output_group = OutputGroup(coin_params);\n+            valid_outputgroup = false;\n+        }\n+    }\n+    if (valid_outputgroup) output_groups.push_back(output_group);\n+    return;\n+}\n+\n+FUZZ_TARGET(coinselection)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+    std::vector<CInputCoin> utxo_pool;\n+\n+    const CFeeRate long_term_fee_rate{CFeeRate(ConsumeMoney(fuzzed_data_provider, /*max=*/COIN))};\n+    const CFeeRate effective_fee_rate{CFeeRate(ConsumeMoney(fuzzed_data_provider, /*max=*/COIN))};\n+    const CAmount cost_of_change{ConsumeMoney(fuzzed_data_provider, /*max=*/COIN)};\n+    const CAmount target{fuzzed_data_provider.ConsumeIntegralInRange<CAmount>(1, MAX_MONEY)};\n+    const bool subtract_fee_outputs{fuzzed_data_provider.ConsumeBool()};\n+\n+    auto coin_params = CoinSelectionParams();\n+    coin_params.m_subtract_fee_outputs = subtract_fee_outputs;\n+    coin_params.m_long_term_feerate = long_term_fee_rate;\n+    coin_params.m_effective_feerate = effective_fee_rate;\n+\n+    // Create some coins\n+    CAmount total_balance{0};\n+    int nextLockTime{0};\n+    LIMITED_WHILE(fuzzed_data_provider.ConsumeBool(), 10000)\n+    {\n+        const int nInput{fuzzed_data_provider.ConsumeIntegralInRange<int>(0, 10)};\n+        const int nInputBytes{fuzzed_data_provider.ConsumeIntegralInRange<int>(100, 10000)};\n+        const CAmount amount{fuzzed_data_provider.ConsumeIntegralInRange<CAmount>(1, MAX_MONEY)};\n+        AddCoin(utxo_pool, amount, nInput, nInputBytes, ++nextLockTime);\n+        total_balance += amount;\n+    }\n+\n+    std::vector<OutputGroup> group_pos;\n+    GroupCoins(fuzzed_data_provider, group_pos, utxo_pool, coin_params, /*positive_only=*/true);\n+    std::vector<OutputGroup> group_all;\n+    GroupCoins(fuzzed_data_provider, group_all, utxo_pool, coin_params, /*positive_only=*/false);\n+\n+    // Run coinselection algorithms\n+    const auto result_bnb = SelectCoinsBnB(group_pos, target, cost_of_change);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r831575175",
      "id" : 831575175,
      "line" : 80,
      "node_id" : "PRRC_kwDOABII584xkNSH",
      "original_commit_id" : "e21d0b9df86d9878e9a4e9380c3ebbfa6932ba5e",
      "original_line" : 80,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "src/wallet/test/fuzz/coinselection.cpp",
      "position" : 80,
      "pull_request_review_id" : 916400892,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831575175/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-21T21:55:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831575175",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r831590427"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831590427"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The call was moved inside of `SelectCoinsBnB()` with #24530 so it is being computed already and wouldn't add coverage - or do you mean another explicit call from the fuzz test?",
      "commit_id" : "e21d0b9df86d9878e9a4e9380c3ebbfa6932ba5e",
      "created_at" : "2022-03-21T22:22:40Z",
      "diff_hunk" : "@@ -0,0 +1,95 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/feerate.h>\n+#include <primitives/transaction.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/coinselection.h>\n+\n+#include <vector>\n+\n+namespace wallet {\n+\n+static void AddCoin(std::vector<CInputCoin>& input_coins, const CAmount& nValue, const int nInput, const int nInputBytes, const int lockTime)\n+{\n+    CMutableTransaction tx;\n+    tx.vout.resize(nInput + 1);\n+    tx.vout[nInput].nValue = nValue;\n+    tx.nLockTime = lockTime; // all transactions get different hashes\n+    CInputCoin coin(MakeTransactionRef(tx), nInput);\n+    coin.m_input_bytes = nInputBytes;\n+    input_coins.push_back(coin);\n+}\n+\n+// Randomly distribute coins to OutputGroups\n+static void GroupCoins(FuzzedDataProvider& fuzzed_data_provider, std::vector<OutputGroup>& output_groups, const std::vector<CInputCoin>& coins, const CoinSelectionParams& coin_params, const bool positive_only)\n+{\n+    auto output_group = OutputGroup(coin_params);\n+    bool valid_outputgroup{false};\n+    for (auto& coin : coins) {\n+        output_group.Insert(coin, /*depth=*/0, /*from_me=*/true, /*ancestors=*/0, /*descendants=*/0, positive_only);\n+        valid_outputgroup = !positive_only || output_group.GetSelectionAmount() > 0;\n+        if (valid_outputgroup && fuzzed_data_provider.ConsumeBool()) {\n+            output_groups.push_back(output_group);\n+            output_group = OutputGroup(coin_params);\n+            valid_outputgroup = false;\n+        }\n+    }\n+    if (valid_outputgroup) output_groups.push_back(output_group);\n+    return;\n+}\n+\n+FUZZ_TARGET(coinselection)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+    std::vector<CInputCoin> utxo_pool;\n+\n+    const CFeeRate long_term_fee_rate{CFeeRate(ConsumeMoney(fuzzed_data_provider, /*max=*/COIN))};\n+    const CFeeRate effective_fee_rate{CFeeRate(ConsumeMoney(fuzzed_data_provider, /*max=*/COIN))};\n+    const CAmount cost_of_change{ConsumeMoney(fuzzed_data_provider, /*max=*/COIN)};\n+    const CAmount target{fuzzed_data_provider.ConsumeIntegralInRange<CAmount>(1, MAX_MONEY)};\n+    const bool subtract_fee_outputs{fuzzed_data_provider.ConsumeBool()};\n+\n+    auto coin_params = CoinSelectionParams();\n+    coin_params.m_subtract_fee_outputs = subtract_fee_outputs;\n+    coin_params.m_long_term_feerate = long_term_fee_rate;\n+    coin_params.m_effective_feerate = effective_fee_rate;\n+\n+    // Create some coins\n+    CAmount total_balance{0};\n+    int nextLockTime{0};\n+    LIMITED_WHILE(fuzzed_data_provider.ConsumeBool(), 10000)\n+    {\n+        const int nInput{fuzzed_data_provider.ConsumeIntegralInRange<int>(0, 10)};\n+        const int nInputBytes{fuzzed_data_provider.ConsumeIntegralInRange<int>(100, 10000)};\n+        const CAmount amount{fuzzed_data_provider.ConsumeIntegralInRange<CAmount>(1, MAX_MONEY)};\n+        AddCoin(utxo_pool, amount, nInput, nInputBytes, ++nextLockTime);\n+        total_balance += amount;\n+    }\n+\n+    std::vector<OutputGroup> group_pos;\n+    GroupCoins(fuzzed_data_provider, group_pos, utxo_pool, coin_params, /*positive_only=*/true);\n+    std::vector<OutputGroup> group_all;\n+    GroupCoins(fuzzed_data_provider, group_all, utxo_pool, coin_params, /*positive_only=*/false);\n+\n+    // Run coinselection algorithms\n+    const auto result_bnb = SelectCoinsBnB(group_pos, target, cost_of_change);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r831590427",
      "id" : 831590427,
      "in_reply_to_id" : 831575175,
      "line" : 80,
      "node_id" : "PRRC_kwDOABII584xkRAb",
      "original_commit_id" : "e21d0b9df86d9878e9a4e9380c3ebbfa6932ba5e",
      "original_line" : 80,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "src/wallet/test/fuzz/coinselection.cpp",
      "position" : 80,
      "pull_request_review_id" : 916420167,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831590427/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-21T22:22:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831590427",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r831594209"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831594209"
         }
      },
      "author_association" : "MEMBER",
      "body" : "oh yeah, forgot about that.",
      "commit_id" : "e21d0b9df86d9878e9a4e9380c3ebbfa6932ba5e",
      "created_at" : "2022-03-21T22:30:11Z",
      "diff_hunk" : "@@ -0,0 +1,95 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/feerate.h>\n+#include <primitives/transaction.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/coinselection.h>\n+\n+#include <vector>\n+\n+namespace wallet {\n+\n+static void AddCoin(std::vector<CInputCoin>& input_coins, const CAmount& nValue, const int nInput, const int nInputBytes, const int lockTime)\n+{\n+    CMutableTransaction tx;\n+    tx.vout.resize(nInput + 1);\n+    tx.vout[nInput].nValue = nValue;\n+    tx.nLockTime = lockTime; // all transactions get different hashes\n+    CInputCoin coin(MakeTransactionRef(tx), nInput);\n+    coin.m_input_bytes = nInputBytes;\n+    input_coins.push_back(coin);\n+}\n+\n+// Randomly distribute coins to OutputGroups\n+static void GroupCoins(FuzzedDataProvider& fuzzed_data_provider, std::vector<OutputGroup>& output_groups, const std::vector<CInputCoin>& coins, const CoinSelectionParams& coin_params, const bool positive_only)\n+{\n+    auto output_group = OutputGroup(coin_params);\n+    bool valid_outputgroup{false};\n+    for (auto& coin : coins) {\n+        output_group.Insert(coin, /*depth=*/0, /*from_me=*/true, /*ancestors=*/0, /*descendants=*/0, positive_only);\n+        valid_outputgroup = !positive_only || output_group.GetSelectionAmount() > 0;\n+        if (valid_outputgroup && fuzzed_data_provider.ConsumeBool()) {\n+            output_groups.push_back(output_group);\n+            output_group = OutputGroup(coin_params);\n+            valid_outputgroup = false;\n+        }\n+    }\n+    if (valid_outputgroup) output_groups.push_back(output_group);\n+    return;\n+}\n+\n+FUZZ_TARGET(coinselection)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+    std::vector<CInputCoin> utxo_pool;\n+\n+    const CFeeRate long_term_fee_rate{CFeeRate(ConsumeMoney(fuzzed_data_provider, /*max=*/COIN))};\n+    const CFeeRate effective_fee_rate{CFeeRate(ConsumeMoney(fuzzed_data_provider, /*max=*/COIN))};\n+    const CAmount cost_of_change{ConsumeMoney(fuzzed_data_provider, /*max=*/COIN)};\n+    const CAmount target{fuzzed_data_provider.ConsumeIntegralInRange<CAmount>(1, MAX_MONEY)};\n+    const bool subtract_fee_outputs{fuzzed_data_provider.ConsumeBool()};\n+\n+    auto coin_params = CoinSelectionParams();\n+    coin_params.m_subtract_fee_outputs = subtract_fee_outputs;\n+    coin_params.m_long_term_feerate = long_term_fee_rate;\n+    coin_params.m_effective_feerate = effective_fee_rate;\n+\n+    // Create some coins\n+    CAmount total_balance{0};\n+    int nextLockTime{0};\n+    LIMITED_WHILE(fuzzed_data_provider.ConsumeBool(), 10000)\n+    {\n+        const int nInput{fuzzed_data_provider.ConsumeIntegralInRange<int>(0, 10)};\n+        const int nInputBytes{fuzzed_data_provider.ConsumeIntegralInRange<int>(100, 10000)};\n+        const CAmount amount{fuzzed_data_provider.ConsumeIntegralInRange<CAmount>(1, MAX_MONEY)};\n+        AddCoin(utxo_pool, amount, nInput, nInputBytes, ++nextLockTime);\n+        total_balance += amount;\n+    }\n+\n+    std::vector<OutputGroup> group_pos;\n+    GroupCoins(fuzzed_data_provider, group_pos, utxo_pool, coin_params, /*positive_only=*/true);\n+    std::vector<OutputGroup> group_all;\n+    GroupCoins(fuzzed_data_provider, group_all, utxo_pool, coin_params, /*positive_only=*/false);\n+\n+    // Run coinselection algorithms\n+    const auto result_bnb = SelectCoinsBnB(group_pos, target, cost_of_change);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r831594209",
      "id" : 831594209,
      "in_reply_to_id" : 831575175,
      "line" : 80,
      "node_id" : "PRRC_kwDOABII584xkR7h",
      "original_commit_id" : "e21d0b9df86d9878e9a4e9380c3ebbfa6932ba5e",
      "original_line" : 80,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "src/wallet/test/fuzz/coinselection.cpp",
      "position" : 80,
      "pull_request_review_id" : 916425398,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831594209/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-21T22:30:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831594209",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Nice, concept ACK",
      "created_at" : "2022-03-22T11:30:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24602#issuecomment-1075060966",
      "id" : 1075060966,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24602",
      "node_id" : "IC_kwDOABII585AFCDm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1075060966/reactions"
      },
      "updated_at" : "2022-03-22T11:30:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1075060966",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832156793"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832156793"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit\r\n```suggestion\r\n// Randomly distribute coins to output_groups\r\n```",
      "commit_id" : "38915d999b56c269b357690485d8869f99ab73b0",
      "created_at" : "2022-03-22T13:10:28Z",
      "diff_hunk" : "@@ -0,0 +1,95 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/feerate.h>\n+#include <primitives/transaction.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/coinselection.h>\n+\n+#include <vector>\n+\n+namespace wallet {\n+\n+static void AddCoin(std::vector<CInputCoin>& input_coins, const CAmount& nValue, const int nInput, const int nInputBytes, const int lockTime)\n+{\n+    CMutableTransaction tx;\n+    tx.vout.resize(nInput + 1);\n+    tx.vout[nInput].nValue = nValue;\n+    tx.nLockTime = lockTime; // all transactions get different hashes\n+    CInputCoin coin(MakeTransactionRef(tx), nInput);\n+    coin.m_input_bytes = nInputBytes;\n+    input_coins.push_back(coin);\n+}\n+\n+// Randomly distribute coins to OutputGroups",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832156793",
      "id" : 832156793,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xmbR5",
      "original_commit_id" : "e21d0b9df86d9878e9a4e9380c3ebbfa6932ba5e",
      "original_line" : 28,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/wallet/test/fuzz/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 917205457,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832156793/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-22T16:59:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832156793",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832169511"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832169511"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit, here and all over the newly added `coinselection.cpp`:\r\n\r\n> Variable (including function arguments) and namespace names are all lowercase and may use `_` to separate words (snake_case).\r\n\r\nhttps://github.com/bitcoin/bitcoin/blame/f05cf59d91eb03857dd9bdcc77607764da0349d2/doc/developer-notes.md#L88-L89\r\n\r\n```suggestion\r\n    int next_lock_time{0};\r\n```",
      "commit_id" : "38915d999b56c269b357690485d8869f99ab73b0",
      "created_at" : "2022-03-22T13:21:05Z",
      "diff_hunk" : "@@ -0,0 +1,95 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/feerate.h>\n+#include <primitives/transaction.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/coinselection.h>\n+\n+#include <vector>\n+\n+namespace wallet {\n+\n+static void AddCoin(std::vector<CInputCoin>& input_coins, const CAmount& nValue, const int nInput, const int nInputBytes, const int lockTime)\n+{\n+    CMutableTransaction tx;\n+    tx.vout.resize(nInput + 1);\n+    tx.vout[nInput].nValue = nValue;\n+    tx.nLockTime = lockTime; // all transactions get different hashes\n+    CInputCoin coin(MakeTransactionRef(tx), nInput);\n+    coin.m_input_bytes = nInputBytes;\n+    input_coins.push_back(coin);\n+}\n+\n+// Randomly distribute coins to OutputGroups\n+static void GroupCoins(FuzzedDataProvider& fuzzed_data_provider, std::vector<OutputGroup>& output_groups, const std::vector<CInputCoin>& coins, const CoinSelectionParams& coin_params, const bool positive_only)\n+{\n+    auto output_group = OutputGroup(coin_params);\n+    bool valid_outputgroup{false};\n+    for (auto& coin : coins) {\n+        output_group.Insert(coin, /*depth=*/0, /*from_me=*/true, /*ancestors=*/0, /*descendants=*/0, positive_only);\n+        valid_outputgroup = !positive_only || output_group.GetSelectionAmount() > 0;\n+        if (valid_outputgroup && fuzzed_data_provider.ConsumeBool()) {\n+            output_groups.push_back(output_group);\n+            output_group = OutputGroup(coin_params);\n+            valid_outputgroup = false;\n+        }\n+    }\n+    if (valid_outputgroup) output_groups.push_back(output_group);\n+    return;\n+}\n+\n+FUZZ_TARGET(coinselection)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+    std::vector<CInputCoin> utxo_pool;\n+\n+    const CFeeRate long_term_fee_rate{CFeeRate(ConsumeMoney(fuzzed_data_provider, /*max=*/COIN))};\n+    const CFeeRate effective_fee_rate{CFeeRate(ConsumeMoney(fuzzed_data_provider, /*max=*/COIN))};\n+    const CAmount cost_of_change{ConsumeMoney(fuzzed_data_provider, /*max=*/COIN)};\n+    const CAmount target{fuzzed_data_provider.ConsumeIntegralInRange<CAmount>(1, MAX_MONEY)};\n+    const bool subtract_fee_outputs{fuzzed_data_provider.ConsumeBool()};\n+\n+    auto coin_params = CoinSelectionParams();\n+    coin_params.m_subtract_fee_outputs = subtract_fee_outputs;\n+    coin_params.m_long_term_feerate = long_term_fee_rate;\n+    coin_params.m_effective_feerate = effective_fee_rate;\n+\n+    // Create some coins\n+    CAmount total_balance{0};\n+    int nextLockTime{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832169511",
      "id" : 832169511,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xmeYn",
      "original_commit_id" : "e21d0b9df86d9878e9a4e9380c3ebbfa6932ba5e",
      "original_line" : 64,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "src/wallet/test/fuzz/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 917205457,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832169511/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-22T16:59:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832169511",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832186286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832186286"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "style:\r\n\r\n> input and inout parameters should be ordered first and output parameters should come last\r\n\r\nhttps://github.com/bitcoin/bitcoin/blame/f05cf59d91eb03857dd9bdcc77607764da0349d2/doc/developer-notes.md#L1329-L1331",
      "commit_id" : "38915d999b56c269b357690485d8869f99ab73b0",
      "created_at" : "2022-03-22T13:35:16Z",
      "diff_hunk" : "@@ -0,0 +1,95 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/feerate.h>\n+#include <primitives/transaction.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/coinselection.h>\n+\n+#include <vector>\n+\n+namespace wallet {\n+\n+static void AddCoin(std::vector<CInputCoin>& input_coins, const CAmount& nValue, const int nInput, const int nInputBytes, const int lockTime)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832186286",
      "id" : 832186286,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xmieu",
      "original_commit_id" : "e21d0b9df86d9878e9a4e9380c3ebbfa6932ba5e",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/test/fuzz/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 917205457,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832186286/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-22T16:59:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832186286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832331530"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832331530"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Looking at the body of `OutputGroup::Insert()` I can't see how `valid_outputgroup` can become `false`. What do I miss?",
      "commit_id" : "38915d999b56c269b357690485d8869f99ab73b0",
      "created_at" : "2022-03-22T15:25:43Z",
      "diff_hunk" : "@@ -0,0 +1,95 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/feerate.h>\n+#include <primitives/transaction.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/coinselection.h>\n+\n+#include <vector>\n+\n+namespace wallet {\n+\n+static void AddCoin(std::vector<CInputCoin>& input_coins, const CAmount& nValue, const int nInput, const int nInputBytes, const int lockTime)\n+{\n+    CMutableTransaction tx;\n+    tx.vout.resize(nInput + 1);\n+    tx.vout[nInput].nValue = nValue;\n+    tx.nLockTime = lockTime; // all transactions get different hashes\n+    CInputCoin coin(MakeTransactionRef(tx), nInput);\n+    coin.m_input_bytes = nInputBytes;\n+    input_coins.push_back(coin);\n+}\n+\n+// Randomly distribute coins to OutputGroups\n+static void GroupCoins(FuzzedDataProvider& fuzzed_data_provider, std::vector<OutputGroup>& output_groups, const std::vector<CInputCoin>& coins, const CoinSelectionParams& coin_params, const bool positive_only)\n+{\n+    auto output_group = OutputGroup(coin_params);\n+    bool valid_outputgroup{false};\n+    for (auto& coin : coins) {\n+        output_group.Insert(coin, /*depth=*/0, /*from_me=*/true, /*ancestors=*/0, /*descendants=*/0, positive_only);\n+        valid_outputgroup = !positive_only || output_group.GetSelectionAmount() > 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832331530",
      "id" : 832331530,
      "line" : 37,
      "node_id" : "PRRC_kwDOABII584xnF8K",
      "original_commit_id" : "e21d0b9df86d9878e9a4e9380c3ebbfa6932ba5e",
      "original_line" : 37,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/wallet/test/fuzz/coinselection.cpp",
      "position" : 37,
      "pull_request_review_id" : 917205457,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832331530/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-22T16:59:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832331530",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832347740"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832347740"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "A few iterations of this could lead to `total_balance` being bigger than `MAX_MONEY`. Could this trigger some assert in the tested functions?",
      "commit_id" : "38915d999b56c269b357690485d8869f99ab73b0",
      "created_at" : "2022-03-22T15:39:09Z",
      "diff_hunk" : "@@ -0,0 +1,95 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/feerate.h>\n+#include <primitives/transaction.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/coinselection.h>\n+\n+#include <vector>\n+\n+namespace wallet {\n+\n+static void AddCoin(std::vector<CInputCoin>& input_coins, const CAmount& nValue, const int nInput, const int nInputBytes, const int lockTime)\n+{\n+    CMutableTransaction tx;\n+    tx.vout.resize(nInput + 1);\n+    tx.vout[nInput].nValue = nValue;\n+    tx.nLockTime = lockTime; // all transactions get different hashes\n+    CInputCoin coin(MakeTransactionRef(tx), nInput);\n+    coin.m_input_bytes = nInputBytes;\n+    input_coins.push_back(coin);\n+}\n+\n+// Randomly distribute coins to OutputGroups\n+static void GroupCoins(FuzzedDataProvider& fuzzed_data_provider, std::vector<OutputGroup>& output_groups, const std::vector<CInputCoin>& coins, const CoinSelectionParams& coin_params, const bool positive_only)\n+{\n+    auto output_group = OutputGroup(coin_params);\n+    bool valid_outputgroup{false};\n+    for (auto& coin : coins) {\n+        output_group.Insert(coin, /*depth=*/0, /*from_me=*/true, /*ancestors=*/0, /*descendants=*/0, positive_only);\n+        valid_outputgroup = !positive_only || output_group.GetSelectionAmount() > 0;\n+        if (valid_outputgroup && fuzzed_data_provider.ConsumeBool()) {\n+            output_groups.push_back(output_group);\n+            output_group = OutputGroup(coin_params);\n+            valid_outputgroup = false;\n+        }\n+    }\n+    if (valid_outputgroup) output_groups.push_back(output_group);\n+    return;\n+}\n+\n+FUZZ_TARGET(coinselection)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+    std::vector<CInputCoin> utxo_pool;\n+\n+    const CFeeRate long_term_fee_rate{CFeeRate(ConsumeMoney(fuzzed_data_provider, /*max=*/COIN))};\n+    const CFeeRate effective_fee_rate{CFeeRate(ConsumeMoney(fuzzed_data_provider, /*max=*/COIN))};\n+    const CAmount cost_of_change{ConsumeMoney(fuzzed_data_provider, /*max=*/COIN)};\n+    const CAmount target{fuzzed_data_provider.ConsumeIntegralInRange<CAmount>(1, MAX_MONEY)};\n+    const bool subtract_fee_outputs{fuzzed_data_provider.ConsumeBool()};\n+\n+    auto coin_params = CoinSelectionParams();\n+    coin_params.m_subtract_fee_outputs = subtract_fee_outputs;\n+    coin_params.m_long_term_feerate = long_term_fee_rate;\n+    coin_params.m_effective_feerate = effective_fee_rate;\n+\n+    // Create some coins\n+    CAmount total_balance{0};\n+    int nextLockTime{0};\n+    LIMITED_WHILE(fuzzed_data_provider.ConsumeBool(), 10000)\n+    {\n+        const int nInput{fuzzed_data_provider.ConsumeIntegralInRange<int>(0, 10)};\n+        const int nInputBytes{fuzzed_data_provider.ConsumeIntegralInRange<int>(100, 10000)};\n+        const CAmount amount{fuzzed_data_provider.ConsumeIntegralInRange<CAmount>(1, MAX_MONEY)};\n+        AddCoin(utxo_pool, amount, nInput, nInputBytes, ++nextLockTime);\n+        total_balance += amount;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832347740",
      "id" : 832347740,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xnJ5c",
      "original_commit_id" : "e21d0b9df86d9878e9a4e9380c3ebbfa6932ba5e",
      "original_line" : 76,
      "original_position" : 72,
      "original_start_line" : 65,
      "path" : "src/wallet/test/fuzz/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 917205457,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832347740/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-22T16:59:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832347740",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832413904"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832413904"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This `return;` is unnecessary.",
      "commit_id" : "38915d999b56c269b357690485d8869f99ab73b0",
      "created_at" : "2022-03-22T16:59:24Z",
      "diff_hunk" : "@@ -0,0 +1,95 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/feerate.h>\n+#include <primitives/transaction.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/coinselection.h>\n+\n+#include <vector>\n+\n+namespace wallet {\n+\n+static void AddCoin(std::vector<CInputCoin>& input_coins, const CAmount& nValue, const int nInput, const int nInputBytes, const int lockTime)\n+{\n+    CMutableTransaction tx;\n+    tx.vout.resize(nInput + 1);\n+    tx.vout[nInput].nValue = nValue;\n+    tx.nLockTime = lockTime; // all transactions get different hashes\n+    CInputCoin coin(MakeTransactionRef(tx), nInput);\n+    coin.m_input_bytes = nInputBytes;\n+    input_coins.push_back(coin);\n+}\n+\n+// Randomly distribute coins to OutputGroups\n+static void GroupCoins(FuzzedDataProvider& fuzzed_data_provider, std::vector<OutputGroup>& output_groups, const std::vector<CInputCoin>& coins, const CoinSelectionParams& coin_params, const bool positive_only)\n+{\n+    auto output_group = OutputGroup(coin_params);\n+    bool valid_outputgroup{false};\n+    for (auto& coin : coins) {\n+        output_group.Insert(coin, /*depth=*/0, /*from_me=*/true, /*ancestors=*/0, /*descendants=*/0, positive_only);\n+        valid_outputgroup = !positive_only || output_group.GetSelectionAmount() > 0;\n+        if (valid_outputgroup && fuzzed_data_provider.ConsumeBool()) {\n+            output_groups.push_back(output_group);\n+            output_group = OutputGroup(coin_params);\n+            valid_outputgroup = false;\n+        }\n+    }\n+    if (valid_outputgroup) output_groups.push_back(output_group);\n+    return;\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832413904",
      "id" : 832413904,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xnaDQ",
      "original_commit_id" : "e21d0b9df86d9878e9a4e9380c3ebbfa6932ba5e",
      "original_line" : 45,
      "original_position" : 44,
      "original_start_line" : 43,
      "path" : "src/wallet/test/fuzz/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 917205457,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832413904/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-22T16:59:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832413904",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832687966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832687966"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I meant this as \"to instances of OutputGroup\", not the name of the local variable. Changed it to that.",
      "commit_id" : "38915d999b56c269b357690485d8869f99ab73b0",
      "created_at" : "2022-03-22T22:44:13Z",
      "diff_hunk" : "@@ -0,0 +1,95 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/feerate.h>\n+#include <primitives/transaction.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/coinselection.h>\n+\n+#include <vector>\n+\n+namespace wallet {\n+\n+static void AddCoin(std::vector<CInputCoin>& input_coins, const CAmount& nValue, const int nInput, const int nInputBytes, const int lockTime)\n+{\n+    CMutableTransaction tx;\n+    tx.vout.resize(nInput + 1);\n+    tx.vout[nInput].nValue = nValue;\n+    tx.nLockTime = lockTime; // all transactions get different hashes\n+    CInputCoin coin(MakeTransactionRef(tx), nInput);\n+    coin.m_input_bytes = nInputBytes;\n+    input_coins.push_back(coin);\n+}\n+\n+// Randomly distribute coins to OutputGroups",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832687966",
      "id" : 832687966,
      "in_reply_to_id" : 832156793,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xoc9e",
      "original_commit_id" : "e21d0b9df86d9878e9a4e9380c3ebbfa6932ba5e",
      "original_line" : 28,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/wallet/test/fuzz/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 917972454,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832687966/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-22T22:44:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832687966",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832688524"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832688524"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, cleaned it up everywhere.",
      "commit_id" : "38915d999b56c269b357690485d8869f99ab73b0",
      "created_at" : "2022-03-22T22:45:25Z",
      "diff_hunk" : "@@ -0,0 +1,95 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/feerate.h>\n+#include <primitives/transaction.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/coinselection.h>\n+\n+#include <vector>\n+\n+namespace wallet {\n+\n+static void AddCoin(std::vector<CInputCoin>& input_coins, const CAmount& nValue, const int nInput, const int nInputBytes, const int lockTime)\n+{\n+    CMutableTransaction tx;\n+    tx.vout.resize(nInput + 1);\n+    tx.vout[nInput].nValue = nValue;\n+    tx.nLockTime = lockTime; // all transactions get different hashes\n+    CInputCoin coin(MakeTransactionRef(tx), nInput);\n+    coin.m_input_bytes = nInputBytes;\n+    input_coins.push_back(coin);\n+}\n+\n+// Randomly distribute coins to OutputGroups\n+static void GroupCoins(FuzzedDataProvider& fuzzed_data_provider, std::vector<OutputGroup>& output_groups, const std::vector<CInputCoin>& coins, const CoinSelectionParams& coin_params, const bool positive_only)\n+{\n+    auto output_group = OutputGroup(coin_params);\n+    bool valid_outputgroup{false};\n+    for (auto& coin : coins) {\n+        output_group.Insert(coin, /*depth=*/0, /*from_me=*/true, /*ancestors=*/0, /*descendants=*/0, positive_only);\n+        valid_outputgroup = !positive_only || output_group.GetSelectionAmount() > 0;\n+        if (valid_outputgroup && fuzzed_data_provider.ConsumeBool()) {\n+            output_groups.push_back(output_group);\n+            output_group = OutputGroup(coin_params);\n+            valid_outputgroup = false;\n+        }\n+    }\n+    if (valid_outputgroup) output_groups.push_back(output_group);\n+    return;\n+}\n+\n+FUZZ_TARGET(coinselection)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+    std::vector<CInputCoin> utxo_pool;\n+\n+    const CFeeRate long_term_fee_rate{CFeeRate(ConsumeMoney(fuzzed_data_provider, /*max=*/COIN))};\n+    const CFeeRate effective_fee_rate{CFeeRate(ConsumeMoney(fuzzed_data_provider, /*max=*/COIN))};\n+    const CAmount cost_of_change{ConsumeMoney(fuzzed_data_provider, /*max=*/COIN)};\n+    const CAmount target{fuzzed_data_provider.ConsumeIntegralInRange<CAmount>(1, MAX_MONEY)};\n+    const bool subtract_fee_outputs{fuzzed_data_provider.ConsumeBool()};\n+\n+    auto coin_params = CoinSelectionParams();\n+    coin_params.m_subtract_fee_outputs = subtract_fee_outputs;\n+    coin_params.m_long_term_feerate = long_term_fee_rate;\n+    coin_params.m_effective_feerate = effective_fee_rate;\n+\n+    // Create some coins\n+    CAmount total_balance{0};\n+    int nextLockTime{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832688524",
      "id" : 832688524,
      "in_reply_to_id" : 832169511,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xodGM",
      "original_commit_id" : "e21d0b9df86d9878e9a4e9380c3ebbfa6932ba5e",
      "original_line" : 64,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "src/wallet/test/fuzz/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 917973179,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832688524/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-22T22:45:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832688524",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832688932"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832688932"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed the order here and in `GroupCoins()`.",
      "commit_id" : "38915d999b56c269b357690485d8869f99ab73b0",
      "created_at" : "2022-03-22T22:46:11Z",
      "diff_hunk" : "@@ -0,0 +1,95 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/feerate.h>\n+#include <primitives/transaction.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/coinselection.h>\n+\n+#include <vector>\n+\n+namespace wallet {\n+\n+static void AddCoin(std::vector<CInputCoin>& input_coins, const CAmount& nValue, const int nInput, const int nInputBytes, const int lockTime)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832688932",
      "id" : 832688932,
      "in_reply_to_id" : 832186286,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xodMk",
      "original_commit_id" : "e21d0b9df86d9878e9a4e9380c3ebbfa6932ba5e",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/test/fuzz/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 917973634,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832688932/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-22T22:46:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832688932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832689813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832689813"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The problem I tried to address here is that `OutputGroup::Insert()` may not insert anything but just [return](https://github.com/bitcoin/bitcoin/blob/f05cf59d91eb03857dd9bdcc77607764da0349d2/src/wallet/coinselection.cpp#L320) if `positive_only` is true. In that case, we might have an empty OutputGroup with `GetSelectionAmount() == 0` which would make `SelectCoinsBnB()` [assert](https://github.com/bitcoin/bitcoin/blob/f05cf59d91eb03857dd9bdcc77607764da0349d2/src/wallet/coinselection.cpp#L76), so it cannot be submitted.\r\nI added a comment for this.",
      "commit_id" : "38915d999b56c269b357690485d8869f99ab73b0",
      "created_at" : "2022-03-22T22:47:59Z",
      "diff_hunk" : "@@ -0,0 +1,95 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/feerate.h>\n+#include <primitives/transaction.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/coinselection.h>\n+\n+#include <vector>\n+\n+namespace wallet {\n+\n+static void AddCoin(std::vector<CInputCoin>& input_coins, const CAmount& nValue, const int nInput, const int nInputBytes, const int lockTime)\n+{\n+    CMutableTransaction tx;\n+    tx.vout.resize(nInput + 1);\n+    tx.vout[nInput].nValue = nValue;\n+    tx.nLockTime = lockTime; // all transactions get different hashes\n+    CInputCoin coin(MakeTransactionRef(tx), nInput);\n+    coin.m_input_bytes = nInputBytes;\n+    input_coins.push_back(coin);\n+}\n+\n+// Randomly distribute coins to OutputGroups\n+static void GroupCoins(FuzzedDataProvider& fuzzed_data_provider, std::vector<OutputGroup>& output_groups, const std::vector<CInputCoin>& coins, const CoinSelectionParams& coin_params, const bool positive_only)\n+{\n+    auto output_group = OutputGroup(coin_params);\n+    bool valid_outputgroup{false};\n+    for (auto& coin : coins) {\n+        output_group.Insert(coin, /*depth=*/0, /*from_me=*/true, /*ancestors=*/0, /*descendants=*/0, positive_only);\n+        valid_outputgroup = !positive_only || output_group.GetSelectionAmount() > 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832689813",
      "id" : 832689813,
      "in_reply_to_id" : 832331530,
      "line" : 37,
      "node_id" : "PRRC_kwDOABII584xodaV",
      "original_commit_id" : "e21d0b9df86d9878e9a4e9380c3ebbfa6932ba5e",
      "original_line" : 37,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/wallet/test/fuzz/coinselection.cpp",
      "position" : 37,
      "pull_request_review_id" : 917974742,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832689813/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-22T22:48:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832689813",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832690219"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832690219"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good catch! I'm actually not sure. But I added a break statement to the loop for this case, which (at least I hope!) can't happen in reality and therefore doesn't need fuzzing.",
      "commit_id" : "38915d999b56c269b357690485d8869f99ab73b0",
      "created_at" : "2022-03-22T22:48:55Z",
      "diff_hunk" : "@@ -0,0 +1,95 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/feerate.h>\n+#include <primitives/transaction.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/coinselection.h>\n+\n+#include <vector>\n+\n+namespace wallet {\n+\n+static void AddCoin(std::vector<CInputCoin>& input_coins, const CAmount& nValue, const int nInput, const int nInputBytes, const int lockTime)\n+{\n+    CMutableTransaction tx;\n+    tx.vout.resize(nInput + 1);\n+    tx.vout[nInput].nValue = nValue;\n+    tx.nLockTime = lockTime; // all transactions get different hashes\n+    CInputCoin coin(MakeTransactionRef(tx), nInput);\n+    coin.m_input_bytes = nInputBytes;\n+    input_coins.push_back(coin);\n+}\n+\n+// Randomly distribute coins to OutputGroups\n+static void GroupCoins(FuzzedDataProvider& fuzzed_data_provider, std::vector<OutputGroup>& output_groups, const std::vector<CInputCoin>& coins, const CoinSelectionParams& coin_params, const bool positive_only)\n+{\n+    auto output_group = OutputGroup(coin_params);\n+    bool valid_outputgroup{false};\n+    for (auto& coin : coins) {\n+        output_group.Insert(coin, /*depth=*/0, /*from_me=*/true, /*ancestors=*/0, /*descendants=*/0, positive_only);\n+        valid_outputgroup = !positive_only || output_group.GetSelectionAmount() > 0;\n+        if (valid_outputgroup && fuzzed_data_provider.ConsumeBool()) {\n+            output_groups.push_back(output_group);\n+            output_group = OutputGroup(coin_params);\n+            valid_outputgroup = false;\n+        }\n+    }\n+    if (valid_outputgroup) output_groups.push_back(output_group);\n+    return;\n+}\n+\n+FUZZ_TARGET(coinselection)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+    std::vector<CInputCoin> utxo_pool;\n+\n+    const CFeeRate long_term_fee_rate{CFeeRate(ConsumeMoney(fuzzed_data_provider, /*max=*/COIN))};\n+    const CFeeRate effective_fee_rate{CFeeRate(ConsumeMoney(fuzzed_data_provider, /*max=*/COIN))};\n+    const CAmount cost_of_change{ConsumeMoney(fuzzed_data_provider, /*max=*/COIN)};\n+    const CAmount target{fuzzed_data_provider.ConsumeIntegralInRange<CAmount>(1, MAX_MONEY)};\n+    const bool subtract_fee_outputs{fuzzed_data_provider.ConsumeBool()};\n+\n+    auto coin_params = CoinSelectionParams();\n+    coin_params.m_subtract_fee_outputs = subtract_fee_outputs;\n+    coin_params.m_long_term_feerate = long_term_fee_rate;\n+    coin_params.m_effective_feerate = effective_fee_rate;\n+\n+    // Create some coins\n+    CAmount total_balance{0};\n+    int nextLockTime{0};\n+    LIMITED_WHILE(fuzzed_data_provider.ConsumeBool(), 10000)\n+    {\n+        const int nInput{fuzzed_data_provider.ConsumeIntegralInRange<int>(0, 10)};\n+        const int nInputBytes{fuzzed_data_provider.ConsumeIntegralInRange<int>(100, 10000)};\n+        const CAmount amount{fuzzed_data_provider.ConsumeIntegralInRange<CAmount>(1, MAX_MONEY)};\n+        AddCoin(utxo_pool, amount, nInput, nInputBytes, ++nextLockTime);\n+        total_balance += amount;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832690219",
      "id" : 832690219,
      "in_reply_to_id" : 832347740,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xodgr",
      "original_commit_id" : "e21d0b9df86d9878e9a4e9380c3ebbfa6932ba5e",
      "original_line" : 76,
      "original_position" : 72,
      "original_start_line" : 65,
      "path" : "src/wallet/test/fuzz/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 917975282,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832690219/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-22T22:48:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832690219",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832690431"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832690431"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed it.",
      "commit_id" : "38915d999b56c269b357690485d8869f99ab73b0",
      "created_at" : "2022-03-22T22:49:18Z",
      "diff_hunk" : "@@ -0,0 +1,95 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/feerate.h>\n+#include <primitives/transaction.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/coinselection.h>\n+\n+#include <vector>\n+\n+namespace wallet {\n+\n+static void AddCoin(std::vector<CInputCoin>& input_coins, const CAmount& nValue, const int nInput, const int nInputBytes, const int lockTime)\n+{\n+    CMutableTransaction tx;\n+    tx.vout.resize(nInput + 1);\n+    tx.vout[nInput].nValue = nValue;\n+    tx.nLockTime = lockTime; // all transactions get different hashes\n+    CInputCoin coin(MakeTransactionRef(tx), nInput);\n+    coin.m_input_bytes = nInputBytes;\n+    input_coins.push_back(coin);\n+}\n+\n+// Randomly distribute coins to OutputGroups\n+static void GroupCoins(FuzzedDataProvider& fuzzed_data_provider, std::vector<OutputGroup>& output_groups, const std::vector<CInputCoin>& coins, const CoinSelectionParams& coin_params, const bool positive_only)\n+{\n+    auto output_group = OutputGroup(coin_params);\n+    bool valid_outputgroup{false};\n+    for (auto& coin : coins) {\n+        output_group.Insert(coin, /*depth=*/0, /*from_me=*/true, /*ancestors=*/0, /*descendants=*/0, positive_only);\n+        valid_outputgroup = !positive_only || output_group.GetSelectionAmount() > 0;\n+        if (valid_outputgroup && fuzzed_data_provider.ConsumeBool()) {\n+            output_groups.push_back(output_group);\n+            output_group = OutputGroup(coin_params);\n+            valid_outputgroup = false;\n+        }\n+    }\n+    if (valid_outputgroup) output_groups.push_back(output_group);\n+    return;\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24602#discussion_r832690431",
      "id" : 832690431,
      "in_reply_to_id" : 832413904,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xodj_",
      "original_commit_id" : "e21d0b9df86d9878e9a4e9380c3ebbfa6932ba5e",
      "original_line" : 45,
      "original_position" : 44,
      "original_start_line" : 43,
      "path" : "src/wallet/test/fuzz/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 917975537,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24602",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832690431/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-22T22:49:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/832690431",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the review! I addressed the comments by @vasild and rebased on master.",
      "created_at" : "2022-03-22T22:50:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24602#issuecomment-1075727665",
      "id" : 1075727665,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24602",
      "node_id" : "IC_kwDOABII585AHk0x",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1075727665/reactions"
      },
      "updated_at" : "2022-03-22T22:50:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1075727665",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   }
]
