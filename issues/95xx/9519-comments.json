[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9519#discussion_r95671740"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9519"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95671740"
         }
      },
      "body" : "nit: you may as well make this `const bool fReplacementTransaction = setConflicts.size()` under the lock & make the if below check fReplacementTransaction. ",
      "commit_id" : "20418bdf7976b8ff807dc6ed9f2a8e6b7f068ec3",
      "created_at" : "2017-01-11T21:05:46Z",
      "diff_hunk" : "@@ -788,13 +788,15 @@ bool AcceptToMemoryPoolWorker(CTxMemPool& pool, CValidationState& state, const C\n         size_t nConflictingSize = 0;\n         uint64_t nConflictingCount = 0;\n         CTxMemPool::setEntries allConflicting;\n+        bool fReplacementTransaction = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9519#discussion_r95671740",
      "id" : 95671740,
      "original_commit_id" : "20418bdf7976b8ff807dc6ed9f2a8e6b7f068ec3",
      "original_position" : 4,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 16235465,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9519",
      "updated_at" : "2017-01-11T21:05:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95671740",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9519#discussion_r95671785"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9519"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95671785"
         }
      },
      "body" : "nit: `!fReplacementTransaction` is a lot cheaper of a check than the others, so may as well make it the first one in the group of `&`s. I don't think the optimizer would do that automatically?",
      "commit_id" : "20418bdf7976b8ff807dc6ed9f2a8e6b7f068ec3",
      "created_at" : "2017-01-11T21:06:00Z",
      "diff_hunk" : "@@ -955,9 +957,10 @@ bool AcceptToMemoryPoolWorker(CTxMemPool& pool, CValidationState& state, const C\n         pool.RemoveStaged(allConflicting, false);\n \n         // This transaction should only count for fee estimation if\n-        // the node is not behind and it is not dependent on any other\n-        // transactions in the mempool\n-        bool validForFeeEstimation = IsCurrentForFeeEstimation() && pool.HasNoInputsOf(tx);\n+        // the node is not behind, it is not dependent on any other\n+        // transactions in the mempool, and it isn't a BIP 125\n+        // replacement transaction (may not be widely supported).\n+        bool validForFeeEstimation = IsCurrentForFeeEstimation() && pool.HasNoInputsOf(tx) && !fReplacementTransaction;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9519#discussion_r95671785",
      "id" : 95671785,
      "original_commit_id" : "20418bdf7976b8ff807dc6ed9f2a8e6b7f068ec3",
      "original_position" : 26,
      "path" : "src/validation.cpp",
      "position" : 26,
      "pull_request_review_id" : 16235511,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9519",
      "updated_at" : "2017-01-11T21:12:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95671785",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "body" : "Too much special-casing here... Estimates shouldn't break when 100% of the network adopts RBF support. But even more importantly, estimates shouldn't break when miners use unknown policies. There needs to be some tolerance of transactions being left unmined for reasons beyond the estimator's awareness.",
      "created_at" : "2017-01-11T21:46:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9519#issuecomment-272005116",
      "id" : 272005116,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9519",
      "updated_at" : "2017-01-11T21:46:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/272005116",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "@JeremyRubin \r\n- re: nits, seems kind of unnecessary optimization if you ask me..  \r\n- re: concern, I won't go so far as to say that's not a concern at all, but the debug information for fee estimates already lets you know how many of the transactions in blocks you're tracking.  So if that number drops significantly it'll be worth revisiting.  Beyond that, it shouldn't matter if a bunch of high fee txs aren't tracked as long as enough still are to give you the data you need.\r\n\r\n@luke-jr sigh...  sure, estimates should be magical and give you perfect answers.  But whether this is the optimal algorithm is not the question here.  The question is whether this is a reasonable improvement and I believe it is.",
      "created_at" : "2017-01-11T22:39:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9519#issuecomment-272018453",
      "id" : 272018453,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9519",
      "updated_at" : "2017-01-11T22:39:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/272018453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "utACK",
      "created_at" : "2017-01-12T21:46:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9519#issuecomment-272293811",
      "id" : 272293811,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9519",
      "updated_at" : "2017-01-12T21:46:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/272293811",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : ">  it's probably better not to \r\n\r\nWhy not consider them?",
      "created_at" : "2017-01-13T04:28:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9519#issuecomment-272358364",
      "id" : 272358364,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9519",
      "updated_at" : "2017-01-13T04:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/272358364",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "@dcousens The issue is that if some significant fraction of miners don't accept RBF replacements but your node does, then you would expect them to get mined quickly based on their fee rate but in reality it will take longer.   In the worst case situation this can lead fee estimation to think that all transactions of that fee rate would take longer to be confirmed.  \r\n\r\n If you know that some miners are not considering a certain subset of transactions for block inclusion, its better to eliminate those as potential data points for fee estimation.  There are two opposing arguments to this:\r\n1. You've eliminated so many transactions that you don't have a big enough sample of data points. (Not a concern here)\r\n2. What if the particular transaction you are placing is of the type that is chosen to be excluded for fee estimation because its disadvantaged.  This is a reason to not overly narrow the policy profile required for fee estimation.  But in the case of replacement transactions, I think its relatively well known that not all miners might accept your replacement, and in the case they don't, the alternative is your original transaction is still mined, so its probably ok if fee estimates are maybe not perfectly tailored to your particular transaction.",
      "created_at" : "2017-01-13T14:04:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9519#issuecomment-272449918",
      "id" : 272449918,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9519",
      "updated_at" : "2017-01-13T14:04:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/272449918",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   }
]
