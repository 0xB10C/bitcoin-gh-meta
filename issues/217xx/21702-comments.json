[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19438 (Introduce deploymentstatus by ajtowns)\n* #13533 ([tests] Reduced number of validations in tx_validationcache_tests by lucash-dev)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-04-15T19:24:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21702#issuecomment-820676054",
      "id" : 820676054,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21702",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMDY3NjA1NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-19T04:02:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/820676054",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "concept ACK.",
      "created_at" : "2021-04-19T15:54:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21702#issuecomment-822579606",
      "id" : 822579606,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21702",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMjU3OTYwNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-19T15:54:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/822579606",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13668451?v=4",
         "events_url" : "https://api.github.com/users/rn-g/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rn-g/followers",
         "following_url" : "https://api.github.com/users/rn-g/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rn-g/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rn-g",
         "id" : 13668451,
         "login" : "rn-g",
         "node_id" : "MDQ6VXNlcjEzNjY4NDUx",
         "organizations_url" : "https://api.github.com/users/rn-g/orgs",
         "received_events_url" : "https://api.github.com/users/rn-g/received_events",
         "repos_url" : "https://api.github.com/users/rn-g/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rn-g/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rn-g/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rn-g"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21702#discussion_r616625177"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21702"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616625177"
         }
      },
      "author_association" : "NONE",
      "body" : "As the TODO says, should be improved",
      "commit_id" : "3b07e2ff83e40692f10aa59a02b2f07e3e154cd2",
      "created_at" : "2021-04-20T12:15:07Z",
      "diff_hunk" : "@@ -1433,6 +1513,9 @@ void PrecomputedTransactionData::Init(const T& txTo, std::vector<CTxOut>&& spent\n     // Determine which precomputation-impacting features this transaction uses.\n     bool uses_bip143_segwit = false;\n     bool uses_bip341_taproot = false;\n+    // TODO: Improve this heuristic\n+    bool uses_bip119_ctv = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21702#discussion_r616625177",
      "id" : 616625177,
      "line" : 1517,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjYyNTE3Nw==",
      "original_commit_id" : "3b07e2ff83e40692f10aa59a02b2f07e3e154cd2",
      "original_line" : 1517,
      "original_position" : 111,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : 111,
      "pull_request_review_id" : 639871313,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21702",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T12:15:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616625177",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/9665963?v=4",
         "events_url" : "https://api.github.com/users/pyskell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pyskell/followers",
         "following_url" : "https://api.github.com/users/pyskell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pyskell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pyskell",
         "id" : 9665963,
         "login" : "pyskell",
         "node_id" : "MDQ6VXNlcjk2NjU5NjM=",
         "organizations_url" : "https://api.github.com/users/pyskell/orgs",
         "received_events_url" : "https://api.github.com/users/pyskell/received_events",
         "repos_url" : "https://api.github.com/users/pyskell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pyskell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pyskell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pyskell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21702#discussion_r616625350"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21702"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616625350"
         }
      },
      "author_association" : "NONE",
      "body" : "Can this assert just be moved to the start of the function?",
      "commit_id" : "3b07e2ff83e40692f10aa59a02b2f07e3e154cd2",
      "created_at" : "2021-04-20T12:15:19Z",
      "diff_hunk" : "@@ -1804,6 +1905,30 @@ bool GenericTransactionSignatureChecker<T>::CheckSequence(const CScriptNum& nSeq\n     return true;\n }\n \n+template <class T>\n+bool GenericTransactionSignatureChecker<T>::CheckStandardTemplateHash(const std::vector<unsigned char>& hash) const\n+{\n+    // Should already be checked before calling...\n+    assert(hash.size() == 32);\n+    if (txdata && txdata->m_bip119_ctv_ready) {\n+        // if nIn == 0, then we've already cached this and can directly check\n+        if (nIn == 0) {\n+            return std::equal(txdata->m_standard_template_single_hash.begin(), txdata->m_standard_template_single_hash.end(), hash.data());\n+        } else {\n+            // otherwise we still have *most* of the hash cached,\n+            // so just re-compute the correct one and compare\n+            assert(txTo != nullptr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21702#discussion_r616625350",
      "id" : 616625350,
      "line" : 1920,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjYyNTM1MA==",
      "original_commit_id" : "3b07e2ff83e40692f10aa59a02b2f07e3e154cd2",
      "original_line" : 1920,
      "original_position" : 179,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : 179,
      "pull_request_review_id" : 639871498,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21702",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T12:15:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616625350",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/9665963?v=4",
         "events_url" : "https://api.github.com/users/pyskell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pyskell/followers",
         "following_url" : "https://api.github.com/users/pyskell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pyskell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pyskell",
         "id" : 9665963,
         "login" : "pyskell",
         "node_id" : "MDQ6VXNlcjk2NjU5NjM=",
         "organizations_url" : "https://api.github.com/users/pyskell/orgs",
         "received_events_url" : "https://api.github.com/users/pyskell/received_events",
         "repos_url" : "https://api.github.com/users/pyskell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pyskell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pyskell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pyskell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21702#discussion_r616627150"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21702"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616627150"
         }
      },
      "author_association" : "NONE",
      "body" : "Minor bike shedding but \"Basic Standard\" and \"Standard Template\" are somewhat confusing terms. Are there non-standard templates?",
      "commit_id" : "3b07e2ff83e40692f10aa59a02b2f07e3e154cd2",
      "created_at" : "2021-04-20T12:17:36Z",
      "diff_hunk" : "@@ -198,6 +198,13 @@ unsigned int CScript::GetSigOpCount(const CScript& scriptSig) const\n     return subscript.GetSigOpCount(true);\n }\n \n+bool CScript::IsPayToBasicStandardTemplate() const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21702#discussion_r616627150",
      "id" : 616627150,
      "line" : 201,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjYyNzE1MA==",
      "original_commit_id" : "3b07e2ff83e40692f10aa59a02b2f07e3e154cd2",
      "original_line" : 201,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : 4,
      "pull_request_review_id" : 639873700,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21702",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T12:17:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616627150",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/9665963?v=4",
         "events_url" : "https://api.github.com/users/pyskell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pyskell/followers",
         "following_url" : "https://api.github.com/users/pyskell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pyskell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pyskell",
         "id" : 9665963,
         "login" : "pyskell",
         "node_id" : "MDQ6VXNlcjk2NjU5NjM=",
         "organizations_url" : "https://api.github.com/users/pyskell/orgs",
         "received_events_url" : "https://api.github.com/users/pyskell/received_events",
         "repos_url" : "https://api.github.com/users/pyskell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pyskell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pyskell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pyskell"
      }
   }
]
