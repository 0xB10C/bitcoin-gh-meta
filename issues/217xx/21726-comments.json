[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21767 ([Bundle 6/n] Prune g_chainman usage in auxiliary modules by dongcarl)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-04-19T03:52:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#issuecomment-822147133",
      "id" : 822147133,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21726",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMjE0NzEzMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-20T04:57:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/822147133",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r615556639"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615556639"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This function doesn't use any member of BlockManager, so could be stand-alone? Also, I think you can avoid this check by having the caller pass a `const CBlockIndex& start_block`.",
      "commit_id" : "23fb6feec6c070943e4a6ee94055c9d47b6c8a90",
      "created_at" : "2021-04-19T05:49:00Z",
      "diff_hunk" : "@@ -1335,6 +1334,14 @@ int BlockManager::GetSpendHeight(const CCoinsViewCache& inputs)\n     return pindexPrev->nHeight + 1;\n }\n \n+const CBlockIndex* BlockManager::GetLastPruneBlock(const CBlockIndex* start_block) {\n+    const CBlockIndex* block = start_block;\n+    CHECK_NONFATAL(block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r615556639",
      "id" : 615556639,
      "line" : 1339,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTU1NjYzOQ==",
      "original_commit_id" : "23fb6feec6c070943e4a6ee94055c9d47b6c8a90",
      "original_line" : 1339,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 14,
      "pull_request_review_id" : 638479069,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-19T05:49:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615556639",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r632032296"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632032296"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks! I made the changes as suggested.",
      "commit_id" : "7cb32c39c01c95ae7dce65881707db190fe74aa4",
      "created_at" : "2021-05-13T18:55:13Z",
      "diff_hunk" : "@@ -1335,6 +1334,14 @@ int BlockManager::GetSpendHeight(const CCoinsViewCache& inputs)\n     return pindexPrev->nHeight + 1;\n }\n \n+const CBlockIndex* BlockManager::GetLastPruneBlock(const CBlockIndex* start_block) {\n+    const CBlockIndex* block = start_block;\n+    CHECK_NONFATAL(block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r632032296",
      "id" : 632032296,
      "in_reply_to_id" : 615556639,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjAzMjI5Ng==",
      "original_commit_id" : "23fb6feec6c070943e4a6ee94055c9d47b6c8a90",
      "original_line" : 1339,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 659205588,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-13T18:55:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632032296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, I think this is an elegant approach.",
      "created_at" : "2021-05-17T18:27:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#issuecomment-842538559",
      "id" : 842538559,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21726",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0MjUzODU1OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-17T18:27:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/842538559",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638228451"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638228451"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 5d23ddf5ff3bd1e5d4f6b85440d9ad0c59bb9994 \"Add prune blockers to BlockManager\"\r\n\r\nSince this has `EXCLUSIVE_LOCKS_REQUIRED`, I think it should also have `AssertLockHeld` in here too.",
      "commit_id" : "11f01efadf8e93f042ebd05d12f1f3bc5bce8178",
      "created_at" : "2021-05-24T19:42:35Z",
      "diff_hunk" : "@@ -3663,6 +3673,10 @@ void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPr\n            nLastBlockWeCanPrune, count);\n }\n \n+void BlockManager::UpdatePruneBlocker(std::string name, const CBlockIndex* block) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638228451",
      "id" : 638228451,
      "line" : 3672,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzODIyODQ1MQ==",
      "original_commit_id" : "5d23ddf5ff3bd1e5d4f6b85440d9ad0c59bb9994",
      "original_line" : 3676,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 32,
      "pull_request_review_id" : 667113687,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-24T19:50:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638228451",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638325082"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638325082"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right, fixed!",
      "commit_id" : "b5862425806c29fc9628f5c82181658dcea722b3",
      "created_at" : "2021-05-24T22:13:42Z",
      "diff_hunk" : "@@ -3663,6 +3673,10 @@ void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPr\n            nLastBlockWeCanPrune, count);\n }\n \n+void BlockManager::UpdatePruneBlocker(std::string name, const CBlockIndex* block) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638325082",
      "id" : 638325082,
      "in_reply_to_id" : 638228451,
      "line" : 3672,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzODMyNTA4Mg==",
      "original_commit_id" : "5d23ddf5ff3bd1e5d4f6b85440d9ad0c59bb9994",
      "original_line" : 3672,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 32,
      "pull_request_review_id" : 667236323,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-24T22:13:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638325082",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638347138"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638347138"
         }
      },
      "author_association" : "MEMBER",
      "body" : "bfe9719e29d7947e2ffa9b510cd078e8a09b5d03\r\n\r\nnit, `GetLastPrunedBlock`?",
      "commit_id" : "b5862425806c29fc9628f5c82181658dcea722b3",
      "created_at" : "2021-05-24T23:11:22Z",
      "diff_hunk" : "@@ -51,6 +51,14 @@ bool IsBlockPruned(const CBlockIndex* pblockindex)\n     return (fHavePruned && !(pblockindex->nStatus & BLOCK_HAVE_DATA) && pblockindex->nTx > 0);\n }\n \n+const CBlockIndex* GetLastPruneBlock(const CBlockIndex& start_block) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638347138",
      "id" : 638347138,
      "line" : 54,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzODM0NzEzOA==",
      "original_commit_id" : "bfe9719e29d7947e2ffa9b510cd078e8a09b5d03",
      "original_line" : 54,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/node/blockstorage.cpp",
      "position" : 4,
      "pull_request_review_id" : 667264075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-24T23:22:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638347138",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638347828"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638347828"
         }
      },
      "author_association" : "MEMBER",
      "body" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c\r\n\r\nnit, `const std::string&`.",
      "commit_id" : "b5862425806c29fc9628f5c82181658dcea722b3",
      "created_at" : "2021-05-24T23:13:19Z",
      "diff_hunk" : "@@ -450,6 +450,10 @@ class BlockManager\n      */\n     int GetSpendHeight(const CCoinsViewCache& inputs) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    std::unordered_map<std::string, const CBlockIndex*> m_prune_blockers;\n+\n+    void UpdatePruneBlocker(std::string name, const CBlockIndex* block) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638347828",
      "id" : 638347828,
      "line" : 455,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzODM0NzgyOA==",
      "original_commit_id" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c",
      "original_line" : 455,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 6,
      "pull_request_review_id" : 667264075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-24T23:22:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638347828",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638348578"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638348578"
         }
      },
      "author_association" : "MEMBER",
      "body" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c\r\n\r\nHow can it be `nullptr`?",
      "commit_id" : "b5862425806c29fc9628f5c82181658dcea722b3",
      "created_at" : "2021-05-24T23:15:37Z",
      "diff_hunk" : "@@ -2041,6 +2041,16 @@ bool CChainState::FlushStateToDisk(\n                last_prune = std::max(1, std::min(last_prune, index.GetSummary().best_block_height));\n             });\n \n+            for (auto const& blocker : m_blockman.m_prune_blockers) {\n+                if (blocker.second) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638348578",
      "id" : 638348578,
      "line" : 2041,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzODM0ODU3OA==",
      "original_commit_id" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c",
      "original_line" : 2045,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 17,
      "pull_request_review_id" : 667264075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-24T23:22:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638348578",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638348949"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638348949"
         }
      },
      "author_association" : "MEMBER",
      "body" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c\r\n\r\nShould check/assert it only goes forward when updating?",
      "commit_id" : "b5862425806c29fc9628f5c82181658dcea722b3",
      "created_at" : "2021-05-24T23:16:45Z",
      "diff_hunk" : "@@ -3663,6 +3673,11 @@ void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPr\n            nLastBlockWeCanPrune, count);\n }\n \n+void BlockManager::UpdatePruneBlocker(std::string name, const CBlockIndex* block) {\n+    AssertLockHeld(::cs_main);\n+    m_prune_blockers[name] = block;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638348949",
      "id" : 638348949,
      "line" : 3674,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzODM0ODk0OQ==",
      "original_commit_id" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c",
      "original_line" : 3678,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 34,
      "pull_request_review_id" : 667264075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-24T23:22:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638348949",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638349497"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638349497"
         }
      },
      "author_association" : "MEMBER",
      "body" : "d18677006d3d48ca7654039ea6e267164a2690e0\r\n\r\nnit, use ternary? `block ? block : ::ChainActive().Genesis()`",
      "commit_id" : "b5862425806c29fc9628f5c82181658dcea722b3",
      "created_at" : "2021-05-24T23:18:33Z",
      "diff_hunk" : "@@ -364,3 +364,15 @@ IndexSummary BaseIndex::GetSummary() const\n     summary.best_block_height = m_best_block_index ? m_best_block_index.load()->nHeight : 0;\n     return summary;\n }\n+\n+void BaseIndex::SetBestBlockIndex(const CBlockIndex* block) {\n+    m_best_block_index = block;\n+    if (AllowPrune()) {\n+        LOCK(::cs_main);\n+        if (!block) {\n+            g_chainman.m_blockman.UpdatePruneBlocker(GetName(), ::ChainActive().Genesis());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r638349497",
      "id" : 638349497,
      "line" : 373,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzODM0OTQ5Nw==",
      "original_commit_id" : "d18677006d3d48ca7654039ea6e267164a2690e0",
      "original_line" : 373,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : 95,
      "pull_request_review_id" : 667264075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-24T23:22:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/638349497",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188761"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188761"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I am not sure. The way I use it right now it can also go down with reorgs. I am undecided what the right course is. Only going up avoids a potential footgun, with going down it could react to (highly unlikely) deep reorg. If I add this I think I would do it so that setting a lower number is simply a no op:\r\n\r\n```\r\nif (m_prune_blockers[name] < block) m_prune_blockers[name] = block;\r\n```",
      "commit_id" : "50cd98519097e11936e0efbd0bfa3b33d0317423",
      "created_at" : "2021-05-26T23:36:05Z",
      "diff_hunk" : "@@ -3663,6 +3673,11 @@ void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPr\n            nLastBlockWeCanPrune, count);\n }\n \n+void BlockManager::UpdatePruneBlocker(std::string name, const CBlockIndex* block) {\n+    AssertLockHeld(::cs_main);\n+    m_prune_blockers[name] = block;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188761",
      "id" : 640188761,
      "in_reply_to_id" : 638348949,
      "line" : 3672,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDE4ODc2MQ==",
      "original_commit_id" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c",
      "original_line" : 3672,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 36,
      "pull_request_review_id" : 669625747,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-26T23:36:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188761",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188783"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188783"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "50cd98519097e11936e0efbd0bfa3b33d0317423",
      "created_at" : "2021-05-26T23:36:10Z",
      "diff_hunk" : "@@ -364,3 +364,15 @@ IndexSummary BaseIndex::GetSummary() const\n     summary.best_block_height = m_best_block_index ? m_best_block_index.load()->nHeight : 0;\n     return summary;\n }\n+\n+void BaseIndex::SetBestBlockIndex(const CBlockIndex* block) {\n+    m_best_block_index = block;\n+    if (AllowPrune()) {\n+        LOCK(::cs_main);\n+        if (!block) {\n+            g_chainman.m_blockman.UpdatePruneBlocker(GetName(), ::ChainActive().Genesis());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188783",
      "id" : 640188783,
      "in_reply_to_id" : 638349497,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDE4ODc4Mw==",
      "original_commit_id" : "d18677006d3d48ca7654039ea6e267164a2690e0",
      "original_line" : 373,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : null,
      "pull_request_review_id" : 669625774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-26T23:36:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188783",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188853"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188853"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I guess it should never be `nullptr`. Dropped that if statement.",
      "commit_id" : "50cd98519097e11936e0efbd0bfa3b33d0317423",
      "created_at" : "2021-05-26T23:36:20Z",
      "diff_hunk" : "@@ -2041,6 +2041,16 @@ bool CChainState::FlushStateToDisk(\n                last_prune = std::max(1, std::min(last_prune, index.GetSummary().best_block_height));\n             });\n \n+            for (auto const& blocker : m_blockman.m_prune_blockers) {\n+                if (blocker.second) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188853",
      "id" : 640188853,
      "in_reply_to_id" : 638348578,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDE4ODg1Mw==",
      "original_commit_id" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c",
      "original_line" : 2045,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 669625858,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-26T23:36:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188853",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188945"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188945"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "50cd98519097e11936e0efbd0bfa3b33d0317423",
      "created_at" : "2021-05-26T23:36:37Z",
      "diff_hunk" : "@@ -450,6 +450,10 @@ class BlockManager\n      */\n     int GetSpendHeight(const CCoinsViewCache& inputs) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    std::unordered_map<std::string, const CBlockIndex*> m_prune_blockers;\n+\n+    void UpdatePruneBlocker(std::string name, const CBlockIndex* block) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188945",
      "id" : 640188945,
      "in_reply_to_id" : 638347828,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDE4ODk0NQ==",
      "original_commit_id" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c",
      "original_line" : 455,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 669625968,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-26T23:36:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188945",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188998"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188998"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "50cd98519097e11936e0efbd0bfa3b33d0317423",
      "created_at" : "2021-05-26T23:36:45Z",
      "diff_hunk" : "@@ -51,6 +51,14 @@ bool IsBlockPruned(const CBlockIndex* pblockindex)\n     return (fHavePruned && !(pblockindex->nStatus & BLOCK_HAVE_DATA) && pblockindex->nTx > 0);\n }\n \n+const CBlockIndex* GetLastPruneBlock(const CBlockIndex& start_block) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640188998",
      "id" : 640188998,
      "in_reply_to_id" : 638347138,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDE4ODk5OA==",
      "original_commit_id" : "bfe9719e29d7947e2ffa9b510cd078e8a09b5d03",
      "original_line" : 54,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/node/blockstorage.cpp",
      "position" : null,
      "pull_request_review_id" : 669626026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-26T23:36:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640188998",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed comments by @promag , thank you!\r\n\r\nI also fixed a comment I had overlooked and added a new commit at the end because I realized that we can skip the pruning stuff in `index/base` if the node is not actually pruning. With the new behavior especially this prevents locking `cs_main`. Happy to squash this but I am still checking that this is 100% safe and want to make sure it is looked at separately because it was not included in the existing concept acks.",
      "created_at" : "2021-05-26T23:41:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#issuecomment-849190916",
      "id" : 849190916,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21726",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0OTE5MDkxNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-26T23:41:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/849190916",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640190703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640190703"
         }
      },
      "author_association" : "MEMBER",
      "body" : "But what should happen if the block is already pruned?",
      "commit_id" : "50cd98519097e11936e0efbd0bfa3b33d0317423",
      "created_at" : "2021-05-26T23:41:48Z",
      "diff_hunk" : "@@ -3663,6 +3673,11 @@ void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPr\n            nLastBlockWeCanPrune, count);\n }\n \n+void BlockManager::UpdatePruneBlocker(std::string name, const CBlockIndex* block) {\n+    AssertLockHeld(::cs_main);\n+    m_prune_blockers[name] = block;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21726#discussion_r640190703",
      "id" : 640190703,
      "in_reply_to_id" : 638348949,
      "line" : 3672,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDE5MDcwMw==",
      "original_commit_id" : "b5a239390fd1b31c7e6107a2e6c35658a2b4697c",
      "original_line" : 3672,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 36,
      "pull_request_review_id" : 669627925,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21726",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-26T23:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640190703",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
