[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r119242422"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/119242422"
         }
      },
      "body" : "You should probably skip this loop for coinbase transactions, as those don't have meaningful input scripts.\r\n\r\nIs testing the inputs even useful, as the function of this test is to distinguish between transactions that may errorneously be decoded as 0-input transaction?\r\n\r\nNit: space after `for` (and elsewhere).",
      "commit_id" : "ac4e438229134595e949bfedb1f487c71fd45d24",
      "created_at" : "2017-05-30T23:46:43Z",
      "diff_hunk" : "@@ -88,18 +88,38 @@ CScript ParseScript(const std::string& s)\n     return result;\n }\n \n+// Check that all of the input and output scripts of a transaction contains valid opcodes\n+bool CheckTxScriptsSanity(CMutableTransaction& tx)\n+{\n+    // Check input scripts\n+    for(unsigned int i = 0; i < tx.vin.size(); i++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r119242422",
      "id" : 119242422,
      "original_commit_id" : "d1fb4337b57c9db47819feba020b04383e2c4385",
      "original_position" : 8,
      "path" : "src/core_read.cpp",
      "position" : null,
      "pull_request_review_id" : 41103675,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481",
      "updated_at" : "2017-06-07T21:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/119242422",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r119260852"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/119260852"
         }
      },
      "body" : "Mark the `tx` argument const?",
      "commit_id" : "ac4e438229134595e949bfedb1f487c71fd45d24",
      "created_at" : "2017-05-31T02:52:50Z",
      "diff_hunk" : "@@ -88,18 +88,40 @@ CScript ParseScript(const std::string& s)\n     return result;\n }\n \n+// Check that all of the input and output scripts of a transaction contains valid opcodes\n+bool CheckTxScriptsSanity(CMutableTransaction& tx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r119260852",
      "id" : 119260852,
      "original_commit_id" : "6909865869d9f2582e33e936e770538dfc541cf7",
      "original_position" : 5,
      "path" : "src/core_read.cpp",
      "position" : null,
      "pull_request_review_id" : 41122891,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481",
      "updated_at" : "2017-06-07T21:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/119260852",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "utACK 6909865869d9f2582e33e936e770538dfc541cf7",
      "created_at" : "2017-06-03T18:14:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10481#issuecomment-305992151",
      "id" : 305992151,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10481",
      "updated_at" : "2017-06-03T18:14:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/305992151",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Something else you could consider is checking whether the total script is not too large (MAX_SCRIPT_SIZE) or the stack elements aren't too large (MAX_SCRIPT_ELEMENT_SIZE).",
      "created_at" : "2017-06-04T23:55:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10481#issuecomment-306076013",
      "id" : 306076013,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10481",
      "updated_at" : "2017-06-04T23:55:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/306076013",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r120184103"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120184103"
         }
      },
      "body" : "done",
      "commit_id" : "ac4e438229134595e949bfedb1f487c71fd45d24",
      "created_at" : "2017-06-05T19:02:10Z",
      "diff_hunk" : "@@ -88,18 +88,40 @@ CScript ParseScript(const std::string& s)\n     return result;\n }\n \n+// Check that all of the input and output scripts of a transaction contains valid opcodes\n+bool CheckTxScriptsSanity(CMutableTransaction& tx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r120184103",
      "id" : 120184103,
      "original_commit_id" : "6909865869d9f2582e33e936e770538dfc541cf7",
      "original_position" : 5,
      "path" : "src/core_read.cpp",
      "position" : null,
      "pull_request_review_id" : 42126033,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481",
      "updated_at" : "2017-06-07T21:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120184103",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3782274?v=3",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "body" : "addressed @sipa's comments.",
      "created_at" : "2017-06-05T19:02:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10481#issuecomment-306274726",
      "id" : 306274726,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10481",
      "updated_at" : "2017-06-05T19:02:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/306274726",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3782274?v=3",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r120219601"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120219601"
         }
      },
      "body" : "I think this isn't actually correct. MAX_SCRIPT_ELEMENT_SIZE is the maximum length of the data, but its encoding as a CScript push may be up to 2 bytes more. Perhaps you can use GetOp2, which returns the data being pushed?",
      "commit_id" : "ac4e438229134595e949bfedb1f487c71fd45d24",
      "created_at" : "2017-06-05T21:54:18Z",
      "diff_hunk" : "@@ -267,3 +267,16 @@ std::string CScriptWitness::ToString() const\n     }\n     return ret + \")\";\n }\n+\n+bool CScript::HasValidOps() const\n+{\n+    CScript::const_iterator it = begin();\n+    while (it < end()) {\n+        opcodetype opcode;\n+        CScript::const_iterator prev_it = it;\n+        if (!GetOp(it, opcode) || opcode > 0xb9 || it - prev_it > MAX_SCRIPT_ELEMENT_SIZE) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r120219601",
      "id" : 120219601,
      "original_commit_id" : "e21a9f48fe5ce2b6dec49a3fd6240b52e620027a",
      "original_position" : 11,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 42164400,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481",
      "updated_at" : "2017-06-07T21:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120219601",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r120226426"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120226426"
         }
      },
      "body" : "done",
      "commit_id" : "ac4e438229134595e949bfedb1f487c71fd45d24",
      "created_at" : "2017-06-05T22:31:27Z",
      "diff_hunk" : "@@ -267,3 +267,16 @@ std::string CScriptWitness::ToString() const\n     }\n     return ret + \")\";\n }\n+\n+bool CScript::HasValidOps() const\n+{\n+    CScript::const_iterator it = begin();\n+    while (it < end()) {\n+        opcodetype opcode;\n+        CScript::const_iterator prev_it = it;\n+        if (!GetOp(it, opcode) || opcode > 0xb9 || it - prev_it > MAX_SCRIPT_ELEMENT_SIZE) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r120226426",
      "id" : 120226426,
      "original_commit_id" : "e21a9f48fe5ce2b6dec49a3fd6240b52e620027a",
      "original_position" : 11,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 42171507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481",
      "updated_at" : "2017-06-07T21:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120226426",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3782274?v=3",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r120227012"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120227012"
         }
      },
      "body" : "vout[i]",
      "commit_id" : "ac4e438229134595e949bfedb1f487c71fd45d24",
      "created_at" : "2017-06-05T22:35:22Z",
      "diff_hunk" : "@@ -88,18 +88,40 @@ CScript ParseScript(const std::string& s)\n     return result;\n }\n \n+// Check that all of the input and output scripts of a transaction contains valid opcodes\n+bool CheckTxScriptsSanity(const CMutableTransaction& tx)\n+{\n+    // Check input scripts for non-coinbase txs\n+    if (!CTransaction(tx).IsCoinBase()) {\n+        for (unsigned int i = 0; i < tx.vin.size(); i++) {\n+            if (!tx.vin[i].scriptSig.HasValidOps()) {\n+                return false;\n+            }\n+        }\n+    }\n+    // Check output scripts\n+    for (unsigned int i = 0; i < tx.vout.size(); i++) {\n+        if (!tx.vout[0].scriptPubKey.HasValidOps() || tx.vout[0].scriptPubKey.size() > MAX_SCRIPT_SIZE) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r120227012",
      "id" : 120227012,
      "original_commit_id" : "dc95ca642ef82d5c47604bf0b6faf3a5c44786f4",
      "original_position" : 17,
      "path" : "src/core_read.cpp",
      "position" : null,
      "pull_request_review_id" : 42172129,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481",
      "updated_at" : "2017-06-07T21:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120227012",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r120278241"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120278241"
         }
      },
      "body" : "No MAX_SCRIPT_SIZE test here?",
      "commit_id" : "ac4e438229134595e949bfedb1f487c71fd45d24",
      "created_at" : "2017-06-06T07:01:24Z",
      "diff_hunk" : "@@ -88,18 +88,40 @@ CScript ParseScript(const std::string& s)\n     return result;\n }\n \n+// Check that all of the input and output scripts of a transaction contains valid opcodes\n+bool CheckTxScriptsSanity(const CMutableTransaction& tx)\n+{\n+    // Check input scripts for non-coinbase txs\n+    if (!CTransaction(tx).IsCoinBase()) {\n+        for (unsigned int i = 0; i < tx.vin.size(); i++) {\n+            if (!tx.vin[i].scriptSig.HasValidOps()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r120278241",
      "id" : 120278241,
      "original_commit_id" : "a3c9b93b18102db6195558285f64dc6b7c33479d",
      "original_position" : 10,
      "path" : "src/core_read.cpp",
      "position" : null,
      "pull_request_review_id" : 42224921,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481",
      "updated_at" : "2017-06-07T21:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120278241",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r120430950"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120430950"
         }
      },
      "body" : "done",
      "commit_id" : "ac4e438229134595e949bfedb1f487c71fd45d24",
      "created_at" : "2017-06-06T17:47:28Z",
      "diff_hunk" : "@@ -88,18 +88,40 @@ CScript ParseScript(const std::string& s)\n     return result;\n }\n \n+// Check that all of the input and output scripts of a transaction contains valid opcodes\n+bool CheckTxScriptsSanity(const CMutableTransaction& tx)\n+{\n+    // Check input scripts for non-coinbase txs\n+    if (!CTransaction(tx).IsCoinBase()) {\n+        for (unsigned int i = 0; i < tx.vin.size(); i++) {\n+            if (!tx.vin[i].scriptSig.HasValidOps()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r120430950",
      "id" : 120430950,
      "original_commit_id" : "a3c9b93b18102db6195558285f64dc6b7c33479d",
      "original_position" : 10,
      "path" : "src/core_read.cpp",
      "position" : null,
      "pull_request_review_id" : 42393156,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481",
      "updated_at" : "2017-06-07T21:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120430950",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3782274?v=3",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "body" : "reutACK e76d516a19f09f546d6fb5f16f8b4c758c5287ed",
      "created_at" : "2017-06-06T21:41:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10481#issuecomment-306625939",
      "id" : 306625939,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10481",
      "updated_at" : "2017-06-06T21:41:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/306625939",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r120700111"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120700111"
         }
      },
      "body" : "Let's define a constant for 0xb9, this is kind of a magic number here. `OP_NOP10` would work, but maybe it's better to explicitly mark what the maximum valid opcode is.",
      "commit_id" : "ac4e438229134595e949bfedb1f487c71fd45d24",
      "created_at" : "2017-06-07T17:59:10Z",
      "diff_hunk" : "@@ -267,3 +267,16 @@ std::string CScriptWitness::ToString() const\n     }\n     return ret + \")\";\n }\n+\n+bool CScript::HasValidOps() const\n+{\n+    CScript::const_iterator it = begin();\n+    while (it < end()) {\n+        opcodetype opcode;\n+        std::vector<unsigned char> item;\n+        if (!GetOp(it, opcode, item) || opcode > 0xb9 || item.size() > MAX_SCRIPT_ELEMENT_SIZE) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r120700111",
      "id" : 120700111,
      "original_commit_id" : "e76d516a19f09f546d6fb5f16f8b4c758c5287ed",
      "original_position" : 11,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 42685322,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481",
      "updated_at" : "2017-06-07T21:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120700111",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r120745147"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120745147"
         }
      },
      "body" : "Done",
      "commit_id" : "ac4e438229134595e949bfedb1f487c71fd45d24",
      "created_at" : "2017-06-07T21:08:04Z",
      "diff_hunk" : "@@ -267,3 +267,16 @@ std::string CScriptWitness::ToString() const\n     }\n     return ret + \")\";\n }\n+\n+bool CScript::HasValidOps() const\n+{\n+    CScript::const_iterator it = begin();\n+    while (it < end()) {\n+        opcodetype opcode;\n+        std::vector<unsigned char> item;\n+        if (!GetOp(it, opcode, item) || opcode > 0xb9 || item.size() > MAX_SCRIPT_ELEMENT_SIZE) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10481#discussion_r120745147",
      "id" : 120745147,
      "original_commit_id" : "e76d516a19f09f546d6fb5f16f8b4c758c5287ed",
      "original_position" : 11,
      "path" : "src/script/script.cpp",
      "position" : null,
      "pull_request_review_id" : 42735094,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10481",
      "updated_at" : "2017-06-07T21:08:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120745147",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3782274?v=3",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "body" : "This sanity check doesn't work.  invalid opcodes are not illegal, and can even appear in real transactions.  For an example see transaction 95f7832b6449348bd1f3bc2e6eb110785248427bbe13853f2d61da9a6e810800 on testnet.",
      "created_at" : "2017-08-26T16:10:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10481#issuecomment-325142230",
      "id" : 325142230,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10481",
      "updated_at" : "2017-08-26T16:11:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/325142230",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/21371712?v=4",
         "events_url" : "https://api.github.com/users/roconnor-blockstream/events{/privacy}",
         "followers_url" : "https://api.github.com/users/roconnor-blockstream/followers",
         "following_url" : "https://api.github.com/users/roconnor-blockstream/following{/other_user}",
         "gists_url" : "https://api.github.com/users/roconnor-blockstream/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/roconnor-blockstream",
         "id" : 21371712,
         "login" : "roconnor-blockstream",
         "organizations_url" : "https://api.github.com/users/roconnor-blockstream/orgs",
         "received_events_url" : "https://api.github.com/users/roconnor-blockstream/received_events",
         "repos_url" : "https://api.github.com/users/roconnor-blockstream/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/roconnor-blockstream/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/roconnor-blockstream/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/roconnor-blockstream"
      }
   }
]
