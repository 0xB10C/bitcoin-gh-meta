[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [Sjors](https://github.com/bitcoin/bitcoin/pull/27054#issuecomment-1421249558) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27058](https://github.com/bitcoin/bitcoin/pull/27058) (contrib: Improve verify-commits.py to work with maintainers leaving by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-02-07T09:19:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27054#issuecomment-1420446583",
      "id" : 1420446583,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27054",
      "node_id" : "IC_kwDOABII585Uqkt3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1420446583/reactions"
      },
      "updated_at" : "2023-02-08T00:46:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1420446583",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> allow-revsig-commits list generated using:\r\n> \r\n> ```\r\n> git log --format=\"%H %ce\" --merges 577bd51a4b8de066466a445192c1c653872657e2..master | grep laanwj | cut -c -40 >> allow-revsig-commits\r\n> ```\r\n\r\nSeems to match with:\r\n\r\n```sh\r\ngit log --format=\"%H %GK\" --merges $(cat contrib/verify-commits/trusted-git-root)..master | grep -E \" 1E4AED62986CD25D\" | cut -c -40\r\n```\r\n\r\nif you prefer querying by key id, rather than committer email. Bit slower though (20s vs 0.2s). The key id matches the signing subkey:\r\n\r\n```sh\r\n$ gpg --list-key --with-colons 71A3B16735405025D447E8F274810B012346C9A6 |  cut -d: -f1,5,12 | grep 'sub:.*:s'\r\nsub:1E4AED62986CD25D:s\r\n```",
      "created_at" : "2023-02-07T10:53:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27054#issuecomment-1420575669",
      "id" : 1420575669,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27054",
      "node_id" : "IC_kwDOABII585UrEO1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1420575669/reactions"
      },
      "updated_at" : "2023-02-07T10:53:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1420575669",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't think adding your merged commits to allow-revsig-commits actually allows them. Once verify-commits gets to those commits, since they are signed with a key no longer in trusted-keys, it will fail. Currently the only solution is to update trusted-git-root, although I'm working on a longer term solution that lets us set a \"valid until\" for the trusted keys.",
      "created_at" : "2023-02-07T17:55:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27054#issuecomment-1421213371",
      "id" : 1421213371,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27054",
      "node_id" : "IC_kwDOABII585Utf67",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1421213371/reactions"
      },
      "updated_at" : "2023-02-07T17:55:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1421213371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "tACK aafa5e945cef7a4f65ddadcf548932dd4e27ada1 ð¢\r\n\r\n---\r\n\r\nThe behavior of `verify-commits` is quite confusing, because it is checking out different commits along the way. `allow-revsig-commits` is loaded in memory at the start so it stays the same throughout. But `trusted-keys` is loaded via the `gpg.sh`, and so it does change. \r\n\r\nThat makes sense because the list of trusted keys changes through time. But it means the newly added hash only have an effect if you call verify-commits with one of those hashes. In that case we check that commit against the current `trusted-keys`. If on the other hand you start traversing from HEAD~1, it uses the old `trusted-keys` and won't error.\r\n\r\nYou can see this difference in behavior by amending this commit to drop one of the hashes. The verify-commits script will fail if you pass it that hash, and succeed if you don't.\r\n\r\nIt would probably help if it cloned the repo in tmp rather than operate on itself.\r\n\r\nStill I think we can merge with these hashes added and improve the script later.\r\n\r\nI've checked the commit list in aafa5e945cef7a4f65ddadcf548932dd4e27ada1 against the list generated by @ajtowns's incantation. Also checked that this commit was signed by @laanwj.\r\n\r\nNote to other testers: the [verify-commits.py](https://github.com/bitcoin/bitcoin/blob/master/contrib/verify-commits/README.md) script can be a bit cryptic when a PGP key has expired. Use `git verify-commit` on the commit it trips over to see which key is expired and then refresh it (or just refresh all of them).",
      "created_at" : "2023-02-07T18:20:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27054#issuecomment-1421249558",
      "id" : 1421249558,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27054",
      "node_id" : "IC_kwDOABII585UtowW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1421249558/reactions"
      },
      "updated_at" : "2023-02-07T18:24:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1421249558",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> The behavior of `verify-commits` is quite confusing, because it is checking out different commits along the way. `allow-revsig-commits` is loaded in memory at the start so it stays the same throughout. But `trusted-keys` is loaded via the `gpg.sh`, and so it does change.\r\n\r\nIt should only be checking out commits in order to do the clean merge check. When it does that, it will always reset itself to the commit given, and thus `gpg.sh` will use the `trusted-keys` of that commit. If you disable  the clean merge check with `--clean-merge 0`, then it uses the trusted keys of the current tree and does not modify it at all.",
      "created_at" : "2023-02-07T18:26:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27054#issuecomment-1421256129",
      "id" : 1421256129,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27054",
      "node_id" : "IC_kwDOABII585UtqXB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1421256129/reactions"
      },
      "updated_at" : "2023-02-07T18:26:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1421256129",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> reset itself to the commit given\r\n\r\nUnfortunately that commit can't be (an amended) aafa5e945cef7a4f65ddadcf548932dd4e27ada1 because that would simply fail. So when testing this PR it reset to the commit before it (that I used as the argument), with the trusted-keys at that time. But trying with `--clean-merge 0` makes sense. And then indeed it seems to ignore the hashes in `allow-revsig-commits`.\r\n\r\nSo I guess the verification script only \"works\" if you enable the option(s) that cause it change commits, but either way `allow-revsig-commits` seems to be ignored.",
      "created_at" : "2023-02-07T18:36:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27054#issuecomment-1421267305",
      "id" : 1421267305,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27054",
      "node_id" : "IC_kwDOABII585UttFp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1421267305/reactions"
      },
      "updated_at" : "2023-02-07T18:46:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1421267305",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think you can just bump the root, like it was done before, see d4b3dc5b0a726cc4cc7a8467be43126e78f841cf",
      "created_at" : "2023-02-08T09:35:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27054#issuecomment-1422301674",
      "id" : 1422301674,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27054",
      "node_id" : "IC_kwDOABII585Uxpnq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1422301674/reactions"
      },
      "updated_at" : "2023-02-08T09:35:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1422301674",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "In any case, I think this can be merged as is, the intent should be clear here, and any bug fixes or behaviour changes of the script are better handled in a separate pull.",
      "created_at" : "2023-02-08T09:36:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27054#issuecomment-1422303300",
      "id" : 1422303300,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27054",
      "node_id" : "IC_kwDOABII585UxqBE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1422303300/reactions"
      },
      "updated_at" : "2023-02-08T09:36:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1422303300",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
