[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "These commands intentionally lock the wallet (and in the case of `getnewaddress` the script pubkey manager being called) in order that their results are guarenteed to be atomic and correct.\r\n\r\n`listunspent` must lock the wallet so that when it returns your list of unspent utxos these are certain to still be unspent by the time the function returns. In fact it will lock the wallet twice, [once while it fetches all available coins](https://github.com/bitcoin/bitcoin/blob/master/src/wallet/rpc/coins.cpp#L640-L641) as outputs, and again [as it parses each output](https://github.com/bitcoin/bitcoin/blob/master/src/wallet/rpc/coins.cpp#L644-L727) to provide context on it.\r\n\r\nMy understanding is that `getnewaddress` locks the wallet when generating new addresses to avoid e.g. a race between two calls to fetch a new address which could result in the same address being returned twice (or written to the db multiple times).\r\n\r\nI don't think performing either of these operations (nor `fundrawtransaction`) without blocking is avoidable. The remaining issue therefore is whether any of these operations can be sped up in bitcoin core descriptor wallets, to which I defer to others.\r\n\r\nAs an alternative, perhaps you could consider implementing some client side caching either on the `getnewaddress` or the `listunspent` calls to try and circumvent this?",
      "created_at" : "2023-01-31T00:30:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27002#issuecomment-1409570461",
      "id" : 1409570461,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27002",
      "node_id" : "IC_kwDOABII585UBFad",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1409570461/reactions"
      },
      "updated_at" : "2023-01-31T00:30:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1409570461",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@willcl-ark thanks for the quick reply.\r\n\r\nHowever, If I run `getnewaddress` in parallel (e.g. using parallel) it fetches 1000 unique addresses without any issues in less than 5 secs:\r\n\r\ne.g. little script like this\r\n```\r\n#!/bin/bash\r\nWALLET=test\r\nUSER=yyy\r\nPASS=xxx\r\nTHREADS=1000\r\n\r\nif [ -z \"$1\" ]; then\r\n echo \"Usage: `basename $0` [threads]\"\r\n exit 1\r\nfi\r\n\r\nTHREADS=$1\r\nulimit -n 65535\r\n\r\nseq $THREADS|parallel -j$THREADS -n0 \"curl -s --user $USER:$PASS --data-binary '{\\\"jsonrpc\\\": \\\"1.0\\\", \\\"id\\\":\\\"curltest\\\", \\\"method\\\": \\\"getnewaddress\\\", \\\"params\\\": [] }' -H 'content-type: text/plain;' http://127.0.0.1:18332/wallet/$WALLET\"\r\n```\r\nResults in: \r\n```\r\n$ time ./gen_addresses.sh 1000 >/dev/null\r\nreal\t0m4.495s\r\nuser\t0m4.745s\r\nsys\t0m8.019s\r\n```\r\nSo that makes me wonder why `getnewaddress` isn't blocking fetching another address in parallel, whilst `listunspent` blocks entirety of the wallet.\r\n\r\nHow do I implement client side caching of `getnewaddress` or `listunspent`, if `listunspent` still locks wallet for at least 1 minute? That means at least 1 minute bitcoin wallet won't be able to respond to any other calls.\r\n\r\nCurrently my app is very simple:\r\n* it fetches new address by using `getnewaddress`\r\n* and if the user requests withdrawal it collects UTXO and combines them into transaction\r\n\r\nSo my problem is with 2) as it locks the wallet and 1) stops working resulting in service unavailability.\r\n\r\nOf course the best is to generate addresses completely offline, but I've wanted (for now) to use bitcoin wallet's functionality for that.",
      "created_at" : "2023-01-31T07:49:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27002#issuecomment-1409910146",
      "id" : 1409910146,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27002",
      "node_id" : "IC_kwDOABII585UCYWC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1409910146/reactions"
      },
      "updated_at" : "2023-01-31T07:54:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1409910146",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/104405?v=4",
         "events_url" : "https://api.github.com/users/gituser/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gituser/followers",
         "following_url" : "https://api.github.com/users/gituser/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gituser/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gituser",
         "id" : 104405,
         "login" : "gituser",
         "node_id" : "MDQ6VXNlcjEwNDQwNQ==",
         "organizations_url" : "https://api.github.com/users/gituser/orgs",
         "received_events_url" : "https://api.github.com/users/gituser/received_events",
         "repos_url" : "https://api.github.com/users/gituser/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gituser/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gituser/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gituser"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think you'll easily hit the contention lock on `getnewaddress` as it returns so fast, i.e. it does not block for long enough on any call. For me the entire RPC call takes about 10 ms or less, with aonly a fraction of that locking the wallet lock.\r\n\r\nTo cache `getnewaddress` you could perhaps call it some number of times on startup so that you have a cache of unused addresses in your client app, and periodically after that (rather than on demand).\r\n\r\nAre you calling `listunspent` RPC each time user wants to make a withdrawal, and if so I am curious as to why? If user funds are pooled, then could you not let Bitcoin Core's coin selection algorithms handle constructing transactions of any amount for you using available UTXOs, as an alternative (without knowing any more about how you are using the output of `listunspent`)?",
      "created_at" : "2023-01-31T14:20:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27002#issuecomment-1410443297",
      "id" : 1410443297,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27002",
      "node_id" : "IC_kwDOABII585UEagh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1410443297/reactions"
      },
      "updated_at" : "2023-01-31T14:20:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1410443297",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Are you calling `listunspent` RPC each time user wants to make a withdrawal, and if so I am curious as to why? If user funds are pooled, then could you not let Bitcoin Core's coin selection algorithms handle constructing transactions of any amount for you using available UTXOs, as an alternative (without knowing any more about how you are using the output of `listunspent`)?\r\n\r\nYes I do call `listunspent` every time I want to:\r\n1) accumulate small (close to dust) payments (e.g. < 0.01 BTC) into 1 large transaction (via crontab every hour or so) to limit number of unspent payments\r\n2) for user withdrawals I collect requests and construct 1 large transaction (every 5 minutes) with multiple withdrawal outputs with `fundrawtransaction`\r\n\r\nIn both cases there will be a lock on my system, I can't cache `listunspent` or `fundrawtransaction` because the UTXO are changing all the time (new transactions are arriving).",
      "created_at" : "2023-01-31T16:39:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27002#issuecomment-1410711066",
      "id" : 1410711066,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27002",
      "node_id" : "IC_kwDOABII585UFb4a",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1410711066/reactions"
      },
      "updated_at" : "2023-01-31T16:40:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1410711066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/104405?v=4",
         "events_url" : "https://api.github.com/users/gituser/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gituser/followers",
         "following_url" : "https://api.github.com/users/gituser/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gituser/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gituser",
         "id" : 104405,
         "login" : "gituser",
         "node_id" : "MDQ6VXNlcjEwNDQwNQ==",
         "organizations_url" : "https://api.github.com/users/gituser/orgs",
         "received_events_url" : "https://api.github.com/users/gituser/received_events",
         "repos_url" : "https://api.github.com/users/gituser/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gituser/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gituser/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gituser"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I see. Well I don't think the wallet locks on these functions will be going anywhere, so I think best to consider how you can work around it...\r\n\r\nFor example, there are `query_options` in `listunspent` (see `bitcoin-cli help listunspent`):\r\n\r\n```\r\n5. query_options                             (json object, optional) JSON with query options\r\n     {\r\n       \"minimumAmount\": amount,              (numeric or string, optional, default=\"0.00\") Minimum value of each UTXO in BTC\r\n       \"maximumAmount\": amount,              (numeric or string, optional, default=unlimited) Maximum value of each UTXO in BTC\r\n       \"maximumCount\": n,                    (numeric, optional, default=unlimited) Maximum number of UTXOs\r\n       \"minimumSumAmount\": amount,           (numeric or string, optional, default=unlimited) Minimum sum value of all UTXOs in BTC\r\n       \"include_immature_coinbase\": bool,    (boolean, optional, default=false) Include immature coinbase UTXOs\r\n     }\r\n```\r\n\r\n...which might help reduce your query time if you only want to collect low-value UTXOs, by specifying max amount, count or maximum sumAmount for example?",
      "created_at" : "2023-01-31T16:49:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27002#issuecomment-1410730031",
      "id" : 1410730031,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27002",
      "node_id" : "IC_kwDOABII585UFggv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1410730031/reactions"
      },
      "updated_at" : "2023-01-31T16:49:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1410730031",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "`listunspent`, `fundrawtransaction`, and the `send*` RPCs all require figuring out the UTXOs that belong to the wallet. Currently, that means iterating through every single output of every transaction in the wallet, including received, sent, and unrelated, all while holding the wallet lock to ensure that atomicity of the operation. This can be very slow for large wallets (I think your wallets could be classified as such). We are working on improving the wallet so that it does not do this and is more performant, but it requires rewriting a large portion of the transaction handling code, so it's going pretty slowly. There unfortunately is not much that can be done about this other than using multiple smaller wallets rather than one very big one.",
      "created_at" : "2023-01-31T16:53:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27002#issuecomment-1410734920",
      "id" : 1410734920,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27002",
      "node_id" : "IC_kwDOABII585UFhtI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1410734920/reactions"
      },
      "updated_at" : "2023-01-31T16:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1410734920",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> I see. Well I don't think the wallet locks on these functions will be going anywhere, so I think best to consider how you can work around it...\r\n> \r\n> For example, there are `query_options` in `listunspent` (see `bitcoin-cli help listunspent`):\r\n> \r\n> ```\r\n> 5. query_options                             (json object, optional) JSON with query options\r\n>      {\r\n>        \"minimumAmount\": amount,              (numeric or string, optional, default=\"0.00\") Minimum value of each UTXO in BTC\r\n>        \"maximumAmount\": amount,              (numeric or string, optional, default=unlimited) Maximum value of each UTXO in BTC\r\n>        \"maximumCount\": n,                    (numeric, optional, default=unlimited) Maximum number of UTXOs\r\n>        \"minimumSumAmount\": amount,           (numeric or string, optional, default=unlimited) Minimum sum value of all UTXOs in BTC\r\n>        \"include_immature_coinbase\": bool,    (boolean, optional, default=false) Include immature coinbase UTXOs\r\n>      }\r\n> ```\r\n> \r\n> ...which might help reduce your query time if you only want to collect low-value UTXOs, by specifying max amount, count or maximum sumAmount for example?\r\n\r\nThanks for the tip, but I'm already using only confirmed UTXOs and also got a filter on `maximumAmount`, but it's still slow..\r\n\r\nI'm also thinking about creating a copy of the wallet (identical) where I will be running slow operations like `listunspent` or `fundrawtransaction`.",
      "created_at" : "2023-01-31T17:04:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27002#issuecomment-1410750324",
      "id" : 1410750324,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27002",
      "node_id" : "IC_kwDOABII585UFld0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1410750324/reactions"
      },
      "updated_at" : "2023-01-31T17:04:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1410750324",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/104405?v=4",
         "events_url" : "https://api.github.com/users/gituser/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gituser/followers",
         "following_url" : "https://api.github.com/users/gituser/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gituser/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gituser",
         "id" : 104405,
         "login" : "gituser",
         "node_id" : "MDQ6VXNlcjEwNDQwNQ==",
         "organizations_url" : "https://api.github.com/users/gituser/orgs",
         "received_events_url" : "https://api.github.com/users/gituser/received_events",
         "repos_url" : "https://api.github.com/users/gituser/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gituser/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gituser/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gituser"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "It seems to me slow `listunspent` is some kind of bitcoin's regression (might be?), as I have some test litecoin wallet (though it's bdb wallet v130000 not descriptors) with more than 19K unspent outputs and more than 80K transactions and `listunspent` works instantly in few ms.",
      "created_at" : "2023-01-31T21:10:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27002#issuecomment-1411075133",
      "id" : 1411075133,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27002",
      "node_id" : "IC_kwDOABII585UG0w9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1411075133/reactions"
      },
      "updated_at" : "2023-01-31T21:10:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1411075133",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/104405?v=4",
         "events_url" : "https://api.github.com/users/gituser/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gituser/followers",
         "following_url" : "https://api.github.com/users/gituser/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gituser/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gituser",
         "id" : 104405,
         "login" : "gituser",
         "node_id" : "MDQ6VXNlcjEwNDQwNQ==",
         "organizations_url" : "https://api.github.com/users/gituser/orgs",
         "received_events_url" : "https://api.github.com/users/gituser/received_events",
         "repos_url" : "https://api.github.com/users/gituser/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gituser/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gituser/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gituser"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If you're able to, could you try [profiling with perf](https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#performance-profiling-with-perf) to see where the time is being spent during `listunspent`?",
      "created_at" : "2023-01-31T21:54:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27002#issuecomment-1411119579",
      "id" : 1411119579,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27002",
      "node_id" : "IC_kwDOABII585UG_nb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1411119579/reactions"
      },
      "updated_at" : "2023-01-31T21:54:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1411119579",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@achow101 there you go https://pastebin.com/raw/fSzSr6NF",
      "created_at" : "2023-02-01T03:10:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27002#issuecomment-1411400147",
      "id" : 1411400147,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27002",
      "node_id" : "IC_kwDOABII585UIEHT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1411400147/reactions"
      },
      "updated_at" : "2023-02-01T03:11:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1411400147",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/104405?v=4",
         "events_url" : "https://api.github.com/users/gituser/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gituser/followers",
         "following_url" : "https://api.github.com/users/gituser/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gituser/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gituser",
         "id" : 104405,
         "login" : "gituser",
         "node_id" : "MDQ6VXNlcjEwNDQwNQ==",
         "organizations_url" : "https://api.github.com/users/gituser/orgs",
         "received_events_url" : "https://api.github.com/users/gituser/received_events",
         "repos_url" : "https://api.github.com/users/gituser/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gituser/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gituser/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gituser"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Hmm, it looks like it actually spends most of the time in `IsMine`, not in iterating the transactions. Around how many addresses does the wallet have?\r\n\r\nCould you try this [branch](https://github.com/achow101/bitcoin/tree/descspkm-hashmaps)? I've changed the map used in `IsMine` lookups to be an unordered map so it should be faster, but based on the profiling, I'm not sure if this is the main source of the slowdown.\r\n\r\nI'm working on generating a big wallet for testing, should be ready to reproduce this myself tomorrow.",
      "created_at" : "2023-02-01T04:00:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27002#issuecomment-1411428573",
      "id" : 1411428573,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27002",
      "node_id" : "IC_kwDOABII585UILDd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1411428573/reactions"
      },
      "updated_at" : "2023-02-01T04:00:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1411428573",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
