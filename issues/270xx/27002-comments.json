[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "These commands intentionally lock the wallet (and in the case of `getnewaddress` the script pubkey manager being called) in order that their results are guarenteed to be atomic and correct.\r\n\r\n`listunspent` must lock the wallet so that when it returns your list of unspent utxos these are certain to still be unspent by the time the function returns. In fact it will lock the wallet twice, [once while it fetches all available coins](https://github.com/bitcoin/bitcoin/blob/master/src/wallet/rpc/coins.cpp#L640-L641) as outputs, and again [as it parses each output](https://github.com/bitcoin/bitcoin/blob/master/src/wallet/rpc/coins.cpp#L644-L727) to provide context on it.\r\n\r\nMy understanding is that `getnewaddress` locks the wallet when generating new addresses to avoid e.g. a race between two calls to fetch a new address which could result in the same address being returned twice (or written to the db multiple times).\r\n\r\nI don't think performing either of these operations (nor `fundrawtransaction`) without blocking is avoidable. The remaining issue therefore is whether any of these operations can be sped up in bitcoin core descriptor wallets, to which I defer to others.\r\n\r\nAs an alternative, perhaps you could consider implementing some client side caching either on the `getnewaddress` or the `listunspent` calls to try and circumvent this?",
      "created_at" : "2023-01-31T00:30:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27002#issuecomment-1409570461",
      "id" : 1409570461,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27002",
      "node_id" : "IC_kwDOABII585UBFad",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1409570461/reactions"
      },
      "updated_at" : "2023-01-31T00:30:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1409570461",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   }
]
