[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Can you share the result for `bitcoin-cli -netinfo` and relevant options from bitcoin.conf ? Does this happen only with i2p peers?",
      "created_at" : "2021-07-26T22:07:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22559#issuecomment-887060058",
      "id" : 887060058,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22559",
      "node_id" : "IC_kwDOABII584033Za",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-26T22:07:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/887060058",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Can you share the result for `bitcoin-cli -netinfo` and relevant options from bitcoin.conf ? Does this happen only with i2p peers?\r\n\r\nSure! {moved extra info to original post about being an I2P-only node}\r\n\r\n`getnetworkinfo`:\r\n```\r\n{\r\n  \"version\": 229900,\r\n  \"subversion\": \"/Satoshi:22.99.0/\",\r\n  \"protocolversion\": 70016,\r\n  \"localservices\": \"0000000000000409\",\r\n  \"localservicesnames\": [\r\n    \"NETWORK\",\r\n    \"WITNESS\",\r\n    \"NETWORK_LIMITED\"\r\n  ],\r\n  \"localrelay\": true,\r\n  \"timeoffset\": -6,\r\n  \"networkactive\": true,\r\n  \"connections\": 10,\r\n  \"connections_in\": 4,\r\n  \"connections_out\": 6,\r\n  \"networks\": [\r\n    {\r\n      \"name\": \"ipv4\",\r\n      \"limited\": true,\r\n      \"reachable\": false,\r\n      \"proxy\": \"\",\r\n      \"proxy_randomize_credentials\": false\r\n    },\r\n    {\r\n      \"name\": \"ipv6\",\r\n      \"limited\": true,\r\n      \"reachable\": false,\r\n      \"proxy\": \"\",\r\n      \"proxy_randomize_credentials\": false\r\n    },\r\n    {\r\n      \"name\": \"onion\",\r\n      \"limited\": true,\r\n      \"reachable\": false,\r\n      \"proxy\": \"\",\r\n      \"proxy_randomize_credentials\": false\r\n    },\r\n    {\r\n      \"name\": \"i2p\",\r\n      \"limited\": false,\r\n      \"reachable\": true,\r\n      \"proxy\": \"127.0.0.1:7656\",\r\n      \"proxy_randomize_credentials\": false\r\n    }\r\n  ],\r\n  \"relayfee\": 0.00001000,\r\n  \"incrementalfee\": 0.00001000,\r\n  \"localaddresses\": [\r\n    {\r\n      \"address\": \"bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\",\r\n      \"port\": 0,\r\n      \"score\": 4\r\n    }\r\n  ],\r\n  \"warnings\": \"This is a pre-release test build - use at your own risk - do not use for mining or merchant applications\"\r\n}\r\n```\r\n\r\nbitcoin.conf:\r\n```\r\nlisten=1\r\nport=8333\r\nbind=127.0.0.1\r\nonlynet=i2p\r\ni2pacceptincoming=1\r\ni2psam=127.0.0.1:7656\r\n```\r\n\r\n",
      "created_at" : "2021-07-27T00:24:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22559#issuecomment-887117828",
      "id" : 887117828,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22559",
      "node_id" : "IC_kwDOABII58404FgE",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-27T00:43:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/887117828",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8435003?v=4",
         "events_url" : "https://api.github.com/users/tryphe/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tryphe/followers",
         "following_url" : "https://api.github.com/users/tryphe/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tryphe/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tryphe",
         "id" : 8435003,
         "login" : "tryphe",
         "node_id" : "MDQ6VXNlcjg0MzUwMDM=",
         "organizations_url" : "https://api.github.com/users/tryphe/orgs",
         "received_events_url" : "https://api.github.com/users/tryphe/received_events",
         "repos_url" : "https://api.github.com/users/tryphe/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tryphe/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tryphe/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tryphe"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for reporting and for testing an I2P service. Are you or the inbound peer running a version before https://github.com/bitcoin/bitcoin/pull/22112? I see you're setting port to 8333. (This might be a duplicate of https://github.com/bitcoin/bitcoin/issues/21389.)",
      "created_at" : "2021-07-27T03:46:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22559#issuecomment-887184901",
      "id" : 887184901,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22559",
      "node_id" : "IC_kwDOABII58404V4F",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-27T03:49:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/887184901",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Thanks for reporting. Are you or the inbound peer running a version before #22112? I see you're setting port to 8333. (This might be a duplicate of #21389.)\r\n\r\nNegative. The port=0 change was merged on 7/13, and the version was bumped to 0.22 on 7/20. I just happened to leave my config the same.",
      "created_at" : "2021-07-27T03:49:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22559#issuecomment-887185619",
      "id" : 887185619,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22559",
      "node_id" : "IC_kwDOABII58404WDT",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-27T03:49:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/887185619",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8435003?v=4",
         "events_url" : "https://api.github.com/users/tryphe/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tryphe/followers",
         "following_url" : "https://api.github.com/users/tryphe/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tryphe/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tryphe",
         "id" : 8435003,
         "login" : "tryphe",
         "node_id" : "MDQ6VXNlcjg0MzUwMDM=",
         "organizations_url" : "https://api.github.com/users/tryphe/orgs",
         "received_events_url" : "https://api.github.com/users/tryphe/received_events",
         "repos_url" : "https://api.github.com/users/tryphe/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tryphe/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tryphe/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tryphe"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "As per `getnetworkinfo`, my I2P port is forced to 0, so I don't think this something to do with the bug.",
      "created_at" : "2021-07-27T03:53:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22559#issuecomment-887186974",
      "id" : 887186974,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22559",
      "node_id" : "IC_kwDOABII58404WYe",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-27T03:53:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/887186974",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8435003?v=4",
         "events_url" : "https://api.github.com/users/tryphe/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tryphe/followers",
         "following_url" : "https://api.github.com/users/tryphe/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tryphe/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tryphe",
         "id" : 8435003,
         "login" : "tryphe",
         "node_id" : "MDQ6VXNlcjg0MzUwMDM=",
         "organizations_url" : "https://api.github.com/users/tryphe/orgs",
         "received_events_url" : "https://api.github.com/users/tryphe/received_events",
         "repos_url" : "https://api.github.com/users/tryphe/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tryphe/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tryphe/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tryphe"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I tried to replicate the bug by waiting for a peer to make an inbound connection. Afterwards, I call `addconnection abc.b32.i2p full-outbound-relay`. I commented out [these lines](https://github.com/ytytgo/lit/blob/7f37a1d560a86aa0a4397c3dcdaa974337594c00/src/rpc/net.cpp#L350-L352) to skip the regtest check. \r\n\r\nBut I can't reproduce the bug in the OP, the call fails via debug.log: `Failed to open new connection, already connected`\r\n\r\nI think one or two things are happening here:\r\n1. Some environmental variables are at play. I did not connect to the peer as quickly as when the bug was produced. Ping times on I2P are often 5 to 20 seconds. I'm not sure if this could cause the issue. I often see duplicate connections at the same time, however the latter connection almost always closes within a few seconds. Perhaps the bug happens if we connect simultaneously?\r\n2. Maybe the call stack during my test is not the same as during real time. There are many places in which we call `FindNode` in various fashions and does not fail or succeed verbosely, which may lead to an edge case somewhere?\r\n",
      "created_at" : "2021-07-27T03:55:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/22559#issuecomment-887187447",
      "id" : 887187447,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22559",
      "node_id" : "IC_kwDOABII58404Wf3",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-27T03:58:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/887187447",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8435003?v=4",
         "events_url" : "https://api.github.com/users/tryphe/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tryphe/followers",
         "following_url" : "https://api.github.com/users/tryphe/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tryphe/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tryphe",
         "id" : 8435003,
         "login" : "tryphe",
         "node_id" : "MDQ6VXNlcjg0MzUwMDM=",
         "organizations_url" : "https://api.github.com/users/tryphe/orgs",
         "received_events_url" : "https://api.github.com/users/tryphe/received_events",
         "repos_url" : "https://api.github.com/users/tryphe/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tryphe/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tryphe/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tryphe"
      }
   }
]
