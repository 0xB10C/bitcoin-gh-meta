[
   {
      "author_association" : "MEMBER",
      "body" : "ACK ee5fb1f8dcdca66af992f05081c71703aa43fdff\r\n\r\nReviewed code and checked that the test fails on master but not on this PR.",
      "created_at" : "2021-06-14T20:13:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22245#issuecomment-860962286",
      "id" : 860962286,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22245",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MDk2MjI4Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-14T20:13:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/860962286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK ee5fb1f8dcdca66af992f05081c71703aa43fdff",
      "created_at" : "2021-06-14T21:55:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22245#issuecomment-861021033",
      "id" : 861021033,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22245",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MTAyMTAzMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-14T21:55:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/861021033",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22245#discussion_r651510247"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22245"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/651510247"
         }
      },
      "author_association" : "MEMBER",
      "body" : "question in ee5fb1f8dcdca66af992f05081c71703aa43fdff:\r\n\r\nIs there a reason for the sync_with_ping's? Ideally the `add_outbound_p2p_connection` helper should fully setup the connection (including handshake). And it seems it does do that, as there is a `p2p_conn.wait_for_verack()` and `p2p_conn.sync_with_ping()` inside.",
      "commit_id" : "ee5fb1f8dcdca66af992f05081c71703aa43fdff",
      "created_at" : "2021-06-15T07:12:01Z",
      "diff_hunk" : "@@ -74,6 +74,16 @@ def run_test(self):\n \n         assert addr_receiver.addrv2_received_and_checked\n \n+        self.log.info(\"Check that the node sends a SENDADDRV2 message to outbound full relay peers\")\n+        conn = self.nodes[0].add_outbound_p2p_connection(P2PInterface(), p2p_idx=0)\n+        conn.sync_with_ping()\n+        assert_equal(conn.message_count['sendaddrv2'], 1)\n+\n+        self.log.info(\"Check that the node does not send a SENDADDRV2 message to outbound block-relay-only peers\")\n+        conn = self.nodes[0].add_outbound_p2p_connection(P2PInterface(), p2p_idx=1, connection_type=\"block-relay-only\")\n+        conn.sync_with_ping()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22245#discussion_r651510247",
      "id" : 651510247,
      "line" : 84,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MTUxMDI0Nw==",
      "original_commit_id" : "ee5fb1f8dcdca66af992f05081c71703aa43fdff",
      "original_line" : 84,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "test/functional/p2p_addrv2_relay.py",
      "position" : 11,
      "pull_request_review_id" : 683635452,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22245",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-15T07:12:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/651510247",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK ee5fb1f8dcdca66af992f05081c71703aa43fdff",
      "created_at" : "2021-06-15T09:52:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22245#issuecomment-861359211",
      "id" : 861359211,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22245",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MTM1OTIxMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-15T09:52:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/861359211",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22245#discussion_r651895231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22245"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/651895231"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ah, agree its not necessary. I missed that there's already a `sync_with_ping()` inside `add_outbound_p2p_connection`, so I was adding buffer.",
      "commit_id" : "89524b25efc397b9fb89536d827df3a600b6fbdf",
      "created_at" : "2021-06-15T15:16:23Z",
      "diff_hunk" : "@@ -74,6 +74,16 @@ def run_test(self):\n \n         assert addr_receiver.addrv2_received_and_checked\n \n+        self.log.info(\"Check that the node sends a SENDADDRV2 message to outbound full relay peers\")\n+        conn = self.nodes[0].add_outbound_p2p_connection(P2PInterface(), p2p_idx=0)\n+        conn.sync_with_ping()\n+        assert_equal(conn.message_count['sendaddrv2'], 1)\n+\n+        self.log.info(\"Check that the node does not send a SENDADDRV2 message to outbound block-relay-only peers\")\n+        conn = self.nodes[0].add_outbound_p2p_connection(P2PInterface(), p2p_idx=1, connection_type=\"block-relay-only\")\n+        conn.sync_with_ping()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22245#discussion_r651895231",
      "id" : 651895231,
      "in_reply_to_id" : 651510247,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MTg5NTIzMQ==",
      "original_commit_id" : "ee5fb1f8dcdca66af992f05081c71703aa43fdff",
      "original_line" : 84,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "test/functional/p2p_addrv2_relay.py",
      "position" : null,
      "pull_request_review_id" : 684148360,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22245",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-15T15:16:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/651895231",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22245#discussion_r651909326"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22245"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/651909326"
         }
      },
      "author_association" : "MEMBER",
      "body" : "removed ",
      "commit_id" : "89524b25efc397b9fb89536d827df3a600b6fbdf",
      "created_at" : "2021-06-15T15:31:14Z",
      "diff_hunk" : "@@ -74,6 +74,16 @@ def run_test(self):\n \n         assert addr_receiver.addrv2_received_and_checked\n \n+        self.log.info(\"Check that the node sends a SENDADDRV2 message to outbound full relay peers\")\n+        conn = self.nodes[0].add_outbound_p2p_connection(P2PInterface(), p2p_idx=0)\n+        conn.sync_with_ping()\n+        assert_equal(conn.message_count['sendaddrv2'], 1)\n+\n+        self.log.info(\"Check that the node does not send a SENDADDRV2 message to outbound block-relay-only peers\")\n+        conn = self.nodes[0].add_outbound_p2p_connection(P2PInterface(), p2p_idx=1, connection_type=\"block-relay-only\")\n+        conn.sync_with_ping()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22245#discussion_r651909326",
      "id" : 651909326,
      "in_reply_to_id" : 651510247,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MTkwOTMyNg==",
      "original_commit_id" : "ee5fb1f8dcdca66af992f05081c71703aa43fdff",
      "original_line" : 84,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "test/functional/p2p_addrv2_relay.py",
      "position" : null,
      "pull_request_review_id" : 684167557,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22245",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-15T15:31:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/651909326",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "thank you for the reviews! I force pushed to address [marco's comment](https://github.com/bitcoin/bitcoin/pull/22245#discussion_r651510247). the [diff](https://github.com/bitcoin/bitcoin/compare/ee5fb1f8dcdca66af992f05081c71703aa43fdff..89524b25efc397b9fb89536d827df3a600b6fbdf) is very small, so hopefully should be very easy to reACK. ",
      "created_at" : "2021-06-15T15:32:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22245#issuecomment-861602046",
      "id" : 861602046,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22245",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MTYwMjA0Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-15T15:32:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/861602046",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "easy re-ACK 89524b25efc397b9fb89536d827df3a600b6fbdf ð³\r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\neasy re-ACK 89524b25efc397b9fb89536d827df3a600b6fbdf ð³\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUi0MAv/YQTTCEElYXs2V3M0yc4sL22r/0V9G0RBxJOy95a6lFev8gkwnAhlUaTY\r\ncE5bogD3Iy5EzNXYmKQQsI/6LyaBEkgBInlraDA0YtZdJ6NDAeiEBBVT9npeaLVh\r\nLM5NG6guJaFdDPVCJHc2zdrNyJBt65B3jUCCPRb6Z10LOCRsiz43W5OsRk9vEQDx\r\npbQVNAkyfDBfrlQ8EogDTxNyeDw3yluQBghbWm4di88KNtMK0xP4NMN4FKMmnUtm\r\n5VjME2xMlBvOscp9ja4U1o4eWnS3WCT53tkh5lcoSCjARfIi4mqC+HiFZr00TRd9\r\n0tcxv+T6YW5B2292KzW+UCrmzBC2X7lj7eCfpqJ0AdKRJ2jAviHL76Tv1nUKCuLS\r\nalyKmXCgtk2bTk+0ts0lYsv59ecbvP0KW1wbkI3BlauM+vEhDxhlQ3nTQ8VCXVQa\r\nyL0LuWgY92pxx0Od/y5HJXZw0MkeZkTYsFxxy8N/7uZhL2JmPWvZ3iPP7rsG8VZI\r\nc1gEV58T\r\n=R9+p\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `2a48f9b25bb976253d76e769baa2281f8a5327db2b65c3cb3f3e909d023e9827  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e8929401082a48f9b25bb976253d76e769baa2281f8a5327db2b65c3cb3f3e909d023e9827f0109699b2b56791dee5a214d3810007075908fff01030a52999237e744fb0f097471313daa508f10460c8cbb3f00821a1dc58f5f2912d0083dfe30d2ef90c8e292868747470733a2f2f66696e6e65792e63616c656e6461722e657465726e69747977616c6c2e636f6dfff01084d0e89da1b4462f2e707fa606cffd1a08f10460c8cbb3f008b57a75f12f307d9f0083dfe30d2ef90c8e232268747470733a2f2f6274632e63616c656e6461722e636174616c6c6178792e636f6dfff010ea2344c5c78f94e4c414084312e3216a08f10460c8cbb3f008581d0b4bf4b127ce0083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267f010fe31a7e3a9f7461d67a529232e32a11408f10460c8cbb3f0082b492929ef03dc0b0083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267)\r\n\r\n</details>\r\n",
      "created_at" : "2021-06-15T15:48:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22245#issuecomment-861614629",
      "id" : 861614629,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22245",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MTYxNDYyOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-15T15:48:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/861614629",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 89524b25efc397b9fb89536d827df3a600b6fbdf",
      "created_at" : "2021-06-15T15:53:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22245#issuecomment-861618500",
      "id" : 861618500,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22245",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MTYxODUwMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-15T15:53:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/861618500",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "We might want to update BIP155 for this (@vasild what do you think?). How I've always interpreted is that in principle, the `sendaddrv2` message means that the sending node supports v2 addr messages. This is orthogonal to whether it wants to receive address messages in the first place.\r\n\r\nI'm not opposed to combining these, though it's not clear to me how a node would signal it doesn't want to receive address messages at all. ",
      "created_at" : "2021-06-15T15:55:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22245#issuecomment-861620517",
      "id" : 861620517,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22245",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MTYyMDUxNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-15T15:55:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/861620517",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 7c141b77764359dedc8815ce8484f42f87727dbe",
      "created_at" : "2021-06-15T17:10:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22245#issuecomment-861677283",
      "id" : 861677283,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22245",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MTY3NzI4Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-15T17:10:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/861677283",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke, @jnewbery - thanks for the quick re-reviews! \r\n\r\nsorry to have force-pushed again, but looking at #22243 made me realize I was introducing potential for a race here, so I added acquiring `p2p_lock` to the new tests. \r\n\r\n@laanwj \r\n> We might want to update BIP155 for this... \r\n\r\nAre you thinking something like \"Clients are NOT RECOMMENDED to send a `sendaddrv2` message if they are not interested in participating in address relay over the connection.\"? It doesn't seem necessary to me, but also doesn't seem harmful. \r\n\r\n> though it's not clear to me how a node would signal it doesn't want to receive address messages at all.\r\n\r\nHave you seen #21528? I'm proposing a \"opt-in\" approach vs an \"opt-out\" approach for propagating addr self-announcements to inbound peers. ",
      "created_at" : "2021-06-15T17:14:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22245#issuecomment-861680794",
      "id" : 861680794,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22245",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MTY4MDc5NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-15T17:14:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/861680794",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 7c141b77764359dedc8815ce8484f42f87727dbe",
      "created_at" : "2021-06-15T22:14:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22245#issuecomment-861871032",
      "id" : 861871032,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22245",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MTg3MTAzMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-15T22:14:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/861871032",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "re-ACK 7c141b77764359dedc8815ce8484f42f87727dbe",
      "created_at" : "2021-06-15T22:34:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22245#issuecomment-861879181",
      "id" : 861879181,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22245",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MTg3OTE4MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-15T22:34:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/861879181",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The current implemented behavior of sendaddrv2 is a clean binary signal: BIP155 addrv2 format support true/false.  It may be good to update BIP155 to clarify that.\r\n\r\nConsequences of the proposed widening of sendaddrv2 semantics (if my thinking isn't muddled):\r\n\r\n- loss of signal: we can no longer know if a block-relay peer does not support addrv2\r\n\r\n- irreversibility: once propagated across the network in a release, reverting the change cannot recover the lost information from peers using that release, so if we need it for a reason that we don't foresee today, we would need to introduce a new message mechanism again\r\n\r\nIt seems there should be a very compelling reason beyond \"it's harmless but currently irrelevant to block-relay peers\" to irreversibly widen the semantics from the current implementation, and that the BIP could be clarified.\r\n",
      "created_at" : "2021-06-16T05:11:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22245#issuecomment-862044403",
      "id" : 862044403,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22245",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MjA0NDQwMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-16T05:11:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/862044403",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jonatack this was discussed briefly in the p2p irc meeting last night: https://www.erisian.com.au/bitcoin-core-dev/log-2021-06-15.html#l-284\r\n\r\nI agree with what @sipa said in that meeting:\r\n\r\n```\r\n304 2021-06-15T21:16:13  <sipa> if you don't care about addresses, sending sendaddrv2 is just irrelevant\r\n```\r\n\r\nBIP 155 is explicit about [what the sendaddrv2 message](https://github.com/bitcoin/bips/blob/master/bip-0155.mediawiki#signaling-support-and-compatibility) means:\r\n\r\n> Introduce a new message type sendaddrv2. Sending such a message indicates that a node can understand and prefers to receive addrv2 messages instead of addr messages. I.e. \"Send me addrv2\".\r\n\r\nIf a node doesn't wish to receive any addr messages, then it shouldn't send a `sendaddrv2` message to request its peer to \"Send me addrv2\".",
      "created_at" : "2021-06-16T10:34:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22245#issuecomment-862246086",
      "id" : 862246086,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22245",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MjI0NjA4Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-16T10:34:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/862246086",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The `sendaddrv2` message has a very clear purpose - to announce that the peer who emitted it supports the `addrv2` format (and obviously prefers to receive `addrv2` instead of `addr`). This is [documented in BIP155](https://github.com/bitcoin/bips/blob/master/bip-0155.mediawiki#signaling-support-and-compatibility). If the semantic of `sendaddrv2` is to be changed, that should start by modifying BIP155. There must be a very compelling reason (as @jonatack mentions above) to change it, given that its already deployed and running on mainnet. Tweaks to address relay is not such a reason, IMO.\r\n\r\nThere already was a [discussion](https://github.com/bitcoin/bips/pull/907#issuecomment-686044611) whether to add extra meaning in `sendaddrv2` before it was introduced (whether to tie it to relay/not-relay). It [concluded like this](https://github.com/bitcoin/bips/pull/907#issuecomment-694471696).\r\n\r\nOn the organizational level - I think it is not a good idea to rush such a change to the code _and the protocol_ near or past the feature freeze (this PR was opened a few hours before FF).\r\n\r\nOn the technical level - I think it would be most simple and flexible to introduce a new flag \"I (don't) want unrequested addresses\". This could be done with either a new message or a service bit. Having two separate flags for the supported format (`A`) and the desire to receive gossip (`B`) would allow all 4 combinations, let's say:\r\n\r\n* `A` - support for `addrv2` (currently equal to sending `sendaddrv2`)\r\n* `B` - want unrequested addresses\r\n\r\n1. `!A` and `!B` (it follows that if you send me a reply to my `getaddr` it should be in the old `addr` format because I don't support the new `addrv2`)\r\n2. `!A` and `B`\r\n3. `A` and `!B` (it follows that if you send me a reply to my `getaddr` I prefer it to be in the `addrv2` format)\r\n4. `A` and `B`\r\n\r\nSignalling \"I want unrequested addresses\" (`B`) could mean that I either maintain an address database and/or participate in gossip. Which one it is (or both) is irrelevant to my peer who only needs to know whether to gossip to me or not.\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/17194 is related, cc @naumenkogs ",
      "created_at" : "2021-06-16T10:53:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22245#issuecomment-862279099",
      "id" : 862279099,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22245",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MjI3OTA5OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-16T10:53:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/862279099",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> BIP 155 is explicit about [what the sendaddrv2 message](https://github.com/bitcoin/bips/blob/master/bip-0155.mediawiki#signaling-support-and-compatibility) means:\r\n> \r\n> > Introduce a new message type sendaddrv2. Sending such a message indicates that a node can understand and prefers to receive addrv2 messages instead of addr messages. I.e. \"Send me addrv2\".\r\n> \r\n> If a node doesn't wish to receive any addr messages, then it shouldn't send a `sendaddrv2` message to request its peer to \"Send me addrv2\".\r\n\r\nOh, well, I was thinking that the BIP155 wording is clear enough, but apparently it is not. The intention is to say \"send me red apples **instead** of green apples (if you are going to send me any apples at all)\", not to mandate whether I want apples or not. Edit: opened https://github.com/bitcoin/bips/pull/1134 to clarify the wording.",
      "created_at" : "2021-06-16T11:02:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22245#issuecomment-862284713",
      "id" : 862284713,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22245",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MjI4NDcxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-16T11:30:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/862284713",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
