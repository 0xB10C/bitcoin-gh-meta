[
   {
      "author_association" : "MEMBER",
      "body" : "`./src/test/test_bitcoin -t net_peer_eviction_tests/peer_protection_test` runs about 10% faster for me on this branch, though it is a debug build and the unit tests use very low numbers of eviction candidates (between 4 and 24).  I'll write a test with higher numbers of eviction candidates and benchmark with optimized builds (and fix the fuzzer CI failure).",
      "created_at" : "2021-06-19T17:40:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22284#issuecomment-864441022",
      "id" : 864441022,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22284",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NDQ0MTAyMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-19T17:40:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/864441022",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Added benchmarks. This pull speeds up `ProtectEvictionCandidatesByRatio()` between 2x and 6x for the benchmarked cases. It's not a hotspot, but the improvement is significant.\r\n\r\n\r\n```\r\n$ ./src/bench/bench_bitcoin -filter=EvictionProtection*.*\r\n```\r\n\r\nmaster\r\n\r\n```rake\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|    5,403,043,444.00 |                0.19 |    1.8% |     59.74 | `EvictionProtection1Network250Candidates`\r\n|    2,946,547,379.00 |                0.34 |    2.7% |     33.45 | `EvictionProtection3Networks050Candidates`\r\n|    2,798,691,071.00 |                0.36 |    2.2% |     30.79 | `EvictionProtection3Networks100Candidates`\r\n|    7,288,364,370.00 |                0.14 |    0.7% |     80.16 | `EvictionProtection3Networks250Candidates`\r\n```\r\n\r\nthis PR\r\n\r\n```rake\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|    1,183,198,205.00 |                0.85 |    1.2% |     13.12 | `EvictionProtection1Network250Candidates`\r\n|    1,151,709,186.00 |                0.87 |    1.7% |     12.67 | `EvictionProtection3Networks050Candidates`\r\n|    1,261,170,266.00 |                0.79 |    2.9% |     14.26 | `EvictionProtection3Networks100Candidates`\r\n|    1,157,625,808.00 |                0.86 |    1.0% |     12.95 | `EvictionProtection3Networks250Candidates`\r\n```\r\n\r\n------\r\n\r\n(intermediate commits)\r\n\r\n*p2p: iterate over eviction candidates once instead of thrice*\r\n\r\n```rake\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|    3,952,529,089.00 |                0.25 |    1.8% |     43.47 | `EvictionProtection1Network250Candidates`\r\n|    2,239,435,919.00 |                0.45 |    3.8% |     25.85 | `EvictionProtection3Networks050Candidates`\r\n|    2,060,389,113.00 |                0.49 |    1.9% |     22.85 | `EvictionProtection3Networks100Candidates`\r\n|    5,258,681,959.00 |                0.19 |    1.0% |     58.26 | `EvictionProtection3Networks250Candidates`\r\n```\r\n\r\n*p2p: iterate eviction protection only on networks having candidates*\r\n\r\n```rake\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|    1,224,597,989.00 |                0.82 |    2.2% |     13.60 | `EvictionProtection1Network250Candidates`\r\n```\r\n",
      "created_at" : "2021-06-20T14:39:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22284#issuecomment-864564794",
      "id" : 864564794,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22284",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NDU2NDc5NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-20T15:26:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/864564794",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Tested on macOs 11.4 and this PR indeed optimize it by 1.3x to 5x. \r\n\r\n<details> \r\n<summary> Test result </summary>\r\n\r\nOn 272f327fbfcb8bb61f8e1c9d65c665372cd60976(master with benchmarks):\r\n```\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|      756,331,588.00 |                1.32 |    1.2% |      8.38 | `EvictionProtection1Network250Candidates`\r\n|    1,579,971,776.00 |                0.63 |    1.1% |     17.45 | `EvictionProtection3Networks050Candidates`\r\n|    1,395,431,168.00 |                0.72 |    1.0% |     15.70 | `EvictionProtection3Networks100Candidates`\r\n|    3,716,091,921.00 |                0.27 |    1.0% |     41.32 | `EvictionProtection3Networks250Candidates`\r\n```\r\nThis PR:\r\n```          \r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|      492,425,456.00 |                2.03 |    0.9% |      5.45 | `EvictionProtection1Network250Candidates`\r\n|      739,073,603.00 |                1.35 |    1.3% |      8.13 | `EvictionProtection3Networks050Candidates`\r\n|      937,281,186.00 |                1.07 |    0.7% |     10.38 | `EvictionProtection3Networks100Candidates`\r\n|      828,820,224.00 |                1.21 |    1.6% |      9.10 | `EvictionProtection3Networks250Candidates`\r\n```\r\n</details>\r\n\r\nNot sure if it is an issue on my side but I had to test with `./src/bench/bench_bitcoin -filter=\"EvictionProtection*.*\"`(quotes around regex) instead of the command provided by the PR description. ",
      "created_at" : "2021-06-20T15:18:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22284#issuecomment-864569995",
      "id" : 864569995,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22284",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NDU2OTk5NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-20T15:18:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/864569995",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/49265907?v=4",
         "events_url" : "https://api.github.com/users/klementtan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/klementtan/followers",
         "following_url" : "https://api.github.com/users/klementtan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/klementtan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/klementtan",
         "id" : 49265907,
         "login" : "klementtan",
         "node_id" : "MDQ6VXNlcjQ5MjY1OTA3",
         "organizations_url" : "https://api.github.com/users/klementtan/orgs",
         "received_events_url" : "https://api.github.com/users/klementtan/received_events",
         "repos_url" : "https://api.github.com/users/klementtan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/klementtan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/klementtan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/klementtan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19377 by hebasto\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-06-20T17:24:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22284#issuecomment-864586340",
      "id" : 864586340,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22284",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NDU4NjM0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-24T13:40:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/864586340",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-06-22T16:22:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22284#issuecomment-866133352",
      "id" : 866133352,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22284",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NjEzMzM1Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-22T16:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/866133352",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review @jarolrod!  If anyone else would like to review or ACK that would be great as this completes merged PR #21261.",
      "created_at" : "2021-06-26T18:18:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22284#issuecomment-869042211",
      "id" : 869042211,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22284",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2OTA0MjIxMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-26T18:18:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/869042211",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
