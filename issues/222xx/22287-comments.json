[
   {
      "author_association" : "MEMBER",
      "body" : "Perhaps you want to make it print the value of `cmd`, so we can figure out which F_ constants are used but not handled by the wrapper. The partial approach is pretty uncomfortable though.",
      "created_at" : "2021-06-20T00:29:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22287#issuecomment-864480765",
      "id" : 864480765,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22287",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NDQ4MDc2NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-20T00:29:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/864480765",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22287#discussion_r654857182"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22287"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/654857182"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Don't remove the exit here. This is sort of an assert; if you continue it'll invoke fcntl with who knows what behavior.",
      "commit_id" : "639bfc4b359bd9364829d3abb8e12e16d432471c",
      "created_at" : "2021-06-20T00:35:01Z",
      "diff_hunk" : "@@ -6,8 +6,132 @@\n #include <config/bitcoin-config.h>\n #endif\n \n+#include <cstdarg>\n #include <cstddef>\n #include <cstdint>\n+#include <cstdio>\n+#include <cstdlib>\n+\n+#include <fcntl.h>\n+\n+// See https://stackoverflow.com/a/58472959\n+#ifdef __i386__\n+__asm(\".symver fcntl64,fcntl@GLIBC_2.1\");\n+#elif defined(__amd64__)\n+__asm(\".symver fcntl64,fcntl@GLIBC_2.2.5\");\n+#elif defined(__arm__)\n+__asm(\".symver fcntl64,fcntl@GLIBC_2.4\");\n+#elif defined(__aarch64__)\n+__asm(\".symver fcntl64,fcntl@GLIBC_2.17\");\n+#elif defined(__powerpc64__)\n+#  ifdef WORDS_BIGENDIAN\n+__asm(\".symver fcntl64,fcntl@GLIBC_2.3\");\n+#  else\n+__asm(\".symver fcntl64,fcntl@GLIBC_2.17\");\n+#  endif\n+#elif defined(__riscv)\n+__asm(\".symver fcntl64,fcntl@GLIBC_2.27\");\n+#endif\n+extern \"C\" int __wrap_fcntl64(int fd, int cmd, ...)\n+{\n+    int result;\n+    va_list va;\n+    va_start(va, cmd);\n+\n+    switch (cmd) {\n+    //\n+    // File descriptor flags\n+    //\n+    case F_GETFD: goto takes_void;\n+    case F_SETFD: goto takes_int;\n+\n+    // File status flags\n+    //\n+    case F_GETFL: goto takes_void;\n+    case F_SETFL: goto takes_int;\n+\n+    // File byte range locking, not held across fork() or clone()\n+    //\n+    case F_SETLK: goto takes_flock_ptr_INCOMPATIBLE;\n+    case F_SETLKW: goto takes_flock_ptr_INCOMPATIBLE;\n+    case F_GETLK: goto takes_flock_ptr_INCOMPATIBLE;\n+\n+    // File byte range locking, held across fork()/clone() -- Not POSIX\n+    //\n+    case F_OFD_SETLK: goto takes_flock_ptr_INCOMPATIBLE;\n+    case F_OFD_SETLKW: goto takes_flock_ptr_INCOMPATIBLE;\n+    case F_OFD_GETLK: goto takes_flock_ptr_INCOMPATIBLE;\n+\n+    // Managing I/O availability signals\n+    //\n+    case F_GETOWN: goto takes_void;\n+    case F_SETOWN: goto takes_int;\n+    case F_GETOWN_EX: goto takes_f_owner_ex_ptr;\n+    case F_SETOWN_EX: goto takes_f_owner_ex_ptr;\n+    case F_GETSIG: goto takes_void;\n+    case F_SETSIG: goto takes_int;\n+\n+    // Notified when process tries to open or truncate file (Linux 2.4+)\n+    //\n+    case F_SETLEASE: goto takes_int;\n+    case F_GETLEASE: goto takes_void;\n+\n+    // File and directory change notification\n+    //\n+    case F_NOTIFY: goto takes_int;\n+\n+    // Changing pipe capacity (Linux 2.6.35+)\n+    //\n+    case F_SETPIPE_SZ: goto takes_int;\n+    case F_GETPIPE_SZ: goto takes_void;\n+\n+    // File sealing (Linux 3.17+)\n+    //\n+    case F_ADD_SEALS: goto takes_int;\n+    case F_GET_SEALS: goto takes_void;\n+\n+    // File read/write hints (Linux 4.13+)\n+    //\n+    case F_GET_RW_HINT: goto takes_uint64_t_ptr;\n+    case F_SET_RW_HINT: goto takes_uint64_t_ptr;\n+    case F_GET_FILE_RW_HINT: goto takes_uint64_t_ptr;\n+    case F_SET_FILE_RW_HINT: goto takes_uint64_t_ptr;\n+\n+    default:\n+        fprintf(stderr, \"fcntl64 workaround got unknown F_XXX constant\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22287#discussion_r654857182",
      "id" : 654857182,
      "line" : 101,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NDg1NzE4Mg==",
      "original_commit_id" : "639bfc4b359bd9364829d3abb8e12e16d432471c",
      "original_line" : 101,
      "original_position" : 96,
      "original_start_line" : null,
      "path" : "src/compat/glibc_compat.cpp",
      "position" : 96,
      "pull_request_review_id" : 687858226,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22287",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-20T00:35:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/654857182",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
