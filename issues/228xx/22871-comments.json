[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "will likely need to rebase on top of https://github.com/bitcoin/bitcoin/pull/22870 and change the failing tests to exempt them from DISCOURAGE_UPGRADABLE_NOPS",
      "created_at" : "2021-09-03T01:08:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22871#issuecomment-912173251",
      "id" : 912173251,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22871",
      "node_id" : "IC_kwDOABII5842XqjD",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-03T01:08:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/912173251",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22871#discussion_r701540132"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701540132"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "probably worth adding a comment like: `// CHECKSEQUENCEVERIFY behaving as NOP, set error appropriately` ",
      "commit_id" : "59008cfb0b4a0793b03d52c4c77ab64cd4ede9d7",
      "created_at" : "2021-09-03T02:23:12Z",
      "diff_hunk" : "@@ -606,8 +606,11 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n                     // To provide for future soft-fork extensibility, if the\n                     // operand has the disabled lock-time flag set,\n                     // CHECKSEQUENCEVERIFY behaves as a NOP.\n-                    if ((nSequence & CTxIn::SEQUENCE_LOCKTIME_DISABLE_FLAG) != 0)\n+                    if ((nSequence & CTxIn::SEQUENCE_LOCKTIME_DISABLE_FLAG) != 0) {\n+                        if (flags & SCRIPT_VERIFY_DISCOURAGE_UPGRADABLE_NOPS)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22871#discussion_r701540132",
      "id" : 701540132,
      "line" : 610,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTU0MDEzMg==",
      "original_commit_id" : "59008cfb0b4a0793b03d52c4c77ab64cd4ede9d7",
      "original_line" : 610,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : 6,
      "pull_request_review_id" : 745656644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22871",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-03T02:23:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701540132",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Expanded the semantics to reject in transaction standardness as well.",
      "created_at" : "2021-09-04T16:29:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22871#issuecomment-913001038",
      "id" : 913001038,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22871",
      "node_id" : "IC_kwDOABII5842a0pO",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-04T16:29:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/913001038",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22871#discussion_r702327593"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702327593"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "adding this `extra_fields` check should result in a fork now, no?",
      "commit_id" : "a1d274d3b22ea8866b85a748b9e50a514d13ab92",
      "created_at" : "2021-09-04T20:56:12Z",
      "diff_hunk" : "@@ -606,8 +606,17 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n                     // To provide for future soft-fork extensibility, if the\n                     // operand has the disabled lock-time flag set,\n                     // CHECKSEQUENCEVERIFY behaves as a NOP.\n-                    if ((nSequence & CTxIn::SEQUENCE_LOCKTIME_DISABLE_FLAG) != 0)\n+                    // If uninterpreted fields are set, also treat as a NOP.\n+                    // This also covers CTxIn::SEQUENCE_FINAL since all bits are\n+                    // set there.\n+                    const CScriptNum extra_fields = nSequence &\n+                        ~(CTxIn::SEQUENCE_LOCKTIME_TYPE_FLAG | CTxIn::SEQUENCE_LOCKTIME_MASK);\n+                    if ((nSequence & CTxIn::SEQUENCE_LOCKTIME_DISABLE_FLAG) != 0 || extra_fields != 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22871#discussion_r702327593",
      "id" : 702327593,
      "line" : 614,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjMyNzU5Mw==",
      "original_commit_id" : "4a63b2ccff7ce5f485e19b75b07ddbfa5c11add5",
      "original_line" : 614,
      "original_position" : 10,
      "original_start_line" : 612,
      "path" : "src/script/interpreter.cpp",
      "position" : 10,
      "pull_request_review_id" : 746594957,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22871",
      "side" : "RIGHT",
      "start_line" : 612,
      "start_side" : "RIGHT",
      "updated_at" : "2021-09-04T20:56:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702327593",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22871#discussion_r702333392"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702333392"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You're totally right, my bad.\r\n\r\nWe need to handle it separately and still pass it to CheckSequence even though the fields are ignored.",
      "commit_id" : "0ed4272a2c351374d5e69430a0a7e6b967c6050f",
      "created_at" : "2021-09-04T22:02:48Z",
      "diff_hunk" : "@@ -606,8 +606,17 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n                     // To provide for future soft-fork extensibility, if the\n                     // operand has the disabled lock-time flag set,\n                     // CHECKSEQUENCEVERIFY behaves as a NOP.\n-                    if ((nSequence & CTxIn::SEQUENCE_LOCKTIME_DISABLE_FLAG) != 0)\n+                    // If uninterpreted fields are set, also treat as a NOP.\n+                    // This also covers CTxIn::SEQUENCE_FINAL since all bits are\n+                    // set there.\n+                    const CScriptNum extra_fields = nSequence &\n+                        ~(CTxIn::SEQUENCE_LOCKTIME_TYPE_FLAG | CTxIn::SEQUENCE_LOCKTIME_MASK);\n+                    if ((nSequence & CTxIn::SEQUENCE_LOCKTIME_DISABLE_FLAG) != 0 || extra_fields != 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22871#discussion_r702333392",
      "id" : 702333392,
      "in_reply_to_id" : 702327593,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjMzMzM5Mg==",
      "original_commit_id" : "4a63b2ccff7ce5f485e19b75b07ddbfa5c11add5",
      "original_line" : 614,
      "original_position" : 10,
      "original_start_line" : 612,
      "path" : "src/script/interpreter.cpp",
      "position" : null,
      "pull_request_review_id" : 746597813,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22871",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-09-04T22:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702333392",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22871#discussion_r702334685"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702334685"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ok I think the patch i added properly only checks the extra flags during standardness interpreter rules.",
      "commit_id" : "0ed4272a2c351374d5e69430a0a7e6b967c6050f",
      "created_at" : "2021-09-04T22:19:36Z",
      "diff_hunk" : "@@ -606,8 +606,17 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n                     // To provide for future soft-fork extensibility, if the\n                     // operand has the disabled lock-time flag set,\n                     // CHECKSEQUENCEVERIFY behaves as a NOP.\n-                    if ((nSequence & CTxIn::SEQUENCE_LOCKTIME_DISABLE_FLAG) != 0)\n+                    // If uninterpreted fields are set, also treat as a NOP.\n+                    // This also covers CTxIn::SEQUENCE_FINAL since all bits are\n+                    // set there.\n+                    const CScriptNum extra_fields = nSequence &\n+                        ~(CTxIn::SEQUENCE_LOCKTIME_TYPE_FLAG | CTxIn::SEQUENCE_LOCKTIME_MASK);\n+                    if ((nSequence & CTxIn::SEQUENCE_LOCKTIME_DISABLE_FLAG) != 0 || extra_fields != 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22871#discussion_r702334685",
      "id" : 702334685,
      "in_reply_to_id" : 702327593,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjMzNDY4NQ==",
      "original_commit_id" : "4a63b2ccff7ce5f485e19b75b07ddbfa5c11add5",
      "original_line" : 614,
      "original_position" : 10,
      "original_start_line" : 612,
      "path" : "src/script/interpreter.cpp",
      "position" : null,
      "pull_request_review_id" : 746598465,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22871",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-09-04T22:19:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702334685",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22871#discussion_r702340924"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702340924"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I was wrong on that; the prior policy.cpp i had was not exempting final sequence. new version should be (hopefully) correct.",
      "commit_id" : "0ed4272a2c351374d5e69430a0a7e6b967c6050f",
      "created_at" : "2021-09-04T23:41:08Z",
      "diff_hunk" : "@@ -606,8 +606,17 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n                     // To provide for future soft-fork extensibility, if the\n                     // operand has the disabled lock-time flag set,\n                     // CHECKSEQUENCEVERIFY behaves as a NOP.\n-                    if ((nSequence & CTxIn::SEQUENCE_LOCKTIME_DISABLE_FLAG) != 0)\n+                    // If uninterpreted fields are set, also treat as a NOP.\n+                    // This also covers CTxIn::SEQUENCE_FINAL since all bits are\n+                    // set there.\n+                    const CScriptNum extra_fields = nSequence &\n+                        ~(CTxIn::SEQUENCE_LOCKTIME_TYPE_FLAG | CTxIn::SEQUENCE_LOCKTIME_MASK);\n+                    if ((nSequence & CTxIn::SEQUENCE_LOCKTIME_DISABLE_FLAG) != 0 || extra_fields != 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22871#discussion_r702340924",
      "id" : 702340924,
      "in_reply_to_id" : 702327593,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjM0MDkyNA==",
      "original_commit_id" : "4a63b2ccff7ce5f485e19b75b07ddbfa5c11add5",
      "original_line" : 614,
      "original_position" : 10,
      "original_start_line" : 612,
      "path" : "src/script/interpreter.cpp",
      "position" : null,
      "pull_request_review_id" : 746601292,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22871",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-09-04T23:41:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702340924",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   }
]
