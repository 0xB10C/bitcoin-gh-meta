[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, I think this makes onlynet closer to what users expect, clearing up all kind of exceptions that have to be documented. Thanks!",
      "created_at" : "2021-08-30T13:20:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-908337743",
      "id" : 908337743,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842JCJP",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-30T13:21:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/908337743",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "With this PR, one could use for example `-onlynet=ipv6 -onion=127.0.0.1:9050` and Bitcoin Core will not automatically connect to `.onion` hosts. However one could later use the `addnode` RPC to manually connect to an `.onion` host. This matches the current behavior in `master` wrt other networks, e.g. `-onlynet=ipv6` and later `addnode` to an ipv4 host.",
      "created_at" : "2021-08-30T14:35:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-908396174",
      "id" : 908396174,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842JQaO",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-30T14:35:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/908396174",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22834#discussion_r698592051"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22834"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698592051"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(Initial drive-by review.) Every onlynet question I've received has been about using -onlynet=onion, -onlynet=i2p, or both together, so it may be reasonable to address what node operators seem most interested in and minimize confusion, by using the hidden networks for the onlynet examples in both `doc/tor.md` and `doc/i2p.md` (unless you use all of them in the examples to illustrate that it is possible, which is what I did in #22648, but no strong opinion on whether that is helpful)\r\n```suggestion\r\n                    onlynet=onion, onlynet=i2p.\r\n```",
      "commit_id" : "7b821b9d4c5e60ae3b79d2ee9c398852c850fc0d",
      "created_at" : "2021-08-30T15:35:17Z",
      "diff_hunk" : "@@ -57,11 +57,7 @@ outgoing connections, but more is possible.\n     -onlynet=onion  Make outgoing connections only to .onion addresses. Incoming\n                     connections are not affected by this option. This option can be\n                     specified multiple times to allow multiple network types, e.g.\n-                    onlynet=ipv4, onlynet=ipv6, onlynet=onion, onlynet=i2p.\n-                    Warning: if you use -onlynet with values other than onion, and\n-                    the -onion or -proxy option is set, then outgoing onion\n-                    connections will still be made; use -noonion or -onion=0 to\n-                    disable outbound onion connections in this case.\n+                    onlynet=ipv6, onlynet=onion.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#discussion_r698592051",
      "id" : 698592051,
      "line" : 60,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5ODU5MjA1MQ==",
      "original_commit_id" : "7b821b9d4c5e60ae3b79d2ee9c398852c850fc0d",
      "original_line" : 60,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "doc/tor.md",
      "position" : 9,
      "pull_request_review_id" : 741788733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22834",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-30T15:47:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698592051",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22834#discussion_r698600479"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22834"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698600479"
         }
      },
      "author_association" : "MEMBER",
      "body" : "naming nit, `onlynet` or maybe `onlynet_str` might be a clearer iterator name for `onlynets`, and `net` is often used for passing a `Network` enum, e.g. in `src/net.h::IsReachable()` and `SetReachable()`)\r\n```suggestion\r\n    return std::any_of(onlynets.begin(), onlynets.end(), [&addr](const auto& onlynet) {\r\n```",
      "commit_id" : "7b821b9d4c5e60ae3b79d2ee9c398852c850fc0d",
      "created_at" : "2021-08-30T15:46:28Z",
      "diff_hunk" : "@@ -113,6 +113,22 @@ std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(cs_mapLocalHost);\n static bool vfLimited[NET_MAX] GUARDED_BY(cs_mapLocalHost) = {};\n std::string strSubVersion;\n \n+/**\n+ * Check if making an automatic outbound connection to the given address is allowed.\n+ * Could be restricted by the `-onlynet` configuration option.\n+ * @return true if allowed\n+ */\n+static bool OutboundConnectionAllowedTo(const CNetAddr& addr)\n+{\n+    if (!gArgs.IsArgSet(\"-onlynet\")) {\n+        return true;\n+    }\n+    const auto onlynets = gArgs.GetArgs(\"-onlynet\");\n+    return std::any_of(onlynets.begin(), onlynets.end(), [&addr](const auto& net) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#discussion_r698600479",
      "id" : 698600479,
      "line" : 127,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5ODYwMDQ3OQ==",
      "original_commit_id" : "7b821b9d4c5e60ae3b79d2ee9c398852c850fc0d",
      "original_line" : 127,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 15,
      "pull_request_review_id" : 741788733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22834",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-30T15:47:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698600479",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "(Feel free to ignore my comments until you re-push.) \r\n\r\nDo you plan to add functional tests like in #22651?",
      "created_at" : "2021-08-30T15:51:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-908457560",
      "id" : 908457560,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842JfZY",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-30T15:51:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/908457560",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#22766](https://github.com/bitcoin/bitcoin/pull/22766) (refactor: Clarify and disable unused ArgsManager flags by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-08-30T22:34:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-908750635",
      "id" : 908750635,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842Km8r",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/908750635/reactions"
      },
      "updated_at" : "2021-10-25T21:09:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/908750635",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22834#discussion_r699293514"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22834"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699293514"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ok, I will update this as per above. I changed it because it was using onlynet with all possible networks which looked strange to me.",
      "commit_id" : "7b821b9d4c5e60ae3b79d2ee9c398852c850fc0d",
      "created_at" : "2021-08-31T12:53:58Z",
      "diff_hunk" : "@@ -57,11 +57,7 @@ outgoing connections, but more is possible.\n     -onlynet=onion  Make outgoing connections only to .onion addresses. Incoming\n                     connections are not affected by this option. This option can be\n                     specified multiple times to allow multiple network types, e.g.\n-                    onlynet=ipv4, onlynet=ipv6, onlynet=onion, onlynet=i2p.\n-                    Warning: if you use -onlynet with values other than onion, and\n-                    the -onion or -proxy option is set, then outgoing onion\n-                    connections will still be made; use -noonion or -onion=0 to\n-                    disable outbound onion connections in this case.\n+                    onlynet=ipv6, onlynet=onion.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#discussion_r699293514",
      "id" : 699293514,
      "in_reply_to_id" : 698592051,
      "line" : 60,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5OTI5MzUxNA==",
      "original_commit_id" : "7b821b9d4c5e60ae3b79d2ee9c398852c850fc0d",
      "original_line" : 60,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "doc/tor.md",
      "position" : 9,
      "pull_request_review_id" : 742686359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22834",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-31T12:53:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699293514",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22834#discussion_r699294332"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22834"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699294332"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I will optimize this because it will be called frequently (not as in https://github.com/bitcoin/bitcoin/pull/22651, once per startup). `std::unordered_set` has a lookup time `O(1)`.",
      "commit_id" : "7b821b9d4c5e60ae3b79d2ee9c398852c850fc0d",
      "created_at" : "2021-08-31T12:54:59Z",
      "diff_hunk" : "@@ -113,6 +113,22 @@ std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(cs_mapLocalHost);\n static bool vfLimited[NET_MAX] GUARDED_BY(cs_mapLocalHost) = {};\n std::string strSubVersion;\n \n+/**\n+ * Check if making an automatic outbound connection to the given address is allowed.\n+ * Could be restricted by the `-onlynet` configuration option.\n+ * @return true if allowed\n+ */\n+static bool OutboundConnectionAllowedTo(const CNetAddr& addr)\n+{\n+    if (!gArgs.IsArgSet(\"-onlynet\")) {\n+        return true;\n+    }\n+    const auto onlynets = gArgs.GetArgs(\"-onlynet\");\n+    return std::any_of(onlynets.begin(), onlynets.end(), [&addr](const auto& net) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#discussion_r699294332",
      "id" : 699294332,
      "in_reply_to_id" : 698600479,
      "line" : 127,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5OTI5NDMzMg==",
      "original_commit_id" : "7b821b9d4c5e60ae3b79d2ee9c398852c850fc0d",
      "original_line" : 127,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 15,
      "pull_request_review_id" : 742687538,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22834",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-31T12:54:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699294332",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Do you plan to add functional tests like in #22651?\r\n\r\nIt would be good. I wonder how to test this deterministically. I guess I would want to have an addrman with just addresses from one network and use onlynet another network and check that a connection is never attempted, or something like that.",
      "created_at" : "2021-08-31T12:57:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-909211602",
      "id" : 909211602,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842MXfS",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-31T12:57:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/909211602",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\n\r\nStarted testing today and need to test lot of combinations with onlynet. Sharing things that I observed during basic tests:\r\n\r\n1. `onlynet=i2p` with `proxy=127.0.0.1:9050` does not create any outbound connections to onion nodes using PR branch however it connects to onion node with Master branch. â \r\n\r\n    1.1 Run node 1:\r\n     ```\r\n     bitcoind -regtest=1 -port=18333 -rpcport=18222 -rpcuser=user1 -rpcpassword=pass1 -datadir=/home/prayank/node1 -debug=net\r\n     ```\r\n     1.2 Run node 2:\r\n     ```\r\n     bitcoind -regtest=1 -port=18777 -rpcport=18666 -rpcuser=user2 -rpcpassword=pass2 -onlynet=i2p -i2psam=127.0.0.1:7656 -proxy=127.0.0.1:9050 -datadir=/home/prayank/node2 -debug=net\r\n     ```\r\n     1.3 Copy onion address for node 1 and add it in peers.dat for node2:\r\n     ```\r\n     bitcoin-cli -rpcport=18666 -rpcuser=user2 -rpcpassword=pass2 addpeeraddress \"6w724ckwacu2sdfitjr6otzfi4hfutxqqcc5mju2gc2ufguysb447gqd.onion\" 18444\r\n     ```\r\n     1.4 Wait for few seconds and node 2 will create an outbound connection with node 1 on Master branch. It should fail on PR branch.\r\n     \r\n     Master branch: https://pastebin.com/raw/krvahBf7\r\n     PR branch: https://pastebin.com/raw/P6uwLtxf\r\n\r\n2. Onion service and i2p service are not created when `proxy=127.0.0.1:9050` is used. (Master and PR branch) :warning:\r\n     \r\n     \r\n     ",
      "created_at" : "2021-08-31T15:19:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-909335451",
      "id" : 909335451,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842M1ub",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-31T15:24:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/909335451",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Concept ACK! Glad there's a full fix for this now.",
      "created_at" : "2021-09-01T02:44:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-909824016",
      "id" : 909824016,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842OtAQ",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-01T02:44:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/909824016",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/24482484?v=4",
         "events_url" : "https://api.github.com/users/Rspigler/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Rspigler/followers",
         "following_url" : "https://api.github.com/users/Rspigler/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Rspigler/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Rspigler",
         "id" : 24482484,
         "login" : "Rspigler",
         "node_id" : "MDQ6VXNlcjI0NDgyNDg0",
         "organizations_url" : "https://api.github.com/users/Rspigler/orgs",
         "received_events_url" : "https://api.github.com/users/Rspigler/received_events",
         "repos_url" : "https://api.github.com/users/Rspigler/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Rspigler/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Rspigler/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Rspigler"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22834#discussion_r700290402"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22834"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700290402"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "0ea0de64385c0150e179885a792d615005e20841",
      "created_at" : "2021-09-01T14:49:54Z",
      "diff_hunk" : "@@ -57,11 +57,7 @@ outgoing connections, but more is possible.\n     -onlynet=onion  Make outgoing connections only to .onion addresses. Incoming\n                     connections are not affected by this option. This option can be\n                     specified multiple times to allow multiple network types, e.g.\n-                    onlynet=ipv4, onlynet=ipv6, onlynet=onion, onlynet=i2p.\n-                    Warning: if you use -onlynet with values other than onion, and\n-                    the -onion or -proxy option is set, then outgoing onion\n-                    connections will still be made; use -noonion or -onion=0 to\n-                    disable outbound onion connections in this case.\n+                    onlynet=ipv6, onlynet=onion.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#discussion_r700290402",
      "id" : 700290402,
      "in_reply_to_id" : 698592051,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDI5MDQwMg==",
      "original_commit_id" : "7b821b9d4c5e60ae3b79d2ee9c398852c850fc0d",
      "original_line" : 60,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "doc/tor.md",
      "position" : null,
      "pull_request_review_id" : 744033554,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22834",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-01T14:49:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700290402",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22834#discussion_r700290807"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22834"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700290807"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done (optimized).",
      "commit_id" : "0ea0de64385c0150e179885a792d615005e20841",
      "created_at" : "2021-09-01T14:50:21Z",
      "diff_hunk" : "@@ -113,6 +113,22 @@ std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(cs_mapLocalHost);\n static bool vfLimited[NET_MAX] GUARDED_BY(cs_mapLocalHost) = {};\n std::string strSubVersion;\n \n+/**\n+ * Check if making an automatic outbound connection to the given address is allowed.\n+ * Could be restricted by the `-onlynet` configuration option.\n+ * @return true if allowed\n+ */\n+static bool OutboundConnectionAllowedTo(const CNetAddr& addr)\n+{\n+    if (!gArgs.IsArgSet(\"-onlynet\")) {\n+        return true;\n+    }\n+    const auto onlynets = gArgs.GetArgs(\"-onlynet\");\n+    return std::any_of(onlynets.begin(), onlynets.end(), [&addr](const auto& net) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#discussion_r700290807",
      "id" : 700290807,
      "in_reply_to_id" : 698600479,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDI5MDgwNw==",
      "original_commit_id" : "7b821b9d4c5e60ae3b79d2ee9c398852c850fc0d",
      "original_line" : 127,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 744034141,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22834",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-01T14:50:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700290807",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`7b821b9d4c...0ea0de6438`: optimize `OutboundConnectionAllowedTo()` for a fast lookup coz it is called frequently, plus some rewording in the docs.",
      "created_at" : "2021-09-01T14:51:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-910362016",
      "id" : 910362016,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842QwWg",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-01T14:51:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910362016",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@prayank23, thanks for looking into this! So all is working as expected. `-logips=1` will improve your log output a tiny bit. I also tested this manually by adding a printout inside `OutboundConnectionAllowedTo()`, with `-onlynet=i2p -onion=127.0.0.1:9050` it is called many times with `*.onion` addresses and returns `false` as expected.\r\n\r\nA room for improvement (out of the scope of this PR): with `-onlynet=X` if addrman contains a small percentage of `X` addresses, `CConnman::ThreadOpenConnections()` will loop many times trying non-`X` addresses which get rejected either by the existent `IsReachable()` check or by the newly added `OutboundConnectionAllowedTo()`. It takes __seconds__ to select an I2P address for example. `CAddrMan::Select()` could be smarter and take a `onlynets` argument and somehow return addresses that only belong to the requested networks fast.",
      "created_at" : "2021-09-01T15:07:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-910377602",
      "id" : 910377602,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842Q0KC",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-01T15:07:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910377602",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2021-09-01T16:02:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-910427409",
      "id" : 910427409,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842RAUR",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-01T16:02:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910427409",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Day 2 of testing `onlynet`\r\n\r\n| ipv4          | ipv6          | onion         | i2p           | logs           | Comments           |  \r\n| ------------- | ------------- | ------------- | ------------- | -------------  |  -------------     |\r\n|   :large_blue_circle:  |      |               |               |        https://pastebin.com/raw/nq5kXqYK          |  No issues          :white_check_mark:          |\r\n|      |   :large_blue_circle:  |                |               |      https://pastebin.com/raw/Hqnz0nAP            |  No issues  :white_check_mark:          | \r\n|      |      |    :large_blue_circle:          |               |       https://pastebin.com/raw/9bwY0Nbw           |   No issues      :white_check_mark:             | \r\n|      |      |       |           :large_blue_circle:            |       https://pastebin.com/raw/mhW371kx           |   No issues    :white_check_mark:      |\r\n\r\n> So all is working as expected\r\n\r\nNeed to test more things. ~~`onlynet=ipv6` did not work as expected today.~~\r\n\r\n> -logips=1 will improve your log output a tiny bit\r\n\r\nThanks. Will try this tomorrow.\r\n\r\n> CAddrMan::Select() could be smarter and take a onlynets argument and somehow return addresses that only belong to the requested networks fast.\r\n\r\nYes we can try this. ",
      "created_at" : "2021-09-01T19:13:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-910608011",
      "id" : 910608011,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842RsaL",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-02T10:31:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910608011",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I wonder about the interactions of the new `OutboundConnectionAllowedTo()` with `IsReachable()`, which is how `-onlynet` also influences things - it seems complicated  to  have both `OutboundConnectionAllowedTo()` and `IsReachable()` doing similar things with subtle differences, and depending on the situation one or the other is effective.\r\n\r\nMy understanding is that `IsReachable()` will still be able to violate the `-onlynet` option sometimes (if `-proxy` , `-onion` in `init.cpp` or `torcontrol.cpp` call  `SetReachable()` after the `-onlynet` arg was evaluated).\r\nBecause addrman acceptance is gated by `IsReachable()`, I think we could still accept addrs from networks excluded by `-onlynet` into addrman that we no longer would make outgoing connections to - leading to futile connection attempts.\r\n\r\nWould it be possible as an alternative approach to get Reachable in line with `-onlynet` expectations (e.g. by moving the `-onlynet` block in init.cpp below the  `-onion` and `-proxy` blocks and also not calling `SetReachable()` from torcontrol if `-onlynet` excludes onions?) Or would there be negative side effects with other callers of `IsReachable()`?",
      "created_at" : "2021-09-01T23:28:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-910893133",
      "id" : 910893133,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842SyBN",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-01T23:30:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910893133",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@prayank23 does the machine have an actual IPv6 connectivity? Do you see successful connections to IPv6 hosts when `-onlynet=` is not used? The text `Network is unreachable` is an actual system error, it does not come from Bitcoin Core.",
      "created_at" : "2021-09-02T08:25:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-911377881",
      "id" : 911377881,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842UoXZ",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-02T08:25:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/911377881",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes it was ipv6 connectivity issue. There were 2 issues: 1. One of my ISP didn't support ipv6 2. Had to change network adapter from NAT to bridged in VM. Checked connectivity on http://test-ipv6.com/\r\n\r\nUpdated logs above as ipv6 works fine. Will test onion-ipv4, onion-ipv6, i2p-ipv4, i2p-ipv6, i2p-onion and ipv6-ipv4 today.",
      "created_at" : "2021-09-02T10:30:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-911511433",
      "id" : 911511433,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842VI-J",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-02T10:30:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/911511433",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@mzumsande, good insight! I think there are two distinct properties of a network:\r\n\r\n1. Whether it is reachable (the current `IsReachable()` function). That is - do we have the means to connect to it if we wanted?\r\n2. Whether we should choose hosts from that network for making automatic outbound connections (`-onlynet=`, or the newly added `OutboundConnectionAllowedTo()` function)\r\n\r\nFor example, a setup like `-onlynet=ipv6 -onion=127.0.0.1:9050` should make the Tor network \"reachable\", but avoid automatically opening connections to it. However, manual connections using `-connect`, `-addnode` and `-seednode` to Tor hosts should be still possible, using the proxy given with `-onion=`. Makes sense?\r\n\r\nYour comments make me think - should we only add addresses to addrman if they are both 1. and 2. (right now it is just 1.)? E.g.\r\n```diff\r\n             // Do not store addresses outside our network\r\n-            if (fReachable)\r\n+            if (fReachable && OutboundConnectionAllowedTo(addr))\r\n                 vAddrOk.push_back(addr);\r\n```\r\nor also limit relay of 1. but not 2. addresses?\r\n\r\nWhat about changing the `limited` property in the `getnetworkinfo` RPC reply?\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/b997dd211ecfe5d0d6f757b8426ad81e40219143/src/rpc/net.cpp#L574-L575",
      "created_at" : "2021-09-02T12:51:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-911645461",
      "id" : 911645461,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842VpsV",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-02T12:51:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/911645461",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I agree with @mzumsande. I find it confusing that we have two functions considering `-onlynet` (see how `vfLimited` is filled with `onlynet`).",
      "created_at" : "2021-09-02T17:09:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-911890961",
      "id" : 911890961,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842WloR",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-02T17:09:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/911890961",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "It tried few combinations with `onlynet` and everything works as expected. Although I am still not sure about trade-offs involved in each of these. Things get even more complicated if user has incoming connections on multiple networks as discussed in IRC: https://www.erisian.com.au/bitcoin-core-dev/log-2021-09-01.html (260 2021-09-01T20:26:30)\r\n\r\nThis PR has limited scope and it does fix the issues with `onlynet` and proxy usage.\r\n\r\nACK https://github.com/bitcoin/bitcoin/pull/22834/commits/0ea0de64385c0150e179885a792d615005e20841\r\n\r\nWill reACK if suggestions discussed above are implemented and functional tests are added:\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/22834#issuecomment-910893133\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/22834#issuecomment-911645461\r\n\r\nAlso not sure why `addpeeraddress` returns `false` in this case: https://bitcoin.stackexchange.com/q/109465/",
      "created_at" : "2021-09-03T11:15:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-912461047",
      "id" : 912461047,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842Ywz3",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-03T11:17:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/912461047",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@mzumsande, @naumenkogs, if we need not make a distinction between 1. and 2. (from https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-911645461), then an alternative approach is possible, similar to the one described above by @mzumsande (but not quite the same).\r\n\r\nWhat do you think about this: https://github.com/vasild/bitcoin/commit/46a9a797f1692bc8ceefea1bee49caba5ca87127? Note that even with that, `IsReachable()` does not represent exactly `-onlynet`.",
      "created_at" : "2021-09-03T16:25:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-912661346",
      "id" : 912661346,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842Zhti",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-03T16:25:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/912661346",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I didn't find a place we would need to make the distinction between the ability (1) and the willingness (2) to make outbound connections to networks. Also the status quo for `IsReachable()` before this PR, despite the name, is a mix of 1. and 2. because it is initially set by `-onlynet` user preference (2) and then possibly overruled based on the means to connect to a network (1):\r\n\r\n>For example, a setup like -onlynet=ipv6 -onion=127.0.0.1:9050 should make the Tor network \"reachable\", but avoid automatically opening connections to it.\r\n\r\nIs this a relevant scenario, i.e. what should be the practical consequence of a network being \"reachable\" in this scenario when we wouldn't do automatic connections to it?\r\n\r\n> However, manual connections using -connect, -addnode and -seednode to Tor hosts should be still possible, using the proxy given with -onion=. Makes sense?\r\n\r\nYes, I agree. As far as I can see, all of the manual connection code is completely independent from `IsReachable`, so this shouldn't be affected by any of the discussed suggestions.\r\n\r\n>Your comments make me think - should we only add addresses to addrman if they are both 1. and 2. (right now it is just 1.)\r\n\r\nI tend to think that this would make sense. I don't see the point of storing addresses in addrman when we won't connect to them - whether this is because we cannot or because we don't want to doesn't seem crucial to me.\r\n\r\n> What do you think about this: vasild@46a9a79? Note that even with that, IsReachable() does not represent exactly -onlynet.\r\n\r\nOn first sight, I like this approach. I don't quite understand why it is possible to just drop the `SetReachable()` in torcontrol.cpp.\r\n\r\nI have been looking into the other call sites of `IsReachable()` besides connection opening and addrman acceptance to see how they would be affected by possible changes:\r\n`IsPeerAddrLocalGood()` and `AddLocal()` both call `IsReachable()` and therefore might be affected. Considering that they deal with the address used for self-advertising (and thus for getting incoming connections) I don't really understand why they make use of `IsReachable()` in the first place. Shouldn't this affect only outbound connection logic?",
      "created_at" : "2021-09-05T21:51:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-913233420",
      "id" : 913233420,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842btYM",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-05T21:51:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/913233420",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-09-06T09:12:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-913485177",
      "id" : 913485177,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842cq15",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-06T09:12:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/913485177",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I didn't find a place we would need to make the distinction between the ability (1) and the willingness (2) to make outbound connections to networks.\r\n\r\nThe only one I can think of is this - it would be strange to display onion as not reachable in `getnetworkinfo` RPC, but to be able to open manual connections to it using `addnode`.\r\n\r\n> Also the status quo for `IsReachable()` before this PR, despite the name, is a mix of 1. and 2. because it is initially set by `-onlynet` user preference (2) and then possibly overruled based on the means to connect to a network (1):\r\n\r\nYes.\r\n\r\n> > For example, a setup like -onlynet=ipv6 -onion=127.0.0.1:9050 should make the Tor network \"reachable\", but avoid automatically opening connections to it.\r\n> \r\n> Is this a relevant scenario, i.e. what should be the practical consequence of a network being \"reachable\" in this scenario when we wouldn't do automatic connections to it?\r\n\r\nIt would be possible to reach the network by opening a manual connection. I am not sure if this is \"relevant\". Maybe it is exotic use case.\r\n \r\n> > What do you think about this: [vasild/bitcoin@46a9a79](https://github.com/vasild/bitcoin/commit/46a9a79)? Note that even with that, IsReachable() does not represent exactly -onlynet.\r\n> \r\n> On first sight, I like this approach. I don't quite understand why it is possible to just drop the `SetReachable()` in torcontrol.cpp.\r\n\r\nHmm, maybe that is not a good idea - if `-torcontrol=... -torpassword=...` are given (without any of `-onlynet`, `-proxy` or `-onion`) then that code would have flipped the Tor network from not reachable to reachable. Is this desirable? If yes, then instead of removing `SetReachable()` from `torcontrol.cpp` it should be made conditional: `if (!onion_restricted) {`. However that variable `onion_restricted` is local in `init.cpp` so it would either have to be made global (:disappointed:) or `OutboundConnectionAllowedTo()` used instead of it. But we are looking into that potentially more invasive patch only because the co-existence of `IsReachable()` and `OutboundConnectionAllowedTo()` is confusing...\r\n\r\n> `IsPeerAddrLocalGood()` and `AddLocal()` both call `IsReachable()` and therefore might be affected. Considering that they deal with the address used for self-advertising (and thus for getting incoming connections) I don't really understand why they make use of `IsReachable()` in the first place. Shouldn't this affect only outbound connection logic?\r\n\r\nI think the logic is this - if a network is not reachable then we cannot accept connections from it. \"Reachable\" in the broader English word meaning, not the stricter `-onlynet` meaning. For example, a host/OS may have support for both IPv4 and IPv6 but its ISP may only support IPv4. So, an operator would run `-onlynet=ipv4` to avoid attempting connections to IPv6 hosts and from advertising an IPv6 address to which the rest of the world cannot connect.",
      "created_at" : "2021-09-07T12:34:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-914265670",
      "id" : 914265670,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5842fpZG",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-07T12:34:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/914265670",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22834#discussion_r712524563"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22834"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712524563"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This seems fragile. Can we guarantee `onlynets` is initialised only after the config files get loaded?\r\n\r\nAt the very least, I think it should be tested.",
      "commit_id" : "0ea0de64385c0150e179885a792d615005e20841",
      "created_at" : "2021-09-20T21:23:57Z",
      "diff_hunk" : "@@ -113,6 +114,30 @@ std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(cs_mapLocalHost);\n static bool vfLimited[NET_MAX] GUARDED_BY(cs_mapLocalHost) = {};\n std::string strSubVersion;\n \n+/**\n+ * Check if making an automatic outbound connection to the given address is allowed.\n+ * Could be restricted by the `-onlynet` configuration option.\n+ * @return true if allowed\n+ */\n+static bool OutboundConnectionAllowedTo(const CNetAddr& addr)\n+{\n+    static const std::unordered_set<Network> onlynets = [](){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#discussion_r712524563",
      "id" : 712524563,
      "line" : 124,
      "node_id" : "PRRC_kwDOABII584qeEMT",
      "original_commit_id" : "0ea0de64385c0150e179885a792d615005e20841",
      "original_line" : 124,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 19,
      "pull_request_review_id" : 759110568,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22834",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-20T21:24:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712524563",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-11-01T04:38:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#issuecomment-955924074",
      "id" : 955924074,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22834",
      "node_id" : "IC_kwDOABII5844-j5q",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/955924074/reactions"
      },
      "updated_at" : "2021-11-01T04:38:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/955924074",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22834#discussion_r744517063"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22834"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/744517063"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, I also strongly prefer initialization to be done explicitly in an explicit order. This code belongs in one of the `Init` functions, or called from there. We've historiically had many initialization bugs due to hidden gotchas like this.",
      "commit_id" : "0ea0de64385c0150e179885a792d615005e20841",
      "created_at" : "2021-11-08T08:57:22Z",
      "diff_hunk" : "@@ -113,6 +114,30 @@ std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(cs_mapLocalHost);\n static bool vfLimited[NET_MAX] GUARDED_BY(cs_mapLocalHost) = {};\n std::string strSubVersion;\n \n+/**\n+ * Check if making an automatic outbound connection to the given address is allowed.\n+ * Could be restricted by the `-onlynet` configuration option.\n+ * @return true if allowed\n+ */\n+static bool OutboundConnectionAllowedTo(const CNetAddr& addr)\n+{\n+    static const std::unordered_set<Network> onlynets = [](){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22834#discussion_r744517063",
      "id" : 744517063,
      "in_reply_to_id" : 712524563,
      "line" : 124,
      "node_id" : "PRRC_kwDOABII584sYG3H",
      "original_commit_id" : "0ea0de64385c0150e179885a792d615005e20841",
      "original_line" : 124,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 19,
      "pull_request_review_id" : 799837306,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22834",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/744517063/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-08T08:57:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/744517063",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
