[
   {
      "body" : "You sure this will increase performance? In practice, aren't header chains likely to be just a few blocks long?\r\n\r\nIf N is typically smaller than a few dozen I'd expect the simpler iterate-prev-pointers (and smaller, more cache-friendly CBlockIndex) to outperform any more complicated code.",
      "created_at" : "2014-06-26T19:06:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4420#issuecomment-47266235",
      "id" : 47266235,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4420",
      "updated_at" : "2014-06-26T19:06:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/47266235",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "Within minutes after starting IBD you'll have a header chain 300000 long, with a few 1000 long blockchain.",
      "created_at" : "2014-06-26T19:09:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4420#issuecomment-47266642",
      "id" : 47266642,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4420",
      "updated_at" : "2014-06-26T19:09:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/47266642",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Anyway, I'm fine with waiting with this, and developing the code that uses it in parallel.\r\n\r\nJust trying to cut it up in nice indidvidually-reviewable pieces.",
      "created_at" : "2014-06-26T19:10:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4420#issuecomment-47266776",
      "id" : 47266776,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4420",
      "updated_at" : "2014-06-26T19:10:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/47266776",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Code changes look good to me.\r\n\r\nThis needs a unit test for BuildSkip/GetAncestor.",
      "created_at" : "2014-06-29T08:17:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4420#issuecomment-47448544",
      "id" : 47448544,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4420",
      "updated_at" : "2014-06-29T08:17:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/47448544",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Added a unit test.",
      "created_at" : "2014-06-29T13:37:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4420#issuecomment-47454769",
      "id" : 47454769,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4420",
      "updated_at" : "2014-06-29T13:37:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/47454769",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Including #4407 in this, so I don't need to maintain two independent branches and merge them for successor pull requests.",
      "created_at" : "2014-06-29T19:53:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4420#issuecomment-47471540",
      "id" : 47471540,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4420",
      "updated_at" : "2014-06-29T20:03:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/47471540",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/p4420_236982c2b6de619f0744c9c17ea7208b64a4afb3/ for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.",
      "created_at" : "2014-06-29T20:24:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4420#issuecomment-47473489",
      "id" : 47473489,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4420",
      "updated_at" : "2014-06-29T20:24:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/47473489",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "body" : "@gavinandresen Just so there's no misunderstanding: currently this pull has nearly no benefit; I use the new functions where possible because they improve some worst case time and to give the code exposure, but it hardly matters for the current use sites.\r\n\r\nThe reason for adding is that in a successor patch I need it for finding the next blocks to fetch from a peer (which has a known tip), and there is no pnext pointer as different peers may have different ones. Alternatives are either:\r\n* Building a CChain for each peer with their known blocks (which adds a few megabytes, and takes time to build); O(nBlocks * nPeers) memory cost but O(1) access cost.\r\n* Not building any index structure, and walk back from the tip for each block to be requested, which means O(300000) iterations for every block during early IBD. 0 memory cost, but O(nBlocks) access cost.\r\n\r\nA skiplist adds a O(nBlocks) memory cost, but O(log nBlocks) worst-case access cost, which seems a nice compromise.",
      "created_at" : "2014-06-29T20:25:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4420#issuecomment-47473524",
      "id" : 47473524,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4420",
      "updated_at" : "2014-06-29T20:29:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/47473524",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Ok: code-reviewed-but-untested ACK.",
      "created_at" : "2014-06-30T12:21:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4420#issuecomment-47524803",
      "id" : 47524803,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4420",
      "updated_at" : "2014-06-30T12:21:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/47524803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   }
]
