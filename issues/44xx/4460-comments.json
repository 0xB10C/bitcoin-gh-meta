[
   {
      "body" : "Uh. If you remove it from the AlreadyAskedFor map and we rejected it, we'll potentially end up requesting it again from the same peer.  Or am I missing something there?",
      "created_at" : "2014-07-16T03:39:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4460#issuecomment-49120448",
      "id" : 49120448,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4460",
      "updated_at" : "2014-07-16T03:40:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/49120448",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "There is actually nothing in place to prevent re-asking for an invalid tx every time an inv is received for it; that's actually the cause of ongoing spurious DoS bans. I have proposed #4542 to address this.",
      "created_at" : "2014-07-16T09:40:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4460#issuecomment-49142535",
      "id" : 49142535,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4460",
      "updated_at" : "2014-07-16T10:59:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/49142535",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1047859?v=3",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "body" : "Ooh.. Nice work with #4542 - have been waiting for something like this for a while.\r\n\r\n@gmaxwell Bear in mind that \"AlreadyAskedFor\" is a misleading name. Read it as \"WaitingFor\" instead.\r\n\r\nPS. rebased",
      "created_at" : "2014-07-16T10:59:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4460#issuecomment-49150404",
      "id" : 49150404,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4460",
      "updated_at" : "2014-07-16T11:01:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/49150404",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "@rebroad mapAlreadyAskedFor is what prevents asking additional peers for the same tx before it meets the AlreadyHave criteria. AlreadyHave doesn't currently return true if the tx is not an orphan but is rejected from the mempool; so as it stands, rejected tx must not be removed from the map since they are never included in AlreadyHave. #4542 would make this PR work.",
      "created_at" : "2014-07-16T11:03:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4460#issuecomment-49150779",
      "id" : 49150779,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4460",
      "updated_at" : "2014-07-16T11:03:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/49150779",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1047859?v=3",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/p4460_604ee2aa7d110439b4e59ecaa272b85ec41ab6a0/ for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.",
      "created_at" : "2014-07-16T11:44:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4460#issuecomment-49154050",
      "id" : 49154050,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4460",
      "updated_at" : "2014-07-16T11:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/49154050",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "body" : "@rebroad This makes a lot of sense. Currently, entries of mapAlreadyAskedFor linger there forever if the transaction is invalid. Removing them when the requested data arrives is the correct thing to do.\r\n\r\nThe task of mapAlreadyAskedFor was never to make sure that we don't request anything again. It just keeps track of a timestamp for retries. Indeed, the name is misleading.\r\n\r\n(so this is part of the functionality of requesting a piece of data; the decision of whether to request something in the first place needs to be made somewhere else, #4542 makes sense there)\r\n\r\nTested ACK.\r\n",
      "created_at" : "2014-09-02T15:28:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4460#issuecomment-54169065",
      "id" : 54169065,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4460",
      "updated_at" : "2014-09-02T15:29:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/54169065",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj #1341 was raised a while back due to the misleading name of this, and the potential bugs that could be introduced due to thinking it's function was something other than what it is...",
      "created_at" : "2014-09-17T15:15:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4460#issuecomment-55909240",
      "id" : 55909240,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4460",
      "updated_at" : "2014-09-17T15:15:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/55909240",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "I've merged this as a temporary fix until #4831 can be merged, which gets rid of that data structure entirely.\r\n",
      "created_at" : "2014-09-18T07:19:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4460#issuecomment-56003295",
      "id" : 56003295,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4460",
      "updated_at" : "2014-09-18T07:19:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/56003295",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
