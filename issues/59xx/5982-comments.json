[
   {
      "body" : "Yep I agree this would be good; I'll think about this for a bit and likely come back to you with a few questions...",
      "created_at" : "2015-04-08T13:52:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/5982#issuecomment-90923398",
      "id" : 90923398,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5982",
      "updated_at" : "2015-04-08T13:52:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/90923398",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "For negotiating headers versus inv's, I guess the method that occurs to me is to bump the protocol version number, is that what you had in mind?\r\n\r\nIt seems to me that the chief problem to solve is making sure that when we send headers to a peer, they will be accepted -- not rejected because of a missing prior header.  As I understand the code, none of the state we're currently keeping would tell us what headers a given peer has already seen.  The approach I'm working on now would be to start keeping track of the last header we've sent a peer, and combine that with pindexBestKnownBlock (best block that the peer has announced to us) to estimate our peer's best header.  Then, in the places where we currently inv a block, I'd send headers to the peer, the range of which I'd calculate by starting at the block being inv'ed, and walking back until I either get to the last header I've sent that peer (pindexLastHeaderSent), or pindexBestKnownBlock, or an ancestor of either (ie in the event of a reorg).\r\n\r\nAnd I was also thinking that in the event that either pindexBestKnownBlock & pindexLastHeaderSent are both NULL or that the above algorithm would generate a too-long headers chain (not sure what value to use here, maybe only be willing to send up to 8 or 16 headers or something?), I'd revert to just sending an inv, and letting the peer figure out what to do.  If we let that value be too large, then a node doing initial block download would be inundated with headers from all its peers if a block is announced during the download, which seems undesirable.  On the other hand, I want it to not be so small as to be useless during a reorg.\r\n\r\nAny thoughts on this approach?",
      "created_at" : "2015-04-10T23:49:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/5982#issuecomment-91720559",
      "id" : 91720559,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5982",
      "updated_at" : "2015-04-10T23:49:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/91720559",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   }
]
