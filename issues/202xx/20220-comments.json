[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r510322471"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510322471"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This action is performed in `SetFeeEstimateMode()` and calling it in bumpfee beforehand appears to cause an error when explicit feerates are used (issue #20219).",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-22T17:06:14Z",
      "diff_hunk" : "@@ -3461,7 +3461,6 @@ static RPCHelpMan bumpfee_helper(std::string method_name)\n             if (options.exists(\"fee_rate\")) {\n                 throw JSONRPCError(RPC_INVALID_PARAMETER, \"conf_target can't be set with fee_rate. Please provide either a confirmation target in blocks for automatic fee estimation, or an explicit fee rate.\");\n             }\n-            coin_control.m_confirm_target = ParseConfirmTarget(conf_target, pwallet->chain().estimateMaxBlocks());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r510322471",
      "id" : 510322471,
      "line" : 3464,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMyMjQ3MQ==",
      "original_commit_id" : "59222c6e22349b26baebd707a7174848130c653f",
      "original_line" : 3464,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 61,
      "pull_request_review_id" : 514943224,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T10:55:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510322471",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r510364623"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510364623"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixup requested in https://github.com/bitcoin/bitcoin/pull/19200#discussion_r438781980.",
      "commit_id" : "b04e7bb270db73c8398067a1fc64bf667560b67e",
      "created_at" : "2020-10-22T18:16:32Z",
      "diff_hunk" : "@@ -3785,8 +3788,9 @@ RPCHelpMan getaddressinfo()\n                         {RPCResult::Type::STR_HEX, \"pubkey\", /* optional */ true, \"The hex value of the raw public key for single-key addresses (possibly embedded in P2SH or P2WSH).\"},\n                         {RPCResult::Type::OBJ, \"embedded\", /* optional */ true, \"Information about the address embedded in P2SH or P2WSH, if relevant and known.\",\n                         {\n-                            {RPCResult::Type::ELISION, \"\", \"Includes all getaddressinfo output fields for the embedded address, excluding metadata (timestamp, hdkeypath, hdseedid)\\n\"\n-                            \"and relation to the wallet (ismine, iswatchonly).\"},\n+                            {RPCResult::Type::ELISION, \"\",\n+                                    \"Includes all getaddressinfo output fields for the embedded address, excluding metadata (timestamp,\\n\"\n+                                    \"hdkeypath, hdseedid) and relation to the wallet (ismine, iswatchonly).\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r510364623",
      "id" : 510364623,
      "line" : 3793,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDM2NDYyMw==",
      "original_commit_id" : "b04e7bb270db73c8398067a1fc64bf667560b67e",
      "original_line" : 3793,
      "original_position" : 79,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 79,
      "pull_request_review_id" : 514998455,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-22T18:16:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510364623",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Pushed a few improvements. Should be ready for review.",
      "created_at" : "2020-10-23T10:57:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#issuecomment-715268966",
      "id" : 715268966,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNTI2ODk2Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-23T10:57:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/715268966",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511134364"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511134364"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Isn't the `BTC_MODE then essentially a duplicate of the `{\"fee_rate\": â¦}` option?",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T20:13:59Z",
      "diff_hunk" : "@@ -132,6 +134,13 @@ def test_simple_bumpfee_succeeds(self, mode, rbf_node, peer_node, dest_address):\n     if mode == \"fee_rate\":\n         bumped_psbt = rbf_node.psbtbumpfee(rbfid, {\"fee_rate\": NORMAL})\n         bumped_tx = rbf_node.bumpfee(rbfid, {\"fee_rate\": NORMAL})\n+    elif mode == BTC_MODE:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511134364",
      "id" : 511134364,
      "line" : 163,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTEzNDM2NA==",
      "original_commit_id" : "995dd4a6e7c21665472e71d7aac0251f379e3420",
      "original_line" : 137,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "test/functional/wallet_bumpfee.py",
      "position" : 114,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511134364",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511135422"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511135422"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't understand this change. Is this not referring to the \"fee_rate\" argument below?",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T20:16:29Z",
      "diff_hunk" : "@@ -168,24 +168,54 @@ def test_simple_bumpfee_succeeds(self, mode, rbf_node, peer_node, dest_address):\n \n \n def test_feerate_args(self, rbf_node, peer_node, dest_address):\n-    self.log.info('Test fee_rate args')\n+    self.log.info('Test feerate args')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511135422",
      "id" : 511135422,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTEzNTQyMg==",
      "original_commit_id" : "70b793c2b3b91b012316292cd87a093871dd714a",
      "original_line" : 171,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/wallet_bumpfee.py",
      "position" : null,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511135422",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511136927"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511136927"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "So much clearer! :+1: ",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T20:20:13Z",
      "diff_hunk" : "@@ -3459,7 +3459,7 @@ static RPCHelpMan bumpfee_helper(std::string method_name)\n \n         if (!conf_target.isNull()) {\n             if (options.exists(\"fee_rate\")) {\n-                throw JSONRPCError(RPC_INVALID_PARAMETER, \"conf_target can't be set with fee_rate. Please provide either a confirmation target in blocks for automatic fee estimation, or an explicit fee rate.\");\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, \"Cannot specify both conf_target and fee_rate. Please provide either a confirmation target in blocks for automatic fee estimation, or an explicit fee rate.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511136927",
      "id" : 511136927,
      "line" : 3466,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTEzNjkyNw==",
      "original_commit_id" : "70b793c2b3b91b012316292cd87a093871dd714a",
      "original_line" : 3462,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 59,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511136927",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511139081"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511139081"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Style nit: line 183 uses \"feerate\", 184 uses \"fee rate\". I'd prefer \"feerate\" per Optech style guide, but if the error message currently is \"fee rate\", it might be nicer to keep it homogeneous.",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T20:25:22Z",
      "diff_hunk" : "@@ -168,24 +168,54 @@ def test_simple_bumpfee_succeeds(self, mode, rbf_node, peer_node, dest_address):\n \n \n def test_feerate_args(self, rbf_node, peer_node, dest_address):\n-    self.log.info('Test fee_rate args')\n+    self.log.info('Test feerate args')\n     rbfid = spend_one_input(rbf_node, dest_address)\n     self.sync_mempools((rbf_node, peer_node))\n     assert rbfid in rbf_node.getrawmempool() and rbfid in peer_node.getrawmempool()\n \n-    assert_raises_rpc_error(-8, \"conf_target can't be set with fee_rate. Please provide either a confirmation target in blocks for automatic fee estimation, or an explicit fee rate.\", rbf_node.bumpfee, rbfid, {\"fee_rate\": NORMAL, \"confTarget\": 1})\n-\n     assert_raises_rpc_error(-3, \"Unexpected key totalFee\", rbf_node.bumpfee, rbfid, {\"totalFee\": NORMAL})\n-    assert_raises_rpc_error(-8, \"conf_target can't be set with fee_rate. Please provide either a confirmation target in blocks for automatic fee estimation, or an explicit fee rate.\", rbf_node.bumpfee, rbfid, {\"fee_rate\":0.00001, \"confTarget\": 1})\n \n     # Bumping to just above minrelay should fail to increase total fee enough, at least\n     assert_raises_rpc_error(-8, \"Insufficient total fee\", rbf_node.bumpfee, rbfid, {\"fee_rate\": INSUFFICIENT})\n-\n     assert_raises_rpc_error(-3, \"Amount out of range\", rbf_node.bumpfee, rbfid, {\"fee_rate\": -1})\n-\n     assert_raises_rpc_error(-4, \"is too high (cannot be higher than\", rbf_node.bumpfee, rbfid, {\"fee_rate\": TOO_HIGH})\n-    self.clear_mempool()\n \n+    self.log.info(\"Test explicit feerate raises RPC error if estimate_mode is passed without a conf_target\")\n+    assert_raises_rpc_error(-8, \"Selected estimate_mode requires a fee rate\", rbf_node.bumpfee, rbfid, {\"fee_rate\": NORMAL, \"estimate_mode\": BTC_MODE})",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511139081",
      "id" : 511139081,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTEzOTA4MQ==",
      "original_commit_id" : "70b793c2b3b91b012316292cd87a093871dd714a",
      "original_line" : 184,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "test/functional/wallet_bumpfee.py",
      "position" : null,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511139081",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511142032"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511142032"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That's an odd name clash, that the error complains about the missing \"fee rate\", but it's actually `conf_target` that's missing. I assume that was part of the items that #19543 was meant to address?",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T20:32:37Z",
      "diff_hunk" : "@@ -168,24 +168,54 @@ def test_simple_bumpfee_succeeds(self, mode, rbf_node, peer_node, dest_address):\n \n \n def test_feerate_args(self, rbf_node, peer_node, dest_address):\n-    self.log.info('Test fee_rate args')\n+    self.log.info('Test feerate args')\n     rbfid = spend_one_input(rbf_node, dest_address)\n     self.sync_mempools((rbf_node, peer_node))\n     assert rbfid in rbf_node.getrawmempool() and rbfid in peer_node.getrawmempool()\n \n-    assert_raises_rpc_error(-8, \"conf_target can't be set with fee_rate. Please provide either a confirmation target in blocks for automatic fee estimation, or an explicit fee rate.\", rbf_node.bumpfee, rbfid, {\"fee_rate\": NORMAL, \"confTarget\": 1})\n-\n     assert_raises_rpc_error(-3, \"Unexpected key totalFee\", rbf_node.bumpfee, rbfid, {\"totalFee\": NORMAL})\n-    assert_raises_rpc_error(-8, \"conf_target can't be set with fee_rate. Please provide either a confirmation target in blocks for automatic fee estimation, or an explicit fee rate.\", rbf_node.bumpfee, rbfid, {\"fee_rate\":0.00001, \"confTarget\": 1})\n \n     # Bumping to just above minrelay should fail to increase total fee enough, at least\n     assert_raises_rpc_error(-8, \"Insufficient total fee\", rbf_node.bumpfee, rbfid, {\"fee_rate\": INSUFFICIENT})\n-\n     assert_raises_rpc_error(-3, \"Amount out of range\", rbf_node.bumpfee, rbfid, {\"fee_rate\": -1})\n-\n     assert_raises_rpc_error(-4, \"is too high (cannot be higher than\", rbf_node.bumpfee, rbfid, {\"fee_rate\": TOO_HIGH})\n-    self.clear_mempool()\n \n+    self.log.info(\"Test explicit feerate raises RPC error if estimate_mode is passed without a conf_target\")\n+    assert_raises_rpc_error(-8, \"Selected estimate_mode requires a fee rate\", rbf_node.bumpfee, rbfid, {\"fee_rate\": NORMAL, \"estimate_mode\": BTC_MODE})\n+    assert_raises_rpc_error(-8, \"Selected estimate_mode requires a fee rate\", rbf_node.bumpfee, rbfid, {\"fee_rate\": 10, \"estimate_mode\": SAT_MODE})",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511142032",
      "id" : 511142032,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE0MjAzMg==",
      "original_commit_id" : "70b793c2b3b91b012316292cd87a093871dd714a",
      "original_line" : 185,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "test/functional/wallet_bumpfee.py",
      "position" : null,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511142032",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511143512"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511143512"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Okay, I guess this is a prime example of what is meant to get addressed in #19543. `conf_target` actually being a feerate is fairly icky.",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T20:36:15Z",
      "diff_hunk" : "@@ -168,24 +168,54 @@ def test_simple_bumpfee_succeeds(self, mode, rbf_node, peer_node, dest_address):\n \n \n def test_feerate_args(self, rbf_node, peer_node, dest_address):\n-    self.log.info('Test fee_rate args')\n+    self.log.info('Test feerate args')\n     rbfid = spend_one_input(rbf_node, dest_address)\n     self.sync_mempools((rbf_node, peer_node))\n     assert rbfid in rbf_node.getrawmempool() and rbfid in peer_node.getrawmempool()\n \n-    assert_raises_rpc_error(-8, \"conf_target can't be set with fee_rate. Please provide either a confirmation target in blocks for automatic fee estimation, or an explicit fee rate.\", rbf_node.bumpfee, rbfid, {\"fee_rate\": NORMAL, \"confTarget\": 1})\n-\n     assert_raises_rpc_error(-3, \"Unexpected key totalFee\", rbf_node.bumpfee, rbfid, {\"totalFee\": NORMAL})\n-    assert_raises_rpc_error(-8, \"conf_target can't be set with fee_rate. Please provide either a confirmation target in blocks for automatic fee estimation, or an explicit fee rate.\", rbf_node.bumpfee, rbfid, {\"fee_rate\":0.00001, \"confTarget\": 1})\n \n     # Bumping to just above minrelay should fail to increase total fee enough, at least\n     assert_raises_rpc_error(-8, \"Insufficient total fee\", rbf_node.bumpfee, rbfid, {\"fee_rate\": INSUFFICIENT})\n-\n     assert_raises_rpc_error(-3, \"Amount out of range\", rbf_node.bumpfee, rbfid, {\"fee_rate\": -1})\n-\n     assert_raises_rpc_error(-4, \"is too high (cannot be higher than\", rbf_node.bumpfee, rbfid, {\"fee_rate\": TOO_HIGH})\n-    self.clear_mempool()\n \n+    self.log.info(\"Test explicit feerate raises RPC error if estimate_mode is passed without a conf_target\")\n+    assert_raises_rpc_error(-8, \"Selected estimate_mode requires a fee rate\", rbf_node.bumpfee, rbfid, {\"fee_rate\": NORMAL, \"estimate_mode\": BTC_MODE})\n+    assert_raises_rpc_error(-8, \"Selected estimate_mode requires a fee rate\", rbf_node.bumpfee, rbfid, {\"fee_rate\": 10, \"estimate_mode\": SAT_MODE})\n+\n+    self.log.info(\"Test explicit feerate raises RPC error if both fee_rate and conf_target are passed\")\n+    msg = \"Cannot specify both conf_target and fee_rate. Please provide either a confirmation \" \\\n+          \"target in blocks for automatic fee estimation, or an explicit fee rate.\"\n+    assert_raises_rpc_error(-8, msg, rbf_node.bumpfee, rbfid, {\"conf_target\": NORMAL, \"fee_rate\": NORMAL})",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511143512",
      "id" : 511143512,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE0MzUxMg==",
      "original_commit_id" : "70b793c2b3b91b012316292cd87a093871dd714a",
      "original_line" : 190,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "test/functional/wallet_bumpfee.py",
      "position" : null,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511143512",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511145359"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511145359"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: `msg` is a bit unspecific. Could be for example `msg_both` or `error_both`",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T20:40:58Z",
      "diff_hunk" : "@@ -168,24 +168,54 @@ def test_simple_bumpfee_succeeds(self, mode, rbf_node, peer_node, dest_address):\n \n \n def test_feerate_args(self, rbf_node, peer_node, dest_address):\n-    self.log.info('Test fee_rate args')\n+    self.log.info('Test feerate args')\n     rbfid = spend_one_input(rbf_node, dest_address)\n     self.sync_mempools((rbf_node, peer_node))\n     assert rbfid in rbf_node.getrawmempool() and rbfid in peer_node.getrawmempool()\n \n-    assert_raises_rpc_error(-8, \"conf_target can't be set with fee_rate. Please provide either a confirmation target in blocks for automatic fee estimation, or an explicit fee rate.\", rbf_node.bumpfee, rbfid, {\"fee_rate\": NORMAL, \"confTarget\": 1})\n-\n     assert_raises_rpc_error(-3, \"Unexpected key totalFee\", rbf_node.bumpfee, rbfid, {\"totalFee\": NORMAL})\n-    assert_raises_rpc_error(-8, \"conf_target can't be set with fee_rate. Please provide either a confirmation target in blocks for automatic fee estimation, or an explicit fee rate.\", rbf_node.bumpfee, rbfid, {\"fee_rate\":0.00001, \"confTarget\": 1})\n \n     # Bumping to just above minrelay should fail to increase total fee enough, at least\n     assert_raises_rpc_error(-8, \"Insufficient total fee\", rbf_node.bumpfee, rbfid, {\"fee_rate\": INSUFFICIENT})\n-\n     assert_raises_rpc_error(-3, \"Amount out of range\", rbf_node.bumpfee, rbfid, {\"fee_rate\": -1})\n-\n     assert_raises_rpc_error(-4, \"is too high (cannot be higher than\", rbf_node.bumpfee, rbfid, {\"fee_rate\": TOO_HIGH})\n-    self.clear_mempool()\n \n+    self.log.info(\"Test explicit feerate raises RPC error if estimate_mode is passed without a conf_target\")\n+    assert_raises_rpc_error(-8, \"Selected estimate_mode requires a fee rate\", rbf_node.bumpfee, rbfid, {\"fee_rate\": NORMAL, \"estimate_mode\": BTC_MODE})\n+    assert_raises_rpc_error(-8, \"Selected estimate_mode requires a fee rate\", rbf_node.bumpfee, rbfid, {\"fee_rate\": 10, \"estimate_mode\": SAT_MODE})\n+\n+    self.log.info(\"Test explicit feerate raises RPC error if both fee_rate and conf_target are passed\")\n+    msg = \"Cannot specify both conf_target and fee_rate. Please provide either a confirmation \" \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511145359",
      "id" : 511145359,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE0NTM1OQ==",
      "original_commit_id" : "70b793c2b3b91b012316292cd87a093871dd714a",
      "original_line" : 188,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "test/functional/wallet_bumpfee.py",
      "position" : null,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511145359",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511146854"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511146854"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Potential missing test case: what would happen if we specified something lower than `minRelayTxFeerate` here?",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T20:44:29Z",
      "diff_hunk" : "@@ -168,24 +168,54 @@ def test_simple_bumpfee_succeeds(self, mode, rbf_node, peer_node, dest_address):\n \n \n def test_feerate_args(self, rbf_node, peer_node, dest_address):\n-    self.log.info('Test fee_rate args')\n+    self.log.info('Test feerate args')\n     rbfid = spend_one_input(rbf_node, dest_address)\n     self.sync_mempools((rbf_node, peer_node))\n     assert rbfid in rbf_node.getrawmempool() and rbfid in peer_node.getrawmempool()\n \n-    assert_raises_rpc_error(-8, \"conf_target can't be set with fee_rate. Please provide either a confirmation target in blocks for automatic fee estimation, or an explicit fee rate.\", rbf_node.bumpfee, rbfid, {\"fee_rate\": NORMAL, \"confTarget\": 1})\n-\n     assert_raises_rpc_error(-3, \"Unexpected key totalFee\", rbf_node.bumpfee, rbfid, {\"totalFee\": NORMAL})\n-    assert_raises_rpc_error(-8, \"conf_target can't be set with fee_rate. Please provide either a confirmation target in blocks for automatic fee estimation, or an explicit fee rate.\", rbf_node.bumpfee, rbfid, {\"fee_rate\":0.00001, \"confTarget\": 1})\n \n     # Bumping to just above minrelay should fail to increase total fee enough, at least\n     assert_raises_rpc_error(-8, \"Insufficient total fee\", rbf_node.bumpfee, rbfid, {\"fee_rate\": INSUFFICIENT})\n-\n     assert_raises_rpc_error(-3, \"Amount out of range\", rbf_node.bumpfee, rbfid, {\"fee_rate\": -1})\n-\n     assert_raises_rpc_error(-4, \"is too high (cannot be higher than\", rbf_node.bumpfee, rbfid, {\"fee_rate\": TOO_HIGH})\n-    self.clear_mempool()\n \n+    self.log.info(\"Test explicit feerate raises RPC error if estimate_mode is passed without a conf_target\")\n+    assert_raises_rpc_error(-8, \"Selected estimate_mode requires a fee rate\", rbf_node.bumpfee, rbfid, {\"fee_rate\": NORMAL, \"estimate_mode\": BTC_MODE})\n+    assert_raises_rpc_error(-8, \"Selected estimate_mode requires a fee rate\", rbf_node.bumpfee, rbfid, {\"fee_rate\": 10, \"estimate_mode\": SAT_MODE})\n+\n+    self.log.info(\"Test explicit feerate raises RPC error if both fee_rate and conf_target are passed\")\n+    msg = \"Cannot specify both conf_target and fee_rate. Please provide either a confirmation \" \\\n+          \"target in blocks for automatic fee estimation, or an explicit fee rate.\"\n+    assert_raises_rpc_error(-8, msg, rbf_node.bumpfee, rbfid, {\"conf_target\": NORMAL, \"fee_rate\": NORMAL})\n+\n+    self.log.info(\"Test invalid conf_target settings\")\n+    for field in [\"confTarget\", \"conf_target\"]:\n+        assert_raises_rpc_error(-8, msg, rbf_node.bumpfee, rbfid, {field: 1, \"fee_rate\": NORMAL})\n+    too_high = \"is too high (cannot be higher than -maxtxfee\"\n+    assert_raises_rpc_error(-4, too_high, lambda: rbf_node.bumpfee(rbfid, {\"estimate_mode\": BTC_MODE, \"conf_target\": 2009}))\n+    assert_raises_rpc_error(-4, too_high, lambda: rbf_node.bumpfee(rbfid, {\"estimate_mode\": SAT_MODE, \"conf_target\": 2009 * 10000}))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511146854",
      "id" : 511146854,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE0Njg1NA==",
      "original_commit_id" : "70b793c2b3b91b012316292cd87a093871dd714a",
      "original_line" : 197,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/wallet_bumpfee.py",
      "position" : null,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511146854",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511148504"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511148504"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "TIL how to iterate through a dictionary in python. :)",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T20:48:31Z",
      "diff_hunk" : "@@ -168,24 +168,54 @@ def test_simple_bumpfee_succeeds(self, mode, rbf_node, peer_node, dest_address):\n \n \n def test_feerate_args(self, rbf_node, peer_node, dest_address):\n-    self.log.info('Test fee_rate args')\n+    self.log.info('Test feerate args')\n     rbfid = spend_one_input(rbf_node, dest_address)\n     self.sync_mempools((rbf_node, peer_node))\n     assert rbfid in rbf_node.getrawmempool() and rbfid in peer_node.getrawmempool()\n \n-    assert_raises_rpc_error(-8, \"conf_target can't be set with fee_rate. Please provide either a confirmation target in blocks for automatic fee estimation, or an explicit fee rate.\", rbf_node.bumpfee, rbfid, {\"fee_rate\": NORMAL, \"confTarget\": 1})\n-\n     assert_raises_rpc_error(-3, \"Unexpected key totalFee\", rbf_node.bumpfee, rbfid, {\"totalFee\": NORMAL})\n-    assert_raises_rpc_error(-8, \"conf_target can't be set with fee_rate. Please provide either a confirmation target in blocks for automatic fee estimation, or an explicit fee rate.\", rbf_node.bumpfee, rbfid, {\"fee_rate\":0.00001, \"confTarget\": 1})\n \n     # Bumping to just above minrelay should fail to increase total fee enough, at least\n     assert_raises_rpc_error(-8, \"Insufficient total fee\", rbf_node.bumpfee, rbfid, {\"fee_rate\": INSUFFICIENT})\n-\n     assert_raises_rpc_error(-3, \"Amount out of range\", rbf_node.bumpfee, rbfid, {\"fee_rate\": -1})\n-\n     assert_raises_rpc_error(-4, \"is too high (cannot be higher than\", rbf_node.bumpfee, rbfid, {\"fee_rate\": TOO_HIGH})\n-    self.clear_mempool()\n \n+    self.log.info(\"Test explicit feerate raises RPC error if estimate_mode is passed without a conf_target\")\n+    assert_raises_rpc_error(-8, \"Selected estimate_mode requires a fee rate\", rbf_node.bumpfee, rbfid, {\"fee_rate\": NORMAL, \"estimate_mode\": BTC_MODE})\n+    assert_raises_rpc_error(-8, \"Selected estimate_mode requires a fee rate\", rbf_node.bumpfee, rbfid, {\"fee_rate\": 10, \"estimate_mode\": SAT_MODE})\n+\n+    self.log.info(\"Test explicit feerate raises RPC error if both fee_rate and conf_target are passed\")\n+    msg = \"Cannot specify both conf_target and fee_rate. Please provide either a confirmation \" \\\n+          \"target in blocks for automatic fee estimation, or an explicit fee rate.\"\n+    assert_raises_rpc_error(-8, msg, rbf_node.bumpfee, rbfid, {\"conf_target\": NORMAL, \"fee_rate\": NORMAL})\n+\n+    self.log.info(\"Test invalid conf_target settings\")\n+    for field in [\"confTarget\", \"conf_target\"]:\n+        assert_raises_rpc_error(-8, msg, rbf_node.bumpfee, rbfid, {field: 1, \"fee_rate\": NORMAL})\n+    too_high = \"is too high (cannot be higher than -maxtxfee\"\n+    assert_raises_rpc_error(-4, too_high, lambda: rbf_node.bumpfee(rbfid, {\"estimate_mode\": BTC_MODE, \"conf_target\": 2009}))\n+    assert_raises_rpc_error(-4, too_high, lambda: rbf_node.bumpfee(rbfid, {\"estimate_mode\": SAT_MODE, \"conf_target\": 2009 * 10000}))\n+\n+    self.log.info(\"Test invalid estimate_mode settings\")\n+    for k, v in {\"number\": 42, \"object\": {\"foo\": \"bar\"}}.items():",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511148504",
      "id" : 511148504,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE0ODUwNA==",
      "original_commit_id" : "70b793c2b3b91b012316292cd87a093871dd714a",
      "original_line" : 200,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "test/functional/wallet_bumpfee.py",
      "position" : null,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511148504",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511153062"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511153062"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is a bit hard to review. My approach would currently be to check line by line whether all test cases are accounted for but that would probably be easier if the reordering of code and the refactoring to traverse the test cases had been separated into two commits. What would a reviewer usually be expected to do here?\r\n\r\nAlternatively, I suspect that there might be better diff tools that can follow a change like this. :thinking: ",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T21:00:05Z",
      "diff_hunk" : "@@ -100,28 +99,55 @@ def run_test(self):\n         test_small_output_with_feerate_succeeds(self, rbf_node, dest_address)\n         test_no_more_inputs_fails(self, rbf_node, dest_address)\n \n-    def test_invalid_parameters(self, node, dest_address):\n-        txid = spend_one_input(node, dest_address)\n-        # invalid estimate mode\n-        assert_raises_rpc_error(-8, \"Invalid estimate_mode parameter\", node.bumpfee, txid, {\n-            \"estimate_mode\": \"moo\",\n-        })\n-        assert_raises_rpc_error(-3, \"Expected type string\", node.bumpfee, txid, {\n-            \"estimate_mode\": 38,\n-        })\n-        assert_raises_rpc_error(-3, \"Expected type string\", node.bumpfee, txid, {\n-            \"estimate_mode\": {\n-                \"foo\": \"bar\",\n-            },\n-        })\n-        assert_raises_rpc_error(-8, \"Invalid estimate_mode parameter\", node.bumpfee, txid, {\n-            \"estimate_mode\": Decimal(\"3.141592\"),\n-        })\n-        # confTarget and conf_target\n-        assert_raises_rpc_error(-8, \"confTarget and conf_target options should not both be set\", node.bumpfee, txid, {\n-            \"confTarget\": 123,\n-            \"conf_target\": 456,\n-        })\n+    def test_invalid_parameters(self, rbf_node, peer_node, dest_address):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511153062",
      "id" : 511153062,
      "line" : 102,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE1MzA2Mg==",
      "original_commit_id" : "9ea6d390c26975c98a9cf28cf816bcbded9aa3d1",
      "original_line" : 102,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "test/functional/wallet_bumpfee.py",
      "position" : 58,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511153062",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511153839"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511153839"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What is the advantage of this construction over the previous line?",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T21:02:04Z",
      "diff_hunk" : "@@ -272,11 +272,12 @@ UniValue DescribeAddress(const CTxDestination& dest)\n \n unsigned int ParseConfirmTarget(const UniValue& value, unsigned int max_target)\n {\n-    int target = value.get_int();\n-    if (target < 1 || (unsigned int)target > max_target) {\n-        throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(\"Invalid conf_target, must be between %u - %u\", 1, max_target));\n+    const int target{value.get_int()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511153839",
      "id" : 511153839,
      "line" : 275,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE1MzgzOQ==",
      "original_commit_id" : "84fc42f32c8f649918e3db55d1dcc62d9f402224",
      "original_line" : 275,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/util.cpp",
      "position" : 7,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511153839",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511156476"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511156476"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would this not fail if the value of the input was between `MAX_INT` if `max_target` were between `MAX_INT` and `MAX_UNSIGNED_INT`?",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T21:09:21Z",
      "diff_hunk" : "@@ -272,11 +272,12 @@ UniValue DescribeAddress(const CTxDestination& dest)\n \n unsigned int ParseConfirmTarget(const UniValue& value, unsigned int max_target)\n {\n-    int target = value.get_int();\n-    if (target < 1 || (unsigned int)target > max_target) {\n-        throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(\"Invalid conf_target, must be between %u - %u\", 1, max_target));\n+    const int target{value.get_int()};\n+    const unsigned int unsigned_target{static_cast<unsigned int>(target)};\n+    if (target < 1 || unsigned_target > max_target) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511156476",
      "id" : 511156476,
      "line" : 277,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE1NjQ3Ng==",
      "original_commit_id" : "84fc42f32c8f649918e3db55d1dcc62d9f402224",
      "original_line" : 277,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/rpc/util.cpp",
      "position" : 9,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511156476",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511157014"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511157014"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I assume this is safe, because `max_target` is 1000 blocks, but I did spend a few minutes staring at this.",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T21:10:47Z",
      "diff_hunk" : "@@ -272,11 +272,12 @@ UniValue DescribeAddress(const CTxDestination& dest)\n \n unsigned int ParseConfirmTarget(const UniValue& value, unsigned int max_target)\n {\n-    int target = value.get_int();\n-    if (target < 1 || (unsigned int)target > max_target) {\n-        throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(\"Invalid conf_target, must be between %u - %u\", 1, max_target));\n+    const int target{value.get_int()};\n+    const unsigned int unsigned_target{static_cast<unsigned int>(target)};\n+    if (target < 1 || unsigned_target > max_target) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511157014",
      "id" : 511157014,
      "in_reply_to_id" : 511156476,
      "line" : 277,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE1NzAxNA==",
      "original_commit_id" : "84fc42f32c8f649918e3db55d1dcc62d9f402224",
      "original_line" : 277,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/rpc/util.cpp",
      "position" : 9,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:40:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511157014",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511158281"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511158281"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "So now we have `fee rate`, `feeRate` and `fee_rate` in one PR. The horrors. :sweat_smile: ",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T21:14:19Z",
      "diff_hunk" : "@@ -672,6 +674,53 @@ def test_option_feerate(self):\n         assert_fee_amount(result2['fee'], count_bytes(result2['hex']), 2 * result_fee_rate)\n         assert_fee_amount(result3['fee'], count_bytes(result3['hex']), 10 * result_fee_rate)\n \n+    def test_feerate_with_conf_target_and_estimate_mode(self):\n+        self.log.info(\"Test fundrawtxn passing an explicit feerate using conf_target and estimate_mode\")\n+        node = self.nodes[3]\n+        # Make sure there is exactly one input so coin selection can't skew the result.\n+        assert_equal(len(node.listunspent(1)), 1)\n+        inputs = []\n+        outputs = {node.getnewaddress() : 1}\n+        rawtx = node.createrawtransaction(inputs, outputs)\n+\n+        for unit, feerate in {\"btc/kb\": 0.1, \"sat/b\": 10000}.items():\n+            self.log.info(\"Test fundrawtxn with conf_target {} estimate_mode {} produces expected fee\".format(feerate, unit))\n+            # With no arguments passed, expect fee of 141 sats/b.\n+            assert_approx(node.fundrawtransaction(rawtx)[\"fee\"], vexp=0.00000141, vspan=0.00000001)\n+            # Expect fee to be 10,000x higher when explicit fee 10,000x greater is specified.\n+            result = node.fundrawtransaction(rawtx, {\"conf_target\": feerate, \"estimate_mode\": unit})\n+            assert_approx(result[\"fee\"], vexp=0.0141, vspan=0.0001)\n+\n+        for field, feerate in {\"conf_target\": 0.1, \"estimate_mode\": \"sat/b\"}.items():\n+            self.log.info(\"Test fundrawtxn raises RPC error if both feeRate and {} are passed\".format(field))\n+            assert_raises_rpc_error(\n+                -8, \"Cannot specify both {} and feeRate\".format(field),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511158281",
      "id" : 511158281,
      "line" : 697,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE1ODI4MQ==",
      "original_commit_id" : "84fc42f32c8f649918e3db55d1dcc62d9f402224",
      "original_line" : 697,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : 40,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511158281",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511159365"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511159365"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: since this is an address and amount, how about \"receiver_output\"?",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T21:17:12Z",
      "diff_hunk" : "@@ -174,8 +174,11 @@ def run_test(self):\n             elif out['scriptPubKey']['addresses'][0] == p2pkh:\n                 p2pkh_pos = out['n']\n \n+        inputs = [{\"txid\": txid, \"vout\": p2wpkh_pos}, {\"txid\": txid, \"vout\": p2sh_p2wpkh_pos}, {\"txid\": txid, \"vout\": p2pkh_pos}]\n+        addr = {self.nodes[1].getnewaddress(): 29.99}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511159365",
      "id" : 511159365,
      "line" : 178,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE1OTM2NQ==",
      "original_commit_id" : "1b498b9b6aa4d2d7c1d316f9ab4bc4c96728cd6a",
      "original_line" : 178,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/rpc_psbt.py",
      "position" : 5,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511159365",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511160072"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511160072"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: \"K\" is the symbol for Kelvin, it's \"kB\", also remove spacing like below for consistency. :nerd_face: ",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T21:19:17Z",
      "diff_hunk" : "@@ -186,14 +189,15 @@ def run_test(self):\n         assert_equal(walletprocesspsbt_out['complete'], True)\n         self.nodes[1].sendrawtransaction(self.nodes[1].finalizepsbt(walletprocesspsbt_out['psbt'])['hex'])\n \n-        # feeRate of 0.1 BTC / KB produces a total fee slightly below -maxtxfee (~0.05280000):\n-        res = self.nodes[1].walletcreatefundedpsbt([{\"txid\":txid,\"vout\":p2wpkh_pos},{\"txid\":txid,\"vout\":p2sh_p2wpkh_pos},{\"txid\":txid,\"vout\":p2pkh_pos}], {self.nodes[1].getnewaddress():29.99}, 0, {\"feeRate\": 0.1, \"add_inputs\": True})\n+        self.log.info(\"Test feeRate of 0.1 BTC / KB produces a total fee slightly below -maxtxfee (~0.05280000)\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511160072",
      "id" : 511160072,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE2MDA3Mg==",
      "original_commit_id" : "1b498b9b6aa4d2d7c1d316f9ab4bc4c96728cd6a",
      "original_line" : 192,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "test/functional/rpc_psbt.py",
      "position" : null,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511160072",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511161360"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511161360"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Still getting used to this, but totally see what you're doing now. :)",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T21:22:52Z",
      "diff_hunk" : "@@ -186,14 +189,15 @@ def run_test(self):\n         assert_equal(walletprocesspsbt_out['complete'], True)\n         self.nodes[1].sendrawtransaction(self.nodes[1].finalizepsbt(walletprocesspsbt_out['psbt'])['hex'])\n \n-        # feeRate of 0.1 BTC / KB produces a total fee slightly below -maxtxfee (~0.05280000):\n-        res = self.nodes[1].walletcreatefundedpsbt([{\"txid\":txid,\"vout\":p2wpkh_pos},{\"txid\":txid,\"vout\":p2sh_p2wpkh_pos},{\"txid\":txid,\"vout\":p2pkh_pos}], {self.nodes[1].getnewaddress():29.99}, 0, {\"feeRate\": 0.1, \"add_inputs\": True})\n+        self.log.info(\"Test feeRate of 0.1 BTC / KB produces a total fee slightly below -maxtxfee (~0.05280000)\")\n+        res = self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"feeRate\": 0.1, \"add_inputs\": True})\n         assert_approx(res[\"fee\"], 0.055, 0.005)\n \n-        # feeRate of 10 BTC / KB produces a total fee well above -maxtxfee\n+        self.log.info(\"Test feeRate of 10 BTC/KB produces total fee well above -maxtxfee and raises RPC error\")\n         # previously this was silently capped at -maxtxfee\n-        assert_raises_rpc_error(-4, \"Fee exceeds maximum configured by user (e.g. -maxtxfee, maxfeerate)\", self.nodes[1].walletcreatefundedpsbt, [{\"txid\":txid,\"vout\":p2wpkh_pos},{\"txid\":txid,\"vout\":p2sh_p2wpkh_pos},{\"txid\":txid,\"vout\":p2pkh_pos}], {self.nodes[1].getnewaddress():29.99}, 0, {\"feeRate\": 10, \"add_inputs\": True})\n-        assert_raises_rpc_error(-4, \"Fee exceeds maximum configured by user (e.g. -maxtxfee, maxfeerate)\", self.nodes[1].walletcreatefundedpsbt, [{\"txid\":txid,\"vout\":p2wpkh_pos},{\"txid\":txid,\"vout\":p2sh_p2wpkh_pos},{\"txid\":txid,\"vout\":p2pkh_pos}], {self.nodes[1].getnewaddress():1}, 0, {\"feeRate\": 10, \"add_inputs\": False})\n+        for bool_add, addr in {True: addr, False: {self.nodes[1].getnewaddress(): 1}}.items():",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511161360",
      "id" : 511161360,
      "line" : 234,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE2MTM2MA==",
      "original_commit_id" : "1b498b9b6aa4d2d7c1d316f9ab4bc4c96728cd6a",
      "original_line" : 198,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "test/functional/rpc_psbt.py",
      "position" : 64,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511161360",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511163315"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511163315"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Probably not the right place to bring this up, but the explicit specifying of the unit does seem really error prone as mentioned in the comments of #19543 before. ",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T21:28:43Z",
      "diff_hunk" : "@@ -189,10 +189,46 @@ def run_test(self):\n         assert_equal(walletprocesspsbt_out['complete'], True)\n         self.nodes[1].sendrawtransaction(self.nodes[1].finalizepsbt(walletprocesspsbt_out['psbt'])['hex'])\n \n-        self.log.info(\"Test feeRate of 0.1 BTC / KB produces a total fee slightly below -maxtxfee (~0.05280000)\")\n+        self.log.info(\"Test feeRate of 0.1 BTC / KB produces a total fee at or slightly below -maxtxfee (~0.05290000)\")\n         res = self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"feeRate\": 0.1, \"add_inputs\": True})\n         assert_approx(res[\"fee\"], 0.055, 0.005)\n \n+        self.log.info(\"Test passing walletcreatefundedpsbt explicit feerate with conf_target and estimate_mode\")\n+        for unit, feerate in {\"btc/kb\": 0.1, \"sat/b\": 10000}.items():",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511163315",
      "id" : 511163315,
      "line" : 197,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE2MzMxNQ==",
      "original_commit_id" : "6ad143c294858af93d22012c2d52997b05db0028",
      "original_line" : 197,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "test/functional/rpc_psbt.py",
      "position" : 25,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511163315",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511165359"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511165359"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Zero often being some sort of special case, what happens with values between 0 and 0.00001000? Maybe we should also test `0.00000999`.",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T21:34:44Z",
      "diff_hunk" : "@@ -189,10 +189,46 @@ def run_test(self):\n         assert_equal(walletprocesspsbt_out['complete'], True)\n         self.nodes[1].sendrawtransaction(self.nodes[1].finalizepsbt(walletprocesspsbt_out['psbt'])['hex'])\n \n-        self.log.info(\"Test feeRate of 0.1 BTC / KB produces a total fee slightly below -maxtxfee (~0.05280000)\")\n+        self.log.info(\"Test feeRate of 0.1 BTC / KB produces a total fee at or slightly below -maxtxfee (~0.05290000)\")\n         res = self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"feeRate\": 0.1, \"add_inputs\": True})\n         assert_approx(res[\"fee\"], 0.055, 0.005)\n \n+        self.log.info(\"Test passing walletcreatefundedpsbt explicit feerate with conf_target and estimate_mode\")\n+        for unit, feerate in {\"btc/kb\": 0.1, \"sat/b\": 10000}.items():\n+            fee = self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"conf_target\": feerate, \"estimate_mode\": unit, \"add_inputs\": True})[\"fee\"]\n+            self.log.info(\"- conf_target {}, estimate_mode {} produces fee {} at or slightly below -maxtxfee (~0.05290000)\".format(feerate, unit, fee))\n+            assert_approx(fee, vexp=0.055, vspan=0.005)\n+\n+        for field, feerate in {\"conf_target\": 0.1, \"estimate_mode\": \"sat/b\"}.items():\n+            self.log.info(\"Test walletcreatefundedpsbt raises RPC error if both feeRate and {} are passed\".format(field))\n+            assert_raises_rpc_error(\n+                -8, \"Cannot specify both {} and feeRate\".format(field),\n+                lambda: self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"feeRate\": 0.1, field: feerate, \"add_inputs\": True}))\n+\n+        self.log.info(\"Test walletcreatefundedpsbt with invalid estimate_mode settings\")\n+        for k, v in {\"number\": 42, \"object\": {\"foo\": \"bar\"}}.items():\n+            assert_raises_rpc_error(-3, \"Expected type string for estimate_mode, got {}\".format(k),\n+                lambda: self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"estimate_mode\": v, \"conf_target\": 0.1, \"add_inputs\": True}))\n+        for mode in [\"foo\", Decimal(\"3.141592\")]:\n+            assert_raises_rpc_error(-8, \"Invalid estimate_mode parameter\",\n+                lambda: self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"estimate_mode\": mode, \"conf_target\": 0.1, \"add_inputs\": True}))\n+\n+        self.log.info(\"Test walletcreatefundedpsbt with invalid conf_target settings\")\n+        for mode in [\"unset\", \"economical\", \"conservative\", \"btc/kb\", \"sat/b\"]:\n+            self.log.debug(\"{}\".format(mode))\n+            for k, v in {\"string\": \"\", \"object\": {\"foo\": \"bar\"}}.items():\n+                assert_raises_rpc_error(-3, \"Expected type number for conf_target, got {}\".format(k),\n+                    lambda: self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"estimate_mode\": mode, \"conf_target\": v, \"add_inputs\": True}))\n+            if mode in [\"btc/kb\", \"sat/b\"]:\n+                assert_raises_rpc_error(-3, \"Amount out of range\",\n+                    lambda: self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"estimate_mode\": mode, \"conf_target\": -1, \"add_inputs\": True}))\n+                assert_raises_rpc_error(-4, \"Fee rate (0.00000000 BTC/kB) is lower than the minimum fee rate setting (0.00001000 BTC/kB)\",\n+                    lambda: self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"estimate_mode\": mode, \"conf_target\": 0, \"add_inputs\": True}))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511165359",
      "id" : 511165359,
      "line" : 226,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE2NTM1OQ==",
      "original_commit_id" : "6ad143c294858af93d22012c2d52997b05db0028",
      "original_line" : 226,
      "original_position" : 39,
      "original_start_line" : 222,
      "path" : "test/functional/rpc_psbt.py",
      "position" : 54,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : 222,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-23T21:40:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511165359",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511165699"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511165699"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh my, great improvement!",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T21:35:37Z",
      "diff_hunk" : "@@ -4034,7 +4034,7 @@ static RPCHelpMan send()\n                     {\"locktime\", RPCArg::Type::NUM, /* default */ \"0\", \"Raw locktime. Non-0 value also locktime-activates inputs\"},\n                     {\"lock_unspents\", RPCArg::Type::BOOL, /* default */ \"false\", \"Lock selected unspent outputs\"},\n                     {\"psbt\", RPCArg::Type::BOOL,  /* default */ \"automatic\", \"Always return a PSBT, implies add_to_wallet=false.\"},\n-                    {\"subtract_fee_from_outputs\", RPCArg::Type::ARR, /* default */ \"empty array\", \"A JSON array of integers.\\n\"\n+                    {\"subtract_fee_from_outputs\", RPCArg::Type::ARR, /* default */ \"empty array\", \"Outputs to subtract the fee from, specified as integer indices.\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511165699",
      "id" : 511165699,
      "line" : 4043,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE2NTY5OQ==",
      "original_commit_id" : "77a4f98897ab4430311cff3f2226f274fad20d6a",
      "original_line" : 4037,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 90,
      "pull_request_review_id" : 515982840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:40:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511165699",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511170366"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511170366"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Little: constness, and while changing the line, updated the style. It's not essential, to be sure. Initially, the function was touched to fix the error message. Then, I saw the function has two C-style type conversions and replaced them with one preferred static cast. Then, made the non-mutated variables const.",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T21:49:02Z",
      "diff_hunk" : "@@ -272,11 +272,12 @@ UniValue DescribeAddress(const CTxDestination& dest)\n \n unsigned int ParseConfirmTarget(const UniValue& value, unsigned int max_target)\n {\n-    int target = value.get_int();\n-    if (target < 1 || (unsigned int)target > max_target) {\n-        throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(\"Invalid conf_target, must be between %u - %u\", 1, max_target));\n+    const int target{value.get_int()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511170366",
      "id" : 511170366,
      "in_reply_to_id" : 511153839,
      "line" : 275,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE3MDM2Ng==",
      "original_commit_id" : "84fc42f32c8f649918e3db55d1dcc62d9f402224",
      "original_line" : 275,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/util.cpp",
      "position" : 7,
      "pull_request_review_id" : 516029047,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:50:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511170366",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511172152"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511172152"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes. It would be good to replace this with the fixed-unit `feerate_sat_vb` argument before the 0.21 branch-off.",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T21:54:29Z",
      "diff_hunk" : "@@ -189,10 +189,46 @@ def run_test(self):\n         assert_equal(walletprocesspsbt_out['complete'], True)\n         self.nodes[1].sendrawtransaction(self.nodes[1].finalizepsbt(walletprocesspsbt_out['psbt'])['hex'])\n \n-        self.log.info(\"Test feeRate of 0.1 BTC / KB produces a total fee slightly below -maxtxfee (~0.05280000)\")\n+        self.log.info(\"Test feeRate of 0.1 BTC / KB produces a total fee at or slightly below -maxtxfee (~0.05290000)\")\n         res = self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"feeRate\": 0.1, \"add_inputs\": True})\n         assert_approx(res[\"fee\"], 0.055, 0.005)\n \n+        self.log.info(\"Test passing walletcreatefundedpsbt explicit feerate with conf_target and estimate_mode\")\n+        for unit, feerate in {\"btc/kb\": 0.1, \"sat/b\": 10000}.items():",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511172152",
      "id" : 511172152,
      "in_reply_to_id" : 511163315,
      "line" : 197,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE3MjE1Mg==",
      "original_commit_id" : "6ad143c294858af93d22012c2d52997b05db0028",
      "original_line" : 197,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "test/functional/rpc_psbt.py",
      "position" : 25,
      "pull_request_review_id" : 516031240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T21:54:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511172152",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511172884"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511172884"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agreed--started doing just that today for the new arg in [`0f2eb16` (#20231)](https://github.com/bitcoin/bitcoin/pull/20231/commits/0f2eb167ddfa7d2612708d09e05189f969699121#diff-047f185450ff2093df390b522db9b6aa1c87353abf7e7a99c00390db8c707f6eR375), will update here.",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-23T21:56:39Z",
      "diff_hunk" : "@@ -189,10 +189,46 @@ def run_test(self):\n         assert_equal(walletprocesspsbt_out['complete'], True)\n         self.nodes[1].sendrawtransaction(self.nodes[1].finalizepsbt(walletprocesspsbt_out['psbt'])['hex'])\n \n-        self.log.info(\"Test feeRate of 0.1 BTC / KB produces a total fee slightly below -maxtxfee (~0.05280000)\")\n+        self.log.info(\"Test feeRate of 0.1 BTC / KB produces a total fee at or slightly below -maxtxfee (~0.05290000)\")\n         res = self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"feeRate\": 0.1, \"add_inputs\": True})\n         assert_approx(res[\"fee\"], 0.055, 0.005)\n \n+        self.log.info(\"Test passing walletcreatefundedpsbt explicit feerate with conf_target and estimate_mode\")\n+        for unit, feerate in {\"btc/kb\": 0.1, \"sat/b\": 10000}.items():\n+            fee = self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"conf_target\": feerate, \"estimate_mode\": unit, \"add_inputs\": True})[\"fee\"]\n+            self.log.info(\"- conf_target {}, estimate_mode {} produces fee {} at or slightly below -maxtxfee (~0.05290000)\".format(feerate, unit, fee))\n+            assert_approx(fee, vexp=0.055, vspan=0.005)\n+\n+        for field, feerate in {\"conf_target\": 0.1, \"estimate_mode\": \"sat/b\"}.items():\n+            self.log.info(\"Test walletcreatefundedpsbt raises RPC error if both feeRate and {} are passed\".format(field))\n+            assert_raises_rpc_error(\n+                -8, \"Cannot specify both {} and feeRate\".format(field),\n+                lambda: self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"feeRate\": 0.1, field: feerate, \"add_inputs\": True}))\n+\n+        self.log.info(\"Test walletcreatefundedpsbt with invalid estimate_mode settings\")\n+        for k, v in {\"number\": 42, \"object\": {\"foo\": \"bar\"}}.items():\n+            assert_raises_rpc_error(-3, \"Expected type string for estimate_mode, got {}\".format(k),\n+                lambda: self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"estimate_mode\": v, \"conf_target\": 0.1, \"add_inputs\": True}))\n+        for mode in [\"foo\", Decimal(\"3.141592\")]:\n+            assert_raises_rpc_error(-8, \"Invalid estimate_mode parameter\",\n+                lambda: self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"estimate_mode\": mode, \"conf_target\": 0.1, \"add_inputs\": True}))\n+\n+        self.log.info(\"Test walletcreatefundedpsbt with invalid conf_target settings\")\n+        for mode in [\"unset\", \"economical\", \"conservative\", \"btc/kb\", \"sat/b\"]:\n+            self.log.debug(\"{}\".format(mode))\n+            for k, v in {\"string\": \"\", \"object\": {\"foo\": \"bar\"}}.items():\n+                assert_raises_rpc_error(-3, \"Expected type number for conf_target, got {}\".format(k),\n+                    lambda: self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"estimate_mode\": mode, \"conf_target\": v, \"add_inputs\": True}))\n+            if mode in [\"btc/kb\", \"sat/b\"]:\n+                assert_raises_rpc_error(-3, \"Amount out of range\",\n+                    lambda: self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"estimate_mode\": mode, \"conf_target\": -1, \"add_inputs\": True}))\n+                assert_raises_rpc_error(-4, \"Fee rate (0.00000000 BTC/kB) is lower than the minimum fee rate setting (0.00001000 BTC/kB)\",\n+                    lambda: self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"estimate_mode\": mode, \"conf_target\": 0, \"add_inputs\": True}))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511172884",
      "id" : 511172884,
      "in_reply_to_id" : 511165359,
      "line" : 226,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE3Mjg4NA==",
      "original_commit_id" : "6ad143c294858af93d22012c2d52997b05db0028",
      "original_line" : 226,
      "original_position" : 39,
      "original_start_line" : 222,
      "path" : "test/functional/rpc_psbt.py",
      "position" : 54,
      "pull_request_review_id" : 516032102,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : 222,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-23T21:57:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511172884",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511469087"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511469087"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree, it's a redundant feature here that adds to the confusion...while using a different code path, so the test is needed. ",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-24T14:20:03Z",
      "diff_hunk" : "@@ -132,6 +134,13 @@ def test_simple_bumpfee_succeeds(self, mode, rbf_node, peer_node, dest_address):\n     if mode == \"fee_rate\":\n         bumped_psbt = rbf_node.psbtbumpfee(rbfid, {\"fee_rate\": NORMAL})\n         bumped_tx = rbf_node.bumpfee(rbfid, {\"fee_rate\": NORMAL})\n+    elif mode == BTC_MODE:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511469087",
      "id" : 511469087,
      "in_reply_to_id" : 511134364,
      "line" : 163,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ2OTA4Nw==",
      "original_commit_id" : "995dd4a6e7c21665472e71d7aac0251f379e3420",
      "original_line" : 137,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "test/functional/wallet_bumpfee.py",
      "position" : 114,
      "pull_request_review_id" : 516281174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-24T14:20:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511469087",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511474549"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511474549"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sorry about that. Yes, there are a few options. In this case, a helpful one might be\r\n\r\n`git show 6fa5686 -w --color-moved=dimmed-zebra`\r\n\r\nFor other cases, maybe git show or git diff with `--word-diff`.\r\n\r\nOr to ignore all added lines having a matching identical removed line (empty result proves move-only):\r\n\r\n`git diff 6fa5686f~1..6fa5686f | grep -E '^[+-][^+-]' | cut -b2- | sort | uniq -c | grep -v '^ *2'`\r\n\r\nPeople like practicalswift, promag, MarcoFalke, jnewbery, and harding likely know some more good ones.\r\n",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-24T14:41:40Z",
      "diff_hunk" : "@@ -100,28 +99,55 @@ def run_test(self):\n         test_small_output_with_feerate_succeeds(self, rbf_node, dest_address)\n         test_no_more_inputs_fails(self, rbf_node, dest_address)\n \n-    def test_invalid_parameters(self, node, dest_address):\n-        txid = spend_one_input(node, dest_address)\n-        # invalid estimate mode\n-        assert_raises_rpc_error(-8, \"Invalid estimate_mode parameter\", node.bumpfee, txid, {\n-            \"estimate_mode\": \"moo\",\n-        })\n-        assert_raises_rpc_error(-3, \"Expected type string\", node.bumpfee, txid, {\n-            \"estimate_mode\": 38,\n-        })\n-        assert_raises_rpc_error(-3, \"Expected type string\", node.bumpfee, txid, {\n-            \"estimate_mode\": {\n-                \"foo\": \"bar\",\n-            },\n-        })\n-        assert_raises_rpc_error(-8, \"Invalid estimate_mode parameter\", node.bumpfee, txid, {\n-            \"estimate_mode\": Decimal(\"3.141592\"),\n-        })\n-        # confTarget and conf_target\n-        assert_raises_rpc_error(-8, \"confTarget and conf_target options should not both be set\", node.bumpfee, txid, {\n-            \"confTarget\": 123,\n-            \"conf_target\": 456,\n-        })\n+    def test_invalid_parameters(self, rbf_node, peer_node, dest_address):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511474549",
      "id" : 511474549,
      "in_reply_to_id" : 511153062,
      "line" : 102,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ3NDU0OQ==",
      "original_commit_id" : "9ea6d390c26975c98a9cf28cf816bcbded9aa3d1",
      "original_line" : 102,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "test/functional/wallet_bumpfee.py",
      "position" : 58,
      "pull_request_review_id" : 516282625,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-24T14:41:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511474549",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511476668"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511476668"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good idea. Changed it to an `outputs` array like in the help:\r\n```diff\r\n         inputs = [{\"txid\": txid, \"vout\": p2wpkh_pos}, {\"txid\": txid, \"vout\": p2sh_p2wpkh_pos}, {\"txid\": txid, \"vout\": p2pkh_pos}]\r\n-        addr = {self.nodes[1].getnewaddress(): 29.99}\r\n+        outputs = [{self.nodes[1].getnewaddress(): 29.99}]\r\n```\r\n",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-24T14:50:29Z",
      "diff_hunk" : "@@ -174,8 +174,11 @@ def run_test(self):\n             elif out['scriptPubKey']['addresses'][0] == p2pkh:\n                 p2pkh_pos = out['n']\n \n+        inputs = [{\"txid\": txid, \"vout\": p2wpkh_pos}, {\"txid\": txid, \"vout\": p2sh_p2wpkh_pos}, {\"txid\": txid, \"vout\": p2pkh_pos}]\n+        addr = {self.nodes[1].getnewaddress(): 29.99}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511476668",
      "id" : 511476668,
      "in_reply_to_id" : 511159365,
      "line" : 178,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ3NjY2OA==",
      "original_commit_id" : "1b498b9b6aa4d2d7c1d316f9ab4bc4c96728cd6a",
      "original_line" : 178,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/rpc_psbt.py",
      "position" : 5,
      "pull_request_review_id" : 516283205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-24T14:50:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511476668",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511477245"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511477245"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-24T14:52:45Z",
      "diff_hunk" : "@@ -186,14 +189,15 @@ def run_test(self):\n         assert_equal(walletprocesspsbt_out['complete'], True)\n         self.nodes[1].sendrawtransaction(self.nodes[1].finalizepsbt(walletprocesspsbt_out['psbt'])['hex'])\n \n-        # feeRate of 0.1 BTC / KB produces a total fee slightly below -maxtxfee (~0.05280000):\n-        res = self.nodes[1].walletcreatefundedpsbt([{\"txid\":txid,\"vout\":p2wpkh_pos},{\"txid\":txid,\"vout\":p2sh_p2wpkh_pos},{\"txid\":txid,\"vout\":p2pkh_pos}], {self.nodes[1].getnewaddress():29.99}, 0, {\"feeRate\": 0.1, \"add_inputs\": True})\n+        self.log.info(\"Test feeRate of 0.1 BTC / KB produces a total fee slightly below -maxtxfee (~0.05280000)\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511477245",
      "id" : 511477245,
      "in_reply_to_id" : 511160072,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ3NzI0NQ==",
      "original_commit_id" : "1b498b9b6aa4d2d7c1d316f9ab4bc4c96728cd6a",
      "original_line" : 192,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "test/functional/rpc_psbt.py",
      "position" : null,
      "pull_request_review_id" : 516283363,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-24T14:52:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511477245",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511477688"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511477688"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Reverted. This line goes away in the following commit.",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-24T14:54:24Z",
      "diff_hunk" : "@@ -168,24 +168,54 @@ def test_simple_bumpfee_succeeds(self, mode, rbf_node, peer_node, dest_address):\n \n \n def test_feerate_args(self, rbf_node, peer_node, dest_address):\n-    self.log.info('Test fee_rate args')\n+    self.log.info('Test feerate args')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511477688",
      "id" : 511477688,
      "in_reply_to_id" : 511135422,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ3NzY4OA==",
      "original_commit_id" : "70b793c2b3b91b012316292cd87a093871dd714a",
      "original_line" : 171,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/wallet_bumpfee.py",
      "position" : null,
      "pull_request_review_id" : 516283470,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-24T14:54:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511477688",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511478300"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511478300"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done, changed to `error_both`.",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-24T14:58:34Z",
      "diff_hunk" : "@@ -168,24 +168,54 @@ def test_simple_bumpfee_succeeds(self, mode, rbf_node, peer_node, dest_address):\n \n \n def test_feerate_args(self, rbf_node, peer_node, dest_address):\n-    self.log.info('Test fee_rate args')\n+    self.log.info('Test feerate args')\n     rbfid = spend_one_input(rbf_node, dest_address)\n     self.sync_mempools((rbf_node, peer_node))\n     assert rbfid in rbf_node.getrawmempool() and rbfid in peer_node.getrawmempool()\n \n-    assert_raises_rpc_error(-8, \"conf_target can't be set with fee_rate. Please provide either a confirmation target in blocks for automatic fee estimation, or an explicit fee rate.\", rbf_node.bumpfee, rbfid, {\"fee_rate\": NORMAL, \"confTarget\": 1})\n-\n     assert_raises_rpc_error(-3, \"Unexpected key totalFee\", rbf_node.bumpfee, rbfid, {\"totalFee\": NORMAL})\n-    assert_raises_rpc_error(-8, \"conf_target can't be set with fee_rate. Please provide either a confirmation target in blocks for automatic fee estimation, or an explicit fee rate.\", rbf_node.bumpfee, rbfid, {\"fee_rate\":0.00001, \"confTarget\": 1})\n \n     # Bumping to just above minrelay should fail to increase total fee enough, at least\n     assert_raises_rpc_error(-8, \"Insufficient total fee\", rbf_node.bumpfee, rbfid, {\"fee_rate\": INSUFFICIENT})\n-\n     assert_raises_rpc_error(-3, \"Amount out of range\", rbf_node.bumpfee, rbfid, {\"fee_rate\": -1})\n-\n     assert_raises_rpc_error(-4, \"is too high (cannot be higher than\", rbf_node.bumpfee, rbfid, {\"fee_rate\": TOO_HIGH})\n-    self.clear_mempool()\n \n+    self.log.info(\"Test explicit feerate raises RPC error if estimate_mode is passed without a conf_target\")\n+    assert_raises_rpc_error(-8, \"Selected estimate_mode requires a fee rate\", rbf_node.bumpfee, rbfid, {\"fee_rate\": NORMAL, \"estimate_mode\": BTC_MODE})\n+    assert_raises_rpc_error(-8, \"Selected estimate_mode requires a fee rate\", rbf_node.bumpfee, rbfid, {\"fee_rate\": 10, \"estimate_mode\": SAT_MODE})\n+\n+    self.log.info(\"Test explicit feerate raises RPC error if both fee_rate and conf_target are passed\")\n+    msg = \"Cannot specify both conf_target and fee_rate. Please provide either a confirmation \" \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511478300",
      "id" : 511478300,
      "in_reply_to_id" : 511145359,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ3ODMwMA==",
      "original_commit_id" : "70b793c2b3b91b012316292cd87a093871dd714a",
      "original_line" : 188,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "test/functional/wallet_bumpfee.py",
      "position" : null,
      "pull_request_review_id" : 516283716,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-24T14:58:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511478300",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511479304"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511479304"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added\r\n```python\r\nfor unit, feerate in {\"SAT/B\": 0.99999999, \"BTC/KB\": 0.00000999}.items():\r\n    self.log.info(\"- raises RPC error 'fee rate too low' if conf_target {} and estimate_mode {} are passed\".format(feerate, unit))\r\n    assert_raises_rpc_error(-4, \"Fee rate (0.00000999 BTC/kB) is lower than the minimum fee rate setting (0.00001000 BTC/kB)\",\r\n        lambda: self.nodes[1].walletcreatefundedpsbt(inputs, outputs, 0, {\"estimate_mode\": unit, \"conf_target\": feerate, \"add_inputs\": True}))\r\n```\r\n",
      "commit_id" : "f97a3cd3e6e229305a4451d611d77cbf3892381f",
      "created_at" : "2020-10-24T15:01:55Z",
      "diff_hunk" : "@@ -189,10 +189,46 @@ def run_test(self):\n         assert_equal(walletprocesspsbt_out['complete'], True)\n         self.nodes[1].sendrawtransaction(self.nodes[1].finalizepsbt(walletprocesspsbt_out['psbt'])['hex'])\n \n-        self.log.info(\"Test feeRate of 0.1 BTC / KB produces a total fee slightly below -maxtxfee (~0.05280000)\")\n+        self.log.info(\"Test feeRate of 0.1 BTC / KB produces a total fee at or slightly below -maxtxfee (~0.05290000)\")\n         res = self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"feeRate\": 0.1, \"add_inputs\": True})\n         assert_approx(res[\"fee\"], 0.055, 0.005)\n \n+        self.log.info(\"Test passing walletcreatefundedpsbt explicit feerate with conf_target and estimate_mode\")\n+        for unit, feerate in {\"btc/kb\": 0.1, \"sat/b\": 10000}.items():\n+            fee = self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"conf_target\": feerate, \"estimate_mode\": unit, \"add_inputs\": True})[\"fee\"]\n+            self.log.info(\"- conf_target {}, estimate_mode {} produces fee {} at or slightly below -maxtxfee (~0.05290000)\".format(feerate, unit, fee))\n+            assert_approx(fee, vexp=0.055, vspan=0.005)\n+\n+        for field, feerate in {\"conf_target\": 0.1, \"estimate_mode\": \"sat/b\"}.items():\n+            self.log.info(\"Test walletcreatefundedpsbt raises RPC error if both feeRate and {} are passed\".format(field))\n+            assert_raises_rpc_error(\n+                -8, \"Cannot specify both {} and feeRate\".format(field),\n+                lambda: self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"feeRate\": 0.1, field: feerate, \"add_inputs\": True}))\n+\n+        self.log.info(\"Test walletcreatefundedpsbt with invalid estimate_mode settings\")\n+        for k, v in {\"number\": 42, \"object\": {\"foo\": \"bar\"}}.items():\n+            assert_raises_rpc_error(-3, \"Expected type string for estimate_mode, got {}\".format(k),\n+                lambda: self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"estimate_mode\": v, \"conf_target\": 0.1, \"add_inputs\": True}))\n+        for mode in [\"foo\", Decimal(\"3.141592\")]:\n+            assert_raises_rpc_error(-8, \"Invalid estimate_mode parameter\",\n+                lambda: self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"estimate_mode\": mode, \"conf_target\": 0.1, \"add_inputs\": True}))\n+\n+        self.log.info(\"Test walletcreatefundedpsbt with invalid conf_target settings\")\n+        for mode in [\"unset\", \"economical\", \"conservative\", \"btc/kb\", \"sat/b\"]:\n+            self.log.debug(\"{}\".format(mode))\n+            for k, v in {\"string\": \"\", \"object\": {\"foo\": \"bar\"}}.items():\n+                assert_raises_rpc_error(-3, \"Expected type number for conf_target, got {}\".format(k),\n+                    lambda: self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"estimate_mode\": mode, \"conf_target\": v, \"add_inputs\": True}))\n+            if mode in [\"btc/kb\", \"sat/b\"]:\n+                assert_raises_rpc_error(-3, \"Amount out of range\",\n+                    lambda: self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"estimate_mode\": mode, \"conf_target\": -1, \"add_inputs\": True}))\n+                assert_raises_rpc_error(-4, \"Fee rate (0.00000000 BTC/kB) is lower than the minimum fee rate setting (0.00001000 BTC/kB)\",\n+                    lambda: self.nodes[1].walletcreatefundedpsbt(inputs, addr, 0, {\"estimate_mode\": mode, \"conf_target\": 0, \"add_inputs\": True}))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20220#discussion_r511479304",
      "id" : 511479304,
      "in_reply_to_id" : 511165359,
      "line" : 226,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ3OTMwNA==",
      "original_commit_id" : "6ad143c294858af93d22012c2d52997b05db0028",
      "original_line" : 226,
      "original_position" : 39,
      "original_start_line" : 222,
      "path" : "test/functional/rpc_psbt.py",
      "position" : 54,
      "pull_request_review_id" : 516283957,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20220",
      "side" : "RIGHT",
      "start_line" : 222,
      "start_side" : "RIGHT",
      "updated_at" : "2020-10-24T15:01:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511479304",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
