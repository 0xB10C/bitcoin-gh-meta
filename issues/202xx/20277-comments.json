[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20171 (Add functional test test_txid_inv_delay by ariard)\n* #19315 ([tests] Allow outbound & block-relay-only connections in functional tests. by amitiuttarwar)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-10-31T09:17:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20277#issuecomment-719907780",
      "id" : 719907780,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20277",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxOTkwNzc4MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-31T09:17:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/719907780",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20277#discussion_r515544072"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20277"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515544072"
         }
      },
      "author_association" : "NONE",
      "body" : "Does the scope resolution operator need to be used here like everywhere else? `if (::ChainstateActive().IsInitialBlockDownload()) return;`",
      "commit_id" : "8afa4fa3530389a06ddccd57235493cc7ae806f0",
      "created_at" : "2020-10-31T21:53:10Z",
      "diff_hunk" : "@@ -3019,6 +3019,15 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n             if (!fRejectedParents) {\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n+                // To save bandwidth during IBD, stop orphan processing early. With the state of\n+                // our UTXO set far from tip, we might not have yet the unspent output spend by this\n+                // transaction or this transaction is already double-spend but not yet seen block.\n+                // Further, we can't assert accuracy of its feerate.\n+                //\n+                // Orphan transaction is discarded. Note, we don't both to add id to recentRejects\n+                // as it's expected to be quickly clean up during IBD.\n+                if (ChainstateActive().IsInitialBlockDownload()) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20277#discussion_r515544072",
      "id" : 515544072,
      "line" : 3029,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU0NDA3Mg==",
      "original_commit_id" : "8afa4fa3530389a06ddccd57235493cc7ae806f0",
      "original_line" : 3029,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 11,
      "pull_request_review_id" : 521173493,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20277",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-31T21:53:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515544072",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7217256?v=4",
         "events_url" : "https://api.github.com/users/mjdietzx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mjdietzx/followers",
         "following_url" : "https://api.github.com/users/mjdietzx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mjdietzx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mjdietzx",
         "id" : 7217256,
         "login" : "mjdietzx",
         "node_id" : "MDQ6VXNlcjcyMTcyNTY=",
         "organizations_url" : "https://api.github.com/users/mjdietzx/orgs",
         "received_events_url" : "https://api.github.com/users/mjdietzx/received_events",
         "repos_url" : "https://api.github.com/users/mjdietzx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mjdietzx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mjdietzx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mjdietzx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20277#discussion_r515562121"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20277"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515562121"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good point! I'll update once PR got Concept ACK/NACK.",
      "commit_id" : "8afa4fa3530389a06ddccd57235493cc7ae806f0",
      "created_at" : "2020-11-01T01:31:01Z",
      "diff_hunk" : "@@ -3019,6 +3019,15 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n             if (!fRejectedParents) {\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n+                // To save bandwidth during IBD, stop orphan processing early. With the state of\n+                // our UTXO set far from tip, we might not have yet the unspent output spend by this\n+                // transaction or this transaction is already double-spend but not yet seen block.\n+                // Further, we can't assert accuracy of its feerate.\n+                //\n+                // Orphan transaction is discarded. Note, we don't both to add id to recentRejects\n+                // as it's expected to be quickly clean up during IBD.\n+                if (ChainstateActive().IsInitialBlockDownload()) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20277#discussion_r515562121",
      "id" : 515562121,
      "in_reply_to_id" : 515544072,
      "line" : 3029,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU2MjEyMQ==",
      "original_commit_id" : "8afa4fa3530389a06ddccd57235493cc7ae806f0",
      "original_line" : 3029,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 11,
      "pull_request_review_id" : 521185373,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20277",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-01T01:31:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515562121",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20277#discussion_r515653390"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20277"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515653390"
         }
      },
      "author_association" : "MEMBER",
      "body" : "78b1044 Could you update the name of `INBOUND_PEER_TX_RELAY` for clarity and searchability of its equivalent in the net_processing code?\r\n\r\n```suggestion\r\nTXID_RELAY_DELAY = 2  # seconds\r\n```",
      "commit_id" : "8afa4fa3530389a06ddccd57235493cc7ae806f0",
      "created_at" : "2020-11-01T18:12:39Z",
      "diff_hunk" : "@@ -116,6 +116,9 @@\n     \"signet\": b\"\\x0a\\x03\\xcf\\x40\",    # signet\n }\n \n+# Constants from net_processing\n+INBOUND_PEER_TX_DELAY = 2  # seconds\n+TXID_RELAY_DELAY = 2 # seconds",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20277#discussion_r515653390",
      "id" : 515653390,
      "line" : 121,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY1MzM5MA==",
      "original_commit_id" : "8afa4fa3530389a06ddccd57235493cc7ae806f0",
      "original_line" : 121,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/p2p.py",
      "position" : 6,
      "pull_request_review_id" : 521247512,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20277",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-01T19:47:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515653390",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20277#discussion_r515655202"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20277"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515655202"
         }
      },
      "author_association" : "MEMBER",
      "body" : "78b1044 \r\n\r\n```suggestion\r\n            if (i.type & MSG_TYPE_MASK) in {MSG_TX, MSG_WTX}:\r\n```",
      "commit_id" : "8afa4fa3530389a06ddccd57235493cc7ae806f0",
      "created_at" : "2020-11-01T18:29:44Z",
      "diff_hunk" : "@@ -401,6 +406,11 @@ def on_version(self, message):\n             self.send_message(msg_sendaddrv2())\n         self.nServices = message.nServices\n \n+    def on_getdata(self, message):\n+        for i in message.inv:\n+            if i.type & MSG_TYPE_MASK == MSG_TX or i.type & MSG_TYPE_MASK == MSG_WTX:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20277#discussion_r515655202",
      "id" : 515655202,
      "line" : 411,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY1NTIwMg==",
      "original_commit_id" : "8afa4fa3530389a06ddccd57235493cc7ae806f0",
      "original_line" : 411,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/p2p.py",
      "position" : 34,
      "pull_request_review_id" : 521247512,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20277",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-01T19:47:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515655202",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20277#discussion_r515661399"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20277"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515661399"
         }
      },
      "author_association" : "MEMBER",
      "body" : "8afa4fa s/parent are/parents are/\r\n```suggestion\r\n        sleep(INBOUND_PEER_TX_DELAY + TXID_RELAY_DELAY)\r\n```",
      "commit_id" : "8afa4fa3530389a06ddccd57235493cc7ae806f0",
      "created_at" : "2020-11-01T19:26:57Z",
      "diff_hunk" : "@@ -22,7 +50,50 @@ def set_test_params(self):\n             [\"-minrelaytxfee={}\".format(NORMAL_FEE_FILTER)],\n         ]\n \n-    def run_test(self):\n+    def test_inv_ibd(self):\n+        self.log.info(\"Check that nodes don't request txn while still in IBD\")\n+        peer = self.nodes[0].add_p2p_connection(P2PInterface())\n+        peer.send_message(msg_inv([CInv(t=MSG_WTX, h=0xffaa)]))\n+        # As tx-announcing connection is inbound, wait for the inbound delay applied by requester.\n+        sleep(INBOUND_PEER_TX_DELAY)\n+        peer.sync_with_ping()\n+        with p2p_lock:\n+            assert_equal(peer.tx_getdata_count, 0)\n+        peer.peer_disconnect()\n+        peer.wait_for_disconnect()\n+\n+    def test_orphan_ibd(self):\n+        self.log.info(\"Check that nodes don't request orphan parent while still in IBD\")\n+\n+        # Build an orphan parent tx\n+        witness_program = CScript([OP_TRUE])\n+        witness_hash = sha256(witness_program)\n+        script_pubkey = CScript([OP_0, witness_hash])\n+\n+        tx_parent = CTransaction()\n+        tx_parent.vin.append(CTxIn(outpoint=COutPoint(uint256_from_str(b\"23c70ed7c0506e9178fc1a987f40a33946d4ad4c962b5ae3a52546da53af0c5c\"),\n+ 0)))\n+        tx_parent.vout.append(CTxOut(nValue=50 * COIN - 12000, scriptPubKey=script_pubkey))\n+        tx_parent.calc_sha256()\n+\n+        # Build an orphan tx\n+        tx_orphan = CTransaction()\n+        tx_orphan.vin.append(CTxIn(outpoint=COutPoint(tx_parent.sha256, 0)))\n+        tx_orphan.vout = [CTxOut(nValue=10 * COIN, scriptPubKey=script_pubkey)]\n+        tx_orphan.calc_sha256()\n+\n+        peer = self.nodes[0].add_p2p_connection(P2PInterface())\n+        peer.send_message(msg_tx(tx_orphan))\n+        # As tx-announcing connection is inbound, wait for the inbound delay applied by requester.\n+        # Also apply the txid delay as orphan parent are requested in the legacy way.\n+        sleep(INBOUND_PEER_TX_DELAY+TXID_RELAY_DELAY)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20277#discussion_r515661399",
      "id" : 515661399,
      "line" : 89,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY2MTM5OQ==",
      "original_commit_id" : "8afa4fa3530389a06ddccd57235493cc7ae806f0",
      "original_line" : 89,
      "original_position" : 79,
      "original_start_line" : null,
      "path" : "test/functional/p2p_ibd_txrelay.py",
      "position" : 79,
      "pull_request_review_id" : 521247512,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20277",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-01T19:47:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515661399",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20277#discussion_r515661758"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20277"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515661758"
         }
      },
      "author_association" : "MEMBER",
      "body" : "2ada3103 tabulation is off for all of the added imports, should be 4 spaces\r\n",
      "commit_id" : "8afa4fa3530389a06ddccd57235493cc7ae806f0",
      "created_at" : "2020-11-01T19:29:59Z",
      "diff_hunk" : "@@ -6,8 +6,36 @@\n \n from decimal import Decimal\n \n-from test_framework.messages import COIN\n+from time import sleep\n+\n+from test_framework.messages import (\n+        COIN,\n+        COutPoint,\n+        CTransaction,\n+        CTxIn,\n+        CTxOut,\n+        CInv,\n+        MSG_WTX,\n+        msg_inv,\n+        msg_tx,\n+        sha256,\n+        uint256_from_str\n+)\n+from test_framework.p2p import (\n+        P2PInterface,\n+        p2p_lock,\n+        INBOUND_PEER_TX_DELAY,\n+        TXID_RELAY_DELAY,\n+)\n from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.script import (\n+        CScript,\n+        OP_TRUE,\n+        OP_0,\n+)\n+from test_framework.util import (\n+        assert_equal,\n+)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20277#discussion_r515661758",
      "id" : 515661758,
      "line" : 38,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY2MTc1OA==",
      "original_commit_id" : "8afa4fa3530389a06ddccd57235493cc7ae806f0",
      "original_line" : 38,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "test/functional/p2p_ibd_txrelay.py",
      "position" : 34,
      "pull_request_review_id" : 521247512,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20277",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-01T19:47:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515661758",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20277#discussion_r515662647"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20277"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515662647"
         }
      },
      "author_association" : "MEMBER",
      "body" : "d65dca43 partial WIP suggestions, though I think it could still be more clearly written\r\n```diff\r\n-                // To save bandwidth during IBD, stop orphan processing early. With the state of\r\n-                // our UTXO set far from tip, we might not have yet the unspent output spend by this\r\n-                // transaction or this transaction is already double-spend but not yet seen block.\r\n-                // Further, we can't assert accuracy of its feerate.\r\n+                // If we are in IBD, exit from orphan processing early to save bandwidth. With the\r\n+                // state of our UTXO set far from the tip, we might not yet have the unspent output\r\n+                // of this transaction, or the transaction is already double-spent but not yet\r\n+                // included in a block. We also cannot assert the accuracy of its feerate.\r\n                 //\r\n-                // Orphan transaction is discarded. Note, we don't both to add id to recentRejects\r\n-                // as it's expected to be quickly clean up during IBD.\r\n-                if (ChainstateActive().IsInitialBlockDownload()) return;\r\n+                // Orphan transaction is discarded. We don't bother to add it to recentRejects, as\r\n+                // it's expected to be quickly cleaned up during IBD.\r\n+                if (::ChainstateActive().IsInitialBlockDownload()) return;\r\n```\r\n\"it's expected\" is somewhat ambiguous, could you use an explicit subject?",
      "commit_id" : "8afa4fa3530389a06ddccd57235493cc7ae806f0",
      "created_at" : "2020-11-01T19:38:28Z",
      "diff_hunk" : "@@ -3019,6 +3019,15 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n             if (!fRejectedParents) {\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n+                // To save bandwidth during IBD, stop orphan processing early. With the state of\n+                // our UTXO set far from tip, we might not have yet the unspent output spend by this\n+                // transaction or this transaction is already double-spend but not yet seen block.\n+                // Further, we can't assert accuracy of its feerate.\n+                //\n+                // Orphan transaction is discarded. Note, we don't both to add id to recentRejects\n+                // as it's expected to be quickly clean up during IBD.\n+                if (ChainstateActive().IsInitialBlockDownload()) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20277#discussion_r515662647",
      "id" : 515662647,
      "line" : 3029,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY2MjY0Nw==",
      "original_commit_id" : "8afa4fa3530389a06ddccd57235493cc7ae806f0",
      "original_line" : 3029,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 11,
      "pull_request_review_id" : 521247512,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20277",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-01T19:51:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515662647",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "How much difference is this going to make in practice? For a node without incoming connections it seems unlikely to have peers that don't support the `feefilter` message. For a node with incoming connections, minor traffic waste doesn't seem to be a concern.",
      "created_at" : "2020-11-02T07:33:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20277#issuecomment-720293190",
      "id" : 720293190,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20277",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMDI5MzE5MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-02T07:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/720293190",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2020-11-02T15:11:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20277#issuecomment-720531320",
      "id" : 720531320,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20277",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMDUzMTMyMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-02T15:11:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/720531320",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/60179867?v=4",
         "events_url" : "https://api.github.com/users/decryp2kanon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/decryp2kanon/followers",
         "following_url" : "https://api.github.com/users/decryp2kanon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/decryp2kanon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/decryp2kanon",
         "id" : 60179867,
         "login" : "decryp2kanon",
         "node_id" : "MDQ6VXNlcjYwMTc5ODY3",
         "organizations_url" : "https://api.github.com/users/decryp2kanon/orgs",
         "received_events_url" : "https://api.github.com/users/decryp2kanon/received_events",
         "repos_url" : "https://api.github.com/users/decryp2kanon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/decryp2kanon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/decryp2kanon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/decryp2kanon"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Ð¿Ð½, 2 Ð½Ð¾ÑÐ±. 2020 Ð³., 21:14 kanon <notifications@github.com>:\n\n> Concept ACK\n>\n> â\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/20277#issuecomment-720531320>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/ARSZ5F2X63EGAE65OJU3BE3SN3EFDANCNFSM4TFSVFRA>\n> .\n>\n",
      "created_at" : "2020-11-02T15:21:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20277#issuecomment-720537549",
      "id" : 720537549,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20277",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMDUzNzU0OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-02T15:21:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/720537549",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/73768599?v=4",
         "events_url" : "https://api.github.com/users/BARMOLEY007/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BARMOLEY007/followers",
         "following_url" : "https://api.github.com/users/BARMOLEY007/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BARMOLEY007/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BARMOLEY007",
         "id" : 73768599,
         "login" : "BARMOLEY007",
         "node_id" : "MDQ6VXNlcjczNzY4NTk5",
         "organizations_url" : "https://api.github.com/users/BARMOLEY007/orgs",
         "received_events_url" : "https://api.github.com/users/BARMOLEY007/received_events",
         "repos_url" : "https://api.github.com/users/BARMOLEY007/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BARMOLEY007/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BARMOLEY007/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BARMOLEY007"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20277#discussion_r516351204"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20277"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516351204"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Switched to NONPREF_PEER_TX_RELAY.",
      "commit_id" : "8afa4fa3530389a06ddccd57235493cc7ae806f0",
      "created_at" : "2020-11-03T00:09:51Z",
      "diff_hunk" : "@@ -116,6 +116,9 @@\n     \"signet\": b\"\\x0a\\x03\\xcf\\x40\",    # signet\n }\n \n+# Constants from net_processing\n+INBOUND_PEER_TX_DELAY = 2  # seconds\n+TXID_RELAY_DELAY = 2 # seconds",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20277#discussion_r516351204",
      "id" : 516351204,
      "in_reply_to_id" : 515653390,
      "line" : 121,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM1MTIwNA==",
      "original_commit_id" : "8afa4fa3530389a06ddccd57235493cc7ae806f0",
      "original_line" : 121,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/p2p.py",
      "position" : 6,
      "pull_request_review_id" : 522118957,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20277",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T00:09:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516351204",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20277#discussion_r516362195"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20277"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516362195"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes this is the recentRejects filter. I did modify the comment to underscore that during IBD blocks are received fast and thus the filter quickly cleanup in consequence.",
      "commit_id" : "8afa4fa3530389a06ddccd57235493cc7ae806f0",
      "created_at" : "2020-11-03T00:33:52Z",
      "diff_hunk" : "@@ -3019,6 +3019,15 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n             if (!fRejectedParents) {\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n+                // To save bandwidth during IBD, stop orphan processing early. With the state of\n+                // our UTXO set far from tip, we might not have yet the unspent output spend by this\n+                // transaction or this transaction is already double-spend but not yet seen block.\n+                // Further, we can't assert accuracy of its feerate.\n+                //\n+                // Orphan transaction is discarded. Note, we don't both to add id to recentRejects\n+                // as it's expected to be quickly clean up during IBD.\n+                if (ChainstateActive().IsInitialBlockDownload()) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20277#discussion_r516362195",
      "id" : 516362195,
      "in_reply_to_id" : 515662647,
      "line" : 3029,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM2MjE5NQ==",
      "original_commit_id" : "8afa4fa3530389a06ddccd57235493cc7ae806f0",
      "original_line" : 3029,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 11,
      "pull_request_review_id" : 522123794,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20277",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T00:33:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516362195",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke \r\n\r\nRight, I should have explicit the assumption on sender, that they are non-Bitcoin Core clients. Thus we can't be certain they enforce the regular tx-relay flow inv,getdata,tx but might send directly txn, don't bothering with any `feefilter` at all nor sending an inv first.\r\n\r\nI agree that the waste is likely to be minor in any-case, but note that this PR is aiming to align behavior with current inv-reception code (L2690) as described in PR description. This point has the added benefit to make easier to reason on holistic tx-relay behavior when we review more important p2p stuff, IMHO.",
      "created_at" : "2020-11-03T00:46:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20277#issuecomment-720808689",
      "id" : 720808689,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20277",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMDgwODY4OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-03T00:47:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/720808689",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This seems like an extremely verbose PR to modify an unlikely and unimportant edge case. We don't expect to process unconfirmed transactions during IBD for a couple of reasons:\r\n\r\n- we'll send a feefilter set to MAX_MONEY, telling our peers not to INV transactions to us.\r\n- we'll ignore INVs for transactions.\r\n\r\nSo a peer would need to send us an unsolicited tx ignoring our feefilter for us to even reach this logic. It seems inconsistent to process that transaction as normal, but not do the normal orphan processing logic too.\r\n\r\nWe could modify the transaction processing logic to ignore all tx messages during IBD, which seems reasonable and at least consistent. I don't think we need a 10 line comment and 100 line test case to justify that - just say that we don't process unconfirmed transactions during IBD.",
      "created_at" : "2020-11-04T12:23:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20277#issuecomment-721701255",
      "id" : 721701255,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20277",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMTcwMTI1NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-04T12:23:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/721701255",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I tend to agree with @jnewbery that just ignoring all unrequested transactions during IBD would make more sense, but I'd go further and suggest we generally ignore all unrequested transactions (perhaps excepting peers with PF_RELAY permission), to mitigate potential CPU DoS.",
      "created_at" : "2020-11-04T16:02:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20277#issuecomment-721819763",
      "id" : 721819763,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20277",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMTgxOTc2Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-04T16:02:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/721819763",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   }
]
