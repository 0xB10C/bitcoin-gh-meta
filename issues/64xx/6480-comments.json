[
   {
      "body" : "No objection, but I think it would make more sense to have an UpdatedTip signal in ValidationInterface which passed this just once, and let CWallets cache this value.",
      "created_at" : "2015-07-27T14:34:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6480#issuecomment-125226980",
      "id" : 125226980,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6480",
      "updated_at" : "2015-07-27T14:34:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/125226980",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I think the `SetBestChain()` is already there for a such case (tip was updated).\r\nHaving the `CBlockIndex` together with the `CBlock` would make sure we get the data together with the transaction to avoid deltas.\r\nAnd this solution has one **big plus**: the wallet(s) can detect if the transaction is in the mempool or not because the mempool SyncTransaction gives for `CBlock` as well as for `CBlockIndex` a `NULL` value where the disconnect block only leaves `CBlock` to null.\r\n\r\nI think this could potentially decouple the wallet from the mempool.",
      "created_at" : "2015-07-27T14:41:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6480#issuecomment-125229516",
      "id" : 125229516,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6480",
      "updated_at" : "2015-07-27T14:41:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/125229516",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "SetBestChain is only called occasionally, and only when data is being flushed to disk.\r\n",
      "created_at" : "2015-07-27T14:46:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6480#issuecomment-125231328",
      "id" : 125231328,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6480",
      "updated_at" : "2015-07-27T14:46:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/125231328",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Ah, I see, this passes the block index entry in which a transaction was found - which is not necessarily the current tip (for example during rescan).\r\n\r\nUntested ACK.",
      "created_at" : "2015-07-27T14:47:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6480#issuecomment-125231627",
      "id" : 125231627,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6480",
      "updated_at" : "2015-07-27T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/125231627",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I see the problem with `SetBestChain()`...\r\nSo it would make sense to have an UpdateTip() signal next to the conditional variable (https://github.com/bitcoin/bitcoin/blob/master/src/main.cpp#L1995)?",
      "created_at" : "2015-07-27T14:58:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6480#issuecomment-125236761",
      "id" : 125236761,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6480",
      "updated_at" : "2015-07-27T14:58:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/125236761",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@jonasschnelli IMHO, yes. Note that that code position always has cs_main held, so listeners to such an UpdateTip signal couldn't do much (but updating a cached variable with the lastest best block is fine and useful).",
      "created_at" : "2015-07-27T15:07:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6480#issuecomment-125239810",
      "id" : 125239810,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6480",
      "updated_at" : "2015-07-27T15:07:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/125239810",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa: just detected that an additional UpdateTip() signal is unnecessary, because with this PR a wallet could keep track of the chaintip over the `SyncTranscation()` signal (connectTip and disconnectTip sends both a syncTransaction with the current chaintip), which a wallet could therefore compare and store locally.\r\nI try to reduce the `cs_main` locking to a very minimum and later even to zero (interact over RPC/ZMQ). I need a way now to avoid deadlocking risks and therefore keep `cs_main` away from the wallet code.",
      "created_at" : "2015-07-27T16:12:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6480#issuecomment-125259210",
      "id" : 125259210,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6480",
      "updated_at" : "2015-07-27T16:12:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/125259210",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@jonasschnelli So a wallet that does not have any new transactions coming in won't know what the current tip is? The wallet needs that information to compute confirmations. Right now, those checks require a call to main (CMerkleTx::GetDepthInMainChainINTERNAL) with associated cs_main lock. If we'd keep CBlockIndex pointers for the wallet transactions, and keep a copy of the tip (via an UpdateTip) in the wallet, all of that could become independent.\r\n\r\nAlso, it's probably better to issue such an UpdateTip signal in ActivateBestChain, near the uiInterface.NotifyBlockTip call (or replace it...). That has no locks held, and guarantees a stable tip (UpdateTip() may be called in the middle of reorganizations).\r\n\r\nEDIT: Sorry @jonasschnelli I skipped the part between brackets. You're right of course - I was somehow assuming that SyncTransaction would only be called when there were matching wallet transactions.",
      "created_at" : "2015-07-27T16:19:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6480#issuecomment-125261315",
      "id" : 125261315,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6480",
      "updated_at" : "2015-07-27T16:21:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/125261315",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Agreed. Added a commit which would add a `UpdateTip()` signal.",
      "created_at" : "2015-07-27T16:39:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6480#issuecomment-125267315",
      "id" : 125267315,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6480",
      "updated_at" : "2015-07-27T16:39:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/125267315",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Needs rebase",
      "created_at" : "2015-10-06T09:00:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6480#issuecomment-145791110",
      "id" : 145791110,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6480",
      "updated_at" : "2015-10-06T09:00:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/145791110",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Rebased.\r\nRemoved the `UpdateTip()` signal because it was already added during the ZMQ integration.",
      "created_at" : "2015-10-06T09:27:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6480#issuecomment-145796796",
      "id" : 145796796,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6480",
      "updated_at" : "2015-10-06T09:27:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/145796796",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@jonasschnelli Needs travis kicked again. (Unrelated error, it seems)",
      "created_at" : "2015-11-16T16:01:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6480#issuecomment-157079620",
      "id" : 157079620,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6480",
      "updated_at" : "2015-11-16T16:01:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/157079620",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
