[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20267 (Disable and fix tests for when BDB is not compiled by achow101)\n* #20234 (net: don't extra bind for Tor if binds are restricted by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-10-20T14:37:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#issuecomment-712900844",
      "id" : 712900844,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20196",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxMjkwMDg0NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-26T11:29:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/712900844",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r509346608"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509346608"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I believe this can be written shorter\r\n\r\n```suggestion\r\n            local = next(l for l in self.nodes[i].getnetworkinfo()['localaddresses'] if l['address'] == '2.2.2.2')\r\n            assert_equal(local['port'], expected_port)\r\n```",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-21T14:40:21Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test that the proper port is used for -externalip=\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import assert_equal\n+\n+# We need to bind to a routable address for this test to exercise the relevant code.\n+# To set a routable IP address on the machine use:\n+# Linux:\n+# ifconfig lo:0 1.1.1.1/32 up  # to set up\n+# ifconfig lo:0 down  # to remove it, after the test\n+# FreeBSD:\n+# ifconfig lo0 1.1.1.1/32 alias  # to set up\n+# ifconfig lo0 1.1.1.1 -alias  # to remove it, after the test\n+addr = '1.1.1.1'\n+\n+# array of tuples [arguments, expected port in localaddresses]\n+expected = [\n+    [['-externalip=2.2.2.2',       '-port=20001'                               ], 20001],\n+    [['-externalip=2.2.2.2',       '-port=20002', '-bind={}'.format(addr)],       20002],\n+    [['-externalip=2.2.2.2',                      '-bind={}'.format(addr)],       11002],\n+    [['-externalip=2.2.2.2',       '-port=20003', '-bind={}:20004'.format(addr)], 20004],\n+    [['-externalip=2.2.2.2',                      '-bind={}:20005'.format(addr)], 20005],\n+    [['-externalip=2.2.2.2:20006', '-port=20007'                               ], 20006],\n+    [['-externalip=2.2.2.2:20008', '-port=20009', '-bind={}'.format(addr)],       20008],\n+    [['-externalip=2.2.2.2:20010',                '-bind={}'.format(addr)],       20010],\n+    [['-externalip=2.2.2.2:20011', '-port=20012', '-bind={}:20013'.format(addr)], 20011],\n+    [['-externalip=2.2.2.2:20014',                '-bind={}:20015'.format(addr)], 20014],\n+    [['-externalip=2.2.2.2',       '-port=20016', '-bind={}:20017'.format(addr),\n+                                             '-whitebind={}:20018'.format(addr)], 20017],\n+    [['-externalip=2.2.2.2',       '-port=20019',\n+                                             '-whitebind={}:20020'.format(addr)], 20020],\n+]\n+\n+class BindPortTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        # Avoid any -bind= on the command line. Force the framework to avoid adding -bind=127.0.0.1.\n+        self.setup_clean_chain = True\n+        self.bind_to_localhost_only = False\n+        self.num_nodes = len(expected)\n+\n+    def add_options(self, parser):\n+        parser.add_argument(\n+            \"--ihave1111\", action='store_true', dest=\"ihave1111\",\n+            help=\"Run the test, assuming {} is configured on the machine\".format(addr),\n+            default=False)\n+\n+    def setup_nodes(self):\n+        if not self.options.ihave1111:\n+            raise SkipTest(\n+                \"To run this test make sure that {} (a routable address) is assigned \"\n+                \"to one of the interfaces on this machine and rerun with --ihave1111\".format(addr))\n+        args = []\n+        for t in expected:\n+            args.append(t[0])\n+        self.add_nodes(self.num_nodes, extra_args=args)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        for i in range(len(expected)):\n+            expected_port = expected[i][1]\n+            found = False\n+            for local in self.nodes[i].getnetworkinfo()['localaddresses']:\n+                if local['address'] == '2.2.2.2':\n+                    assert_equal(local['port'], expected_port)\n+                    found = True\n+                    break\n+            assert(found)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r509346608",
      "id" : 509346608,
      "line" : 72,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM0NjYwOA==",
      "original_commit_id" : "e6c3de7178ff3e2b0961e71635729bbfe6784f1e",
      "original_line" : 72,
      "original_position" : 73,
      "original_start_line" : 67,
      "path" : "test/functional/feature_bind_port_externalip.py",
      "position" : 72,
      "pull_request_review_id" : 513764292,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : 66,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509346608",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r509350641"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509350641"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Does this need to be overwritten? You can use `skip_test_if_missing_module`",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-21T14:45:00Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test that the proper port is used for -externalip=\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import assert_equal\n+\n+# We need to bind to a routable address for this test to exercise the relevant code.\n+# To set a routable IP address on the machine use:\n+# Linux:\n+# ifconfig lo:0 1.1.1.1/32 up  # to set up\n+# ifconfig lo:0 down  # to remove it, after the test\n+# FreeBSD:\n+# ifconfig lo0 1.1.1.1/32 alias  # to set up\n+# ifconfig lo0 1.1.1.1 -alias  # to remove it, after the test\n+addr = '1.1.1.1'\n+\n+# array of tuples [arguments, expected port in localaddresses]\n+expected = [\n+    [['-externalip=2.2.2.2',       '-port=20001'                               ], 20001],\n+    [['-externalip=2.2.2.2',       '-port=20002', '-bind={}'.format(addr)],       20002],\n+    [['-externalip=2.2.2.2',                      '-bind={}'.format(addr)],       11002],\n+    [['-externalip=2.2.2.2',       '-port=20003', '-bind={}:20004'.format(addr)], 20004],\n+    [['-externalip=2.2.2.2',                      '-bind={}:20005'.format(addr)], 20005],\n+    [['-externalip=2.2.2.2:20006', '-port=20007'                               ], 20006],\n+    [['-externalip=2.2.2.2:20008', '-port=20009', '-bind={}'.format(addr)],       20008],\n+    [['-externalip=2.2.2.2:20010',                '-bind={}'.format(addr)],       20010],\n+    [['-externalip=2.2.2.2:20011', '-port=20012', '-bind={}:20013'.format(addr)], 20011],\n+    [['-externalip=2.2.2.2:20014',                '-bind={}:20015'.format(addr)], 20014],\n+    [['-externalip=2.2.2.2',       '-port=20016', '-bind={}:20017'.format(addr),\n+                                             '-whitebind={}:20018'.format(addr)], 20017],\n+    [['-externalip=2.2.2.2',       '-port=20019',\n+                                             '-whitebind={}:20020'.format(addr)], 20020],\n+]\n+\n+class BindPortTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        # Avoid any -bind= on the command line. Force the framework to avoid adding -bind=127.0.0.1.\n+        self.setup_clean_chain = True\n+        self.bind_to_localhost_only = False\n+        self.num_nodes = len(expected)\n+\n+    def add_options(self, parser):\n+        parser.add_argument(\n+            \"--ihave1111\", action='store_true', dest=\"ihave1111\",\n+            help=\"Run the test, assuming {} is configured on the machine\".format(addr),\n+            default=False)\n+\n+    def setup_nodes(self):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r509350641",
      "id" : 509350641,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM1MDY0MQ==",
      "original_commit_id" : "e6c3de7178ff3e2b0961e71635729bbfe6784f1e",
      "original_line" : 53,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "test/functional/feature_bind_port_externalip.py",
      "position" : null,
      "pull_request_review_id" : 513764292,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509350641",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r509350836"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509350836"
         }
      },
      "author_association" : "MEMBER",
      "body" : "uppercase constants",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-21T14:45:16Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test that the proper port is used for -externalip=\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import assert_equal\n+\n+# We need to bind to a routable address for this test to exercise the relevant code.\n+# To set a routable IP address on the machine use:\n+# Linux:\n+# ifconfig lo:0 1.1.1.1/32 up  # to set up\n+# ifconfig lo:0 down  # to remove it, after the test\n+# FreeBSD:\n+# ifconfig lo0 1.1.1.1/32 alias  # to set up\n+# ifconfig lo0 1.1.1.1 -alias  # to remove it, after the test\n+addr = '1.1.1.1'\n+\n+# array of tuples [arguments, expected port in localaddresses]\n+expected = [",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r509350836",
      "id" : 509350836,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM1MDgzNg==",
      "original_commit_id" : "e6c3de7178ff3e2b0961e71635729bbfe6784f1e",
      "original_line" : 23,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "test/functional/feature_bind_port_externalip.py",
      "position" : null,
      "pull_request_review_id" : 513764292,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509350836",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r509351706"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509351706"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        static_cast<uint16_t>(args.GetArg(\"-port\", Params().GetDefaultPort()));\r\n```",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-21T14:46:18Z",
      "diff_hunk" : "@@ -1944,11 +1942,15 @@ bool AppInitMain(const util::Ref& context, NodeContext& node, interfaces::BlockA\n     connOptions.nMaxOutboundLimit = nMaxOutboundLimit;\n     connOptions.m_peer_connect_timeout = peer_connect_timeout;\n \n+    // Port to bind to if `-bind=addr` is provided without a `:port` suffix.\n+    const uint16_t default_bind_port =\n+        static_cast<uint16_t>(gArgs.GetArg(\"-port\", Params().GetDefaultPort()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r509351706",
      "id" : 509351706,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM1MTcwNg==",
      "original_commit_id" : "e6c3de7178ff3e2b0961e71635729bbfe6784f1e",
      "original_line" : 1947,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 513764292,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509351706",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r509353895"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509353895"
         }
      },
      "author_association" : "MEMBER",
      "body" : "would be good to remove the global here, but that can be done in a follow-up",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-21T14:48:49Z",
      "diff_hunk" : "@@ -677,8 +682,80 @@ BOOST_AUTO_TEST_CASE(ipv4_peer_with_ipv6_addrMe_test)\n \n     // suppress no-checks-run warning; if this test fails, it's by triggering a sanitizer\n     BOOST_CHECK(1);\n+\n+    // Cleanup, so that we don't confuse other tests.\n+    {\n+        LOCK(cs_mapLocalHost);\n+        mapLocalHost.erase(addr_in_mapLocalHost);\n+    }\n }\n \n+BOOST_AUTO_TEST_CASE(advertise_local_port)\n+{\n+    // Test that AdvertiseLocal() properly self-advertises us:\n+    //\n+    // 1. AdvertiseLocal() calls GetLocalAddress() which returns an address that is not routable.\n+    // 2. AdvertiseLocal() overrides the address with whatever the peer has told us he sees us as.\n+    // 2.1. For inbound connections we must override both the address and the port.\n+    // 2.2. For outbound connections we must override only the address.\n+\n+    // Pretend that we bound to this port.\n+    const uint16_t bind_port = 20001;\n+    gArgs.ForceSetArg(\"-bind\", strprintf(\"3.4.5.6:%u\", bind_port));\n+\n+    // Our address:port as seen from the peer.\n+    in_addr peer_us_addr;\n+    peer_us_addr.s_addr = htonl(0x02030405);\n+    const CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\n+\n+    // Create a peer with a routable IPv4 address (outbound).\n+    in_addr peer_out_in_addr;\n+    peer_out_in_addr.s_addr = htonl(0x01020304);\n+    CNode peer_out{0,\n+                   NODE_NETWORK,\n+                   0,\n+                   INVALID_SOCKET,\n+                   CAddress{CService{peer_out_in_addr, 8333}, NODE_NETWORK},\n+                   0,\n+                   0,\n+                   CAddress{},\n+                   std::string{},\n+                   ConnectionType::OUTBOUND_FULL_RELAY};\n+    peer_out.fSuccessfullyConnected = true;\n+    peer_out.SetAddrLocal(peer_us);\n+\n+    AdvertiseLocal(&peer_out);\n+\n+    // Without the fix peer_us:8333 ends up in vAddrToSend instead of the proper peer_us:bind_port.\n+    const CAddress expected{CService{peer_us_addr, bind_port}, NODE_NETWORK};\n+    BOOST_CHECK(std::any_of(peer_out.vAddrToSend.begin(), peer_out.vAddrToSend.end(),\n+                            [&expected](const CAddress& cur) { return cur == expected; }));\n+\n+    // Create a peer with a routable IPv4 address (inbound).\n+    in_addr peer_in_in_addr;\n+    peer_in_in_addr.s_addr = htonl(0x05060708);\n+    CNode peer_in{0,\n+                  NODE_NETWORK,\n+                  0,\n+                  INVALID_SOCKET,\n+                  CAddress{CService{peer_in_in_addr, 8333}, NODE_NETWORK},\n+                  0,\n+                  0,\n+                  CAddress{},\n+                  std::string{},\n+                  ConnectionType::INBOUND};\n+    peer_in.fSuccessfullyConnected = true;\n+    peer_in.SetAddrLocal(peer_us);\n+\n+    AdvertiseLocal(&peer_in);\n+\n+    // Without the fix peer_us:8333 ends up in vAddrToSend instead of the proper\n+    // peer_us:peer_us.GetPort().\n+    BOOST_CHECK(std::any_of(peer_in.vAddrToSend.begin(), peer_in.vAddrToSend.end(),\n+                            [&peer_us](const CAddress& cur) { return cur == peer_us; }));\n+\n+    gArgs.ForceSetArg(\"-bind\", \"\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r509353895",
      "id" : 509353895,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM1Mzg5NQ==",
      "original_commit_id" : "e6c3de7178ff3e2b0961e71635729bbfe6784f1e",
      "original_line" : 757,
      "original_position" : 131,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 513764292,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509353895",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r509355760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509355760"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can be written shorter\r\n\r\n```suggestion\r\n    generatetoaddress(m_node, ADDRESS_BCRT1_UNSPENDABLE);\r\n```",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-21T14:51:02Z",
      "diff_hunk" : "@@ -769,4 +846,62 @@ BOOST_AUTO_TEST_CASE(PoissonNextSend)\n     g_mock_deterministic_tests = false;\n }\n \n+BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n+{\n+    // Pretend that we bound to this port.\n+    const uint16_t bind_port = 20001;\n+    gArgs.ForceSetArg(\"-bind\", strprintf(\"3.4.5.6:%u\", bind_port));\n+\n+    // Our address:port as seen from the peer.\n+    in_addr peer_us_addr;\n+    peer_us_addr.s_addr = htonl(0x02030405);\n+    const CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\n+\n+    // Create a peer with a routable IPv4 address.\n+    in_addr peer_in_addr;\n+    peer_in_addr.s_addr = htonl(0x01020304);\n+    CNode peer{0,\n+               NODE_NETWORK,\n+               0,\n+               INVALID_SOCKET,\n+               CAddress{CService{peer_in_addr, 8333}, NODE_NETWORK},\n+               0,\n+               0,\n+               CAddress{},\n+               std::string{},\n+               ConnectionType::OUTBOUND_FULL_RELAY};\n+\n+    const uint64_t services{NODE_NETWORK | NODE_WITNESS};\n+    const int64_t time{0};\n+    // Our address, as seen from the peer.\n+    const CNetMsgMaker msg_maker{PROTOCOL_VERSION};\n+    const auto msg = msg_maker.Make(NetMsgType::VERSION, PROTOCOL_VERSION, services, time, peer_us);\n+\n+    CDataStream recv_stream{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+\n+    // Force CChainState::IsInitialBlockDownload() to return false.\n+    const auto nMinimumChainWork_orig = nMinimumChainWork;\n+    const auto nMaxTipAge_orig = nMaxTipAge;\n+    nMinimumChainWork = 0;\n+    nMaxTipAge = GetTime();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r509355760",
      "id" : 509355760,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM1NTc2MA==",
      "original_commit_id" : "e6c3de7178ff3e2b0961e71635729bbfe6784f1e",
      "original_line" : 887,
      "original_position" : 177,
      "original_start_line" : 883,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 513764292,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509355760",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510003013"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510003013"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`raise SkipTest()` is not the main reason to override `setup_nodes()`. It is necessary to specify the command line arguments for each bitcoind node. The current test does that by `self.add_nodes(..., extra_args=my_variable_here)` in `setup_nodes()`. Other tests do that either in `setup_nodes()` or `setup_network()`.\r\n\r\nIs there a better way?",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-22T09:09:43Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test that the proper port is used for -externalip=\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import assert_equal\n+\n+# We need to bind to a routable address for this test to exercise the relevant code.\n+# To set a routable IP address on the machine use:\n+# Linux:\n+# ifconfig lo:0 1.1.1.1/32 up  # to set up\n+# ifconfig lo:0 down  # to remove it, after the test\n+# FreeBSD:\n+# ifconfig lo0 1.1.1.1/32 alias  # to set up\n+# ifconfig lo0 1.1.1.1 -alias  # to remove it, after the test\n+addr = '1.1.1.1'\n+\n+# array of tuples [arguments, expected port in localaddresses]\n+expected = [\n+    [['-externalip=2.2.2.2',       '-port=20001'                               ], 20001],\n+    [['-externalip=2.2.2.2',       '-port=20002', '-bind={}'.format(addr)],       20002],\n+    [['-externalip=2.2.2.2',                      '-bind={}'.format(addr)],       11002],\n+    [['-externalip=2.2.2.2',       '-port=20003', '-bind={}:20004'.format(addr)], 20004],\n+    [['-externalip=2.2.2.2',                      '-bind={}:20005'.format(addr)], 20005],\n+    [['-externalip=2.2.2.2:20006', '-port=20007'                               ], 20006],\n+    [['-externalip=2.2.2.2:20008', '-port=20009', '-bind={}'.format(addr)],       20008],\n+    [['-externalip=2.2.2.2:20010',                '-bind={}'.format(addr)],       20010],\n+    [['-externalip=2.2.2.2:20011', '-port=20012', '-bind={}:20013'.format(addr)], 20011],\n+    [['-externalip=2.2.2.2:20014',                '-bind={}:20015'.format(addr)], 20014],\n+    [['-externalip=2.2.2.2',       '-port=20016', '-bind={}:20017'.format(addr),\n+                                             '-whitebind={}:20018'.format(addr)], 20017],\n+    [['-externalip=2.2.2.2',       '-port=20019',\n+                                             '-whitebind={}:20020'.format(addr)], 20020],\n+]\n+\n+class BindPortTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        # Avoid any -bind= on the command line. Force the framework to avoid adding -bind=127.0.0.1.\n+        self.setup_clean_chain = True\n+        self.bind_to_localhost_only = False\n+        self.num_nodes = len(expected)\n+\n+    def add_options(self, parser):\n+        parser.add_argument(\n+            \"--ihave1111\", action='store_true', dest=\"ihave1111\",\n+            help=\"Run the test, assuming {} is configured on the machine\".format(addr),\n+            default=False)\n+\n+    def setup_nodes(self):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510003013",
      "id" : 510003013,
      "in_reply_to_id" : 509350641,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDAwMzAxMw==",
      "original_commit_id" : "e6c3de7178ff3e2b0961e71635729bbfe6784f1e",
      "original_line" : 53,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "test/functional/feature_bind_port_externalip.py",
      "position" : null,
      "pull_request_review_id" : 514516183,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510003013",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510005534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510005534"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "To me that is less readable. Maybe my python level is poor, but then maybe other readers of this are also poor pythoners. I prefer to keep it simple stupid:\r\n```\r\nfor ...\r\n    if ...\r\n        break\r\n```\r\nthat is nearly the same in any programming language.",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-22T09:13:22Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test that the proper port is used for -externalip=\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import assert_equal\n+\n+# We need to bind to a routable address for this test to exercise the relevant code.\n+# To set a routable IP address on the machine use:\n+# Linux:\n+# ifconfig lo:0 1.1.1.1/32 up  # to set up\n+# ifconfig lo:0 down  # to remove it, after the test\n+# FreeBSD:\n+# ifconfig lo0 1.1.1.1/32 alias  # to set up\n+# ifconfig lo0 1.1.1.1 -alias  # to remove it, after the test\n+addr = '1.1.1.1'\n+\n+# array of tuples [arguments, expected port in localaddresses]\n+expected = [\n+    [['-externalip=2.2.2.2',       '-port=20001'                               ], 20001],\n+    [['-externalip=2.2.2.2',       '-port=20002', '-bind={}'.format(addr)],       20002],\n+    [['-externalip=2.2.2.2',                      '-bind={}'.format(addr)],       11002],\n+    [['-externalip=2.2.2.2',       '-port=20003', '-bind={}:20004'.format(addr)], 20004],\n+    [['-externalip=2.2.2.2',                      '-bind={}:20005'.format(addr)], 20005],\n+    [['-externalip=2.2.2.2:20006', '-port=20007'                               ], 20006],\n+    [['-externalip=2.2.2.2:20008', '-port=20009', '-bind={}'.format(addr)],       20008],\n+    [['-externalip=2.2.2.2:20010',                '-bind={}'.format(addr)],       20010],\n+    [['-externalip=2.2.2.2:20011', '-port=20012', '-bind={}:20013'.format(addr)], 20011],\n+    [['-externalip=2.2.2.2:20014',                '-bind={}:20015'.format(addr)], 20014],\n+    [['-externalip=2.2.2.2',       '-port=20016', '-bind={}:20017'.format(addr),\n+                                             '-whitebind={}:20018'.format(addr)], 20017],\n+    [['-externalip=2.2.2.2',       '-port=20019',\n+                                             '-whitebind={}:20020'.format(addr)], 20020],\n+]\n+\n+class BindPortTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        # Avoid any -bind= on the command line. Force the framework to avoid adding -bind=127.0.0.1.\n+        self.setup_clean_chain = True\n+        self.bind_to_localhost_only = False\n+        self.num_nodes = len(expected)\n+\n+    def add_options(self, parser):\n+        parser.add_argument(\n+            \"--ihave1111\", action='store_true', dest=\"ihave1111\",\n+            help=\"Run the test, assuming {} is configured on the machine\".format(addr),\n+            default=False)\n+\n+    def setup_nodes(self):\n+        if not self.options.ihave1111:\n+            raise SkipTest(\n+                \"To run this test make sure that {} (a routable address) is assigned \"\n+                \"to one of the interfaces on this machine and rerun with --ihave1111\".format(addr))\n+        args = []\n+        for t in expected:\n+            args.append(t[0])\n+        self.add_nodes(self.num_nodes, extra_args=args)\n+        self.start_nodes()\n+\n+    def run_test(self):\n+        for i in range(len(expected)):\n+            expected_port = expected[i][1]\n+            found = False\n+            for local in self.nodes[i].getnetworkinfo()['localaddresses']:\n+                if local['address'] == '2.2.2.2':\n+                    assert_equal(local['port'], expected_port)\n+                    found = True\n+                    break\n+            assert(found)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510005534",
      "id" : 510005534,
      "in_reply_to_id" : 509346608,
      "line" : 72,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDAwNTUzNA==",
      "original_commit_id" : "e6c3de7178ff3e2b0961e71635729bbfe6784f1e",
      "original_line" : 72,
      "original_position" : 73,
      "original_start_line" : 67,
      "path" : "test/functional/feature_bind_port_externalip.py",
      "position" : 72,
      "pull_request_review_id" : 514519379,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : 66,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510005534",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510047632"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510047632"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`CChainState::IsInitialBlockDownload()` still returns `true` :/\r\n\r\n(it was necessary to `s/TestingSetup/RegTestingSetup/` in `BOOST_FIXTURE_TEST_SUITE()` in order to get `generatetoaddress()` to accept `ADDRESS_BCRT1_UNSPENDABLE`)",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-22T10:19:39Z",
      "diff_hunk" : "@@ -769,4 +846,62 @@ BOOST_AUTO_TEST_CASE(PoissonNextSend)\n     g_mock_deterministic_tests = false;\n }\n \n+BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n+{\n+    // Pretend that we bound to this port.\n+    const uint16_t bind_port = 20001;\n+    gArgs.ForceSetArg(\"-bind\", strprintf(\"3.4.5.6:%u\", bind_port));\n+\n+    // Our address:port as seen from the peer.\n+    in_addr peer_us_addr;\n+    peer_us_addr.s_addr = htonl(0x02030405);\n+    const CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\n+\n+    // Create a peer with a routable IPv4 address.\n+    in_addr peer_in_addr;\n+    peer_in_addr.s_addr = htonl(0x01020304);\n+    CNode peer{0,\n+               NODE_NETWORK,\n+               0,\n+               INVALID_SOCKET,\n+               CAddress{CService{peer_in_addr, 8333}, NODE_NETWORK},\n+               0,\n+               0,\n+               CAddress{},\n+               std::string{},\n+               ConnectionType::OUTBOUND_FULL_RELAY};\n+\n+    const uint64_t services{NODE_NETWORK | NODE_WITNESS};\n+    const int64_t time{0};\n+    // Our address, as seen from the peer.\n+    const CNetMsgMaker msg_maker{PROTOCOL_VERSION};\n+    const auto msg = msg_maker.Make(NetMsgType::VERSION, PROTOCOL_VERSION, services, time, peer_us);\n+\n+    CDataStream recv_stream{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+\n+    // Force CChainState::IsInitialBlockDownload() to return false.\n+    const auto nMinimumChainWork_orig = nMinimumChainWork;\n+    const auto nMaxTipAge_orig = nMaxTipAge;\n+    nMinimumChainWork = 0;\n+    nMaxTipAge = GetTime();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510047632",
      "id" : 510047632,
      "in_reply_to_id" : 509355760,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA0NzYzMg==",
      "original_commit_id" : "e6c3de7178ff3e2b0961e71635729bbfe6784f1e",
      "original_line" : 887,
      "original_position" : 177,
      "original_start_line" : 883,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 514574602,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510047632",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510065599"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510065599"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Set `self.extra_args = ...`?",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-22T10:51:21Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test that the proper port is used for -externalip=\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import assert_equal\n+\n+# We need to bind to a routable address for this test to exercise the relevant code.\n+# To set a routable IP address on the machine use:\n+# Linux:\n+# ifconfig lo:0 1.1.1.1/32 up  # to set up\n+# ifconfig lo:0 down  # to remove it, after the test\n+# FreeBSD:\n+# ifconfig lo0 1.1.1.1/32 alias  # to set up\n+# ifconfig lo0 1.1.1.1 -alias  # to remove it, after the test\n+addr = '1.1.1.1'\n+\n+# array of tuples [arguments, expected port in localaddresses]\n+expected = [\n+    [['-externalip=2.2.2.2',       '-port=20001'                               ], 20001],\n+    [['-externalip=2.2.2.2',       '-port=20002', '-bind={}'.format(addr)],       20002],\n+    [['-externalip=2.2.2.2',                      '-bind={}'.format(addr)],       11002],\n+    [['-externalip=2.2.2.2',       '-port=20003', '-bind={}:20004'.format(addr)], 20004],\n+    [['-externalip=2.2.2.2',                      '-bind={}:20005'.format(addr)], 20005],\n+    [['-externalip=2.2.2.2:20006', '-port=20007'                               ], 20006],\n+    [['-externalip=2.2.2.2:20008', '-port=20009', '-bind={}'.format(addr)],       20008],\n+    [['-externalip=2.2.2.2:20010',                '-bind={}'.format(addr)],       20010],\n+    [['-externalip=2.2.2.2:20011', '-port=20012', '-bind={}:20013'.format(addr)], 20011],\n+    [['-externalip=2.2.2.2:20014',                '-bind={}:20015'.format(addr)], 20014],\n+    [['-externalip=2.2.2.2',       '-port=20016', '-bind={}:20017'.format(addr),\n+                                             '-whitebind={}:20018'.format(addr)], 20017],\n+    [['-externalip=2.2.2.2',       '-port=20019',\n+                                             '-whitebind={}:20020'.format(addr)], 20020],\n+]\n+\n+class BindPortTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        # Avoid any -bind= on the command line. Force the framework to avoid adding -bind=127.0.0.1.\n+        self.setup_clean_chain = True\n+        self.bind_to_localhost_only = False\n+        self.num_nodes = len(expected)\n+\n+    def add_options(self, parser):\n+        parser.add_argument(\n+            \"--ihave1111\", action='store_true', dest=\"ihave1111\",\n+            help=\"Run the test, assuming {} is configured on the machine\".format(addr),\n+            default=False)\n+\n+    def setup_nodes(self):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510065599",
      "id" : 510065599,
      "in_reply_to_id" : 509350641,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA2NTU5OQ==",
      "original_commit_id" : "e6c3de7178ff3e2b0961e71635729bbfe6784f1e",
      "original_line" : 53,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "test/functional/feature_bind_port_externalip.py",
      "position" : null,
      "pull_request_review_id" : 514598275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510065599",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510081932"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510081932"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Indeed! Changed, thanks for the suggestion!",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-22T11:21:51Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test that the proper port is used for -externalip=\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import assert_equal\n+\n+# We need to bind to a routable address for this test to exercise the relevant code.\n+# To set a routable IP address on the machine use:\n+# Linux:\n+# ifconfig lo:0 1.1.1.1/32 up  # to set up\n+# ifconfig lo:0 down  # to remove it, after the test\n+# FreeBSD:\n+# ifconfig lo0 1.1.1.1/32 alias  # to set up\n+# ifconfig lo0 1.1.1.1 -alias  # to remove it, after the test\n+addr = '1.1.1.1'\n+\n+# array of tuples [arguments, expected port in localaddresses]\n+expected = [\n+    [['-externalip=2.2.2.2',       '-port=20001'                               ], 20001],\n+    [['-externalip=2.2.2.2',       '-port=20002', '-bind={}'.format(addr)],       20002],\n+    [['-externalip=2.2.2.2',                      '-bind={}'.format(addr)],       11002],\n+    [['-externalip=2.2.2.2',       '-port=20003', '-bind={}:20004'.format(addr)], 20004],\n+    [['-externalip=2.2.2.2',                      '-bind={}:20005'.format(addr)], 20005],\n+    [['-externalip=2.2.2.2:20006', '-port=20007'                               ], 20006],\n+    [['-externalip=2.2.2.2:20008', '-port=20009', '-bind={}'.format(addr)],       20008],\n+    [['-externalip=2.2.2.2:20010',                '-bind={}'.format(addr)],       20010],\n+    [['-externalip=2.2.2.2:20011', '-port=20012', '-bind={}:20013'.format(addr)], 20011],\n+    [['-externalip=2.2.2.2:20014',                '-bind={}:20015'.format(addr)], 20014],\n+    [['-externalip=2.2.2.2',       '-port=20016', '-bind={}:20017'.format(addr),\n+                                             '-whitebind={}:20018'.format(addr)], 20017],\n+    [['-externalip=2.2.2.2',       '-port=20019',\n+                                             '-whitebind={}:20020'.format(addr)], 20020],\n+]\n+\n+class BindPortTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        # Avoid any -bind= on the command line. Force the framework to avoid adding -bind=127.0.0.1.\n+        self.setup_clean_chain = True\n+        self.bind_to_localhost_only = False\n+        self.num_nodes = len(expected)\n+\n+    def add_options(self, parser):\n+        parser.add_argument(\n+            \"--ihave1111\", action='store_true', dest=\"ihave1111\",\n+            help=\"Run the test, assuming {} is configured on the machine\".format(addr),\n+            default=False)\n+\n+    def setup_nodes(self):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510081932",
      "id" : 510081932,
      "in_reply_to_id" : 509350641,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA4MTkzMg==",
      "original_commit_id" : "e6c3de7178ff3e2b0961e71635729bbfe6784f1e",
      "original_line" : 53,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "test/functional/feature_bind_port_externalip.py",
      "position" : null,
      "pull_request_review_id" : 514619495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510081932",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510082073"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510082073"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-22T11:22:11Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test that the proper port is used for -externalip=\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import assert_equal\n+\n+# We need to bind to a routable address for this test to exercise the relevant code.\n+# To set a routable IP address on the machine use:\n+# Linux:\n+# ifconfig lo:0 1.1.1.1/32 up  # to set up\n+# ifconfig lo:0 down  # to remove it, after the test\n+# FreeBSD:\n+# ifconfig lo0 1.1.1.1/32 alias  # to set up\n+# ifconfig lo0 1.1.1.1 -alias  # to remove it, after the test\n+addr = '1.1.1.1'\n+\n+# array of tuples [arguments, expected port in localaddresses]\n+expected = [",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510082073",
      "id" : 510082073,
      "in_reply_to_id" : 509350836,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA4MjA3Mw==",
      "original_commit_id" : "e6c3de7178ff3e2b0961e71635729bbfe6784f1e",
      "original_line" : 23,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "test/functional/feature_bind_port_externalip.py",
      "position" : null,
      "pull_request_review_id" : 514619723,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510082073",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510082162"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510082162"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-22T11:22:22Z",
      "diff_hunk" : "@@ -1944,11 +1942,15 @@ bool AppInitMain(const util::Ref& context, NodeContext& node, interfaces::BlockA\n     connOptions.nMaxOutboundLimit = nMaxOutboundLimit;\n     connOptions.m_peer_connect_timeout = peer_connect_timeout;\n \n+    // Port to bind to if `-bind=addr` is provided without a `:port` suffix.\n+    const uint16_t default_bind_port =\n+        static_cast<uint16_t>(gArgs.GetArg(\"-port\", Params().GetDefaultPort()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510082162",
      "id" : 510082162,
      "in_reply_to_id" : 509351706,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA4MjE2Mg==",
      "original_commit_id" : "e6c3de7178ff3e2b0961e71635729bbfe6784f1e",
      "original_line" : 1947,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 514619827,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510082162",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510082566"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510082566"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed to `m_node.args->ForceSetArg(\"-bind\", \"\");`",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-22T11:23:10Z",
      "diff_hunk" : "@@ -677,8 +682,80 @@ BOOST_AUTO_TEST_CASE(ipv4_peer_with_ipv6_addrMe_test)\n \n     // suppress no-checks-run warning; if this test fails, it's by triggering a sanitizer\n     BOOST_CHECK(1);\n+\n+    // Cleanup, so that we don't confuse other tests.\n+    {\n+        LOCK(cs_mapLocalHost);\n+        mapLocalHost.erase(addr_in_mapLocalHost);\n+    }\n }\n \n+BOOST_AUTO_TEST_CASE(advertise_local_port)\n+{\n+    // Test that AdvertiseLocal() properly self-advertises us:\n+    //\n+    // 1. AdvertiseLocal() calls GetLocalAddress() which returns an address that is not routable.\n+    // 2. AdvertiseLocal() overrides the address with whatever the peer has told us he sees us as.\n+    // 2.1. For inbound connections we must override both the address and the port.\n+    // 2.2. For outbound connections we must override only the address.\n+\n+    // Pretend that we bound to this port.\n+    const uint16_t bind_port = 20001;\n+    gArgs.ForceSetArg(\"-bind\", strprintf(\"3.4.5.6:%u\", bind_port));\n+\n+    // Our address:port as seen from the peer.\n+    in_addr peer_us_addr;\n+    peer_us_addr.s_addr = htonl(0x02030405);\n+    const CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\n+\n+    // Create a peer with a routable IPv4 address (outbound).\n+    in_addr peer_out_in_addr;\n+    peer_out_in_addr.s_addr = htonl(0x01020304);\n+    CNode peer_out{0,\n+                   NODE_NETWORK,\n+                   0,\n+                   INVALID_SOCKET,\n+                   CAddress{CService{peer_out_in_addr, 8333}, NODE_NETWORK},\n+                   0,\n+                   0,\n+                   CAddress{},\n+                   std::string{},\n+                   ConnectionType::OUTBOUND_FULL_RELAY};\n+    peer_out.fSuccessfullyConnected = true;\n+    peer_out.SetAddrLocal(peer_us);\n+\n+    AdvertiseLocal(&peer_out);\n+\n+    // Without the fix peer_us:8333 ends up in vAddrToSend instead of the proper peer_us:bind_port.\n+    const CAddress expected{CService{peer_us_addr, bind_port}, NODE_NETWORK};\n+    BOOST_CHECK(std::any_of(peer_out.vAddrToSend.begin(), peer_out.vAddrToSend.end(),\n+                            [&expected](const CAddress& cur) { return cur == expected; }));\n+\n+    // Create a peer with a routable IPv4 address (inbound).\n+    in_addr peer_in_in_addr;\n+    peer_in_in_addr.s_addr = htonl(0x05060708);\n+    CNode peer_in{0,\n+                  NODE_NETWORK,\n+                  0,\n+                  INVALID_SOCKET,\n+                  CAddress{CService{peer_in_in_addr, 8333}, NODE_NETWORK},\n+                  0,\n+                  0,\n+                  CAddress{},\n+                  std::string{},\n+                  ConnectionType::INBOUND};\n+    peer_in.fSuccessfullyConnected = true;\n+    peer_in.SetAddrLocal(peer_us);\n+\n+    AdvertiseLocal(&peer_in);\n+\n+    // Without the fix peer_us:8333 ends up in vAddrToSend instead of the proper\n+    // peer_us:peer_us.GetPort().\n+    BOOST_CHECK(std::any_of(peer_in.vAddrToSend.begin(), peer_in.vAddrToSend.end(),\n+                            [&peer_us](const CAddress& cur) { return cur == peer_us; }));\n+\n+    gArgs.ForceSetArg(\"-bind\", \"\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510082566",
      "id" : 510082566,
      "in_reply_to_id" : 509353895,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA4MjU2Ng==",
      "original_commit_id" : "e6c3de7178ff3e2b0961e71635729bbfe6784f1e",
      "original_line" : 757,
      "original_position" : 131,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 514620361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510082566",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed review suggestions and added a test to cover case `4.` from https://github.com/bitcoin/bitcoin/issues/20184.",
      "created_at" : "2020-10-22T11:25:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#issuecomment-714427142",
      "id" : 714427142,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20196",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNDQyNzE0Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-22T11:25:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/714427142",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510090395"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510090395"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, sorry my bad. The mined block will have the timestamp of genesis (plus one), so the time is still too far back.\r\n\r\nAn alternative would be to use mocktime, also ugly, but less LOC.\r\n\r\n```diff\r\ndiff --git a/src/test/net_tests.cpp b/src/test/net_tests.cpp\r\nindex 9519f3fd0c..7e77b758b2 100644\r\n--- a/src/test/net_tests.cpp\r\n+++ b/src/test/net_tests.cpp\r\n@@ -88,7 +88,7 @@ static CDataStream AddrmanToStream(CAddrManSerializationMock& _addrman)\r\n     return CDataStream(vchData, SER_DISK, CLIENT_VERSION);\r\n }\r\n \r\n-BOOST_FIXTURE_TEST_SUITE(net_tests, TestingSetup)\r\n+BOOST_FIXTURE_TEST_SUITE(net_tests, RegTestingSetup)\r\n \r\n BOOST_AUTO_TEST_CASE(cnode_listen_port)\r\n {\r\n@@ -879,11 +879,10 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\r\n \r\n     CDataStream recv_stream{msg.data, SER_NETWORK, PROTOCOL_VERSION};\r\n \r\n-    // Force CChainState::IsInitialBlockDownload() to return false.\r\n-    const auto nMinimumChainWork_orig = nMinimumChainWork;\r\n-    const auto nMaxTipAge_orig = nMaxTipAge;\r\n-    nMinimumChainWork = 0;\r\n-    nMaxTipAge = GetTime();\r\n+    // Force CChainState::IsInitialBlockDownload() to return false, otherwise PushAddress isn't called\r\n+    SetMockTime(1);\r\n+    BOOST_REQUIRE(!m_node.chainman->ActiveChainstate().IsInitialBlockDownload());\r\n+    SetMockTime(0);\r\n \r\n     m_node.peerman->InitializeNode(&peer);\r\n \r\n@@ -898,9 +897,6 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\r\n     BOOST_CHECK(std::any_of(peer.vAddrToSend.begin(), peer.vAddrToSend.end(),\r\n                             [&expected](const CAddress& cur) { return cur == expected; }));\r\n \r\n-    nMinimumChainWork = nMinimumChainWork_orig;\r\n-    nMaxTipAge = nMaxTipAge_orig;\r\n-\r\n     gArgs.ForceSetArg(\"-bind\", \"\");\r\n }\r\n \r\n",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-22T11:37:39Z",
      "diff_hunk" : "@@ -769,4 +846,62 @@ BOOST_AUTO_TEST_CASE(PoissonNextSend)\n     g_mock_deterministic_tests = false;\n }\n \n+BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n+{\n+    // Pretend that we bound to this port.\n+    const uint16_t bind_port = 20001;\n+    gArgs.ForceSetArg(\"-bind\", strprintf(\"3.4.5.6:%u\", bind_port));\n+\n+    // Our address:port as seen from the peer.\n+    in_addr peer_us_addr;\n+    peer_us_addr.s_addr = htonl(0x02030405);\n+    const CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\n+\n+    // Create a peer with a routable IPv4 address.\n+    in_addr peer_in_addr;\n+    peer_in_addr.s_addr = htonl(0x01020304);\n+    CNode peer{0,\n+               NODE_NETWORK,\n+               0,\n+               INVALID_SOCKET,\n+               CAddress{CService{peer_in_addr, 8333}, NODE_NETWORK},\n+               0,\n+               0,\n+               CAddress{},\n+               std::string{},\n+               ConnectionType::OUTBOUND_FULL_RELAY};\n+\n+    const uint64_t services{NODE_NETWORK | NODE_WITNESS};\n+    const int64_t time{0};\n+    // Our address, as seen from the peer.\n+    const CNetMsgMaker msg_maker{PROTOCOL_VERSION};\n+    const auto msg = msg_maker.Make(NetMsgType::VERSION, PROTOCOL_VERSION, services, time, peer_us);\n+\n+    CDataStream recv_stream{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+\n+    // Force CChainState::IsInitialBlockDownload() to return false.\n+    const auto nMinimumChainWork_orig = nMinimumChainWork;\n+    const auto nMaxTipAge_orig = nMaxTipAge;\n+    nMinimumChainWork = 0;\n+    nMaxTipAge = GetTime();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510090395",
      "id" : 510090395,
      "in_reply_to_id" : 509355760,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA5MDM5NQ==",
      "original_commit_id" : "e6c3de7178ff3e2b0961e71635729bbfe6784f1e",
      "original_line" : 887,
      "original_position" : 177,
      "original_start_line" : 883,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 514630626,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510090395",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510093818"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510093818"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same feedback here ;)",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-22T11:43:54Z",
      "diff_hunk" : "@@ -0,0 +1,75 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test that -discover does not add all intefaces' addresses if we listen just on some\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import assert_equal\n+\n+# We need to bind to a routable address for this test to exercise the relevant code\n+# and also must have another routable address on another interface which must not\n+# be named \"lo\" or \"lo0\".\n+# To set a routable address on the machine use:\n+# Linux:\n+# ifconfig lo:0 1.1.1.1/32 up && ifconfig lo:1 2.2.2.2/32 up  # to set up\n+# ifconfig lo:0 down && ifconfig lo:1 down  # to remove it, after the test\n+# FreeBSD:\n+# ifconfig em0 1.1.1.1/32 alias && ifconfig wlan0 2.2.2.2/32 alias  # to set up\n+# ifconfig em0 1.1.1.1 -alias && ifconfig wlan0 2.2.2.2 -alias  # to remove it, after the test\n+ADDR1 = '1.1.1.1'\n+ADDR2 = '2.2.2.2'\n+\n+BIND_PORT = 20001;\n+\n+class BindPortDiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        # Avoid any -bind= on the command line. Force the framework to avoid adding -bind=127.0.0.1.\n+        self.setup_clean_chain = True\n+        self.bind_to_localhost_only = False\n+        self.num_nodes = 2\n+\n+    def add_options(self, parser):\n+        parser.add_argument(\n+            \"--ihave1111and2222\", action='store_true', dest=\"ihave1111and2222\",\n+            help=\"Run the test, assuming {} and {} are configured on the machine\".format(ADDR1, ADDR2),\n+            default=False)\n+\n+    def setup_nodes(self):\n+        if not self.options.ihave1111and2222:\n+            raise SkipTest(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510093818",
      "id" : 510093818,
      "line" : 46,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA5MzgxOA==",
      "original_commit_id" : "1ae0d404f8ace0312c2b8dcd5e5bcb6af1e844d8",
      "original_line" : 46,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "test/functional/feature_bind_port_discover.py",
      "position" : 46,
      "pull_request_review_id" : 514634989,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510093818",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510123145"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510123145"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-22T12:33:40Z",
      "diff_hunk" : "@@ -0,0 +1,75 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test that -discover does not add all intefaces' addresses if we listen just on some\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import assert_equal\n+\n+# We need to bind to a routable address for this test to exercise the relevant code\n+# and also must have another routable address on another interface which must not\n+# be named \"lo\" or \"lo0\".\n+# To set a routable address on the machine use:\n+# Linux:\n+# ifconfig lo:0 1.1.1.1/32 up && ifconfig lo:1 2.2.2.2/32 up  # to set up\n+# ifconfig lo:0 down && ifconfig lo:1 down  # to remove it, after the test\n+# FreeBSD:\n+# ifconfig em0 1.1.1.1/32 alias && ifconfig wlan0 2.2.2.2/32 alias  # to set up\n+# ifconfig em0 1.1.1.1 -alias && ifconfig wlan0 2.2.2.2 -alias  # to remove it, after the test\n+ADDR1 = '1.1.1.1'\n+ADDR2 = '2.2.2.2'\n+\n+BIND_PORT = 20001;\n+\n+class BindPortDiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        # Avoid any -bind= on the command line. Force the framework to avoid adding -bind=127.0.0.1.\n+        self.setup_clean_chain = True\n+        self.bind_to_localhost_only = False\n+        self.num_nodes = 2\n+\n+    def add_options(self, parser):\n+        parser.add_argument(\n+            \"--ihave1111and2222\", action='store_true', dest=\"ihave1111and2222\",\n+            help=\"Run the test, assuming {} and {} are configured on the machine\".format(ADDR1, ADDR2),\n+            default=False)\n+\n+    def setup_nodes(self):\n+        if not self.options.ihave1111and2222:\n+            raise SkipTest(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510123145",
      "id" : 510123145,
      "in_reply_to_id" : 510093818,
      "line" : 46,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEyMzE0NQ==",
      "original_commit_id" : "1ae0d404f8ace0312c2b8dcd5e5bcb6af1e844d8",
      "original_line" : 46,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "test/functional/feature_bind_port_discover.py",
      "position" : 46,
      "pull_request_review_id" : 514673816,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510123145",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510123549"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510123549"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed, less LOC. Thanks!",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-22T12:34:20Z",
      "diff_hunk" : "@@ -769,4 +846,62 @@ BOOST_AUTO_TEST_CASE(PoissonNextSend)\n     g_mock_deterministic_tests = false;\n }\n \n+BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n+{\n+    // Pretend that we bound to this port.\n+    const uint16_t bind_port = 20001;\n+    gArgs.ForceSetArg(\"-bind\", strprintf(\"3.4.5.6:%u\", bind_port));\n+\n+    // Our address:port as seen from the peer.\n+    in_addr peer_us_addr;\n+    peer_us_addr.s_addr = htonl(0x02030405);\n+    const CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\n+\n+    // Create a peer with a routable IPv4 address.\n+    in_addr peer_in_addr;\n+    peer_in_addr.s_addr = htonl(0x01020304);\n+    CNode peer{0,\n+               NODE_NETWORK,\n+               0,\n+               INVALID_SOCKET,\n+               CAddress{CService{peer_in_addr, 8333}, NODE_NETWORK},\n+               0,\n+               0,\n+               CAddress{},\n+               std::string{},\n+               ConnectionType::OUTBOUND_FULL_RELAY};\n+\n+    const uint64_t services{NODE_NETWORK | NODE_WITNESS};\n+    const int64_t time{0};\n+    // Our address, as seen from the peer.\n+    const CNetMsgMaker msg_maker{PROTOCOL_VERSION};\n+    const auto msg = msg_maker.Make(NetMsgType::VERSION, PROTOCOL_VERSION, services, time, peer_us);\n+\n+    CDataStream recv_stream{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+\n+    // Force CChainState::IsInitialBlockDownload() to return false.\n+    const auto nMinimumChainWork_orig = nMinimumChainWork;\n+    const auto nMaxTipAge_orig = nMaxTipAge;\n+    nMinimumChainWork = 0;\n+    nMaxTipAge = GetTime();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510123549",
      "id" : 510123549,
      "in_reply_to_id" : 509355760,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEyMzU0OQ==",
      "original_commit_id" : "e6c3de7178ff3e2b0961e71635729bbfe6784f1e",
      "original_line" : 887,
      "original_position" : 177,
      "original_start_line" : 883,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 514674346,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510123549",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed review suggestions.",
      "created_at" : "2020-10-22T12:34:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#issuecomment-714462655",
      "id" : 714462655,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20196",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNDQ2MjY1NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-22T12:34:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/714462655",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed linter error `feature_bind_port_discover.py:25:18: E703 statement ends with a semicolon` :facepalm: ",
      "created_at" : "2020-10-22T16:32:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#issuecomment-714613601",
      "id" : 714613601,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20196",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNDYxMzYwMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-22T16:32:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/714613601",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510889053"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510889053"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The ports used better not be hardcoded but derived from `p2p_port()` in order not to clash with other tests that may be running on the system at the same time.",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-23T13:37:10Z",
      "diff_hunk" : "@@ -0,0 +1,72 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test that the proper port is used for -externalip=\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import assert_equal\n+\n+# We need to bind to a routable address for this test to exercise the relevant code.\n+# To set a routable address on the machine use:\n+# Linux:\n+# ifconfig lo:0 1.1.1.1/32 up  # to set up\n+# ifconfig lo:0 down  # to remove it, after the test\n+# FreeBSD:\n+# ifconfig lo0 1.1.1.1/32 alias  # to set up\n+# ifconfig lo0 1.1.1.1 -alias  # to remove it, after the test\n+ADDR = '1.1.1.1'\n+\n+# array of tuples [arguments, expected port in localaddresses]\n+EXPECTED = [\n+    [['-externalip=2.2.2.2',       '-port=20001'                               ], 20001],",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510889053",
      "id" : 510889053,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDg4OTA1Mw==",
      "original_commit_id" : "053ba089fca3e41bf815ac16346352fd7e1eb69d",
      "original_line" : 24,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "test/functional/feature_bind_port_externalip.py",
      "position" : null,
      "pull_request_review_id" : 515673544,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510889053",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510908676"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510908676"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Or you could start in a fresh range (ports that are not used by p2p or rpc in other tests)",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-10-23T14:06:31Z",
      "diff_hunk" : "@@ -0,0 +1,72 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test that the proper port is used for -externalip=\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import assert_equal\n+\n+# We need to bind to a routable address for this test to exercise the relevant code.\n+# To set a routable address on the machine use:\n+# Linux:\n+# ifconfig lo:0 1.1.1.1/32 up  # to set up\n+# ifconfig lo:0 down  # to remove it, after the test\n+# FreeBSD:\n+# ifconfig lo0 1.1.1.1/32 alias  # to set up\n+# ifconfig lo0 1.1.1.1 -alias  # to remove it, after the test\n+ADDR = '1.1.1.1'\n+\n+# array of tuples [arguments, expected port in localaddresses]\n+EXPECTED = [\n+    [['-externalip=2.2.2.2',       '-port=20001'                               ], 20001],",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r510908676",
      "id" : 510908676,
      "in_reply_to_id" : 510889053,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDkwODY3Ng==",
      "original_commit_id" : "053ba089fca3e41bf815ac16346352fd7e1eb69d",
      "original_line" : 24,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "test/functional/feature_bind_port_externalip.py",
      "position" : null,
      "pull_request_review_id" : 515700325,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510908676",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-12-16T13:45:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#issuecomment-746306133",
      "id" : 746306133,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20196",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0NjMwNjEzMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-16T13:45:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/746306133",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r545272234"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/545272234"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed to start in a fresh range from 30000 as that is the easiest (maximum that can be returned by `p2p_port()` or `rpc_port()` is `PORT_MIN + 2 * PORT_RANGE` which his `21000` :eyes:).",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2020-12-17T17:33:41Z",
      "diff_hunk" : "@@ -0,0 +1,72 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test that the proper port is used for -externalip=\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework, SkipTest\n+from test_framework.util import assert_equal\n+\n+# We need to bind to a routable address for this test to exercise the relevant code.\n+# To set a routable address on the machine use:\n+# Linux:\n+# ifconfig lo:0 1.1.1.1/32 up  # to set up\n+# ifconfig lo:0 down  # to remove it, after the test\n+# FreeBSD:\n+# ifconfig lo0 1.1.1.1/32 alias  # to set up\n+# ifconfig lo0 1.1.1.1 -alias  # to remove it, after the test\n+ADDR = '1.1.1.1'\n+\n+# array of tuples [arguments, expected port in localaddresses]\n+EXPECTED = [\n+    [['-externalip=2.2.2.2',       '-port=20001'                               ], 20001],",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r545272234",
      "id" : 545272234,
      "in_reply_to_id" : 510889053,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI3MjIzNA==",
      "original_commit_id" : "053ba089fca3e41bf815ac16346352fd7e1eb69d",
      "original_line" : 24,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "test/functional/feature_bind_port_externalip.py",
      "position" : null,
      "pull_request_review_id" : 554831311,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/545272234",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased and changed port numbers used in the functional tests.",
      "created_at" : "2020-12-17T17:34:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#issuecomment-747587485",
      "id" : 747587485,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20196",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0NzU4NzQ4NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-17T17:34:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/747587485",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-01-07T15:06:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#issuecomment-756172368",
      "id" : 756172368,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20196",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1NjE3MjM2OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-07T15:06:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/756172368",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r556430946"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/556430946"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Might be possible to write, shorter, and to abstract away the inner workings of IsIbd\r\n\r\n```suggestion\r\nTestChainState& chainstate = *(TestChainState*)&m_node.chainman->ActiveChainstate();\r\nchainstate.JumpOutOfIbd();\r\n```",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2021-01-13T10:52:22Z",
      "diff_hunk" : "@@ -926,4 +1002,59 @@ BOOST_AUTO_TEST_CASE(node_eviction_test)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n+{\n+    // Pretend that we bound to this port.\n+    const uint16_t bind_port = 20001;\n+    m_node.args->ForceSetArg(\"-bind\", strprintf(\"3.4.5.6:%u\", bind_port));\n+\n+    // Our address:port as seen from the peer - 2.3.4.5:20002 (different from the above).\n+    in_addr peer_us_addr;\n+    peer_us_addr.s_addr = htonl(0x02030405);\n+    const CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\n+\n+    // Create a peer with a routable IPv4 address.\n+    in_addr peer_in_addr;\n+    peer_in_addr.s_addr = htonl(0x01020304);\n+    CNode peer{0,\n+               NODE_NETWORK,\n+               0,\n+               INVALID_SOCKET,\n+               CAddress{CService{peer_in_addr, 8333}, NODE_NETWORK},\n+               0,\n+               0,\n+               CAddress{},\n+               std::string{},\n+               ConnectionType::OUTBOUND_FULL_RELAY};\n+\n+    const uint64_t services{NODE_NETWORK | NODE_WITNESS};\n+    const int64_t time{0};\n+    // Our address, as seen from the peer.\n+    const CNetMsgMaker msg_maker{PROTOCOL_VERSION};\n+    const auto msg = msg_maker.Make(NetMsgType::VERSION, PROTOCOL_VERSION, services, time, peer_us);\n+\n+    CDataStream recv_stream{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+\n+    // Force CChainState::IsInitialBlockDownload() to return false.\n+    // Otherwise PushAddress() isn't called by PeerManager::ProcessMessage().\n+    SetMockTime(1);\n+    BOOST_REQUIRE(!m_node.chainman->ActiveChainstate().IsInitialBlockDownload());\n+    SetMockTime(0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r556430946",
      "id" : 556430946,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjQzMDk0Ng==",
      "original_commit_id" : "3e55fbfe31e58619d8858399dea3bc3ef420b111",
      "original_line" : 1042,
      "original_position" : 172,
      "original_start_line" : 1040,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 567103762,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/556430946",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "3e55fbfe3...5647ca32e: rebased due to conflicts + address a [suggestion](https://github.com/bitcoin/bitcoin/pull/20196#discussion_r556430946).",
      "created_at" : "2021-01-14T13:04:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#issuecomment-760184250",
      "id" : 760184250,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20196",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MDE4NDI1MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-14T13:04:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/760184250",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r557380409"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557380409"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done. This cast to a class which it actually is not looks quite hackish.",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2021-01-14T13:05:53Z",
      "diff_hunk" : "@@ -926,4 +1002,59 @@ BOOST_AUTO_TEST_CASE(node_eviction_test)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n+{\n+    // Pretend that we bound to this port.\n+    const uint16_t bind_port = 20001;\n+    m_node.args->ForceSetArg(\"-bind\", strprintf(\"3.4.5.6:%u\", bind_port));\n+\n+    // Our address:port as seen from the peer - 2.3.4.5:20002 (different from the above).\n+    in_addr peer_us_addr;\n+    peer_us_addr.s_addr = htonl(0x02030405);\n+    const CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\n+\n+    // Create a peer with a routable IPv4 address.\n+    in_addr peer_in_addr;\n+    peer_in_addr.s_addr = htonl(0x01020304);\n+    CNode peer{0,\n+               NODE_NETWORK,\n+               0,\n+               INVALID_SOCKET,\n+               CAddress{CService{peer_in_addr, 8333}, NODE_NETWORK},\n+               0,\n+               0,\n+               CAddress{},\n+               std::string{},\n+               ConnectionType::OUTBOUND_FULL_RELAY};\n+\n+    const uint64_t services{NODE_NETWORK | NODE_WITNESS};\n+    const int64_t time{0};\n+    // Our address, as seen from the peer.\n+    const CNetMsgMaker msg_maker{PROTOCOL_VERSION};\n+    const auto msg = msg_maker.Make(NetMsgType::VERSION, PROTOCOL_VERSION, services, time, peer_us);\n+\n+    CDataStream recv_stream{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+\n+    // Force CChainState::IsInitialBlockDownload() to return false.\n+    // Otherwise PushAddress() isn't called by PeerManager::ProcessMessage().\n+    SetMockTime(1);\n+    BOOST_REQUIRE(!m_node.chainman->ActiveChainstate().IsInitialBlockDownload());\n+    SetMockTime(0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r557380409",
      "id" : 557380409,
      "in_reply_to_id" : 556430946,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzM4MDQwOQ==",
      "original_commit_id" : "3e55fbfe31e58619d8858399dea3bc3ef420b111",
      "original_line" : 1042,
      "original_position" : 172,
      "original_start_line" : 1040,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 568213153,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557380409",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "5647ca32e...58755690a: rebase, what's up with appveyor?",
      "created_at" : "2021-01-17T12:33:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#issuecomment-761805075",
      "id" : 761805075,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20196",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MTgwNTA3NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-17T12:33:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/761805075",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@vasild \r\n> what's up with appveyor?\r\n\r\nWhat do you mean?",
      "created_at" : "2021-01-17T13:13:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#issuecomment-761810859",
      "id" : 761810859,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20196",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MTgxMDg1OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-17T13:13:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/761810859",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@hebasto https://ci.appveyor.com/project/DrahtBot/bitcoin/builds/37305037",
      "created_at" : "2021-01-17T13:15:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#issuecomment-761811157",
      "id" : 761811157,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20196",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MTgxMTE1Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-17T13:15:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/761811157",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r559180800"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559180800"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I presume this line will make appveyor etc fail if the test process isn't restarted in between test cases.",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2021-01-17T13:21:04Z",
      "diff_hunk" : "@@ -929,4 +1004,57 @@ BOOST_AUTO_TEST_CASE(node_eviction_test)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n+{\n+    // Pretend that we bound to this port.\n+    const uint16_t bind_port = 20001;\n+    m_node.args->ForceSetArg(\"-bind\", strprintf(\"3.4.5.6:%u\", bind_port));\n+\n+    // Our address:port as seen from the peer - 2.3.4.5:20002 (different from the above).\n+    in_addr peer_us_addr;\n+    peer_us_addr.s_addr = htonl(0x02030405);\n+    const CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\n+\n+    // Create a peer with a routable IPv4 address.\n+    in_addr peer_in_addr;\n+    peer_in_addr.s_addr = htonl(0x01020304);\n+    CNode peer{0,\n+               NODE_NETWORK,\n+               INVALID_SOCKET,\n+               CAddress{CService{peer_in_addr, 8333}, NODE_NETWORK},\n+               0,\n+               0,\n+               CAddress{},\n+               std::string{},\n+               ConnectionType::OUTBOUND_FULL_RELAY};\n+\n+    const uint64_t services{NODE_NETWORK | NODE_WITNESS};\n+    const int64_t time{0};\n+    // Our address, as seen from the peer.\n+    const CNetMsgMaker msg_maker{PROTOCOL_VERSION};\n+    const auto msg = msg_maker.Make(NetMsgType::VERSION, PROTOCOL_VERSION, services, time, peer_us);\n+\n+    CDataStream recv_stream{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+\n+    // Force CChainState::IsInitialBlockDownload() to return false.\n+    // Otherwise PushAddress() isn't called by PeerManager::ProcessMessage().\n+    TestChainState& chainstate = *(TestChainState*)&m_node.chainman->ActiveChainstate();\n+    chainstate.JumpOutOfIbd();\n+\n+    m_node.peerman->InitializeNode(&peer);\n+\n+    std::atomic<bool> interrupt_dummy{false};\n+    std::chrono::microseconds time_received_dummy{0};\n+\n+    m_node.peerman->ProcessMessage(peer, NetMsgType::VERSION, recv_stream, time_received_dummy,\n+                                   interrupt_dummy);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r559180800",
      "id" : 559180800,
      "line" : 1051,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTE4MDgwMA==",
      "original_commit_id" : "58755690a7e79e5ae4e3dcf1cba3dc0d28dfa3cd",
      "original_line" : 1051,
      "original_position" : 179,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : 180,
      "pull_request_review_id" : 570056925,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559180800",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r559181011"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559181011"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See\r\n\r\n```\r\nTest cases order is shuffled using seed: 193951562\r\n```\r\n\r\nhttps://cirrus-ci.com/task/5953114714931200?command=ci#L3792\r\n\r\nWhich should make it reproducible ",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2021-01-17T13:22:58Z",
      "diff_hunk" : "@@ -929,4 +1004,57 @@ BOOST_AUTO_TEST_CASE(node_eviction_test)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n+{\n+    // Pretend that we bound to this port.\n+    const uint16_t bind_port = 20001;\n+    m_node.args->ForceSetArg(\"-bind\", strprintf(\"3.4.5.6:%u\", bind_port));\n+\n+    // Our address:port as seen from the peer - 2.3.4.5:20002 (different from the above).\n+    in_addr peer_us_addr;\n+    peer_us_addr.s_addr = htonl(0x02030405);\n+    const CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\n+\n+    // Create a peer with a routable IPv4 address.\n+    in_addr peer_in_addr;\n+    peer_in_addr.s_addr = htonl(0x01020304);\n+    CNode peer{0,\n+               NODE_NETWORK,\n+               INVALID_SOCKET,\n+               CAddress{CService{peer_in_addr, 8333}, NODE_NETWORK},\n+               0,\n+               0,\n+               CAddress{},\n+               std::string{},\n+               ConnectionType::OUTBOUND_FULL_RELAY};\n+\n+    const uint64_t services{NODE_NETWORK | NODE_WITNESS};\n+    const int64_t time{0};\n+    // Our address, as seen from the peer.\n+    const CNetMsgMaker msg_maker{PROTOCOL_VERSION};\n+    const auto msg = msg_maker.Make(NetMsgType::VERSION, PROTOCOL_VERSION, services, time, peer_us);\n+\n+    CDataStream recv_stream{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+\n+    // Force CChainState::IsInitialBlockDownload() to return false.\n+    // Otherwise PushAddress() isn't called by PeerManager::ProcessMessage().\n+    TestChainState& chainstate = *(TestChainState*)&m_node.chainman->ActiveChainstate();\n+    chainstate.JumpOutOfIbd();\n+\n+    m_node.peerman->InitializeNode(&peer);\n+\n+    std::atomic<bool> interrupt_dummy{false};\n+    std::chrono::microseconds time_received_dummy{0};\n+\n+    m_node.peerman->ProcessMessage(peer, NetMsgType::VERSION, recv_stream, time_received_dummy,\n+                                   interrupt_dummy);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r559181011",
      "id" : 559181011,
      "in_reply_to_id" : 559180800,
      "line" : 1051,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTE4MTAxMQ==",
      "original_commit_id" : "58755690a7e79e5ae4e3dcf1cba3dc0d28dfa3cd",
      "original_line" : 1051,
      "original_position" : 179,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : 180,
      "pull_request_review_id" : 570057077,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559181011",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r559577818"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559577818"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, that helped a lot nailing the issue down. Fixed now.",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2021-01-18T13:47:35Z",
      "diff_hunk" : "@@ -929,4 +1004,57 @@ BOOST_AUTO_TEST_CASE(node_eviction_test)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n+{\n+    // Pretend that we bound to this port.\n+    const uint16_t bind_port = 20001;\n+    m_node.args->ForceSetArg(\"-bind\", strprintf(\"3.4.5.6:%u\", bind_port));\n+\n+    // Our address:port as seen from the peer - 2.3.4.5:20002 (different from the above).\n+    in_addr peer_us_addr;\n+    peer_us_addr.s_addr = htonl(0x02030405);\n+    const CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\n+\n+    // Create a peer with a routable IPv4 address.\n+    in_addr peer_in_addr;\n+    peer_in_addr.s_addr = htonl(0x01020304);\n+    CNode peer{0,\n+               NODE_NETWORK,\n+               INVALID_SOCKET,\n+               CAddress{CService{peer_in_addr, 8333}, NODE_NETWORK},\n+               0,\n+               0,\n+               CAddress{},\n+               std::string{},\n+               ConnectionType::OUTBOUND_FULL_RELAY};\n+\n+    const uint64_t services{NODE_NETWORK | NODE_WITNESS};\n+    const int64_t time{0};\n+    // Our address, as seen from the peer.\n+    const CNetMsgMaker msg_maker{PROTOCOL_VERSION};\n+    const auto msg = msg_maker.Make(NetMsgType::VERSION, PROTOCOL_VERSION, services, time, peer_us);\n+\n+    CDataStream recv_stream{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+\n+    // Force CChainState::IsInitialBlockDownload() to return false.\n+    // Otherwise PushAddress() isn't called by PeerManager::ProcessMessage().\n+    TestChainState& chainstate = *(TestChainState*)&m_node.chainman->ActiveChainstate();\n+    chainstate.JumpOutOfIbd();\n+\n+    m_node.peerman->InitializeNode(&peer);\n+\n+    std::atomic<bool> interrupt_dummy{false};\n+    std::chrono::microseconds time_received_dummy{0};\n+\n+    m_node.peerman->ProcessMessage(peer, NetMsgType::VERSION, recv_stream, time_received_dummy,\n+                                   interrupt_dummy);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r559577818",
      "id" : 559577818,
      "in_reply_to_id" : 559180800,
      "line" : 1051,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTU3NzgxOA==",
      "original_commit_id" : "58755690a7e79e5ae4e3dcf1cba3dc0d28dfa3cd",
      "original_line" : 1051,
      "original_position" : 179,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : 180,
      "pull_request_review_id" : 570504260,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559577818",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "58755690a...d8c6dc0b6: undo the effects of `AddTimeData()` called indirectly by the newly added test `net_tests/initial_advertise_from_version_message` so that `timedata_tests/addtimedata` is not confused. Thanks, @MarcoFalke!",
      "created_at" : "2021-01-18T13:49:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#issuecomment-762262711",
      "id" : 762262711,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20196",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MjI2MjcxMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-18T13:49:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/762262711",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r559688046"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559688046"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in 9d8bb13b1dfc5103e2678ba803ecd3220dce052d: Shouldn't the reset be before the check equal?",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2021-01-18T16:37:54Z",
      "diff_hunk" : "@@ -96,9 +96,10 @@ BOOST_AUTO_TEST_CASE(addtimedata)\n     // not to fix this because it prevents possible attacks. See the comment in AddTimeData() or issue #4521\n     // for a more detailed explanation.\n     MultiAddTimeData(2, 100); // filter median is 100 now, but nTimeOffset will not change\n+    // We want this test to end with nTimeOffset==0, otherwise subsequent tests of the suite will fail.\n     BOOST_CHECK_EQUAL(GetTimeOffset(), 0);\n \n-    // We want this test to end with nTimeOffset==0, otherwise subsequent tests of the suite will fail.\n+    ResetTimeData();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r559688046",
      "id" : 559688046,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTY4ODA0Ng==",
      "original_commit_id" : "9d8bb13b1dfc5103e2678ba803ecd3220dce052d",
      "original_line" : 102,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/test/timedata_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 570647860,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559688046",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r559688334"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559688334"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could rename this to `TestOnlyResetTimeData`?",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2021-01-18T16:38:23Z",
      "diff_hunk" : "@@ -106,3 +107,12 @@ void AddTimeData(const CNetAddr& ip, int64_t nOffsetSample)\n         }\n     }\n }\n+\n+void ResetTimeData()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r559688334",
      "id" : 559688334,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTY4ODMzNA==",
      "original_commit_id" : "9d8bb13b1dfc5103e2678ba803ecd3220dce052d",
      "original_line" : 111,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/timedata.cpp",
      "position" : null,
      "pull_request_review_id" : 570647860,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559688334",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r560083361"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560083361"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think so. The `BOOST_CHECK_EQUAL(GetTimeOffset(), 0)` check is to ensure that the net result from all the previous calls is 0. This is still true and better keep that check to ensure it remains so. Surely the check will also pass after `ResetTimeData()` not because the net result is 0, but because the reset obliterated the entire state.",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2021-01-19T10:46:06Z",
      "diff_hunk" : "@@ -96,9 +96,10 @@ BOOST_AUTO_TEST_CASE(addtimedata)\n     // not to fix this because it prevents possible attacks. See the comment in AddTimeData() or issue #4521\n     // for a more detailed explanation.\n     MultiAddTimeData(2, 100); // filter median is 100 now, but nTimeOffset will not change\n+    // We want this test to end with nTimeOffset==0, otherwise subsequent tests of the suite will fail.\n     BOOST_CHECK_EQUAL(GetTimeOffset(), 0);\n \n-    // We want this test to end with nTimeOffset==0, otherwise subsequent tests of the suite will fail.\n+    ResetTimeData();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r560083361",
      "id" : 560083361,
      "in_reply_to_id" : 559688046,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDA4MzM2MQ==",
      "original_commit_id" : "9d8bb13b1dfc5103e2678ba803ecd3220dce052d",
      "original_line" : 102,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/test/timedata_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 571119121,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560083361",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r560089965"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560089965"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Renamed. I would have preferred to surround it in `#ifdef UNIT_TESTS_ARE_ENABLED` but couldn't find such a macro.",
      "commit_id" : "70cd1eaef97e42a4ee57a8bc22091fd9b026efa4",
      "created_at" : "2021-01-19T10:56:37Z",
      "diff_hunk" : "@@ -106,3 +107,12 @@ void AddTimeData(const CNetAddr& ip, int64_t nOffsetSample)\n         }\n     }\n }\n+\n+void ResetTimeData()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#discussion_r560089965",
      "id" : 560089965,
      "in_reply_to_id" : 559688334,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDA4OTk2NQ==",
      "original_commit_id" : "9d8bb13b1dfc5103e2678ba803ecd3220dce052d",
      "original_line" : 111,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/timedata.cpp",
      "position" : null,
      "pull_request_review_id" : 571127545,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20196",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-19T10:56:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560089965",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "d8c6dc0b6...70cd1eaef: address [suggestion](https://github.com/bitcoin/bitcoin/pull/20196#discussion_r559688334)",
      "created_at" : "2021-01-19T10:57:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#issuecomment-762766676",
      "id" : 762766676,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20196",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2Mjc2NjY3Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-19T10:57:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/762766676",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-02-05T15:17:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#issuecomment-774095632",
      "id" : 774095632,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20196",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NDA5NTYzMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-05T15:17:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/774095632",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "70cd1eaef...698590c57: rebase due to conflicts",
      "created_at" : "2021-02-10T15:57:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20196#issuecomment-776812456",
      "id" : 776812456,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20196",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NjgxMjQ1Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-10T15:57:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/776812456",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
