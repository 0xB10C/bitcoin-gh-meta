[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20228 (addrman: Make addrman a top-level component by jnewbery)\n* #20222 (refactor: CTxMempool constructor clean up by ellemouton)\n* #20217 (net: Remove g_relay_txes by jnewbery)\n* #20054 (Remove confusing and useless \"unexpected version\" warning by MarcoFalke)\n* #20017 (rpc: Add RPCContext by promag)\n* #19937 (signet mining utility by ajtowns)\n* #19910 (net processing: Move peer_map to PeerManager by jnewbery)\n* #19905 (Remove dead CheckForkWarningConditionsOnNewFork by MarcoFalke)\n* #19901 (Avoid locking CTxMemPool::cs recursively in CTxMemPool::DynamicMemoryUsage() by hebasto)\n* #19858 (Periodically make block-relay connections and sync headers by sdaftuar)\n* #19829 (net processing: Move block inventory state to net_processing by jnewbery)\n* #19806 (validation: UTXO snapshot activation by jamesob)\n* #19594 (refactor: Make mapBlocksUnknownParent local, and rename it by hebasto)\n* #19573 (Replace unused BIP 9 logic with draft BIP 8 by luke-jr)\n* #19438 (Introduce deploymentstatus by ajtowns)\n* #19425 (refactor: Get rid of more redundant chain methods by ryanofsky)\n* #19259 (tests: Add fuzzing harness for LoadMempool(...) and DumpMempool(...) by practicalswift)\n* #18766 (Disable fee estimation in blocksonly mode (by removing the fee estimates global) by darosior)\n* #18731 (refactor: Make CCheckQueue RAII-styled by hebasto)\n* #18354 (Use shared pointers only in validation interface by bvbfan)\n* #16981 (Improve runtime performance of --reindex by LarryRuane)\n* #16333 (test: Set BIP34Height = 2 for regtest by MarcoFalke)\n* #15719 (Wallet passive startup by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-10-15T21:03:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#issuecomment-709588627",
      "id" : 709588627,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20158",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwOTU4ODYyNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-05T11:34:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/709588627",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.",
      "created_at" : "2020-10-16T10:01:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#issuecomment-709951262",
      "id" : 709951262,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20158",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwOTk1MTI2Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-16T10:01:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/709951262",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK - really like the direction of this work.",
      "created_at" : "2020-10-16T16:03:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#issuecomment-710143583",
      "id" : 710143583,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20158",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxMDE0MzU4Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-16T16:03:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/710143583",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510474839"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510474839"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"validation: Move LookupBlockIndex to BlockManager\" (8615dbd1250c2dddec2f54bf80e2a1b7013bc871)\r\n\r\nCommit doesn't compile, not sure if this is intended. Could make this a wrapper function until after the scripted diff",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-10-22T21:41:48Z",
      "diff_hunk" : "@@ -170,11 +170,12 @@ namespace {\n     std::set<int> setDirtyFileInfo;\n } // anon namespace\n \n-CBlockIndex* LookupBlockIndex(const uint256& hash)\n+CBlockIndex* BlockManager::LookupBlockIndex(const uint256& hash)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510474839",
      "id" : 510474839,
      "line" : 157,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ3NDgzOQ==",
      "original_commit_id" : "8615dbd1250c2dddec2f54bf80e2a1b7013bc871",
      "original_line" : 157,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 35,
      "pull_request_review_id" : 515140920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510474839",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510477316"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510477316"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"validation: Move FindForkInGlobalIndex to BlockManager\" (8dbedcb3bf123411ebcd9ccb7521b44cacc8e385)\r\n\r\nre: \"Let me know if this should be changed\", this makes sense to me. A possible alternative might be to make this a chain method, too",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-10-22T21:47:14Z",
      "diff_hunk" : "@@ -440,6 +437,9 @@ class BlockManager\n \n     CBlockIndex* LookupBlockIndex(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    /** Find the last common block between the parameter chain and a locator. */\n+    CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator) EXCLUSIVE_LOCKS_REQUIRED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510477316",
      "id" : 510477316,
      "line" : 425,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ3NzMxNg==",
      "original_commit_id" : "8dbedcb3bf123411ebcd9ccb7521b44cacc8e385",
      "original_line" : 425,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 122,
      "pull_request_review_id" : 515140920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510477316",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510481852"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510481852"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"validation: Move GetSpendHeight to BlockManager\" (05a9e983b421f7728c6cf4c18525abba8a68c82a)\r\n\r\nThis isn't changing behavior, but I don't think it's correct to lock cs_main after mempool.cs. Other code locks in the opposite order so there could be a deadlock if cs_main lock is actually acquired here and this isn't a redundant recursive lock. Maybe it is possible to clean this up simply by annotating CTxMemPool::check to already require cs_main.",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-10-22T21:57:57Z",
      "diff_hunk" : "@@ -632,7 +632,7 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\n     uint64_t innerUsage = 0;\n \n     CCoinsViewCache mempoolDuplicate(const_cast<CCoinsViewCache*>(pcoins));\n-    const int64_t spendheight = GetSpendHeight(mempoolDuplicate);\n+    const int64_t spendheight = WITH_LOCK(::cs_main, return g_chainman.m_blockman.GetSpendHeight(mempoolDuplicate));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510481852",
      "id" : 510481852,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ4MTg1Mg==",
      "original_commit_id" : "05a9e983b421f7728c6cf4c18525abba8a68c82a",
      "original_line" : 635,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 515140920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510481852",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510485799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510485799"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"validation: Remove global ::ActivateBestChain\" (7e15a2c88e49ec6719997e2cdd8481ddd4e7f6be)\r\n\r\nWould seem clearer to say `= nullptr` if that works and you don't prefer this longer version",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-10-22T22:07:36Z",
      "diff_hunk" : "@@ -672,7 +667,7 @@ class CChainState {\n     bool ActivateBestChain(\n         BlockValidationState& state,\n         const CChainParams& chainparams,\n-        std::shared_ptr<const CBlock> pblock) LOCKS_EXCLUDED(cs_main);\n+        std::shared_ptr<const CBlock> pblock = std::shared_ptr<const CBlock>()) LOCKS_EXCLUDED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510485799",
      "id" : 510485799,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ4NTc5OQ==",
      "original_commit_id" : "7e15a2c88e49ec6719997e2cdd8481ddd4e7f6be",
      "original_line" : 670,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 515140920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510485799",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510495615"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510495615"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"validation: Remove global ::VersionBitsTip{State,SinceHeight,Statistics}\" (b60c7e5a5a60fe60a3bc8ba540dc7c8d5c935869)\r\n\r\nI'm a little unclear why it's safe to drop these locks, or why they were here to begin with, or if VersionBits or ChainActive or Tip functions should have been annotated to require cs_main. It seems like something should have be annotated if cs_main was required here",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-10-22T22:33:40Z",
      "diff_hunk" : "@@ -5036,24 +5036,6 @@ CBlockFileInfo* GetBlockFileInfo(size_t n)\n     return &vinfoBlockFile.at(n);\n }\n \n-ThresholdState VersionBitsTipState(const Consensus::Params& params, Consensus::DeploymentPos pos)\n-{\n-    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510495615",
      "id" : 510495615,
      "line" : 5030,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ5NTYxNQ==",
      "original_commit_id" : "b60c7e5a5a60fe60a3bc8ba540dc7c8d5c935869",
      "original_line" : 5030,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 973,
      "pull_request_review_id" : 515140920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510495615",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511162039"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511162039"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"validation: Pass in spendheight to CTxMemPool::check\" (0af807545a93891df691acb43e07fd465c996ecd)\r\n\r\n~This is fine, but not sure if it was intentional to keep this TODO comment here, but not in the other asserts~\r\n\r\nEDIT: Apparently this is done to help the 09a153e13506d6352e478256ce4220232455000f scripted-diff, and the other asserts treat `addressof` as the TODO",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-10-23T21:24:51Z",
      "diff_hunk" : "@@ -633,7 +633,7 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\n     uint64_t innerUsage = 0;\n \n     CCoinsViewCache mempoolDuplicate(const_cast<CCoinsViewCache*>(pcoins));\n-    const int64_t spendheight = WITH_LOCK(::cs_main, return g_chainman.m_blockman.GetSpendHeight(mempoolDuplicate));\n+    assert(WITH_LOCK(::cs_main, return g_chainman.m_blockman.GetSpendHeight(mempoolDuplicate)) == spendheight); // TODO: REVIEW-ONLY, REMOVE IN FUTURE COMMIT",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511162039",
      "id" : 511162039,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE2MjAzOQ==",
      "original_commit_id" : "0af807545a93891df691acb43e07fd465c996ecd",
      "original_line" : 636,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 516018887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511162039",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511165117"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511165117"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510481852\r\n\r\n> In commit \"validation: Move GetSpendHeight to BlockManager\" ([05a9e98](https://github.com/bitcoin/bitcoin/commit/05a9e983b421f7728c6cf4c18525abba8a68c82a))\r\n> \r\n> This isn't changing behavior, but I don't think it's correct to lock cs_main after mempool.cs. Other code locks in the opposite order so there could be a deadlock if cs_main lock is actually acquired here and this isn't a redundant recursive lock. Maybe it is possible to clean this up simply by annotating CTxMemPool::check to already require cs_main.\r\n\r\nAnother way to address this could be to move later commit 0af807545a93891df691acb43e07fd465c996ecd up, and pass the height into check() instead of locking cs_main to figure out the height. Though it seems like cs_main probably needs to be held during the whole check() call anyway and maybe it should just be annotated",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-10-23T21:34:02Z",
      "diff_hunk" : "@@ -632,7 +632,7 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\n     uint64_t innerUsage = 0;\n \n     CCoinsViewCache mempoolDuplicate(const_cast<CCoinsViewCache*>(pcoins));\n-    const int64_t spendheight = GetSpendHeight(mempoolDuplicate);\n+    const int64_t spendheight = WITH_LOCK(::cs_main, return g_chainman.m_blockman.GetSpendHeight(mempoolDuplicate));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511165117",
      "id" : 511165117,
      "in_reply_to_id" : 510481852,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE2NTExNw==",
      "original_commit_id" : "05a9e983b421f7728c6cf4c18525abba8a68c82a",
      "original_line" : 635,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 516018887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511165117",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511170968"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511170968"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"miner: Add chainstate member to BlockAssembler\" (9d74aa3fd30810197d24ec0768f3e28467abe114)\r\n\r\nThis appears to be safe because cs_main is held the entire time a BlockAssembler object is constructed is used `cs_main` is held, but because unlike m_mempool, m_active_chainstate will be able to change at runtime with utxo snapshot loading, it might be safer to just pass CChainState as a regular function argument to methods that need it. Another alternative would might be to add BlockAssembler documentation to say that it's meant to be used and thrown away, not kept alive and reused, at least if the active chain might change",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-10-23T21:50:51Z",
      "diff_hunk" : "@@ -146,6 +146,7 @@ class BlockAssembler\n     int64_t nLockTimeCutoff;\n     const CChainParams& chainparams;\n     const CTxMemPool& m_mempool;\n+    CChainState& m_active_chainstate;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511170968",
      "id" : 511170968,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE3MDk2OA==",
      "original_commit_id" : "9d74aa3fd30810197d24ec0768f3e28467abe114",
      "original_line" : 149,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/miner.h",
      "position" : null,
      "pull_request_review_id" : 516018887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511170968",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511173525"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511173525"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"miner: Pass in blockman to ::RegenerateCommitments\" (a1acd859bd06ead8fb38fac2d10340a658d7a061)\r\n\r\n\r\nIf this lock is needed now can RegenerateCommitments be annotated to require cs_main? Also, why is this lock needed now if it wasn't needed before?",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-10-23T21:58:45Z",
      "diff_hunk" : "@@ -374,7 +374,10 @@ static RPCHelpMan generateblock()\n \n     // Add transactions\n     block.vtx.insert(block.vtx.end(), txs.begin(), txs.end());\n-    RegenerateCommitments(block);\n+    {\n+        LOCK(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511173525",
      "id" : 511173525,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE3MzUyNQ==",
      "original_commit_id" : "a1acd859bd06ead8fb38fac2d10340a658d7a061",
      "original_line" : 381,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 516018887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511173525",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511174948"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511174948"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"node/coinstats: Pass in CChainState to GetUTXOStats\" (a9e77bb0a70a473aab0a52e0d411af8f692ab700)\r\n\r\nFrom the commit description \"ATTENTION\" this may be a work in progress, but a suggestion here might be to just pass in CCoinsView and blockman as separate arguments, instead of passing the whole chain state class.",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-10-23T22:03:12Z",
      "diff_hunk" : "@@ -54,16 +54,18 @@ static void ApplyStats(CCoinsStats& stats, std::nullptr_t, const uint256& hash,\n \n //! Calculate statistics about the unspent transaction output set\n template <typename T>\n-static bool GetUTXOStats(CCoinsView* view, CCoinsStats& stats, T hash_obj, const std::function<void()>& interruption_point)\n+static bool GetUTXOStats(CChainState& chainstate, CCoinsStats& stats, T hash_obj, const std::function<void()>& interruption_point)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511174948",
      "id" : 511174948,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE3NDk0OA==",
      "original_commit_id" : "a9e77bb0a70a473aab0a52e0d411af8f692ab700",
      "original_line" : 57,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/node/coinstats.cpp",
      "position" : null,
      "pull_request_review_id" : 516018887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511174948",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511176771"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511176771"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"net_processing: Move some static functions to PeerManager\" (053c84ce5a99f0ef87fe23164dc11a0eac725680)\r\n\r\nMight be nice to split this commit, and move the function bodies in a MOVEONLY commit. But this is maybe less important than it used to be now that git diff displays moved code better than it used to",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-10-23T22:09:43Z",
      "diff_hunk" : "@@ -563,41 +561,6 @@ static bool MarkBlockAsInFlight(CTxMemPool& mempool, NodeId nodeid, const uint25\n     return true;\n }\n \n-/** Check whether the last unknown block a peer advertised is not yet known. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511176771",
      "id" : 511176771,
      "line" : 576,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE3Njc3MQ==",
      "original_commit_id" : "053c84ce5a99f0ef87fe23164dc11a0eac725680",
      "original_line" : 576,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 55,
      "pull_request_review_id" : 516018887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511176771",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Reproduced ci error locally https://cirrus-ci.com/task/5403931733917696?command=ci#L4078\r\n\r\n```sh\r\ngit checkout 2a05215114f2e4ebf764647af7e48ca1a8cb9ff9\r\n./autogen.sh\r\n./configure CXX=clang++ CXXFLAGS=\"-fsanitize=address -fno-omit-frame-pointer\" LDFLAGS=-fsanitize=address --enable-debug --enable-werror --disable-ccache\r\nmake -C src qt/test/test_bitcoin-qt && ASAN_OPTIONS=abort_on_error=1 gdb -ex run --args src/qt/test/test_bitcoin-qt\r\n```\r\n\r\n<details><summary>stack</summary>\r\n<p>\r\n\r\n```\r\nThread 1 \"b-test\" received signal SIGABRT, Aborted.\r\n__GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51\r\n51      ../sysdeps/unix/sysv/linux/raise.c: No such file or directory.\r\n(gdb) bt\r\n#0  __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51\r\n#1  0x00007ffff337f8b1 in __GI_abort () at abort.c:79\r\n#2  0x0000555555ac21ab in __sanitizer::Abort() ()\r\n#3  0x0000555555abf4d8 in __sanitizer::Die() ()\r\n#4  0x0000555555aa175d in __asan::ReportGenericError(unsigned long, unsigned long, unsigned long, unsigned long, bool, unsigned long, unsigned int, bool) ()\r\n#5  0x0000555555aa1f48 in __asan_report_load4 ()\r\n#6  0x00005555575f4d03 in base_uint<256u>::CompareTo (this=0x60d00016c958, b=...) at arith_uint256.cpp:112\r\n#7  0x000055555615213a in operator< (a=..., b=...) at ./arith_uint256.h:220\r\n#8  0x0000555556a710e4 in BlockManager::AddToBlockIndex (this=0x611000129720, block=...) at validation.cpp:3183\r\n#9  0x0000555556a9466d in CChainState::LoadGenesisBlock (this=0x612000101440, chainparams=...) at validation.cpp:4631\r\n#10 0x0000555556d1dcaa in TestingSetup::TestingSetup (this=0x7fffffffb2b0, chainName=\"main\", extra_args=std::vector of length 0, capacity 0) at test/util/setup_common.cpp:183\r\n#11 0x0000555555af39df in RPCNestedTests::rpcNestedTests (this=0x7fffffffded0) at qt/test/rpcnestedtests.cpp:36\r\n#12 0x0000555555b990be in RPCNestedTests::qt_static_metacall (_o=0x7fffffffded0, _c=QMetaObject::InvokeMetaMethod, _id=0, _a=0x7fffffffd2c0)\r\n    at qt/test/moc_rpcnestedtests.cpp:70\r\n#13 0x00007ffff6b9e003 in QMetaMethod::invoke(QObject*, Qt::ConnectionType, QGenericReturnArgument, QGenericArgument, QGenericArgument, QGenericArgument, QGenericArgument, QGenericArgument, QGenericArgument, QGenericArgument, QGenericArgument, QGenericArgument, QGenericArgument) const () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\r\n#14 0x00007ffff66dc79a in ?? () from /usr/lib/x86_64-linux-gnu/libQt5Test.so.5\r\n#15 0x00007ffff66dd4f0 in ?? () from /usr/lib/x86_64-linux-gnu/libQt5Test.so.5\r\n#16 0x00007ffff66dda61 in ?? () from /usr/lib/x86_64-linux-gnu/libQt5Test.so.5\r\n#17 0x00007ffff66de02b in QTest::qExec(QObject*, int, char**) () from /usr/lib/x86_64-linux-gnu/libQt5Test.so.5\r\n#18 0x0000555555afead1 in main (argc=1, argv=0x7fffffffe298) at qt/test/test_main.cpp:85\r\n```\r\n\r\n</p>\r\n</details>",
      "created_at" : "2020-10-26T16:20:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#issuecomment-716660486",
      "id" : 716660486,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20158",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNjY2MDQ4Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-26T16:21:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/716660486",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Following change partially reverting 50f680b402a84b605aa9b9aa58cb571ef32e190e seems to fix the error:\r\n\r\n```diff\r\n--- a/src/qt/test/apptests.cpp\r\n+++ b/src/qt/test/apptests.cpp\r\n@@ -84,6 +84,10 @@ void AppTests::appTests()\r\n     // Reset global state to avoid interfering with later tests.\r\n     LogInstance().DisconnectTestLogger();\r\n     AbortShutdown();\r\n+    {\r\n+        LOCK(cs_main);\r\n+        ::pindexBestHeader = nullptr;\r\n+    }\r\n }\r\n \r\n //! Entry point for BitcoinGUI tests.\r\n```\r\n\r\nError is happening here:\r\n\r\n```\r\n#8  0x0000555556a710e4 in BlockManager::AddToBlockIndex (this=0x611000129860, block=...) at validation.cpp:3183\r\n3183        if (pindexBestHeader == nullptr || pindexBestHeader->nChainWork < pindexNew->nChainWork)\r\n``` ",
      "created_at" : "2020-10-26T17:01:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#issuecomment-716688829",
      "id" : 716688829,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20158",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNjY4ODgyOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-26T17:01:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/716688829",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-10-28T06:59:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#issuecomment-717741613",
      "id" : 717741613,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20158",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNzc0MTYxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-28T06:59:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/717741613",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r513393711"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/513393711"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this should be changed to `reset()` like the other unique pointers.",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-10-28T12:12:32Z",
      "diff_hunk" : "@@ -303,6 +303,9 @@ void Shutdown(NodeContext& node)\n     GetMainSignals().UnregisterBackgroundSignalScheduler();\n     globalVerifyHandle.reset();\n     ECC_Stop();\n+    if (node.chainman) {\n+        UnloadBlockIndex(node.mempool.get(), *node.chainman);\n+    }\n     node.mempool.reset();\n     node.chainman = nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r513393711",
      "id" : 513393711,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM5MzcxMQ==",
      "original_commit_id" : "09daa42b604f08477f66cf4ba1c8ac2905e27c05",
      "original_line" : 310,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 518594760,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/513393711",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r513408032"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/513408032"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is only used in validation_chainstatemanager_tests.cpp. Rather than adding complexity to the common setup for all tests, can you define this struct inside validation_chainstatemanager_tests.cpp and leave setup_common unchanged?",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-10-28T12:37:52Z",
      "diff_hunk" : "@@ -82,12 +82,17 @@ struct BasicTestingSetup {\n     const fs::path m_path_root;\n };\n \n+struct ChainTestingSetup : public BasicTestingSetup {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r513408032",
      "id" : 513408032,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQwODAzMg==",
      "original_commit_id" : "09daa42b604f08477f66cf4ba1c8ac2905e27c05",
      "original_line" : 85,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/util/setup_common.h",
      "position" : null,
      "pull_request_review_id" : 518594760,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/513408032",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r516869430"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516869430"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What would be the utility of finding a fork against a chain which isn't the current active one ? May we have a future module interested in learning the common ancestor between a discovered locator and a chain known to not-be the best one ? \r\n\r\nE.g, in `src/net_processing`, at `NetMsgType::GETBLOCKS` reception, this common ancestor is used at a starting point to send the rest of the chain to the forked-off `GETBLOCKS` requester. IMO, I don't see how it can be useful computation for a requester to chain-sync on a chain which is known as not being the best. Even if you don't have live-access to the rest of the p2p network, you still have a notion of a most-work chain.",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-11-03T18:22:19Z",
      "diff_hunk" : "@@ -440,6 +437,9 @@ class BlockManager\n \n     CBlockIndex* LookupBlockIndex(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    /** Find the last common block between the parameter chain and a locator. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r516869430",
      "id" : 516869430,
      "line" : 424,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg2OTQzMA==",
      "original_commit_id" : "5d587c26aff8ce9a3b7e5348d3bd17cfb2a29677",
      "original_line" : 424,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 121,
      "pull_request_review_id" : 522766205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516869430",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r516875108"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516875108"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think interpretation of this comment can be confusing.\r\n\r\nIt does say \"one more than the inputs.GetBestBlock()\" where GetBestBlock is defined as \"Get best block at the time this cursor was created\" (L173, in `src/coins.h`). If `GetSpendHeight` means the spend height of a utxo, you may have between \"one to infinite numbers of blocks\" between utxo creation height and its spending height.\r\n\r\nBut still the code of this function return `pindexPrev->nHeight + 1` where `pindexPrev` is the indice of `inputs.GetBestBlock()`. So this function return the earliest valid spending height of a given utxo set ?  ",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-11-03T18:32:55Z",
      "diff_hunk" : "@@ -440,6 +440,13 @@ class BlockManager\n     /** Find the last common block between the parameter chain and a locator. */\n     CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    /**\n+     * Return the spend height, which is one more than the inputs.GetBestBlock().",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r516875108",
      "id" : 516875108,
      "line" : 430,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg3NTEwOA==",
      "original_commit_id" : "4d1456824bee6b961462c7fa1f3a0f33987260d2",
      "original_line" : 430,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 127,
      "pull_request_review_id" : 522766205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516875108",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r516882150"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516882150"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should you introduce a `AssertLockHeld(cs_main)` here to demonstrate the lock tacking is still enforced ? Some moved function (`FindForkInGlobalIndex`) already have such one.\r\n\r\nMore generally, I think you PR description could talk about what the actual lock model of this subsystem and how do you convey to reviewers that old code lock model is equivalent to the new one (or not if you've changed some locks for good reasons).",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-11-03T18:45:56Z",
      "diff_hunk" : "@@ -3472,14 +3471,15 @@ std::vector<unsigned char> GenerateCoinbaseCommitment(CBlock& block, const CBloc\n }\n \n //! Returns last CBlockIndex* that is a checkpoint\n-static CBlockIndex* GetLastCheckpoint(const CCheckpointData& data) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+CBlockIndex* BlockManager::GetLastCheckpoint(const CCheckpointData& data)\n {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r516882150",
      "id" : 516882150,
      "line" : 3448,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg4MjE1MA==",
      "original_commit_id" : "c6a46621fc849f470e06358c7d21ecf9facc1e09",
      "original_line" : 3448,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 621,
      "pull_request_review_id" : 522766205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516882150",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r516887573"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516887573"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This comment can be improved by specifying how `m_blockman` is used by `CChainState` thus documenting the rational of its presence.",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-11-03T18:55:51Z",
      "diff_hunk" : "@@ -543,18 +543,18 @@ class CChainState {\n      */\n     mutable std::atomic<bool> m_cached_finished_ibd{false};\n \n-    //! Reference to a BlockManager instance which itself is shared across all\n-    //! CChainState instances. Keeping a local reference allows us to test more\n-    //! easily as opposed to referencing a global.\n-    BlockManager& m_blockman;\n-\n     //! mempool that is kept in sync with the chain\n     CTxMemPool& m_mempool;\n \n     //! Manages the UTXO set, which is a reflection of the contents of `m_chain`.\n     std::unique_ptr<CoinsViews> m_coins_views;\n \n public:\n+    //! Reference to a BlockManager instance which itself is shared across all\n+    //! CChainState instances. Keeping a local reference allows us to test more\n+    //! easily as opposed to referencing a global.\n+    BlockManager& m_blockman GUARDED_BY(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r516887573",
      "id" : 516887573,
      "line" : 538,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg4NzU3Mw==",
      "original_commit_id" : "959f6268239898947abdcbc788ba772066711a3f",
      "original_line" : 538,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 155,
      "pull_request_review_id" : 522766205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516887573",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK, excited for this to be sliced into smaller PRs for deeper review!",
      "created_at" : "2020-11-04T06:41:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#issuecomment-721542870",
      "id" : 721542870,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20158",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMTU0Mjg3MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-04T06:41:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/721542870",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r517561522"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517561522"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The reason why I thought it'd be okay to lock `cs_main` after `mempool.cs` was because that's basically what's happening in GetSpendHeight prior to this changeset. As in:\r\n\r\n1. We lock `mempool.cs` at the start of `CTxMemPool::check`\r\n2. We call `GetSpendHeight`, which locks `cs_main`\r\n\r\nAre you saying that this was wrong all along?",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-11-04T18:53:42Z",
      "diff_hunk" : "@@ -632,7 +632,7 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\n     uint64_t innerUsage = 0;\n \n     CCoinsViewCache mempoolDuplicate(const_cast<CCoinsViewCache*>(pcoins));\n-    const int64_t spendheight = GetSpendHeight(mempoolDuplicate);\n+    const int64_t spendheight = WITH_LOCK(::cs_main, return g_chainman.m_blockman.GetSpendHeight(mempoolDuplicate));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r517561522",
      "id" : 517561522,
      "in_reply_to_id" : 510481852,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU2MTUyMg==",
      "original_commit_id" : "05a9e983b421f7728c6cf4c18525abba8a68c82a",
      "original_line" : 635,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 523646390,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517561522",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r517575732"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517575732"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Digging in the git history a bit, it seems that the earliest of this trio -- namely `VersionBitsTipState` -- was introduced in d23f6c6a0d2. My hypothesis is that the `LOCK(cs_main)` was added in order to stop the chain from advancing and make sure that the caller got info on the actual tip. However, it seems like a `AssertLockHeld(cs_main);` annotation would have been much more suitable in that case (and existed in the codebase at d23f6c6a0d2).\r\n\r\nI'm not entirely sure about the original intent here, so perhaps @sipa can enlighten me and make sure I'm not missing something!",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-11-04T19:19:05Z",
      "diff_hunk" : "@@ -5036,24 +5036,6 @@ CBlockFileInfo* GetBlockFileInfo(size_t n)\n     return &vinfoBlockFile.at(n);\n }\n \n-ThresholdState VersionBitsTipState(const Consensus::Params& params, Consensus::DeploymentPos pos)\n-{\n-    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r517575732",
      "id" : 517575732,
      "in_reply_to_id" : 510495615,
      "line" : 5030,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU3NTczMg==",
      "original_commit_id" : "b60c7e5a5a60fe60a3bc8ba540dc7c8d5c935869",
      "original_line" : 5030,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 973,
      "pull_request_review_id" : 523664278,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517575732",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r517575818"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517575818"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed!",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-11-04T19:19:14Z",
      "diff_hunk" : "@@ -672,7 +667,7 @@ class CChainState {\n     bool ActivateBestChain(\n         BlockValidationState& state,\n         const CChainParams& chainparams,\n-        std::shared_ptr<const CBlock> pblock) LOCKS_EXCLUDED(cs_main);\n+        std::shared_ptr<const CBlock> pblock = std::shared_ptr<const CBlock>()) LOCKS_EXCLUDED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r517575818",
      "id" : 517575818,
      "in_reply_to_id" : 510485799,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU3NTgxOA==",
      "original_commit_id" : "7e15a2c88e49ec6719997e2cdd8481ddd4e7f6be",
      "original_line" : 670,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 523664380,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517575818",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r517576337"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517576337"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done!",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-11-04T19:20:06Z",
      "diff_hunk" : "@@ -170,11 +170,12 @@ namespace {\n     std::set<int> setDirtyFileInfo;\n } // anon namespace\n \n-CBlockIndex* LookupBlockIndex(const uint256& hash)\n+CBlockIndex* BlockManager::LookupBlockIndex(const uint256& hash)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r517576337",
      "id" : 517576337,
      "in_reply_to_id" : 510474839,
      "line" : 157,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU3NjMzNw==",
      "original_commit_id" : "8615dbd1250c2dddec2f54bf80e2a1b7013bc871",
      "original_line" : 157,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 35,
      "pull_request_review_id" : 523664978,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517576337",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Reviewers: Just split off the first few fix commits in a non-draft PR #20323!",
      "created_at" : "2020-11-05T19:01:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#issuecomment-722576976",
      "id" : 722576976,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20158",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMjU3Njk3Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-05T19:01:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/722576976",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r518457319"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/518457319"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This comment still holds on `CChainState::ActivateBestChain`. But I wonder if it shouldn't be changed to a \"Must not be called with cs_main held` given we assert that lock isn't held L2878 (`src/validation.cpp`).",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-11-06T00:45:22Z",
      "diff_hunk" : "@@ -175,13 +175,6 @@ void ThreadScriptCheck(int worker_num);\n  * @returns                    The tx if found, otherwise nullptr\n  */\n CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMemPool* const mempool, const uint256& hash, const Consensus::Params& consensusParams, uint256& hashBlock);\n-/**\n- * Find the best known block, and make it the tip of the block chain\n- *\n- * May not be called with cs_main held. May not be called in a",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r518457319",
      "id" : 518457319,
      "line" : 179,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ1NzMxOQ==",
      "original_commit_id" : "6a4f33ad988502ecbef3d88f035408f851bceb0b",
      "original_line" : 181,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 32,
      "pull_request_review_id" : 524780926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-06T01:22:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/518457319",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r518459897"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/518459897"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this commit message should say something like \"Use accessible chainstate in ChainstateManager::ProcessNewBlock\"",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-11-06T00:53:59Z",
      "diff_hunk" : "@@ -3860,18 +3861,18 @@ bool ChainstateManager::ProcessNewBlock(const CChainParams& chainparams, const s\n         bool ret = CheckBlock(*pblock, state, chainparams.GetConsensus());\n         if (ret) {\n             // Store to disk\n-            ret = ::ChainstateActive().AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\n+            ret = ActiveChainstate().AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r518459897",
      "id" : 518459897,
      "line" : 3836,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ1OTg5Nw==",
      "original_commit_id" : "f8bb2969378fcea872ec889eaa50676587921328",
      "original_line" : 3864,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 700,
      "pull_request_review_id" : 524780926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-06T01:22:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/518459897",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r518464000"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/518464000"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This commit doesn't compile as `CheckFinalTx` is used L197  (`src/interfaces/chain.cpp`). But fixed in next commit AFAICT.",
      "commit_id" : "912512a27c1caa59eb928e10f1022d1b33c2d711",
      "created_at" : "2020-11-06T01:07:53Z",
      "diff_hunk" : "@@ -218,7 +218,7 @@ void UpdateCoins(const CTransaction& tx, CCoinsViewCache& inputs, int nHeight);\n  *\n  * See consensus/consensus.h for flag definitions.\n  */\n-bool CheckFinalTx(const CTransaction &tx, int flags = -1) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+bool CheckFinalTx(CBlockIndex* active_chain_tip, const CTransaction &tx, int flags = -1) EXCLUSIVE_LOCKS_REQUIRED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r518464000",
      "id" : 518464000,
      "line" : 212,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ2NDAwMA==",
      "original_commit_id" : "5433a716e7f871204474117b0f9bdcd6ad8a16ce",
      "original_line" : 221,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 71,
      "pull_request_review_id" : 524780926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-06T01:22:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/518464000",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   }
]
