[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20233 (addrman: Make consistency checks a runtime option by jnewbery)\n* #20228 (addrman: Make addrman a top-level component by jnewbery)\n* #20222 (refactor: CTxMempool constructor clean up by ellemouton)\n* #20217 (net: Remove g_relay_txes by jnewbery)\n* #20187 (Addrman: test-before-evict bugfix and improvements for block-relay-only peers by sdaftuar)\n* #20054 (Remove confusing and useless \"unexpected version\" warning by MarcoFalke)\n* #20017 (rpc: Add RPCContext by promag)\n* #19937 (signet mining utility by ajtowns)\n* #19910 (net processing: Move peer_map to PeerManager by jnewbery)\n* #19905 (Remove dead CheckForkWarningConditionsOnNewFork by MarcoFalke)\n* #19901 (Avoid locking CTxMemPool::cs recursively in CTxMemPool::DynamicMemoryUsage() by hebasto)\n* #19858 (Periodically make block-relay connections and sync headers by sdaftuar)\n* #19843 (Refactoring and minor improvement for self-advertisements by naumenkogs)\n* #19829 (net processing: Move block inventory state to net_processing by jnewbery)\n* #19806 (validation: UTXO snapshot activation by jamesob)\n* #19594 (refactor: Make mapBlocksUnknownParent local, and rename it by hebasto)\n* #19573 (Replace unused BIP 9 logic with draft BIP 8 by luke-jr)\n* #19438 (Introduce deploymentstatus by ajtowns)\n* #19425 (refactor: Get rid of more redundant chain methods by ryanofsky)\n* #19259 (tests: Add fuzzing harness for LoadMempool(...) and DumpMempool(...) by practicalswift)\n* #18766 (Disable fee estimation in blocksonly mode (by removing the fee estimates global) by darosior)\n* #18731 (refactor: Make CCheckQueue RAII-styled by hebasto)\n* #18710 (Add local thread pool to CCheckQueue by hebasto)\n* #18354 (Use shared pointers only in validation interface by bvbfan)\n* #16981 (Improve runtime performance of --reindex by LarryRuane)\n* #16333 (test: Set BIP34Height = 2 for regtest by MarcoFalke)\n* #15719 (Wallet passive startup by ryanofsky)\n* #10443 (Add fee_est tool for debugging fee estimation code by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-10-15T21:03:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#issuecomment-709588627",
      "id" : 709588627,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20158",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwOTU4ODYyNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-28T02:35:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/709588627",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.",
      "created_at" : "2020-10-16T10:01:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#issuecomment-709951262",
      "id" : 709951262,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20158",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwOTk1MTI2Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-16T10:01:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/709951262",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK - really like the direction of this work.",
      "created_at" : "2020-10-16T16:03:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#issuecomment-710143583",
      "id" : 710143583,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20158",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxMDE0MzU4Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-16T16:03:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/710143583",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510474839"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510474839"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"validation: Move LookupBlockIndex to BlockManager\" (8615dbd1250c2dddec2f54bf80e2a1b7013bc871)\r\n\r\nCommit doesn't compile, not sure if this is intended. Could make this a wrapper function until after the scripted diff",
      "commit_id" : "2a05215114f2e4ebf764647af7e48ca1a8cb9ff9",
      "created_at" : "2020-10-22T21:41:48Z",
      "diff_hunk" : "@@ -170,11 +170,12 @@ namespace {\n     std::set<int> setDirtyFileInfo;\n } // anon namespace\n \n-CBlockIndex* LookupBlockIndex(const uint256& hash)\n+CBlockIndex* BlockManager::LookupBlockIndex(const uint256& hash)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510474839",
      "id" : 510474839,
      "line" : 157,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ3NDgzOQ==",
      "original_commit_id" : "8615dbd1250c2dddec2f54bf80e2a1b7013bc871",
      "original_line" : 173,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 35,
      "pull_request_review_id" : 515140920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-22T22:41:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510474839",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510477316"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510477316"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"validation: Move FindForkInGlobalIndex to BlockManager\" (8dbedcb3bf123411ebcd9ccb7521b44cacc8e385)\r\n\r\nre: \"Let me know if this should be changed\", this makes sense to me. A possible alternative might be to make this a chain method, too",
      "commit_id" : "2a05215114f2e4ebf764647af7e48ca1a8cb9ff9",
      "created_at" : "2020-10-22T21:47:14Z",
      "diff_hunk" : "@@ -440,6 +437,9 @@ class BlockManager\n \n     CBlockIndex* LookupBlockIndex(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    /** Find the last common block between the parameter chain and a locator. */\n+    CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator) EXCLUSIVE_LOCKS_REQUIRED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510477316",
      "id" : 510477316,
      "line" : 425,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ3NzMxNg==",
      "original_commit_id" : "8dbedcb3bf123411ebcd9ccb7521b44cacc8e385",
      "original_line" : 441,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 122,
      "pull_request_review_id" : 515140920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-22T22:41:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510477316",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510481852"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510481852"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"validation: Move GetSpendHeight to BlockManager\" (05a9e983b421f7728c6cf4c18525abba8a68c82a)\r\n\r\nThis isn't changing behavior, but I don't think it's correct to lock cs_main after mempool.cs. Other code locks in the opposite order so there could be a deadlock if cs_main lock is actually acquired here and this isn't a redundant recursive lock. Maybe it is possible to clean this up simply by annotating CTxMemPool::check to already require cs_main.",
      "commit_id" : "2a05215114f2e4ebf764647af7e48ca1a8cb9ff9",
      "created_at" : "2020-10-22T21:57:57Z",
      "diff_hunk" : "@@ -632,7 +632,7 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\n     uint64_t innerUsage = 0;\n \n     CCoinsViewCache mempoolDuplicate(const_cast<CCoinsViewCache*>(pcoins));\n-    const int64_t spendheight = GetSpendHeight(mempoolDuplicate);\n+    const int64_t spendheight = WITH_LOCK(::cs_main, return g_chainman.m_blockman.GetSpendHeight(mempoolDuplicate));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510481852",
      "id" : 510481852,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ4MTg1Mg==",
      "original_commit_id" : "05a9e983b421f7728c6cf4c18525abba8a68c82a",
      "original_line" : 635,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 515140920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-22T22:41:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510481852",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510485799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510485799"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"validation: Remove global ::ActivateBestChain\" (7e15a2c88e49ec6719997e2cdd8481ddd4e7f6be)\r\n\r\nWould seem clearer to say `= nullptr` if that works and you don't prefer this longer version",
      "commit_id" : "2a05215114f2e4ebf764647af7e48ca1a8cb9ff9",
      "created_at" : "2020-10-22T22:07:36Z",
      "diff_hunk" : "@@ -672,7 +667,7 @@ class CChainState {\n     bool ActivateBestChain(\n         BlockValidationState& state,\n         const CChainParams& chainparams,\n-        std::shared_ptr<const CBlock> pblock) LOCKS_EXCLUDED(cs_main);\n+        std::shared_ptr<const CBlock> pblock = std::shared_ptr<const CBlock>()) LOCKS_EXCLUDED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510485799",
      "id" : 510485799,
      "line" : 662,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ4NTc5OQ==",
      "original_commit_id" : "7e15a2c88e49ec6719997e2cdd8481ddd4e7f6be",
      "original_line" : 670,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 184,
      "pull_request_review_id" : 515140920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-22T22:41:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510485799",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510495615"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510495615"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"validation: Remove global ::VersionBitsTip{State,SinceHeight,Statistics}\" (b60c7e5a5a60fe60a3bc8ba540dc7c8d5c935869)\r\n\r\nI'm a little unclear why it's safe to drop these locks, or why they were here to begin with, or if VersionBits or ChainActive or Tip functions should have been annotated to require cs_main. It seems like something should have be annotated if cs_main was required here",
      "commit_id" : "2a05215114f2e4ebf764647af7e48ca1a8cb9ff9",
      "created_at" : "2020-10-22T22:33:40Z",
      "diff_hunk" : "@@ -5036,24 +5036,6 @@ CBlockFileInfo* GetBlockFileInfo(size_t n)\n     return &vinfoBlockFile.at(n);\n }\n \n-ThresholdState VersionBitsTipState(const Consensus::Params& params, Consensus::DeploymentPos pos)\n-{\n-    LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510495615",
      "id" : 510495615,
      "line" : 5028,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ5NTYxNQ==",
      "original_commit_id" : "b60c7e5a5a60fe60a3bc8ba540dc7c8d5c935869",
      "original_line" : 5041,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 964,
      "pull_request_review_id" : 515140920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-22T22:41:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510495615",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511162039"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511162039"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"validation: Pass in spendheight to CTxMemPool::check\" (0af807545a93891df691acb43e07fd465c996ecd)\r\n\r\n~This is fine, but not sure if it was intentional to keep this TODO comment here, but not in the other asserts~\r\n\r\nEDIT: Apparently this is done to help the 09a153e13506d6352e478256ce4220232455000f scripted-diff, and the other asserts treat `addressof` as the TODO",
      "commit_id" : "2a05215114f2e4ebf764647af7e48ca1a8cb9ff9",
      "created_at" : "2020-10-23T21:24:51Z",
      "diff_hunk" : "@@ -633,7 +633,7 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\n     uint64_t innerUsage = 0;\n \n     CCoinsViewCache mempoolDuplicate(const_cast<CCoinsViewCache*>(pcoins));\n-    const int64_t spendheight = WITH_LOCK(::cs_main, return g_chainman.m_blockman.GetSpendHeight(mempoolDuplicate));\n+    assert(WITH_LOCK(::cs_main, return g_chainman.m_blockman.GetSpendHeight(mempoolDuplicate)) == spendheight); // TODO: REVIEW-ONLY, REMOVE IN FUTURE COMMIT",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511162039",
      "id" : 511162039,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE2MjAzOQ==",
      "original_commit_id" : "0af807545a93891df691acb43e07fd465c996ecd",
      "original_line" : 636,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 516018887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T22:34:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511162039",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511165117"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511165117"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510481852\r\n\r\n> In commit \"validation: Move GetSpendHeight to BlockManager\" ([05a9e98](https://github.com/bitcoin/bitcoin/commit/05a9e983b421f7728c6cf4c18525abba8a68c82a))\r\n> \r\n> This isn't changing behavior, but I don't think it's correct to lock cs_main after mempool.cs. Other code locks in the opposite order so there could be a deadlock if cs_main lock is actually acquired here and this isn't a redundant recursive lock. Maybe it is possible to clean this up simply by annotating CTxMemPool::check to already require cs_main.\r\n\r\nAnother way to address this could be to move later commit 0af807545a93891df691acb43e07fd465c996ecd up, and pass the height into check() instead of locking cs_main to figure out the height. Though it seems like cs_main probably needs to be held during the whole check() call anyway and maybe it should just be annotated",
      "commit_id" : "2a05215114f2e4ebf764647af7e48ca1a8cb9ff9",
      "created_at" : "2020-10-23T21:34:02Z",
      "diff_hunk" : "@@ -632,7 +632,7 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\n     uint64_t innerUsage = 0;\n \n     CCoinsViewCache mempoolDuplicate(const_cast<CCoinsViewCache*>(pcoins));\n-    const int64_t spendheight = GetSpendHeight(mempoolDuplicate);\n+    const int64_t spendheight = WITH_LOCK(::cs_main, return g_chainman.m_blockman.GetSpendHeight(mempoolDuplicate));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511165117",
      "id" : 511165117,
      "in_reply_to_id" : 510481852,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE2NTExNw==",
      "original_commit_id" : "05a9e983b421f7728c6cf4c18525abba8a68c82a",
      "original_line" : 635,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 516018887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T22:34:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511165117",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511170968"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511170968"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"miner: Add chainstate member to BlockAssembler\" (9d74aa3fd30810197d24ec0768f3e28467abe114)\r\n\r\nThis appears to be safe because cs_main is held the entire time a BlockAssembler object is constructed is used `cs_main` is held, but because unlike m_mempool, m_active_chainstate will be able to change at runtime with utxo snapshot loading, it might be safer to just pass CChainState as a regular function argument to methods that need it. Another alternative would might be to add BlockAssembler documentation to say that it's meant to be used and thrown away, not kept alive and reused, at least if the active chain might change",
      "commit_id" : "2a05215114f2e4ebf764647af7e48ca1a8cb9ff9",
      "created_at" : "2020-10-23T21:50:51Z",
      "diff_hunk" : "@@ -146,6 +146,7 @@ class BlockAssembler\n     int64_t nLockTimeCutoff;\n     const CChainParams& chainparams;\n     const CTxMemPool& m_mempool;\n+    CChainState& m_active_chainstate;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511170968",
      "id" : 511170968,
      "line" : 149,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE3MDk2OA==",
      "original_commit_id" : "9d74aa3fd30810197d24ec0768f3e28467abe114",
      "original_line" : 149,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/miner.h",
      "position" : 4,
      "pull_request_review_id" : 516018887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T22:34:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511170968",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511173525"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511173525"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"miner: Pass in blockman to ::RegenerateCommitments\" (a1acd859bd06ead8fb38fac2d10340a658d7a061)\r\n\r\n\r\nIf this lock is needed now can RegenerateCommitments be annotated to require cs_main? Also, why is this lock needed now if it wasn't needed before?",
      "commit_id" : "2a05215114f2e4ebf764647af7e48ca1a8cb9ff9",
      "created_at" : "2020-10-23T21:58:45Z",
      "diff_hunk" : "@@ -374,7 +374,10 @@ static RPCHelpMan generateblock()\n \n     // Add transactions\n     block.vtx.insert(block.vtx.end(), txs.begin(), txs.end());\n-    RegenerateCommitments(block);\n+    {\n+        LOCK(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511173525",
      "id" : 511173525,
      "line" : 381,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE3MzUyNQ==",
      "original_commit_id" : "a1acd859bd06ead8fb38fac2d10340a658d7a061",
      "original_line" : 378,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : 73,
      "pull_request_review_id" : 516018887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T22:34:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511173525",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511174948"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511174948"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"node/coinstats: Pass in CChainState to GetUTXOStats\" (a9e77bb0a70a473aab0a52e0d411af8f692ab700)\r\n\r\nFrom the commit description \"ATTENTION\" this may be a work in progress, but a suggestion here might be to just pass in CCoinsView and blockman as separate arguments, instead of passing the whole chain state class.",
      "commit_id" : "2a05215114f2e4ebf764647af7e48ca1a8cb9ff9",
      "created_at" : "2020-10-23T22:03:12Z",
      "diff_hunk" : "@@ -54,16 +54,18 @@ static void ApplyStats(CCoinsStats& stats, std::nullptr_t, const uint256& hash,\n \n //! Calculate statistics about the unspent transaction output set\n template <typename T>\n-static bool GetUTXOStats(CCoinsView* view, CCoinsStats& stats, T hash_obj, const std::function<void()>& interruption_point)\n+static bool GetUTXOStats(CChainState& chainstate, CCoinsStats& stats, T hash_obj, const std::function<void()>& interruption_point)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511174948",
      "id" : 511174948,
      "line" : 57,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE3NDk0OA==",
      "original_commit_id" : "a9e77bb0a70a473aab0a52e0d411af8f692ab700",
      "original_line" : 57,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/node/coinstats.cpp",
      "position" : 5,
      "pull_request_review_id" : 516018887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T22:34:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511174948",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511176771"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511176771"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"net_processing: Move some static functions to PeerManager\" (053c84ce5a99f0ef87fe23164dc11a0eac725680)\r\n\r\nMight be nice to split this commit, and move the function bodies in a MOVEONLY commit. But this is maybe less important than it used to be now that git diff displays moved code better than it used to",
      "commit_id" : "2a05215114f2e4ebf764647af7e48ca1a8cb9ff9",
      "created_at" : "2020-10-23T22:09:43Z",
      "diff_hunk" : "@@ -563,41 +561,6 @@ static bool MarkBlockAsInFlight(CTxMemPool& mempool, NodeId nodeid, const uint25\n     return true;\n }\n \n-/** Check whether the last unknown block a peer advertised is not yet known. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#discussion_r511176771",
      "id" : 511176771,
      "line" : 566,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE3Njc3MQ==",
      "original_commit_id" : "053c84ce5a99f0ef87fe23164dc11a0eac725680",
      "original_line" : 566,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 16,
      "pull_request_review_id" : 516018887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20158",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-23T22:34:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511176771",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Reproduced ci error locally https://cirrus-ci.com/task/5403931733917696?command=ci#L4078\r\n\r\n```sh\r\ngit checkout 2a05215114f2e4ebf764647af7e48ca1a8cb9ff9\r\n./autogen.sh\r\n./configure CXX=clang++ CXXFLAGS=\"-fsanitize=address -fno-omit-frame-pointer\" LDFLAGS=-fsanitize=address --enable-debug --enable-werror --disable-ccache\r\nmake -C src qt/test/test_bitcoin-qt && ASAN_OPTIONS=abort_on_error=1 gdb -ex run --args src/qt/test/test_bitcoin-qt\r\n```\r\n\r\n<details><summary>stack</summary>\r\n<p>\r\n\r\n```\r\nThread 1 \"b-test\" received signal SIGABRT, Aborted.\r\n__GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51\r\n51      ../sysdeps/unix/sysv/linux/raise.c: No such file or directory.\r\n(gdb) bt\r\n#0  __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51\r\n#1  0x00007ffff337f8b1 in __GI_abort () at abort.c:79\r\n#2  0x0000555555ac21ab in __sanitizer::Abort() ()\r\n#3  0x0000555555abf4d8 in __sanitizer::Die() ()\r\n#4  0x0000555555aa175d in __asan::ReportGenericError(unsigned long, unsigned long, unsigned long, unsigned long, bool, unsigned long, unsigned int, bool) ()\r\n#5  0x0000555555aa1f48 in __asan_report_load4 ()\r\n#6  0x00005555575f4d03 in base_uint<256u>::CompareTo (this=0x60d00016c958, b=...) at arith_uint256.cpp:112\r\n#7  0x000055555615213a in operator< (a=..., b=...) at ./arith_uint256.h:220\r\n#8  0x0000555556a710e4 in BlockManager::AddToBlockIndex (this=0x611000129720, block=...) at validation.cpp:3183\r\n#9  0x0000555556a9466d in CChainState::LoadGenesisBlock (this=0x612000101440, chainparams=...) at validation.cpp:4631\r\n#10 0x0000555556d1dcaa in TestingSetup::TestingSetup (this=0x7fffffffb2b0, chainName=\"main\", extra_args=std::vector of length 0, capacity 0) at test/util/setup_common.cpp:183\r\n#11 0x0000555555af39df in RPCNestedTests::rpcNestedTests (this=0x7fffffffded0) at qt/test/rpcnestedtests.cpp:36\r\n#12 0x0000555555b990be in RPCNestedTests::qt_static_metacall (_o=0x7fffffffded0, _c=QMetaObject::InvokeMetaMethod, _id=0, _a=0x7fffffffd2c0)\r\n    at qt/test/moc_rpcnestedtests.cpp:70\r\n#13 0x00007ffff6b9e003 in QMetaMethod::invoke(QObject*, Qt::ConnectionType, QGenericReturnArgument, QGenericArgument, QGenericArgument, QGenericArgument, QGenericArgument, QGenericArgument, QGenericArgument, QGenericArgument, QGenericArgument, QGenericArgument, QGenericArgument) const () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\r\n#14 0x00007ffff66dc79a in ?? () from /usr/lib/x86_64-linux-gnu/libQt5Test.so.5\r\n#15 0x00007ffff66dd4f0 in ?? () from /usr/lib/x86_64-linux-gnu/libQt5Test.so.5\r\n#16 0x00007ffff66dda61 in ?? () from /usr/lib/x86_64-linux-gnu/libQt5Test.so.5\r\n#17 0x00007ffff66de02b in QTest::qExec(QObject*, int, char**) () from /usr/lib/x86_64-linux-gnu/libQt5Test.so.5\r\n#18 0x0000555555afead1 in main (argc=1, argv=0x7fffffffe298) at qt/test/test_main.cpp:85\r\n```\r\n\r\n</p>\r\n</details>",
      "created_at" : "2020-10-26T16:20:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#issuecomment-716660486",
      "id" : 716660486,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20158",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNjY2MDQ4Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-26T16:21:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/716660486",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Following change partially reverting 50f680b402a84b605aa9b9aa58cb571ef32e190e seems to fix the error:\r\n\r\n```diff\r\n--- a/src/qt/test/apptests.cpp\r\n+++ b/src/qt/test/apptests.cpp\r\n@@ -84,6 +84,10 @@ void AppTests::appTests()\r\n     // Reset global state to avoid interfering with later tests.\r\n     LogInstance().DisconnectTestLogger();\r\n     AbortShutdown();\r\n+    {\r\n+        LOCK(cs_main);\r\n+        ::pindexBestHeader = nullptr;\r\n+    }\r\n }\r\n \r\n //! Entry point for BitcoinGUI tests.\r\n```\r\n\r\nError is happening here:\r\n\r\n```\r\n#8  0x0000555556a710e4 in BlockManager::AddToBlockIndex (this=0x611000129860, block=...) at validation.cpp:3183\r\n3183        if (pindexBestHeader == nullptr || pindexBestHeader->nChainWork < pindexNew->nChainWork)\r\n``` ",
      "created_at" : "2020-10-26T17:01:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#issuecomment-716688829",
      "id" : 716688829,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20158",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNjY4ODgyOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-26T17:01:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/716688829",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-10-28T06:59:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20158#issuecomment-717741613",
      "id" : 717741613,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20158",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNzc0MTYxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-28T06:59:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/717741613",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
