[
   {
      "body" : "I think the largest benefit of this will come later, from being able to track in-cache-created entries and removing them in-memory if they are fully spent, preventing them from ever needing to be serialized/written. I'm sure that tuning things like how frequently and when to write what can bring additional benefits.\r\n\r\nI'll look at the code in more detail later. Perhaps we can try to first implement such optimizations as further commits on top of this, to see whether there are actual benefits before merging.",
      "created_at" : "2014-08-18T10:09:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4700#issuecomment-52473478",
      "id" : 52473478,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4700",
      "updated_at" : "2014-08-18T10:09:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/52473478",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Indeed, there are a few other things we could try. But basically the MRU read cache seems to be useless at the moment:\r\n\r\n- During checkblocks: *everything* enters the write cache of the child cache (coins), so there is no use to the read cache in pcoinsTip\r\n- During initial sync: the read cache does have a lot of hits, but it appears that misses don't figure much into the overall timings (probably as leveldb has its own caching). So using the CCoinsCache as we do now, as a 'write buffer/batcher' is OK performance-wise\r\n- During normal node use: the cache gets lots of hits during transaction and block validation, but performance consequences of this are hard to measure. At least with current transaction volumes maybe it's just not so bad to query the underlying database. Especially as leveldb does caching of its own\r\n",
      "created_at" : "2014-08-18T10:33:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4700#issuecomment-52475662",
      "id" : 52475662,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4700",
      "updated_at" : "2014-08-18T10:33:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/52475662",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/p4700_1648f256f7104e7164f8aa81ae81b82bc68918e3/ for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.",
      "created_at" : "2014-08-18T17:35:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4700#issuecomment-52526642",
      "id" : 52526642,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4700",
      "updated_at" : "2014-08-18T17:35:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/52526642",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   }
]
