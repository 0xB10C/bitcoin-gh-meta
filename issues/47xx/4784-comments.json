[
   {
      "body" : "1) This is only a partial fix for #4669 because as noted _everything_ is flushed in the case where the lockfile is present.  This solves one symptom of the larger problem.\r\n2) whitespace after \"if\r\n",
      "created_at" : "2014-08-28T21:35:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4784#issuecomment-53804562",
      "id" : 53804562,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4784",
      "updated_at" : "2014-08-28T21:35:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53804562",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "3) Your solution is generally OK\r\n\r\n4) addrman.size() will never be negative\r\n\r\n5) Hey, that would make a great addrman cleanup, wouldn't it?  :)\r\n",
      "created_at" : "2014-08-28T21:37:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4784#issuecomment-53804781",
      "id" : 53804781,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4784",
      "updated_at" : "2014-08-28T21:37:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53804781",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "@jgarzik \r\n1./3. Yeah, I intended to not fix the larger problem with the lockfile, but the specific one mentioned.\r\n2. Will update, thanks for catching it :).\r\n4. But we return an int for the size so isn't it better to leave it that way?\r\n5. Do you want me to make size an unsigned integer or change the commit-msg ^^, don't understand.",
      "created_at" : "2014-08-28T21:47:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4784#issuecomment-53805873",
      "id" : 53805873,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4784",
      "updated_at" : "2014-08-28T21:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53805873",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "body" : "@Diapolo addrman's size() should return 'unsigned int' (technically size_type, what std::vector<>::size() returns)  And in doing so, that makes testing addrman.size() less-than-zero incorrect, enabling removal of that case (becomes not-zero test).",
      "created_at" : "2014-08-28T22:46:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4784#issuecomment-53815705",
      "id" : 53815705,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4784",
      "updated_at" : "2014-08-28T22:46:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53815705",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "@jgarzik Can you re-check this pull?",
      "created_at" : "2014-08-29T09:51:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4784#issuecomment-53857158",
      "id" : 53857158,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4784",
      "updated_at" : "2014-08-29T09:51:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53857158",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/p4784_4985aaa43a5a4762db3f16037c2da43aad3ff21f/ for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.",
      "created_at" : "2014-08-29T10:05:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4784#issuecomment-53858414",
      "id" : 53858414,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4784",
      "updated_at" : "2014-08-29T10:05:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53858414",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/4784#discussion_r16927646"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4784"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16927646"
         }
      },
      "body" : "Now you use `addrman.size()==0` implicitly to determine whether to write the list at exit. It works, but could lead to strange corner case if we actually need to write an empty list for some reason in the future.\r\n\r\nIt would lead to more understandable code to explicitly keep track of whether we reached the stage of initialization where addrman was initialized.\r\n\r\nA more general solution would be to keep track (in net.cpp) whether StartNode was called. If not, don't do any cleanup in StopNode (which includes the call to DumpAddresses that is the culprit here).\r\n",
      "commit_id" : "4985aaa43a5a4762db3f16037c2da43aad3ff21f",
      "created_at" : "2014-08-30T03:28:04Z",
      "diff_hunk" : "@@ -1263,13 +1263,17 @@ void ThreadDNSAddressSeed()\n \n void DumpAddresses()\n {\n+    // Prevent overwriting peers.dat in case addrman is empty",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4784#discussion_r16927646",
      "id" : 16927646,
      "original_commit_id" : "4985aaa43a5a4762db3f16037c2da43aad3ff21f",
      "original_position" : 4,
      "path" : "src/net.cpp",
      "position" : 4,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4784",
      "updated_at" : "2014-08-30T03:28:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16927646",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Closing in favor of #4942.",
      "created_at" : "2014-09-18T12:23:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4784#issuecomment-56030666",
      "id" : 56030666,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4784",
      "updated_at" : "2014-09-18T12:23:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/56030666",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/4784#discussion_r17723680"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4784"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/17723680"
         }
      },
      "body" : "@laanwj I think DumpAddresses could carry a flag bool fForce for example, to force re-creation of that file instead.",
      "commit_id" : "4985aaa43a5a4762db3f16037c2da43aad3ff21f",
      "created_at" : "2014-09-18T12:33:30Z",
      "diff_hunk" : "@@ -1263,13 +1263,17 @@ void ThreadDNSAddressSeed()\n \n void DumpAddresses()\n {\n+    // Prevent overwriting peers.dat in case addrman is empty",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4784#discussion_r17723680",
      "id" : 17723680,
      "original_commit_id" : "4985aaa43a5a4762db3f16037c2da43aad3ff21f",
      "original_position" : 4,
      "path" : "src/net.cpp",
      "position" : 4,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4784",
      "updated_at" : "2014-09-18T12:33:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/17723680",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   }
]
