[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-11-20T00:53:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20429#issuecomment-730731247",
      "id" : 730731247,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20429",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczMDczMTI0Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-20T00:53:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/730731247",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Although I agree this is slightly better, I'm honestly not sure we should be doing refactors all over the place just for the sake of using C++17. It's always possible to introduce a subtle issue. We did have a \"new code and code that is changed anyway\" policy at the time of C++11 at least.",
      "created_at" : "2020-11-20T02:34:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20429#issuecomment-730806809",
      "id" : 730806809,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20429",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczMDgwNjgwOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-20T02:35:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/730806809",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19438 (Introduce deploymentstatus by ajtowns)\n* #16439 (cli/gui: support \"@height\" in place of blockhash for getblock on client side by ajtowns)\n* #16333 (test: Set BIP34Height = 2 for regtest by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-11-20T05:09:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20429#issuecomment-730854024",
      "id" : 730854024,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20429",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczMDg1NDAyNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-20T07:47:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/730854024",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nWhile I agree that we shouldn't introduce C++17 just for the sake of it I think this one is a clear win since it removes a potentially unsafe idiom with a safer replacement. (To be clear: I think our _current_ usages of this idiom are safe, but I think removing an unsafe idiom from the code base reduces the risk of accidental introduction of bugs due to said unsafe idiom in the future due to copy pasta, imitation, etc.)\r\n\r\n`sizeof(arr) / sizeof(arr[0])` is a potentially unsafe idiom due to this gotcha:\r\n\r\n```c++\r\n$ cat sizeof_gotcha.cpp\r\n#include <iostream>\r\n\r\nint f1(int arr[]) { return sizeof(arr) / sizeof(arr[0]); }\r\n\r\n// Will give a compile time error:\r\n// int f2(int arr[]) { return std::size(arr); }\r\n\r\nint main() {\r\n  int arr[]{1, 2, 3};\r\n  std::cout << \"sizeof(arr) / sizeof(arr[0]) = \" << sizeof(arr) / sizeof(arr[0]) << \"\\n\";\r\n  std::cout << \"sizeof(arr) / sizeof(arr[0]) in f1 = \" << f1(arr) << \"\\n\";\r\n  std::cout << \"std::size(arr) = \" << std::size(arr) << \"\\n\";\r\n  // std::cout << \"std::size(arr) in f2 = \" << f2(arr) << \"\\n\";\r\n}\r\n```\r\n\r\n```\r\n$ ./sizeof_gotcha\r\nsizeof(arr) / sizeof(arr[0]) = 3\r\nsizeof(arr) / sizeof(arr[0]) in f1 = 2\r\nstd::size(arr) = 3\r\n```\r\n\r\nNote the \"unexpected\" result from `sizeof`-based `f1` due to pointer decay.\r\n\r\nNote also how the `std::size`-based `f2` errors out at compile time instead.\r\n\r\nI've verified that this change is complete by comparing the suggested changes against:\r\n\r\n```\r\n$ git grep -E '(sizeof\\(.*/.*sizeof\\(|ARRAYLEN)' \":(exclude)src/leveldb/\" \":(exclude)src/secp256k1/\" \\\r\n      \":(exclude)src/univalue/\" \":(exclude)src/crypto/\"\r\n```\r\n",
      "created_at" : "2020-11-20T08:57:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20429#issuecomment-731036233",
      "id" : 731036233,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20429",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczMTAzNjIzMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-20T08:59:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/731036233",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
