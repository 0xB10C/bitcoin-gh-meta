[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r524486828"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524486828"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is `static_cast` necessary here? `WalletFeature` should already be an int.",
      "commit_id" : "dfec0a8199f393a390b80f00a8aee3fde12d1cef",
      "created_at" : "2020-11-16T18:34:01Z",
      "diff_hunk" : "@@ -4126,7 +4126,9 @@ bool CWallet::UpgradeWallet(int version, bilingual_str& error, std::vector<bilin\n     }\n \n     // Permanently upgrade to the version\n-    SetMinVersion(GetClosestWalletFeature(version));\n+    const WalletFeature new_version{GetClosestWalletFeature(version)};\n+    SetMinVersion(new_version);\n+    version = static_cast<int>(new_version); // return actual updated version",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r524486828",
      "id" : 524486828,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQ4NjgyOA==",
      "original_commit_id" : "cabea155570ceeae807895a7576b474fdab4e572",
      "original_line" : 4131,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 531597413,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-17T18:42:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524486828",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK b95925c751fb97a1a17bf5a540ec06f0634ea72e",
      "created_at" : "2020-11-16T18:34:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#issuecomment-728246886",
      "id" : 728246886,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20403",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyODI0Njg4Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-16T18:34:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/728246886",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20139 (Wallet: do not return warnings from UpgradeWallet() by stackman27)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-11-16T18:36:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#issuecomment-728248066",
      "id" : 728248066,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20403",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyODI0ODA2Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-16T18:36:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/728248066",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r524489680"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524489680"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh you're right, looks like we can just do `version = new_version` here. Will test a push without the cast. Thanks!",
      "commit_id" : "dfec0a8199f393a390b80f00a8aee3fde12d1cef",
      "created_at" : "2020-11-16T18:38:51Z",
      "diff_hunk" : "@@ -4126,7 +4126,9 @@ bool CWallet::UpgradeWallet(int version, bilingual_str& error, std::vector<bilin\n     }\n \n     // Permanently upgrade to the version\n-    SetMinVersion(GetClosestWalletFeature(version));\n+    const WalletFeature new_version{GetClosestWalletFeature(version)};\n+    SetMinVersion(new_version);\n+    version = static_cast<int>(new_version); // return actual updated version",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r524489680",
      "id" : 524489680,
      "in_reply_to_id" : 524486828,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQ4OTY4MA==",
      "original_commit_id" : "cabea155570ceeae807895a7576b474fdab4e572",
      "original_line" : 4131,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 531600963,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-17T18:42:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524489680",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Removed the cast in UpgradeWallet() per `git diff b95925c 377fa31` (thanks!)\r\n```diff\r\n@@ -4128,7 +4128,7 @@ bool CWallet::UpgradeWallet(int& version, bilingual_str& error, std::vector<bili\r\n     // Permanently upgrade to the version\r\n     const WalletFeature new_version{GetClosestWalletFeature(version)};\r\n     SetMinVersion(new_version);\r\n-    version = static_cast<int>(new_version); // return actual updated version\r\n+    version = new_version; // return actual updated version\r\n```",
      "created_at" : "2020-11-16T18:46:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#issuecomment-728253158",
      "id" : 728253158,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20403",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyODI1MzE1OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-16T18:46:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/728253158",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 377fa31",
      "created_at" : "2020-11-16T18:50:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#issuecomment-728255170",
      "id" : 728255170,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20403",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyODI1NTE3MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-16T18:50:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/728255170",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r524992713"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524992713"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It looks like this is dead code, and always has been.\r\n\r\nIt would be easier to have one way to deal with errors. Either return them as `JSONRPCError` or as `{\"error\":...}`, but not both. Also, the error approach should be documented.",
      "commit_id" : "dfec0a8199f393a390b80f00a8aee3fde12d1cef",
      "created_at" : "2020-11-17T09:08:54Z",
      "diff_hunk" : "@@ -4475,12 +4479,26 @@ static RPCHelpMan upgradewallet()\n         version = request.params[0].get_int();\n     }\n \n+    std::string result;\n     bilingual_str error;\n     std::vector<bilingual_str> warnings;\n+    const int previous_version{pwallet->GetVersion()};\n+\n     if (!pwallet->UpgradeWallet(version, error, warnings)) {\n         throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+    } else if (version == previous_version) {\n+        result = \"wallet version unchanged\";\n+    } else {\n+        result = strprintf(\"wallet upgraded successfully from version %i to version %i\", previous_version, version);\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    }\n     if (!error.empty()) {\n         obj.pushKV(\"error\", error.original);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r524992713",
      "id" : 524992713,
      "line" : 4501,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk5MjcxMw==",
      "original_commit_id" : "377fa31c0e5515350ff3e6917fd7e09653c7ebd2",
      "original_line" : 4501,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 48,
      "pull_request_review_id" : 532154490,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-17T18:42:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/524992713",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525006514"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525006514"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, I plan to have a look at this later today. That's the second part of my review feedback from #20282.\n\nIn #20391 I proposed returning an error field rather than raising an RPC error for this type of errors but wasn't sure which is preferred.",
      "commit_id" : "dfec0a8199f393a390b80f00a8aee3fde12d1cef",
      "created_at" : "2020-11-17T09:29:19Z",
      "diff_hunk" : "@@ -4475,12 +4479,26 @@ static RPCHelpMan upgradewallet()\n         version = request.params[0].get_int();\n     }\n \n+    std::string result;\n     bilingual_str error;\n     std::vector<bilingual_str> warnings;\n+    const int previous_version{pwallet->GetVersion()};\n+\n     if (!pwallet->UpgradeWallet(version, error, warnings)) {\n         throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+    } else if (version == previous_version) {\n+        result = \"wallet version unchanged\";\n+    } else {\n+        result = strprintf(\"wallet upgraded successfully from version %i to version %i\", previous_version, version);\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    }\n     if (!error.empty()) {\n         obj.pushKV(\"error\", error.original);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525006514",
      "id" : 525006514,
      "in_reply_to_id" : 524992713,
      "line" : 4501,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTAwNjUxNA==",
      "original_commit_id" : "377fa31c0e5515350ff3e6917fd7e09653c7ebd2",
      "original_line" : 4501,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 48,
      "pull_request_review_id" : 532172105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-17T18:42:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525006514",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525025383"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525025383"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think either is fine as long as it is documented and consistent. An RPCError makes sense when the return object would otherwise be empty and would have to omit a lot of optional fields, except for the error.",
      "commit_id" : "dfec0a8199f393a390b80f00a8aee3fde12d1cef",
      "created_at" : "2020-11-17T09:56:36Z",
      "diff_hunk" : "@@ -4475,12 +4479,26 @@ static RPCHelpMan upgradewallet()\n         version = request.params[0].get_int();\n     }\n \n+    std::string result;\n     bilingual_str error;\n     std::vector<bilingual_str> warnings;\n+    const int previous_version{pwallet->GetVersion()};\n+\n     if (!pwallet->UpgradeWallet(version, error, warnings)) {\n         throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+    } else if (version == previous_version) {\n+        result = \"wallet version unchanged\";\n+    } else {\n+        result = strprintf(\"wallet upgraded successfully from version %i to version %i\", previous_version, version);\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    }\n     if (!error.empty()) {\n         obj.pushKV(\"error\", error.original);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525025383",
      "id" : 525025383,
      "in_reply_to_id" : 524992713,
      "line" : 4501,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTAyNTM4Mw==",
      "original_commit_id" : "377fa31c0e5515350ff3e6917fd7e09653c7ebd2",
      "original_line" : 4501,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 48,
      "pull_request_review_id" : 532195734,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-17T18:42:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525025383",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-11-17T11:56:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#issuecomment-728879097",
      "id" : 728879097,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20403",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyODg3OTA5Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-17T11:56:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/728879097",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525134613"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525134613"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Proposing this:\r\n```\r\n$ ./src/bitcoin-cli -signet -rpcwallet=\"blank\" upgradewallet 5\r\n{\r\n  \"wallet_name\": \"blank\",\r\n  \"previous_version\": 169900,\r\n  \"current_version\": 169900,\r\n  \"error\": \"Cannot downgrade wallet from version 169900 to version 5\"\r\n}\r\n```\r\n",
      "commit_id" : "dfec0a8199f393a390b80f00a8aee3fde12d1cef",
      "created_at" : "2020-11-17T13:00:02Z",
      "diff_hunk" : "@@ -4475,12 +4479,26 @@ static RPCHelpMan upgradewallet()\n         version = request.params[0].get_int();\n     }\n \n+    std::string result;\n     bilingual_str error;\n     std::vector<bilingual_str> warnings;\n+    const int previous_version{pwallet->GetVersion()};\n+\n     if (!pwallet->UpgradeWallet(version, error, warnings)) {\n         throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+    } else if (version == previous_version) {\n+        result = \"wallet version unchanged\";\n+    } else {\n+        result = strprintf(\"wallet upgraded successfully from version %i to version %i\", previous_version, version);\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    }\n     if (!error.empty()) {\n         obj.pushKV(\"error\", error.original);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525134613",
      "id" : 525134613,
      "in_reply_to_id" : 524992713,
      "line" : 4501,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTEzNDYxMw==",
      "original_commit_id" : "377fa31c0e5515350ff3e6917fd7e09653c7ebd2",
      "original_line" : 4501,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 48,
      "pull_request_review_id" : 532335185,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-17T18:42:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525134613",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525136126"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525136126"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(currently that returns):\r\n```\r\n$ ./src/bitcoin-cli -signet -rpcwallet=\"blank\" upgradewallet 5\r\nerror code: -4\r\nerror message:\r\nCannot downgrade wallet\r\n```\r\n",
      "commit_id" : "dfec0a8199f393a390b80f00a8aee3fde12d1cef",
      "created_at" : "2020-11-17T13:02:38Z",
      "diff_hunk" : "@@ -4475,12 +4479,26 @@ static RPCHelpMan upgradewallet()\n         version = request.params[0].get_int();\n     }\n \n+    std::string result;\n     bilingual_str error;\n     std::vector<bilingual_str> warnings;\n+    const int previous_version{pwallet->GetVersion()};\n+\n     if (!pwallet->UpgradeWallet(version, error, warnings)) {\n         throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+    } else if (version == previous_version) {\n+        result = \"wallet version unchanged\";\n+    } else {\n+        result = strprintf(\"wallet upgraded successfully from version %i to version %i\", previous_version, version);\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    }\n     if (!error.empty()) {\n         obj.pushKV(\"error\", error.original);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525136126",
      "id" : 525136126,
      "in_reply_to_id" : 524992713,
      "line" : 4501,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTEzNjEyNg==",
      "original_commit_id" : "377fa31c0e5515350ff3e6917fd7e09653c7ebd2",
      "original_line" : 4501,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 48,
      "pull_request_review_id" : 532337276,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-17T18:42:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525136126",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525316759"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525316759"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "dfec0a8199f393a390b80f00a8aee3fde12d1cef",
      "created_at" : "2020-11-17T16:48:16Z",
      "diff_hunk" : "@@ -4475,12 +4479,26 @@ static RPCHelpMan upgradewallet()\n         version = request.params[0].get_int();\n     }\n \n+    std::string result;\n     bilingual_str error;\n     std::vector<bilingual_str> warnings;\n+    const int previous_version{pwallet->GetVersion()};\n+\n     if (!pwallet->UpgradeWallet(version, error, warnings)) {\n         throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+    } else if (version == previous_version) {\n+        result = \"wallet version unchanged\";\n+    } else {\n+        result = strprintf(\"wallet upgraded successfully from version %i to version %i\", previous_version, version);\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    }\n     if (!error.empty()) {\n         obj.pushKV(\"error\", error.original);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525316759",
      "id" : 525316759,
      "in_reply_to_id" : 524992713,
      "line" : 4501,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxNjc1OQ==",
      "original_commit_id" : "377fa31c0e5515350ff3e6917fd7e09653c7ebd2",
      "original_line" : 4501,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 48,
      "pull_request_review_id" : 532574322,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-17T18:42:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525316759",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased after the merge of #20139 and addressed https://github.com/bitcoin/bitcoin/pull/20403#discussion_r524992713 with 877aba836ec48bfa881ec0dd90299015a3c27cce.",
      "created_at" : "2020-11-17T16:50:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#issuecomment-729057297",
      "id" : 729057297,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20403",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyOTA1NzI5Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-17T16:50:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/729057297",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525319514"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525319514"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Let me know if there is anything needed WRT documenting the error approach.",
      "commit_id" : "dfec0a8199f393a390b80f00a8aee3fde12d1cef",
      "created_at" : "2020-11-17T16:51:59Z",
      "diff_hunk" : "@@ -4475,12 +4479,26 @@ static RPCHelpMan upgradewallet()\n         version = request.params[0].get_int();\n     }\n \n+    std::string result;\n     bilingual_str error;\n     std::vector<bilingual_str> warnings;\n+    const int previous_version{pwallet->GetVersion()};\n+\n     if (!pwallet->UpgradeWallet(version, error, warnings)) {\n         throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+    } else if (version == previous_version) {\n+        result = \"wallet version unchanged\";\n+    } else {\n+        result = strprintf(\"wallet upgraded successfully from version %i to version %i\", previous_version, version);\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    }\n     if (!error.empty()) {\n         obj.pushKV(\"error\", error.original);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525319514",
      "id" : 525319514,
      "in_reply_to_id" : 524992713,
      "line" : 4501,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxOTUxNA==",
      "original_commit_id" : "377fa31c0e5515350ff3e6917fd7e09653c7ebd2",
      "original_line" : 4501,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 48,
      "pull_request_review_id" : 532577949,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-17T18:42:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525319514",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525328086"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525328086"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    else { CHECK_NONFATAL(!error.empty());\r\n```",
      "commit_id" : "dfec0a8199f393a390b80f00a8aee3fde12d1cef",
      "created_at" : "2020-11-17T17:02:29Z",
      "diff_hunk" : "@@ -4474,11 +4478,25 @@ static RPCHelpMan upgradewallet()\n     if (!request.params[0].isNull()) {\n         version = request.params[0].get_int();\n     }\n+    const int previous_version{pwallet->GetVersion()};\n+    std::string result;\n     bilingual_str error;\n-    if (!pwallet->UpgradeWallet(version, error)) {\n-        throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+\n+    if (pwallet->UpgradeWallet(version, error)) {\n+        if (version == previous_version) {\n+            result = \"Already at latest version. Wallet version unchanged.\";\n+        } else {\n+            result = strprintf(\"Wallet upgraded successfully from version %i to version %i.\", previous_version, version);\n+        }\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    }\n     if (!error.empty()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525328086",
      "id" : 525328086,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMyODA4Ng==",
      "original_commit_id" : "877aba836ec48bfa881ec0dd90299015a3c27cce",
      "original_line" : 4500,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 532589316,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-17T18:42:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525328086",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525329735"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525329735"
         }
      },
      "author_association" : "MEMBER",
      "body" : "the translation shouldn't be changed here, if you want this to be backported",
      "commit_id" : "dfec0a8199f393a390b80f00a8aee3fde12d1cef",
      "created_at" : "2020-11-17T17:04:29Z",
      "diff_hunk" : "@@ -4113,20 +4113,25 @@ bool CWallet::UpgradeWallet(int version, bilingual_str& error)\n     }\n     if (version < prev_version)\n     {\n-        error = _(\"Cannot downgrade wallet\");\n+        error = strprintf(_(\"Cannot downgrade wallet from version %i to version %i. Wallet version unchanged.\"), prev_version, version);\n+        version = prev_version;\n         return false;\n     }\n \n     LOCK(cs_wallet);\n \n     // Do not upgrade versions to any version between HD_SPLIT and FEATURE_PRE_SPLIT_KEYPOOL unless already supporting HD_SPLIT\n     if (!CanSupportFeature(FEATURE_HD_SPLIT) && version >= FEATURE_HD_SPLIT && version < FEATURE_PRE_SPLIT_KEYPOOL) {\n-        error = _(\"Cannot upgrade a non HD split wallet without upgrading to support pre split keypool. Please use version 169900 or no version specified.\");\n+        error = strprintf(_(\"Cannot upgrade a non HD split wallet from version %i to version %i without upgrading to support pre-split keypool. Please use version %i or no version specified.\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525329735",
      "id" : 525329735,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMyOTczNQ==",
      "original_commit_id" : "877aba836ec48bfa881ec0dd90299015a3c27cce",
      "original_line" : 4125,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 532589316,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-17T18:42:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525329735",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525341964"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525341964"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh right (thanks!) and same for the translation just above as well, I suppose\r\n```diff\r\n-        error = _(\"Cannot downgrade wallet\");\r\n+        error = strprintf(_(\"Cannot downgrade wallet from version %i to version %i. Wallet version unchanged.\"), prev_version, version);\r\n```\r\n",
      "commit_id" : "dfec0a8199f393a390b80f00a8aee3fde12d1cef",
      "created_at" : "2020-11-17T17:18:24Z",
      "diff_hunk" : "@@ -4113,20 +4113,25 @@ bool CWallet::UpgradeWallet(int version, bilingual_str& error)\n     }\n     if (version < prev_version)\n     {\n-        error = _(\"Cannot downgrade wallet\");\n+        error = strprintf(_(\"Cannot downgrade wallet from version %i to version %i. Wallet version unchanged.\"), prev_version, version);\n+        version = prev_version;\n         return false;\n     }\n \n     LOCK(cs_wallet);\n \n     // Do not upgrade versions to any version between HD_SPLIT and FEATURE_PRE_SPLIT_KEYPOOL unless already supporting HD_SPLIT\n     if (!CanSupportFeature(FEATURE_HD_SPLIT) && version >= FEATURE_HD_SPLIT && version < FEATURE_PRE_SPLIT_KEYPOOL) {\n-        error = _(\"Cannot upgrade a non HD split wallet without upgrading to support pre split keypool. Please use version 169900 or no version specified.\");\n+        error = strprintf(_(\"Cannot upgrade a non HD split wallet from version %i to version %i without upgrading to support pre-split keypool. Please use version %i or no version specified.\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525341964",
      "id" : 525341964,
      "in_reply_to_id" : 525329735,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0MTk2NA==",
      "original_commit_id" : "877aba836ec48bfa881ec0dd90299015a3c27cce",
      "original_line" : 4125,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 532607160,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-17T18:42:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525341964",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525369168"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525369168"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If you like the translation changes, you can put them into a separate commit and write \"not for backport\" in the commit body",
      "commit_id" : "dfec0a8199f393a390b80f00a8aee3fde12d1cef",
      "created_at" : "2020-11-17T17:55:28Z",
      "diff_hunk" : "@@ -4113,20 +4113,25 @@ bool CWallet::UpgradeWallet(int version, bilingual_str& error)\n     }\n     if (version < prev_version)\n     {\n-        error = _(\"Cannot downgrade wallet\");\n+        error = strprintf(_(\"Cannot downgrade wallet from version %i to version %i. Wallet version unchanged.\"), prev_version, version);\n+        version = prev_version;\n         return false;\n     }\n \n     LOCK(cs_wallet);\n \n     // Do not upgrade versions to any version between HD_SPLIT and FEATURE_PRE_SPLIT_KEYPOOL unless already supporting HD_SPLIT\n     if (!CanSupportFeature(FEATURE_HD_SPLIT) && version >= FEATURE_HD_SPLIT && version < FEATURE_PRE_SPLIT_KEYPOOL) {\n-        error = _(\"Cannot upgrade a non HD split wallet without upgrading to support pre split keypool. Please use version 169900 or no version specified.\");\n+        error = strprintf(_(\"Cannot upgrade a non HD split wallet from version %i to version %i without upgrading to support pre-split keypool. Please use version %i or no version specified.\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525369168",
      "id" : 525369168,
      "in_reply_to_id" : 525329735,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM2OTE2OA==",
      "original_commit_id" : "877aba836ec48bfa881ec0dd90299015a3c27cce",
      "original_line" : 4125,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 532642044,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-17T18:42:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525369168",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525400534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525400534"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks--done.",
      "commit_id" : "dfec0a8199f393a390b80f00a8aee3fde12d1cef",
      "created_at" : "2020-11-17T18:43:45Z",
      "diff_hunk" : "@@ -4474,11 +4478,25 @@ static RPCHelpMan upgradewallet()\n     if (!request.params[0].isNull()) {\n         version = request.params[0].get_int();\n     }\n+    const int previous_version{pwallet->GetVersion()};\n+    std::string result;\n     bilingual_str error;\n-    if (!pwallet->UpgradeWallet(version, error)) {\n-        throw JSONRPCError(RPC_WALLET_ERROR, error.original);\n+\n+    if (pwallet->UpgradeWallet(version, error)) {\n+        if (version == previous_version) {\n+            result = \"Already at latest version. Wallet version unchanged.\";\n+        } else {\n+            result = strprintf(\"Wallet upgraded successfully from version %i to version %i.\", previous_version, version);\n+        }\n     }\n+\n     UniValue obj(UniValue::VOBJ);\n+    obj.pushKV(\"wallet_name\", pwallet->GetName());\n+    obj.pushKV(\"previous_version\", previous_version);\n+    obj.pushKV(\"current_version\", version);\n+    if (!result.empty()) {\n+        obj.pushKV(\"result\", result);\n+    }\n     if (!error.empty()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525400534",
      "id" : 525400534,
      "in_reply_to_id" : 525328086,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQwMDUzNA==",
      "original_commit_id" : "877aba836ec48bfa881ec0dd90299015a3c27cce",
      "original_line" : 4500,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 532681081,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-17T18:43:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525400534",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525424342"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525424342"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done, thanks",
      "commit_id" : "dfec0a8199f393a390b80f00a8aee3fde12d1cef",
      "created_at" : "2020-11-17T19:19:24Z",
      "diff_hunk" : "@@ -4113,20 +4113,25 @@ bool CWallet::UpgradeWallet(int version, bilingual_str& error)\n     }\n     if (version < prev_version)\n     {\n-        error = _(\"Cannot downgrade wallet\");\n+        error = strprintf(_(\"Cannot downgrade wallet from version %i to version %i. Wallet version unchanged.\"), prev_version, version);\n+        version = prev_version;\n         return false;\n     }\n \n     LOCK(cs_wallet);\n \n     // Do not upgrade versions to any version between HD_SPLIT and FEATURE_PRE_SPLIT_KEYPOOL unless already supporting HD_SPLIT\n     if (!CanSupportFeature(FEATURE_HD_SPLIT) && version >= FEATURE_HD_SPLIT && version < FEATURE_PRE_SPLIT_KEYPOOL) {\n-        error = _(\"Cannot upgrade a non HD split wallet without upgrading to support pre split keypool. Please use version 169900 or no version specified.\");\n+        error = strprintf(_(\"Cannot upgrade a non HD split wallet from version %i to version %i without upgrading to support pre-split keypool. Please use version %i or no version specified.\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20403#discussion_r525424342",
      "id" : 525424342,
      "in_reply_to_id" : 525329735,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQyNDM0Mg==",
      "original_commit_id" : "877aba836ec48bfa881ec0dd90299015a3c27cce",
      "original_line" : 4125,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 532712485,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20403",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-17T19:19:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525424342",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
