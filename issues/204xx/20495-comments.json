[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19806 (validation: UTXO snapshot activation by jamesob)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-11-26T03:23:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20495#issuecomment-734050822",
      "id" : 734050822,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20495",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczNDA1MDgyMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-26T03:23:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/734050822",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 50dee5a61d02eecaf78e5ac5e0305477478e5ed3\r\n\r\nThanks for the excellent explanation!\r\n\r\nIt's not important, but `decltype(auto)` has been available since c++14. You could mention that in the commit log if you felt like it.\r\n\r\nAnother really good reference on `decltype(auto)` is item 3 in Effective Modern C++ (Scott Meyers). That chapter explains one sharp edge that I wanted to test, namely that `decltype(auto(i))` and `decltype(auto((i)))` are not always the same:\r\n\r\n```c++\r\n#include <iostream>\r\n#include <mutex>\r\n\r\n#define LOCK(cs) (void(cs))\r\n#define WITH_LOCK(cs, code) [&]() -> decltype(auto) { LOCK(cs); code; }()\r\n\r\nint main()\r\n{\r\n    std::mutex l;\r\n\r\n    int i = WITH_LOCK(l, {int i = 1; return i;}); // this is fine, auto(decltype(i)) is an int, so this returns by value\r\n    std::cout << \"i = \" << i << std::endl;\r\n\r\n    int j = WITH_LOCK(l, {int j = 1; return (j);}); // this isn't, auto(decltype((i)) is an &int, so this returns by reference to a local variable\r\n    std::cout << \"j = \" << j << std::endl; // segfault!! j is a dangling reference\r\n\r\n    return 0;\r\n}\r\n```\r\n\r\nThis kind of bug is non-obvious from looking at the code, but it's detected by -Wreturn-local-addr, which I believe we have enabled by default:\r\n\r\n```\r\ng++ decltype_auto.cpp \r\ndecltype_auto.cpp: In lambda function:\r\ndecltype_auto.cpp:14:46: warning: reference to local variable âjâ returned [-Wreturn-local-addr]\r\n   14 |     int j = WITH_LOCK(l, {int j = 1; return (j);}); // this isn't, auto(decltype((i)) is an &int, so this returns by reference to a local variable\r\n      |                                              ^\r\n```",
      "created_at" : "2020-11-26T11:11:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20495#issuecomment-734236027",
      "id" : 734236027,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20495",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczNDIzNjAyNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-26T11:11:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/734236027",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Is this actually clearer or less fragile (or better in some other way?) than having the explicit `&` and `*`?",
      "created_at" : "2020-12-01T23:38:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20495#issuecomment-736890178",
      "id" : 736890178,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20495",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczNjg5MDE3OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-01T23:38:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/736890178",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think the only benefit is when new code is written, it will less likely result in a compile error. So devs need to do the add-`*`-or`&`-at-random-places-until-it-compiles workaround less often.",
      "created_at" : "2020-12-02T08:08:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20495#issuecomment-737065276",
      "id" : 737065276,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20495",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczNzA2NTI3Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-02T08:08:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/737065276",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
