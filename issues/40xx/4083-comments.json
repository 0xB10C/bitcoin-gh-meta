[
   {
      "body" : "Since #4058 ?",
      "created_at" : "2014-04-22T18:44:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4083#issuecomment-41078293",
      "id" : 41078293,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4083",
      "updated_at" : "2014-04-22T18:44:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/41078293",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Probably, I'm about to test reverting those commits.",
      "created_at" : "2014-04-22T18:50:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4083#issuecomment-41078905",
      "id" : 41078905,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4083",
      "updated_at" : "2014-04-22T18:50:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/41078905",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1192483?v=3",
         "events_url" : "https://api.github.com/users/rdponticelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rdponticelli/followers",
         "following_url" : "https://api.github.com/users/rdponticelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rdponticelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rdponticelli",
         "id" : 1192483,
         "login" : "rdponticelli",
         "organizations_url" : "https://api.github.com/users/rdponticelli/orgs",
         "received_events_url" : "https://api.github.com/users/rdponticelli/received_events",
         "repos_url" : "https://api.github.com/users/rdponticelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rdponticelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rdponticelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rdponticelli"
      }
   },
   {
      "body" : "This is what's happening, grepping out the net locks:\r\n\r\n2014-04-22 21:42:19 Locking: cs_main  main.cpp:3806\r\n2014-04-22 21:42:19 Locking: cs_nTimeOffset  util.cpp:1250\r\n2014-04-22 21:42:19 Locking: cs_main  transactiontablemodel.cpp:193\r\n2014-04-22 21:42:19 Unlocked: cs_nTimeOffset  util.cpp:1250\r\n2014-04-22 21:42:19 Locking: cs_LastBlockFile  main.cpp:2199\r\n2014-04-22 21:42:19 Locking: csPathCached  util.cpp:995\r\n2014-04-22 21:42:19 Unlocked: csPathCached  util.cpp:995\r\n2014-04-22 21:42:19 *** Error: Disk space is low!\r\n\r\nAlso, it only happens with bitcoin-qt, not with the daemon, and it doesn't happen with 55a1db4fa2cf62b9766ef382c1e14b3ecbdf67fe reverted (but it do have other issues).",
      "created_at" : "2014-04-22T22:06:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4083#issuecomment-41101934",
      "id" : 41101934,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4083",
      "updated_at" : "2014-04-22T22:06:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/41101934",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1192483?v=3",
         "events_url" : "https://api.github.com/users/rdponticelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rdponticelli/followers",
         "following_url" : "https://api.github.com/users/rdponticelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rdponticelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rdponticelli",
         "id" : 1192483,
         "login" : "rdponticelli",
         "organizations_url" : "https://api.github.com/users/rdponticelli/orgs",
         "received_events_url" : "https://api.github.com/users/rdponticelli/received_events",
         "repos_url" : "https://api.github.com/users/rdponticelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rdponticelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rdponticelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rdponticelli"
      }
   },
   {
      "body" : "Does it report anything about a deadlock if you compile with DEBUG_LOCKORDER?\r\n(which locks, acquired where, are causing this deadlock?)\r\n",
      "created_at" : "2014-04-23T06:06:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4083#issuecomment-41127722",
      "id" : 41127722,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4083",
      "updated_at" : "2014-04-23T06:07:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/41127722",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I managed to reproduce this. This is a very sneaky deadlock, not a conventional one.\r\n\r\nThe problem is that the P2P thread does a *synchronous* call to the GUI thread to show a notification, with locks held. It is synchronous because the shutdown needs to wait for the user to click 'Ok' on the dialog box (so they can read the error message...).\r\n\r\nOne solution would be for the GUI thread to use TRY_LOCKs for periodically updating various stats from the core. This would avoid it getting stuck when the lock is already held.\r\n\r\nEdit: Hmm I tried this but it doesn't always work either. An update can come from Qt itself, and the various model update functions also need locks. These are harder to skip than periodical polls and would need to show cached data.\r\n\r\n",
      "created_at" : "2014-04-23T06:23:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4083#issuecomment-41128544",
      "id" : 41128544,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4083",
      "updated_at" : "2014-04-23T07:01:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/41128544",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "See #4085",
      "created_at" : "2014-04-23T07:11:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4083#issuecomment-41131144",
      "id" : 41131144,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4083",
      "updated_at" : "2014-04-23T07:11:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/41131144",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
