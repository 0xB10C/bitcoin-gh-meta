[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#15632](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15632.html) (Remove ResendWalletTransactions from the Validation Interface by jnewbery)\n* [#15508](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15508.html) (Refactor analyzepsbt for use outside RPC code by gwillen)\n* [#15294](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15294.html) ([moveonly] wallet: Extract RipeMd160 by Empact)\n* [#15141](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15141.html) (Rewrite DoS interface between validation and net_processing by sdaftuar)\n* [#14837](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14837.html) (Stricter & More Performant Invariant Checking in CheckBlock by JeremyRubin)\n* [#14696](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14696.html) (qa: Add explicit references to related CVE's in p2p_invalid_block test. by lucash-dev)\n* [#13949](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/13949.html) (Introduce MempoolObserver interface to break \"policy/fees -> txmempool -> policy/fees\" circular dependency by Empact)\n* [#13751](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/13751.html) (Utils and libraries: Drops the boost/algorithm/string/split.hpp dependency by 251Labs)\n* [#13357](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/13357.html) (Define SIGHASH_MASK in validation and determine the use of SIGHASH_SINGLE in signing by jl2012)\n* [#12911](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/12911.html) (wallet: Show fee in results for signrawtransaction* for segwit inputs by kallewoof)\n* [#11413](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/11413.html) ([wallet] [rpc] sendtoaddress/sendmany: Add explicit feerate option by kallewoof)\n* [#10823](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/10823.html) (Allow all mempool txs to be replaced after a configurable timeout (default 6h) by greenaddress)\n* [#10443](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/10443.html) (Add fee_est tool for debugging fee estimation code by ryanofsky)\n* [#10102](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/10102.html) ([experimental] Multiprocess bitcoin by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-03-22T07:25:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15638#issuecomment-475519439",
      "id" : 475519439,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15638",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NTUxOTQzOQ==",
      "updated_at" : "2019-03-23T01:09:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475519439",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I split this out for review here: https://github.com/Empact/bitcoin/commits/pr/link-split (you can diff https://github.com/Empact/bitcoin/commit/9d9ad3800da09575a7a058160d1ed0604df9ccc9 for consistency) and came away with 2 proposed changes:\r\n\r\nhttps://github.com/Empact/bitcoin/commit/3d5f9e943ae5e0da0edc55a7ba6e7d32689563f8 - `TransactionErrorString` is not used outside `rpc/util.cpp`, which includes `node/transaction.h` via `rpc/util.h`. Seems appropriate to leave it there.\r\n\r\nhttps://github.com/Empact/bitcoin/commit/173d3c499f5639455293ea53b09677805f6128fe - this moves `StringFeeForReason` back as it's only used in `wallet/wallet.cpp` which includes `policy/fees.h` directly. It also makes `util/fees` independent of `policy/fees`, which seems appropriate re. layering.",
      "created_at" : "2019-03-22T09:08:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15638#issuecomment-475544424",
      "id" : 475544424,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15638",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NTU0NDQyNA==",
      "updated_at" : "2019-03-22T09:09:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475544424",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@Empact, I can use your branch with split up commits if other people think that is easier to review. But I'm not sure that they will. Personally I would rather scan a single commit with `--color-moved=dimmed_zebra`, verify that it is move-only, and be able to see the whole picture than to have to verify fragmentary commits.\r\n\r\nThe two changes you propose are not good, though. They have some problems conceptually, and I think will break the followup PR #15639, although I didn't test.\r\n\r\n_The point of this PR is to designate a directory ([`src/node/`](https://github.com/ryanofsky/bitcoin/tree/pr/link.5/src/node/)) and a library ([`libbitcoin_server.a`](https://github.com/ryanofsky/bitcoin/blob/pr/link.5/src/Makefile.am#L247-L250)) which contain node-specific code, which wallet code cannot call, and qt code cannot call._ This is enforced by the linker after #15639, and should be clearly explained in the [readme](https://github.com/ryanofsky/bitcoin/blob/pr/link.5/src/node/README.md) and [makefile](https://github.com/ryanofsky/bitcoin/blob/pr/link.5/src/Makefile.am#L247-L250).\r\n\r\n Both wallet code and qt code should be able to translate error codes into strings. So [`TransactionErrorString`](https://github.com/ryanofsky/bitcoin/blob/pr/link.5/src/util/error.h#L22) belongs in a place like [`util/error.h`](https://github.com/ryanofsky/bitcoin/blob/pr/link.5/src/util/error.h#L22) and not underneath [`src/node/`](https://github.com/ryanofsky/bitcoin/tree/pr/link.5/src/node/). (Beyond #15639, I would like [`util/error.h`](https://github.com/ryanofsky/bitcoin/blob/pr/link.5/src/util/error.h) to be a common place for defining simple error types and messages that don't pull in outside dependencies, so error values only need to be defined once, and we don't need to write unnecessary code to catch exceptions or translate errors to different types when they are passed between wallet/node/rpc/gui code boundaries.)\r\n\r\nSimilarly, both wallet code and qt code should be able to call [`StringForFeeReason`](https://github.com/ryanofsky/bitcoin/blob/pr/link.5/src/util/fees.cpp#L24-L42), which means it shouldn't be defined in [`src/policy/fees.cpp`](https://github.com/bitcoin/bitcoin/blob/abd914ed34f12a5e7773e87e0457b04bcb7d58c4/src/policy/fees.cpp#L30-L48), because that file uses mempool types and would require wallet and qt code to be linked with mempool code, which is what this PR is trying to avoid and would be an error after #15639.\r\n",
      "created_at" : "2019-03-22T11:51:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15638#issuecomment-475592061",
      "id" : 475592061,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15638",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NTU5MjA2MQ==",
      "updated_at" : "2019-03-22T11:53:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475592061",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Very strong concept ACK to this and #15639. This is the natural follow-up to #10973. That PR defined a node<->wallet interface and made it so wallet code _shouldn't_ directly access node functions. This PR with #15639 ensures that wallet code _can't_ directly access node functions.\r\n\r\nMy only question is when these should be merged. This conflicts with a lot of PRs (including high-priority #15141) so perhaps it should wait. On the other hand, rebases will be trivial since this is just a code move.",
      "created_at" : "2019-03-22T14:14:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15638#issuecomment-475636982",
      "id" : 475636982,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15638",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NTYzNjk4Mg==",
      "updated_at" : "2019-03-22T14:14:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475636982",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
