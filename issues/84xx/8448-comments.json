[
   {
      "body" : "We'll need to add `mempool.dat` to doc/files.md",
      "created_at" : "2016-08-03T04:53:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237138396",
      "id" : 237138396,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T04:53:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237138396",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=3",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "body" : "Why not behind a command line flag?",
      "created_at" : "2016-08-03T06:43:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237155942",
      "id" : 237155942,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T06:43:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237155942",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "Concept ACK. \r\n\r\n> Why not behind a command line flag?\r\n\r\nAgreed. It can be enabled by default.\r\nBut people may want to disable this functionality, the per-10 minute dump could interfere with benchmarks and such for example.\r\n",
      "created_at" : "2016-08-03T06:55:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237157818",
      "id" : 237157818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T06:55:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237157818",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289150"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289150"
         }
      },
      "body" : "`.string().c_str()`",
      "commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "created_at" : "2016-08-03T06:58:29Z",
      "diff_hunk" : "@@ -6794,6 +6793,107 @@ ThresholdState VersionBitsTipState(const Consensus::Params& params, Consensus::D\n     return VersionBitsState(chainActive.Tip(), params, pos, versionbitscache);\n }\n \n+bool LoadMempool(void)\n+{\n+    FILE* filestr = fopen((GetDataDir() / \"mempool.dat\").c_str(), \"r\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289150",
      "id" : 73289150,
      "original_commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "original_position" : 81,
      "path" : "src/main.cpp",
      "position" : 81,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448",
      "updated_at" : "2016-08-03T06:58:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289150",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289274"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289274"
         }
      },
      "body" : "I don't think missing this file should be an error. I remember users being confused by errors about other files missing (peers.dat), which are simply generated by the application anyhow.",
      "commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "created_at" : "2016-08-03T06:59:40Z",
      "diff_hunk" : "@@ -6794,6 +6793,107 @@ ThresholdState VersionBitsTipState(const Consensus::Params& params, Consensus::D\n     return VersionBitsState(chainActive.Tip(), params, pos, versionbitscache);\n }\n \n+bool LoadMempool(void)\n+{\n+    FILE* filestr = fopen((GetDataDir() / \"mempool.dat\").c_str(), \"r\");\n+    CAutoFile file(filestr, SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull()) {\n+        return error(\"Failed to open mempool file from disk\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289274",
      "id" : 73289274,
      "original_commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "original_position" : 84,
      "path" : "src/main.cpp",
      "position" : 84,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448",
      "updated_at" : "2016-08-03T06:59:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289274",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289367"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289367"
         }
      },
      "body" : "Please use a constant `MEMPOOL_DUMP_VERSION` or so",
      "commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "created_at" : "2016-08-03T07:00:59Z",
      "diff_hunk" : "@@ -6794,6 +6793,107 @@ ThresholdState VersionBitsTipState(const Consensus::Params& params, Consensus::D\n     return VersionBitsState(chainActive.Tip(), params, pos, versionbitscache);\n }\n \n+bool LoadMempool(void)\n+{\n+    FILE* filestr = fopen((GetDataDir() / \"mempool.dat\").c_str(), \"r\");\n+    CAutoFile file(filestr, SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull()) {\n+        return error(\"Failed to open mempool file from disk\");\n+    }\n+\n+    int64_t count = 0;\n+\n+    try {\n+        uint64_t version;\n+        file >> version;\n+        if (version != 1) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289367",
      "id" : 73289367,
      "original_commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "original_position" : 92,
      "path" : "src/main.cpp",
      "position" : 92,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448",
      "updated_at" : "2016-08-03T07:00:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289367",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289502"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289502"
         }
      },
      "body" : "Good point.",
      "commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "created_at" : "2016-08-03T07:02:42Z",
      "diff_hunk" : "@@ -6794,6 +6793,107 @@ ThresholdState VersionBitsTipState(const Consensus::Params& params, Consensus::D\n     return VersionBitsState(chainActive.Tip(), params, pos, versionbitscache);\n }\n \n+bool LoadMempool(void)\n+{\n+    FILE* filestr = fopen((GetDataDir() / \"mempool.dat\").c_str(), \"r\");\n+    CAutoFile file(filestr, SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull()) {\n+        return error(\"Failed to open mempool file from disk\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289502",
      "id" : 73289502,
      "original_commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "original_position" : 84,
      "path" : "src/main.cpp",
      "position" : 84,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448",
      "updated_at" : "2016-08-03T07:02:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289502",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289509"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289509"
         }
      },
      "body" : "Seems to work fine?",
      "commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "created_at" : "2016-08-03T07:02:48Z",
      "diff_hunk" : "@@ -6794,6 +6793,107 @@ ThresholdState VersionBitsTipState(const Consensus::Params& params, Consensus::D\n     return VersionBitsState(chainActive.Tip(), params, pos, versionbitscache);\n }\n \n+bool LoadMempool(void)\n+{\n+    FILE* filestr = fopen((GetDataDir() / \"mempool.dat\").c_str(), \"r\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289509",
      "id" : 73289509,
      "original_commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "original_position" : 81,
      "path" : "src/main.cpp",
      "position" : 81,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448",
      "updated_at" : "2016-08-03T07:02:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289509",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289794"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289794"
         }
      },
      "body" : "Nono, travis failed because of this (https://travis-ci.org/bitcoin/bitcoin/jobs/149377465#L2149).",
      "commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "created_at" : "2016-08-03T07:06:24Z",
      "diff_hunk" : "@@ -6794,6 +6793,107 @@ ThresholdState VersionBitsTipState(const Consensus::Params& params, Consensus::D\n     return VersionBitsState(chainActive.Tip(), params, pos, versionbitscache);\n }\n \n+bool LoadMempool(void)\n+{\n+    FILE* filestr = fopen((GetDataDir() / \"mempool.dat\").c_str(), \"r\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73289794",
      "id" : 73289794,
      "original_commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "original_position" : 81,
      "path" : "src/main.cpp",
      "position" : 81,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448",
      "updated_at" : "2016-08-03T07:13:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73289794",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "Concept ACK\r\n\r\n```\r\n000000e0  7a 8e 6e 84 83 ab c4 ca  20 fb 9b 88 ac 00 00 00  |z.n..... .......|\r\n000000f0  00 00 00 00 00 0f 6a 0d  48 61 6c 6c 6f 55 62 69  |......j.HalloUbi|\r\n00000100  72 63 68 74 21 00 00 00  00 0d 9a a1 57 00 00 00  |rcht!.......W...|\r\n```\r\n\r\nAs we dump raw txes from the mempool, this will conflict with current status of \"antivirus-compliant\" storage and dumping `mempool.dat` can stop the `bitcoind` from running, ie. new DoS vector.\r\n",
      "created_at" : "2016-08-03T07:30:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237163938",
      "id" : 237163938,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T07:30:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237163938",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "2016-08-03 07:29:00 Dumped mempool: 1.9e-05s to copy, 0.005925s to dump\r\n",
      "created_at" : "2016-08-03T07:30:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237164001",
      "id" : 237164001,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T07:30:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237164001",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73295279"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73295279"
         }
      },
      "body" : "~~IIRC the `fopen` parameters are `restrict` (or often are in the impl),  and assumed to be there for the lifetime of the file pointer... I don't think this temporary holds those variants and might cause UB?~~\r\n\r\n~~I could be wrong.~~\r\n**edit**: that may only be in the C standard, not C++\r\n\r\nI suspect it is completely irrelevant,  seeing how prevalent this pattern is throughout the code.",
      "commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "created_at" : "2016-08-03T07:57:53Z",
      "diff_hunk" : "@@ -6794,6 +6793,107 @@ ThresholdState VersionBitsTipState(const Consensus::Params& params, Consensus::D\n     return VersionBitsState(chainActive.Tip(), params, pos, versionbitscache);\n }\n \n+bool LoadMempool(void)\n+{\n+    FILE* filestr = fopen((GetDataDir() / \"mempool.dat\").c_str(), \"r\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#discussion_r73295279",
      "id" : 73295279,
      "original_commit_id" : "8e0313fb33a00c5bd3aaac129a285327feec06f8",
      "original_position" : 81,
      "path" : "src/main.cpp",
      "position" : 81,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8448",
      "updated_at" : "2016-08-03T08:07:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73295279",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "> As we dump raw txes from the mempool, this will conflict with current status of \"antivirus-compliant\" storage and dumping mempool.dat can stop the bitcoind from running, ie. new DoS vector.\r\n\r\nA fair point. Though a missing, or corrupted mempool.dat should never cause bitcoind to stop running. At most this will lose the mempool contents (at next start) due to the file being quarantined.\r\n",
      "created_at" : "2016-08-03T08:35:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237177243",
      "id" : 237177243,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T08:35:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237177243",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "More XOR?",
      "created_at" : "2016-08-03T08:44:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237179183",
      "id" : 237179183,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T08:44:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237179183",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "Indeed this probably should be XOR'd with a random key.",
      "created_at" : "2016-08-03T08:57:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237181848",
      "id" : 237181848,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T08:57:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237181848",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=3",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "body" : "> At most this will lose the mempool contents (at next start) due to the file being quarantined.\r\n\r\nYes, but this is something different. AV can stop `bitcoind` with a dialog: Ã¢ÂÂThis app is writing a virus to your disk. OK | ErrorÃ¢ÂÂ.",
      "created_at" : "2016-08-03T09:31:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237189718",
      "id" : 237189718,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T09:31:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237189718",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "> At most this will lose the mempool contents due to the file being quarantined.\n\nAV can be configured to stop `bitcoind` with a dialog: Ã¢ÂÂThis app is writing a virus to your disk. OK | ErrorÃ¢ÂÂ. This is outside of `bitcoind`Ã¢ÂÂ¦",
      "created_at" : "2016-08-03T10:05:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237197059",
      "id" : 237197059,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T10:05:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237197059",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "Concept ACK and the code size is surprisingly small!\r\n\r\nThe only thing that I miss (not directly related to this PR) is an opportunity to keep a history of some major mempool data (feerate, size, tx rate, etc.). Another option would be keeping ~24*6 dumps per day that would could be stored in file-diff-deltas to allow generating any types of statistics.",
      "created_at" : "2016-08-03T14:16:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237249305",
      "id" : 237249305,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T14:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237249305",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "I don't really see a huge benefit in doing this.  It seems like unless you are immediately restarting, you'll be wasting a lot of time trying to load already confirmed transactions or low fee spam.  That said I don't object to making it a command line argument, but I would suggest it default to off.\r\n\r\nWhat's the rationale for running it every 10 minutes?  You can copy it from one running node to start another or to handle crashes?",
      "created_at" : "2016-08-03T16:23:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237288245",
      "id" : 237288245,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T16:23:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237288245",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "I think it should be off by default. And when it is, we can even skip XORing it, I think as it is expert level feature anyway.\r\n\r\nOr the other way: create a RPC to dump mempool and that's all. But this way we loose the save-on-restart feature which is nice (which can be worked around by `dumpmempool` and restart).",
      "created_at" : "2016-08-03T16:45:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237294249",
      "id" : 237294249,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T16:45:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237294249",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "@morcos The reason for dumping every 10 minutes is so that prioritization data is not lost in case of a crash.\r\n\r\nBut perhaps we should have separate files for that. prioritization.dat which is continuously dumped (maybe only after mapDeltas changed?), and mempool.dat which is only saved at shutdown?",
      "created_at" : "2016-08-03T17:36:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237309685",
      "id" : 237309685,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T17:36:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237309685",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "> wasting a lot of time trying to load already confirmed transactions or low fee spam\r\n\r\nCould it help to save the current block height to the mempool.dat and then discard mempool.dat on start when current height > 3 + height when mempool was saved?",
      "created_at" : "2016-08-03T17:44:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237312227",
      "id" : 237312227,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T17:54:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237312227",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "This has split into two threads, really:\r\n1) mempool restore across restarts\r\n2) persisting prio deltas across restarts & crashes\r\n2.1) side note - other state such as wallet locked coins (lockunspent) should be persisted also\r\n\r\nPersisting bits of state like prio deltas is useful, and seems applicable to a continuous-log or database solution, that can be restored at startup.\r\n\r\nAs for mempool restore...\r\n\r\nStandard rhetorical questions:  Who will really use mempool restore, and how often?\r\n\r\n* Historically, users really do not like features that pause shutdown for a long time.  We spent time optimizing bitcoind shutdown in the past.\r\n* Dump on shutdown does not provide crash protection (as @sipa noted)\r\n* Alternatives to dump-on-shutdown involve a lot of disk traffic (logging or db soln) at runtime, and introduce additional I/O stress points for remote attackers to exploit.\r\n* Therefore, the only use case for dump-on-shutdown is a rapid node restart -- if restart is not rapid, much of the data will be stale, only reloading slow-confirming transactions uninteresting to miners.\r\n* Someone restarting their node tends to be an expert-only or dev-only operation; normal field operation - unattended operation or standard user session - will never see this feature.\r\n\r\nmempool restore seems likely to be a little used, expert-only feature.",
      "created_at" : "2016-08-03T19:20:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8448#issuecomment-237343082",
      "id" : 237343082,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8448",
      "updated_at" : "2016-08-03T19:20:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237343082",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   }
]
