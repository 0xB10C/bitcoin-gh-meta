[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r74368316"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/74368316"
         }
      },
      "body" : "nit: weird spacing here?\n",
      "commit_id" : "4d9e9a5b7cb3e65bcf96ea5090ab6abaeba27640",
      "created_at" : "2016-08-11T04:48:27Z",
      "diff_hunk" : "@@ -1923,16 +1923,14 @@ int GetSpendHeight(const CCoinsViewCache& inputs)\n     return pindexPrev->nHeight + 1;\n }\n \n-namespace Consensus {\n-bool CheckTxInputs(const CTransaction& tx, CValidationState& state, const CCoinsViewCache& inputs, int nSpendHeight)\n+bool Consensus::CheckTxInputs(const CTransaction& tx, CValidationState& state, const CCoinsViewCache& inputs, int nSpendHeight, CAmount& nFees)\n {\n-        // This doesn't trigger the DoS code on purpose; if it did, it would make it easier\n-        // for an attacker to attempt to split the network.\n-        if (!inputs.HaveInputs(tx))\n-            return state.Invalid(false, 0, \"\", \"Inputs unavailable\");\n+    // are the actual inputs available?\n+    if (!inputs.HaveInputs(tx))\n+        return state.DoS(100, false, REJECT_INVALID, \"bad-txns-inputs-missingorspent\", false,\n+                         strprintf(\"%s: inputs missing/spent\", __func__));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r74368316",
      "id" : 74368316,
      "original_commit_id" : "03d0f762f2de9d01750e96893555ac500e3c9a37",
      "original_position" : 57,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498",
      "updated_at" : "2017-06-02T01:03:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/74368316",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r74481846"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/74481846"
         }
      },
      "body" : "Oh, that's how the editor indented by default. That's actually what we have in some other places, but having a glance searching for strprintf in main.cpp I see we're not being consistent with indentation of function calls broken into several lines\n\nExample from the opening parenthesis position:\nhttps://github.com/bitcoin/bitcoin/blob/master/src/main.cpp#L1354\nExample 4 spaces from the beginning:\nhttps://github.com/bitcoin/bitcoin/blob/master/src/main.cpp#L1110\nExample freestyle: \nhttps://github.com/bitcoin/bitcoin/blob/master/src/main.cpp#L1436\n\nI'm happy to change it for something else, this maybe?\n\n```\n        return state.DoS(100, false, REJECT_INVALID, \"bad-txns-inputs-missingorspent\", false,\n            strprintf(\"%s: inputs missing/spent\", __func__));\n```\n\nEDIT: Actually the indentation is the same as from the place it's taken from: https://github.com/bitcoin/bitcoin/pull/8498/files#diff-7ec3c68a81efff79b6ca22ac1f1eabbaL2417\n",
      "commit_id" : "4d9e9a5b7cb3e65bcf96ea5090ab6abaeba27640",
      "created_at" : "2016-08-11T18:55:25Z",
      "diff_hunk" : "@@ -1923,16 +1923,14 @@ int GetSpendHeight(const CCoinsViewCache& inputs)\n     return pindexPrev->nHeight + 1;\n }\n \n-namespace Consensus {\n-bool CheckTxInputs(const CTransaction& tx, CValidationState& state, const CCoinsViewCache& inputs, int nSpendHeight)\n+bool Consensus::CheckTxInputs(const CTransaction& tx, CValidationState& state, const CCoinsViewCache& inputs, int nSpendHeight, CAmount& nFees)\n {\n-        // This doesn't trigger the DoS code on purpose; if it did, it would make it easier\n-        // for an attacker to attempt to split the network.\n-        if (!inputs.HaveInputs(tx))\n-            return state.Invalid(false, 0, \"\", \"Inputs unavailable\");\n+    // are the actual inputs available?\n+    if (!inputs.HaveInputs(tx))\n+        return state.DoS(100, false, REJECT_INVALID, \"bad-txns-inputs-missingorspent\", false,\n+                         strprintf(\"%s: inputs missing/spent\", __func__));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r74481846",
      "id" : 74481846,
      "original_commit_id" : "03d0f762f2de9d01750e96893555ac500e3c9a37",
      "original_position" : 57,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498",
      "updated_at" : "2017-06-02T01:03:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/74481846",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Needed rebase. Besides, the previous version contained a bug.",
      "created_at" : "2016-09-01T16:47:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8498#issuecomment-244140141",
      "id" : 244140141,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8498",
      "updated_at" : "2016-09-01T16:47:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/244140141",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Needed rebase after renaming main.o, see #9260 (although needed, the rebase was clean in this case)",
      "created_at" : "2016-12-03T06:26:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8498#issuecomment-264620779",
      "id" : 264620779,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8498",
      "updated_at" : "2016-12-03T06:26:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/264620779",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r110544416"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110544416"
         }
      },
      "body" : "I think you can change the `view.HaveInputs(tx)` below into a `Consensus::CheckTxInputs` call, doing some of the checks slightly earlier.",
      "commit_id" : "4d9e9a5b7cb3e65bcf96ea5090ab6abaeba27640",
      "created_at" : "2017-04-09T15:07:38Z",
      "diff_hunk" : "@@ -646,18 +646,20 @@ bool AcceptToMemoryPoolWorker(CTxMemPool& pool, CValidationState& state, const C\n             }\n         }\n \n-        // are the actual inputs available?\n+        // This redundant check doesn't trigger the DoS code on purpose; if it did, it would make it easier\n+        // for an attacker to attempt to split the network (Consensus::CheckTxInputs also checks this).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r110544416",
      "id" : 110544416,
      "original_commit_id" : "c93d1cf269212c493de56276370049f7b9a1d2bb",
      "original_position" : 15,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 31726387,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498",
      "updated_at" : "2017-06-02T01:03:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110544416",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r110555687"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110555687"
         }
      },
      "body" : "Rather than forcing a bogus `nFees` (or unused) everywhere,  just wrap this function with an overload containing an unused `nFees` stack variable.\r\n\r\nSimpler.  Less diff.\r\n\r\nAlso means anyone reviewing at some later date won't get confused as to whether `nFees` is _actually_ used or not.",
      "commit_id" : "4d9e9a5b7cb3e65bcf96ea5090ab6abaeba27640",
      "created_at" : "2017-04-09T23:12:57Z",
      "diff_hunk" : "@@ -1318,16 +1318,14 @@ int GetSpendHeight(const CCoinsViewCache& inputs)\n     return pindexPrev->nHeight + 1;\n }\n \n-namespace Consensus {\n-bool CheckTxInputs(const CTransaction& tx, CValidationState& state, const CCoinsViewCache& inputs, int nSpendHeight)\n+bool Consensus::CheckTxInputs(const CTransaction& tx, CValidationState& state, const CCoinsViewCache& inputs, int nSpendHeight, CAmount& nFees)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r110555687",
      "id" : 110555687,
      "original_commit_id" : "c93d1cf269212c493de56276370049f7b9a1d2bb",
      "original_position" : 48,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 31737099,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498",
      "updated_at" : "2017-06-02T01:03:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110555687",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r112045794"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112045794"
         }
      },
      "body" : "Perhaps the ~~new~~ comment could be clearer, but the ```view.HaveInputs(tx)``` check below sets ```state.DoS(0, ...)``` instead of ```state.DoS(100, ...)``` like ```Consensus::CheckTxInputs```  would do.\r\nFeel more than free to rephrase it in a way that would have been more clear to you.",
      "commit_id" : "4d9e9a5b7cb3e65bcf96ea5090ab6abaeba27640",
      "created_at" : "2017-04-18T19:43:22Z",
      "diff_hunk" : "@@ -646,18 +646,20 @@ bool AcceptToMemoryPoolWorker(CTxMemPool& pool, CValidationState& state, const C\n             }\n         }\n \n-        // are the actual inputs available?\n+        // This redundant check doesn't trigger the DoS code on purpose; if it did, it would make it easier\n+        // for an attacker to attempt to split the network (Consensus::CheckTxInputs also checks this).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r112045794",
      "id" : 112045794,
      "original_commit_id" : "c93d1cf269212c493de56276370049f7b9a1d2bb",
      "original_position" : 15,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 33331312,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498",
      "updated_at" : "2017-06-02T01:03:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112045794",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r112049225"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112049225"
         }
      },
      "body" : "The only place where this makes sense is in txmempool.cpp. There you can do a much nicer wrapper there. The diff won't be smaller in total but there will be more lines in red (which people tend to like). I considered this before and I rembember @sipa said it would be fine to just remove the check in txmempool.cpp but I can't find the comment and he changed his mind about it. I will rewrite this for you to see and I'm happy to squash it.",
      "commit_id" : "4d9e9a5b7cb3e65bcf96ea5090ab6abaeba27640",
      "created_at" : "2017-04-18T20:00:35Z",
      "diff_hunk" : "@@ -1318,16 +1318,14 @@ int GetSpendHeight(const CCoinsViewCache& inputs)\n     return pindexPrev->nHeight + 1;\n }\n \n-namespace Consensus {\n-bool CheckTxInputs(const CTransaction& tx, CValidationState& state, const CCoinsViewCache& inputs, int nSpendHeight)\n+bool Consensus::CheckTxInputs(const CTransaction& tx, CValidationState& state, const CCoinsViewCache& inputs, int nSpendHeight, CAmount& nFees)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r112049225",
      "id" : 112049225,
      "original_commit_id" : "c93d1cf269212c493de56276370049f7b9a1d2bb",
      "original_position" : 48,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 33335259,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498",
      "updated_at" : "2017-06-02T01:03:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112049225",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Added a commit that may make @dcousens happier or not, thanks for making me remember.\r\n\r\nEDIT: I would be also be happy to take the function out of the consensus namespace \"for free\" here. That was a mistake on my part.",
      "created_at" : "2017-04-18T20:51:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8498#issuecomment-294978323",
      "id" : 294978323,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8498",
      "updated_at" : "2017-04-19T15:58:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294978323",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r115339497"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115339497"
         }
      },
      "body" : "In commit \"Optimization: Minimize the number of times it is checked\"\r\n\r\nWould be good to declare nFees below close to where it is actually used.",
      "commit_id" : "4d9e9a5b7cb3e65bcf96ea5090ab6abaeba27640",
      "created_at" : "2017-05-08T20:03:16Z",
      "diff_hunk" : "@@ -624,7 +624,7 @@ bool AcceptToMemoryPoolWorker(CTxMemPool& pool, CValidationState& state, const C\n         CCoinsView dummy;\n         CCoinsViewCache view(&dummy);\n \n-        CAmount nValueIn = 0;\n+        CAmount nFees = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r115339497",
      "id" : 115339497,
      "original_commit_id" : "dd733d06d81032e95a22ef5b634e2c0bf4248bd5",
      "original_position" : 5,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 36870482,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498",
      "updated_at" : "2017-06-02T01:03:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115339497",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r115353716"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115353716"
         }
      },
      "body" : "In commit \"Optimization: Minimize the number of times it is checked\"\r\n\r\nCan you add a comment explaining this line? Why do transactions in a block with vtx.size() of >= 2 have a different spend height than transactions in a block with vtx.size() == 1? Is nSpendHeight even used in a block with vtx.size() == 1?",
      "commit_id" : "4d9e9a5b7cb3e65bcf96ea5090ab6abaeba27640",
      "created_at" : "2017-05-08T21:08:40Z",
      "diff_hunk" : "@@ -1820,6 +1814,8 @@ static bool ConnectBlock(const CBlock& block, CValidationState& state, CBlockInd\n     blockundo.vtxundo.reserve(block.vtx.size() - 1);\n     std::vector<PrecomputedTransactionData> txdata;\n     txdata.reserve(block.vtx.size()); // Required so that pointers to individual PrecomputedTransactionData don't get invalidated\n+    const int nHeight = pindex->pprev == NULL ? 0 : pindex->pprev->nHeight + 1;\n+    const int64_t nSpendHeight = block.vtx.size() > 1 ? GetSpendHeight(view) : nHeight;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r115353716",
      "id" : 115353716,
      "original_commit_id" : "dd733d06d81032e95a22ef5b634e2c0bf4248bd5",
      "original_position" : 85,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 36870482,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498",
      "updated_at" : "2017-06-02T01:03:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115353716",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r117328308"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117328308"
         }
      },
      "body" : "If the block only has the coinbase tx before GetSpendHeight(view)  would have not been called at all and starting doing so seems unnecessarily costly, see https://github.com/bitcoin/bitcoin/blob/master/src/validation.cpp#L1306\r\nI was actually hoping that someone suggested to just remove this local variable directly and just use nHeight directly for the coinbase maturity check, assuming that is safe. I think so but would like others to confirm before trying it.",
      "commit_id" : "4d9e9a5b7cb3e65bcf96ea5090ab6abaeba27640",
      "created_at" : "2017-05-18T19:04:21Z",
      "diff_hunk" : "@@ -1820,6 +1814,8 @@ static bool ConnectBlock(const CBlock& block, CValidationState& state, CBlockInd\n     blockundo.vtxundo.reserve(block.vtx.size() - 1);\n     std::vector<PrecomputedTransactionData> txdata;\n     txdata.reserve(block.vtx.size()); // Required so that pointers to individual PrecomputedTransactionData don't get invalidated\n+    const int nHeight = pindex->pprev == NULL ? 0 : pindex->pprev->nHeight + 1;\n+    const int64_t nSpendHeight = block.vtx.size() > 1 ? GetSpendHeight(view) : nHeight;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r117328308",
      "id" : 117328308,
      "original_commit_id" : "dd733d06d81032e95a22ef5b634e2c0bf4248bd5",
      "original_position" : 85,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 39028185,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498",
      "updated_at" : "2017-06-02T01:03:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117328308",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Needed rebase, hopefully fixed all nits.",
      "created_at" : "2017-05-19T04:36:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8498#issuecomment-302606393",
      "id" : 302606393,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8498",
      "updated_at" : "2017-05-19T04:36:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/302606393",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Tests for this PR seem to be failing currently, maybe due to the SpendHeight change?\r\n\r\nOnly changes since my previous review were rebasing post-#8329 and the nFees and nSpendHeight changes commented on above.",
      "created_at" : "2017-05-23T19:24:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8498#issuecomment-303505331",
      "id" : 303505331,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8498",
      "updated_at" : "2017-05-23T19:24:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/303505331",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Yes, the problem was in that change but not on stop using GetSpendHeight, just added +1 to the height by mistake. Updated.\r\n",
      "created_at" : "2017-05-30T18:11:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8498#issuecomment-304961989",
      "id" : 304961989,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8498",
      "updated_at" : "2017-05-30T18:11:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/304961989",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Needed rebase after #10195, it also needs more review now (AcceptToMemoryPoolWorker may return different DoS pnctuation [100 instead of 0] now, happy to fix if that's a problem).",
      "created_at" : "2017-06-02T01:06:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8498#issuecomment-305661391",
      "id" : 305661391,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8498",
      "updated_at" : "2017-06-02T01:06:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/305661391",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Some discussion of this in IRC https://botbot.me/freenode/bitcoin-core-dev/msg/87002756/",
      "created_at" : "2017-06-08T21:20:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8498#issuecomment-307230847",
      "id" : 307230847,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8498",
      "updated_at" : "2017-06-08T21:20:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/307230847",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r122035311"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122035311"
         }
      },
      "body" : "In commit \"Optimization: Minimize the number of times\"\r\n\r\nIf I understand correctly, it would be more correct to pass `SpendHeight(view)` instead of `pindex->nHeight` as the nSpendHeight argument, but in this case it doesn't matter because the value is only used for coinbase transactions, and this isn't a coinbase transaction? Or maybe there are other reasons why `pindex->nHeight` is ok to pass?\r\n\r\nEither way, I think this is confusing, and that there should be a comment here explaining the `pindex->nHeight` value. Or maybe you could delete the `nSpendHeight` argument and have `CheckTxInputs` call `GetSpendHeight(inputs)` when needed. This seems like it would be a simplification and I don't think there should be a performance cost because `CheckTxInputs` seems to be skipped for coinbase transactions in all cases except for one call that invokes `GetSpendHeight` anyway.",
      "commit_id" : "4d9e9a5b7cb3e65bcf96ea5090ab6abaeba27640",
      "created_at" : "2017-06-14T18:54:58Z",
      "diff_hunk" : "@@ -1622,9 +1619,8 @@ static bool ConnectBlock(const CBlock& block, CValidationState& state, CBlockInd\n \n         if (!tx.IsCoinBase())\n         {\n-            if (!view.HaveInputs(tx))\n-                return state.DoS(100, error(\"ConnectBlock(): inputs missing/spent\"),\n-                                 REJECT_INVALID, \"bad-txns-inputs-missingorspent\");\n+            if (!Consensus::CheckTxInputs(tx, state, view, pindex->nHeight, nFees))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8498#discussion_r122035311",
      "id" : 122035311,
      "original_commit_id" : "48e308d208995839d3119b40d189bf328a5b6445",
      "original_position" : 57,
      "path" : "src/validation.cpp",
      "position" : 57,
      "pull_request_review_id" : 44115137,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8498",
      "updated_at" : "2017-06-14T19:03:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122035311",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
