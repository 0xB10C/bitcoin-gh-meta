[
   {
      "body" : "Concept ACK.\r\nIssue with this PR: If the user passes `-resetguisettings`, I think we should also evict the custom set data dir.",
      "created_at" : "2016-08-09T07:05:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8487#issuecomment-238471059",
      "id" : 238471059,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8487",
      "updated_at" : "2016-08-09T07:05:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/238471059",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "> If the user passes -resetguisettings, I think we should also evict the custom set data dir.\r\n\r\nWhich raises the question if `-resetguisettings` should cause the intro to pop up again (force `-choosedatadir`).",
      "created_at" : "2016-08-09T07:43:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8487#issuecomment-238478129",
      "id" : 238478129,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8487",
      "updated_at" : "2016-08-09T07:43:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/238478129",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "> Issue with this PR: If the user passes -resetguisettings, I think we should also evict the custom set data dir.\r\n\r\nWhy should it? The primary issue is that the user doesn't know the datadir has been reset. So then resetting the options should either keep the datadir or have the user choose the datadir again.",
      "created_at" : "2016-08-09T13:25:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8487#issuecomment-238551657",
      "id" : 238551657,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8487",
      "updated_at" : "2016-08-09T13:25:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/238551657",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=3",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "body" : "> Which raises the question if -resetguisettings should cause the intro to pop up again (force -choosedatadir).\r\n\r\nI think it should either reset the data directory *and* reask with the dialog at start, or keep the data directory the same. The middle ground makes no sense.\r\n",
      "created_at" : "2016-08-10T13:07:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8487#issuecomment-238860815",
      "id" : 238860815,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8487",
      "updated_at" : "2016-08-10T13:07:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/238860815",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "> I think it should either reset the data directory and reask with the dialog at start, or keep the data directory the same. The middle ground makes no sense.\r\n\r\nAgree and I think it should re-ask with the init dialog at start.",
      "created_at" : "2016-08-10T13:15:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8487#issuecomment-238862891",
      "id" : 238862891,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8487",
      "updated_at" : "2016-08-10T13:15:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/238862891",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Ok, I will change this PR to reask for the datadir at start.",
      "created_at" : "2016-08-10T13:26:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8487#issuecomment-238865732",
      "id" : 238865732,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8487",
      "updated_at" : "2016-08-10T13:26:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/238865732",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=3",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "body" : "I've updated it so that it will reask for the datadir at the start. I've also left the datadir persist stuff since it is still needed for if `-resetguisettings` is used.",
      "created_at" : "2016-08-10T20:43:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8487#issuecomment-238997754",
      "id" : 238997754,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8487",
      "updated_at" : "2016-08-10T20:43:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/238997754",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=3",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "body" : "Separate from the changes here, we have a bug in this logic. There are two user actions that can result in a settings reset:\r\n\r\n- A1: Start bitcoin-qt with `-resetguisettings`. This results in `app.createOptionsModel(true)`, which calls `OptionsModel::Reset()`, before going into `OptionsModel::Init`.\r\n- A2: Go to the options dialog and click the \"Reset options\" button. This calls `model->Reset()` and quits the application.\r\n\r\nA2 is okay. A1 however, happens *after* it is no longer legal to change the data directory! (this should happen before step 6 in `main`). \r\n\r\nWe need to move the `-resetguisettings` logic *before* (or into) `Intro::pickDataDirectory()`. This will make sure that A1 and A2 act in the same, sane, way.\r\n",
      "created_at" : "2016-08-17T11:46:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8487#issuecomment-240388320",
      "id" : 240388320,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8487",
      "updated_at" : "2016-08-17T11:48:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240388320",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Oh, shit, that won't work either.\r\n\r\n- Step 7 determines the network (testnet or mainnet)\r\n- And we want `-resetguisettings` to clear the options for the current network, not the mainnet ones, so doing it before step 6 would clear the wrong settings.\r\n\r\nThis initialization sequence is so damn complex because it is possible to put `testnet=1` in the `bitcoin.conf` file, as this file is in the mainnet directory even for testnet/regtest... so it can override the *real* data directory used later.\r\n",
      "created_at" : "2016-08-17T11:52:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8487#issuecomment-240389324",
      "id" : 240389324,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8487",
      "updated_at" : "2016-08-17T11:52:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240389324",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Yeah, so to deal with A1, I left in the code that keeps the datadir. So what happens is that if the user does anything to reset the options, the choose datadir window will appear and let them choose the datadir. Then, if A1 happens, the datadir is still set and will remain the same after the options are reset.",
      "created_at" : "2016-08-17T12:42:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8487#issuecomment-240399276",
      "id" : 240399276,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8487",
      "updated_at" : "2016-08-17T12:42:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240399276",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=3",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
