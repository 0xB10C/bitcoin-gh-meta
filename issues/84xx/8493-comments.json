[
   {
      "body" : "This API doesn't look C-compatible. Am I missing something?\r\n\r\nDislike replacing uint256 with char arrays, but I'm not sure what the best alternative is; is it possible to make uint256 a C-compatible struct?",
      "created_at" : "2016-08-29T03:11:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8493#issuecomment-243023178",
      "id" : 243023178,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8493",
      "updated_at" : "2016-08-29T03:11:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243023178",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "I guess a struct or a typedef would work.\r\n\r\nWhat do you think is not C compatible? What am I missing?",
      "created_at" : "2016-08-29T08:17:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8493#issuecomment-243061188",
      "id" : 243061188,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8493",
      "updated_at" : "2016-08-29T08:17:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243061188",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "consensus/consensus.h isn't currently exposed in libconsensus, but namespaces, the & operator, and classes won't work in C. The function also needs to be wrapped in an extern \"C\" block to get the right ABI.",
      "created_at" : "2016-08-29T08:40:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8493#issuecomment-243066170",
      "id" : 243066170,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8493",
      "updated_at" : "2016-08-29T08:40:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243066170",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "consensus/consensus.h is not to be exposed in libconsensus.\nI didn't knew & wasn't C, but that can be trivially changed to pointers.\nI didn't knew namespaces weren't C either. Consensus::Params was a big\nmistake then...talking it out of the namespace is going to be disruptive.\n\nOn Mon, Aug 29, 2016 at 10:41 AM, Luke-Jr <notifications@github.com> wrote:\n\n> consensus/consensus.h isn't currently exposed in libconsensus, but\n> namespaces, the & operator, and classes won't work in C. The function also\n> needs to be wrapped in an extern \"C\" block to get the right ABI.\n>\n> Ã¢ÂÂ\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/8493#issuecomment-243066170>, or mute\n> the thread\n> <https://github.com/notifications/unsubscribe-auth/AA9jSuaa_riChbz-VT9yCbliW3Kn7I9qks5qkpspgaJpZM4Jgoam>\n> .\n>\n",
      "created_at" : "2016-08-29T09:33:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8493#issuecomment-243078471",
      "id" : 243078471,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8493",
      "updated_at" : "2016-08-29T09:33:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243078471",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Please don't go turn the entire codebase into C just because we want a\nC-capable API.\n\nYou can create a wrapper object in C that just contains a pointer to a\nmalloced Consensus::Params. You could have a\nlibconsensus_params_create(...) function that calls new Consensus::Params()\nand sets some fields in it, and return it cast to a void*. The caller would\nbe required to call libconsensus_params_destroy() afterwards to clean it up.\n",
      "created_at" : "2016-08-29T09:37:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8493#issuecomment-243079254",
      "id" : 243079254,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8493",
      "updated_at" : "2016-08-29T09:37:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243079254",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Yes, or just recreating the struct without the namespace and convert it\ninside the exposed function. We can slowly replace Consensus::Params for\nConsensusParams or whatever later.\nStill, had I known namespaces weren't C, ConsensusParams could have lacked\na namespace from the beginning and this wrapping wouldn't be necessary.\n",
      "created_at" : "2016-08-29T09:54:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8493#issuecomment-243082729",
      "id" : 243082729,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8493",
      "updated_at" : "2016-08-29T09:54:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243082729",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Yes it would be.\n\nConsensus::Params is a neatly encapsulated C++ class, as it should be. It\nhas private fields and getters, and we're free to change its internal\nrepresentation from time to time (and we have done so many times).\n\nConverting it to a C struct with a stable representation would be an\nincredible burden if we'd want to start adding extra fields. It being in a\nnamespace doesn't matter for this at all.\n\nPlease... create a wrapper that constructs C++ objects for the C interface.\nNot doing so would very badly limit the possible changes we can make later.\n",
      "created_at" : "2016-08-29T10:01:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8493#issuecomment-243084244",
      "id" : 243084244,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8493",
      "updated_at" : "2016-08-29T10:01:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243084244",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Yes, there's no other clean way now.\r\nI still lament not having even followed my own plan of keeping Consensus::Params as C-compatible as possible...by forgetting namespaces (really, thanks @luke-jr for pointing that out).\r\n\r\nBut yeah, I've previously discussed with @NicolasDorier that we could wrap all fields in something like struct BlockIndexInterface https://github.com/bitcoin/bitcoin/pull/8493/commits/fb9692bc74a38233c082d90566051a5ea7eb6537 around set_pointer_function_for_pseudo_method_x() style functions as an interface and that would work similarly to not wrapping it with some small advantages even if we wanted to have the inside written in C, which I don't realistically think about anymore in any case.\r\n\r\nIn this case, as you say, it is as easy as two functions: create_params() and destroy_params().\r\n\r\nThanks @luke-jr @sipa @NicolasDorier for this tremendously useful feedback.",
      "created_at" : "2016-08-30T22:46:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8493#issuecomment-243605750",
      "id" : 243605750,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8493",
      "updated_at" : "2016-08-30T22:48:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243605750",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8493#discussion_r76895077"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8493"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76895077"
         }
      },
      "body" : "NACK these two includes here.",
      "commit_id" : "46b8482a7e5d804eb3beb792d513d972844934c1",
      "created_at" : "2016-08-30T22:54:16Z",
      "diff_hunk" : "@@ -6,6 +6,9 @@\n #ifndef BITCOIN_BITCOINCONSENSUS_H\n #define BITCOIN_BITCOINCONSENSUS_H\n \n+#include \"consensus/interfaces.h\"\n+#include \"consensus/params.h\"\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8493#discussion_r76895077",
      "id" : 76895077,
      "original_commit_id" : "46b8482a7e5d804eb3beb792d513d972844934c1",
      "original_position" : 6,
      "path" : "src/script/bitcoinconsensus.h",
      "position" : 6,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8493",
      "updated_at" : "2016-08-30T23:02:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76895077",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   }
]
