[
   {
      "body" : "test_big_witness_transaction add significant test duration because of the creation of many signature, I don't feel like removing it as it may still be useful though.",
      "created_at" : "2016-07-29T02:00:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8422#issuecomment-236075849",
      "id" : 236075849,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8422",
      "updated_at" : "2016-07-29T02:00:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236075849",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "body" : "travis fail probably unrelated to this PR ",
      "created_at" : "2016-07-29T03:34:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8422#issuecomment-236086719",
      "id" : 236086719,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8422",
      "updated_at" : "2016-07-29T03:34:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236086719",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8422#discussion_r72787163"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8422"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/72787163"
         }
      },
      "body" : "Might make sense to check if any \"progress\" was made instead to avoid grabbing locks for setting any time the retrieved cachedHashes isn't empty already. ",
      "commit_id" : "6c52333c6a919e8cd8b44569b44f207d294f0bca",
      "created_at" : "2016-07-29T13:01:13Z",
      "diff_hunk" : "@@ -1915,10 +1918,23 @@ void UpdateCoins(const CTransaction& tx, CCoinsViewCache& inputs, int nHeight)\n bool CScriptCheck::operator()() {\n     const CScript &scriptSig = ptxTo->vin[nIn].scriptSig;\n     const CScriptWitness *witness = (nIn < ptxTo->wit.vtxinwit.size()) ? &ptxTo->wit.vtxinwit[nIn].scriptWitness : NULL;\n-    if (!VerifyScript(scriptSig, scriptPubKey, witness, nFlags, CachingTransactionSignatureChecker(ptxTo, nIn, amount, cacheStore), &error)) {\n-        return false;\n+    CachedHashes cachedHashes;\n+    int version;\n+    std::vector<unsigned char> program;\n+    // if the cache map is available, and we get a cache miss, then we'll need to update the cache later\n+    // if the scriptPubKey is not witness program, no need for cachedHashes, so do not read the map (it would acquire the lock needlessly)\n+    bool addCachedHashesToMap = cachedHashesMap != NULL &&\n+                                scriptPubKey.IsWitnessProgram(version, program) &&\n+                                !cachedHashesMap->TryGet(this->ptxTo->GetHash(), &cachedHashes);\n+    addCachedHashesToMap &= !cachedHashes.IsFull();\n+    bool result = VerifyScript(scriptSig, scriptPubKey, witness, nFlags, CachingTransactionSignatureChecker(ptxTo, nIn, amount, cacheStore, cachedHashes), &error);\n+    // do not update the cache if cachedHashes is still empty, it can happen if the evaluation ends before any segwit CheckSig operation could run\n+    addCachedHashesToMap &= !cachedHashes.IsEmpty();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8422#discussion_r72787163",
      "id" : 72787163,
      "original_commit_id" : "6c52333c6a919e8cd8b44569b44f207d294f0bca",
      "original_position" : 54,
      "path" : "src/main.cpp",
      "position" : 54,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8422",
      "updated_at" : "2016-07-29T13:01:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/72787163",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "@instagibbs I've just updated the PR following your suggestion.",
      "created_at" : "2016-07-29T17:14:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8422#issuecomment-236238422",
      "id" : 236238422,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8422",
      "updated_at" : "2016-07-29T17:14:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236238422",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "body" : "You're making script/interpreter depend on sync, which causes a compile failure as libconsensus (which uses script/interpreter) does not link in Boost.\r\n\r\nOne way would be to make CachedHashesMap a virtual class, with only a naive implementation (which does not cache anything). Then elsewhere you can create a derived class which adds the map and the lock.\r\n\r\nEDIT: oh no, I think you just need to stop including cachedhashesmap.h from interpreter.h.\r\nEDIT2: verified, this is what causes the build failure.",
      "created_at" : "2016-07-29T19:06:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8422#issuecomment-236267171",
      "id" : 236267171,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8422",
      "updated_at" : "2016-07-29T19:43:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236267171",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Can you also follow the coding style? Spaces after `if`, and `{` on the same line (except for classes or function bodies).",
      "created_at" : "2016-07-29T19:40:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8422#issuecomment-236274847",
      "id" : 236274847,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8422",
      "updated_at" : "2016-07-29T19:40:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236274847",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa yes, it was a mistake just removed it and fixed coding style.\r\n\r\nI am suprised, that https://travis-ci.org/bitcoin/bitcoin/builds/148371080 and when I compiled myself I did not experienced any build fails because of this mistake.",
      "created_at" : "2016-07-29T19:52:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8422#issuecomment-236277470",
      "id" : 236277470,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8422",
      "updated_at" : "2016-07-29T19:52:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236277470",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "body" : "Did you run `make check` ?",
      "created_at" : "2016-07-29T19:54:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8422#issuecomment-236277803",
      "id" : 236277803,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8422",
      "updated_at" : "2016-07-29T19:54:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236277803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "nop, only make -j4. What does the check do ? I thought it was only running tests.",
      "created_at" : "2016-07-29T19:54:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8422#issuecomment-236277964",
      "id" : 236277964,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8422",
      "updated_at" : "2016-07-29T19:54:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/236277964",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   }
]
