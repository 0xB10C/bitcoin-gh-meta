[
   {
      "body" : "Theres probably another way to do it (I know @theuni wanted to build with different flags for release, but it would be good to at least fix build).",
      "created_at" : "2015-06-07T19:12:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-109789480",
      "id" : 109789480,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6248",
      "updated_at" : "2015-06-07T19:12:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/109789480",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "We discussed this on IRC. I don't think -fPIC should be the default, for executables -fPIE is superior option. See e.g. http://www.openbsd.org/papers/nycbsdcon08-pie/\r\n\r\nThough I'm fine with enabling it as a fallback if you can add a check to autoconf that `PIE` is broken on a platform.\r\n",
      "created_at" : "2015-06-09T12:14:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-110335092",
      "id" : 110335092,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6248",
      "updated_at" : "2015-06-09T12:14:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/110335092",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Many distros force PIC anyway, so this actually wont change anything for most builds.",
      "created_at" : "2015-06-09T20:11:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-110489701",
      "id" : 110489701,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6248",
      "updated_at" : "2015-06-09T20:11:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/110489701",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "After researching the issue some over the weekend, I agree with @laanwj.\r\n\r\nTo clarify, this is an issue with gcc5 and newer clang+lto when qt is built with -reduce-relocations. Upstream GCC discussion is [here](https://gcc.gnu.org/bugzilla/show_bug.cgi?id=65886). \r\n\r\nWe have a few options:\r\n- Do nothing. I think I'd prefer this, reasoning below.\r\n- use -PIC instead for known-problematic compilers. This would mean maintaining a black-list since I don't believe this can be easily tested.\r\n- Use -PIC instead only when building bitcoin-qt _and_ using a problematic compiler _and_ when qt was built with -reduce-relocations (this can be tested via preprocessor).\r\n- Default to -PIC everywhere and override with -PIE when creating release binaries.\r\n\r\n2 and 3 would be necessary only for building bitcoin-qt, but we'd end up having to disable PIE for bitcoind as well, to avoid building 2 sets of objects.\r\n\r\nI believe that the root issue here is that distros are shipping qt libs with -reduce-relocations, which is known to violate abi specs and makes assumptions about how downstreams will use their libs. That abi spec violation became a real-world issue with the latest compilers.\r\n\r\nSo IMO, the more reasonable thing to do here would be to try to convince Arch to disable -reduce-relocations for their qt build. We can't be the only downstream with this issue.",
      "created_at" : "2015-06-09T20:16:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-110491401",
      "id" : 110491401,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6248",
      "updated_at" : "2015-06-09T20:50:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/110491401",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "OK, @theuni I filed a bug at https://bugs.archlinux.org/task/45283 lets see what the maintainers there say.",
      "created_at" : "2015-06-09T20:29:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-110495368",
      "id" : 110495368,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6248",
      "updated_at" : "2015-06-09T20:29:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/110495368",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@cfields I'm ok with all those options, except \"Default to -PIC everywhere and override with -PIE when creating release binaries.\" Let's not have everyone suffer because a distro builds libraries with broken options. \r\nEither we work around this specific case when it happens, or we do nothing and have Arch users provide an extra option as workaround (could be documented in `build_unix.md`).\r\nWould be even better if the problem could just be solved upstream.\r\n",
      "created_at" : "2015-06-10T06:05:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-110603934",
      "id" : 110603934,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6248",
      "updated_at" : "2015-06-10T06:05:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/110603934",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@cfields would you mind discussing with the arch maintainer @ https://bugs.archlinux.org/task/45283#comment136231 ?\n\nOn June 9, 2015 11:06:00 PM PDT, \"Wladimir J. van der Laan\" <notifications@github.com> wrote:\n>@cfields I'm ok with all those options, except \"Default to -PIC\n>everywhere and override with -PIE when creating release binaries.\"\n>Let's not have everyone suffer because a distro builds libraries with\n>broken options. \n>Either we work around this specific case when it happens, or we do\n>nothing and have Arch users provide an extra option as workaround\n>(could be documented in `build_unix.md`).\n>Would be even better if the problem could just be solved upstream.\n>\n>\n>---\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-110603934\n",
      "created_at" : "2015-06-10T08:41:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-110656561",
      "id" : 110656561,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6248",
      "updated_at" : "2015-06-10T08:41:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/110656561",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "This issue is present on Fedora 22 as well.",
      "created_at" : "2015-06-27T13:01:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-116041222",
      "id" : 116041222,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6248",
      "updated_at" : "2015-06-27T13:01:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/116041222",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1021899?v=3",
         "events_url" : "https://api.github.com/users/dankeder/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dankeder/followers",
         "following_url" : "https://api.github.com/users/dankeder/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dankeder/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dankeder",
         "id" : 1021899,
         "login" : "dankeder",
         "organizations_url" : "https://api.github.com/users/dankeder/orgs",
         "received_events_url" : "https://api.github.com/users/dankeder/received_events",
         "repos_url" : "https://api.github.com/users/dankeder/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dankeder/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dankeder/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dankeder"
      }
   },
   {
      "body" : "I have a fix for this in the works. I'll try to push it up in the next few days.",
      "created_at" : "2015-06-27T14:29:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-116068528",
      "id" : 116068528,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6248",
      "updated_at" : "2015-06-27T14:29:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/116068528",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "Arch changed their build settings and this is no longer an issue there, is it still on Fedora? Can we file a bug there? @dankeder ",
      "created_at" : "2015-07-17T23:14:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-122441727",
      "id" : 122441727,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6248",
      "updated_at" : "2015-07-17T23:14:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/122441727",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Yes, the problem is still present on F22:\r\n\r\nIn my bitcoin repo (checkout tag v0.10.2):\r\n\r\n    $ ./configure --prefix=/home/dan/programs/bitcoin-0.10.2 --with-gui=qt5 --with-pic --disable-shared --disable-tests\r\n    (...)\r\n    $ make                     \r\n    Making all in src\r\n    make[1]: Entering directory '/home/dan/tmp/src/bitcoin/src'\r\n    make[2]: Entering directory '/home/dan/tmp/src/bitcoin/src'\r\n      CXX      qt/qt_bitcoin_qt-bitcoin.o\r\n    In file included from /usr/include/qt5/QtGui/qwindowdefs.h:37:0,\r\n                     from /usr/include/qt5/QtWidgets/qwidget.h:37,\r\n                     from /usr/include/qt5/QtWidgets/qframe.h:37,\r\n                     from /usr/include/qt5/QtWidgets/qlabel.h:37,\r\n                     from /usr/include/qt5/QtWidgets/QLabel:1,\r\n                     from qt/bitcoingui.h:14,\r\n                     from qt/bitcoin.cpp:9:\r\n    /usr/include/qt5/QtCore/qglobal.h:1052:4: error: #error \"You must build your code with position independent code if Qt was built with -reduce-relocations. \" \"Compile your code with -fPIC (-fPIE is not enough).\"\r\n     #  error \"You must build your code with position independent code if Qt was built with -reduce-relocations. \"\\\r\n        ^\r\n    Makefile:5494: recipe for target 'qt/qt_bitcoin_qt-bitcoin.o' failed\r\n    make[2]: *** [qt/qt_bitcoin_qt-bitcoin.o] Error 1\r\n    make[2]: Leaving directory '/home/dan/tmp/src/bitcoin/src'\r\n    Makefile:6246: recipe for target 'all-recursive' failed\r\n    make[1]: *** [all-recursive] Error 1\r\n    make[1]: Leaving directory '/home/dan/tmp/src/bitcoin/src'\r\n    Makefile:568: recipe for target 'all-recursive' failed\r\n    make: *** [all-recursive] Error 1\r\n\r\nI have these QT5 packages:\r\n\r\n    $ rpm -qa | grep qt5-qtbase \r\n    qt5-qtbase-gui-5.4.2-2.fc22.x86_64\r\n    qt5-qtbase-5.4.2-2.fc22.x86_64\r\n    qt5-qtbase-devel-5.4.2-2.fc22.x86_64\r\n    qt5-qtbase-common-5.4.2-2.fc22.noarch\r\n",
      "created_at" : "2015-07-20T18:32:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6248#issuecomment-122979235",
      "id" : 122979235,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6248",
      "updated_at" : "2015-07-20T18:32:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/122979235",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1021899?v=3",
         "events_url" : "https://api.github.com/users/dankeder/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dankeder/followers",
         "following_url" : "https://api.github.com/users/dankeder/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dankeder/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dankeder",
         "id" : 1021899,
         "login" : "dankeder",
         "organizations_url" : "https://api.github.com/users/dankeder/orgs",
         "received_events_url" : "https://api.github.com/users/dankeder/received_events",
         "repos_url" : "https://api.github.com/users/dankeder/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dankeder/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dankeder/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dankeder"
      }
   }
]
