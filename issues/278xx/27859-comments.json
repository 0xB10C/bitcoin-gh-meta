[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
      "created_at" : "2023-06-12T09:33:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27859#issuecomment-1586958723",
      "id" : 1586958723,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27859",
      "node_id" : "IC_kwDOABII585elxGD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1586958723/reactions"
      },
      "updated_at" : "2023-06-12T09:33:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1586958723",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27859#discussion_r1226384032"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27859"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226384032"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why add this as a separate file, rather than adding it to the end of the fee estimates data file which is already updated periodically and ignored if out of date?\r\n\r\nAdding a method to the mempool to set the min fee based on that seems plausible? (Perhaps make it conditional on the new value being higher than the current minfee, and the mempool being less than 95% full?)",
      "commit_id" : "944350c69a99a54b9062a7cefa101cad2b54798d",
      "created_at" : "2023-06-12T09:44:16Z",
      "diff_hunk" : "@@ -21,3 +21,8 @@ fs::path MempoolPath(const ArgsManager& argsman)\n }\n \n } // namespace node\n+\n+fs::path MemPoolMinFeePath(const ArgsManager& argsman)\n+{\n+    return argsman.GetDataDirNet() / \"mempool_min_fee.dat\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27859#discussion_r1226384032",
      "id" : 1226384032,
      "line" : 27,
      "node_id" : "PRRC_kwDOABII585JGSKg",
      "original_commit_id" : "e57d0781a01da5341dc230824b892ba4765f9913",
      "original_line" : 27,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/node/mempool_persist_args.cpp",
      "position" : 7,
      "pull_request_review_id" : 1474496465,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27859",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226384032/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-12T09:49:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226384032",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27859#discussion_r1226391232"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27859"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226391232"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The idea is to update it periodically, and writing the full mempool to disk regularly may be unappealing.",
      "commit_id" : "944350c69a99a54b9062a7cefa101cad2b54798d",
      "created_at" : "2023-06-12T09:50:22Z",
      "diff_hunk" : "@@ -64,6 +64,7 @@ Subdirectory       | File(s)               | Description\n `./`               | `guisettings.ini.bak` | Backup of former [GUI settings](#gui-settings) after `-resetguisettings` option is used\n `./`               | `ip_asn.map`          | IP addresses to Autonomous System Numbers (ASNs) mapping used for bucketing of the peers; path can be specified with the `-asmap` option\n `./`               | `mempool.dat`         | Dump of the mempool's transactions\n+`./`               | `mempool_min_fee.dat` | Stores the minimum fee rate of a transaction that will be accepted into the mempool",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27859#discussion_r1226391232",
      "id" : 1226391232,
      "line" : 67,
      "node_id" : "PRRC_kwDOABII585JGT7A",
      "original_commit_id" : "944350c69a99a54b9062a7cefa101cad2b54798d",
      "original_line" : 67,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "doc/files.md",
      "position" : 4,
      "pull_request_review_id" : 1474506886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27859",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226391232/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-12T09:50:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226391232",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27859#discussion_r1226417224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27859"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226417224"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(This was in reply to my question why not to save it to `mempool.dat`, which was accidentally deleted)\r\n\r\n> writing the full mempool to disk regularly may be unappealing\r\n\r\nProbably off-topic here, but if we assume that the fee estimates must be written regularly due to unclean shutdowns, then the mempool should be as well, no?",
      "commit_id" : "944350c69a99a54b9062a7cefa101cad2b54798d",
      "created_at" : "2023-06-12T10:11:56Z",
      "diff_hunk" : "@@ -64,6 +64,7 @@ Subdirectory       | File(s)               | Description\n `./`               | `guisettings.ini.bak` | Backup of former [GUI settings](#gui-settings) after `-resetguisettings` option is used\n `./`               | `ip_asn.map`          | IP addresses to Autonomous System Numbers (ASNs) mapping used for bucketing of the peers; path can be specified with the `-asmap` option\n `./`               | `mempool.dat`         | Dump of the mempool's transactions\n+`./`               | `mempool_min_fee.dat` | Stores the minimum fee rate of a transaction that will be accepted into the mempool",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27859#discussion_r1226417224",
      "id" : 1226417224,
      "in_reply_to_id" : 1226391232,
      "line" : 67,
      "node_id" : "PRRC_kwDOABII585JGaRI",
      "original_commit_id" : "944350c69a99a54b9062a7cefa101cad2b54798d",
      "original_line" : 67,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "doc/files.md",
      "position" : 4,
      "pull_request_review_id" : 1474548279,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27859",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226417224/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-12T10:11:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226417224",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27859#discussion_r1227810641"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27859"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227810641"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you. Yes, I agree that adding it at the end of `fee_estimates.dat` would indeed reduce redundancy. I would update that.\r\n\r\nRegarding making it conditional to read the persisted `mempoolminfee`, could you please clarify the scenarios in which we might want to use the default `mempoolminfee` value? In this, it is already conditional to remember the `mempoolminfee` as stale `mempoolminfee` will not be read at all.",
      "commit_id" : "944350c69a99a54b9062a7cefa101cad2b54798d",
      "created_at" : "2023-06-13T09:20:11Z",
      "diff_hunk" : "@@ -21,3 +21,8 @@ fs::path MempoolPath(const ArgsManager& argsman)\n }\n \n } // namespace node\n+\n+fs::path MemPoolMinFeePath(const ArgsManager& argsman)\n+{\n+    return argsman.GetDataDirNet() / \"mempool_min_fee.dat\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27859#discussion_r1227810641",
      "id" : 1227810641,
      "in_reply_to_id" : 1226384032,
      "line" : 27,
      "node_id" : "PRRC_kwDOABII585JLudR",
      "original_commit_id" : "e57d0781a01da5341dc230824b892ba4765f9913",
      "original_line" : 27,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/node/mempool_persist_args.cpp",
      "position" : 7,
      "pull_request_review_id" : 1476676479,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27859",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227810641/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-13T09:20:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227810641",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27859#discussion_r1227846644"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27859"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227846644"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It appears that taking the approach of dumping to `fee_estimates.dat` and implementing a method to set `mempoolminfee` based on the persisted value is a better option.\r\n\r\nYour perspective on persisting the mempool periodically. I understand the concern about remembering the fee estimates and `mempoolminfee` without the mempool itself. However, I would like to seek further insight into the potential consequences that could arise from this, as dumping the mempool periodically might be unappealing",
      "commit_id" : "944350c69a99a54b9062a7cefa101cad2b54798d",
      "created_at" : "2023-06-13T09:44:18Z",
      "diff_hunk" : "@@ -64,6 +64,7 @@ Subdirectory       | File(s)               | Description\n `./`               | `guisettings.ini.bak` | Backup of former [GUI settings](#gui-settings) after `-resetguisettings` option is used\n `./`               | `ip_asn.map`          | IP addresses to Autonomous System Numbers (ASNs) mapping used for bucketing of the peers; path can be specified with the `-asmap` option\n `./`               | `mempool.dat`         | Dump of the mempool's transactions\n+`./`               | `mempool_min_fee.dat` | Stores the minimum fee rate of a transaction that will be accepted into the mempool",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27859#discussion_r1227846644",
      "id" : 1227846644,
      "in_reply_to_id" : 1226391232,
      "line" : 67,
      "node_id" : "PRRC_kwDOABII585JL3P0",
      "original_commit_id" : "944350c69a99a54b9062a7cefa101cad2b54798d",
      "original_line" : 67,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "doc/files.md",
      "position" : 4,
      "pull_request_review_id" : 1476733649,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27859",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227846644/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-13T09:44:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227846644",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27859#discussion_r1228086493"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27859"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228086493"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "An alternative could be to also set `rollingMinimumFeeRate`, and then also set`lastRollingFeeUpdate` to the timestamp of the min fee dump, and then just let `GetMinFee() run its exponential backoff algorithm as per normal?",
      "commit_id" : "944350c69a99a54b9062a7cefa101cad2b54798d",
      "created_at" : "2023-06-13T12:54:44Z",
      "diff_hunk" : "@@ -401,8 +404,92 @@ CTxMemPool::CTxMemPool(const Options& opts)\n       m_full_rbf{opts.full_rbf},\n       m_limits{opts.limits}\n {\n+    if (m_is_min_relay_feerate_set) {\n+        LogPrintf(\"Minimum relay transaction fee has been set will be used as MemPool minimum fee. \\n\");\n+        return;\n+    }\n+    AutoFile min_fee_file{fsbridge::fopen(m_mempool_min_fee_file_path, \"rb\")};\n+\n+    // If the file is not found return early\n+    if (min_fee_file.IsNull()) {\n+        LogPrintf(\"%s not found, Continue anyway. \\n\", fs::PathToString(m_mempool_min_fee_file_path.filename()));\n+        return;\n+    }\n+    if (!Read(min_fee_file)) {\n+        LogPrintf(\"Failed to read MemPool minimum fee from %s, Continue anyway. \\n\", fs::PathToString(m_mempool_min_fee_file_path.filename()));\n+    }\n }\n \n+bool CTxMemPool::Read(AutoFile& filein) const\n+{\n+    try {\n+        LOCK(cs);\n+        unsigned int version;\n+        filein >> version;\n+        if (version != MEMPOOL_MINIMUM_FEE_DUMP_VERSION) {\n+            throw std::runtime_error(\"Incompatible MemPool minimum fee dump version\");\n+        }\n+\n+        uint64_t file_timestamp;\n+        filein >> file_timestamp;\n+        auto now = std::chrono::system_clock::now();\n+        uint64_t current_timestamp = TicksSinceEpoch<std::chrono::seconds>(now);\n+        uint64_t difference_in_hours = (current_timestamp - file_timestamp) / 3600;\n+\n+        // Do not read MemPool minimum fee if it's too old\n+        if (difference_in_hours > Ticks<std::chrono::hours>(MAX_FILE_AGE)) {\n+            LogPrintf(\"MemPool minimum fee from %s too old (age= %lld > %lld hours). \\n\", fs::PathToString(m_mempool_min_fee_file_path.filename()), difference_in_hours, Ticks<std::chrono::hours>(MAX_FILE_AGE));\n+            return false;\n+        }\n+\n+        int64_t mempool_min_fee;\n+        filein >> mempool_min_fee;\n+        // Ensure that the MemPool minimum fee is not corrupt\n+        if (mempool_min_fee < 0) {\n+            throw std::runtime_error(\"MemPool minimum fee corrupt\");\n+        }\n+        /** The current MemPool minimum fee will be determined by taking the maximum of\n+         *  the persisted MemPool minimum fee and the default minimum fee.\n+         **/\n+        rollingMinimumFeeRate = std::max(mempool_min_fee, GetMinFee().GetFeePerK());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27859#discussion_r1228086493",
      "id" : 1228086493,
      "line" : 454,
      "node_id" : "PRRC_kwDOABII585JMxzd",
      "original_commit_id" : "16088103c09c8cd5fe11ee1753a11fdd196a551e",
      "original_line" : 454,
      "original_position" : 69,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 78,
      "pull_request_review_id" : 1477104823,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27859",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228086493/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-13T13:26:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228086493",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27859#discussion_r1228088500"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27859"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228088500"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I think the code is clear enough here that comments aren't really needed?",
      "commit_id" : "944350c69a99a54b9062a7cefa101cad2b54798d",
      "created_at" : "2023-06-13T12:56:21Z",
      "diff_hunk" : "@@ -401,8 +404,92 @@ CTxMemPool::CTxMemPool(const Options& opts)\n       m_full_rbf{opts.full_rbf},\n       m_limits{opts.limits}\n {\n+    if (m_is_min_relay_feerate_set) {\n+        LogPrintf(\"Minimum relay transaction fee has been set will be used as MemPool minimum fee. \\n\");\n+        return;\n+    }\n+    AutoFile min_fee_file{fsbridge::fopen(m_mempool_min_fee_file_path, \"rb\")};\n+\n+    // If the file is not found return early",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27859#discussion_r1228088500",
      "id" : 1228088500,
      "line" : 413,
      "node_id" : "PRRC_kwDOABII585JMyS0",
      "original_commit_id" : "16088103c09c8cd5fe11ee1753a11fdd196a551e",
      "original_line" : 413,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 37,
      "pull_request_review_id" : 1477104823,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27859",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228088500/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-13T13:26:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228088500",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27859#discussion_r1228088807"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27859"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228088807"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: same here re. comments (and a few more places).",
      "commit_id" : "944350c69a99a54b9062a7cefa101cad2b54798d",
      "created_at" : "2023-06-13T12:56:34Z",
      "diff_hunk" : "@@ -401,8 +404,92 @@ CTxMemPool::CTxMemPool(const Options& opts)\n       m_full_rbf{opts.full_rbf},\n       m_limits{opts.limits}\n {\n+    if (m_is_min_relay_feerate_set) {\n+        LogPrintf(\"Minimum relay transaction fee has been set will be used as MemPool minimum fee. \\n\");\n+        return;\n+    }\n+    AutoFile min_fee_file{fsbridge::fopen(m_mempool_min_fee_file_path, \"rb\")};\n+\n+    // If the file is not found return early\n+    if (min_fee_file.IsNull()) {\n+        LogPrintf(\"%s not found, Continue anyway. \\n\", fs::PathToString(m_mempool_min_fee_file_path.filename()));\n+        return;\n+    }\n+    if (!Read(min_fee_file)) {\n+        LogPrintf(\"Failed to read MemPool minimum fee from %s, Continue anyway. \\n\", fs::PathToString(m_mempool_min_fee_file_path.filename()));\n+    }\n }\n \n+bool CTxMemPool::Read(AutoFile& filein) const\n+{\n+    try {\n+        LOCK(cs);\n+        unsigned int version;\n+        filein >> version;\n+        if (version != MEMPOOL_MINIMUM_FEE_DUMP_VERSION) {\n+            throw std::runtime_error(\"Incompatible MemPool minimum fee dump version\");\n+        }\n+\n+        uint64_t file_timestamp;\n+        filein >> file_timestamp;\n+        auto now = std::chrono::system_clock::now();\n+        uint64_t current_timestamp = TicksSinceEpoch<std::chrono::seconds>(now);\n+        uint64_t difference_in_hours = (current_timestamp - file_timestamp) / 3600;\n+\n+        // Do not read MemPool minimum fee if it's too old",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27859#discussion_r1228088807",
      "id" : 1228088807,
      "line" : 439,
      "node_id" : "PRRC_kwDOABII585JMyXn",
      "original_commit_id" : "16088103c09c8cd5fe11ee1753a11fdd196a551e",
      "original_line" : 439,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 63,
      "pull_request_review_id" : 1477104823,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27859",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228088807/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-13T13:26:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228088807",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27859#discussion_r1228094327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27859"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228094327"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I would agree that it makes sense to dump into fee_estimates.dat.",
      "commit_id" : "944350c69a99a54b9062a7cefa101cad2b54798d",
      "created_at" : "2023-06-13T13:00:48Z",
      "diff_hunk" : "@@ -64,6 +64,7 @@ Subdirectory       | File(s)               | Description\n `./`               | `guisettings.ini.bak` | Backup of former [GUI settings](#gui-settings) after `-resetguisettings` option is used\n `./`               | `ip_asn.map`          | IP addresses to Autonomous System Numbers (ASNs) mapping used for bucketing of the peers; path can be specified with the `-asmap` option\n `./`               | `mempool.dat`         | Dump of the mempool's transactions\n+`./`               | `mempool_min_fee.dat` | Stores the minimum fee rate of a transaction that will be accepted into the mempool",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27859#discussion_r1228094327",
      "id" : 1228094327,
      "in_reply_to_id" : 1226391232,
      "line" : 67,
      "node_id" : "PRRC_kwDOABII585JMzt3",
      "original_commit_id" : "944350c69a99a54b9062a7cefa101cad2b54798d",
      "original_line" : 67,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "doc/files.md",
      "position" : 4,
      "pull_request_review_id" : 1477104823,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27859",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228094327/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-13T13:26:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228094327",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   }
]
