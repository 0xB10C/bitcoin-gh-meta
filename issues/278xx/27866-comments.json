[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27866#discussion_r1227107197"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27866"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227107197"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"blockstorage: Return on fatal flush errors\" (1fe06a811bf8be941bef5336af97688f48885828)\r\n\r\nThis method is not marked nodiscard, and it seems like there are some cases where this error is ignored and not returned to the caller.",
      "commit_id" : "1fe06a811bf8be941bef5336af97688f48885828",
      "created_at" : "2023-06-12T18:53:22Z",
      "diff_hunk" : "@@ -2506,7 +2506,9 @@ bool Chainstate::FlushStateToDisk(\n                 LOG_TIME_MILLIS_WITH_CATEGORY(\"write block and undo data to disk\", BCLog::BENCH);\n \n                 // First make sure all block and undo data is flushed to disk.\n-                m_blockman.FlushBlockFile();\n+                if (!m_blockman.FlushBlockFile()) {\n+                    return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27866#discussion_r1227107197",
      "id" : 1227107197,
      "line" : 2510,
      "node_id" : "PRRC_kwDOABII585JJCt9",
      "original_commit_id" : "1fe06a811bf8be941bef5336af97688f48885828",
      "original_line" : 2510,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 6,
      "pull_request_review_id" : 1475602374,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27866",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227107197/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-12T19:22:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227107197",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27866#discussion_r1227119951"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27866"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227119951"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"chainstate: Return on ValidatedSnapshotCleanup fatal failure\" (360fe5a47f75514621ef62bc4c906f2112d3308f)\r\n\r\nI think this should return FAILURE not INTERRUPTED so caller can know that an error happened, not just an early shutdown request.\r\n\r\nBut I'd actually suggest dropping this commit from the PR. #27862 should cover this case, and I opened it earlier because I think AbortNode calls in assumeutxo code and in flush code seem different. There should be less of a rationale for ignoring errors in assumeutxo.",
      "commit_id" : "1fe06a811bf8be941bef5336af97688f48885828",
      "created_at" : "2023-06-12T19:03:17Z",
      "diff_hunk" : "@@ -207,7 +207,9 @@ ChainstateLoadResult LoadChainstate(ChainstateManager& chainman, const CacheSize\n     } else if (snapshot_completion == SnapshotCompletionResult::SUCCESS) {\n         LogPrintf(\"[snapshot] cleaning up unneeded background chainstate, then reinitializing\\n\");\n         if (!chainman.ValidatedSnapshotCleanup()) {\n-            AbortNode(\"Background chainstate cleanup failed unexpectedly.\");\n+            const auto error = _(\"Background chainstate cleanup failed unexpectedly.\");\n+            AbortNode(error.original);\n+            return {ChainstateLoadStatus::INTERRUPTED, error};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27866#discussion_r1227119951",
      "id" : 1227119951,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JJF1P",
      "original_commit_id" : "360fe5a47f75514621ef62bc4c906f2112d3308f",
      "original_line" : 212,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/node/chainstate.cpp",
      "position" : null,
      "pull_request_review_id" : 1475602374,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27866",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227119951/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-12T19:22:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227119951",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27866#discussion_r1227166132"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27866"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227166132"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yup, I'll drop, make this PR about the flush errors only and continue discussion on your PR.",
      "commit_id" : "1fe06a811bf8be941bef5336af97688f48885828",
      "created_at" : "2023-06-12T19:51:24Z",
      "diff_hunk" : "@@ -207,7 +207,9 @@ ChainstateLoadResult LoadChainstate(ChainstateManager& chainman, const CacheSize\n     } else if (snapshot_completion == SnapshotCompletionResult::SUCCESS) {\n         LogPrintf(\"[snapshot] cleaning up unneeded background chainstate, then reinitializing\\n\");\n         if (!chainman.ValidatedSnapshotCleanup()) {\n-            AbortNode(\"Background chainstate cleanup failed unexpectedly.\");\n+            const auto error = _(\"Background chainstate cleanup failed unexpectedly.\");\n+            AbortNode(error.original);\n+            return {ChainstateLoadStatus::INTERRUPTED, error};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27866#discussion_r1227166132",
      "id" : 1227166132,
      "in_reply_to_id" : 1227119951,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JJRG0",
      "original_commit_id" : "360fe5a47f75514621ef62bc4c906f2112d3308f",
      "original_line" : 212,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/node/chainstate.cpp",
      "position" : null,
      "pull_request_review_id" : 1475700763,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27866",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227166132/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-12T19:51:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227166132",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27866#discussion_r1246307365"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27866"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1246307365"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "There are many cases where these fatal error codes are eventually ignored as you go up the call stack. I would like to keep this PR focused on the question whether these blockstorage flush functions should at least indicate that they ran into an error. If you want to get a sense of just how many such \"ignored\" cases there are, I have my own set of patches that achieve something similar to Cory's \"bubble up\", but with your `Result<T, E>` type and introduced granularly for each fatal error call site here: https://github.com/TheCharlatan/bitcoin/pull/13. ",
      "commit_id" : "1fe06a811bf8be941bef5336af97688f48885828",
      "created_at" : "2023-06-29T08:33:40Z",
      "diff_hunk" : "@@ -2506,7 +2506,9 @@ bool Chainstate::FlushStateToDisk(\n                 LOG_TIME_MILLIS_WITH_CATEGORY(\"write block and undo data to disk\", BCLog::BENCH);\n \n                 // First make sure all block and undo data is flushed to disk.\n-                m_blockman.FlushBlockFile();\n+                if (!m_blockman.FlushBlockFile()) {\n+                    return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27866#discussion_r1246307365",
      "id" : 1246307365,
      "in_reply_to_id" : 1227107197,
      "line" : 2510,
      "node_id" : "PRRC_kwDOABII585KSSQl",
      "original_commit_id" : "1fe06a811bf8be941bef5336af97688f48885828",
      "original_line" : 2510,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 6,
      "pull_request_review_id" : 1504816042,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27866",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1246307365/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-29T08:33:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1246307365",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27866#discussion_r1246940264"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27866"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1246940264"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Formatting: `if (`",
      "commit_id" : "1fe06a811bf8be941bef5336af97688f48885828",
      "created_at" : "2023-06-29T17:36:41Z",
      "diff_hunk" : "@@ -733,7 +739,9 @@ bool BlockManager::WriteUndoDataForBlock(const CBlockUndo& blockundo, BlockValid\n         // with the block writes (usually when a synced up node is getting newly mined blocks) -- this case is caught in\n         // the FindBlockPos function\n         if (_pos.nFile < m_last_blockfile && static_cast<uint32_t>(block.nHeight) == m_blockfile_info[_pos.nFile].nHeightLast) {\n-            FlushUndoFile(_pos.nFile, true);\n+            if(!FlushUndoFile(_pos.nFile, true)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27866#discussion_r1246940264",
      "id" : 1246940264,
      "line" : 742,
      "node_id" : "PRRC_kwDOABII585KUsxo",
      "original_commit_id" : "1fe06a811bf8be941bef5336af97688f48885828",
      "original_line" : 742,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/node/blockstorage.cpp",
      "position" : 60,
      "pull_request_review_id" : 1505795854,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27866",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1246940264/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-29T17:36:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1246940264",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   }
]
