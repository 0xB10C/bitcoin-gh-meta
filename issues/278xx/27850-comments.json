[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [MarcoFalke](https://github.com/bitcoin/bitcoin/pull/27850#pullrequestreview-1539812584), [jonatack](https://github.com/bitcoin/bitcoin/pull/27850#pullrequestreview-1539942275), [furszy](https://github.com/bitcoin/bitcoin/pull/27850#pullrequestreview-1545497177) |\n| Concept ACK | [dergoegge](https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1587015221) |\n| Stale ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/27850#pullrequestreview-1539378350) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27976](https://github.com/bitcoin/bitcoin/pull/27976) (ci: Start with clean env by MarcoFalke)\n* [#20892](https://github.com/bitcoin/bitcoin/pull/20892) (tests: Run both descriptor and legacy tests within a single test invocation by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-06-10T13:14:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1585663277",
      "id" : 1585663277,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585eg00t",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1585663277/reactions"
      },
      "updated_at" : "2023-07-25T21:42:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1585663277",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1225636430"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225636430"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 77bf6172:\r\nnit: Could use the existent test params:\r\n```suggestion\r\n    const auto& params = Params();\r\n```",
      "commit_id" : "38bc46316d6172bcd1fe40bda4d222c547350495",
      "created_at" : "2023-06-10T22:47:45Z",
      "diff_hunk" : "@@ -86,4 +87,70 @@ BOOST_FIXTURE_TEST_CASE(blockmanager_scan_unlink_already_pruned_files, TestChain\n     BOOST_CHECK(!AutoFile(blockman.OpenBlockFile(new_pos, true)).IsNull());\n }\n \n+struct FastPruneTestingSetup : public BasicTestingSetup {\n+    FastPruneTestingSetup()\n+        : BasicTestingSetup{ChainType::MAIN, /*extra_args=*/{\"-fastprune=1\"}} {}\n+};\n+\n+BOOST_FIXTURE_TEST_CASE(blockmanager_flush_block_file, FastPruneTestingSetup)\n+{\n+    const auto params{CreateChainParams(ArgsManager{}, ChainType::MAIN)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1225636430",
      "id" : 1225636430,
      "line" : 97,
      "node_id" : "PRRC_kwDOABII585JDbpO",
      "original_commit_id" : "77bf6172a0974717606fb31aba2e88e716747eb8",
      "original_line" : 97,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/test/blockmanager_tests.cpp",
      "position" : 19,
      "pull_request_review_id" : 1473519529,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225636430/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-11T16:47:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225636430",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1225864826"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225864826"
         }
      },
      "author_association" : "MEMBER",
      "body" : "~Do you know why the node is flushing stuff to disk when nothing happened?~\r\n\r\nEdit: answer: https://github.com/bitcoin/bitcoin/pull/27039.. so nvm.",
      "commit_id" : "38bc46316d6172bcd1fe40bda4d222c547350495",
      "created_at" : "2023-06-11T16:47:12Z",
      "diff_hunk" : "@@ -68,12 +73,56 @@ def find_block(b, start):\n             'LoadExternalBlockFile: Out of order block',\n             'LoadExternalBlockFile: Processing out of order child',\n         ]):\n-            extra_args = [[\"-reindex\"]]\n-            self.start_nodes(extra_args)\n+            self.start_node(0, extra_args=[\"-reindex\"])\n \n         # All blocks should be accepted and processed.\n         assert_equal(self.nodes[0].getblockcount(), 12)\n \n+    def reindex_readonly(self):\n+        self.connect_nodes(0, 1)\n+        addr = self.nodes[1].get_deterministic_priv_key().address\n+\n+        # generate enough blocks to ensure that the -fastprune node fills up the\n+        # first blk00000.dat file and starts another block file\n+\n+        # How big are empty regtest blocks?\n+        block_hash = self.generatetoaddress(self.nodes[1], 1, addr)[0]\n+        block_size = self.nodes[1].getblock(block_hash)[\"size\"]\n+        block_size += 8 # BLOCK_SERIALIZATION_HEADER_SIZE\n+\n+        # How many blocks do we need to roll over a new .blk file?\n+        block_count = self.nodes[1].getblockcount()\n+        fastprune_blockfile_size = 0x10000\n+        size_needed = fastprune_blockfile_size - (block_size * block_count)\n+        blocks_needed = size_needed // block_size\n+\n+        self.log.debug(\"Generate enough blocks to start second block file\")\n+        self.generatetoaddress(self.nodes[1], blocks_needed, addr)\n+        self.stop_node(1)\n+\n+        assert os.path.exists(self.nodes[1].chain_path / 'blocks' / 'blk00000.dat')\n+        assert os.path.exists(self.nodes[1].chain_path / 'blocks' / 'blk00001.dat')\n+\n+        self.log.debug(\"Make the first block file read-only\")\n+        filename = self.nodes[1].chain_path / 'blocks' / 'blk00000.dat'\n+        os.chmod(filename, 0o444)\n+\n+        self.log.debug(\"Attempt to restart and reindex the node with the read-only block file\")\n+        with self.nodes[1].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n+            # Depending on the filesystem, attempted flushing to the read-only file will either happen...\n+            try:\n+                # ...during initialization...\n+                self.start_node(1, extra_args=[\"-reindex\", \"-fastprune\"])\n+                # ...or upon shutdown, if initialization succeeds.\n+                self.stop_node(1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1225864826",
      "id" : 1225864826,
      "line" : 117,
      "node_id" : "PRRC_kwDOABII585JETZ6",
      "original_commit_id" : "38bc46316d6172bcd1fe40bda4d222c547350495",
      "original_line" : 117,
      "original_position" : 91,
      "original_start_line" : 111,
      "path" : "test/functional/feature_reindex.py",
      "position" : 91,
      "pull_request_review_id" : 1473519529,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225864826/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 111,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-11T17:02:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225864826",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2023-06-12T10:07:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1587015221",
      "id" : 1587015221,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585el-41",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1587015221/reactions"
      },
      "updated_at" : "2023-06-12T10:07:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1587015221",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1227001555"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227001555"
         }
      },
      "author_association" : "MEMBER",
      "body" : "thanks ð ",
      "commit_id" : "ae4d5f5f947ec236c43e6288589ddf58f7d26b89",
      "created_at" : "2023-06-12T17:20:21Z",
      "diff_hunk" : "@@ -86,4 +87,70 @@ BOOST_FIXTURE_TEST_CASE(blockmanager_scan_unlink_already_pruned_files, TestChain\n     BOOST_CHECK(!AutoFile(blockman.OpenBlockFile(new_pos, true)).IsNull());\n }\n \n+struct FastPruneTestingSetup : public BasicTestingSetup {\n+    FastPruneTestingSetup()\n+        : BasicTestingSetup{ChainType::MAIN, /*extra_args=*/{\"-fastprune=1\"}} {}\n+};\n+\n+BOOST_FIXTURE_TEST_CASE(blockmanager_flush_block_file, FastPruneTestingSetup)\n+{\n+    const auto params{CreateChainParams(ArgsManager{}, ChainType::MAIN)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1227001555",
      "id" : 1227001555,
      "in_reply_to_id" : 1225636430,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JIo7T",
      "original_commit_id" : "77bf6172a0974717606fb31aba2e88e716747eb8",
      "original_line" : 97,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/test/blockmanager_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1475448066,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227001555/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-12T17:20:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227001555",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1227790565"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227790565"
         }
      },
      "author_association" : "MEMBER",
      "body" : "shouldn't the messages be checked by `assert_start_raises_init_error` instead of reading the debug log?",
      "commit_id" : "ae4d5f5f947ec236c43e6288589ddf58f7d26b89",
      "created_at" : "2023-06-13T09:05:07Z",
      "diff_hunk" : "@@ -68,12 +73,47 @@ def find_block(b, start):\n             'LoadExternalBlockFile: Out of order block',\n             'LoadExternalBlockFile: Processing out of order child',\n         ]):\n-            extra_args = [[\"-reindex\"]]\n-            self.start_nodes(extra_args)\n+            self.start_node(0, extra_args=[\"-reindex\"])\n \n         # All blocks should be accepted and processed.\n         assert_equal(self.nodes[0].getblockcount(), 12)\n \n+    def reindex_readonly(self):\n+        self.connect_nodes(0, 1)\n+        addr = self.nodes[1].get_deterministic_priv_key().address\n+\n+        # generate enough blocks to ensure that the -fastprune node fills up the\n+        # first blk00000.dat file and starts another block file\n+\n+        # How big are empty regtest blocks?\n+        block_hash = self.generatetoaddress(self.nodes[1], 1, addr)[0]\n+        block_size = self.nodes[1].getblock(block_hash)[\"size\"]\n+        block_size += 8 # BLOCK_SERIALIZATION_HEADER_SIZE\n+\n+        # How many blocks do we need to roll over a new .blk file?\n+        block_count = self.nodes[1].getblockcount()\n+        fastprune_blockfile_size = 0x10000\n+        size_needed = fastprune_blockfile_size - (block_size * block_count)\n+        blocks_needed = size_needed // block_size\n+\n+        self.log.debug(\"Generate enough blocks to start second block file\")\n+        self.generatetoaddress(self.nodes[1], blocks_needed, addr)\n+        self.stop_node(1)\n+\n+        assert os.path.exists(self.nodes[1].chain_path / 'blocks' / 'blk00000.dat')\n+        assert os.path.exists(self.nodes[1].chain_path / 'blocks' / 'blk00001.dat')\n+\n+        self.log.debug(\"Make the first block file read-only\")\n+        filename = self.nodes[1].chain_path / 'blocks' / 'blk00000.dat'\n+        os.chmod(filename, stat.S_IREAD)\n+\n+        self.log.debug(\"Attempt to restart and reindex the node with the read-only block file\")\n+        with self.nodes[1].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1227790565",
      "id" : 1227790565,
      "line" : 117,
      "node_id" : "PRRC_kwDOABII585JLpjl",
      "original_commit_id" : "e01ac849efce23494e0b3fccb0e4f23a23875ac4",
      "original_line" : 117,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex.py",
      "position" : 90,
      "pull_request_review_id" : 1476644866,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227790565/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-13T21:19:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227790565",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1228189310"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228189310"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The actual error ends up being generic:\r\n\r\n```\r\nError: A fatal internal error occurred, see debug.log for details \r\n```\r\n\r\nand actually before #27708 was merged yesterday, this code was even more messy!\r\n",
      "commit_id" : "ae4d5f5f947ec236c43e6288589ddf58f7d26b89",
      "created_at" : "2023-06-13T14:05:17Z",
      "diff_hunk" : "@@ -68,12 +73,47 @@ def find_block(b, start):\n             'LoadExternalBlockFile: Out of order block',\n             'LoadExternalBlockFile: Processing out of order child',\n         ]):\n-            extra_args = [[\"-reindex\"]]\n-            self.start_nodes(extra_args)\n+            self.start_node(0, extra_args=[\"-reindex\"])\n \n         # All blocks should be accepted and processed.\n         assert_equal(self.nodes[0].getblockcount(), 12)\n \n+    def reindex_readonly(self):\n+        self.connect_nodes(0, 1)\n+        addr = self.nodes[1].get_deterministic_priv_key().address\n+\n+        # generate enough blocks to ensure that the -fastprune node fills up the\n+        # first blk00000.dat file and starts another block file\n+\n+        # How big are empty regtest blocks?\n+        block_hash = self.generatetoaddress(self.nodes[1], 1, addr)[0]\n+        block_size = self.nodes[1].getblock(block_hash)[\"size\"]\n+        block_size += 8 # BLOCK_SERIALIZATION_HEADER_SIZE\n+\n+        # How many blocks do we need to roll over a new .blk file?\n+        block_count = self.nodes[1].getblockcount()\n+        fastprune_blockfile_size = 0x10000\n+        size_needed = fastprune_blockfile_size - (block_size * block_count)\n+        blocks_needed = size_needed // block_size\n+\n+        self.log.debug(\"Generate enough blocks to start second block file\")\n+        self.generatetoaddress(self.nodes[1], blocks_needed, addr)\n+        self.stop_node(1)\n+\n+        assert os.path.exists(self.nodes[1].chain_path / 'blocks' / 'blk00000.dat')\n+        assert os.path.exists(self.nodes[1].chain_path / 'blocks' / 'blk00001.dat')\n+\n+        self.log.debug(\"Make the first block file read-only\")\n+        filename = self.nodes[1].chain_path / 'blocks' / 'blk00000.dat'\n+        os.chmod(filename, stat.S_IREAD)\n+\n+        self.log.debug(\"Attempt to restart and reindex the node with the read-only block file\")\n+        with self.nodes[1].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1228189310",
      "id" : 1228189310,
      "in_reply_to_id" : 1227790565,
      "line" : 117,
      "node_id" : "PRRC_kwDOABII585JNK5-",
      "original_commit_id" : "e01ac849efce23494e0b3fccb0e4f23a23875ac4",
      "original_line" : 117,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex.py",
      "position" : 90,
      "pull_request_review_id" : 1477268821,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228189310/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-13T19:23:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228189310",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I fixed the CI failures by skipping tasks that are run as root. Root privileges override the read-only file permissions and the test fails because we expect an error that doesn't throw (can not open read-only file in write mode).\r\n\r\nThere are 6 tasks that skip this test for this reason:\r\n\r\n[[ASan + LSan + UBSan + integer, no depends, USDT] [lunar]](https://cirrus-ci.com/task/5287333893767168?logs=ci#L4735)\r\n[[multiprocess, i686, DEBUG] [focal]](https://cirrus-ci.com/task/5005858917056512?logs=ci#L3740)\r\n[[previous releases, qt5 dev package and depends packages, DEBUG] [focal]](https://cirrus-ci.com/task/6553971288965120?logs=ci#L3894)\r\n[[TSan, depends, gui] [lunar]](https://cirrus-ci.com/task/4724383940345856?logs=ci#L4219)\r\n[32-bit + dash [gui] [CentOS 9]](https://cirrus-ci.com/task/5428071382122496?logs=ci#L4481)\r\n[[no wallet, libbitcoinkernel] [focal]](https://cirrus-ci.com/task/6131758823899136?logs=ci#L4653)",
      "created_at" : "2023-06-13T19:27:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1589897031",
      "id" : 1589897031,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585ew-dH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1589897031/reactions"
      },
      "updated_at" : "2023-06-14T00:01:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1589897031",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1228708244"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228708244"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah ok, then maybe check `Error: A fatal internal error occurred, see debug.log for details` as error message to provide context for test readers?",
      "commit_id" : "ae4d5f5f947ec236c43e6288589ddf58f7d26b89",
      "created_at" : "2023-06-13T21:19:49Z",
      "diff_hunk" : "@@ -68,12 +73,47 @@ def find_block(b, start):\n             'LoadExternalBlockFile: Out of order block',\n             'LoadExternalBlockFile: Processing out of order child',\n         ]):\n-            extra_args = [[\"-reindex\"]]\n-            self.start_nodes(extra_args)\n+            self.start_node(0, extra_args=[\"-reindex\"])\n \n         # All blocks should be accepted and processed.\n         assert_equal(self.nodes[0].getblockcount(), 12)\n \n+    def reindex_readonly(self):\n+        self.connect_nodes(0, 1)\n+        addr = self.nodes[1].get_deterministic_priv_key().address\n+\n+        # generate enough blocks to ensure that the -fastprune node fills up the\n+        # first blk00000.dat file and starts another block file\n+\n+        # How big are empty regtest blocks?\n+        block_hash = self.generatetoaddress(self.nodes[1], 1, addr)[0]\n+        block_size = self.nodes[1].getblock(block_hash)[\"size\"]\n+        block_size += 8 # BLOCK_SERIALIZATION_HEADER_SIZE\n+\n+        # How many blocks do we need to roll over a new .blk file?\n+        block_count = self.nodes[1].getblockcount()\n+        fastprune_blockfile_size = 0x10000\n+        size_needed = fastprune_blockfile_size - (block_size * block_count)\n+        blocks_needed = size_needed // block_size\n+\n+        self.log.debug(\"Generate enough blocks to start second block file\")\n+        self.generatetoaddress(self.nodes[1], blocks_needed, addr)\n+        self.stop_node(1)\n+\n+        assert os.path.exists(self.nodes[1].chain_path / 'blocks' / 'blk00000.dat')\n+        assert os.path.exists(self.nodes[1].chain_path / 'blocks' / 'blk00001.dat')\n+\n+        self.log.debug(\"Make the first block file read-only\")\n+        filename = self.nodes[1].chain_path / 'blocks' / 'blk00000.dat'\n+        os.chmod(filename, stat.S_IREAD)\n+\n+        self.log.debug(\"Attempt to restart and reindex the node with the read-only block file\")\n+        with self.nodes[1].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1228708244",
      "id" : 1228708244,
      "in_reply_to_id" : 1227790565,
      "line" : 117,
      "node_id" : "PRRC_kwDOABII585JPJmU",
      "original_commit_id" : "e01ac849efce23494e0b3fccb0e4f23a23875ac4",
      "original_line" : 117,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex.py",
      "position" : 90,
      "pull_request_review_id" : 1478070141,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228708244/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-13T21:19:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228708244",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1228823625"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228823625"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done, thanks",
      "commit_id" : "ae4d5f5f947ec236c43e6288589ddf58f7d26b89",
      "created_at" : "2023-06-14T00:02:07Z",
      "diff_hunk" : "@@ -68,12 +73,47 @@ def find_block(b, start):\n             'LoadExternalBlockFile: Out of order block',\n             'LoadExternalBlockFile: Processing out of order child',\n         ]):\n-            extra_args = [[\"-reindex\"]]\n-            self.start_nodes(extra_args)\n+            self.start_node(0, extra_args=[\"-reindex\"])\n \n         # All blocks should be accepted and processed.\n         assert_equal(self.nodes[0].getblockcount(), 12)\n \n+    def reindex_readonly(self):\n+        self.connect_nodes(0, 1)\n+        addr = self.nodes[1].get_deterministic_priv_key().address\n+\n+        # generate enough blocks to ensure that the -fastprune node fills up the\n+        # first blk00000.dat file and starts another block file\n+\n+        # How big are empty regtest blocks?\n+        block_hash = self.generatetoaddress(self.nodes[1], 1, addr)[0]\n+        block_size = self.nodes[1].getblock(block_hash)[\"size\"]\n+        block_size += 8 # BLOCK_SERIALIZATION_HEADER_SIZE\n+\n+        # How many blocks do we need to roll over a new .blk file?\n+        block_count = self.nodes[1].getblockcount()\n+        fastprune_blockfile_size = 0x10000\n+        size_needed = fastprune_blockfile_size - (block_size * block_count)\n+        blocks_needed = size_needed // block_size\n+\n+        self.log.debug(\"Generate enough blocks to start second block file\")\n+        self.generatetoaddress(self.nodes[1], blocks_needed, addr)\n+        self.stop_node(1)\n+\n+        assert os.path.exists(self.nodes[1].chain_path / 'blocks' / 'blk00000.dat')\n+        assert os.path.exists(self.nodes[1].chain_path / 'blocks' / 'blk00001.dat')\n+\n+        self.log.debug(\"Make the first block file read-only\")\n+        filename = self.nodes[1].chain_path / 'blocks' / 'blk00000.dat'\n+        os.chmod(filename, stat.S_IREAD)\n+\n+        self.log.debug(\"Attempt to restart and reindex the node with the read-only block file\")\n+        with self.nodes[1].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1228823625",
      "id" : 1228823625,
      "in_reply_to_id" : 1227790565,
      "line" : 117,
      "node_id" : "PRRC_kwDOABII585JPlxJ",
      "original_commit_id" : "e01ac849efce23494e0b3fccb0e4f23a23875ac4",
      "original_line" : 117,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex.py",
      "position" : 90,
      "pull_request_review_id" : 1478232934,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228823625/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-14T00:02:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1228823625",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ready for review now, CI is passing modulo https://github.com/bitcoin/bitcoin/issues/27879",
      "created_at" : "2023-06-14T11:17:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1590996951",
      "id" : 1590996951,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585e1K_X",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1590996951/reactions"
      },
      "updated_at" : "2023-06-14T11:17:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1590996951",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Just curious, did you try using `chattr +i` to set blockfile as *_immutable_* ? May break other stuff, I don't know...\r\n\r\nSeems a shame to miss linux out.\r\n\r\nref: https://man7.org/linux/man-pages/man1/chattr.1.html",
      "created_at" : "2023-06-14T12:07:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1591066861",
      "id" : 1591066861,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585e1cDt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591066861/reactions"
      },
      "updated_at" : "2023-06-14T12:07:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591066861",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Just curious, did you try using `chattr +i` to set blockfile as __immutable__ ? May break other stuff, I don't know...\r\n\r\nBold strategy, Cotton let's see if it pays off: cd394b637f",
      "created_at" : "2023-06-14T14:13:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1591294104",
      "id" : 1591294104,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585e2TiY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 1,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591294104/reactions"
      },
      "updated_at" : "2023-06-14T14:13:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591294104",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> > Just curious, did you try using `chattr +i` to set blockfile as **immutable** ? May break other stuff, I don't know...\r\n> \r\n> Bold strategy, Cotton let's see if it pays off: [cd394b6](https://github.com/bitcoin/bitcoin/commit/cd394b637f98b79dc3a4623ec4b970137ee2c589)\r\n\r\n_Narrator: \"It didn't.\"_ https://cirrus-ci.com/build/4907092587315200\r\n\r\nSeemed like a good idea though but bitcoind is still able to open the \"immutable\" files in write mode ð¤ \r\n\r\nMaybe @MarcoFalke can help us figure out a better method. Doesn't seem like a terrible idea to run a few CI tasks as a user instead of root? There might be other little behaviors like this one.",
      "created_at" : "2023-06-14T18:15:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1591767561",
      "id" : 1591767561,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585e4HIJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591767561/reactions"
      },
      "updated_at" : "2023-06-14T18:15:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1591767561",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If you want to add a user account for this, you can try reverting https://github.com/bitcoin/bitcoin/pull/27376\r\n\r\nEdit: Sorry, this is not reliable. See https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1236437366",
      "created_at" : "2023-06-15T06:09:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1592425134",
      "id" : 1592425134,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585e6nqu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1592425134/reactions"
      },
      "updated_at" : "2023-06-21T07:34:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1592425134",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke \r\n\r\n> If you want to add a user account for this, you can try reverting #27376\r\n\r\nI've been banging on this for a few days and I think I see the issue now: since https://github.com/bitcoin/bitcoin/pull/21619 we set `DANGER_RUN_CI_ON_HOST: \"1\"` meaning all the nonroot user stuff I tried adding back in from #27376 gets skipped anyway (because it was all docker configuration and this flag skips docker entirely). I tried just now reverting that single flag which results in every unit crashing with `docker not found`\r\n\r\nSo, (cc: @willcl-ark) I can continue down this path of trying to get a non-root user running on CI, or I can go back to \"skip test if root\" in python.",
      "created_at" : "2023-06-20T20:27:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1599451224",
      "id" : 1599451224,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585fVbBY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1599451224/reactions"
      },
      "updated_at" : "2023-06-20T21:40:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1599451224",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1236437366"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1236437366"
         }
      },
      "author_association" : "MEMBER",
      "body" : "On a second thought, I don't think we can rely (or assert) in the tests that they are not run as root. Anyone should be free to run the tests where they want, also as root.",
      "commit_id" : "0447b1c8c3e2a7b7bb255379820a784c67812a1e",
      "created_at" : "2023-06-21T06:23:58Z",
      "diff_hunk" : "@@ -68,12 +73,50 @@ def find_block(b, start):\n             'LoadExternalBlockFile: Out of order block',\n             'LoadExternalBlockFile: Processing out of order child',\n         ]):\n-            extra_args = [[\"-reindex\"]]\n-            self.start_nodes(extra_args)\n+            self.start_node(0, extra_args=[\"-reindex\"])\n \n         # All blocks should be accepted and processed.\n         assert_equal(self.nodes[0].getblockcount(), 12)\n \n+    def reindex_readonly(self):\n+        # Root user overrides read-only file permissions, breaking test (not an issue on Windows).\n+        if os.name != 'nt':\n+            assert os.getuid() != 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1236437366",
      "id" : 1236437366,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Jsol2",
      "original_commit_id" : "8d874ba1441a1e89455f1f7b39ac8fe4f7140f94",
      "original_line" : 84,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex.py",
      "position" : null,
      "pull_request_review_id" : 1489849046,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1236437366/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-21T06:23:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1236437366",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1237078338"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237078338"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh yeah this is obviously an important point. Lots of users probably run bitcoind as root on a VPS and they should be able to run all tests.",
      "commit_id" : "0447b1c8c3e2a7b7bb255379820a784c67812a1e",
      "created_at" : "2023-06-21T14:15:14Z",
      "diff_hunk" : "@@ -68,12 +73,50 @@ def find_block(b, start):\n             'LoadExternalBlockFile: Out of order block',\n             'LoadExternalBlockFile: Processing out of order child',\n         ]):\n-            extra_args = [[\"-reindex\"]]\n-            self.start_nodes(extra_args)\n+            self.start_node(0, extra_args=[\"-reindex\"])\n \n         # All blocks should be accepted and processed.\n         assert_equal(self.nodes[0].getblockcount(), 12)\n \n+    def reindex_readonly(self):\n+        # Root user overrides read-only file permissions, breaking test (not an issue on Windows).\n+        if os.name != 'nt':\n+            assert os.getuid() != 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1237078338",
      "id" : 1237078338,
      "in_reply_to_id" : 1236437366,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JvFFC",
      "original_commit_id" : "8d874ba1441a1e89455f1f7b39ac8fe4f7140f94",
      "original_line" : 84,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex.py",
      "position" : null,
      "pull_request_review_id" : 1490867970,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237078338/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-21T14:15:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237078338",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1237246441"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237246441"
         }
      },
      "author_association" : "MEMBER",
      "body" : "style nit: Can be written shorter and without an include:\r\n\r\n```suggestion\r\n        assert (self.nodes[1].chain_path / \"blocks\" / \"blk00000.dat\").exists()\r\n```\r\n\r\nSee https://docs.python.org/3/library/pathlib.html#correspondence-to-tools-in-the-os-module",
      "commit_id" : "0447b1c8c3e2a7b7bb255379820a784c67812a1e",
      "created_at" : "2023-06-21T16:01:48Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test running bitcoind with -reindex from a read-only blockstore\n+- Start two nodes, generate blocks, then restart with -reindex after setting blk files to read-only\n+\"\"\"\n+\n+import os\n+import stat\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+\n+class BlockstoreReindexTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [],\n+            [\"-fastprune\"]\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_root()\n+\n+    def reindex_readonly(self):\n+        self.connect_nodes(0, 1)\n+        addr = self.nodes[1].get_deterministic_priv_key().address\n+\n+        # generate enough blocks to ensure that the -fastprune node fills up the\n+        # first blk00000.dat file and starts another block file\n+\n+        # How big are empty regtest blocks?\n+        block_hash = self.generatetoaddress(self.nodes[1], 1, addr)[0]\n+        block_size = self.nodes[1].getblock(block_hash)[\"size\"]\n+        block_size += 8 # BLOCK_SERIALIZATION_HEADER_SIZE\n+\n+        # How many blocks do we need to roll over a new .blk file?\n+        block_count = self.nodes[1].getblockcount()\n+        fastprune_blockfile_size = 0x10000\n+        size_needed = fastprune_blockfile_size - (block_size * block_count)\n+        blocks_needed = size_needed // block_size\n+\n+        self.log.debug(\"Generate enough blocks to start second block file\")\n+        self.generatetoaddress(self.nodes[1], blocks_needed, addr)\n+        self.stop_node(1)\n+\n+        assert os.path.exists(self.nodes[1].chain_path / 'blocks' / 'blk00000.dat')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1237246441",
      "id" : 1237246441,
      "line" : 48,
      "node_id" : "PRRC_kwDOABII585JvuHp",
      "original_commit_id" : "0447b1c8c3e2a7b7bb255379820a784c67812a1e",
      "original_line" : 48,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "test/functional/blockstore_reindex.py",
      "position" : 48,
      "pull_request_review_id" : 1491152707,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237246441/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-21T16:01:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237246441",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1237247945"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237247945"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why not simply call this feature_reindex_readonly to avoid introducing a new category?",
      "commit_id" : "0447b1c8c3e2a7b7bb255379820a784c67812a1e",
      "created_at" : "2023-06-21T16:02:57Z",
      "diff_hunk" : "@@ -160,6 +160,7 @@\n     'wallet_abandonconflict.py --legacy-wallet',\n     'wallet_abandonconflict.py --descriptors',\n     'feature_reindex.py',\n+    'blockstore_reindex.py',",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1237247945",
      "id" : 1237247945,
      "line" : 163,
      "node_id" : "PRRC_kwDOABII585JvufJ",
      "original_commit_id" : "0447b1c8c3e2a7b7bb255379820a784c67812a1e",
      "original_line" : 163,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_runner.py",
      "position" : 4,
      "pull_request_review_id" : 1491154907,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237247945/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-21T16:02:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237247945",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1237329812"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237329812"
         }
      },
      "author_association" : "MEMBER",
      "body" : "awesome thanks",
      "commit_id" : "0447b1c8c3e2a7b7bb255379820a784c67812a1e",
      "created_at" : "2023-06-21T17:10:04Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test running bitcoind with -reindex from a read-only blockstore\n+- Start two nodes, generate blocks, then restart with -reindex after setting blk files to read-only\n+\"\"\"\n+\n+import os\n+import stat\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+\n+class BlockstoreReindexTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [],\n+            [\"-fastprune\"]\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_root()\n+\n+    def reindex_readonly(self):\n+        self.connect_nodes(0, 1)\n+        addr = self.nodes[1].get_deterministic_priv_key().address\n+\n+        # generate enough blocks to ensure that the -fastprune node fills up the\n+        # first blk00000.dat file and starts another block file\n+\n+        # How big are empty regtest blocks?\n+        block_hash = self.generatetoaddress(self.nodes[1], 1, addr)[0]\n+        block_size = self.nodes[1].getblock(block_hash)[\"size\"]\n+        block_size += 8 # BLOCK_SERIALIZATION_HEADER_SIZE\n+\n+        # How many blocks do we need to roll over a new .blk file?\n+        block_count = self.nodes[1].getblockcount()\n+        fastprune_blockfile_size = 0x10000\n+        size_needed = fastprune_blockfile_size - (block_size * block_count)\n+        blocks_needed = size_needed // block_size\n+\n+        self.log.debug(\"Generate enough blocks to start second block file\")\n+        self.generatetoaddress(self.nodes[1], blocks_needed, addr)\n+        self.stop_node(1)\n+\n+        assert os.path.exists(self.nodes[1].chain_path / 'blocks' / 'blk00000.dat')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1237329812",
      "id" : 1237329812,
      "in_reply_to_id" : 1237246441,
      "line" : 48,
      "node_id" : "PRRC_kwDOABII585JwCeU",
      "original_commit_id" : "0447b1c8c3e2a7b7bb255379820a784c67812a1e",
      "original_line" : 48,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "test/functional/blockstore_reindex.py",
      "position" : 48,
      "pull_request_review_id" : 1491290848,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237329812/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-21T17:10:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237329812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1237330831"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237330831"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'll revert but I guess I was thinking that the new test isn't really about the reindexing feature, it's more like a blockstore unit test",
      "commit_id" : "0447b1c8c3e2a7b7bb255379820a784c67812a1e",
      "created_at" : "2023-06-21T17:10:43Z",
      "diff_hunk" : "@@ -160,6 +160,7 @@\n     'wallet_abandonconflict.py --legacy-wallet',\n     'wallet_abandonconflict.py --descriptors',\n     'feature_reindex.py',\n+    'blockstore_reindex.py',",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1237330831",
      "id" : 1237330831,
      "in_reply_to_id" : 1237247945,
      "line" : 163,
      "node_id" : "PRRC_kwDOABII585JwCuP",
      "original_commit_id" : "0447b1c8c3e2a7b7bb255379820a784c67812a1e",
      "original_line" : 163,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_runner.py",
      "position" : 4,
      "pull_request_review_id" : 1491292675,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237330831/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-21T17:10:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237330831",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "push to 28c6a7d5a2d85f5f5b99e21925f9fd966eaa347f addresses @MarcoFalke nits (thank you!) and also adds a commit to run functional tests as a non-root user on CI. This works locally, so fingers crossed it works on actual ci as well.\r\n\r\nNote that without that commit, the blockstore test gets skipped: https://cirrus-ci.com/task/5520869955469312?logs=ci#L3423\r\n\r\nso we'll see if it passes nice n clean on this run...",
      "created_at" : "2023-06-21T18:19:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1601359252",
      "id" : 1601359252,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585fcs2U",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1601359252/reactions"
      },
      "updated_at" : "2023-06-21T18:19:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1601359252",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1238647250"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238647250"
         }
      },
      "author_association" : "MEMBER",
      "body" : "if macos is the only failure, it might be good enough to guard it instead of adding a new global CI setting?",
      "commit_id" : "8e13908011b9fd5ffaadd3f8d4113685a312905c",
      "created_at" : "2023-06-22T14:51:25Z",
      "diff_hunk" : "@@ -39,6 +39,7 @@ export USE_BUSY_BOX=${USE_BUSY_BOX:-false}\n export RUN_UNIT_TESTS=${RUN_UNIT_TESTS:-true}\n export RUN_FUNCTIONAL_TESTS=${RUN_FUNCTIONAL_TESTS:-true}\n export RUN_TIDY=${RUN_TIDY:-false}\n+export CREATE_NONROOT_USER=${CREATE_NONROOT_USER:-true}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1238647250",
      "id" : 1238647250,
      "line" : 42,
      "node_id" : "PRRC_kwDOABII585J1EHS",
      "original_commit_id" : "8e13908011b9fd5ffaadd3f8d4113685a312905c",
      "original_line" : 42,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "ci/test/00_setup_env.sh",
      "position" : 4,
      "pull_request_review_id" : 1493386115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238647250/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-22T14:53:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238647250",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1238648921"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238648921"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Could make sense to call `echo > \"${HOME}/.bitcoin\"` for nonroot as well?",
      "commit_id" : "8e13908011b9fd5ffaadd3f8d4113685a312905c",
      "created_at" : "2023-06-22T14:52:20Z",
      "diff_hunk" : "@@ -8,6 +8,14 @@ export LC_ALL=C.UTF-8\n \n set -ex\n \n+# Create a non-root user to run certain tests\n+if [ \"$CREATE_NONROOT_USER\" = \"true\" ]; then\n+  useradd nonroot\n+  usermod -a -G root nonroot\n+  export NONROOT_PREFIX=\"su nonroot\"\n+  export NONROOT_PERMISSIONS=\"chmod -R g+rwx ${BASE_ROOT_DIR}\"\n+fi",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1238648921",
      "id" : 1238648921,
      "line" : 17,
      "node_id" : "PRRC_kwDOABII585J1EhZ",
      "original_commit_id" : "8e13908011b9fd5ffaadd3f8d4113685a312905c",
      "original_line" : 17,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "ci/test/06_script_b.sh",
      "position" : 10,
      "pull_request_review_id" : 1493386115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238648921/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-22T14:53:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238648921",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1238667771"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238667771"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok gotcha, will update",
      "commit_id" : "8e13908011b9fd5ffaadd3f8d4113685a312905c",
      "created_at" : "2023-06-22T15:04:29Z",
      "diff_hunk" : "@@ -39,6 +39,7 @@ export USE_BUSY_BOX=${USE_BUSY_BOX:-false}\n export RUN_UNIT_TESTS=${RUN_UNIT_TESTS:-true}\n export RUN_FUNCTIONAL_TESTS=${RUN_FUNCTIONAL_TESTS:-true}\n export RUN_TIDY=${RUN_TIDY:-false}\n+export CREATE_NONROOT_USER=${CREATE_NONROOT_USER:-true}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1238667771",
      "id" : 1238667771,
      "in_reply_to_id" : 1238647250,
      "line" : 42,
      "node_id" : "PRRC_kwDOABII585J1JH7",
      "original_commit_id" : "8e13908011b9fd5ffaadd3f8d4113685a312905c",
      "original_line" : 42,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "ci/test/00_setup_env.sh",
      "position" : 4,
      "pull_request_review_id" : 1493432085,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238667771/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-22T15:04:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238667771",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1238668151"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238668151"
         }
      },
      "author_association" : "MEMBER",
      "body" : "~sorry, I don't understand this, echo to a directory?~\r\n\r\naha, I get it, will  do:\r\n`# Make sure default datadir does not exist and is never read by creating a dummy file`",
      "commit_id" : "0285c62d9bfcf0aa03d3aa3dfc834c78cf615040",
      "created_at" : "2023-06-22T15:04:46Z",
      "diff_hunk" : "@@ -8,6 +8,14 @@ export LC_ALL=C.UTF-8\n \n set -ex\n \n+# Create a non-root user to run certain tests\n+if [ \"$CREATE_NONROOT_USER\" = \"true\" ]; then\n+  useradd nonroot\n+  usermod -a -G root nonroot\n+  export NONROOT_PREFIX=\"su nonroot\"\n+  export NONROOT_PERMISSIONS=\"chmod -R g+rwx ${BASE_ROOT_DIR}\"\n+fi",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1238668151",
      "id" : 1238668151,
      "in_reply_to_id" : 1238648921,
      "line" : 18,
      "node_id" : "PRRC_kwDOABII585J1JN3",
      "original_commit_id" : "8e13908011b9fd5ffaadd3f8d4113685a312905c",
      "original_line" : 18,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "ci/test/06_script_b.sh",
      "position" : 11,
      "pull_request_review_id" : 1493432686,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238668151/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-22T16:31:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238668151",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1239470506"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239470506"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: May be good to not duplicate this comment and locate the logic in two different places. I guess you can move-only the other thing up?",
      "commit_id" : "0285c62d9bfcf0aa03d3aa3dfc834c78cf615040",
      "created_at" : "2023-06-23T07:28:41Z",
      "diff_hunk" : "@@ -8,6 +8,16 @@ export LC_ALL=C.UTF-8\n \n set -ex\n \n+# Create a non-root user to run certain tests\n+if [ \"$CI_OS_NAME\" != \"macos\" ]; then\n+  useradd -m nonroot\n+  usermod -a -G root nonroot\n+  export NONROOT_PREFIX=\"su nonroot\"\n+  export NONROOT_PERMISSIONS=\"chmod -R g+rwx ${BASE_ROOT_DIR}\"\n+  # Make sure default datadir does not exist and is never read by creating a dummy file",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1239470506",
      "id" : 1239470506,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585J4NGq",
      "original_commit_id" : "855e6115e2c0c7bd43f459e1eebb276dd47c6a33",
      "original_line" : 17,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "ci/test/06_script_b.sh",
      "position" : null,
      "pull_request_review_id" : 1494611977,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239470506/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-23T07:28:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239470506",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1239761122"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239761122"
         }
      },
      "author_association" : "MEMBER",
      "body" : "good call, I'll repeat the pattern of defining nonroot commands here on top but executing them where its appropriate below...\r\n\r\n\r\n```diff\r\ndiff --git a/ci/test/06_script_b.sh b/ci/test/06_script_b.sh\r\nindex 39a84b4fcf..1e8fc5ade9 100755\r\n--- a/ci/test/06_script_b.sh\r\n+++ b/ci/test/06_script_b.sh\r\n@@ -14,8 +14,7 @@ if [ \"$CI_OS_NAME\" != \"macos\" ]; then\r\n   usermod -a -G root nonroot\r\n   export NONROOT_PREFIX=\"su nonroot\"\r\n   export NONROOT_PERMISSIONS=\"chmod -R g+rwx ${BASE_ROOT_DIR}\"\r\n-  # Make sure default datadir does not exist and is never read by creating a dummy file\r\n-  echo > ~nonroot/.bitcoin\r\n+  export NONROOT_DUMMY_DIR=\"echo > ~nonroot/.bitcoin\"\r\n fi\r\n \r\n if [ \"$CI_OS_NAME\" == \"macos\" ]; then\r\n@@ -63,6 +62,7 @@ if [ \"$CI_OS_NAME\" == \"macos\" ]; then\r\n   echo > \"${HOME}/Library/Application Support/Bitcoin\"\r\n else\r\n   echo > \"${HOME}/.bitcoin\"\r\n+  ${NONROOT_DUMMY_DIR}\r\n fi\r\n \r\n if [ -z \"$NO_DEPENDS\" ]; then\r\n```",
      "commit_id" : "0285c62d9bfcf0aa03d3aa3dfc834c78cf615040",
      "created_at" : "2023-06-23T12:33:08Z",
      "diff_hunk" : "@@ -8,6 +8,16 @@ export LC_ALL=C.UTF-8\n \n set -ex\n \n+# Create a non-root user to run certain tests\n+if [ \"$CI_OS_NAME\" != \"macos\" ]; then\n+  useradd -m nonroot\n+  usermod -a -G root nonroot\n+  export NONROOT_PREFIX=\"su nonroot\"\n+  export NONROOT_PERMISSIONS=\"chmod -R g+rwx ${BASE_ROOT_DIR}\"\n+  # Make sure default datadir does not exist and is never read by creating a dummy file",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1239761122",
      "id" : 1239761122,
      "in_reply_to_id" : 1239470506,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585J5UDi",
      "original_commit_id" : "855e6115e2c0c7bd43f459e1eebb276dd47c6a33",
      "original_line" : 17,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "ci/test/06_script_b.sh",
      "position" : null,
      "pull_request_review_id" : 1495056002,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239761122/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-23T12:33:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239761122",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke @ryanofsky this is ready for review if you have time ðº ",
      "created_at" : "2023-07-03T17:13:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1618905687",
      "id" : 1618905687,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585gfopX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1618905687/reactions"
      },
      "updated_at" : "2023-07-03T17:13:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1618905687",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-07-06T22:04:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1624366522",
      "id" : 1624366522,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585g0d26",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1624366522/reactions"
      },
      "updated_at" : "2023-07-06T22:04:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1624366522",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> ð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\r\n\r\nThanks handsome bot! ð¦ ",
      "created_at" : "2023-07-07T14:27:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1625497339",
      "id" : 1625497339,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585g4x77",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1625497339/reactions"
      },
      "updated_at" : "2023-07-07T14:27:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1625497339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1258364600"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1258364600"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"init: start indexes sync earlier\" (ed4462cc78afd2065bbf5bd79728852b65b9ad7f)\r\n\r\nNice test. Blockman API is really confusing but the comments here make everything very clear, and having the test should make improvements easier to understand, and help ensure things don't get broken unintentionally.",
      "commit_id" : "fe9da891eb7a7440b6c23d63e129525fe26f8f0e",
      "created_at" : "2023-07-10T14:35:28Z",
      "diff_hunk" : "@@ -90,4 +91,71 @@ BOOST_FIXTURE_TEST_CASE(blockmanager_scan_unlink_already_pruned_files, TestChain\n     BOOST_CHECK(!AutoFile(blockman.OpenBlockFile(new_pos, true)).IsNull());\n }\n \n+struct FastPruneTestingSetup : public BasicTestingSetup {\n+    FastPruneTestingSetup()\n+        : BasicTestingSetup{ChainType::MAIN, /*extra_args=*/{\"-fastprune=1\"}} {}\n+};\n+\n+BOOST_FIXTURE_TEST_CASE(blockmanager_flush_block_file, FastPruneTestingSetup)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1258364600",
      "id" : 1258364600,
      "line" : 99,
      "node_id" : "PRRC_kwDOABII585LAR64",
      "original_commit_id" : "2b624780b601be60700a27f893d24c0e8a11cd41",
      "original_line" : 99,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/test/blockmanager_tests.cpp",
      "position" : 17,
      "pull_request_review_id" : 1522239261,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1258364600/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-10T15:01:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1258364600",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-07-10T17:30:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1629407909",
      "id" : 1629407909,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585hHsql",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1629407909/reactions"
      },
      "updated_at" : "2023-07-10T17:30:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1629407909",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1262301743"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262301743"
         }
      },
      "author_association" : "MEMBER",
      "body" : "2b624780b601be60700a27f893d24c0e8a11cd41: Can remove this `struct`, no? Otherwise I'd like to understand why it is needed and why it works. The `-fastprune=1` you pass isn't picked up by `blockman_opts`.",
      "commit_id" : "fe9da891eb7a7440b6c23d63e129525fe26f8f0e",
      "created_at" : "2023-07-13T09:39:11Z",
      "diff_hunk" : "@@ -90,4 +91,71 @@ BOOST_FIXTURE_TEST_CASE(blockmanager_scan_unlink_already_pruned_files, TestChain\n     BOOST_CHECK(!AutoFile(blockman.OpenBlockFile(new_pos, true)).IsNull());\n }\n \n+struct FastPruneTestingSetup : public BasicTestingSetup {\n+    FastPruneTestingSetup()\n+        : BasicTestingSetup{ChainType::MAIN, /*extra_args=*/{\"-fastprune=1\"}} {}\n+};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1262301743",
      "id" : 1262301743,
      "line" : 97,
      "node_id" : "PRRC_kwDOABII585LPTIv",
      "original_commit_id" : "2b624780b601be60700a27f893d24c0e8a11cd41",
      "original_line" : 97,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/test/blockmanager_tests.cpp",
      "position" : 15,
      "pull_request_review_id" : 1528038830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262301743/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T10:07:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262301743",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1262326358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262326358"
         }
      },
      "author_association" : "MEMBER",
      "body" : "d82a493ed9570e36d45ce0619691f958fad8429a: Agree with ryan that this can be run on root as well, also the function `skip_if_root` seems confusing, due to the windows handling (at least to me).\r\n\r\nMight be better to just put a `if (root...):` guard in this line in this file only?",
      "commit_id" : "fe9da891eb7a7440b6c23d63e129525fe26f8f0e",
      "created_at" : "2023-07-13T09:58:18Z",
      "diff_hunk" : "@@ -0,0 +1,63 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test running bitcoind with -reindex from a read-only blockstore\n+- Start two nodes, generate blocks, then restart with -reindex after setting blk files to read-only\n+\"\"\"\n+\n+import stat\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+\n+class BlockstoreReindexTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [],\n+            [\"-fastprune\"]\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_root()\n+\n+    def reindex_readonly(self):\n+        self.connect_nodes(0, 1)\n+        addr = self.nodes[1].get_deterministic_priv_key().address\n+\n+        # generate enough blocks to ensure that the -fastprune node fills up the\n+        # first blk00000.dat file and starts another block file\n+\n+        # How big are empty regtest blocks?\n+        block_hash = self.generatetoaddress(self.nodes[1], 1, addr)[0]\n+        block_size = self.nodes[1].getblock(block_hash)[\"size\"]\n+        block_size += 8 # BLOCK_SERIALIZATION_HEADER_SIZE\n+\n+        # How many blocks do we need to roll over a new .blk file?\n+        block_count = self.nodes[1].getblockcount()\n+        fastprune_blockfile_size = 0x10000\n+        size_needed = fastprune_blockfile_size - (block_size * block_count)\n+        blocks_needed = size_needed // block_size\n+\n+        self.log.debug(\"Generate enough blocks to start second block file\")\n+        self.generatetoaddress(self.nodes[1], blocks_needed, addr)\n+        self.stop_node(1)\n+\n+        assert (self.nodes[1].chain_path / \"blocks\" / \"blk00000.dat\").exists()\n+        assert (self.nodes[1].chain_path / \"blocks\" / \"blk00001.dat\").exists()\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1262326358",
      "id" : 1262326358,
      "line" : 49,
      "node_id" : "PRRC_kwDOABII585LPZJW",
      "original_commit_id" : "d82a493ed9570e36d45ce0619691f958fad8429a",
      "original_line" : 49,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex_readonly.py",
      "position" : 49,
      "pull_request_review_id" : 1528038830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262326358/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T10:07:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262326358",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1262327787"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262327787"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Might be better to just assert this is `1`, or omit, as otherwise it would lead to issues anyway?",
      "commit_id" : "fe9da891eb7a7440b6c23d63e129525fe26f8f0e",
      "created_at" : "2023-07-13T09:59:28Z",
      "diff_hunk" : "@@ -0,0 +1,63 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test running bitcoind with -reindex from a read-only blockstore\n+- Start two nodes, generate blocks, then restart with -reindex after setting blk files to read-only\n+\"\"\"\n+\n+import stat\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+\n+class BlockstoreReindexTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [],\n+            [\"-fastprune\"]\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_root()\n+\n+    def reindex_readonly(self):\n+        self.connect_nodes(0, 1)\n+        addr = self.nodes[1].get_deterministic_priv_key().address\n+\n+        # generate enough blocks to ensure that the -fastprune node fills up the\n+        # first blk00000.dat file and starts another block file\n+\n+        # How big are empty regtest blocks?\n+        block_hash = self.generatetoaddress(self.nodes[1], 1, addr)[0]\n+        block_size = self.nodes[1].getblock(block_hash)[\"size\"]\n+        block_size += 8 # BLOCK_SERIALIZATION_HEADER_SIZE\n+\n+        # How many blocks do we need to roll over a new .blk file?\n+        block_count = self.nodes[1].getblockcount()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1262327787",
      "id" : 1262327787,
      "line" : 38,
      "node_id" : "PRRC_kwDOABII585LPZfr",
      "original_commit_id" : "d82a493ed9570e36d45ce0619691f958fad8429a",
      "original_line" : 38,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex_readonly.py",
      "position" : 38,
      "pull_request_review_id" : 1528038830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262327787/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T10:07:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262327787",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1262331864"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262331864"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason to use this, as it's length may change and break the test? I wonder if the test runs faster if you just bloat each block with 1MB of nulldata?\r\n\r\nSomething like: `d=999*\"ff\";generateblock(output=f\"raw(6a{d})\", tx=[]);`?",
      "commit_id" : "fe9da891eb7a7440b6c23d63e129525fe26f8f0e",
      "created_at" : "2023-07-13T10:02:51Z",
      "diff_hunk" : "@@ -0,0 +1,63 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test running bitcoind with -reindex from a read-only blockstore\n+- Start two nodes, generate blocks, then restart with -reindex after setting blk files to read-only\n+\"\"\"\n+\n+import stat\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+\n+class BlockstoreReindexTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [],\n+            [\"-fastprune\"]\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_root()\n+\n+    def reindex_readonly(self):\n+        self.connect_nodes(0, 1)\n+        addr = self.nodes[1].get_deterministic_priv_key().address",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1262331864",
      "id" : 1262331864,
      "line" : 27,
      "node_id" : "PRRC_kwDOABII585LPafY",
      "original_commit_id" : "d82a493ed9570e36d45ce0619691f958fad8429a",
      "original_line" : 27,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex_readonly.py",
      "position" : 27,
      "pull_request_review_id" : 1528038830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262331864/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T10:08:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262331864",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1262333855"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262333855"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in fe9da891eb7a7440b6c23d63e129525fe26f8f0e: Can just inline `echo > ~nonroot/.bitcoin` directly?",
      "commit_id" : "fe9da891eb7a7440b6c23d63e129525fe26f8f0e",
      "created_at" : "2023-07-13T10:04:35Z",
      "diff_hunk" : "@@ -53,6 +62,7 @@ if [ \"$CI_OS_NAME\" == \"macos\" ]; then\n   echo > \"${HOME}/Library/Application Support/Bitcoin\"\n else\n   echo > \"${HOME}/.bitcoin\"\n+  ${NONROOT_DUMMY_DIR}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1262333855",
      "id" : 1262333855,
      "line" : 65,
      "node_id" : "PRRC_kwDOABII585LPa-f",
      "original_commit_id" : "fe9da891eb7a7440b6c23d63e129525fe26f8f0e",
      "original_line" : 65,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "ci/test/06_script_b.sh",
      "position" : 20,
      "pull_request_review_id" : 1528038830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262333855/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T10:07:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262333855",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1262338435"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262338435"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Shouldn't this use ceil instead of floor?",
      "commit_id" : "fe9da891eb7a7440b6c23d63e129525fe26f8f0e",
      "created_at" : "2023-07-13T10:08:52Z",
      "diff_hunk" : "@@ -0,0 +1,63 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test running bitcoind with -reindex from a read-only blockstore\n+- Start two nodes, generate blocks, then restart with -reindex after setting blk files to read-only\n+\"\"\"\n+\n+import stat\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+\n+class BlockstoreReindexTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [],\n+            [\"-fastprune\"]\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_root()\n+\n+    def reindex_readonly(self):\n+        self.connect_nodes(0, 1)\n+        addr = self.nodes[1].get_deterministic_priv_key().address\n+\n+        # generate enough blocks to ensure that the -fastprune node fills up the\n+        # first blk00000.dat file and starts another block file\n+\n+        # How big are empty regtest blocks?\n+        block_hash = self.generatetoaddress(self.nodes[1], 1, addr)[0]\n+        block_size = self.nodes[1].getblock(block_hash)[\"size\"]\n+        block_size += 8 # BLOCK_SERIALIZATION_HEADER_SIZE\n+\n+        # How many blocks do we need to roll over a new .blk file?\n+        block_count = self.nodes[1].getblockcount()\n+        fastprune_blockfile_size = 0x10000\n+        size_needed = fastprune_blockfile_size - (block_size * block_count)\n+        blocks_needed = size_needed // block_size",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1262338435",
      "id" : 1262338435,
      "line" : 41,
      "node_id" : "PRRC_kwDOABII585LPcGD",
      "original_commit_id" : "fe9da891eb7a7440b6c23d63e129525fe26f8f0e",
      "original_line" : 41,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex_readonly.py",
      "position" : 41,
      "pull_request_review_id" : 1528091365,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262338435/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T10:08:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1262338435",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1266840274"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1266840274"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 2b624780:\r\n\r\nnit: could also check the `ReadBlockFromDisk` bool return value.",
      "commit_id" : "fe9da891eb7a7440b6c23d63e129525fe26f8f0e",
      "created_at" : "2023-07-18T14:13:51Z",
      "diff_hunk" : "@@ -90,4 +91,71 @@ BOOST_FIXTURE_TEST_CASE(blockmanager_scan_unlink_already_pruned_files, TestChain\n     BOOST_CHECK(!AutoFile(blockman.OpenBlockFile(new_pos, true)).IsNull());\n }\n \n+struct FastPruneTestingSetup : public BasicTestingSetup {\n+    FastPruneTestingSetup()\n+        : BasicTestingSetup{ChainType::MAIN, /*extra_args=*/{\"-fastprune=1\"}} {}\n+};\n+\n+BOOST_FIXTURE_TEST_CASE(blockmanager_flush_block_file, FastPruneTestingSetup)\n+{\n+    KernelNotifications notifications{m_node.exit_status};\n+    node::BlockManager::Options blockman_opts{\n+        .chainparams = Params(),\n+        .blocks_dir = m_args.GetBlocksDirPath(),\n+        .notifications = notifications,\n+    };\n+    BlockManager blockman{m_node.kernel->interrupt, blockman_opts};\n+    CChain chain{};\n+\n+    // Test blocks with no transactions, not even a coinbase\n+    CBlock block1;\n+    block1.nVersion = 1;\n+    CBlock block2;\n+    block2.nVersion = 2;\n+    CBlock block3;\n+    block3.nVersion = 3;\n+\n+    // They are 80 bytes header + 1 byte 0x00 for vtx length\n+    constexpr int TEST_BLOCK_SIZE{81};\n+\n+    // Blockstore is empty\n+    BOOST_CHECK_EQUAL(blockman.CalculateCurrentUsage(), 0);\n+\n+    // Write the first block; dbp=nullptr means this block doesn't already have a disk\n+    // location, so allocate a free location and write it there.\n+    FlatFilePos pos1{blockman.SaveBlockToDisk(block1, /*nHeight=*/1, chain, /*dbp=*/nullptr)};\n+\n+    // Write second block\n+    FlatFilePos pos2{blockman.SaveBlockToDisk(block2, /*nHeight=*/2, chain, /*dbp=*/nullptr)};\n+\n+    // Two blocks in the file\n+    BOOST_CHECK_EQUAL(blockman.CalculateCurrentUsage(), (TEST_BLOCK_SIZE + BLOCK_SERIALIZATION_HEADER_SIZE) * 2);\n+\n+    // First two blocks are written as expected\n+    CBlock read_block;\n+    blockman.ReadBlockFromDisk(read_block, pos1);\n+    BOOST_CHECK_EQUAL(read_block.nVersion, 1);\n+    blockman.ReadBlockFromDisk(read_block, pos2);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1266840274",
      "id" : 1266840274,
      "line" : 138,
      "node_id" : "PRRC_kwDOABII585LgnLS",
      "original_commit_id" : "2b624780b601be60700a27f893d24c0e8a11cd41",
      "original_line" : 138,
      "original_position" : 56,
      "original_start_line" : 135,
      "path" : "src/test/blockmanager_tests.cpp",
      "position" : 56,
      "pull_request_review_id" : 1535143803,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1266840274/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 135,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-18T14:48:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1266840274",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1266861864"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1266861864"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 2b62478:\r\n\r\nnit: could also check that `SaveBlockToDisk` return value is equal to pos2.\r\n\r\nSide note:\r\nThis behavior smells bad to me. Having `SaveBlockToDisk` updating the block file metadata, without storing the block, and returning successfully looks like an error-prone behavior. The block file info class exist to describe what is inside the block file.",
      "commit_id" : "fe9da891eb7a7440b6c23d63e129525fe26f8f0e",
      "created_at" : "2023-07-18T14:28:39Z",
      "diff_hunk" : "@@ -90,4 +91,71 @@ BOOST_FIXTURE_TEST_CASE(blockmanager_scan_unlink_already_pruned_files, TestChain\n     BOOST_CHECK(!AutoFile(blockman.OpenBlockFile(new_pos, true)).IsNull());\n }\n \n+struct FastPruneTestingSetup : public BasicTestingSetup {\n+    FastPruneTestingSetup()\n+        : BasicTestingSetup{ChainType::MAIN, /*extra_args=*/{\"-fastprune=1\"}} {}\n+};\n+\n+BOOST_FIXTURE_TEST_CASE(blockmanager_flush_block_file, FastPruneTestingSetup)\n+{\n+    KernelNotifications notifications{m_node.exit_status};\n+    node::BlockManager::Options blockman_opts{\n+        .chainparams = Params(),\n+        .blocks_dir = m_args.GetBlocksDirPath(),\n+        .notifications = notifications,\n+    };\n+    BlockManager blockman{m_node.kernel->interrupt, blockman_opts};\n+    CChain chain{};\n+\n+    // Test blocks with no transactions, not even a coinbase\n+    CBlock block1;\n+    block1.nVersion = 1;\n+    CBlock block2;\n+    block2.nVersion = 2;\n+    CBlock block3;\n+    block3.nVersion = 3;\n+\n+    // They are 80 bytes header + 1 byte 0x00 for vtx length\n+    constexpr int TEST_BLOCK_SIZE{81};\n+\n+    // Blockstore is empty\n+    BOOST_CHECK_EQUAL(blockman.CalculateCurrentUsage(), 0);\n+\n+    // Write the first block; dbp=nullptr means this block doesn't already have a disk\n+    // location, so allocate a free location and write it there.\n+    FlatFilePos pos1{blockman.SaveBlockToDisk(block1, /*nHeight=*/1, chain, /*dbp=*/nullptr)};\n+\n+    // Write second block\n+    FlatFilePos pos2{blockman.SaveBlockToDisk(block2, /*nHeight=*/2, chain, /*dbp=*/nullptr)};\n+\n+    // Two blocks in the file\n+    BOOST_CHECK_EQUAL(blockman.CalculateCurrentUsage(), (TEST_BLOCK_SIZE + BLOCK_SERIALIZATION_HEADER_SIZE) * 2);\n+\n+    // First two blocks are written as expected\n+    CBlock read_block;\n+    blockman.ReadBlockFromDisk(read_block, pos1);\n+    BOOST_CHECK_EQUAL(read_block.nVersion, 1);\n+    blockman.ReadBlockFromDisk(read_block, pos2);\n+    BOOST_CHECK_EQUAL(read_block.nVersion, 2);\n+\n+    // When FlatFilePos* dbp is given, SaveBlockToDisk() will not write or\n+    // overwrite anything to the flat file block storage. It will, however,\n+    // update the blockfile metadata. This is to facilitate reindexing\n+    // when the user has the blocks on disk but the metadata is being rebuilt.\n+    // Verify this behavior by attempting (and failing) to write block 3 data\n+    // to block 2 location.\n+    CBlockFileInfo* block_data = blockman.GetBlockFileInfo(0);\n+    BOOST_CHECK_EQUAL(block_data->nBlocks, 2);\n+    blockman.SaveBlockToDisk(block3, /*nHeight=*/3, chain, /*dbp=*/&pos2);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1266861864",
      "id" : 1266861864,
      "line" : 149,
      "node_id" : "PRRC_kwDOABII585Lgsco",
      "original_commit_id" : "2b624780b601be60700a27f893d24c0e8a11cd41",
      "original_line" : 149,
      "original_position" : 67,
      "original_start_line" : null,
      "path" : "src/test/blockmanager_tests.cpp",
      "position" : 67,
      "pull_request_review_id" : 1535143803,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1266861864/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-18T14:48:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1266861864",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Are you still working on this?",
      "created_at" : "2023-07-18T18:02:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1640702774",
      "id" : 1640702774,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585hyyM2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1640702774/reactions"
      },
      "updated_at" : "2023-07-18T18:02:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1640702774",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Are you still working on this?\r\n\r\nAbsolutely, thanks. Had a few other things to catch up on. This will be updated before the end of the week",
      "created_at" : "2023-07-18T18:03:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1640704021",
      "id" : 1640704021,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585hyygV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1640704021/reactions"
      },
      "updated_at" : "2023-07-18T18:03:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1640704021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1267962992"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267962992"
         }
      },
      "author_association" : "MEMBER",
      "body" : "thanks, that is leftover from older version",
      "commit_id" : "fe9da891eb7a7440b6c23d63e129525fe26f8f0e",
      "created_at" : "2023-07-19T11:52:00Z",
      "diff_hunk" : "@@ -90,4 +91,71 @@ BOOST_FIXTURE_TEST_CASE(blockmanager_scan_unlink_already_pruned_files, TestChain\n     BOOST_CHECK(!AutoFile(blockman.OpenBlockFile(new_pos, true)).IsNull());\n }\n \n+struct FastPruneTestingSetup : public BasicTestingSetup {\n+    FastPruneTestingSetup()\n+        : BasicTestingSetup{ChainType::MAIN, /*extra_args=*/{\"-fastprune=1\"}} {}\n+};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1267962992",
      "id" : 1267962992,
      "in_reply_to_id" : 1262301743,
      "line" : 97,
      "node_id" : "PRRC_kwDOABII585Lk5Rw",
      "original_commit_id" : "2b624780b601be60700a27f893d24c0e8a11cd41",
      "original_line" : 97,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/test/blockmanager_tests.cpp",
      "position" : 15,
      "pull_request_review_id" : 1536917371,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267962992/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-19T11:52:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267962992",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1267964112"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267964112"
         }
      },
      "author_association" : "MEMBER",
      "body" : "sure thanks",
      "commit_id" : "fe9da891eb7a7440b6c23d63e129525fe26f8f0e",
      "created_at" : "2023-07-19T11:53:10Z",
      "diff_hunk" : "@@ -90,4 +91,71 @@ BOOST_FIXTURE_TEST_CASE(blockmanager_scan_unlink_already_pruned_files, TestChain\n     BOOST_CHECK(!AutoFile(blockman.OpenBlockFile(new_pos, true)).IsNull());\n }\n \n+struct FastPruneTestingSetup : public BasicTestingSetup {\n+    FastPruneTestingSetup()\n+        : BasicTestingSetup{ChainType::MAIN, /*extra_args=*/{\"-fastprune=1\"}} {}\n+};\n+\n+BOOST_FIXTURE_TEST_CASE(blockmanager_flush_block_file, FastPruneTestingSetup)\n+{\n+    KernelNotifications notifications{m_node.exit_status};\n+    node::BlockManager::Options blockman_opts{\n+        .chainparams = Params(),\n+        .blocks_dir = m_args.GetBlocksDirPath(),\n+        .notifications = notifications,\n+    };\n+    BlockManager blockman{m_node.kernel->interrupt, blockman_opts};\n+    CChain chain{};\n+\n+    // Test blocks with no transactions, not even a coinbase\n+    CBlock block1;\n+    block1.nVersion = 1;\n+    CBlock block2;\n+    block2.nVersion = 2;\n+    CBlock block3;\n+    block3.nVersion = 3;\n+\n+    // They are 80 bytes header + 1 byte 0x00 for vtx length\n+    constexpr int TEST_BLOCK_SIZE{81};\n+\n+    // Blockstore is empty\n+    BOOST_CHECK_EQUAL(blockman.CalculateCurrentUsage(), 0);\n+\n+    // Write the first block; dbp=nullptr means this block doesn't already have a disk\n+    // location, so allocate a free location and write it there.\n+    FlatFilePos pos1{blockman.SaveBlockToDisk(block1, /*nHeight=*/1, chain, /*dbp=*/nullptr)};\n+\n+    // Write second block\n+    FlatFilePos pos2{blockman.SaveBlockToDisk(block2, /*nHeight=*/2, chain, /*dbp=*/nullptr)};\n+\n+    // Two blocks in the file\n+    BOOST_CHECK_EQUAL(blockman.CalculateCurrentUsage(), (TEST_BLOCK_SIZE + BLOCK_SERIALIZATION_HEADER_SIZE) * 2);\n+\n+    // First two blocks are written as expected\n+    CBlock read_block;\n+    blockman.ReadBlockFromDisk(read_block, pos1);\n+    BOOST_CHECK_EQUAL(read_block.nVersion, 1);\n+    blockman.ReadBlockFromDisk(read_block, pos2);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1267964112",
      "id" : 1267964112,
      "in_reply_to_id" : 1266840274,
      "line" : 138,
      "node_id" : "PRRC_kwDOABII585Lk5jQ",
      "original_commit_id" : "2b624780b601be60700a27f893d24c0e8a11cd41",
      "original_line" : 138,
      "original_position" : 56,
      "original_start_line" : 135,
      "path" : "src/test/blockmanager_tests.cpp",
      "position" : 56,
      "pull_request_review_id" : 1536919045,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267964112/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 135,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-19T11:53:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267964112",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1267981369"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267981369"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done thanks. agreed about the smell. lets lock down the expected behavior with tests and then we can clean up in future PR.",
      "commit_id" : "eb4929f47bcf6c63b07636d91d0a97b60f560b16",
      "created_at" : "2023-07-19T12:08:50Z",
      "diff_hunk" : "@@ -90,4 +91,71 @@ BOOST_FIXTURE_TEST_CASE(blockmanager_scan_unlink_already_pruned_files, TestChain\n     BOOST_CHECK(!AutoFile(blockman.OpenBlockFile(new_pos, true)).IsNull());\n }\n \n+struct FastPruneTestingSetup : public BasicTestingSetup {\n+    FastPruneTestingSetup()\n+        : BasicTestingSetup{ChainType::MAIN, /*extra_args=*/{\"-fastprune=1\"}} {}\n+};\n+\n+BOOST_FIXTURE_TEST_CASE(blockmanager_flush_block_file, FastPruneTestingSetup)\n+{\n+    KernelNotifications notifications{m_node.exit_status};\n+    node::BlockManager::Options blockman_opts{\n+        .chainparams = Params(),\n+        .blocks_dir = m_args.GetBlocksDirPath(),\n+        .notifications = notifications,\n+    };\n+    BlockManager blockman{m_node.kernel->interrupt, blockman_opts};\n+    CChain chain{};\n+\n+    // Test blocks with no transactions, not even a coinbase\n+    CBlock block1;\n+    block1.nVersion = 1;\n+    CBlock block2;\n+    block2.nVersion = 2;\n+    CBlock block3;\n+    block3.nVersion = 3;\n+\n+    // They are 80 bytes header + 1 byte 0x00 for vtx length\n+    constexpr int TEST_BLOCK_SIZE{81};\n+\n+    // Blockstore is empty\n+    BOOST_CHECK_EQUAL(blockman.CalculateCurrentUsage(), 0);\n+\n+    // Write the first block; dbp=nullptr means this block doesn't already have a disk\n+    // location, so allocate a free location and write it there.\n+    FlatFilePos pos1{blockman.SaveBlockToDisk(block1, /*nHeight=*/1, chain, /*dbp=*/nullptr)};\n+\n+    // Write second block\n+    FlatFilePos pos2{blockman.SaveBlockToDisk(block2, /*nHeight=*/2, chain, /*dbp=*/nullptr)};\n+\n+    // Two blocks in the file\n+    BOOST_CHECK_EQUAL(blockman.CalculateCurrentUsage(), (TEST_BLOCK_SIZE + BLOCK_SERIALIZATION_HEADER_SIZE) * 2);\n+\n+    // First two blocks are written as expected\n+    CBlock read_block;\n+    blockman.ReadBlockFromDisk(read_block, pos1);\n+    BOOST_CHECK_EQUAL(read_block.nVersion, 1);\n+    blockman.ReadBlockFromDisk(read_block, pos2);\n+    BOOST_CHECK_EQUAL(read_block.nVersion, 2);\n+\n+    // When FlatFilePos* dbp is given, SaveBlockToDisk() will not write or\n+    // overwrite anything to the flat file block storage. It will, however,\n+    // update the blockfile metadata. This is to facilitate reindexing\n+    // when the user has the blocks on disk but the metadata is being rebuilt.\n+    // Verify this behavior by attempting (and failing) to write block 3 data\n+    // to block 2 location.\n+    CBlockFileInfo* block_data = blockman.GetBlockFileInfo(0);\n+    BOOST_CHECK_EQUAL(block_data->nBlocks, 2);\n+    blockman.SaveBlockToDisk(block3, /*nHeight=*/3, chain, /*dbp=*/&pos2);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1267981369",
      "id" : 1267981369,
      "in_reply_to_id" : 1266861864,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Lk9w5",
      "original_commit_id" : "2b624780b601be60700a27f893d24c0e8a11cd41",
      "original_line" : 149,
      "original_position" : 67,
      "original_start_line" : null,
      "path" : "src/test/blockmanager_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1536946275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267981369/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-19T12:08:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267981369",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1268016035"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268016035"
         }
      },
      "author_association" : "MEMBER",
      "body" : "yeah agreed, will update",
      "commit_id" : "eb4929f47bcf6c63b07636d91d0a97b60f560b16",
      "created_at" : "2023-07-19T12:39:15Z",
      "diff_hunk" : "@@ -0,0 +1,63 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test running bitcoind with -reindex from a read-only blockstore\n+- Start two nodes, generate blocks, then restart with -reindex after setting blk files to read-only\n+\"\"\"\n+\n+import stat\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+\n+class BlockstoreReindexTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [],\n+            [\"-fastprune\"]\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_root()\n+\n+    def reindex_readonly(self):\n+        self.connect_nodes(0, 1)\n+        addr = self.nodes[1].get_deterministic_priv_key().address\n+\n+        # generate enough blocks to ensure that the -fastprune node fills up the\n+        # first blk00000.dat file and starts another block file\n+\n+        # How big are empty regtest blocks?\n+        block_hash = self.generatetoaddress(self.nodes[1], 1, addr)[0]\n+        block_size = self.nodes[1].getblock(block_hash)[\"size\"]\n+        block_size += 8 # BLOCK_SERIALIZATION_HEADER_SIZE\n+\n+        # How many blocks do we need to roll over a new .blk file?\n+        block_count = self.nodes[1].getblockcount()\n+        fastprune_blockfile_size = 0x10000\n+        size_needed = fastprune_blockfile_size - (block_size * block_count)\n+        blocks_needed = size_needed // block_size\n+\n+        self.log.debug(\"Generate enough blocks to start second block file\")\n+        self.generatetoaddress(self.nodes[1], blocks_needed, addr)\n+        self.stop_node(1)\n+\n+        assert (self.nodes[1].chain_path / \"blocks\" / \"blk00000.dat\").exists()\n+        assert (self.nodes[1].chain_path / \"blocks\" / \"blk00001.dat\").exists()\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1268016035",
      "id" : 1268016035,
      "in_reply_to_id" : 1262326358,
      "line" : 49,
      "node_id" : "PRRC_kwDOABII585LlGOj",
      "original_commit_id" : "d82a493ed9570e36d45ce0619691f958fad8429a",
      "original_line" : 49,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex_readonly.py",
      "position" : 49,
      "pull_request_review_id" : 1536998693,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268016035/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-19T12:39:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268016035",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1268054016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268054016"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ok will assert so future failure on regression is easy to see",
      "commit_id" : "eb4929f47bcf6c63b07636d91d0a97b60f560b16",
      "created_at" : "2023-07-19T13:11:08Z",
      "diff_hunk" : "@@ -0,0 +1,63 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test running bitcoind with -reindex from a read-only blockstore\n+- Start two nodes, generate blocks, then restart with -reindex after setting blk files to read-only\n+\"\"\"\n+\n+import stat\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+\n+class BlockstoreReindexTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [],\n+            [\"-fastprune\"]\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_root()\n+\n+    def reindex_readonly(self):\n+        self.connect_nodes(0, 1)\n+        addr = self.nodes[1].get_deterministic_priv_key().address\n+\n+        # generate enough blocks to ensure that the -fastprune node fills up the\n+        # first blk00000.dat file and starts another block file\n+\n+        # How big are empty regtest blocks?\n+        block_hash = self.generatetoaddress(self.nodes[1], 1, addr)[0]\n+        block_size = self.nodes[1].getblock(block_hash)[\"size\"]\n+        block_size += 8 # BLOCK_SERIALIZATION_HEADER_SIZE\n+\n+        # How many blocks do we need to roll over a new .blk file?\n+        block_count = self.nodes[1].getblockcount()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1268054016",
      "id" : 1268054016,
      "in_reply_to_id" : 1262327787,
      "line" : 35,
      "node_id" : "PRRC_kwDOABII585LlPgA",
      "original_commit_id" : "d82a493ed9570e36d45ce0619691f958fad8429a",
      "original_line" : 35,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex_readonly.py",
      "position" : 35,
      "pull_request_review_id" : 1537059167,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268054016/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-19T13:11:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268054016",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1268066532"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268066532"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hm well, that'll certainly be faster but then we can't verify a successful reindex in the new run-as-root path. Size shouldn't be an issue though because no assumptions are made about it, the test calculates how much data it needs to generate. Let me know what you think about this again after the next push",
      "commit_id" : "eb4929f47bcf6c63b07636d91d0a97b60f560b16",
      "created_at" : "2023-07-19T13:21:03Z",
      "diff_hunk" : "@@ -0,0 +1,63 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test running bitcoind with -reindex from a read-only blockstore\n+- Start two nodes, generate blocks, then restart with -reindex after setting blk files to read-only\n+\"\"\"\n+\n+import stat\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+\n+class BlockstoreReindexTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [],\n+            [\"-fastprune\"]\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_root()\n+\n+    def reindex_readonly(self):\n+        self.connect_nodes(0, 1)\n+        addr = self.nodes[1].get_deterministic_priv_key().address",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1268066532",
      "id" : 1268066532,
      "in_reply_to_id" : 1262331864,
      "line" : 24,
      "node_id" : "PRRC_kwDOABII585LlSjk",
      "original_commit_id" : "d82a493ed9570e36d45ce0619691f958fad8429a",
      "original_line" : 24,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex_readonly.py",
      "position" : 24,
      "pull_request_review_id" : 1537080093,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268066532/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-19T13:21:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268066532",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1268176279"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268176279"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Boy I was really scratching my head over this for like an hour (\"how does this work at all?\") then I remember the genesis block is written to a file when block count is still 0. So that's how we are rounding up.",
      "commit_id" : "eb4929f47bcf6c63b07636d91d0a97b60f560b16",
      "created_at" : "2023-07-19T14:38:37Z",
      "diff_hunk" : "@@ -0,0 +1,63 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test running bitcoind with -reindex from a read-only blockstore\n+- Start two nodes, generate blocks, then restart with -reindex after setting blk files to read-only\n+\"\"\"\n+\n+import stat\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+\n+class BlockstoreReindexTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [],\n+            [\"-fastprune\"]\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_root()\n+\n+    def reindex_readonly(self):\n+        self.connect_nodes(0, 1)\n+        addr = self.nodes[1].get_deterministic_priv_key().address\n+\n+        # generate enough blocks to ensure that the -fastprune node fills up the\n+        # first blk00000.dat file and starts another block file\n+\n+        # How big are empty regtest blocks?\n+        block_hash = self.generatetoaddress(self.nodes[1], 1, addr)[0]\n+        block_size = self.nodes[1].getblock(block_hash)[\"size\"]\n+        block_size += 8 # BLOCK_SERIALIZATION_HEADER_SIZE\n+\n+        # How many blocks do we need to roll over a new .blk file?\n+        block_count = self.nodes[1].getblockcount()\n+        fastprune_blockfile_size = 0x10000\n+        size_needed = fastprune_blockfile_size - (block_size * block_count)\n+        blocks_needed = size_needed // block_size",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1268176279",
      "id" : 1268176279,
      "in_reply_to_id" : 1262338435,
      "line" : 39,
      "node_id" : "PRRC_kwDOABII585LltWX",
      "original_commit_id" : "fe9da891eb7a7440b6c23d63e129525fe26f8f0e",
      "original_line" : 39,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex_readonly.py",
      "position" : 39,
      "pull_request_review_id" : 1537262080,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268176279/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-19T14:38:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268176279",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1268183969"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268183969"
         }
      },
      "author_association" : "MEMBER",
      "body" : "hm see https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1239761122 not sure what to do",
      "commit_id" : "eb4929f47bcf6c63b07636d91d0a97b60f560b16",
      "created_at" : "2023-07-19T14:44:02Z",
      "diff_hunk" : "@@ -53,6 +62,7 @@ if [ \"$CI_OS_NAME\" == \"macos\" ]; then\n   echo > \"${HOME}/Library/Application Support/Bitcoin\"\n else\n   echo > \"${HOME}/.bitcoin\"\n+  ${NONROOT_DUMMY_DIR}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1268183969",
      "id" : 1268183969,
      "in_reply_to_id" : 1262333855,
      "line" : 65,
      "node_id" : "PRRC_kwDOABII585LlvOh",
      "original_commit_id" : "fe9da891eb7a7440b6c23d63e129525fe26f8f0e",
      "original_line" : 65,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "ci/test/06_script_b.sh",
      "position" : 20,
      "pull_request_review_id" : 1537274212,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268183969/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-19T14:44:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268183969",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1268231932"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268231932"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Need to scope the `ASSERT_DEBUG_LOG` macro.\r\nIt expands to a `DebugLogHelper`, which has the check in the destructor. Also, this will swallow other logging errors as well if it is not scoped.",
      "commit_id" : "eb4929f47bcf6c63b07636d91d0a97b60f560b16",
      "created_at" : "2023-07-19T15:18:43Z",
      "diff_hunk" : "@@ -129,4 +131,69 @@ BOOST_FIXTURE_TEST_CASE(blockmanager_block_data_availability, TestChain100Setup)\n     BOOST_CHECK(!blockman.CheckBlockDataAvailability(tip, *last_pruned_block));\n }\n \n+BOOST_AUTO_TEST_CASE(blockmanager_flush_block_file)\n+{\n+    KernelNotifications notifications{m_node.exit_status};\n+    node::BlockManager::Options blockman_opts{\n+        .chainparams = Params(),\n+        .blocks_dir = m_args.GetBlocksDirPath(),\n+        .notifications = notifications,\n+    };\n+    BlockManager blockman{m_node.kernel->interrupt, blockman_opts};\n+    CChain chain{};\n+\n+    // Test blocks with no transactions, not even a coinbase\n+    CBlock block1;\n+    block1.nVersion = 1;\n+    CBlock block2;\n+    block2.nVersion = 2;\n+    CBlock block3;\n+    block3.nVersion = 3;\n+\n+    // They are 80 bytes header + 1 byte 0x00 for vtx length\n+    constexpr int TEST_BLOCK_SIZE{81};\n+\n+    // Blockstore is empty\n+    BOOST_CHECK_EQUAL(blockman.CalculateCurrentUsage(), 0);\n+\n+    // Write the first block; dbp=nullptr means this block doesn't already have a disk\n+    // location, so allocate a free location and write it there.\n+    FlatFilePos pos1{blockman.SaveBlockToDisk(block1, /*nHeight=*/1, chain, /*dbp=*/nullptr)};\n+\n+    // Write second block\n+    FlatFilePos pos2{blockman.SaveBlockToDisk(block2, /*nHeight=*/2, chain, /*dbp=*/nullptr)};\n+\n+    // Two blocks in the file\n+    BOOST_CHECK_EQUAL(blockman.CalculateCurrentUsage(), (TEST_BLOCK_SIZE + BLOCK_SERIALIZATION_HEADER_SIZE) * 2);\n+\n+    // First two blocks are written as expected\n+    // Errors are expected because block data is junk, thrown AFTER successful read\n+    CBlock read_block;\n+    BOOST_CHECK(!blockman.ReadBlockFromDisk(read_block, pos1));\n+    ASSERT_DEBUG_LOG(\"ReadBlockFromDisk: Errors in block header\");\n+    BOOST_CHECK_EQUAL(read_block.nVersion, 1);\n+    BOOST_CHECK(!blockman.ReadBlockFromDisk(read_block, pos2));\n+    ASSERT_DEBUG_LOG(\"ReadBlockFromDisk: Errors in block header\");\n+    BOOST_CHECK_EQUAL(read_block.nVersion, 2);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1268231932",
      "id" : 1268231932,
      "line" : 177,
      "node_id" : "PRRC_kwDOABII585Ll678",
      "original_commit_id" : "9fd44f813f26a228af9de8fb73c1a5d9db0ce78f",
      "original_line" : 177,
      "original_position" : 60,
      "original_start_line" : 172,
      "path" : "src/test/blockmanager_tests.cpp",
      "position" : 60,
      "pull_request_review_id" : 1537350418,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268231932/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 172,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-19T15:18:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268231932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1268324570"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268324570"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, just fixed & pushed",
      "commit_id" : "08b275c6d27f06cd7d2580b4c0200e32d5b7b1b6",
      "created_at" : "2023-07-19T16:30:38Z",
      "diff_hunk" : "@@ -129,4 +131,69 @@ BOOST_FIXTURE_TEST_CASE(blockmanager_block_data_availability, TestChain100Setup)\n     BOOST_CHECK(!blockman.CheckBlockDataAvailability(tip, *last_pruned_block));\n }\n \n+BOOST_AUTO_TEST_CASE(blockmanager_flush_block_file)\n+{\n+    KernelNotifications notifications{m_node.exit_status};\n+    node::BlockManager::Options blockman_opts{\n+        .chainparams = Params(),\n+        .blocks_dir = m_args.GetBlocksDirPath(),\n+        .notifications = notifications,\n+    };\n+    BlockManager blockman{m_node.kernel->interrupt, blockman_opts};\n+    CChain chain{};\n+\n+    // Test blocks with no transactions, not even a coinbase\n+    CBlock block1;\n+    block1.nVersion = 1;\n+    CBlock block2;\n+    block2.nVersion = 2;\n+    CBlock block3;\n+    block3.nVersion = 3;\n+\n+    // They are 80 bytes header + 1 byte 0x00 for vtx length\n+    constexpr int TEST_BLOCK_SIZE{81};\n+\n+    // Blockstore is empty\n+    BOOST_CHECK_EQUAL(blockman.CalculateCurrentUsage(), 0);\n+\n+    // Write the first block; dbp=nullptr means this block doesn't already have a disk\n+    // location, so allocate a free location and write it there.\n+    FlatFilePos pos1{blockman.SaveBlockToDisk(block1, /*nHeight=*/1, chain, /*dbp=*/nullptr)};\n+\n+    // Write second block\n+    FlatFilePos pos2{blockman.SaveBlockToDisk(block2, /*nHeight=*/2, chain, /*dbp=*/nullptr)};\n+\n+    // Two blocks in the file\n+    BOOST_CHECK_EQUAL(blockman.CalculateCurrentUsage(), (TEST_BLOCK_SIZE + BLOCK_SERIALIZATION_HEADER_SIZE) * 2);\n+\n+    // First two blocks are written as expected\n+    // Errors are expected because block data is junk, thrown AFTER successful read\n+    CBlock read_block;\n+    BOOST_CHECK(!blockman.ReadBlockFromDisk(read_block, pos1));\n+    ASSERT_DEBUG_LOG(\"ReadBlockFromDisk: Errors in block header\");\n+    BOOST_CHECK_EQUAL(read_block.nVersion, 1);\n+    BOOST_CHECK(!blockman.ReadBlockFromDisk(read_block, pos2));\n+    ASSERT_DEBUG_LOG(\"ReadBlockFromDisk: Errors in block header\");\n+    BOOST_CHECK_EQUAL(read_block.nVersion, 2);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1268324570",
      "id" : 1268324570,
      "in_reply_to_id" : 1268231932,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LmRja",
      "original_commit_id" : "9fd44f813f26a228af9de8fb73c1a5d9db0ce78f",
      "original_line" : 177,
      "original_position" : 60,
      "original_start_line" : 172,
      "path" : "src/test/blockmanager_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1537496004,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268324570/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-19T16:30:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268324570",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke @furszy @ryanofsky thanks for the reviews, latest push addresses all comments except where noted.",
      "created_at" : "2023-07-20T13:33:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1643935993",
      "id" : 1643935993,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585h_Hj5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1643935993/reactions"
      },
      "updated_at" : "2023-07-20T13:33:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1643935993",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269529793"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269529793"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1262333855\r\n\r\n> hm see [#27850 (comment)](https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1239761122) not sure what to do\r\n\r\nI don't actually understand what this issue is in that comment since the variable seems to be used just once.\r\n\r\nIt does seem strange to define these commands as variables instead of inlining them when the variables only seem to be used only once. Also would expect them to be shell functions instead of variables. And would expect them to have imperative names like NONROOT_MAKE_DUMMY_DIR instead of NONROOT_DUMMY_DIR. But I guess a nice thing about having the variables is it ties nonroot code scattered different places back to a central place. Anyway, whatever style you like to use here seems fine.",
      "commit_id" : "068b523ee7720e6a392efc294ff89bf936a3e2ac",
      "created_at" : "2023-07-20T14:16:36Z",
      "diff_hunk" : "@@ -53,6 +62,7 @@ if [ \"$CI_OS_NAME\" == \"macos\" ]; then\n   echo > \"${HOME}/Library/Application Support/Bitcoin\"\n else\n   echo > \"${HOME}/.bitcoin\"\n+  ${NONROOT_DUMMY_DIR}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269529793",
      "id" : 1269529793,
      "in_reply_to_id" : 1262333855,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Lq3zB",
      "original_commit_id" : "fe9da891eb7a7440b6c23d63e129525fe26f8f0e",
      "original_line" : 65,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "ci/test/06_script_b.sh",
      "position" : null,
      "pull_request_review_id" : 1539378350,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269529793/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-20T14:22:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269529793",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269613973"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269613973"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> that'll certainly be faster but then we can't verify a successful reindex in the new run-as-root path.\r\n\r\nAny reason why it wouldn't be able to reindex?",
      "commit_id" : "068b523ee7720e6a392efc294ff89bf936a3e2ac",
      "created_at" : "2023-07-20T15:14:24Z",
      "diff_hunk" : "@@ -0,0 +1,63 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test running bitcoind with -reindex from a read-only blockstore\n+- Start two nodes, generate blocks, then restart with -reindex after setting blk files to read-only\n+\"\"\"\n+\n+import stat\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+\n+class BlockstoreReindexTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [],\n+            [\"-fastprune\"]\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_root()\n+\n+    def reindex_readonly(self):\n+        self.connect_nodes(0, 1)\n+        addr = self.nodes[1].get_deterministic_priv_key().address",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269613973",
      "id" : 1269613973,
      "in_reply_to_id" : 1262331864,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LrMWV",
      "original_commit_id" : "d82a493ed9570e36d45ce0619691f958fad8429a",
      "original_line" : 24,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex_readonly.py",
      "position" : null,
      "pull_request_review_id" : 1539523310,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269613973/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-20T15:14:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269613973",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "lgtm ACK 08b275c6d27f06cd7d2580b4c0200e32d5b7b1b6 ð¥\r\n\r\n<details><summary>Show signature</summary>\r\n\r\nSignature:\r\n\r\n```\r\nuntrusted comment: signature from minisign secret key on empty file; verify via: minisign -Vm \"${path_to_any_empty_file}\" -P RWTRmVTMeKV5noAMqVlsMugDDCyyTSbA3Re5AkUrhvLVln0tSaFWglOw -x \"${path_to_this_whole_four_line_signature_blob}\"\r\nRUTRmVTMeKV5npGrKx1nqXCw5zeVHdtdYURB/KlyA/LMFgpNCs+SkW9a8N95d+U4AP1RJMi+krxU1A3Yux4bpwZNLvVBKy0wLgM=\r\ntrusted comment: lgtm ACK 08b275c6d27f06cd7d2580b4c0200e32d5b7b1b6 ð¥\r\nH6fyAbnBh5wUC7aDiz0JV0xtCSZwQhLf06w6lLmL7uypVzV7p0SxdsIsxZtMiUoaA3+XmszUKfNPZDxRUD+EAw==\r\n```\r\n\r\n</details>\r\n",
      "created_at" : "2023-07-20T15:15:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1644114670",
      "id" : 1644114670,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585h_zLu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1644114670/reactions"
      },
      "updated_at" : "2023-07-20T15:15:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1644114670",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269620812"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269620812"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ah ya know what I didn't read your comment correctly I thought you were suggesting filling the blocks with invalid junk but that line with `generateblock()` is cool",
      "commit_id" : "068b523ee7720e6a392efc294ff89bf936a3e2ac",
      "created_at" : "2023-07-20T15:18:10Z",
      "diff_hunk" : "@@ -0,0 +1,63 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test running bitcoind with -reindex from a read-only blockstore\n+- Start two nodes, generate blocks, then restart with -reindex after setting blk files to read-only\n+\"\"\"\n+\n+import stat\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+\n+class BlockstoreReindexTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [],\n+            [\"-fastprune\"]\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_root()\n+\n+    def reindex_readonly(self):\n+        self.connect_nodes(0, 1)\n+        addr = self.nodes[1].get_deterministic_priv_key().address",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269620812",
      "id" : 1269620812,
      "in_reply_to_id" : 1262331864,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LrOBM",
      "original_commit_id" : "d82a493ed9570e36d45ce0619691f958fad8429a",
      "original_line" : 24,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex_readonly.py",
      "position" : null,
      "pull_request_review_id" : 1539532252,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269620812/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-20T15:18:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269620812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269737484"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269737484"
         }
      },
      "author_association" : "MEMBER",
      "body" : "So I just tried this and you don't need to generate *any* additional blocks. A single call to `self.generateblock(self.nodes[1], output=f\"raw(61{'ff'*998000})\", transactions=[])` is enough to create blk2.dat",
      "commit_id" : "068b523ee7720e6a392efc294ff89bf936a3e2ac",
      "created_at" : "2023-07-20T17:02:38Z",
      "diff_hunk" : "@@ -0,0 +1,63 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test running bitcoind with -reindex from a read-only blockstore\n+- Start two nodes, generate blocks, then restart with -reindex after setting blk files to read-only\n+\"\"\"\n+\n+import stat\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+\n+class BlockstoreReindexTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [],\n+            [\"-fastprune\"]\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_root()\n+\n+    def reindex_readonly(self):\n+        self.connect_nodes(0, 1)\n+        addr = self.nodes[1].get_deterministic_priv_key().address",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269737484",
      "id" : 1269737484,
      "in_reply_to_id" : 1262331864,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LrqgM",
      "original_commit_id" : "d82a493ed9570e36d45ce0619691f958fad8429a",
      "original_line" : 24,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex_readonly.py",
      "position" : null,
      "pull_request_review_id" : 1539716521,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269737484/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-20T17:02:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269737484",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269738696"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269738696"
         }
      },
      "author_association" : "MEMBER",
      "body" : "yeah, ive got this too, will push in a few minutes",
      "commit_id" : "068b523ee7720e6a392efc294ff89bf936a3e2ac",
      "created_at" : "2023-07-20T17:03:36Z",
      "diff_hunk" : "@@ -0,0 +1,63 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test running bitcoind with -reindex from a read-only blockstore\n+- Start two nodes, generate blocks, then restart with -reindex after setting blk files to read-only\n+\"\"\"\n+\n+import stat\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+\n+class BlockstoreReindexTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [],\n+            [\"-fastprune\"]\n+        ]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_root()\n+\n+    def reindex_readonly(self):\n+        self.connect_nodes(0, 1)\n+        addr = self.nodes[1].get_deterministic_priv_key().address",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269738696",
      "id" : 1269738696,
      "in_reply_to_id" : 1262331864,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LrqzI",
      "original_commit_id" : "d82a493ed9570e36d45ce0619691f958fad8429a",
      "original_line" : 24,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex_readonly.py",
      "position" : null,
      "pull_request_review_id" : 1539718778,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269738696/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-20T17:03:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269738696",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269740640"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269740640"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason for this node?",
      "commit_id" : "068b523ee7720e6a392efc294ff89bf936a3e2ac",
      "created_at" : "2023-07-20T17:04:45Z",
      "diff_hunk" : "@@ -0,0 +1,69 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test running bitcoind with -reindex from a read-only blockstore\n+- Start two nodes, generate blocks, then restart with -reindex after setting blk files to read-only\n+\"\"\"\n+\n+import stat\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+class BlockstoreReindexTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [],",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269740640",
      "id" : 1269740640,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LrrRg",
      "original_commit_id" : "08b275c6d27f06cd7d2580b4c0200e32d5b7b1b6",
      "original_line" : 18,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex_readonly.py",
      "position" : null,
      "pull_request_review_id" : 1539720985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269740640/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-20T17:04:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269740640",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269743318"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269743318"
         }
      },
      "author_association" : "MEMBER",
      "body" : "My understanding is that inlining should be fine here, because if  the previous nonroot code was removed, the call would fail with \"path not found\", does it not?\r\n\r\nedit: But anything is fine here.",
      "commit_id" : "068b523ee7720e6a392efc294ff89bf936a3e2ac",
      "created_at" : "2023-07-20T17:07:35Z",
      "diff_hunk" : "@@ -53,6 +62,7 @@ if [ \"$CI_OS_NAME\" == \"macos\" ]; then\n   echo > \"${HOME}/Library/Application Support/Bitcoin\"\n else\n   echo > \"${HOME}/.bitcoin\"\n+  ${NONROOT_DUMMY_DIR}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269743318",
      "id" : 1269743318,
      "in_reply_to_id" : 1262333855,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Lrr7W",
      "original_commit_id" : "fe9da891eb7a7440b6c23d63e129525fe26f8f0e",
      "original_line" : 65,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "ci/test/06_script_b.sh",
      "position" : null,
      "pull_request_review_id" : 1539725070,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269743318/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-20T17:07:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269743318",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269749581"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269749581"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nope leftover from last iteration sorry, removing ",
      "commit_id" : "068b523ee7720e6a392efc294ff89bf936a3e2ac",
      "created_at" : "2023-07-20T17:13:17Z",
      "diff_hunk" : "@@ -0,0 +1,69 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test running bitcoind with -reindex from a read-only blockstore\n+- Start two nodes, generate blocks, then restart with -reindex after setting blk files to read-only\n+\"\"\"\n+\n+import stat\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+class BlockstoreReindexTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.extra_args = [\n+            [],",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269749581",
      "id" : 1269749581,
      "in_reply_to_id" : 1269740640,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LrtdN",
      "original_commit_id" : "08b275c6d27f06cd7d2580b4c0200e32d5b7b1b6",
      "original_line" : 18,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex_readonly.py",
      "position" : null,
      "pull_request_review_id" : 1539734487,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269749581/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-20T17:13:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269749581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269874331"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269874331"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It looks like the PR description section about `skip_if_root` is now out of date.",
      "commit_id" : "068b523ee7720e6a392efc294ff89bf936a3e2ac",
      "created_at" : "2023-07-20T19:22:03Z",
      "diff_hunk" : "@@ -936,6 +936,9 @@ def skip_if_no_external_signer(self):\n         if not self.is_external_signer_compiled():\n             raise SkipTest(\"external signer support has not been compiled.\")\n \n+    def is_unix_root(self):\n+        return os.name != 'nt' and os.getuid() == 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269874331",
      "id" : 1269874331,
      "line" : 940,
      "node_id" : "PRRC_kwDOABII585LsL6b",
      "original_commit_id" : "068b523ee7720e6a392efc294ff89bf936a3e2ac",
      "original_line" : 940,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/test_framework.py",
      "position" : 5,
      "pull_request_review_id" : 1539942275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269874331/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-20T19:31:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269874331",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269876108"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269876108"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If you retouch, I think the logging for the assertions inside this `is_unix_root` conditional should be logged as `info` (maybe all the debug logging in this file currently could be info).",
      "commit_id" : "068b523ee7720e6a392efc294ff89bf936a3e2ac",
      "created_at" : "2023-07-20T19:23:55Z",
      "diff_hunk" : "@@ -0,0 +1,50 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test running bitcoind with -reindex from a read-only blockstore\n+- Start two nodes, generate blocks, then restart with -reindex after setting blk files to read-only\n+\"\"\"\n+\n+import stat\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+class BlockstoreReindexTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+        self.extra_args = [[\"-fastprune\"]]\n+\n+    def reindex_readonly(self):\n+        self.log.debug(\"Generate block big enough to start second block file\")\n+        fastprune_blockfile_size = 0x10000\n+        opreturn = \"6a\"\n+        nulldata = fastprune_blockfile_size * \"ff\"\n+        self.generateblock(self.nodes[0], output=f\"raw({opreturn}{nulldata})\", transactions=[])\n+        block_count = self.nodes[0].getblockcount()\n+        self.stop_node(0)\n+\n+        assert (self.nodes[0].chain_path / \"blocks\" / \"blk00000.dat\").exists()\n+        assert (self.nodes[0].chain_path / \"blocks\" / \"blk00001.dat\").exists()\n+\n+        self.log.debug(\"Make the first block file read-only\")\n+        (self.nodes[0].chain_path / \"blocks\" / \"blk00000.dat\").chmod(stat.S_IREAD)\n+\n+        self.log.debug(\"Attempt to restart and reindex the node with the read-only block file\")\n+        if self.is_unix_root():\n+            self.log.debug(\"Running as unix root, reindex with no errors expected\")\n+            self.start_node(0, extra_args=['-reindex', '-fastprune'])\n+            assert_equal(self.nodes[0].getblockcount(), block_count)\n+        else:\n+            self.log.debug(\"Running as non-root user, will fail opening read-only file\")\n+            with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n+                self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n+                    expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269876108",
      "id" : 1269876108,
      "line" : 43,
      "node_id" : "PRRC_kwDOABII585LsMWM",
      "original_commit_id" : "068b523ee7720e6a392efc294ff89bf936a3e2ac",
      "original_line" : 43,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "test/functional/feature_reindex_readonly.py",
      "position" : 43,
      "pull_request_review_id" : 1539942275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269876108/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-20T19:31:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269876108",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269884246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269884246"
         }
      },
      "author_association" : "MEMBER",
      "body" : "thank you, fixed",
      "commit_id" : "068b523ee7720e6a392efc294ff89bf936a3e2ac",
      "created_at" : "2023-07-20T19:32:51Z",
      "diff_hunk" : "@@ -936,6 +936,9 @@ def skip_if_no_external_signer(self):\n         if not self.is_external_signer_compiled():\n             raise SkipTest(\"external signer support has not been compiled.\")\n \n+    def is_unix_root(self):\n+        return os.name != 'nt' and os.getuid() == 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1269884246",
      "id" : 1269884246,
      "in_reply_to_id" : 1269874331,
      "line" : 940,
      "node_id" : "PRRC_kwDOABII585LsOVW",
      "original_commit_id" : "068b523ee7720e6a392efc294ff89bf936a3e2ac",
      "original_line" : 940,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/test_framework.py",
      "position" : 5,
      "pull_request_review_id" : 1539957424,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269884246/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-20T19:32:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269884246",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> > > Just curious, did you try using `chattr +i` to set blockfile as **immutable** ? May break other stuff, I don't know...\r\n> > \r\n> > \r\n> > Bold strategy, Cotton let's see if it pays off: [cd394b6](https://github.com/bitcoin/bitcoin/commit/cd394b637f98b79dc3a4623ec4b970137ee2c589)\r\n> \r\n> _Narrator: \"It didn't.\"_ https://cirrus-ci.com/build/4907092587315200\r\n> \r\n> Seemed like a good idea though but bitcoind is still able to open the \"immutable\" files in write mode thinking\r\n\r\nI've just tried doing that locally and the test seems to have worked. The error shows up in the log as expected. Maybe it's just an issue with the larger test that it was part of at the time of that commit?\r\n\r\nPersonally, I'd rather not need to change the CI environment like this just to run this test.",
      "created_at" : "2023-07-25T21:42:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1650601548",
      "id" : 1650601548,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585iYi5M",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1650601548/reactions"
      },
      "updated_at" : "2023-07-25T21:42:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1650601548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@achow101 I found the CI environment changes useful for making https://github.com/bitcoin/bitcoin/pull/28116 work as well (to take the review feedback in https://github.com/bitcoin/bitcoin/pull/28116#discussion_r1269857579) and based it on them.",
      "created_at" : "2023-07-25T21:51:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27850#issuecomment-1650609478",
      "id" : 1650609478,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27850",
      "node_id" : "IC_kwDOABII585iYk1G",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1650609478/reactions"
      },
      "updated_at" : "2023-07-25T21:53:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1650609478",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
