[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18163 (descriptors: Use xpub at last hardened step if possible by achow101)\n* #16710 (build: Enable -Wsuggest-override if available by hebasto)\n* #16463 ([BIP 174] Implement serialization support for GLOBAL_XPUB field. by achow101)\n* #16116 (Avoid unnecessary signing provider copies on descriptor expansion by Empact)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-02-25T02:20:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18204#issuecomment-590647940",
      "id" : 590647940,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18204",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MDY0Nzk0MA==",
      "updated_at" : "2020-02-25T22:27:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/590647940",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18204#discussion_r383778842"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18204"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/383778842"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`global_pos` and `internal_pos` could use documentation. Would it make sense to cache all pubkeys (for a given position) in one operation?",
      "commit_id" : "a10bb995b807332986fabb8785a480a4bb38220e",
      "created_at" : "2020-02-25T10:08:02Z",
      "diff_hunk" : "@@ -13,6 +13,18 @@\n \n #include <vector>\n \n+// Cache for pre-computed descriptor things\n+class DescriptorCache {\n+private:\n+    unsigned int m_pos_begin;\n+    std::vector<std::vector<CPubKey>> m_pubkey_cache;\n+\n+public:\n+    DescriptorCache() : m_pos_begin(0) {}\n+    DescriptorCache(int begin_pos) : m_pos_begin(begin_pos) {}\n+    bool CachePubKey(unsigned int cache_pos, const CPubKey& pubkey);\n+    bool GetCachedPubKey(unsigned int global_pos, unsigned int internal_pos, CPubKey& pubkey) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18204#discussion_r383778842",
      "id" : 383778842,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc3ODg0Mg==",
      "original_commit_id" : "13b526665646f5c3593fed996df4eabbfb64f7b4",
      "original_position" : 14,
      "path" : "src/script/descriptor.h",
      "position" : 15,
      "pull_request_review_id" : 364014093,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18204",
      "updated_at" : "2020-02-25T10:48:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/383778842",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fixed the assertion. Travis seems to be seeing a memory leak but I'm having trouble figuring out where that is.",
      "created_at" : "2020-02-25T20:10:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18204#issuecomment-591045213",
      "id" : 591045213,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18204",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MTA0NTIxMw==",
      "updated_at" : "2020-02-25T20:10:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/591045213",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've reworked how the caching works to get rid of the `global_pos` and `internal_pos` stuff.\r\n\r\nInstead of having `ExpandHelper` go through the cache and find the pubkeys, we pass the cache into the `PubkeyProvider`s and let them do the cache lookups. Since really only `BIP32PubkeyProvider` uses the cache, we can get rid of the position stuff by having it store only xpubs in a map. So for all derived keys, we store their `KeyOriginInfo` and xpub so that later the `BIP32PubkeyProvider` can look them up. The last parent is still being stored so that additional derivation can occur.\r\n\r\nThis consolidates cache reads and writes and encapsulates them in the classes that actually use the cache.",
      "created_at" : "2020-02-26T01:17:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18204#issuecomment-591184682",
      "id" : 591184682,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18204",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MTE4NDY4Mg==",
      "updated_at" : "2020-02-26T01:17:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/591184682",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
