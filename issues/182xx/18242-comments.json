[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18165 (Consolidate service flag bit-to-name conversion to a shared serviceFlagToStr function by luke-jr)\n* #18044 (Use wtxid for transaction relay by sdaftuar)\n* #16442 (Serve BIP 157 compact filters by jimpo)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-03-02T16:41:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18242#issuecomment-593496115",
      "id" : 593496115,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18242",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MzQ5NjExNQ==",
      "updated_at" : "2020-03-02T16:41:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/593496115",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.",
      "created_at" : "2020-03-02T22:54:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18242#issuecomment-593665514",
      "id" : 593665514,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18242",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MzY2NTUxNA==",
      "updated_at" : "2020-03-02T22:54:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/593665514",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept:\r\n\r\nConcept ACK - thanks for working on this!\r\n\r\n---\r\n\r\nImplementation:\r\n\r\nSome comments after first read-through of the implementation:\r\n\r\n**1. Uninitialized read in case of invalid command name**\r\n\r\nIn the \"Invalid command name\" case then the read and use of the uninitialized variable `size_or_shortid` will take place on L808:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/73db845771628983c7f288ead73cd3a8793f8c6a/src/net.cpp#L802-L808\r\n\r\n_Shameless plug:_ For those interested in killing the uninitialised read bug class, consider reviewing:\r\n* #17639 â tests: Add `make check-valgrind` to run the unit tests under Valgrind\r\n* #17895 â build: Enable Clang's `-Wconditional-uninitialized` to warn on potential uninitialized reads\r\n\r\n**2. Use of a locale dependent formatting function `itostr(â¦)`**\r\n\r\n`itostr` is used here:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/73db845771628983c7f288ead73cd3a8793f8c6a/src/net.cpp#L819-L823\r\n\r\n`itostr` calls `strprintf` which calls `tfm::format` (tinyformat) which uses the standard C++ formatting stringstream interface which is locale dependent.\r\n\r\n_Shameless plug:_ For those interested in permanently killing the locale dependency bug class, consider reviewing:\r\n* #18124 â init: Clarify C and C++ locale assumptions. Add locale sanity checks to verify assumptions at run-time\r\n* #18126 â tests: Add fuzzing harness testing the locale independence of the strencodings.h functions\r\n* #18147 â qt: Kill the locale dependency bug class by not allowing Qt to mess with `LC_NUMERIC`\r\n\r\n**3. `std::exception` vs expected `std::ios_base::failure`**\r\n\r\nA question: I notice that `std::exception` is guarded against instead of the expected `std::ios_base::failure` in case of deserialization errors throughout this PR. Is it intentional? :)\r\n\r\nIt is somewhat related to another deserialization-exception anomaly I mailed you about back in October last year:\r\n\r\n```\r\nWhen fuzzing some deserialization code I noticed that `CExtKey::Unserialize(...)`\r\nand `CExtPubKey::(...)` throw `std::runtime_error` instead of the\r\n`std::ios_base::failure` I expected in case of deserialization errors.\r\n\r\nI saw that this code was written by you originally: do you remember if there\r\nwas a particular reason to go with `std::runtime_error` instead of\r\n`std::ios_base::failure`? If not, do you think it would be safe to change it? :)\r\n\r\nThe commits in question:\r\n*Â https://github.com/bitcoin/bitcoin/commit/07685d1bc1b0b815c00a68a5b7b335ffa0d4d90d\r\n*Â https://github.com/bitcoin/bitcoin/commit/90604f16af63ec066d6561337f476ccd8acec326\r\n```\r\n\r\nThese deviations from the expected`std::ios_base::failure` puzzle me - are they intentional, and if so why? I want to learn :)",
      "created_at" : "2020-03-02T23:22:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18242#issuecomment-593674721",
      "id" : 593674721,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18242",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MzY3NDcyMQ==",
      "updated_at" : "2020-03-02T23:22:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/593674721",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Very nice to see that the `V2TransportDeserializer` is fuzzed already from birth! I hope that fuzz testing will be as natural as unit testing when introducing security critical code in the future. Kudos for taking care of it here!\r\n\r\nA small comment regarding the fuzzer:\r\n\r\nI think the assertion â¦\r\n\r\n```\r\nassert(msg.m_raw_message_size == CMessageHeader::HEADER_SIZE + msg.m_message_size);\r\n```\r\n\r\nâ¦ in the fuzzing harness is guaranteed to hold for `V1TransportDeserializer` but not for `V2TransportDeserializer`.\r\n\r\nCould that be the case? :)",
      "created_at" : "2020-03-02T23:36:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18242#issuecomment-593678921",
      "id" : 593678921,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18242",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MzY3ODkyMQ==",
      "updated_at" : "2020-03-02T23:53:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/593678921",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
