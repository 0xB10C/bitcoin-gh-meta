[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r385714744"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385714744"
         }
      },
      "author_association" : "NONE",
      "body" : "```suggestion\r\n    // Filter 1 is reserved as an option to include all filters.\r\n```",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-02-28T14:09:53Z",
      "diff_hunk" : "@@ -88,6 +88,8 @@ constexpr uint32_t BASIC_FILTER_M = 784931;\n enum class BlockFilterType : uint8_t\n {\n     BASIC = 0,\n+    // Floter 1 is reserved as option to include all filters",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r385714744",
      "id" : 385714744,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcxNDc0NA==",
      "original_commit_id" : "19b9959a3c02dc9cb98740d5740e709b971e0c03",
      "original_position" : 4,
      "path" : "src/blockfilter.h",
      "position" : null,
      "pull_request_review_id" : 366421997,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385714744",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/9844978?v=4",
         "events_url" : "https://api.github.com/users/molnard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/molnard/followers",
         "following_url" : "https://api.github.com/users/molnard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/molnard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/molnard",
         "id" : 9844978,
         "login" : "molnard",
         "node_id" : "MDQ6VXNlcjk4NDQ5Nzg=",
         "organizations_url" : "https://api.github.com/users/molnard/orgs",
         "received_events_url" : "https://api.github.com/users/molnard/received_events",
         "repos_url" : "https://api.github.com/users/molnard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/molnard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/molnard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/molnard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r385715107"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385715107"
         }
      },
      "author_association" : "NONE",
      "body" : "```suggestion\r\n        // Using the same filter params as basic type.\r\n```",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-02-28T14:10:41Z",
      "diff_hunk" : "@@ -309,6 +347,13 @@ bool BlockFilter::BuildParams(GCSFilter::Params& params) const\n         params.m_P = BASIC_FILTER_P;\n         params.m_M = BASIC_FILTER_M;\n         return true;\n+    case BlockFilterType::P2WPKH:\n+        params.m_siphash_k0 = m_block_hash.GetUint64(0);\n+        params.m_siphash_k1 = m_block_hash.GetUint64(1);\n+        // using the same filter params as basic type",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r385715107",
      "id" : 385715107,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcxNTEwNw==",
      "original_commit_id" : "19b9959a3c02dc9cb98740d5740e709b971e0c03",
      "original_position" : 75,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 366421997,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385715107",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/9844978?v=4",
         "events_url" : "https://api.github.com/users/molnard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/molnard/followers",
         "following_url" : "https://api.github.com/users/molnard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/molnard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/molnard",
         "id" : 9844978,
         "login" : "molnard",
         "node_id" : "MDQ6VXNlcjk4NDQ5Nzg=",
         "organizations_url" : "https://api.github.com/users/molnard/orgs",
         "received_events_url" : "https://api.github.com/users/molnard/received_events",
         "repos_url" : "https://api.github.com/users/molnard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/molnard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/molnard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/molnard"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Note this PR and its accompanying issue (https://github.com/bitcoin/bitcoin/issues/18221) conforms to the original BIP157 filter extensibility proposal (https://github.com/bitcoin/bips/blob/master/bip-0157.mediawiki#filter-types) and to the proposal I submitted about filter combinations too: https://github.com/bitcoin/bitcoin/issues/18221",
      "created_at" : "2020-02-28T14:40:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-592542243",
      "id" : 592542243,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MjU0MjI0Mw==",
      "updated_at" : "2020-02-28T14:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592542243",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/9156103?v=4",
         "events_url" : "https://api.github.com/users/nopara73/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nopara73/followers",
         "following_url" : "https://api.github.com/users/nopara73/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nopara73/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nopara73",
         "id" : 9156103,
         "login" : "nopara73",
         "node_id" : "MDQ6VXNlcjkxNTYxMDM=",
         "organizations_url" : "https://api.github.com/users/nopara73/orgs",
         "received_events_url" : "https://api.github.com/users/nopara73/received_events",
         "repos_url" : "https://api.github.com/users/nopara73/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nopara73/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nopara73/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nopara73"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "For the record there is a discussion about that probably it should combine both P2WPKH and P2WSH scripts: https://github.com/bitcoin/bitcoin/issues/18222#issuecomment-592631517",
      "created_at" : "2020-02-28T17:40:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-592644104",
      "id" : 592644104,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MjY0NDEwNA==",
      "updated_at" : "2020-02-28T17:40:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592644104",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/9156103?v=4",
         "events_url" : "https://api.github.com/users/nopara73/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nopara73/followers",
         "following_url" : "https://api.github.com/users/nopara73/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nopara73/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nopara73",
         "id" : 9156103,
         "login" : "nopara73",
         "node_id" : "MDQ6VXNlcjkxNTYxMDM=",
         "organizations_url" : "https://api.github.com/users/nopara73/orgs",
         "received_events_url" : "https://api.github.com/users/nopara73/received_events",
         "repos_url" : "https://api.github.com/users/nopara73/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nopara73/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nopara73/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nopara73"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386119285"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386119285"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`enumeration value 'INVALID' not handled in switch`. I guess in this case `default: assert(false)` would be appropriate?",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-01T15:58:55Z",
      "diff_hunk" : "@@ -297,7 +329,15 @@ BlockFilter::BlockFilter(BlockFilterType filter_type, const CBlock& block, const\n     if (!BuildParams(params)) {\n         throw std::invalid_argument(\"unknown filter_type\");\n     }\n-    m_filter = GCSFilter(params, BasicFilterElements(block, block_undo));\n+\n+    switch (m_filter_type) {\n+    case BlockFilterType::BASIC:\n+        m_filter = GCSFilter(params, BasicFilterElements(block, block_undo));\n+        break;\n+    case BlockFilterType::V0:\n+        m_filter = GCSFilter(params, V0FilterElements(block, block_undo));\n+        break;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386119285",
      "id" : 386119285,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjExOTI4NQ==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 66,
      "path" : "src/blockfilter.cpp",
      "position" : 72,
      "pull_request_review_id" : 366868739,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386119285",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386120193"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386120193"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This case is identical to `BlockFilterType::BASIC`, so you can avoid the duplication.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-01T16:12:43Z",
      "diff_hunk" : "@@ -309,6 +349,13 @@ bool BlockFilter::BuildParams(GCSFilter::Params& params) const\n         params.m_P = BASIC_FILTER_P;\n         params.m_M = BASIC_FILTER_M;\n         return true;\n+    case BlockFilterType::V0:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386120193",
      "id" : 386120193,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyMDE5Mw==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 74,
      "path" : "src/blockfilter.cpp",
      "position" : 79,
      "pull_request_review_id" : 366868739,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386120193",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386120440"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386120440"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Instead of this new function, maybe just add these four lines to `BasicFilterElements` (after the `OP_RETURN` check) and give that two additional arguments `bool only_segwit = true, int witness_version = 0`",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-01T16:16:26Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386120440",
      "id" : 386120440,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyMDQ0MA==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 31,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 366868739,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386120440",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386120920"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386120920"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The `basic` filter undo code doesn't have a check for `OP_RETURN`. @jimpo was that because the difference on undo data is negligible? I suppose that's not the case here though, but then I'd prefer adding OP_RETURN as well for readability.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-01T16:23:42Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;\n+            elements.emplace(scriptPubKey.begin(), scriptPubKey.end());\n+        }\n+    }\n+\n+    for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n+        for (const Coin& prevout : tx_undo.vprevout) {\n+            const CScript& scriptPubKey = prevout.out.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386120920",
      "id" : 386120920,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyMDkyMA==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 42,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 366868739,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386120920",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386153251"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386153251"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ah good point, will fix.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-01T23:42:59Z",
      "diff_hunk" : "@@ -309,6 +349,13 @@ bool BlockFilter::BuildParams(GCSFilter::Params& params) const\n         params.m_P = BASIC_FILTER_P;\n         params.m_M = BASIC_FILTER_M;\n         return true;\n+    case BlockFilterType::V0:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386153251",
      "id" : 386153251,
      "in_reply_to_id" : 386120193,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE1MzI1MQ==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 74,
      "path" : "src/blockfilter.cpp",
      "position" : 79,
      "pull_request_review_id" : 366898357,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386153251",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386153357"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386153357"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's handled in the code above so I left it out, but for best practice I agree so I'll add an assert as suggested.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-01T23:44:29Z",
      "diff_hunk" : "@@ -297,7 +329,15 @@ BlockFilter::BlockFilter(BlockFilterType filter_type, const CBlock& block, const\n     if (!BuildParams(params)) {\n         throw std::invalid_argument(\"unknown filter_type\");\n     }\n-    m_filter = GCSFilter(params, BasicFilterElements(block, block_undo));\n+\n+    switch (m_filter_type) {\n+    case BlockFilterType::BASIC:\n+        m_filter = GCSFilter(params, BasicFilterElements(block, block_undo));\n+        break;\n+    case BlockFilterType::V0:\n+        m_filter = GCSFilter(params, V0FilterElements(block, block_undo));\n+        break;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386153357",
      "id" : 386153357,
      "in_reply_to_id" : 386119285,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE1MzM1Nw==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 66,
      "path" : "src/blockfilter.cpp",
      "position" : 72,
      "pull_request_review_id" : 366898468,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386153357",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386153713"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386153713"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Is `opreturn` not already filtered out with the witness check?\r\nOr you mean to add the `opreturn` check to the blockundo on the code of the `basic` filter type?",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-01T23:48:57Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;\n+            elements.emplace(scriptPubKey.begin(), scriptPubKey.end());\n+        }\n+    }\n+\n+    for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n+        for (const Coin& prevout : tx_undo.vprevout) {\n+            const CScript& scriptPubKey = prevout.out.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386153713",
      "id" : 386153713,
      "in_reply_to_id" : 386120920,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE1MzcxMw==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 42,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 366898833,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386153713",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386154075"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386154075"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In that case the method name should change to `BuildFilterElements` no?",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-01T23:53:17Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386154075",
      "id" : 386154075,
      "in_reply_to_id" : 386120440,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE1NDA3NQ==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 31,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 366899206,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386154075",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386249968"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386249968"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If you combine this with the code from the `basic` filter then it's probably more readable to `OP_RETURN` back for that as well (assuming that doesn't break anything). For the `v0` filter it indeed doesn't matter.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-02T08:26:58Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;\n+            elements.emplace(scriptPubKey.begin(), scriptPubKey.end());\n+        }\n+    }\n+\n+    for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n+        for (const Coin& prevout : tx_undo.vprevout) {\n+            const CScript& scriptPubKey = prevout.out.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386249968",
      "id" : 386249968,
      "in_reply_to_id" : 386120920,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjI0OTk2OA==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 42,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 367015351,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386249968",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "You may want to squash all this into 1 commit (perhaps a separate commit to add `OP_RETURN` to the `basic` undo filter).",
      "created_at" : "2020-03-02T08:31:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-593281427",
      "id" : 593281427,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MzI4MTQyNw==",
      "updated_at" : "2020-03-02T08:31:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/593281427",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386356988"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386356988"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Shall I add the `OP_RETURN ` check also on the spent script then? I agree with you I see no reason why it's omitted.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-02T12:11:56Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;\n+            elements.emplace(scriptPubKey.begin(), scriptPubKey.end());\n+        }\n+    }\n+\n+    for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n+        for (const Coin& prevout : tx_undo.vprevout) {\n+            const CScript& scriptPubKey = prevout.out.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386356988",
      "id" : 386356988,
      "in_reply_to_id" : 386120920,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM1Njk4OA==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 42,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 367152205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386356988",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386357964"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386357964"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Any particular reason why defaulting segwit to true?",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-02T12:14:24Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386357964",
      "id" : 386357964,
      "in_reply_to_id" : 386120440,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM1Nzk2NA==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 31,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 367153538,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386357964",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386392290"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386392290"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-02T13:30:14Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;\n+            elements.emplace(scriptPubKey.begin(), scriptPubKey.end());\n+        }\n+    }\n+\n+    for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n+        for (const Coin& prevout : tx_undo.vprevout) {\n+            const CScript& scriptPubKey = prevout.out.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386392290",
      "id" : 386392290,
      "in_reply_to_id" : 386120920,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM5MjI5MA==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 42,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 367197446,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386392290",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386392348"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386392348"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-02T13:30:20Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386392348",
      "id" : 386392348,
      "in_reply_to_id" : 386120440,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM5MjM0OA==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 31,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 367197520,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386392348",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386400668"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386400668"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No, it should be `false` I think (basic filter is the default)",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-02T13:46:29Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386400668",
      "id" : 386400668,
      "in_reply_to_id" : 386120440,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjQwMDY2OA==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 31,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 367208262,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386400668",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you @Sjors for your helpful review, I will squash the commits when there is a general ack.",
      "created_at" : "2020-03-02T21:41:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-593637564",
      "id" : 593637564,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MzYzNzU2NA==",
      "updated_at" : "2020-03-02T21:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/593637564",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tend to NACK. I fail to see a use case for this, and a missing use case does not justify the time spent on code review and the resulting complexity/user confusion and maintenance overhead when this is merged.",
      "created_at" : "2020-03-03T11:25:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-593903472",
      "id" : 593903472,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MzkwMzQ3Mg==",
      "updated_at" : "2020-03-03T11:25:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/593903472",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "What do you mean no use case? It's already being used and in production for 1.5 years now.",
      "created_at" : "2020-03-03T17:17:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-594065664",
      "id" : 594065664,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NDA2NTY2NA==",
      "updated_at" : "2020-03-03T17:17:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/594065664",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/9156103?v=4",
         "events_url" : "https://api.github.com/users/nopara73/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nopara73/followers",
         "following_url" : "https://api.github.com/users/nopara73/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nopara73/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nopara73",
         "id" : 9156103,
         "login" : "nopara73",
         "node_id" : "MDQ6VXNlcjkxNTYxMDM=",
         "organizations_url" : "https://api.github.com/users/nopara73/orgs",
         "received_events_url" : "https://api.github.com/users/nopara73/received_events",
         "repos_url" : "https://api.github.com/users/nopara73/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nopara73/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nopara73/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nopara73"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept NACK if I understand this correctly.\r\n\r\nIf we assume everything will be Segwit eventually, this filter will just become redundant with the basic one?\r\n\r\nIf the goal is to reduce the initial download, couldn't the wallet just start with its birthdate block anyway?\r\n\r\nPlus, remotely-accessible filters are still a bad idea in the first place, which this seems to presuppose...",
      "created_at" : "2020-03-04T15:12:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-594588223",
      "id" : 594588223,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NDU4ODIyMw==",
      "updated_at" : "2020-03-04T15:12:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/594588223",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> What do you mean no use case? It's already being used and in production for 1.5 years now.\r\n\r\nIf there is a use case internal to the Wasabi wallet, that is fine. However, for anyone else (and probably also Wasabi wallet), they are better off using the existing BIP 158 filters.",
      "created_at" : "2020-03-04T15:18:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-594593320",
      "id" : 594593320,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NDU5MzMyMA==",
      "updated_at" : "2020-03-04T15:18:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/594593320",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387735322"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387735322"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is this a bugfix to the existing code? Please PR it separately if so.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-04T15:20:07Z",
      "diff_hunk" : "@@ -257,60 +257,46 @@ const std::string& ListBlockFilterTypes()\n     return type_list;\n }\n \n-static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n-                                                 const CBlockUndo& block_undo)\n+static GCSFilter::ElementSet BuildFilterElements(const CBlock& block,\n+                                                 const CBlockUndo& block_undo,\n+                                                 bool only_segwit = true,\n+                                                 int witness_version = 0)\n {\n     GCSFilter::ElementSet elements;\n \n     for (const CTransactionRef& tx : block.vtx) {\n         for (const CTxOut& txout : tx->vout) {\n             const CScript& script = txout.scriptPubKey;\n             if (script.empty() || script[0] == OP_RETURN) continue;\n+            if (only_segwit) {\n+                int witnessversion;\n+                std::vector<unsigned char> witnessprogram;\n+                if (!script.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+                if (witnessversion != witness_version) continue;\n+                if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue; // specific v0 checks\n+            }\n             elements.emplace(script.begin(), script.end());\n         }\n     }\n \n     for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n         for (const Coin& prevout : tx_undo.vprevout) {\n             const CScript& script = prevout.out.scriptPubKey;\n-            if (script.empty()) continue;\n+            if (script.empty() || script[0] == OP_RETURN) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387735322",
      "id" : 387735322,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzczNTMyMg==",
      "original_commit_id" : "3055ac89c1032c2e9f35e4894d6f61ef960a3ef8",
      "original_position" : 32,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 368867532,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387735322",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387736534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387736534"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please use `case BlockFilterType::INVALID` here so new enum values warn at compile time.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-04T15:21:53Z",
      "diff_hunk" : "@@ -297,12 +315,22 @@ BlockFilter::BlockFilter(BlockFilterType filter_type, const CBlock& block, const\n     if (!BuildParams(params)) {\n         throw std::invalid_argument(\"unknown filter_type\");\n     }\n-    m_filter = GCSFilter(params, BasicFilterElements(block, block_undo));\n+\n+    switch (m_filter_type) {\n+    case BlockFilterType::BASIC:\n+        m_filter = GCSFilter(params, BuildFilterElements(block, block_undo));\n+        break;\n+    case BlockFilterType::V0:\n+        m_filter = GCSFilter(params, BuildFilterElements(block, block_undo, true));\n+        break;\n+    default: assert(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387736534",
      "id" : 387736534,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzczNjUzNA==",
      "original_commit_id" : "dc1fe756fc5148b467932fb76888393270134c1d",
      "original_position" : 72,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 368869081,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387736534",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387744637"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387744637"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Let's keep the order BASIC,V0 here?",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-04T15:32:49Z",
      "diff_hunk" : "@@ -297,12 +315,22 @@ BlockFilter::BlockFilter(BlockFilterType filter_type, const CBlock& block, const\n     if (!BuildParams(params)) {\n         throw std::invalid_argument(\"unknown filter_type\");\n     }\n-    m_filter = GCSFilter(params, BasicFilterElements(block, block_undo));\n+\n+    switch (m_filter_type) {\n+    case BlockFilterType::BASIC:\n+        m_filter = GCSFilter(params, BuildFilterElements(block, block_undo));\n+        break;\n+    case BlockFilterType::V0:\n+        m_filter = GCSFilter(params, BuildFilterElements(block, block_undo, true));\n+        break;\n+    default: assert(false);\n+    }\n }\n \n bool BlockFilter::BuildParams(GCSFilter::Params& params) const\n {\n     switch (m_filter_type) {\n+    case BlockFilterType::V0:\n     case BlockFilterType::BASIC:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387744637",
      "id" : 387744637,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc0NDYzNw==",
      "original_commit_id" : "dc1fe756fc5148b467932fb76888393270134c1d",
      "original_position" : 80,
      "path" : "src/blockfilter.cpp",
      "position" : 78,
      "pull_request_review_id" : 368879370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387744637",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387874789"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387874789"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Actually, it's it absolutely impossible to encounter an `OP_RETURN` here? These are spent pubkeys, right? You can't spend an `OP_RETURN`...",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-04T19:10:09Z",
      "diff_hunk" : "@@ -257,60 +257,46 @@ const std::string& ListBlockFilterTypes()\n     return type_list;\n }\n \n-static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n-                                                 const CBlockUndo& block_undo)\n+static GCSFilter::ElementSet BuildFilterElements(const CBlock& block,\n+                                                 const CBlockUndo& block_undo,\n+                                                 bool only_segwit = true,\n+                                                 int witness_version = 0)\n {\n     GCSFilter::ElementSet elements;\n \n     for (const CTransactionRef& tx : block.vtx) {\n         for (const CTxOut& txout : tx->vout) {\n             const CScript& script = txout.scriptPubKey;\n             if (script.empty() || script[0] == OP_RETURN) continue;\n+            if (only_segwit) {\n+                int witnessversion;\n+                std::vector<unsigned char> witnessprogram;\n+                if (!script.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+                if (witnessversion != witness_version) continue;\n+                if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue; // specific v0 checks\n+            }\n             elements.emplace(script.begin(), script.end());\n         }\n     }\n \n     for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n         for (const Coin& prevout : tx_undo.vprevout) {\n             const CScript& script = prevout.out.scriptPubKey;\n-            if (script.empty()) continue;\n+            if (script.empty() || script[0] == OP_RETURN) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387874789",
      "id" : 387874789,
      "in_reply_to_id" : 387735322,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg3NDc4OQ==",
      "original_commit_id" : "3055ac89c1032c2e9f35e4894d6f61ef960a3ef8",
      "original_position" : 32,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 369046647,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387874789",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387920404"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387920404"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree but this is in response to this comment (for readability)\r\nhttps://github.com/bitcoin/bitcoin/pull/18223#discussion_r386120920\r\n\r\n",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-04T20:38:17Z",
      "diff_hunk" : "@@ -257,60 +257,46 @@ const std::string& ListBlockFilterTypes()\n     return type_list;\n }\n \n-static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n-                                                 const CBlockUndo& block_undo)\n+static GCSFilter::ElementSet BuildFilterElements(const CBlock& block,\n+                                                 const CBlockUndo& block_undo,\n+                                                 bool only_segwit = true,\n+                                                 int witness_version = 0)\n {\n     GCSFilter::ElementSet elements;\n \n     for (const CTransactionRef& tx : block.vtx) {\n         for (const CTxOut& txout : tx->vout) {\n             const CScript& script = txout.scriptPubKey;\n             if (script.empty() || script[0] == OP_RETURN) continue;\n+            if (only_segwit) {\n+                int witnessversion;\n+                std::vector<unsigned char> witnessprogram;\n+                if (!script.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+                if (witnessversion != witness_version) continue;\n+                if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue; // specific v0 checks\n+            }\n             elements.emplace(script.begin(), script.end());\n         }\n     }\n \n     for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n         for (const Coin& prevout : tx_undo.vprevout) {\n             const CScript& script = prevout.out.scriptPubKey;\n-            if (script.empty()) continue;\n+            if (script.empty() || script[0] == OP_RETURN) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387920404",
      "id" : 387920404,
      "in_reply_to_id" : 387735322,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkyMDQwNA==",
      "original_commit_id" : "3055ac89c1032c2e9f35e4894d6f61ef960a3ef8",
      "original_position" : 32,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 369104563,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387920404",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387928903"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387928903"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think this makes it any more readable...\r\n\r\nPrefer a comment simply stating that it is impossible.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-04T20:55:34Z",
      "diff_hunk" : "@@ -257,60 +257,46 @@ const std::string& ListBlockFilterTypes()\n     return type_list;\n }\n \n-static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n-                                                 const CBlockUndo& block_undo)\n+static GCSFilter::ElementSet BuildFilterElements(const CBlock& block,\n+                                                 const CBlockUndo& block_undo,\n+                                                 bool only_segwit = true,\n+                                                 int witness_version = 0)\n {\n     GCSFilter::ElementSet elements;\n \n     for (const CTransactionRef& tx : block.vtx) {\n         for (const CTxOut& txout : tx->vout) {\n             const CScript& script = txout.scriptPubKey;\n             if (script.empty() || script[0] == OP_RETURN) continue;\n+            if (only_segwit) {\n+                int witnessversion;\n+                std::vector<unsigned char> witnessprogram;\n+                if (!script.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+                if (witnessversion != witness_version) continue;\n+                if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue; // specific v0 checks\n+            }\n             elements.emplace(script.begin(), script.end());\n         }\n     }\n \n     for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n         for (const Coin& prevout : tx_undo.vprevout) {\n             const CScript& script = prevout.out.scriptPubKey;\n-            if (script.empty()) continue;\n+            if (script.empty() || script[0] == OP_RETURN) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387928903",
      "id" : 387928903,
      "in_reply_to_id" : 387735322,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkyODkwMw==",
      "original_commit_id" : "3055ac89c1032c2e9f35e4894d6f61ef960a3ef8",
      "original_position" : 32,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 369115380,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387928903",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387936428"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387936428"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Reverted.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-04T21:10:54Z",
      "diff_hunk" : "@@ -257,60 +257,46 @@ const std::string& ListBlockFilterTypes()\n     return type_list;\n }\n \n-static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n-                                                 const CBlockUndo& block_undo)\n+static GCSFilter::ElementSet BuildFilterElements(const CBlock& block,\n+                                                 const CBlockUndo& block_undo,\n+                                                 bool only_segwit = true,\n+                                                 int witness_version = 0)\n {\n     GCSFilter::ElementSet elements;\n \n     for (const CTransactionRef& tx : block.vtx) {\n         for (const CTxOut& txout : tx->vout) {\n             const CScript& script = txout.scriptPubKey;\n             if (script.empty() || script[0] == OP_RETURN) continue;\n+            if (only_segwit) {\n+                int witnessversion;\n+                std::vector<unsigned char> witnessprogram;\n+                if (!script.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+                if (witnessversion != witness_version) continue;\n+                if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue; // specific v0 checks\n+            }\n             elements.emplace(script.begin(), script.end());\n         }\n     }\n \n     for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n         for (const Coin& prevout : tx_undo.vprevout) {\n             const CScript& script = prevout.out.scriptPubKey;\n-            if (script.empty()) continue;\n+            if (script.empty() || script[0] == OP_RETURN) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387936428",
      "id" : 387936428,
      "in_reply_to_id" : 387735322,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkzNjQyOA==",
      "original_commit_id" : "3055ac89c1032c2e9f35e4894d6f61ef960a3ef8",
      "original_position" : 32,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 369125222,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387936428",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@dangershony Let's discuss alternative solutions. If I wouldn't be so biased I think even I would NACK this with P2P in mind. (Not for RPC only though.)",
      "created_at" : "2020-03-05T10:06:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-595141379",
      "id" : 595141379,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTE0MTM3OQ==",
      "updated_at" : "2020-03-05T10:06:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595141379",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/9156103?v=4",
         "events_url" : "https://api.github.com/users/nopara73/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nopara73/followers",
         "following_url" : "https://api.github.com/users/nopara73/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nopara73/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nopara73",
         "id" : 9156103,
         "login" : "nopara73",
         "node_id" : "MDQ6VXNlcjkxNTYxMDM=",
         "organizations_url" : "https://api.github.com/users/nopara73/orgs",
         "received_events_url" : "https://api.github.com/users/nopara73/received_events",
         "repos_url" : "https://api.github.com/users/nopara73/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nopara73/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nopara73/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nopara73"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "After internal discussions we decided to close this PR (thanks for providing review)",
      "created_at" : "2020-03-05T13:34:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-595232096",
      "id" : 595232096,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTIzMjA5Ng==",
      "updated_at" : "2020-03-05T13:34:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595232096",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Thanks for the review everyone!\r\n\r\nThough I am sad about the concept NACK. I had high hopes that with customizable block filters served over RPC, we make a great step towards further separating the wallet functionality from Core, making it more compatible with dedicated wallet software. Wasabi is currently segwit v0 only, and it will be segwit v1 taproot only as soon as possible [similar to lightning wallets too]. Thus the custom filters have a superb use case, as I see it. Basic filters are unfortunately not feasible for Wasabi [even after segwit activation, basic filters are 4.8 GB; compared to 250MB for segwit v0 filters]. I do not know of another way to provide full verification while preserving the \"light client feel\" of Wasabi. This means, very unfortunately, that Wasabi will not have full verification for the foreseeable future, and the current Bitcoin Core integration is only a gimmicky bandwidth savings, not much more.\r\n\r\nAnyway, thank You all for making Core as beautiful as it is, and I am eager to continue the collaboration towards integrating it properly in Wasabi. ",
      "created_at" : "2020-03-05T14:20:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-595253155",
      "id" : 595253155,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTI1MzE1NQ==",
      "updated_at" : "2020-03-05T14:20:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595253155",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/30683012?v=4",
         "events_url" : "https://api.github.com/users/MaxHillebrand/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MaxHillebrand/followers",
         "following_url" : "https://api.github.com/users/MaxHillebrand/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MaxHillebrand/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MaxHillebrand",
         "id" : 30683012,
         "login" : "MaxHillebrand",
         "node_id" : "MDQ6VXNlcjMwNjgzMDEy",
         "organizations_url" : "https://api.github.com/users/MaxHillebrand/orgs",
         "received_events_url" : "https://api.github.com/users/MaxHillebrand/received_events",
         "repos_url" : "https://api.github.com/users/MaxHillebrand/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MaxHillebrand/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MaxHillebrand/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MaxHillebrand"
      }
   }
]
