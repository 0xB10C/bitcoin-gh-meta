[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r148611961"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148611961"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think we can just add an `AssertLockHeld(cs_main)` to the top of this function -- this function only has two callers, both of which lock cs_main before calling.\r\n\r\nEDIT: actually one of the callers does `AssertLockHeld(cs_main)`.",
      "commit_id" : "2e441c91e7806e6ae781ae0b0aefea958079d15b",
      "created_at" : "2017-11-02T17:53:17Z",
      "diff_hunk" : "@@ -2669,8 +2669,11 @@ static bool ReceivedBlockTransactions(const CBlock &block, CValidationState& sta\n                 LOCK(cs_nBlockSequenceId);\n                 pindex->nSequenceId = nBlockSequenceId++;\n             }\n-            if (chainActive.Tip() == nullptr || !setBlockIndexCandidates.value_comp()(pindex, chainActive.Tip())) {\n-                setBlockIndexCandidates.insert(pindex);\n+            {\n+                LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r148611961",
      "id" : 148611961,
      "original_commit_id" : "52b2f34e5818d110d36065c77cd2cc0176d7053d",
      "original_position" : 7,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 73883169,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596",
      "updated_at" : "2017-11-07T18:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148611961",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r148614708"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148614708"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think we should just get rid of this assert.  We can't guarantee chainActive height will not go down.",
      "commit_id" : "2e441c91e7806e6ae781ae0b0aefea958079d15b",
      "created_at" : "2017-11-02T18:02:38Z",
      "diff_hunk" : "@@ -2648,7 +2651,10 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n     if (GetRandInt(10) == 0)\n         txNew.nLockTime = std::max(0, (int)txNew.nLockTime - GetRandInt(100));\n \n-    assert(txNew.nLockTime <= (unsigned int)chainActive.Height());\n+    {\n+        LOCK(cs_main);\n+        assert(txNew.nLockTime <= (unsigned int)chainActive.Height());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r148614708",
      "id" : 148614708,
      "original_commit_id" : "52b2f34e5818d110d36065c77cd2cc0176d7053d",
      "original_position" : 19,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 73886393,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596",
      "updated_at" : "2017-11-07T18:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148614708",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/4360349?v=4",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sdaftuar @morcos Thanks for reviewing. Suggested changes incorporated! :-)",
      "created_at" : "2017-11-02T21:10:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11596#issuecomment-341559204",
      "id" : 341559204,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11596",
      "updated_at" : "2017-11-02T21:10:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341559204",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r148902549"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148902549"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Remove, all callers have `cs_main` locked, assert lock is held instead. Ping @ryanofsky as he says the goal is to removed recursive locks.",
      "commit_id" : "2e441c91e7806e6ae781ae0b0aefea958079d15b",
      "created_at" : "2017-11-03T22:02:56Z",
      "diff_hunk" : "@@ -2639,7 +2639,10 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n     // enough, that fee sniping isn't a problem yet, but by implementing a fix\n     // now we ensure code won't be written that makes assumptions about\n     // nLockTime that preclude a fix later.\n-    txNew.nLockTime = chainActive.Height();\n+    {\n+        LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r148902549",
      "id" : 148902549,
      "original_commit_id" : "1c93531dec06879103308d9481a5c65e45b360ba",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 74224196,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596",
      "updated_at" : "2017-11-07T18:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148902549",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r149043586"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149043586"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@promag Thanks! Now fixed.",
      "commit_id" : "2e441c91e7806e6ae781ae0b0aefea958079d15b",
      "created_at" : "2017-11-06T10:37:10Z",
      "diff_hunk" : "@@ -2639,7 +2639,10 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n     // enough, that fee sniping isn't a problem yet, but by implementing a fix\n     // now we ensure code won't be written that makes assumptions about\n     // nLockTime that preclude a fix later.\n-    txNew.nLockTime = chainActive.Height();\n+    {\n+        LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r149043586",
      "id" : 149043586,
      "in_reply_to_id" : 148902549,
      "original_commit_id" : "1c93531dec06879103308d9481a5c65e45b360ba",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 74375259,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596",
      "updated_at" : "2017-11-07T18:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149043586",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r149102370"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149102370"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@promag I'm getting an assertion failure when running `test/functional/test_runner.py` with your suggested patch applied. Does it pass for you? Reverting to previous version for now.",
      "commit_id" : "2e441c91e7806e6ae781ae0b0aefea958079d15b",
      "created_at" : "2017-11-06T15:04:55Z",
      "diff_hunk" : "@@ -2639,7 +2639,10 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n     // enough, that fee sniping isn't a problem yet, but by implementing a fix\n     // now we ensure code won't be written that makes assumptions about\n     // nLockTime that preclude a fix later.\n-    txNew.nLockTime = chainActive.Height();\n+    {\n+        LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r149102370",
      "id" : 149102370,
      "in_reply_to_id" : 148902549,
      "original_commit_id" : "1c93531dec06879103308d9481a5c65e45b360ba",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 74443930,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596",
      "updated_at" : "2017-11-07T18:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149102370",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r149104246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149104246"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'll check.",
      "commit_id" : "2e441c91e7806e6ae781ae0b0aefea958079d15b",
      "created_at" : "2017-11-06T15:11:13Z",
      "diff_hunk" : "@@ -2639,7 +2639,10 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletT\n     // enough, that fee sniping isn't a problem yet, but by implementing a fix\n     // now we ensure code won't be written that makes assumptions about\n     // nLockTime that preclude a fix later.\n-    txNew.nLockTime = chainActive.Height();\n+    {\n+        LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r149104246",
      "id" : 149104246,
      "in_reply_to_id" : 148902549,
      "original_commit_id" : "1c93531dec06879103308d9481a5c65e45b360ba",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 74446123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596",
      "updated_at" : "2017-11-07T18:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149104246",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@practicalswift following https://github.com/bitcoin/bitcoin/pull/11596#discussion_r149104246, I believe a7eb21a is the fix.",
      "created_at" : "2017-11-06T16:19:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11596#issuecomment-342200591",
      "id" : 342200591,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11596",
      "updated_at" : "2017-11-06T16:19:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/342200591",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@promag What is the reasoning behind the patch (a7eb21a6f64cc042e695f9f483e49a5adaed7c4e) Ã¢ÂÂ what are the underlying locking requirements (exact variables being guarded)? Your patch is likely correct, but I'm trying to understand exactly why :-)",
      "created_at" : "2017-11-06T16:38:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11596#issuecomment-342206935",
      "id" : 342206935,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11596",
      "updated_at" : "2017-11-06T16:39:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/342206935",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r149182940"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149182940"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: care to do the serialization of bitmap/outs outside of cs_main (same below)?",
      "commit_id" : "2e441c91e7806e6ae781ae0b0aefea958079d15b",
      "created_at" : "2017-11-06T19:46:00Z",
      "diff_hunk" : "@@ -510,7 +510,10 @@ static bool rest_getutxos(HTTPRequest* req, const std::string& strURIPart)\n         // serialize data\n         // use exact same output as mentioned in Bip64\n         CDataStream ssGetUTXOResponse(SER_NETWORK, PROTOCOL_VERSION);\n-        ssGetUTXOResponse << chainActive.Height() << chainActive.Tip()->GetBlockHash() << bitmap << outs;\n+        {\n+            LOCK(cs_main);\n+            ssGetUTXOResponse << chainActive.Height() << chainActive.Tip()->GetBlockHash() << bitmap << outs;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r149182940",
      "id" : 149182940,
      "original_commit_id" : "fdea0e21dab9ce17a0eaca3b86c8a48c303601f9",
      "original_position" : 7,
      "path" : "src/rest.cpp",
      "position" : null,
      "pull_request_review_id" : 74537960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596",
      "updated_at" : "2017-11-07T18:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149182940",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r149189367"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149189367"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ugh, can we not add more cs_main requirements - if the goal is to resolve the chainActive.Height() issue only then please add the cs_main around just that, its not gonna hurt anything to not hold cs_main for the duration of this function, and we really should be trying to *remove* cs_main from this function, not go the other way.",
      "commit_id" : "2e441c91e7806e6ae781ae0b0aefea958079d15b",
      "created_at" : "2017-11-06T20:09:35Z",
      "diff_hunk" : "@@ -2594,6 +2594,8 @@ bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nC\n bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CWalletTx& wtxNew, CReserveKey& reservekey, CAmount& nFeeRet,\n                                 int& nChangePosInOut, std::string& strFailReason, const CCoinControl& coin_control, bool sign)\n {\n+    AssertLockHeld(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r149189367",
      "id" : 149189367,
      "original_commit_id" : "fdea0e21dab9ce17a0eaca3b86c8a48c303601f9",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 74537960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596",
      "updated_at" : "2017-11-07T18:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149189367",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@TheBlueMatt Thanks for reviewing. Feedback addressed.",
      "created_at" : "2017-11-06T20:48:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11596#issuecomment-342281492",
      "id" : 342281492,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11596",
      "updated_at" : "2017-11-06T20:48:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/342281492",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r149434251"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149434251"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Please no. Can we instead add the locking in CreateTransaction itself? We need to be pushing locks down, especially when it comes to cs_main, not putting more locks in RPC functions.",
      "commit_id" : "2e441c91e7806e6ae781ae0b0aefea958079d15b",
      "created_at" : "2017-11-07T16:51:47Z",
      "diff_hunk" : "@@ -3015,8 +3015,11 @@ UniValue fundrawtransaction(const JSONRPCRequest& request)\n     CAmount nFeeOut;\n     std::string strFailReason;\n \n-    if (!pwallet->FundTransaction(tx, nFeeOut, changePosition, strFailReason, lockUnspents, setSubtractFeeFromOutputs, coinControl)) {\n-        throw JSONRPCError(RPC_WALLET_ERROR, strFailReason);\n+    {\n+        LOCK2(cs_main, pwallet->cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r149434251",
      "id" : 149434251,
      "original_commit_id" : "cd8ac3cc86652a5d0623533ba0fa09d39d25af78",
      "original_position" : 7,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 74826035,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596",
      "updated_at" : "2017-11-07T18:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149434251",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Reverting the patch suggested by @promag. The locking is now made down in `CreateTransaction` as suggested by @TheBlueMatt.",
      "created_at" : "2017-11-07T18:09:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11596#issuecomment-342571214",
      "id" : 342571214,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11596",
      "updated_at" : "2017-11-07T18:09:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/342571214",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK 2e441c91e7806e6ae781ae0b0aefea958079d15b\r\nThanks!",
      "created_at" : "2017-11-07T18:25:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11596#issuecomment-342575790",
      "id" : 342575790,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11596",
      "updated_at" : "2017-11-07T18:25:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/342575790",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r150277341"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/150277341"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This isn't sufficient I think. We don't want to allow `chainActive` to change from when we get the results, to when we identify the chain they're for. So extract this info above in the first lock...",
      "commit_id" : "2e441c91e7806e6ae781ae0b0aefea958079d15b",
      "created_at" : "2017-11-10T16:22:33Z",
      "diff_hunk" : "@@ -510,7 +510,11 @@ static bool rest_getutxos(HTTPRequest* req, const std::string& strURIPart)\n         // serialize data\n         // use exact same output as mentioned in Bip64\n         CDataStream ssGetUTXOResponse(SER_NETWORK, PROTOCOL_VERSION);\n-        ssGetUTXOResponse << chainActive.Height() << chainActive.Tip()->GetBlockHash() << bitmap << outs;\n+        {\n+            LOCK(cs_main);\n+            ssGetUTXOResponse << chainActive.Height() << chainActive.Tip()->GetBlockHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r150277341",
      "id" : 150277341,
      "original_commit_id" : "2e441c91e7806e6ae781ae0b0aefea958079d15b",
      "original_position" : 7,
      "path" : "src/rest.cpp",
      "position" : 7,
      "pull_request_review_id" : 75808103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596",
      "updated_at" : "2017-11-10T16:24:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/150277341",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r150277416"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/150277416"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same",
      "commit_id" : "2e441c91e7806e6ae781ae0b0aefea958079d15b",
      "created_at" : "2017-11-10T16:22:48Z",
      "diff_hunk" : "@@ -520,7 +524,11 @@ static bool rest_getutxos(HTTPRequest* req, const std::string& strURIPart)\n \n     case RF_HEX: {\n         CDataStream ssGetUTXOResponse(SER_NETWORK, PROTOCOL_VERSION);\n-        ssGetUTXOResponse << chainActive.Height() << chainActive.Tip()->GetBlockHash() << bitmap << outs;\n+        {\n+            LOCK(cs_main);\n+            ssGetUTXOResponse << chainActive.Height() << chainActive.Tip()->GetBlockHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r150277416",
      "id" : 150277416,
      "original_commit_id" : "2e441c91e7806e6ae781ae0b0aefea958079d15b",
      "original_position" : 20,
      "path" : "src/rest.cpp",
      "position" : 7,
      "pull_request_review_id" : 75808103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596",
      "updated_at" : "2017-11-10T16:24:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/150277416",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r150277488"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/150277488"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same.",
      "commit_id" : "2e441c91e7806e6ae781ae0b0aefea958079d15b",
      "created_at" : "2017-11-10T16:23:02Z",
      "diff_hunk" : "@@ -533,8 +541,11 @@ static bool rest_getutxos(HTTPRequest* req, const std::string& strURIPart)\n \n         // pack in some essentials\n         // use more or less the same output as mentioned in Bip64\n-        objGetUTXOResponse.push_back(Pair(\"chainHeight\", chainActive.Height()));\n-        objGetUTXOResponse.push_back(Pair(\"chaintipHash\", chainActive.Tip()->GetBlockHash().GetHex()));\n+        {\n+            LOCK(cs_main);\n+            objGetUTXOResponse.push_back(Pair(\"chainHeight\", chainActive.Height()));\n+            objGetUTXOResponse.push_back(Pair(\"chaintipHash\", chainActive.Tip()->GetBlockHash().GetHex()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r150277488",
      "id" : 150277488,
      "original_commit_id" : "2e441c91e7806e6ae781ae0b0aefea958079d15b",
      "original_position" : 35,
      "path" : "src/rest.cpp",
      "position" : 35,
      "pull_request_review_id" : 75808103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596",
      "updated_at" : "2017-11-10T16:24:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/150277488",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r150285509"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/150285509"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Which first lock?",
      "commit_id" : "2e441c91e7806e6ae781ae0b0aefea958079d15b",
      "created_at" : "2017-11-10T16:49:00Z",
      "diff_hunk" : "@@ -510,7 +510,11 @@ static bool rest_getutxos(HTTPRequest* req, const std::string& strURIPart)\n         // serialize data\n         // use exact same output as mentioned in Bip64\n         CDataStream ssGetUTXOResponse(SER_NETWORK, PROTOCOL_VERSION);\n-        ssGetUTXOResponse << chainActive.Height() << chainActive.Tip()->GetBlockHash() << bitmap << outs;\n+        {\n+            LOCK(cs_main);\n+            ssGetUTXOResponse << chainActive.Height() << chainActive.Tip()->GetBlockHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11596#discussion_r150285509",
      "id" : 150285509,
      "in_reply_to_id" : 150277341,
      "original_commit_id" : "2e441c91e7806e6ae781ae0b0aefea958079d15b",
      "original_position" : 7,
      "path" : "src/rest.cpp",
      "position" : 7,
      "pull_request_review_id" : 75817637,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11596",
      "updated_at" : "2017-11-10T16:49:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/150285509",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
