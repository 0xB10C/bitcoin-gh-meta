{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "This PR adds a new class `SQLiteDatabase` which is a subclass of `WalletDatabase`. This provides access to a SQLite database that is used to store the wallet records. To keep compatibility with BDB and to complexity of the change down, we don't make use of many SQLite's features. We use it strictly as a key-value store. We create a table `main` which has two columns, `key` and `value` both with the type `blob`.\r\n\r\nFor new descriptor wallets, we will create a `SQLiteDatabase` instead of a `BerkeleyDatabase`. There is no requirement that all SQLite wallets are descriptor wallets, nor is there a requirement that all descriptor wallets be SQLite wallets. This allows for existing descriptor wallets to work as well as keeping open the option to migrate existing wallets to SQLite.\r\n\r\nWe keep the name `wallet.dat` for SQLite wallets. We are able to determine which database type to use by searching for specific magic bytes in the `wallet.dat` file. SQLite begins it's files with a null terminated string `SQLite format 3`. BDB has `0x00053162` at byte 12 (note that the byte order of this integer depends on the system endianness). So when we see that there is a `wallet.dat` file that we want to open, we check for the magic bytes to determine which database system to use.\r\n\r\nI decided to keep the `wallet.dat` naming to keep things like backup script to continue to function as they won't need to be modified to look for a different file name. It also simplifies a couple of things in the implementation and the tests as `wallet.dat` is something that is specifically being looked for. If we don't want this behavior, then I do have another branch which creates `wallet.sqlite` files instead, but I find that this direction is easier.\r\n\r\nLastly, to actually use the SQLite library, this PR includes the [SQLite amalgamation](https://sqlite.org/amalgamation.html). This amalgamation is a very large C file (sqlite3.c) which is the entire library source code. This gets compiled with the wallet. I would prefer to use the amalgamation in order to control some compile time options that may be important to us. For example, I think we should have `SQLITE_THREADSAFE` compiled in as we may have some multithreaded access to a database. Having this disabled could be a problem. If, however, we would prefer to use the system libs (and thus the depends system), then the commit `Add sqlite3 amalgamation` can be dropped.\r\n\r\nThis PR requires #18971 which provides the refactor which gives us the abstract class `WalletDatabase` that is subclassed by `SQLiteDatabase`.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19077/comments",
   "created_at" : "2020-05-27T02:42:07Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19077/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/19077",
   "id" : 625332065,
   "labels" : [
      {
         "color" : "08a781",
         "default" : false,
         "description" : null,
         "id" : 149424,
         "name" : "Wallet",
         "node_id" : "MDU6TGFiZWwxNDk0MjQ=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19077/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NDIzNTcxNDkx",
   "number" : 19077,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/19077.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19077",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/19077.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19077"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "wallet: Add sqlite as an alternative wallet database and use it for new descriptor wallets",
   "updated_at" : "2020-05-27T02:42:58Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19077",
   "user" : {
      "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
      "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
      "followers_url" : "https://api.github.com/users/achow101/followers",
      "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/achow101",
      "id" : 3782274,
      "login" : "achow101",
      "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
      "organizations_url" : "https://api.github.com/users/achow101/orgs",
      "received_events_url" : "https://api.github.com/users/achow101/received_events",
      "repos_url" : "https://api.github.com/users/achow101/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/achow101"
   }
}
