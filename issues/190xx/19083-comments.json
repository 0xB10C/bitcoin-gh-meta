[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18788 (wallet: tests: Update more tests to work with descriptor wallets by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-05-28T05:00:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19083#issuecomment-635101579",
      "id" : 635101579,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19083",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNTEwMTU3OQ==",
      "updated_at" : "2020-05-28T05:00:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/635101579",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19083#discussion_r432978430"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432978430"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think you can remove the `services` and `send_version` arguments, and just set them directly below (this function is only ever called once, and you know what `services` and `send_version` should be set to.",
      "commit_id" : "e692c3cdd1e56ef6780bc43058f9321085f5a9de",
      "created_at" : "2020-05-31T19:52:25Z",
      "diff_hunk" : "@@ -51,6 +56,21 @@ def on_merkleblock(self, message):\n     def on_tx(self, message):\n         self.tx_received = True\n \n+class FilterNodeFRelay(FilterNode):\n+    def peer_connect(self, *args, services=NODE_NETWORK|NODE_WITNESS, send_version=True, **kwargs):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19083#discussion_r432978430",
      "id" : 432978430,
      "line" : 60,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk3ODQzMA==",
      "original_commit_id" : "e692c3cdd1e56ef6780bc43058f9321085f5a9de",
      "original_line" : 60,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "test/functional/p2p_filter.py",
      "position" : 22,
      "pull_request_review_id" : 421522894,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-31T19:53:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432978430",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19083#discussion_r432986314"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432986314"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there any reason to overwrite this at all? The whole overwrite with the `on_connection_send_msg` magic is a bit of a mental load. I believe this can simply be a `FilterNode`, where you set `send_version=False` and then `send_message(version_without_nRelay)` and then `wait_for_verack()`.\r\n\r\nOverall it should be less complex and less lines of code",
      "commit_id" : "e692c3cdd1e56ef6780bc43058f9321085f5a9de",
      "created_at" : "2020-05-31T21:32:54Z",
      "diff_hunk" : "@@ -51,6 +56,21 @@ def on_merkleblock(self, message):\n     def on_tx(self, message):\n         self.tx_received = True\n \n+class FilterNodeFRelay(FilterNode):\n+    def peer_connect(self, *args, services=NODE_NETWORK|NODE_WITNESS, send_version=True, **kwargs):\n+        create_conn = P2PConnection.peer_connect(self, *args, **kwargs)\n+\n+        if send_version:\n+            # Send a version msg\n+            vt = msg_version()\n+            vt.nServices = services\n+            vt.addrTo.ip = self.dstaddr\n+            vt.addrTo.port = self.dstport\n+            vt.addrFrom.ip = \"0.0.0.0\"\n+            vt.addrFrom.port = 0\n+            vt.nRelay = 0 # default = 1\n+            self.on_connection_send_msg = vt  # Will be sent soon after connection_made\n+        return create_conn",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19083#discussion_r432986314",
      "id" : 432986314,
      "line" : 73,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4NjMxNA==",
      "original_commit_id" : "e692c3cdd1e56ef6780bc43058f9321085f5a9de",
      "original_line" : 73,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "test/functional/p2p_filter.py",
      "position" : 35,
      "pull_request_review_id" : 421529378,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-31T21:32:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432986314",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
