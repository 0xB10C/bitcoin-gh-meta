[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-05-28T19:10:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19096#issuecomment-635540829",
      "id" : 635540829,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19096",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNTU0MDgyOQ==",
      "updated_at" : "2020-05-28T19:10:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/635540829",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18923 (wallet: Never schedule MaybeCompactWalletDB when -flushwallet is off by MarcoFalke)\n* #18354 (Use shared pointers only in validation interface by bvbfan)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-05-28T21:07:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19096#issuecomment-635608061",
      "id" : 635608061,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19096",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNTYwODA2MQ==",
      "updated_at" : "2020-05-28T21:07:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/635608061",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19096#discussion_r432155491"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19096"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432155491"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Instead of adding the `operator=` (which doesn't copy m_context) maybe overload constructor so that here would be `return command.actor({request, m_context}, result, last_handler)`. I've pushed 5e433dcb6fc3106281d14330879acf0ef1160b62 with this suggestion.",
      "commit_id" : "2058621ed33c8ffc113f6363bc91cae52fca4f73",
      "created_at" : "2020-05-28T22:18:37Z",
      "diff_hunk" : "@@ -481,16 +484,24 @@ class WalletClientImpl : public ChainClient\n {\n public:\n     WalletClientImpl(Chain& chain, std::vector<std::string> wallet_filenames)\n-        : m_chain(chain), m_wallet_filenames(std::move(wallet_filenames))\n+        : m_wallet_filenames(std::move(wallet_filenames))\n     {\n+        m_context.chain = &chain;\n     }\n     void registerRpcs() override\n     {\n-        g_rpc_chain = &m_chain;\n-        return RegisterWalletRPCCommands(m_chain, m_rpc_handlers);\n+        for (const CRPCCommand& command : GetWalletRPCCommands()) {\n+            m_rpc_commands.emplace_back(command.category, command.name, [this, &command](const JSONRPCRequest& request, UniValue& result, bool last_handler) {\n+                util::Ref context{m_context};\n+                JSONRPCRequest wallet_request{context};\n+                wallet_request = request;\n+                return command.actor(wallet_request, result, last_handler);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19096#discussion_r432155491",
      "id" : 432155491,
      "line" : 498,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjE1NTQ5MQ==",
      "original_commit_id" : "2058621ed33c8ffc113f6363bc91cae52fca4f73",
      "original_line" : 498,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/interfaces/wallet.cpp",
      "position" : 35,
      "pull_request_review_id" : 420531985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19096",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-28T22:26:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432155491",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19096#discussion_r432157919"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19096"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432157919"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why not `assert(context.Has<WalletContext>())` for now?",
      "commit_id" : "2058621ed33c8ffc113f6363bc91cae52fca4f73",
      "created_at" : "2020-05-28T22:25:19Z",
      "diff_hunk" : "@@ -121,6 +123,14 @@ void EnsureWalletIsUnlocked(const CWallet* pwallet)\n     }\n }\n \n+WalletContext& EnsureWalletContext(const util::Ref& context)\n+{\n+    if (!context.Has<WalletContext>()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19096#discussion_r432157919",
      "id" : 432157919,
      "line" : 128,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjE1NzkxOQ==",
      "original_commit_id" : "2058621ed33c8ffc113f6363bc91cae52fca4f73",
      "original_line" : 128,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 21,
      "pull_request_review_id" : 420531985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19096",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-28T22:26:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432157919",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
