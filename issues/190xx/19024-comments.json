[
   {
      "author_association" : "MEMBER",
      "body" : "I am wondering why the tread sanitizer on Ubuntu does not detect this issue",
      "created_at" : "2020-05-19T23:47:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19024#issuecomment-631146948",
      "id" : 631146948,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19024",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTE0Njk0OA==",
      "updated_at" : "2020-05-19T23:47:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631146948",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Confirm:\r\n- Fedora 32, Clang 10.0.0: `WARNING: ThreadSanitizer: double lock of a mutex`\r\n- Ubuntu 20.04, Clang 10.0.0: no warnings",
      "created_at" : "2020-05-20T11:48:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19024#issuecomment-631424665",
      "id" : 631424665,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19024",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTQyNDY2NQ==",
      "updated_at" : "2020-05-20T11:48:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631424665",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke \r\nMind testing #19029?",
      "created_at" : "2020-05-20T15:50:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19024#issuecomment-631561209",
      "id" : 631561209,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19024",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTU2MTIwOQ==",
      "updated_at" : "2020-05-20T15:50:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631561209",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Same bug in debian, so I guess this should be reported to the debian clang maintainer?",
      "created_at" : "2020-05-20T20:04:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19024#issuecomment-631696545",
      "id" : 631696545,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19024",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTY5NjU0NQ==",
      "updated_at" : "2020-05-20T20:04:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631696545",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "[`llvm-project-10.0.0/compiler-rt/test/tsan/mutex_double_lock.cpp`](https://github.com/llvm-mirror/compiler-rt/blob/master/test/tsan/mutex_double_lock.cpp):\r\n```C++\r\n// RUN: %clangxx_tsan -O1 %s -o %t && %deflake %run %t | FileCheck %s\r\n#include <pthread.h>\r\n#include <unistd.h>\r\n\r\nextern \"C\" void AnnotateRWLockAcquired(const char *f, int l, void *m, long rw);\r\n\r\nvoid *ThreadFunc(void *m) {\r\n  AnnotateRWLockAcquired(__FILE__, __LINE__, m, 1);\r\n  return 0;\r\n}\r\n\r\nint main() {\r\n  int m = 0;\r\n  AnnotateRWLockAcquired(__FILE__, __LINE__, &m, 1);\r\n  pthread_t th;\r\n  pthread_create(&th, 0, ThreadFunc, &m);\r\n  pthread_join(th, 0);\r\n  return 0;\r\n}\r\n\r\n// CHECK: WARNING: ThreadSanitizer: double lock of a mutex\r\n// CHECK:     #0 AnnotateRWLockAcquired\r\n// CHECK:     #1 ThreadFunc\r\n// CHECK: Location is stack of main thread.\r\n// CHECK:   Mutex {{.*}} created at:\r\n// CHECK:     #0 AnnotateRWLockAcquired\r\n// CHECK:     #1 main\r\n// CHECK: SUMMARY: ThreadSanitizer: double lock of a mutex {{.*}}mutex_double_lock.cpp{{.*}}ThreadFunc\r\n```",
      "created_at" : "2020-05-21T04:06:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19024#issuecomment-631866811",
      "id" : 631866811,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19024",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTg2NjgxMQ==",
      "updated_at" : "2020-05-21T04:16:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631866811",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Same bug in debian, so I guess this should be reported to the debian clang maintainer?\r\n\r\nI cannot see such warnings on macOS 10.15  with `brew`ed clang 10.0.0.\r\nMaybe it is Fedora distro's bug?\r\n\r\nThe (almost) minimal code for testing:\r\n```C++\r\n#include <condition_variable>\r\n#include <chrono>\r\n#include <iostream>\r\n#include <mutex>\r\n#include <thread>\r\n \r\nstd::mutex m;\r\nstd::condition_variable cv;\r\n\r\nvoid ThreadOne() {\r\n    std::unique_lock<std::mutex> lock(m);\r\n    std::cout << __func__ << \":\" << __LINE__ << std::endl;\r\n    cv.wait_for(lock, std::chrono::seconds(3), []{ return false; });\r\n    std::cout << __func__ << \":\" << __LINE__ << std::endl;\r\n}\r\n\r\nvoid ThreadTwo() {\r\n    std::unique_lock<std::mutex> lock(m);\r\n    std::cout << __func__ << \":\" << __LINE__ << std::endl;\r\n    cv.wait_for(lock, std::chrono::seconds(10), []{ return false; });\r\n    std::cout << __func__ << \":\" << __LINE__ << std::endl;\r\n}\r\n\r\nint main() {\r\n    std::thread t1(ThreadOne);\r\n    std::thread t2(ThreadTwo);\r\n    t1.join();\r\n    t2.join();\r\n    return 0;\r\n}\r\n```",
      "created_at" : "2020-05-21T07:38:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19024#issuecomment-631935873",
      "id" : 631935873,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19024",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTkzNTg3Mw==",
      "updated_at" : "2020-05-21T07:38:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631935873",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I see this on Arch with self compiled clang ( `clang version 10.0.0 (https://github.com/llvm/llvm-project.git d32170dbd5b0d54436537b6b75beaf44324e0c28)` )\r\n\r\n```\r\n$ TSAN_OPTIONS=\"halt_on_error=1\" ./src/bitcoind -noprinttoconsole\r\n==================\r\nWARNING: ThreadSanitizer: double lock of a mutex (pid=105686)\r\n    #0 pthread_mutex_lock /home/elichai2/gits/llvm-project/compiler-rt/lib/tsan/../sanitizer_common/sanitizer_common_interceptors.inc:4153:3 (bitcoind+0xa0316)\r\n    #1 __gthread_mutex_lock /usr/include/c++/10.1.0/x86_64-pc-linux-gnu/bits/gthr-default.h:749:41 (bitcoind+0x536b0f)\r\n    #2 std::mutex::lock() /usr/include/c++/10.1.0/bits/std_mutex.h:100:37 (bitcoind+0x536b0f)\r\n    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10.1.0/bits/unique_lock.h:138:21 (bitcoind+0x536b0f)\r\n    #4 UniqueLock<AnnotatedMixin<std::mutex>, std::unique_lock<std::mutex> >::Enter(char const*, char const*, int) /home/elichai2/gits/bitcoin-variant/src/./sync.h:131:23 (bitcoind+0x536b0f)\r\n    #5 UniqueLock<AnnotatedMixin<std::mutex>, std::unique_lock<std::mutex> >::UniqueLock(AnnotatedMixin<std::mutex>&, char const*, char const*, int, bool) /home/elichai2/gits/bitcoin-variant/src/./sync.h:152:18 (bitcoind+0x536b0f)\r\n    #6 CThreadInterrupt::sleep_for(std::chrono::duration<long, std::ratio<1l, 1000l> >) /home/elichai2/gits/bitcoin-variant/src/threadinterrupt.cpp:33:5 (bitcoind+0x536b0f)\r\n    #7 void std::__invoke_impl<void, void (CConnman::*&)(), CConnman*&>(std::__invoke_memfun_deref, void (CConnman::*&)(), CConnman*&) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/bits/invoke.h:73:14 (bitcoind+0x17d5ac)\r\n    #8 std::__invoke_result<void (CConnman::*&)(), CConnman*&>::type std::__invoke<void (CConnman::*&)(), CConnman*&>(void (CConnman::*&)(), CConnman*&) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/bits/invoke.h:95:14 (bitcoind+0x17d5ac)\r\n    #9 void std::_Bind<void (CConnman::* (CConnman*))()>::__call<void, 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/functional:416:11 (bitcoind+0x17d5ac)\r\n    #10 void std::_Bind<void (CConnman::* (CConnman*))()>::operator()<void>() /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/functional:499:17 (bitcoind+0x17d5ac)\r\n    #11 void std::__invoke_impl<void, std::_Bind<void (CConnman::* (CConnman*))()>&>(std::__invoke_other, std::_Bind<void (CConnman::* (CConnman*))()>&) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/bits/invoke.h:60:14 (bitcoind+0x17d5ac)\r\n    #12 std::enable_if<__and_<std::is_void<void>, std::__is_invocable<std::_Bind<void (CConnman::* (CConnman*))()>&> >::value, void>::type std::__invoke_r<void, std::_Bind<void (CConnman::* (CConnman*))()>&>(std::_Bind<void (CConnman::* (CConnman*))()>&) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/bits/invoke.h:153:7 (bitcoind+0x17d5ac)\r\n    #13 std::_Function_handler<void (), std::_Bind<void (CConnman::* (CConnman*))()> >::_M_invoke(std::_Any_data const&) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/bits/std_function.h:291:9 (bitcoind+0x17d5ac)\r\n    #14 std::function<void ()>::operator()() const /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/bits/std_function.h:622:14 (bitcoind+0x12979f)\r\n    #15 void TraceThread<std::function<void ()> >(char const*, std::function<void ()>) /home/elichai2/gits/bitcoin-variant/src/./util/system.h:392:9 (bitcoind+0x12979f)\r\n    #16 void std::__invoke_impl<void, void (*)(char const*, std::function<void ()>), char const*, std::function<void ()> >(std::__invoke_other, void (*&&)(char const*, std::function<void ()>), char const*&&, std::function<void ()>&&) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/bits/invoke.h:60:14 (bitcoind+0x17d893)\r\n    #17 std::__invoke_result<void (*)(char const*, std::function<void ()>), char const*, std::function<void ()> >::type std::__invoke<void (*)(char const*, std::function<void ()>), char const*, std::function<void ()> >(void (*&&)(char const*, std::function<void ()>), char const*&&, std::function<void ()>&&) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/bits/invoke.h:95:14 (bitcoind+0x17d893)\r\n    #18 void std::thread::_Invoker<std::tuple<void (*)(char const*, std::function<void ()>), char const*, std::function<void ()> > >::_M_invoke<0ul, 1ul, 2ul>(std::_Index_tuple<0ul, 1ul, 2ul>) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/thread:264:13 (bitcoind+0x17d893)\r\n    #19 std::thread::_Invoker<std::tuple<void (*)(char const*, std::function<void ()>), char const*, std::function<void ()> > >::operator()() /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/thread:271:11 (bitcoind+0x17d893)\r\n    #20 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(char const*, std::function<void ()>), char const*, std::function<void ()> > > >::_M_run() /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/thread:215:13 (bitcoind+0x17d893)\r\n    #21 execute_native_thread_routine /build/gcc/src/gcc/libstdc++-v3/src/c++11/thread.cc:80:18 (libstdc++.so.6+0xcfb73)\r\n\r\n  Location is heap block of size 328976 at 0x7fd09f302000 allocated by main thread:\r\n    #0 operator new(unsigned long) /home/elichai2/gits/llvm-project/compiler-rt/lib/tsan/rtl/tsan_new_delete.cpp:64:3 (bitcoind+0xf231b)\r\n    #1 AppInitMain(NodeContext&) /home/elichai2/gits/bitcoin-variant/src/init.cpp:1376:46 (bitcoind+0x116388)\r\n    #2 AppInit(int, char**) /home/elichai2/gits/bitcoin-variant/src/bitcoind.cpp:148:16 (bitcoind+0xf3f16)\r\n    #3 main /home/elichai2/gits/bitcoin-variant/src/bitcoind.cpp:178:13 (bitcoind+0xf3f16)\r\n\r\n  Mutex M921689607751673000 is already destroyed.\r\n\r\nSUMMARY: ThreadSanitizer: double lock of a mutex /usr/include/c++/10.1.0/x86_64-pc-linux-gnu/bits/gthr-default.h:749:41 in __gthread_mutex_lock\r\n\r\n```",
      "created_at" : "2020-05-21T08:05:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19024#issuecomment-631947999",
      "id" : 631947999,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19024",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTk0Nzk5OQ==",
      "updated_at" : "2020-05-21T08:06:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631947999",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@elichai Does #19029 fix it for you?",
      "created_at" : "2020-05-21T08:07:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19024#issuecomment-631948831",
      "id" : 631948831,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19024",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTk0ODgzMQ==",
      "updated_at" : "2020-05-21T08:07:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631948831",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Nope, still the same error: (tried make clean and all)\r\n```bash\r\n$ git checkout origin/pr/19029\r\n$ ./autogen.sh && ./configure --disable-wallet --with-sanitizers=thread --with-gui=no --disable-tests CC=clang CXX=clang++\r\n$ make clean\r\n$ make -j12\r\n$ with-env [TSAN_OPTIONS \"halt_on_error=1\"] {./src/bitcoind -noprinttoconsole}\r\n==================\r\nWARNING: ThreadSanitizer: double lock of a mutex (pid=141560)\r\n    #0 pthread_mutex_lock /home/elichai2/gits/llvm-project/compiler-rt/lib/tsan/../sanitizer_common/sanitizer_common_interceptors.inc:4153:3 (bitcoind+0x9d696)\r\n    #1 __gthread_mutex_lock(pthread_mutex_t*) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/x86_64-pc-linux-gnu/bits/gthr-default.h:749:12 (bitcoind+0x158b35)\r\n    #2 std::mutex::lock() /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/bits/std_mutex.h:100:17 (bitcoind+0x158b35)\r\n    #3 std::lock_guard<std::mutex>::lock_guard(std::mutex&) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/bits/std_mutex.h:159:19 (bitcoind+0x158b35)\r\n    #4 CConnman::WakeMessageHandler() /home/elichai2/gits/bitcoin-variant/src/net.cpp:1458:37 (bitcoind+0x158b35)\r\n    #5 CConnman::SocketHandler() /home/elichai2/gits/bitcoin-variant/src/net.cpp:1399:21 (bitcoind+0x158b35)\r\n    #6 CConnman::ThreadSocketHandler() /home/elichai2/gits/bitcoin-variant/src/net.cpp:1451:9 (bitcoind+0x159c4c)\r\n    #7 void std::__invoke_impl<void, void (CConnman::*&)(), CConnman*&>(std::__invoke_memfun_deref, void (CConnman::*&)(), CConnman*&) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/bits/invoke.h:73:14 (bitcoind+0x17a9dc)\r\n    #8 std::__invoke_result<void (CConnman::*&)(), CConnman*&>::type std::__invoke<void (CConnman::*&)(), CConnman*&>(void (CConnman::*&)(), CConnman*&) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/bits/invoke.h:95:14 (bitcoind+0x17a9dc)\r\n    #9 void std::_Bind<void (CConnman::* (CConnman*))()>::__call<void, 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/functional:416:11 (bitcoind+0x17a9dc)\r\n    #10 void std::_Bind<void (CConnman::* (CConnman*))()>::operator()<void>() /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/functional:499:17 (bitcoind+0x17a9dc)\r\n    #11 void std::__invoke_impl<void, std::_Bind<void (CConnman::* (CConnman*))()>&>(std::__invoke_other, std::_Bind<void (CConnman::* (CConnman*))()>&) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/bits/invoke.h:60:14 (bitcoind+0x17a9dc)\r\n    #12 std::enable_if<__and_<std::is_void<void>, std::__is_invocable<std::_Bind<void (CConnman::* (CConnman*))()>&> >::value, void>::type std::__invoke_r<void, std::_Bind<void (CConnman::* (CConnman*))()>&>(std::_Bind<void (CConnman::* (CConnman*))()>&) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/bits/invoke.h:153:7 (bitcoind+0x17a9dc)\r\n    #13 std::_Function_handler<void (), std::_Bind<void (CConnman::* (CConnman*))()> >::_M_invoke(std::_Any_data const&) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/bits/std_function.h:291:9 (bitcoind+0x17a9dc)\r\n    #14 std::function<void ()>::operator()() const /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/bits/std_function.h:622:14 (bitcoind+0x126b1f)\r\n    #15 void TraceThread<std::function<void ()> >(char const*, std::function<void ()>) /home/elichai2/gits/bitcoin-variant/src/./util/system.h:392:9 (bitcoind+0x126b1f)\r\n    #16 void std::__invoke_impl<void, void (*)(char const*, std::function<void ()>), char const*, std::function<void ()> >(std::__invoke_other, void (*&&)(char const*, std::function<void ()>), char const*&&, std::function<void ()>&&) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/bits/invoke.h:60:14 (bitcoind+0x17acc3)\r\n    #17 std::__invoke_result<void (*)(char const*, std::function<void ()>), char const*, std::function<void ()> >::type std::__invoke<void (*)(char const*, std::function<void ()>), char const*, std::function<void ()> >(void (*&&)(char const*, std::function<void ()>), char const*&&, std::function<void ()>&&) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/bits/invoke.h:95:14 (bitcoind+0x17acc3)\r\n    #18 void std::thread::_Invoker<std::tuple<void (*)(char const*, std::function<void ()>), char const*, std::function<void ()> > >::_M_invoke<0ul, 1ul, 2ul>(std::_Index_tuple<0ul, 1ul, 2ul>) /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/thread:264:13 (bitcoind+0x17acc3)\r\n    #19 std::thread::_Invoker<std::tuple<void (*)(char const*, std::function<void ()>), char const*, std::function<void ()> > >::operator()() /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/thread:271:11 (bitcoind+0x17acc3)\r\n    #20 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(char const*, std::function<void ()>), char const*, std::function<void ()> > > >::_M_run() /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/thread:215:13 (bitcoind+0x17acc3)\r\n    #21 execute_native_thread_routine /build/gcc/src/gcc/libstdc++-v3/src/c++11/thread.cc:80:18 (libstdc++.so.6+0xcfb73)\r\n\r\n  Location is heap block of size 329168 at 0x7ff638b26000 allocated by main thread:\r\n    #0 operator new(unsigned long) /home/elichai2/gits/llvm-project/compiler-rt/lib/tsan/rtl/tsan_new_delete.cpp:64:3 (bitcoind+0xef69b)\r\n    #1 AppInitMain(NodeContext&) /home/elichai2/gits/bitcoin-variant/src/init.cpp:1376:46 (bitcoind+0x113708)\r\n    #2 AppInit(int, char**) /home/elichai2/gits/bitcoin-variant/src/bitcoind.cpp:148:16 (bitcoind+0xf1296)\r\n    #3 main /home/elichai2/gits/bitcoin-variant/src/bitcoind.cpp:178:13 (bitcoind+0xf1296)\r\n\r\n  Mutex M935763518076445768 is already destroyed.\r\n\r\nSUMMARY: ThreadSanitizer: double lock of a mutex /usr/lib64/gcc/x86_64-pc-linux-gnu/10.1.0/../../../../include/c++/10.1.0/x86_64-pc-linux-gnu/bits/gthr-default.h:749:12 in __gthread_mutex_lock(pthread_mutex_t*)\r\n==================\r\n```",
      "created_at" : "2020-05-21T08:15:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19024#issuecomment-631952838",
      "id" : 631952838,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19024",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTk1MjgzOA==",
      "updated_at" : "2020-05-21T08:17:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631952838",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Nope, still the same error: (tried make clean and all)\r\n\r\n... but it differs from the one reported by @MarcoFalke in OP, right?",
      "created_at" : "2020-05-21T08:18:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19024#issuecomment-631954199",
      "id" : 631954199,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19024",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTk1NDE5OQ==",
      "updated_at" : "2020-05-21T08:18:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631954199",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Could the TSan behavior depend on `libstdc++` implementation?",
      "created_at" : "2020-05-21T08:21:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19024#issuecomment-631955741",
      "id" : 631955741,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19024",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTk1NTc0MQ==",
      "updated_at" : "2020-05-21T08:21:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631955741",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "hmm it does say:\r\n>  C++11 threading is supported with llvm libc++.\r\n\r\nhttps://clang.llvm.org/docs/ThreadSanitizer.html#current-status",
      "created_at" : "2020-05-21T08:30:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19024#issuecomment-631959761",
      "id" : 631959761,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19024",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTk1OTc2MQ==",
      "updated_at" : "2020-05-21T08:30:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631959761",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@elichai Thanks for the hint :)\r\n\r\nI can reproduce warnings on Ubuntu 20.04 for the [test case](https://github.com/bitcoin/bitcoin/issues/19024#issuecomment-631935873):\r\n```\r\n$ sudo apt install libc++-dev libc++abi-dev\r\n$ clang++ -stdlib=libc++ -pthread -fsanitize=thread -g -O1 -o double-lock double-lock.cpp\r\n$ ./double-lock\r\n```\r\n\r\nBut I failed to build `bitcoind` with `CXXFLAGS='-stdlib=libc++'`:\r\n```\r\n/usr/bin/ld: libbitcoin_util.a(libbitcoin_util_a-system.o): in function `SetupEnvironment()':\r\nsystem.cpp:(.text+0xb576): undefined reference to `boost::filesystem::path::imbue(std::__1::locale const&)'\r\n/usr/bin/ld: system.cpp:(.text+0xb588): undefined reference to `boost::filesystem::path::imbue(std::__1::locale const&)'\r\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\r\n```\r\n\r\nIt seems on Fedora 32 the `clang++` uses `libc++` by default, but I don't know how to verify this assumption.",
      "created_at" : "2020-05-21T10:00:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19024#issuecomment-631998228",
      "id" : 631998228,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19024",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTk5ODIyOA==",
      "updated_at" : "2020-05-21T10:00:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631998228",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> ```\r\n> /usr/bin/ld: libbitcoin_util.a(libbitcoin_util_a-system.o): in function `SetupEnvironment()':\r\n> system.cpp:(.text+0xb576): undefined reference to `boost::filesystem::path::imbue(std::__1::locale const&)'\r\n> /usr/bin/ld: system.cpp:(.text+0xb588): undefined reference to `boost::filesystem::path::imbue(std::__1::locale const&)'\r\n> clang: error: linker command failed with exit code 1 (use -v to see invocation)\r\n> ```\r\n\r\nGot the exact same error, but stuff came up so don't have the time right now to debug this and see why boost fails linking with boost and libc++",
      "created_at" : "2020-05-21T10:02:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19024#issuecomment-631999329",
      "id" : 631999329,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19024",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTk5OTMyOQ==",
      "updated_at" : "2020-05-21T10:02:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631999329",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   }
]
