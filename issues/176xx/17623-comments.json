[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17623#discussion_r351726618"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351726618"
         }
      },
      "author_association" : "MEMBER",
      "body" : "maybe rename to `EnsureFileWritable(const std::string& filepath)`, then move the `throw`s inside, returning void. This makes the call sites much cleaner, and there is precedent in other RPC utility functions such as `EnsureMemPool` `EnsureWallet` etc",
      "commit_id" : "f6cfba6241833595fa16b57e510b897b868c554d",
      "created_at" : "2019-11-28T11:17:50Z",
      "diff_hunk" : "@@ -749,3 +750,69 @@ UniValue GetServicesNames(ServiceFlags services)\n \n     return servicesNames;\n }\n+\n+UniValue CanWriteFile(const std::string& filepath)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17623#discussion_r351726618",
      "id" : 351726618,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MTcyNjYxOA==",
      "original_commit_id" : "0c61f62b1bca00d931dca68329c4c3dc10cfcd0d",
      "original_position" : 13,
      "path" : "src/rpc/util.cpp",
      "position" : null,
      "pull_request_review_id" : 324219852,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17623",
      "updated_at" : "2019-11-28T11:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351726618",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17623#discussion_r351728235"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351728235"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`JSONRPCError` is expected?",
      "commit_id" : "f6cfba6241833595fa16b57e510b897b868c554d",
      "created_at" : "2019-11-28T11:22:18Z",
      "diff_hunk" : "@@ -2285,17 +2285,17 @@ UniValue dumptxoutset(const JSONRPCRequest& request)\n     }.Check(request);\n \n     fs::path path = fs::absolute(request.params[0].get_str(), GetDataDir());\n+    UniValue check = CanWriteFile(path.string());\n+    int code = find_value(check, \"code\").get_int();\n+\n+    if (code != 0) {\n+      throw check;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17623#discussion_r351728235",
      "id" : 351728235,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MTcyODIzNQ==",
      "original_commit_id" : "0c61f62b1bca00d931dca68329c4c3dc10cfcd0d",
      "original_position" : 8,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 324222004,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17623",
      "updated_at" : "2019-11-28T11:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351728235",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17623#discussion_r351728405"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351728405"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same here: `JSONRPCError` expected?",
      "commit_id" : "f6cfba6241833595fa16b57e510b897b868c554d",
      "created_at" : "2019-11-28T11:22:45Z",
      "diff_hunk" : "@@ -756,8 +756,13 @@ UniValue dumpwallet(const JSONRPCRequest& request)\n \n     EnsureWalletIsUnlocked(pwallet);\n \n-    fs::path filepath = request.params[0].get_str();\n-    filepath = fs::absolute(filepath);\n+    fs::path filepath = fs::absolute(request.params[0].get_str());\n+    UniValue check = CanWriteFile(filepath.string());\n+    int code = find_value(check, \"code\").get_int();\n+\n+    if (code != 0) {\n+      throw check;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17623#discussion_r351728405",
      "id" : 351728405,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MTcyODQwNQ==",
      "original_commit_id" : "0c61f62b1bca00d931dca68329c4c3dc10cfcd0d",
      "original_position" : 11,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 324222223,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17623",
      "updated_at" : "2019-11-28T11:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351728405",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17623#discussion_r351728594"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351728594"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks. Will adapt the code.",
      "commit_id" : "f6cfba6241833595fa16b57e510b897b868c554d",
      "created_at" : "2019-11-28T11:23:20Z",
      "diff_hunk" : "@@ -749,3 +750,69 @@ UniValue GetServicesNames(ServiceFlags services)\n \n     return servicesNames;\n }\n+\n+UniValue CanWriteFile(const std::string& filepath)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17623#discussion_r351728594",
      "id" : 351728594,
      "in_reply_to_id" : 351726618,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MTcyODU5NA==",
      "original_commit_id" : "0c61f62b1bca00d931dca68329c4c3dc10cfcd0d",
      "original_position" : 13,
      "path" : "src/rpc/util.cpp",
      "position" : null,
      "pull_request_review_id" : 324222481,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17623",
      "updated_at" : "2019-11-28T11:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351728594",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17623#discussion_r351728688"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351728688"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, when nonzero.",
      "commit_id" : "f6cfba6241833595fa16b57e510b897b868c554d",
      "created_at" : "2019-11-28T11:23:36Z",
      "diff_hunk" : "@@ -2285,17 +2285,17 @@ UniValue dumptxoutset(const JSONRPCRequest& request)\n     }.Check(request);\n \n     fs::path path = fs::absolute(request.params[0].get_str(), GetDataDir());\n+    UniValue check = CanWriteFile(path.string());\n+    int code = find_value(check, \"code\").get_int();\n+\n+    if (code != 0) {\n+      throw check;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17623#discussion_r351728688",
      "id" : 351728688,
      "in_reply_to_id" : 351728235,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MTcyODY4OA==",
      "original_commit_id" : "0c61f62b1bca00d931dca68329c4c3dc10cfcd0d",
      "original_position" : 8,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 324222598,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17623",
      "updated_at" : "2019-11-28T11:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351728688",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17623#discussion_r351728745"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351728745"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Same",
      "commit_id" : "f6cfba6241833595fa16b57e510b897b868c554d",
      "created_at" : "2019-11-28T11:23:44Z",
      "diff_hunk" : "@@ -756,8 +756,13 @@ UniValue dumpwallet(const JSONRPCRequest& request)\n \n     EnsureWalletIsUnlocked(pwallet);\n \n-    fs::path filepath = request.params[0].get_str();\n-    filepath = fs::absolute(filepath);\n+    fs::path filepath = fs::absolute(request.params[0].get_str());\n+    UniValue check = CanWriteFile(filepath.string());\n+    int code = find_value(check, \"code\").get_int();\n+\n+    if (code != 0) {\n+      throw check;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17623#discussion_r351728745",
      "id" : 351728745,
      "in_reply_to_id" : 351728405,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MTcyODc0NQ==",
      "original_commit_id" : "0c61f62b1bca00d931dca68329c4c3dc10cfcd0d",
      "original_position" : 11,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 324222670,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17623",
      "updated_at" : "2019-11-28T11:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351728745",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17623#discussion_r351729649"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351729649"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "But will now convert the function to return void and only throw, when irregular things happen (filename irregular, readonly mount etc.)",
      "commit_id" : "f6cfba6241833595fa16b57e510b897b868c554d",
      "created_at" : "2019-11-28T11:25:54Z",
      "diff_hunk" : "@@ -756,8 +756,13 @@ UniValue dumpwallet(const JSONRPCRequest& request)\n \n     EnsureWalletIsUnlocked(pwallet);\n \n-    fs::path filepath = request.params[0].get_str();\n-    filepath = fs::absolute(filepath);\n+    fs::path filepath = fs::absolute(request.params[0].get_str());\n+    UniValue check = CanWriteFile(filepath.string());\n+    int code = find_value(check, \"code\").get_int();\n+\n+    if (code != 0) {\n+      throw check;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17623#discussion_r351729649",
      "id" : 351729649,
      "in_reply_to_id" : 351728405,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MTcyOTY0OQ==",
      "original_commit_id" : "0c61f62b1bca00d931dca68329c4c3dc10cfcd0d",
      "original_position" : 11,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 324223809,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17623",
      "updated_at" : "2019-11-28T11:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351729649",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "As I'm not sure if I should open an issue on that, I'll put my findings about [AbsPathForConfigVal](AbsPathForConfigVal) from util/system.cpp here first.\r\n\r\nMy environment is macOS Catalina. \r\n\r\nWhen I use the flag **-debuglogfile=badfilename`** it creates a debug file of that name, which would lead to problems on Windows, I assume. \r\n\r\nWith **-debuglogfile=\\badfile** it creates a file named **adfile**. Here also, Windows might react differently.  \r\n\r\nWith **-debuglogfile=\\bad\\file** it creates a file named **ad**.\r\n\r\nMaybe I am exaggerating things here, because nobody *would want* to use such contrived names. However, there might be scenarios where someone is deliberately trying to disrupt the application (if possible via logging mechanism).\r\n\r\nOtherwise, we should maybe think about reusing *EnsureFileWritable* here as well.",
      "created_at" : "2019-12-04T20:18:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17623#issuecomment-561821364",
      "id" : 561821364,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17623",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2MTgyMTM2NA==",
      "updated_at" : "2019-12-04T20:18:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/561821364",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   }
]
