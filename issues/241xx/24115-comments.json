[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK!\r\n\r\n> detection when the feature can be used\r\n\r\nOn Linux (the only system we care about for ARM, i guess), the following would be the way to do detection:\r\n```c++\r\n#include <sys/auxv.h>\r\n#include <asm/hwcap.h>\r\nâ¦\r\n#ifdef __arm__\r\n/* ARM 32 bit */\r\nif (getauxval(AT_HWCAP2) & HWCAP2_SHA2) {\r\n    have_arm_shani = true;\r\n}\r\n#endif\r\n#ifdef __aarch64__\r\n/* ARM 64 bit */\r\nif (getauxval(AT_HWCAP) & HWCAP_SHA2) {\r\n    have_arm_shani = true;\r\n}\r\n#endif\r\n```\r\nNote that the capability bit is on a different HWCAP word on 32 and 64 bit (dunno if you even want to support 32 bit here).\r\n",
      "created_at" : "2022-01-20T18:55:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24115#issuecomment-1017819167",
      "id" : 1017819167,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24115",
      "node_id" : "IC_kwDOABII5848qrAf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1017819167/reactions"
      },
      "updated_at" : "2022-01-20T19:00:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1017819167",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> the following would be the way to do detection:\r\n\r\nAdded in f7dd1ef",
      "created_at" : "2022-01-20T19:26:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24115#issuecomment-1017847752",
      "id" : 1017847752,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24115",
      "node_id" : "IC_kwDOABII5848qx_I",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1017847752/reactions"
      },
      "updated_at" : "2022-01-20T19:57:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1017847752",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/42201?v=4",
         "events_url" : "https://api.github.com/users/prusnak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prusnak/followers",
         "following_url" : "https://api.github.com/users/prusnak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prusnak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prusnak",
         "id" : 42201,
         "login" : "prusnak",
         "node_id" : "MDQ6VXNlcjQyMjAx",
         "organizations_url" : "https://api.github.com/users/prusnak/orgs",
         "received_events_url" : "https://api.github.com/users/prusnak/received_events",
         "repos_url" : "https://api.github.com/users/prusnak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prusnak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prusnak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prusnak"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "On commit f7dd1efae715593f5c9ff8186d518d25d1c9023c\r\n\r\nOn a Linux aarch64 Cortex-A53 system with:\r\n\r\n```\r\n$ cat /proc/cpuinfo \r\nprocessor       : 0\r\nBogoMIPS        : 200.00\r\nFeatures        : fp asimd evtstrm aes pmull sha1 sha2 crc32 cpuid\r\nCPU implementer : 0x41\r\nCPU architecture: 8\r\nCPU variant     : 0x0\r\nCPU part        : 0xd03\r\nCPU revision    : 4\r\n```\r\n\r\nwhich I presume means it has the necessary SHA2 extensions.\r\n\r\nThe GCC 9.3.0 compiler used supports the extensions (crypto/libbitcoin_crypto_arm_shani.a is being built):\r\n\r\n```\r\nchecking for x86 SHA-NI intrinsics... no\r\nchecking whether C++ compiler accepts -march=armv8-a+crc+crypto... yes\r\nchecking whether C++ compiler accepts -march=armv8-a+crc+crypto... (cached) yes\r\nchecking for AArch64 CRC32 intrinsics... yes\r\nchecking for AArch64 SHA-NI intrinsics... yes\r\n```\r\n\r\nStill, the extension doesn't seem to be detected. debug.log says:\r\n\r\n```\r\n2022-01-20T20:37:05Z Using the 'standard' SHA256 implementation\r\n```\r\n",
      "created_at" : "2022-01-20T20:43:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24115#issuecomment-1017911640",
      "id" : 1017911640,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24115",
      "node_id" : "IC_kwDOABII5848rBlY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1017911640/reactions"
      },
      "updated_at" : "2022-01-20T20:55:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1017911640",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa should be fixed in c0849fc4fd9aa7e70973445a1b962a9270fd859c",
      "created_at" : "2022-01-20T21:42:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24115#issuecomment-1017953150",
      "id" : 1017953150,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24115",
      "node_id" : "IC_kwDOABII5848rLt-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1017953150/reactions"
      },
      "updated_at" : "2022-01-20T21:42:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1017953150",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/42201?v=4",
         "events_url" : "https://api.github.com/users/prusnak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prusnak/followers",
         "following_url" : "https://api.github.com/users/prusnak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prusnak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prusnak",
         "id" : 42201,
         "login" : "prusnak",
         "node_id" : "MDQ6VXNlcjQyMjAx",
         "organizations_url" : "https://api.github.com/users/prusnak/orgs",
         "received_events_url" : "https://api.github.com/users/prusnak/received_events",
         "repos_url" : "https://api.github.com/users/prusnak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prusnak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prusnak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prusnak"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "On c0849fc4fd9aa7e70973445a1b962a9270fd859c:\r\n\r\n```\r\n2022-01-20T22:15:44Z Using the 'arm_shani(1way)' SHA256 implementation\r\n```",
      "created_at" : "2022-01-20T22:16:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24115#issuecomment-1017974870",
      "id" : 1017974870,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24115",
      "node_id" : "IC_kwDOABII5848rRBW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1017974870/reactions"
      },
      "updated_at" : "2022-01-20T22:16:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1017974870",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This PR (c0849fc4fd9aa7e70973445a1b962a9270fd859c):\r\n\r\n|             ns/byte |              byte/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|                2.56 |      390,886,099.70 |    0.9% |      0.03 | `SHA256`\r\n|               10.27 |       97,329,584.86 |    0.0% |      0.01 | `SHA256D64_1024`\r\n|               14.60 |       68,478,670.64 |    0.4% |      0.01 | `SHA256_32b`\r\n\r\nOn master (e3ce019667fba2ec50a59814a26566fb67fa9125):\r\n\r\n|             ns/byte |              byte/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               15.69 |       63,715,155.54 |    0.0% |      0.17 | `SHA256`\r\n|               43.42 |       23,029,615.98 |    0.5% |      0.03 | `SHA256D64_1024`\r\n|               41.67 |       23,995,549.21 |    0.1% |      0.01 | `SHA256_32b`\r\n",
      "created_at" : "2022-01-20T23:01:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24115#issuecomment-1018001885",
      "id" : 1018001885,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24115",
      "node_id" : "IC_kwDOABII5848rXnd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 2,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 2,
         "total_count" : 4,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1018001885/reactions"
      },
      "updated_at" : "2022-01-20T23:01:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1018001885",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> On Linux (the only system we care about for ARM, i guess)\r\n\r\nM1 macs would like a work with you.",
      "created_at" : "2022-01-21T05:08:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24115#issuecomment-1018185286",
      "id" : 1018185286,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24115",
      "node_id" : "IC_kwDOABII5848sEZG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1018185286/reactions"
      },
      "updated_at" : "2022-01-21T05:08:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1018185286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6443210?v=4",
         "events_url" : "https://api.github.com/users/PastaPastaPasta/events{/privacy}",
         "followers_url" : "https://api.github.com/users/PastaPastaPasta/followers",
         "following_url" : "https://api.github.com/users/PastaPastaPasta/following{/other_user}",
         "gists_url" : "https://api.github.com/users/PastaPastaPasta/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/PastaPastaPasta",
         "id" : 6443210,
         "login" : "PastaPastaPasta",
         "node_id" : "MDQ6VXNlcjY0NDMyMTA=",
         "organizations_url" : "https://api.github.com/users/PastaPastaPasta/orgs",
         "received_events_url" : "https://api.github.com/users/PastaPastaPasta/received_events",
         "repos_url" : "https://api.github.com/users/PastaPastaPasta/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/PastaPastaPasta/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/PastaPastaPasta/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/PastaPastaPasta"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Speaking of m1, I was able to compile this locally on my m1 pro 10 core, ./configure realized that SHA2 intrinsics could be used. See benchmarks below. \r\n\r\non https://github.com/bitcoin/bitcoin/commit/c0849fc4fd9aa7e70973445a1b962a9270fd859c\r\n|             ns/byte |              byte/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|                0.47 |    2,148,996,364.97 |    0.3% |      0.01 | `SHA256`\r\n|                1.48 |      676,354,727.08 |    0.3% |      0.01 | `SHA256D64_1024`\r\n|                1.15 |      873,060,380.08 |    0.1% |      0.01 | `SHA256_32b`\r\n\r\non master\r\n|             ns/byte |              byte/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|                3.10 |      322,550,263.01 |    1.3% |      0.03 | `SHA256`\r\n|                9.26 |      107,941,088.30 |    0.7% |      0.01 | `SHA256D64_1024`\r\n|                6.22 |      160,743,377.26 |    1.6% |      0.01 | `SHA256_32b`\r\n",
      "created_at" : "2022-01-21T05:31:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24115#issuecomment-1018195343",
      "id" : 1018195343,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24115",
      "node_id" : "IC_kwDOABII5848sG2P",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1018195343/reactions"
      },
      "updated_at" : "2022-01-21T05:31:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1018195343",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6443210?v=4",
         "events_url" : "https://api.github.com/users/PastaPastaPasta/events{/privacy}",
         "followers_url" : "https://api.github.com/users/PastaPastaPasta/followers",
         "following_url" : "https://api.github.com/users/PastaPastaPasta/following{/other_user}",
         "gists_url" : "https://api.github.com/users/PastaPastaPasta/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/PastaPastaPasta",
         "id" : 6443210,
         "login" : "PastaPastaPasta",
         "node_id" : "MDQ6VXNlcjY0NDMyMTA=",
         "organizations_url" : "https://api.github.com/users/PastaPastaPasta/orgs",
         "received_events_url" : "https://api.github.com/users/PastaPastaPasta/received_events",
         "repos_url" : "https://api.github.com/users/PastaPastaPasta/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/PastaPastaPasta/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/PastaPastaPasta/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/PastaPastaPasta"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Speaking of m1, I was able to compile this locally on my m1 pro 10 core, ./configure realized that SHA2 intrinsics could be used. See benchmarks below.\r\n\r\nYes, support for Apple Silicon is included in this PR.",
      "created_at" : "2022-01-21T10:22:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24115#issuecomment-1018373574",
      "id" : 1018373574,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24115",
      "node_id" : "IC_kwDOABII5848syXG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1018373574/reactions"
      },
      "updated_at" : "2022-01-21T10:22:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1018373574",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/42201?v=4",
         "events_url" : "https://api.github.com/users/prusnak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prusnak/followers",
         "following_url" : "https://api.github.com/users/prusnak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prusnak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prusnak",
         "id" : 42201,
         "login" : "prusnak",
         "node_id" : "MDQ6VXNlcjQyMjAx",
         "organizations_url" : "https://api.github.com/users/prusnak/orgs",
         "received_events_url" : "https://api.github.com/users/prusnak/received_events",
         "repos_url" : "https://api.github.com/users/prusnak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prusnak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prusnak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prusnak"
      }
   }
]
