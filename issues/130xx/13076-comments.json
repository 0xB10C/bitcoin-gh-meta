[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13076#discussion_r184197927"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184197927"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Note I added the failure height here. Happy to remove, but I assume it could be helpful.",
      "commit_id" : "821c955a15f21865d37fa84e68df99539ad1438a",
      "created_at" : "2018-04-25T20:37:14Z",
      "diff_hunk" : "@@ -3767,16 +3767,13 @@ UniValue rescanblockchain(const JSONRPCRequest& request)\n         }\n     }\n \n-    CBlockIndex *stopBlock = pwallet->ScanForWalletTransactions(pindexStart, pindexStop, reserver, true);\n-    if (!stopBlock) {\n-        if (pwallet->IsAbortingRescan()) {\n-            throw JSONRPCError(RPC_MISC_ERROR, \"Rescan aborted.\");\n-        }\n-        // if we got a nullptr returned, ScanForWalletTransactions did rescan up to the requested stopindex\n+    const CBlockIndex* stopBlock = nullptr;\n+    if (pwallet->ScanForWalletTransactions(pindexStart, pindexStop, stopBlock, reserver, true)) {\n         stopBlock = pindexStop ? pindexStop : pChainTip;\n-    }\n-    else {\n-        throw JSONRPCError(RPC_MISC_ERROR, \"Rescan failed. Potentially corrupted data files.\");\n+    } else if (pwallet->IsAbortingRescan()) {\n+        throw JSONRPCError(RPC_MISC_ERROR, \"Rescan aborted.\");\n+    } else {\n+        throw JSONRPCError(RPC_MISC_ERROR, strprintf(\"Rescan failed. Potentially corrupted data files. Failed at height %i.\", stopBlock->nHeight));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13076#discussion_r184197927",
      "id" : 184197927,
      "original_commit_id" : "25a588ac2f66d658accf4dc9bc0f2710efab61ba",
      "original_position" : 19,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 19,
      "pull_request_review_id" : 115344796,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13076",
      "updated_at" : "2018-04-25T21:08:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184197927",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13076#discussion_r184198224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184198224"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Note this did not previously fail when ScanForWalletTransactions failed, so this removes a silent failure.",
      "commit_id" : "821c955a15f21865d37fa84e68df99539ad1438a",
      "created_at" : "2018-04-25T20:38:19Z",
      "diff_hunk" : "@@ -4167,11 +4167,11 @@ CWallet* CWallet::CreateWalletFromFile(const std::string& name, const fs::path&\n         nStart = GetTimeMillis();\n         {\n             WalletRescanReserver reserver(walletInstance);\n-            if (!reserver.reserve()) {\n+            const CBlockIndex* stop_block = nullptr;\n+            if (!reserver.reserve() || !walletInstance->ScanForWalletTransactions(pindexRescan, nullptr, stop_block, reserver, true)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13076#discussion_r184198224",
      "id" : 184198224,
      "original_commit_id" : "25a588ac2f66d658accf4dc9bc0f2710efab61ba",
      "original_position" : 61,
      "path" : "src/wallet/wallet.cpp",
      "position" : 72,
      "pull_request_review_id" : 115345173,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13076",
      "updated_at" : "2018-04-25T21:08:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184198224",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13076#discussion_r184207815"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184207815"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Alternatively, this could be `(!pindex && !failed_block)`",
      "commit_id" : "821c955a15f21865d37fa84e68df99539ad1438a",
      "created_at" : "2018-04-25T21:14:19Z",
      "diff_hunk" : "@@ -1791,7 +1791,7 @@ CBlockIndex* CWallet::ScanForWalletTransactions(CBlockIndex* pindexStart, CBlock\n         }\n         ShowProgress(_(\"Rescanning...\"), 100); // hide progress dialog in GUI\n     }\n-    return ret;\n+    return (!fAbortRescan && !failed_block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13076#discussion_r184207815",
      "id" : 184207815,
      "original_commit_id" : "821c955a15f21865d37fa84e68df99539ad1438a",
      "original_position" : 62,
      "path" : "src/wallet/wallet.cpp",
      "position" : 62,
      "pull_request_review_id" : 115357055,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13076",
      "updated_at" : "2018-04-25T21:14:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184207815",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   }
]
