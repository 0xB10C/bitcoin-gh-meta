[
   {
      "author_association" : "MEMBER",
      "body" : "The build failure is due to an eight year old bug in clang: https://bugs.llvm.org/show_bug.cgi?id=8263",
      "created_at" : "2018-04-26T21:38:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-384797131",
      "id" : 384797131,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-04-26T21:38:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/384797131",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I like the goal here but I find the changes a bit overwhelming for achieving this.  It seems like we could achieve this more easily in other ways, like (1) just building the hash on demand the first time it's requested, or (2) adding a deserialization flag to CTransaction that instructs it to skip the hash if we're not planning to use it?\r\n\r\n[I'm not sure if (1) is a great solution, since there might be some memory-cache-benefits to building the hash at the time of deserialization, and maybe no one likes the design of having a mutable hash inside of CTransaction, but it would be a super-small diff...]",
      "created_at" : "2018-04-27T13:04:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-384964026",
      "id" : 384964026,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-04-27T13:04:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/384964026",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I didn't particularly like option (1) because it makes the caching run-time depended (it is always compiled in, but only used when it happens to be requested), compared to having it compile time enforced by typing `CPureTransaction` instead of `CTransaction`.\r\n\r\nNote that my approach is a variation of option (2) by passing through the type of the transaction to `ReadBlockFromDisk` instead of passing through an additional flag that is converted to a deserialization option and then passed on to the constructor of the transaction.\r\n\r\nSo I think having explicit types is advantageous in both code clarity and cleanness, with the tradeoff of a minimally larger diff.\r\n\r\nNote: I will push a fixed up version of the patch by next Monday to minimize the diff and (hopefully) work around the gcc and clang compiler bugs.",
      "created_at" : "2018-04-27T14:24:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-384985819",
      "id" : 384985819,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-04-27T14:24:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/384985819",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fair enough, I just don't want us to overlook simpler solutions that might be acceptable.  I'm happy to let the reviewers with stronger feelings about the design of these data types chime in.",
      "created_at" : "2018-04-27T14:40:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-384990768",
      "id" : 384990768,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-04-27T14:40:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/384990768",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I just pushed a version that might compile on our buggy clang and that is according to the design that @sipa requested in https://github.com/bitcoin/bitcoin/pull/13011#issuecomment-383145046\r\n\r\n> Then at the very least introduce alternate versions of CTransaction/CBlock that don't precompute anything, for use in reindexing and rescanning and serving blocks from disk.",
      "created_at" : "2018-04-27T15:09:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-384999627",
      "id" : 384999627,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-04-27T15:09:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/384999627",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "@MarcoFalke Thanks for working on this, I'll review soon.\r\n\r\n@sdaftuar My preference is having separate types, for these reasons:\r\n* Having lazily-computed hashes in transactions involves synchronization structures (atomics at least to avoid multiple threads simultaneously getting a hash for the first time).\r\n* Smaller in memory in places where it's not needed.\r\n* We have the option of later moving the with-hash types into consensus code and not exposing it.",
      "created_at" : "2018-04-27T20:57:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-385092217",
      "id" : 385092217,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-04-27T20:57:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385092217",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
