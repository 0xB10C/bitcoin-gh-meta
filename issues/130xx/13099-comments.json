[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13099#discussion_r184548289"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13099"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184548289"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there somewhere more general or useful I should put the two functions in this namespace?",
      "commit_id" : "121002fddf40b9c667f962ab40b5d7a5223d4cb4",
      "created_at" : "2018-04-26T22:25:14Z",
      "diff_hunk" : "@@ -0,0 +1,144 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <threadnames.h>\n+#include <tinyformat.h>\n+\n+#include <boost/thread.hpp>\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h> // For HAVE_SYS_PRCTL_H\n+#endif\n+\n+#if (defined(__FreeBSD__) || defined(__OpenBSD__) || defined(__DragonFly__))\n+#include <pthread.h>\n+#include <pthread_np.h>\n+#endif\n+\n+#ifdef HAVE_SYS_PRCTL_H\n+#include <sys/prctl.h> // For prctl, PR_SET_NAME\n+#endif\n+\n+\n+extern int LogPrintStr(const std::string &str);\n+\n+std::unique_ptr<ThreadNameRegistry> g_thread_name_registry(new ThreadNameRegistry());\n+\n+namespace {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13099#discussion_r184548289",
      "id" : 184548289,
      "original_commit_id" : "121002fddf40b9c667f962ab40b5d7a5223d4cb4",
      "original_position" : 28,
      "path" : "src/threadnames.cpp",
      "position" : 28,
      "pull_request_review_id" : 115769336,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13099",
      "updated_at" : "2018-04-26T22:25:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184548289",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13099#discussion_r184548394"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13099"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184548394"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Remove or uncomment this block before merge.",
      "commit_id" : "121002fddf40b9c667f962ab40b5d7a5223d4cb4",
      "created_at" : "2018-04-26T22:25:48Z",
      "diff_hunk" : "@@ -0,0 +1,144 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <threadnames.h>\n+#include <tinyformat.h>\n+\n+#include <boost/thread.hpp>\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h> // For HAVE_SYS_PRCTL_H\n+#endif\n+\n+#if (defined(__FreeBSD__) || defined(__OpenBSD__) || defined(__DragonFly__))\n+#include <pthread.h>\n+#include <pthread_np.h>\n+#endif\n+\n+#ifdef HAVE_SYS_PRCTL_H\n+#include <sys/prctl.h> // For prctl, PR_SET_NAME\n+#endif\n+\n+\n+extern int LogPrintStr(const std::string &str);\n+\n+std::unique_ptr<ThreadNameRegistry> g_thread_name_registry(new ThreadNameRegistry());\n+\n+namespace {\n+\n+/**\n+ * @return true if `to_check` is prefixed with `prefix`.\n+ */\n+bool HasPrefix(const std::string& to_check, const std::string& prefix) {\n+    return to_check.compare(0, prefix.size(), prefix) == 0;\n+}\n+\n+/**\n+ * Count the number of entries in a map with a given prefix.\n+ *\n+ * @return The number of occurrences of keys with the given prefix.\n+ */\n+template <class T>\n+int CountMapPrefixes(T map, const std::string& prefix) {\n+    auto it = map.lower_bound(prefix);\n+    int count = 0;\n+\n+    while (it != map.end() && HasPrefix(it->first, prefix)) {\n+        ++it; ++count;\n+    }\n+\n+    return count;\n+}\n+\n+} // namespace\n+\n+bool ThreadNameRegistry::Register(std::string name, bool expect_multiple)\n+{\n+    std::lock_guard<std::mutex> guard(m_map_lock);\n+\n+    if (expect_multiple) {\n+        name = tfm::format(\"%s.%d\", name, CountMapPrefixes(m_name_to_id, name));\n+    }\n+\n+    std::string process_name(name);\n+\n+    /*\n+     * Uncomment if we want to retain the `bitcoin-` system thread name prefix.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13099#discussion_r184548394",
      "id" : 184548394,
      "original_commit_id" : "121002fddf40b9c667f962ab40b5d7a5223d4cb4",
      "original_position" : 67,
      "path" : "src/threadnames.cpp",
      "position" : 67,
      "pull_request_review_id" : 115769466,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13099",
      "updated_at" : "2018-04-26T22:25:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/184548394",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   }
]
