[
   {
      "body" : "wow I like that, the changes are very small to review. I'll add the tests later tonight or tomorrow..",
      "created_at" : "2015-12-08T03:16:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7184#issuecomment-162746828",
      "id" : 162746828,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7184",
      "updated_at" : "2015-12-08T03:45:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/162746828",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "body" : "@NicolasDorier oh good, i was mostly holding off on the tests because i wanted to see if people liked this approach.\r\n\r\nWhat do you mean about IsFinalTx?  I think the changes to make that aware of MTP are already merged, so it wasn't necessary for me to change it further.\r\n\r\n\r\n",
      "created_at" : "2015-12-08T03:25:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7184#issuecomment-162747941",
      "id" : 162747941,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7184",
      "updated_at" : "2015-12-08T03:25:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/162747941",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7184#discussion_r46963687"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7184"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/46963687"
         }
      },
      "body" : "Like the symmetry, but the name here is now a bit out-dated and possibly misleading since we have two types of finality.",
      "commit_id" : "5635e5b5ab183c0a80eeebc3aa135aa1a9b51f91",
      "created_at" : "2015-12-08T15:07:32Z",
      "diff_hunk" : "@@ -341,7 +341,22 @@ bool IsFinalTx(const CTransaction &tx, int nBlockHeight, int64_t nBlockTime);\n  */\n bool CheckFinalTx(const CTransaction &tx, int flags = -1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7184#discussion_r46963687",
      "id" : 46963687,
      "original_commit_id" : "d08dfced592661359e5261f28a58f7178e8b55c7",
      "original_position" : 2,
      "path" : "src/main.h",
      "position" : 2,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7184",
      "updated_at" : "2015-12-08T16:00:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/46963687",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7184#discussion_r46966223"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7184"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/46966223"
         }
      },
      "body" : "Agreed.  I was going for minimal changes to existing consensus code, but if people like I'd be happy to rename that.  Perhaps `LocktimeLock()` and `CheckLocktimeLock()`\r\n\r\nI'd also like to take out the way CheckFinalTx is called with default -1 in the wallet code, but I could save that for another pull.",
      "commit_id" : "5635e5b5ab183c0a80eeebc3aa135aa1a9b51f91",
      "created_at" : "2015-12-08T15:25:26Z",
      "diff_hunk" : "@@ -341,7 +341,22 @@ bool IsFinalTx(const CTransaction &tx, int nBlockHeight, int64_t nBlockTime);\n  */\n bool CheckFinalTx(const CTransaction &tx, int flags = -1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7184#discussion_r46966223",
      "id" : 46966223,
      "original_commit_id" : "d08dfced592661359e5261f28a58f7178e8b55c7",
      "original_position" : 2,
      "path" : "src/main.h",
      "position" : 2,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7184",
      "updated_at" : "2015-12-08T16:00:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/46966223",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "I am trying another approach before building on yours, which would solve the removeForReorg and CNB problem without changing any code in #6312. (https://github.com/NicolasDorier/bitcoin/compare/b13f47535cc2...0fb1092ed53f now building)\r\n\r\nI removed my comment about IsFinalTx, I was surprised not seeing the flag passed to it. But it seems client are held responsible for calculating the right blocktime. This led to code duplication, #6312 fixed that.\r\n\r\nI like the idea of having 2 methods : CheckLockTime and CheckSequenceLockTime though, but I wonder if it will really be useful since there will be no case where we want to call one and not the other.",
      "created_at" : "2015-12-08T15:56:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7184#issuecomment-162925968",
      "id" : 162925968,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7184",
      "updated_at" : "2015-12-08T15:56:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/162925968",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "body" : "added unit tests",
      "created_at" : "2015-12-08T16:01:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7184#issuecomment-162927637",
      "id" : 162927637,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7184",
      "updated_at" : "2015-12-08T16:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/162927637",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "@NicolasDorier One reason I like the approach in this PR is that the sequence-lock check is done separately from the nLockTime check -- locktime can be evaluated for all transactions in a block at the time a block is received (eg in `ContextualCheckBlock`), whereas sequence locks can only be evaluated when all inputs heights' are available (eg during `ConnectBlock`).\r\n\r\nFrom a design perspective, it seems to me that having the consensus checks operate in the smallest logical units ought to limit the need for future refactorings (which I think is a good design goal for consensus code).",
      "created_at" : "2015-12-08T16:05:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7184#issuecomment-162929355",
      "id" : 162929355,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7184",
      "updated_at" : "2015-12-08T16:05:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/162929355",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "Ok, it makes sense. I'm kind of worried though about having the block of CheckLockTime responsible for calculating the blocktime each time, this is code duplication easy to get wrong. (I think that when I fixed it in #6312, there was indeed some parts which could break if the block evaluated was the genesis with MTP enabled)\r\n\r\nWhat about having a CCBlockIndex::GetCutoffTime(flag) method ?",
      "created_at" : "2015-12-08T16:07:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7184#issuecomment-162930532",
      "id" : 162930532,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7184",
      "updated_at" : "2015-12-08T16:08:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/162930532",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "body" : "It does not solve the perf problem though, CheckSequenceLock need to be called during reorg. (Did https://github.com/NicolasDorier/bitcoin/compare/9e8c7be9bc94...8670ce84fd01 it takes time for me to compile, I don't have a linux at hand, doing it by pushing/waiting travis) ",
      "created_at" : "2015-12-08T16:23:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7184#issuecomment-162934900",
      "id" : 162934900,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7184",
      "updated_at" : "2015-12-08T16:50:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/162934900",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   }
]
