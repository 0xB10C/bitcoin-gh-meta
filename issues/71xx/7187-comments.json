[
   {
      "body" : "Since #6312 has gne through a lot of review already, I would prefer that this branch builds on top of that to more easily review the differences. We can always squash things before merging for a cleaner history.",
      "created_at" : "2015-12-08T21:43:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7187#issuecomment-163026874",
      "id" : 163026874,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7187",
      "updated_at" : "2015-12-08T21:43:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/163026874",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "~~@jtimon That was the first thing I created: maaku@sequencenumbers...morcos:refactorb~~\r\n(misunderstanding of what he was asking)\r\n\r\nBut I think #7184 is a cleaner implementation of BIP 68 on its own.",
      "created_at" : "2015-12-08T21:55:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7187#issuecomment-163030416",
      "id" : 163030416,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7187",
      "updated_at" : "2015-12-09T02:53:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/163030416",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "as said squashes to clean up the history can happen after review.\r\nAs mentiooned before, I still don't see how maaku@sequencenumbers...morcos achieves its alleged goal.",
      "created_at" : "2015-12-08T22:05:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7187#issuecomment-163032934",
      "id" : 163032934,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7187",
      "updated_at" : "2015-12-08T22:05:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/163032934",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "rebased",
      "created_at" : "2015-12-09T02:52:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7187#issuecomment-163089747",
      "id" : 163089747,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7187",
      "updated_at" : "2015-12-09T02:52:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/163089747",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "I think this PR is too complicated for fixing the perf issue, if https://github.com/NicolasDorier/bitcoin/compare/67646e099c13...b2a27a71823b is correct, it would be simpler to review. Regardless if we use #7184 or not.",
      "created_at" : "2015-12-09T03:54:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7187#issuecomment-163096743",
      "id" : 163096743,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7187",
      "updated_at" : "2015-12-09T03:54:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/163096743",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "body" : "@NicolasDorier I agree. Maybe more importantly, all the extra complexity is outside of the consensus critical code. Maybe you should consider opening a PR for your solution?\r\nIn this thread we should focus on the code of this PR. We have #7176 to discuss the different solutions more generally.",
      "created_at" : "2015-12-09T05:28:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7187#issuecomment-163114806",
      "id" : 163114806,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7187",
      "updated_at" : "2015-12-09T05:28:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/163114806",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Is this supposed to fix the performance issues of CNB without touching miner.cpp, or are this just preparations without the actual performance solution?",
      "created_at" : "2015-12-09T06:23:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7187#issuecomment-163123165",
      "id" : 163123165,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7187",
      "updated_at" : "2015-12-09T06:23:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/163123165",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "@jtimon This fixes the performance issues by never introducing them into CNB in the first place.  #7184 on its own has performance issues with reorgs.\r\n\r\n@NicolasDorier You think just the second commit here is significantly more complicated than your final commit in #7190?",
      "created_at" : "2015-12-09T11:19:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7187#issuecomment-163192224",
      "id" : 163192224,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7187",
      "updated_at" : "2015-12-09T11:19:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/163192224",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "squashed a bug fix (wasn't actually skipping the work it was supposed to)",
      "created_at" : "2015-12-09T12:10:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7187#issuecomment-163205428",
      "id" : 163205428,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7187",
      "updated_at" : "2015-12-09T12:10:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/163205428",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "I like the fact you separate CheckLockTime (if you rename IsFinalTx) and CheckSequenceLockTime, but I really don't like the LockPoints structure. I'm still reviewing if commit 2 might not result in mempool finality corruption, I really don't find it obvious.",
      "created_at" : "2015-12-09T15:09:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7187#issuecomment-163284432",
      "id" : 163284432,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7187",
      "updated_at" : "2015-12-09T15:09:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/163284432",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "body" : "btw can you rename IsFinalTx to CheckLockTime as you said you wanted to do ?",
      "created_at" : "2015-12-09T15:18:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7187#issuecomment-163287172",
      "id" : 163287172,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7187",
      "updated_at" : "2015-12-09T15:18:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/163287172",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "body" : "@NicolasDorier My approach and yours are not that different.  \r\n- You are storing the hash at which the calculation of the sequence lock time and height happened and using the fact that if that hash is still on the chain that the calculation must still be valid and the comparison to the current time and height must be valid because they can not have gone below what they were at the hash you saved.\r\n- I'm storing the lowest height hash at which the calculation of the sequence lock time and height would necessarily still be valid (which is the hash of the highest height input with a sequence lock, b/c if none of the inputs changed height then the calculation is trivially the same) and the result of the calculation.   But in the case of my code, I have to redo the comparison part because the current time and height maybe be lower than they were at the time I originally did the comparison.   So I will redo comparisons for every tx on every reorg, but that is extremely fast, and I save redoing the expensive calculations for many more txs.\r\n",
      "created_at" : "2015-12-09T16:14:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7187#issuecomment-163309935",
      "id" : 163309935,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7187",
      "updated_at" : "2015-12-09T16:14:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/163309935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "Ok I'm getting it. Seems like it can work.\r\nYou forget to check SequenceLockTime in rpcwallet.cpp, wallet.cpp.",
      "created_at" : "2015-12-09T16:54:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7187#issuecomment-163322411",
      "id" : 163322411,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7187",
      "updated_at" : "2015-12-09T16:54:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/163322411",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   }
]
