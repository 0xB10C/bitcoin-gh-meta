[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK (to format the IPv6 addresses without calling (indirectly) `socket()`).\r\n\r\nWould `inet_ntop()` also call `socket()`?",
      "created_at" : "2021-03-19T15:01:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/21466#issuecomment-802897382",
      "id" : 802897382,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21466",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMjg5NzM4Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-19T15:01:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/802897382",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@vasild \r\n\r\nI think we should make our function `IPv6ToString` do proper zero compression (should be doable in say ~25 LOC) and then use that from `CNetAddr::ToStringIP`.\r\n\r\nThis is the patch I'm thinking at the call site:\r\n\r\n```patch\r\n std::string CNetAddr::ToStringIP() const\r\n {\r\n     switch (m_net) {\r\n     case NET_IPV4:\r\n+        return IPv4ToString(m_addr);\r\n     case NET_IPV6: {\r\n-        CService serv(*this, 0);\r\n-        struct sockaddr_storage sockaddr;\r\n-        socklen_t socklen = sizeof(sockaddr);\r\n-        if (serv.GetSockAddr((struct sockaddr*)&sockaddr, &socklen)) {\r\n-            char name[1025] = \"\";\r\n-            if (!getnameinfo((const struct sockaddr*)&sockaddr, socklen, name,\r\n-                             sizeof(name), nullptr, 0, NI_NUMERICHOST))\r\n-                return std::string(name);\r\n-        }\r\n-        if (m_net == NET_IPV4) {\r\n-            return strprintf(\"%u.%u.%u.%u\", m_addr[0], m_addr[1], m_addr[2], m_addr[3]);\r\n-        }\r\n         return IPv6ToString(m_addr);\r\n     }\r\n```\r\n\r\nI find that much easier to reason about :)",
      "created_at" : "2021-03-19T15:55:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/21466#issuecomment-802934616",
      "id" : 802934616,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21466",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMjkzNDYxNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-19T16:03:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/802934616",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
