[
   {
      "body" : "Since github shows the commits sorted by author date rather than dependency order, here is a list of all commits:\r\n\r\n\r\nSince github shows commits sorted by author date rather than dependency order, here is a list of all commits:\r\n* preparation (https://github.com/sipa/bitcoin/compare/187186b0fe039010ea4b81edb671b9bdfc63d29a...e69265d)\r\n  * 644b2c5 Keep addrman's nService bits consistent with outbound observations\r\n  * afdc413 Verify that outbound connections have expected services\r\n  * fdec2bc Only store and connect to NODE_NETWORK nodes\r\n* segnet (https://github.com/sipa/bitcoin/compare/e69265d...bb4bb47)\r\n  * 66dbd81 Don't check the genesis block PoW\r\n  * 70ebe86 Create segnet4\r\n  * f8bcd86 Add segnet seed nodes\r\n  * 58847fe qt: Work (don't crash) with -segnet\r\n* P2P/node/consensus (https://github.com/sipa/bitcoin/compare/bb4bb47...351a2fe)\r\n  * 3b1ff49 Add segregated witness transaction serialization\r\n  * e35d020 Removed ppszTypeName from protocol.cpp\r\n  * adb1c09 getdata enum issue fix\r\n  * ac6886d Introduce and preferentially peer with NODE_WITNESS service bit\r\n  * cb9d4d3 Witness commitment validation\r\n  * 2c87be1 Script validation logic for witnesses\r\n  * 1e47805 Enable SCRIPT_VERIFY_WITNESS for mempool transactions\r\n  * 97f34f7 Activate script consensus rules through BIP9\r\n  * 6a8021f Only download blocks from witness peers after fork\r\n  * 271e45e Observe input amounts: verification\r\n  * d374139 Add signature version 1 with updated sighash\r\n  * 92c6dc3 Return witness data\r\n  * 3955218 Implement block size/sigop cost rules, limits, and GBT support\r\n  * 5a47b98 Add command line options to loosen mempool acceptance rules\r\n  * e573571 bitcoinconsensus: add method that accepts amount, and return error when verify_script receives VERIFY_WITNESS flag\r\n  * a6386c2 Increase MAX_PROTOCOL_MESSAGE_LENGTH\r\n  * 1b6c6f1 Add rewind logic to deal with post-fork software updates\r\n* wallet (https://github.com/sipa/bitcoin/compare/351a2fe...a2d6f8a)\r\n  * abbe085 Witness script signing\r\n  * c3fe53f Add witness address RPCs (using P2SH)\r\n  * ec385fa signrawtransaction can sign P2WSH\r\n* tests (https://github.com/sipa/bitcoin/compare/a2d6f8a...7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec)\r\n  * 2ed1d11 Signing tests\r\n  * 3c0b16f Add rpc test for segwit\r\n  * 24746d2 Add transaction tests for segwit\r\n  * 3409ad6 Add segwit support to script_tests\r\n  * e5ffcc1 Autogeneration support for witness in script_tests\r\n  * 5e6abe5 Update p2p test framework with segwit support\r\n  * 7b539f9 P2P test for segwit\r\n\r\nCode to generate this list:\r\n```\r\nPREV=\"$(git rev-parse HEAD)\"; (git log --oneline upstream/master..HEAD; echo \"$(git rev-parse upstream/master) --- [SEGWIT] begin: preparation ---\") | while read C L; do if [ \"d${L:0:13}\" == \"d--- [SEGWIT] \" ]; then if [ \"d$PREV\" != \"\" ]; then echo \"* ${L:20:-4} (https://github.com/sipa/bitcoin/compare/$C...$PREV)\"; fi; PREV=$C; PREVL=$L; else echo \"  * $C $L\"; fi; done | tac\r\n```",
      "created_at" : "2016-04-19T16:09:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#issuecomment-211998958",
      "id" : 211998958,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7910",
      "updated_at" : "2016-04-19T16:42:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/211998958",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60280033"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60280033"
         }
      },
      "body" : "Probably should throw an error if it's not hex. Currently accepts anything entered.",
      "commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "created_at" : "2016-04-19T18:02:26Z",
      "diff_hunk" : "@@ -312,6 +312,39 @@ UniValue createmultisig(const UniValue& params, bool fHelp)\n     return result;\n }\n \n+UniValue createwitnessaddress(const UniValue& params, bool fHelp)\n+{\n+    if (fHelp || params.size() < 1 || params.size() > 1)\n+    {\n+        string msg = \"createwitnessaddress \\\"script\\\"\\n\"\n+            \"\\nCreates a witness address for a particular script.\\n\"\n+            \"It returns a json object with the address and witness script.\\n\"\n+\n+            \"\\nArguments:\\n\"\n+            \"1. \\\"script\\\"       (string, required) A hex encoded script\\n\"\n+\n+            \"\\nResult:\\n\"\n+            \"{\\n\"\n+            \"  \\\"address\\\":\\\"multisigaddress\\\",  (string) The value of the new address (P2SH of witness script).\\n\"\n+            \"  \\\"witnessScript\\\":\\\"script\\\"      (string) The string value of the hex-encoded witness script.\\n\"\n+            \"}\\n\"\n+        ;\n+        throw runtime_error(msg);\n+    }\n+\n+    std::vector<unsigned char> code = ParseHex(params[0].get_str());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60280033",
      "id" : 60280033,
      "original_commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "original_position" : 24,
      "path" : "src/rpc/misc.cpp",
      "position" : 24,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910",
      "updated_at" : "2016-04-19T18:02:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60280033",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "Created pull request https://github.com/sipa/bitcoin/pull/75 on sipa's repository against this branch. Explanation of the proposed change:\r\n\r\n> The witness root is allowed to be placed at an arbitrary position up to seven layers deep in a Merkle tree structure. The witness nonce is now the branch through the commitment tree to the witness root, and a single byte is added to the commitment output specifying this path in compact form. This allows other consensus commitments to be added in the future with a minimal number of bytes and without committing at this time for a certain position for the segwit branch within the tree.\r\n>\r\n> In addition, switch to fast Merkle trees for witness. A fast Merkle branch uses midstate to perform a single SHA-256 compression per branch, and is not vulnerable to CVE-2012-2459. It produces different hashes though, so can only be used for new hash trees going forward.\r\n",
      "created_at" : "2016-04-19T18:51:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#issuecomment-212066524",
      "id" : 212066524,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7910",
      "updated_at" : "2016-04-19T18:52:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/212066524",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69154?v=3",
         "events_url" : "https://api.github.com/users/maaku/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maaku/followers",
         "following_url" : "https://api.github.com/users/maaku/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maaku/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maaku",
         "id" : 69154,
         "login" : "maaku",
         "organizations_url" : "https://api.github.com/users/maaku/orgs",
         "received_events_url" : "https://api.github.com/users/maaku/received_events",
         "repos_url" : "https://api.github.com/users/maaku/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maaku/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maaku/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maaku"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60292915"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60292915"
         }
      },
      "body" : "nit: ensure wallet is available for more useful error than \"not known to wallet\"",
      "commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "created_at" : "2016-04-19T19:14:17Z",
      "diff_hunk" : "@@ -1095,6 +1095,75 @@ UniValue addmultisigaddress(const UniValue& params, bool fHelp)\n     return CBitcoinAddress(innerID).ToString();\n }\n \n+class Witnessifier : public boost::static_visitor<bool>\n+{\n+public:\n+    CScriptID result;\n+\n+    bool operator()(const CNoDestination &dest) const { return false; }\n+\n+    bool operator()(const CKeyID &keyID) {\n+        CPubKey pubkey;\n+        if (pwalletMain && pwalletMain->GetPubKey(keyID, pubkey)) {\n+            CScript basescript;\n+            basescript << ToByteVector(pubkey) << OP_CHECKSIG;\n+            CScript witscript = GetScriptForWitness(basescript);\n+            pwalletMain->AddCScript(witscript);\n+            result = CScriptID(witscript);\n+            return true;\n+        }\n+        return false;\n+    }\n+\n+    bool operator()(const CScriptID &scriptID) {\n+        CScript subscript;\n+        if (pwalletMain && pwalletMain->GetCScript(scriptID, subscript)) {\n+            int witnessversion;\n+            std::vector<unsigned char> witprog;\n+            if (subscript.IsWitnessProgram(witnessversion, witprog)) {\n+                result = scriptID;\n+                return true;\n+            }\n+            CScript witscript = GetScriptForWitness(subscript);\n+            pwalletMain->AddCScript(witscript);\n+            result = CScriptID(witscript);\n+            return true;\n+        }\n+        return false;\n+    }\n+};\n+\n+UniValue addwitnessaddress(const UniValue& params, bool fHelp)\n+{",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60292915",
      "id" : 60292915,
      "original_commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "original_position" : 43,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 43,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910",
      "updated_at" : "2016-04-19T19:14:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60292915",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "See sipa#76 for fix to CInv::GetCommand",
      "created_at" : "2016-04-19T19:31:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#issuecomment-212079865",
      "id" : 212079865,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7910",
      "updated_at" : "2016-04-19T19:31:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/212079865",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "Ayayay... a third of the original client's source base. I assume the items left to do will be committed to this PR #7910 ?",
      "created_at" : "2016-04-20T01:03:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#issuecomment-212190166",
      "id" : 212190166,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7910",
      "updated_at" : "2016-04-20T01:03:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/212190166",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8286077?v=3",
         "events_url" : "https://api.github.com/users/21E14/events{/privacy}",
         "followers_url" : "https://api.github.com/users/21E14/followers",
         "following_url" : "https://api.github.com/users/21E14/following{/other_user}",
         "gists_url" : "https://api.github.com/users/21E14/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/21E14",
         "id" : 8286077,
         "login" : "21E14",
         "organizations_url" : "https://api.github.com/users/21E14/orgs",
         "received_events_url" : "https://api.github.com/users/21E14/received_events",
         "repos_url" : "https://api.github.com/users/21E14/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/21E14/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/21E14/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/21E14"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60356762"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60356762"
         }
      },
      "body" : "this little commitpos check could use a refactor, it appears 3 times. #DRY.",
      "commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "created_at" : "2016-04-20T06:44:28Z",
      "diff_hunk" : "@@ -3301,6 +3347,68 @@ static bool CheckIndexAgainstCheckpoint(const CBlockIndex* pindexPrev, CValidati\n     return true;\n }\n \n+bool IsWitnessEnabled(const CBlockIndex* pindexPrev, const Consensus::Params& params)\n+{\n+    LOCK(cs_main);\n+    return (VersionBitsState(pindexPrev, params, Consensus::DEPLOYMENT_WITNESS, versionbitscache) == THRESHOLD_ACTIVE);\n+}\n+\n+void UpdateUncommitedBlockStructures(CBlock& block, const CBlockIndex* pindexPrev, const Consensus::Params& consensusParams)\n+{\n+    int commitpos = -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60356762",
      "id" : 60356762,
      "original_commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "original_position" : 348,
      "path" : "src/main.cpp",
      "position" : 348,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910",
      "updated_at" : "2016-04-20T06:44:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60356762",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/163977?v=3",
         "events_url" : "https://api.github.com/users/gubatron/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gubatron/followers",
         "following_url" : "https://api.github.com/users/gubatron/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gubatron/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gubatron",
         "id" : 163977,
         "login" : "gubatron",
         "organizations_url" : "https://api.github.com/users/gubatron/orgs",
         "received_events_url" : "https://api.github.com/users/gubatron/received_events",
         "repos_url" : "https://api.github.com/users/gubatron/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gubatron/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gubatron/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gubatron"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60373788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60373788"
         }
      },
      "body" : "Agree!",
      "commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "created_at" : "2016-04-20T09:07:33Z",
      "diff_hunk" : "@@ -3301,6 +3347,68 @@ static bool CheckIndexAgainstCheckpoint(const CBlockIndex* pindexPrev, CValidati\n     return true;\n }\n \n+bool IsWitnessEnabled(const CBlockIndex* pindexPrev, const Consensus::Params& params)\n+{\n+    LOCK(cs_main);\n+    return (VersionBitsState(pindexPrev, params, Consensus::DEPLOYMENT_WITNESS, versionbitscache) == THRESHOLD_ACTIVE);\n+}\n+\n+void UpdateUncommitedBlockStructures(CBlock& block, const CBlockIndex* pindexPrev, const Consensus::Params& consensusParams)\n+{\n+    int commitpos = -1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60373788",
      "id" : 60373788,
      "original_commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "original_position" : 348,
      "path" : "src/main.cpp",
      "position" : 348,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910",
      "updated_at" : "2016-04-20T09:07:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60373788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "function UpdateUncommitedBlockStructures redefine in main.h\r\n\r\n> +\r\n +void UpdateUncommitedBlockStructures(CBlock& block, const CBlockIndex* pindexPrev, const Consensus::Params& consensusParams);\r\n +\r\n +/** Update uncommitted block structures (currently: only the witness nonce). This is safe for submitted blocks. */\r\n +void UpdateUncommitedBlockStructures(CBlock& block, const CBlockIndex* pindexPrev, const Consensus::Params& consensusParams);\r\n +\r\n\r\nsee [sipa#78](https://github.com/sipa/bitcoin/pull/78)",
      "created_at" : "2016-04-20T11:10:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#issuecomment-212383627",
      "id" : 212383627,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7910",
      "updated_at" : "2016-04-20T11:14:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/212383627",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7669610?v=3",
         "events_url" : "https://api.github.com/users/LongShao007/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LongShao007/followers",
         "following_url" : "https://api.github.com/users/LongShao007/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LongShao007/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LongShao007",
         "id" : 7669610,
         "login" : "LongShao007",
         "organizations_url" : "https://api.github.com/users/LongShao007/orgs",
         "received_events_url" : "https://api.github.com/users/LongShao007/received_events",
         "repos_url" : "https://api.github.com/users/LongShao007/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LongShao007/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LongShao007/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LongShao007"
      }
   },
   {
      "body" : "I can sometimes repeat failed test (https://travis-ci.org/bitcoin/bitcoin/jobs/124242358#L4152) even on master - `wallet.py`, so it seems to be irrelevant to this PR.\r\n",
      "created_at" : "2016-04-20T15:18:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#issuecomment-212473734",
      "id" : 212473734,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7910",
      "updated_at" : "2016-04-20T15:18:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/212473734",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "Jup, since we are aware of the issue, this might be a good time to disable this specific test.",
      "created_at" : "2016-04-20T15:21:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#issuecomment-212474862",
      "id" : 212474862,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7910",
      "updated_at" : "2016-04-20T15:21:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/212474862",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60453999"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60453999"
         }
      },
      "body" : "GetTransactionSigOpCost() could return a value close to 2^29 (4M * 20 (multisig) * 4) so to be safe nSigOps should be an int64_t. That can prevent overflows on future witness size extensions.\r\n",
      "commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "created_at" : "2016-04-20T17:40:34Z",
      "diff_hunk" : "@@ -1144,8 +1168,7 @@ bool AcceptToMemoryPoolWorker(CTxMemPool& pool, CValidationState& state, const C\n         if (fRequireStandard && !AreInputsStandard(tx, view))\n             return state.Invalid(false, REJECT_NONSTANDARD, \"bad-txns-nonstandard-inputs\");\n \n-        unsigned int nSigOps = GetLegacySigOpCount(tx);\n-        nSigOps += GetP2SHSigOpCount(tx, view);\n+        unsigned int nSigOpsCost = GetTransactionSigOpCost(tx, view, STANDARD_SCRIPT_VERIFY_FLAGS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60453999",
      "id" : 60453999,
      "original_commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "original_position" : 71,
      "path" : "src/main.cpp",
      "position" : 71,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910",
      "updated_at" : "2016-04-20T17:40:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60453999",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1752347?v=3",
         "events_url" : "https://api.github.com/users/SergioDemianLerner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/SergioDemianLerner/followers",
         "following_url" : "https://api.github.com/users/SergioDemianLerner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/SergioDemianLerner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/SergioDemianLerner",
         "id" : 1752347,
         "login" : "SergioDemianLerner",
         "organizations_url" : "https://api.github.com/users/SergioDemianLerner/orgs",
         "received_events_url" : "https://api.github.com/users/SergioDemianLerner/received_events",
         "repos_url" : "https://api.github.com/users/SergioDemianLerner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/SergioDemianLerner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/SergioDemianLerner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/SergioDemianLerner"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60454436"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60454436"
         }
      },
      "body" : "same here. nSigOps -> int64_t",
      "commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "created_at" : "2016-04-20T17:43:08Z",
      "diff_hunk" : "@@ -2326,7 +2369,7 @@ bool ConnectBlock(const CBlock& block, CValidationState& state, CBlockIndex* pin\n     std::vector<int> prevheights;\n     CAmount nFees = 0;\n     int nInputs = 0;\n-    unsigned int nSigOps = 0;\n+    unsigned int nSigOpsCost = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60454436",
      "id" : 60454436,
      "original_commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "original_position" : 195,
      "path" : "src/main.cpp",
      "position" : 195,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910",
      "updated_at" : "2016-04-20T17:43:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60454436",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1752347?v=3",
         "events_url" : "https://api.github.com/users/SergioDemianLerner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/SergioDemianLerner/followers",
         "following_url" : "https://api.github.com/users/SergioDemianLerner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/SergioDemianLerner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/SergioDemianLerner",
         "id" : 1752347,
         "login" : "SergioDemianLerner",
         "organizations_url" : "https://api.github.com/users/SergioDemianLerner/orgs",
         "received_events_url" : "https://api.github.com/users/SergioDemianLerner/received_events",
         "repos_url" : "https://api.github.com/users/SergioDemianLerner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/SergioDemianLerner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/SergioDemianLerner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/SergioDemianLerner"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60463090"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60463090"
         }
      },
      "body" : "Why not (4M * 20 (multisig))? You may have 4MB only if it is a segwit tx, and cost of segwit sigops does not need to * 4",
      "commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "created_at" : "2016-04-20T18:32:29Z",
      "diff_hunk" : "@@ -1144,8 +1168,7 @@ bool AcceptToMemoryPoolWorker(CTxMemPool& pool, CValidationState& state, const C\n         if (fRequireStandard && !AreInputsStandard(tx, view))\n             return state.Invalid(false, REJECT_NONSTANDARD, \"bad-txns-nonstandard-inputs\");\n \n-        unsigned int nSigOps = GetLegacySigOpCount(tx);\n-        nSigOps += GetP2SHSigOpCount(tx, view);\n+        unsigned int nSigOpsCost = GetTransactionSigOpCost(tx, view, STANDARD_SCRIPT_VERIFY_FLAGS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60463090",
      "id" : 60463090,
      "original_commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "original_position" : 71,
      "path" : "src/main.cpp",
      "position" : 71,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910",
      "updated_at" : "2016-04-20T18:32:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60463090",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8403418?v=3",
         "events_url" : "https://api.github.com/users/jl2012/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jl2012/followers",
         "following_url" : "https://api.github.com/users/jl2012/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jl2012/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jl2012",
         "id" : 8403418,
         "login" : "jl2012",
         "organizations_url" : "https://api.github.com/users/jl2012/orgs",
         "received_events_url" : "https://api.github.com/users/jl2012/received_events",
         "repos_url" : "https://api.github.com/users/jl2012/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jl2012/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jl2012/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jl2012"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60482327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60482327"
         }
      },
      "body" : "I agree with jl2012, and I think an int64_t is not necessary at this point. It won't hurt though, so I'll switch the type.",
      "commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "created_at" : "2016-04-20T20:34:32Z",
      "diff_hunk" : "@@ -1144,8 +1168,7 @@ bool AcceptToMemoryPoolWorker(CTxMemPool& pool, CValidationState& state, const C\n         if (fRequireStandard && !AreInputsStandard(tx, view))\n             return state.Invalid(false, REJECT_NONSTANDARD, \"bad-txns-nonstandard-inputs\");\n \n-        unsigned int nSigOps = GetLegacySigOpCount(tx);\n-        nSigOps += GetP2SHSigOpCount(tx, view);\n+        unsigned int nSigOpsCost = GetTransactionSigOpCost(tx, view, STANDARD_SCRIPT_VERIFY_FLAGS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60482327",
      "id" : 60482327,
      "original_commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "original_position" : 71,
      "path" : "src/main.cpp",
      "position" : 71,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910",
      "updated_at" : "2016-04-20T20:34:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60482327",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60483311"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60483311"
         }
      },
      "body" : "The formula is exact.\n\nIt's trying to explain the rationale for this rule (basesize * 3 + totalsize) by showing that it corresponds to (basesize * 4 + witsize). But perhaps this rationale belongs in the BIP and not in the code.",
      "commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "created_at" : "2016-04-20T20:40:44Z",
      "diff_hunk" : "@@ -31,3 +31,11 @@ std::string CBlock::ToString() const\n     }\n     return s.str();\n }\n+\n+int64_t GetBlockCost(const CBlock& block)\n+{\n+    // The intended approximate formula is: cost = base_size * 4 + witness_size.\n+    // We can only serialize base or base+witness, so the formula\n+    // becomes: cost = base_size * 3 + total_size.\n+    return ::GetSerializeSize(block, SER_NETWORK, 0) * (WITNESS_SCALE_FACTOR - 1) + ::GetSerializeSize(block, SER_NETWORK, SERIALIZE_TRANSACTION_WITNESS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60483311",
      "id" : 60483311,
      "original_commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "original_position" : 10,
      "path" : "src/primitives/block.cpp",
      "position" : 10,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910",
      "updated_at" : "2016-04-20T20:40:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60483311",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60519803"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60519803"
         }
      },
      "body" : "What was the reasoning behind separating this from being derived from the network rule?",
      "commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "created_at" : "2016-04-21T02:48:43Z",
      "diff_hunk" : "@@ -6,10 +6,14 @@\n #ifndef BITCOIN_CONSENSUS_CONSENSUS_H\n #define BITCOIN_CONSENSUS_CONSENSUS_H\n \n-/** The maximum allowed size for a serialized block, in bytes (network rule) */\n-static const unsigned int MAX_BLOCK_SIZE = 1000000;\n+/** The maximum allowed size for a serialized block, in bytes (only for buffer size limits) */\n+static const unsigned int MAX_BLOCK_SERIALIZED_SIZE = 4000000;\n+/** The maximum allowed cost for a block, see BIP 141 (network rule) */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60519803",
      "id" : 60519803,
      "original_commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "original_position" : 8,
      "path" : "src/consensus/consensus.h",
      "position" : 8,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910",
      "updated_at" : "2016-04-21T02:48:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60519803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60521354"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60521354"
         }
      },
      "body" : "> **Reject** witness transactions if segregated witness is disabled [and a witness exists]; override with `-prematurewitness` to bypass\r\n\r\nIMHO, reads easier, less negations to do in my head",
      "commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "created_at" : "2016-04-21T03:16:58Z",
      "diff_hunk" : "@@ -1033,6 +1052,11 @@ bool AcceptToMemoryPoolWorker(CTxMemPool& pool, CValidationState& state, const C\n         return state.DoS(0, false, REJECT_NONSTANDARD, \"premature-version2-tx\");\n     }\n \n+    // Don't accept witness transactions before the final threshold passes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60521354",
      "id" : 60521354,
      "original_commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "original_position" : 57,
      "path" : "src/main.cpp",
      "position" : 57,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910",
      "updated_at" : "2016-04-21T03:18:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60521354",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60521686"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60521686"
         }
      },
      "body" : "Could this be bracketed such that precedence rules don't need to be remembered?",
      "commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "created_at" : "2016-04-21T03:24:05Z",
      "diff_hunk" : "@@ -1179,9 +1202,9 @@ bool AcceptToMemoryPoolWorker(CTxMemPool& pool, CValidationState& state, const C\n         // itself can contain sigops MAX_STANDARD_TX_SIGOPS is less than\n         // MAX_BLOCK_SIGOPS; we still consider this an invalid rather than\n         // merely non-standard transaction.\n-        if ((nSigOps > MAX_STANDARD_TX_SIGOPS) || (nBytesPerSigOp && nSigOps > nSize / nBytesPerSigOp))\n+        if ((nSigOpsCost > MAX_STANDARD_TX_SIGOPS_COST) || (nBytesPerSigOp && nSigOpsCost > nSize * WITNESS_SCALE_FACTOR / nBytesPerSigOp))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60521686",
      "id" : 60521686,
      "original_commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "original_position" : 89,
      "path" : "src/main.cpp",
      "position" : 89,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910",
      "updated_at" : "2016-04-21T03:24:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60521686",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60522057"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60522057"
         }
      },
      "body" : "ACK switch to `uint64_t`,  its what is returned by `GetTransactionSigOpCost` any way... explicit casts should be the rule, not the exception (IMHO).",
      "commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "created_at" : "2016-04-21T03:32:24Z",
      "diff_hunk" : "@@ -1144,8 +1168,7 @@ bool AcceptToMemoryPoolWorker(CTxMemPool& pool, CValidationState& state, const C\n         if (fRequireStandard && !AreInputsStandard(tx, view))\n             return state.Invalid(false, REJECT_NONSTANDARD, \"bad-txns-nonstandard-inputs\");\n \n-        unsigned int nSigOps = GetLegacySigOpCount(tx);\n-        nSigOps += GetP2SHSigOpCount(tx, view);\n+        unsigned int nSigOpsCost = GetTransactionSigOpCost(tx, view, STANDARD_SCRIPT_VERIFY_FLAGS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60522057",
      "id" : 60522057,
      "original_commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "original_position" : 71,
      "path" : "src/main.cpp",
      "position" : 71,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910",
      "updated_at" : "2016-04-21T03:32:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60522057",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60522121"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60522121"
         }
      },
      "body" : "Less implicit casts if this is also `uint64_t`",
      "commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "created_at" : "2016-04-21T03:33:53Z",
      "diff_hunk" : "@@ -6,10 +6,14 @@\n #ifndef BITCOIN_CONSENSUS_CONSENSUS_H\n #define BITCOIN_CONSENSUS_CONSENSUS_H\n \n-/** The maximum allowed size for a serialized block, in bytes (network rule) */\n-static const unsigned int MAX_BLOCK_SIZE = 1000000;\n+/** The maximum allowed size for a serialized block, in bytes (only for buffer size limits) */\n+static const unsigned int MAX_BLOCK_SERIALIZED_SIZE = 4000000;\n+/** The maximum allowed cost for a block, see BIP 141 (network rule) */\n+static const unsigned int MAX_BLOCK_COST = 4000000;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60522121",
      "id" : 60522121,
      "original_commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "original_position" : 9,
      "path" : "src/consensus/consensus.h",
      "position" : 9,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910",
      "updated_at" : "2016-04-21T03:33:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60522121",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60643948"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60643948"
         }
      },
      "body" : "You mean \"room *for* spam\"?",
      "commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "created_at" : "2016-04-21T19:48:44Z",
      "diff_hunk" : "@@ -3354,6 +3462,58 @@ bool ContextualCheckBlock(const CBlock& block, CValidationState& state, CBlockIn\n         }\n     }\n \n+    // Validation for witness commitments.\n+    // * We compute the witness hash (which is the hash including witnesses) of all the block's transactions, except the\n+    //   coinbase (where 0x0000....0000 is used instead).\n+    // * The coinbase scriptWitness is a stack of a single 32-byte vector, containing a witness nonce (unconstrained).\n+    // * We build a merkle tree with all those witness hashes as leaves (similar to the hashMerkleRoot in the block header).\n+    // * The must be at least one output whose scriptPubKey is a single 36-byte push, the first 4 bytes of which are\n+    //   {0xaa, 0x21, 0xa9, 0xed}, and the following 32 bytes are SHA256(witness root, witness nonce). In case there are\n+    //   multiple, the last one is used.\n+    bool fHaveWitness = false;\n+    if (IsWitnessEnabled(pindexPrev, consensusParams)) {\n+        int commitpos = -1;\n+        for (size_t o = 0; o < block.vtx[0].vout.size(); o++) {\n+            if (block.vtx[0].vout[o].scriptPubKey.size() >= 38 && block.vtx[0].vout[o].scriptPubKey[0] == OP_RETURN && block.vtx[0].vout[o].scriptPubKey[1] == 0x24 && block.vtx[0].vout[o].scriptPubKey[2] == 0xaa && block.vtx[0].vout[o].scriptPubKey[3] == 0x21 && block.vtx[0].vout[o].scriptPubKey[4] == 0xa9 && block.vtx[0].vout[o].scriptPubKey[5] == 0xed) {\n+                commitpos = o;\n+            }\n+        }\n+        if (commitpos != -1) {\n+            bool malleated = false;\n+            uint256 hashWitness = BlockWitnessMerkleRoot(block, &malleated);\n+            // The malleation check is ignored; as the transaction tree itself\n+            // already does not permit it, it is impossible to trigger in the\n+            // witness tree.\n+            if (block.vtx[0].wit.vtxinwit.size() != 1 || block.vtx[0].wit.vtxinwit[0].scriptWitness.stack.size() != 1 || block.vtx[0].wit.vtxinwit[0].scriptWitness.stack[0].size() != 32) {\n+                return state.DoS(100, error(\"%s : invalid witness commitment size\", __func__), REJECT_INVALID, \"bad-witness-merkle-size\", true);\n+            }\n+            CHash256().Write(hashWitness.begin(), 32).Write(&block.vtx[0].wit.vtxinwit[0].scriptWitness.stack[0][0], 32).Finalize(hashWitness.begin());\n+            if (memcmp(hashWitness.begin(), &block.vtx[0].vout[commitpos].scriptPubKey[6], 32)) {\n+                return state.DoS(100, error(\"%s : witness merkle commitment mismatch\", __func__), REJECT_INVALID, \"bad-witness-merkle-match\", true);\n+            }\n+            fHaveWitness = true;\n+        }\n+    }\n+\n+    // No witness data is allowed in blocks that don't commit to witness data, as this would otherwise leave room from spam",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60643948",
      "id" : 60643948,
      "original_commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "original_position" : 442,
      "path" : "src/main.cpp",
      "position" : 442,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910",
      "updated_at" : "2016-04-21T19:48:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60643948",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60644990"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60644990"
         }
      },
      "body" : "So just remove the word 'approximate'? I think it is helpful to keep the rest of the explanation here.",
      "commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "created_at" : "2016-04-21T19:56:17Z",
      "diff_hunk" : "@@ -31,3 +31,11 @@ std::string CBlock::ToString() const\n     }\n     return s.str();\n }\n+\n+int64_t GetBlockCost(const CBlock& block)\n+{\n+    // The intended approximate formula is: cost = base_size * 4 + witness_size.\n+    // We can only serialize base or base+witness, so the formula\n+    // becomes: cost = base_size * 3 + total_size.\n+    return ::GetSerializeSize(block, SER_NETWORK, 0) * (WITNESS_SCALE_FACTOR - 1) + ::GetSerializeSize(block, SER_NETWORK, SERIALIZE_TRANSACTION_WITNESS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7910#discussion_r60644990",
      "id" : 60644990,
      "original_commit_id" : "7b539f9bfe4e96a9b30ffdc874aa80e4308c9dec",
      "original_position" : 10,
      "path" : "src/primitives/block.cpp",
      "position" : 10,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910",
      "updated_at" : "2016-04-21T19:56:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/60644990",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   }
]
