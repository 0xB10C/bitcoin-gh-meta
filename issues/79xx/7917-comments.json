[
   {
      "body" : "Good to see this!\r\n\r\n> All blocks are read twice from disk during reindex (once to rebuild the index, once to activate)\r\n\r\nCould this (theoretically) be avoided by just reading the header during the initial scan? after all, the extra header that we tack on includes the size of the block, so we could skip the rest the first time.\r\n",
      "created_at" : "2016-04-20T14:20:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-212445219",
      "id" : 212445219,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-04-20T14:22:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/212445219",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj Yes, I've considered that. That could lead to an inconsistent block index though (as in: I'm not sure whether there are any internal assumptions that all entries in the block index are valid).",
      "created_at" : "2016-04-20T14:22:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-212445689",
      "id" : 212445689,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-04-20T14:22:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/212445689",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Nice. Concept ACK.\r\nTesting this now on a mainnet node -reindex.",
      "created_at" : "2016-04-20T14:23:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-212445907",
      "id" : 212445907,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-04-20T14:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/212445907",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@laanwj Another problem with that approach: say you get a block corrupted near the chain tip on disk, you find it and do a reindex. You expect it to reindex up to that corrupted block and then start back from network. Instead, if you don't do transaction validation during the rebuild loop, it may happily add the block to the index, and have activation fail (making it mark the chain as invalid).",
      "created_at" : "2016-04-20T14:25:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-212446727",
      "id" : 212446727,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-04-20T14:25:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/212446727",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Yes, it would be quite more complex to handle those issues well.\r\nIn any case if the speed-up is more than the extra disk i/o that this generates takes, it doesn't matter, no need to worry about it in this pull. ",
      "created_at" : "2016-04-20T14:27:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-212447439",
      "id" : 212447439,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-04-20T14:27:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/212447439",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@jonasschnelli If you feel like benchmarking, an interesting thing to test is (reindex on master) vs (deleting chainstate on this PR), both with signature checks hackishly disabled. Deleting of chainstate caused a very slow, foreground, and (before #7821) uninterruptible process earlier. With this PR is should be (nearly) the same speed as an old reindex.",
      "created_at" : "2016-04-20T14:30:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-212448503",
      "id" : 212448503,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-04-20T14:32:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/212448503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Would it be useful to have a -weakreindex or -rebuild now, which does not throw out the block index, and only the chainstate? That would be faster, as it wouldn't need the rebuild phase.\r\n",
      "created_at" : "2016-04-20T14:39:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-212451342",
      "id" : 212451342,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-04-20T14:39:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/212451342",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "> Would it be useful to have a -weakreindex or -rebuild now, which does not throw out the block index, and only the chainstate? That would be faster, as it wouldn't need the rebuild phase.\r\n\r\nWould need better reporting about what database is corrupted for that to be useful to end-users. But even without that I can see that being very useful for benchmarking the UTXO database.\r\n\r\nI like the idea of being able to rebuild databases separately. What about the other way around? If you have a UTXO set, but want to reindex the block chain? (e.g. when switching a pruned node to a non-pruned one by copying block data from another node)\r\n\r\nIf it was up to me I wouldn't use the name 'weakindex' or 'rebuid' (that's another one for the rescan, reindex, re.... category of vaguenes) but call it what it is:  `-rebuild-blockindex` `-rebuild-chainstate` etc (using the same name as the db directory names).\r\n",
      "created_at" : "2016-04-20T15:37:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-212481137",
      "id" : 212481137,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-04-20T15:37:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/212481137",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "> I like the idea of being able to rebuild databases separately. What about the other way around? If you have a UTXO set, but want to reindex the block chain? (e.g. when switching a pruned node to a non-pruned one by copying block data from another node)\r\n\r\nYou can just overwrite your blocks/ database with another version (including its index), as long as it has your currently active chain in it.",
      "created_at" : "2016-04-20T15:41:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-212482450",
      "id" : 212482450,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-04-20T15:41:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/212482450",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Added a commit to implement -reindex-chainstate.\r\n\r\nI guess the semantics for -reindex-blockindex could be:\r\n* Rebuild the block index without rebuilding the chainstate\r\n* If afterwards the chainstate's tip is in the resulting block index, mark every block on the best chain as validated and pretend nothing happened\r\n* If not, wipe the chainstate and rebuild that as well.\r\n",
      "created_at" : "2016-04-21T12:17:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-212888289",
      "id" : 212888289,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-04-21T12:17:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/212888289",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "> I don't know what -rebuild-blockindex would mean though...\r\n\r\nThat hypothetical option would rebuild the blockindex database, say after some new-fangled corruption check detects that that database was corrupted.\r\n\r\n- Throw away the block index (so the database in blocks/index)\r\n- Reindex blocks\r\n\r\nBut don't touch the chain state in any way, it is assumed to be still good. If the best chain is not included after reindexing the blocks, throw another error that a ~~full reindex~~ -reindex-chainstate is necessary.\r\n\r\n> I guess the semantics for -reindex-blockindex could be:\r\n\r\nYes, something like that, sounds good to me.\r\n",
      "created_at" : "2016-04-21T12:23:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-212892025",
      "id" : 212892025,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-04-21T12:24:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/212892025",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "concept ACK `-(rebuild|reindex)-*`",
      "created_at" : "2016-04-22T00:03:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-213165405",
      "id" : 213165405,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-04-22T00:03:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/213165405",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "I tried implementing -reindex-blockindex, but it is significantly harder: it would mean first initializing with a dummy chainstate, then reindexing the blockindex while leaving the original chainstate untouched, then stopping the node, loading the real chainstate, marking the blocks along the best chain as valid (or fail if not found anymore), and starting the node again.",
      "created_at" : "2016-04-22T10:24:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-213370423",
      "id" : 213370423,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-04-22T10:24:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/213370423",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Going to test this",
      "created_at" : "2016-04-26T13:09:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-214735466",
      "id" : 214735466,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-04-26T13:09:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/214735466",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Not sure if this is expected behavior, it's probably harmless; but during the \"Reindexing block file\" initial scan, rev*.dat files are created with size 0:\r\n```\r\n-rw------- 1 user user         0 Apr 26 15:26 rev00415.dat\r\n-rw------- 1 user user         0 Apr 26 15:26 rev00416.dat\r\n-rw------- 1 user user         0 Apr 26 15:26 rev00417.dat\r\n-rw------- 1 user user         0 Apr 26 15:26 rev00418.dat\r\n```\r\n\r\nEdit: the block counts are off? possibly due to out-of-order blocks not being counted. It looks a bit strange but probably harmless:\r\n```\r\n2016-04-26 13:30:48 Reindexing block file blk00471.dat...\r\n2016-04-26 13:30:51 Loaded 3 blocks from external file in 2585ms\r\n```\r\n",
      "created_at" : "2016-04-26T13:29:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-214744957",
      "id" : 214744957,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-04-26T13:33:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/214744957",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Did a reindex of my test chain using this patch:\r\n```\r\n2016-04-26 13:07:36 Reindexing block file blk00000.dat...\r\n2016-04-26 13:32:16 UpdateTip: new best=00000000839a8e6886ab5951d76f411475428afc90947ee320161bbf18eb6048 height=1 version=0x00000001 log2_work=33.000022 tx=2 date='2009-01-09 02:54:25' progress=0.000000 cache=0.0MiB(1tx)\r\n2016-04-26 17:44:18 UpdateTip: new best=00000000000000000360e6d03330560950285d1062c6f6e6a4558ba1720d6e73 height=407838 version=0x00000004 log2_work=84.507935 tx=123156514 date='2016-04-18 11:34:09' progress=0.994753 cache=43.8MiB(23470tx)\r\n```\r\nTimes:\r\n```\r\nphase1   00:24:40 (1480s)\r\nphase2   04:12:02 (15122s)\r\n         -----------------\r\ntotal    04:36:42 (16602s)\r\n```\r\nFor comparison, a sync from a local node on the same machine, under the same conditions, takes 05:32:29 (19949s). That's very good. I have not tried doing a 'traditional' reindex,\r\n\r\nEdit: also verified that this fixes #7038. Also tested that interrupting the reindex then restarting works, both in the first phase and second phase.\r\n\r\nEdit.2: also did a \"traditional\" reindex - it took 04:45:49 (17149s). Only a bit longer. Note that this is a fast CPU with 8 cores, so possibly the difference with not validating is less than it would otherwise be. \r\n\r\nEdit.3: verified that utxo set hash is the same after old reindex versus new reindex (just to be sure).\r\n",
      "created_at" : "2016-04-26T17:58:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-214829344",
      "id" : 214829344,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-04-28T06:15:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/214829344",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7917#discussion_r61227711"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7917"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61227711"
         }
      },
      "body" : "Shouldn't this error be fatal?\r\n",
      "commit_id" : "691cbc972a724f716b486f4b43a33bc6e5a23d59",
      "created_at" : "2016-04-27T09:22:57Z",
      "diff_hunk" : "@@ -597,14 +598,18 @@ void ThreadImport(std::vector<boost::filesystem::path> vImportFiles)\n     BOOST_FOREACH(const boost::filesystem::path& path, vImportFiles) {\n         FILE *file = fopen(path.string().c_str(), \"rb\");\n         if (file) {\n-            CImportingNow imp;\n             LogPrintf(\"Importing blocks file %s...\\n\", path.string());\n             LoadExternalBlockFile(chainparams, file);\n         } else {\n             LogPrintf(\"Warning: Could not open blocks file %s\\n\", path.string());\n         }\n     }\n \n+    // scan for better chains in the block chain database, that are not yet connected in the active best chain\n+    CValidationState state;\n+    if (!ActivateBestChain(state, chainparams))\n+        LogPrintf(\"Failed to connect best block\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#discussion_r61227711",
      "id" : 61227711,
      "original_commit_id" : "691cbc972a724f716b486f4b43a33bc6e5a23d59",
      "original_position" : 45,
      "path" : "src/init.cpp",
      "position" : 45,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7917",
      "updated_at" : "2016-04-27T09:22:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61227711",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Tested on a mainnet node:\r\n```bash\r\njonasschnelli@bitcoinsrv:~/.bitcoin$ cat debug.log | grep \"Bitcoin version\\|Reindexing finished\\|height=409149\"\r\n2016-04-27 14:11:51 Bitcoin version v0.12.99.0-fb682d7 (2016-04-27 15:34:26 +0200)\r\n2016-04-27 14:34:17 Reindexing finished\r\n2016-04-27 18:52:50 UpdateTip: new best=000000000000000000c2963b062bebef4beff8ef38ae5d81e7ccfa8e05abcb1a height=409149 version=0x00000004 log2_work=84.559763 tx=125119626 date='2016-04-27 14:05:06' progress=0.999875 cache=4.0MiB(0tx)\r\n```\r\n= Times:\r\n```\r\nphase1    1'346s (00:22:26)\r\nphase2   15'513s (04:18:33)\r\n===========================\r\ntotal    16'859s (04:40:59)\r\n```\r\n\r\nFull debug log with `-debug=reindex` http://bitcoinsrv.jonasschnelli.ch/debug.reindex.log (>240MB!)\r\n",
      "created_at" : "2016-04-28T09:05:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-215359356",
      "id" : 215359356,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-04-28T09:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/215359356",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Added GUI progress reporting",
      "created_at" : "2016-04-28T14:19:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-215439586",
      "id" : 215439586,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-04-28T14:19:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/215439586",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "The two phases in the GUI:\r\n\r\n![reindexing](https://cloud.githubusercontent.com/assets/548488/14944444/4bfa1c44-0ff3-11e6-8edc-89e52afc9402.png)\r\n![processing](https://cloud.githubusercontent.com/assets/548488/14944447/5077fd0e-0ff3-11e6-87c9-b8c81051a2b4.png)\r\n\r\nIf the chainstate is ahead of the block index at startup, you get the same \"Processing blocks on disk\" now, while the main GUI is running (and not during loading).",
      "created_at" : "2016-05-01T21:22:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-216073555",
      "id" : 216073555,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-05-01T21:22:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/216073555",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa Very nice!",
      "created_at" : "2016-05-02T11:22:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7917#issuecomment-216208640",
      "id" : 216208640,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7917",
      "updated_at" : "2016-05-02T11:22:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/216208640",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
