[
   {
      "body" : "Hi Jeff,\r\n\r\nI am interested in trying to help with the bitcoin project, and this issue looks like an interesting one to start with since it is a privacy issue that would be good to fix.  If I were to work on a patch, should I post it here for review?\r\n\r\nThanks\r\nAsh",
      "created_at" : "2013-08-12T08:14:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2757#issuecomment-22478632",
      "id" : 22478632,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2757",
      "updated_at" : "2013-08-12T08:14:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/22478632",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/549484?v=3",
         "events_url" : "https://api.github.com/users/ashleyholman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ashleyholman/followers",
         "following_url" : "https://api.github.com/users/ashleyholman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ashleyholman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ashleyholman",
         "id" : 549484,
         "login" : "ashleyholman",
         "organizations_url" : "https://api.github.com/users/ashleyholman/orgs",
         "received_events_url" : "https://api.github.com/users/ashleyholman/received_events",
         "repos_url" : "https://api.github.com/users/ashleyholman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ashleyholman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ashleyholman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ashleyholman"
      }
   },
   {
      "body" : "Just a note to say that I've had a chat with @gmaxwell and he's given me some pointers on how I can get started with reproducing this as a test case.  This will take me a while to get familiar with the various testing tools, but I'll post back here once I've got a test case.",
      "created_at" : "2013-08-13T11:08:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2757#issuecomment-22557564",
      "id" : 22557564,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2757",
      "updated_at" : "2013-08-13T11:08:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/22557564",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/549484?v=3",
         "events_url" : "https://api.github.com/users/ashleyholman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ashleyholman/followers",
         "following_url" : "https://api.github.com/users/ashleyholman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ashleyholman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ashleyholman",
         "id" : 549484,
         "login" : "ashleyholman",
         "organizations_url" : "https://api.github.com/users/ashleyholman/orgs",
         "received_events_url" : "https://api.github.com/users/ashleyholman/received_events",
         "repos_url" : "https://api.github.com/users/ashleyholman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ashleyholman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ashleyholman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ashleyholman"
      }
   },
   {
      "body" : "I have done some investigation and testing of this issue and here are my findings:\r\n\r\n- The minimum work required to fingerprint a node is based on the GetLastCheckpoint() block, by calculating ComputeMinWork() on that block and factoring in the maximum difficulty drops possible in the time elapsed since that checkpoint.  Hence, the difficulty of generating a fingerprint drops by a factor of 4 every 2 weeks, until a new checkpoint is put in place.\r\n- A node that is doing an initial sync and is prior to the checkpoint at 168000, will accept a minimum difficulty block, so can be easily fingerprinted.  In the future, more checkpoints will drop to minimum difficulty (eg. 3 weeks from now, the 168000 checkpoint will also be minimum difficulty).\r\n- Once fingerprinted, a node will always return the block when requested, even if they are fully up to date on the latest chain.  Therefore an attacker will always be able to identify the fingerprinted user, even after initial sync.\r\n- In order to fingerprint a fully up to date node, by my calculations would require a difficulty 68248 block (at time of writing).  This will get 4x easier every 2 weeks.  At current network difficulty, that amount of work is worth ~0.033BTC.  So, it is easily viable for anyone to fingerprint an up-to-date node today, but it is perhaps not so viable to do large-scale tracking of users since this would cost ~$3.50 per user.\r\n\r\nTo test this I made a fingerprinting script which sends a difficulty-1 block.  As mentioned, the script will work on nodes prior to checkpoint 168000, but for more up-to-date nodes you would need to generate a block with more proof-of-work.  My code is here: https://gist.github.com/ashleyholman/6255449\r\n\r\nPerhaps one solution to protect against this, would be to never serve blocks that are at a height prior to the last checkpoint and not in the main chain.  Any economically viable attempt at fingerprinting will use a block that's at a height well below recent checkpoints, so this should serve as good protection.\r\n\r\nIf someone can respond here and suggest a way forward for fixing this, I would be happy to work on a patch.\r\n\r\nThanks",
      "created_at" : "2013-08-17T06:05:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2757#issuecomment-22806338",
      "id" : 22806338,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2757",
      "updated_at" : "2013-08-17T08:19:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/22806338",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/549484?v=3",
         "events_url" : "https://api.github.com/users/ashleyholman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ashleyholman/followers",
         "following_url" : "https://api.github.com/users/ashleyholman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ashleyholman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ashleyholman",
         "id" : 549484,
         "login" : "ashleyholman",
         "organizations_url" : "https://api.github.com/users/ashleyholman/orgs",
         "received_events_url" : "https://api.github.com/users/ashleyholman/received_events",
         "repos_url" : "https://api.github.com/users/ashleyholman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ashleyholman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ashleyholman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ashleyholman"
      }
   },
   {
      "body" : "Does anyone see a problem with just ignoring requests for blocks that are not in the main chain, unless they are very recent?",
      "created_at" : "2013-08-17T09:04:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2757#issuecomment-22808327",
      "id" : 22808327,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2757",
      "updated_at" : "2013-08-17T09:04:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/22808327",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa The only problem I see is that it could make life harder for a fancy pruned node trying to reorg off a side chain.  Limiting it to very recent (/during this runtime) / blocks that were in our best chain previously shouldn't break that too awfully at least.",
      "created_at" : "2013-08-17T10:36:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2757#issuecomment-22809423",
      "id" : 22809423,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2757",
      "updated_at" : "2013-08-17T10:36:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/22809423",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "I have issued a pull request with a proposed patch.  The fix is along the lines that were discussed here, except it is erring on the conservative side, in that I interpreted \"recent\" to mean \"since last checkpoint\".  The behaviour doesn't change for any blocks that come after the last checkpoint.  This still makes it far less feasible to do fingerprinting:\r\n\r\n- Minimum difficulty to fingerprint, based on last checkpoint, would be 4.3 million (~2.1 BTC per fingerprint)\r\n- The difficulty of fingerprinting would remain constant rather than dropping every 2 weeks\r\n- Each time the client is updated with new checkpoints, old fingerprints will stop working",
      "created_at" : "2013-08-19T13:32:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2757#issuecomment-22871655",
      "id" : 22871655,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2757",
      "updated_at" : "2013-08-19T13:32:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/22871655",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/549484?v=3",
         "events_url" : "https://api.github.com/users/ashleyholman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ashleyholman/followers",
         "following_url" : "https://api.github.com/users/ashleyholman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ashleyholman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ashleyholman",
         "id" : 549484,
         "login" : "ashleyholman",
         "organizations_url" : "https://api.github.com/users/ashleyholman/orgs",
         "received_events_url" : "https://api.github.com/users/ashleyholman/received_events",
         "repos_url" : "https://api.github.com/users/ashleyholman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ashleyholman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ashleyholman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ashleyholman"
      }
   },
   {
      "body" : "I think this can be closed now, can't it? (since it's now merged into master).",
      "created_at" : "2014-03-06T00:44:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2757#issuecomment-36813111",
      "id" : 36813111,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2757",
      "updated_at" : "2014-03-06T00:44:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/36813111",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "Yep\r\nThanks for solving this @ashleyholman ",
      "created_at" : "2014-03-06T12:25:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2757#issuecomment-36877705",
      "id" : 36877705,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2757",
      "updated_at" : "2014-03-06T12:25:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/36877705",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
