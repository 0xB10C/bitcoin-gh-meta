[
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/ab139c964e32b3ec5279eea0e749e0fe4a31a2dd for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.",
      "created_at" : "2013-06-04T00:50:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2733#issuecomment-18883041",
      "id" : 18883041,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2733",
      "updated_at" : "2013-06-04T00:50:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/18883041",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4515605"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4515605"
         }
      },
      "body" : "Looks like ctx and point are memory leaked in the return true case...",
      "commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "created_at" : "2013-06-04T04:34:25Z",
      "diff_hunk" : "@@ -164,13 +168,56 @@ class CECKey {\n         assert(nSize == nSize2);\n     }\n \n-    bool SetPrivKey(const CPrivKey &privkey) {\n+    bool SetPrivKey(const CPrivKey &privkey, bool fSkipCheck=false) {\n         const unsigned char* pbegin = &privkey[0];\n         if (d2i_ECPrivateKey(&pkey, &pbegin, privkey.size())) {\n             // d2i_ECPrivateKey returns true if parsing succeeds.\n             // This doesn't necessarily mean the key is valid.\n-            if (EC_KEY_check_key(pkey))\n+            \n+            if (fSkipCheck)\n                 return true;\n+            \n+            const EC_GROUP *group = EC_KEY_get0_group(pkey);\n+            const EC_POINT *pub_key = EC_KEY_get0_public_key(pkey);\n+            const BIGNUM *priv_key = EC_KEY_get0_private_key(pkey);\n+\n+            BN_CTX\t*ctx = NULL;\n+            BIGNUM\t*order  = NULL;\n+            EC_POINT *point = NULL;\n+\n+            if (!pkey || !group || !pub_key || !priv_key)\n+                goto err;\n+            \n+            order = BN_new();\n+            \n+            if ((ctx = BN_CTX_new()) == NULL)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4515605",
      "id" : 4515605,
      "original_commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "original_position" : 43,
      "path" : "src/key.cpp",
      "position" : 43,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733",
      "updated_at" : "2013-06-04T04:34:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4515605",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4517050"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4517050"
         }
      },
      "body" : "The hash should be calculated over both private and public key, as the reason for the test is guaranteeing that we have matching keypairs.",
      "commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "created_at" : "2013-06-04T07:41:05Z",
      "diff_hunk" : "@@ -278,14 +283,29 @@ void CWalletDB::ListAccountCreditDebit(const string& strAccount, list<CAccountin\n                 ssValue >> wkey;\n                 pkey = wkey.vchPrivKey;\n             }\n-            if (!key.SetPrivKey(pkey, vchPubKey.IsCompressed()))\n+            \n+            try\n             {\n-                strErr = \"Error reading wallet database: CPrivKey corrupt\";\n-                return false;\n+                ssValue >> hash;\n+            }\n+            catch(...){}\n+            \n+            bool fSkipCheck = false;\n+            \n+            if (hash != 0)\n+            {\n+                if (Hash(pkey.begin(), pkey.end()) != hash)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4517050",
      "id" : 4517050,
      "original_commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "original_position" : 46,
      "path" : "src/walletdb.cpp",
      "position" : 46,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733",
      "updated_at" : "2013-06-04T07:41:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4517050",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4521470"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4521470"
         }
      },
      "body" : "Do I need my glasses or is that a \"goto\" statement?",
      "commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "created_at" : "2013-06-04T12:53:01Z",
      "diff_hunk" : "@@ -164,13 +168,56 @@ class CECKey {\n         assert(nSize == nSize2);\n     }\n \n-    bool SetPrivKey(const CPrivKey &privkey) {\n+    bool SetPrivKey(const CPrivKey &privkey, bool fSkipCheck=false) {\n         const unsigned char* pbegin = &privkey[0];\n         if (d2i_ECPrivateKey(&pkey, &pbegin, privkey.size())) {\n             // d2i_ECPrivateKey returns true if parsing succeeds.\n             // This doesn't necessarily mean the key is valid.\n-            if (EC_KEY_check_key(pkey))\n+            \n+            if (fSkipCheck)\n                 return true;\n+            \n+            const EC_GROUP *group = EC_KEY_get0_group(pkey);\n+            const EC_POINT *pub_key = EC_KEY_get0_public_key(pkey);\n+            const BIGNUM *priv_key = EC_KEY_get0_private_key(pkey);\n+\n+            BN_CTX\t*ctx = NULL;\n+            BIGNUM\t*order  = NULL;\n+            EC_POINT *point = NULL;\n+\n+            if (!pkey || !group || !pub_key || !priv_key)\n+                goto err;\n+            \n+            order = BN_new();\n+            \n+            if ((ctx = BN_CTX_new()) == NULL)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4521470",
      "id" : 4521470,
      "original_commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "original_position" : 43,
      "path" : "src/key.cpp",
      "position" : 43,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733",
      "updated_at" : "2013-06-04T12:53:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4521470",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1503976?v=3",
         "events_url" : "https://api.github.com/users/vinniefalco/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vinniefalco/followers",
         "following_url" : "https://api.github.com/users/vinniefalco/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vinniefalco/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vinniefalco",
         "id" : 1503976,
         "login" : "vinniefalco",
         "organizations_url" : "https://api.github.com/users/vinniefalco/orgs",
         "received_events_url" : "https://api.github.com/users/vinniefalco/received_events",
         "repos_url" : "https://api.github.com/users/vinniefalco/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vinniefalco/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vinniefalco/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vinniefalco"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4522013"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4522013"
         }
      },
      "body" : "\"goto\" use is just fine.  It is efficient for both the compiler and human eyes.",
      "commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "created_at" : "2013-06-04T13:25:11Z",
      "diff_hunk" : "@@ -164,13 +168,56 @@ class CECKey {\n         assert(nSize == nSize2);\n     }\n \n-    bool SetPrivKey(const CPrivKey &privkey) {\n+    bool SetPrivKey(const CPrivKey &privkey, bool fSkipCheck=false) {\n         const unsigned char* pbegin = &privkey[0];\n         if (d2i_ECPrivateKey(&pkey, &pbegin, privkey.size())) {\n             // d2i_ECPrivateKey returns true if parsing succeeds.\n             // This doesn't necessarily mean the key is valid.\n-            if (EC_KEY_check_key(pkey))\n+            \n+            if (fSkipCheck)\n                 return true;\n+            \n+            const EC_GROUP *group = EC_KEY_get0_group(pkey);\n+            const EC_POINT *pub_key = EC_KEY_get0_public_key(pkey);\n+            const BIGNUM *priv_key = EC_KEY_get0_private_key(pkey);\n+\n+            BN_CTX\t*ctx = NULL;\n+            BIGNUM\t*order  = NULL;\n+            EC_POINT *point = NULL;\n+\n+            if (!pkey || !group || !pub_key || !priv_key)\n+                goto err;\n+            \n+            order = BN_new();\n+            \n+            if ((ctx = BN_CTX_new()) == NULL)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4522013",
      "id" : 4522013,
      "original_commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "original_position" : 43,
      "path" : "src/key.cpp",
      "position" : 43,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733",
      "updated_at" : "2013-06-04T13:25:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4522013",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4522049"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4522049"
         }
      },
      "body" : "No, goto is not okay.\r\nhttp://stackoverflow.com/questions/46586/goto-still-considered-harmful\r\n\r\nIt's true that there are exceedingly rare cases where a goto is useful but this is not one of them. Especially this case, error handling.",
      "commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "created_at" : "2013-06-04T13:27:56Z",
      "diff_hunk" : "@@ -164,13 +168,56 @@ class CECKey {\n         assert(nSize == nSize2);\n     }\n \n-    bool SetPrivKey(const CPrivKey &privkey) {\n+    bool SetPrivKey(const CPrivKey &privkey, bool fSkipCheck=false) {\n         const unsigned char* pbegin = &privkey[0];\n         if (d2i_ECPrivateKey(&pkey, &pbegin, privkey.size())) {\n             // d2i_ECPrivateKey returns true if parsing succeeds.\n             // This doesn't necessarily mean the key is valid.\n-            if (EC_KEY_check_key(pkey))\n+            \n+            if (fSkipCheck)\n                 return true;\n+            \n+            const EC_GROUP *group = EC_KEY_get0_group(pkey);\n+            const EC_POINT *pub_key = EC_KEY_get0_public_key(pkey);\n+            const BIGNUM *priv_key = EC_KEY_get0_private_key(pkey);\n+\n+            BN_CTX\t*ctx = NULL;\n+            BIGNUM\t*order  = NULL;\n+            EC_POINT *point = NULL;\n+\n+            if (!pkey || !group || !pub_key || !priv_key)\n+                goto err;\n+            \n+            order = BN_new();\n+            \n+            if ((ctx = BN_CTX_new()) == NULL)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4522049",
      "id" : 4522049,
      "original_commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "original_position" : 43,
      "path" : "src/key.cpp",
      "position" : 43,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733",
      "updated_at" : "2013-06-04T13:28:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4522049",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1503976?v=3",
         "events_url" : "https://api.github.com/users/vinniefalco/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vinniefalco/followers",
         "following_url" : "https://api.github.com/users/vinniefalco/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vinniefalco/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vinniefalco",
         "id" : 1503976,
         "login" : "vinniefalco",
         "organizations_url" : "https://api.github.com/users/vinniefalco/orgs",
         "received_events_url" : "https://api.github.com/users/vinniefalco/received_events",
         "repos_url" : "https://api.github.com/users/vinniefalco/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vinniefalco/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vinniefalco/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vinniefalco"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4522089"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4522089"
         }
      },
      "body" : "This is code that I assume was copied from the OpenSSL sources, which uses such error handling extensively. Without RAII-like features (as it was copied from C), I also know of no less contrived way of dealing with this.",
      "commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "created_at" : "2013-06-04T13:31:12Z",
      "diff_hunk" : "@@ -164,13 +168,56 @@ class CECKey {\n         assert(nSize == nSize2);\n     }\n \n-    bool SetPrivKey(const CPrivKey &privkey) {\n+    bool SetPrivKey(const CPrivKey &privkey, bool fSkipCheck=false) {\n         const unsigned char* pbegin = &privkey[0];\n         if (d2i_ECPrivateKey(&pkey, &pbegin, privkey.size())) {\n             // d2i_ECPrivateKey returns true if parsing succeeds.\n             // This doesn't necessarily mean the key is valid.\n-            if (EC_KEY_check_key(pkey))\n+            \n+            if (fSkipCheck)\n                 return true;\n+            \n+            const EC_GROUP *group = EC_KEY_get0_group(pkey);\n+            const EC_POINT *pub_key = EC_KEY_get0_public_key(pkey);\n+            const BIGNUM *priv_key = EC_KEY_get0_private_key(pkey);\n+\n+            BN_CTX\t*ctx = NULL;\n+            BIGNUM\t*order  = NULL;\n+            EC_POINT *point = NULL;\n+\n+            if (!pkey || !group || !pub_key || !priv_key)\n+                goto err;\n+            \n+            order = BN_new();\n+            \n+            if ((ctx = BN_CTX_new()) == NULL)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4522089",
      "id" : 4522089,
      "original_commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "original_position" : 43,
      "path" : "src/key.cpp",
      "position" : 43,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733",
      "updated_at" : "2013-06-04T13:31:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4522089",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4522250"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4522250"
         }
      },
      "body" : "Then roll a quick RAII wrapper (don't add more dependence on boost). Here's one for you http://codepad.org/gr8M2LE6\r\n\r\nLook at how easy it was to introduce a memory leak. I know that you guys know better than this!",
      "commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "created_at" : "2013-06-04T13:39:14Z",
      "diff_hunk" : "@@ -164,13 +168,56 @@ class CECKey {\n         assert(nSize == nSize2);\n     }\n \n-    bool SetPrivKey(const CPrivKey &privkey) {\n+    bool SetPrivKey(const CPrivKey &privkey, bool fSkipCheck=false) {\n         const unsigned char* pbegin = &privkey[0];\n         if (d2i_ECPrivateKey(&pkey, &pbegin, privkey.size())) {\n             // d2i_ECPrivateKey returns true if parsing succeeds.\n             // This doesn't necessarily mean the key is valid.\n-            if (EC_KEY_check_key(pkey))\n+            \n+            if (fSkipCheck)\n                 return true;\n+            \n+            const EC_GROUP *group = EC_KEY_get0_group(pkey);\n+            const EC_POINT *pub_key = EC_KEY_get0_public_key(pkey);\n+            const BIGNUM *priv_key = EC_KEY_get0_private_key(pkey);\n+\n+            BN_CTX\t*ctx = NULL;\n+            BIGNUM\t*order  = NULL;\n+            EC_POINT *point = NULL;\n+\n+            if (!pkey || !group || !pub_key || !priv_key)\n+                goto err;\n+            \n+            order = BN_new();\n+            \n+            if ((ctx = BN_CTX_new()) == NULL)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4522250",
      "id" : 4522250,
      "original_commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "original_position" : 43,
      "path" : "src/key.cpp",
      "position" : 43,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733",
      "updated_at" : "2013-06-04T13:39:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4522250",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1503976?v=3",
         "events_url" : "https://api.github.com/users/vinniefalco/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vinniefalco/followers",
         "following_url" : "https://api.github.com/users/vinniefalco/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vinniefalco/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vinniefalco",
         "id" : 1503976,
         "login" : "vinniefalco",
         "organizations_url" : "https://api.github.com/users/vinniefalco/orgs",
         "received_events_url" : "https://api.github.com/users/vinniefalco/received_events",
         "repos_url" : "https://api.github.com/users/vinniefalco/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vinniefalco/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vinniefalco/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vinniefalco"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4522441"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4522441"
         }
      },
      "body" : "~90 LOC just to avoid a goto?\r\n\r\nI think that speaks for itself :)",
      "commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "created_at" : "2013-06-04T13:47:37Z",
      "diff_hunk" : "@@ -164,13 +168,56 @@ class CECKey {\n         assert(nSize == nSize2);\n     }\n \n-    bool SetPrivKey(const CPrivKey &privkey) {\n+    bool SetPrivKey(const CPrivKey &privkey, bool fSkipCheck=false) {\n         const unsigned char* pbegin = &privkey[0];\n         if (d2i_ECPrivateKey(&pkey, &pbegin, privkey.size())) {\n             // d2i_ECPrivateKey returns true if parsing succeeds.\n             // This doesn't necessarily mean the key is valid.\n-            if (EC_KEY_check_key(pkey))\n+            \n+            if (fSkipCheck)\n                 return true;\n+            \n+            const EC_GROUP *group = EC_KEY_get0_group(pkey);\n+            const EC_POINT *pub_key = EC_KEY_get0_public_key(pkey);\n+            const BIGNUM *priv_key = EC_KEY_get0_private_key(pkey);\n+\n+            BN_CTX\t*ctx = NULL;\n+            BIGNUM\t*order  = NULL;\n+            EC_POINT *point = NULL;\n+\n+            if (!pkey || !group || !pub_key || !priv_key)\n+                goto err;\n+            \n+            order = BN_new();\n+            \n+            if ((ctx = BN_CTX_new()) == NULL)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4522441",
      "id" : 4522441,
      "original_commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "original_position" : 43,
      "path" : "src/key.cpp",
      "position" : 43,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733",
      "updated_at" : "2013-06-04T13:47:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4522441",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4522566"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4522566"
         }
      },
      "body" : "90 LOC to have the right tool. Note, you could use boost::auto_ptr or whatever RAII wrapper they have around dynamically created objects. I prefer not to create additional dependencies on boost. That Bitcoin source code is sloppy and breaks numerous \"best practices\" endorsed by luminaries of C++ should not even be up for debate - I know that you guys know better! The attitude needs to change or else it will remain a difficult to maintain mess, becoming progressively harder to implement changes without breaking things and tons of extra work.",
      "commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "created_at" : "2013-06-04T13:52:48Z",
      "diff_hunk" : "@@ -164,13 +168,56 @@ class CECKey {\n         assert(nSize == nSize2);\n     }\n \n-    bool SetPrivKey(const CPrivKey &privkey) {\n+    bool SetPrivKey(const CPrivKey &privkey, bool fSkipCheck=false) {\n         const unsigned char* pbegin = &privkey[0];\n         if (d2i_ECPrivateKey(&pkey, &pbegin, privkey.size())) {\n             // d2i_ECPrivateKey returns true if parsing succeeds.\n             // This doesn't necessarily mean the key is valid.\n-            if (EC_KEY_check_key(pkey))\n+            \n+            if (fSkipCheck)\n                 return true;\n+            \n+            const EC_GROUP *group = EC_KEY_get0_group(pkey);\n+            const EC_POINT *pub_key = EC_KEY_get0_public_key(pkey);\n+            const BIGNUM *priv_key = EC_KEY_get0_private_key(pkey);\n+\n+            BN_CTX\t*ctx = NULL;\n+            BIGNUM\t*order  = NULL;\n+            EC_POINT *point = NULL;\n+\n+            if (!pkey || !group || !pub_key || !priv_key)\n+                goto err;\n+            \n+            order = BN_new();\n+            \n+            if ((ctx = BN_CTX_new()) == NULL)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4522566",
      "id" : 4522566,
      "original_commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "original_position" : 43,
      "path" : "src/key.cpp",
      "position" : 43,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733",
      "updated_at" : "2013-06-04T13:52:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4522566",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1503976?v=3",
         "events_url" : "https://api.github.com/users/vinniefalco/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vinniefalco/followers",
         "following_url" : "https://api.github.com/users/vinniefalco/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vinniefalco/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vinniefalco",
         "id" : 1503976,
         "login" : "vinniefalco",
         "organizations_url" : "https://api.github.com/users/vinniefalco/orgs",
         "received_events_url" : "https://api.github.com/users/vinniefalco/received_events",
         "repos_url" : "https://api.github.com/users/vinniefalco/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vinniefalco/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vinniefalco/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vinniefalco"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4523261"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4523261"
         }
      },
      "body" : "NAK that logic",
      "commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "created_at" : "2013-06-04T14:19:41Z",
      "diff_hunk" : "@@ -164,13 +168,56 @@ class CECKey {\n         assert(nSize == nSize2);\n     }\n \n-    bool SetPrivKey(const CPrivKey &privkey) {\n+    bool SetPrivKey(const CPrivKey &privkey, bool fSkipCheck=false) {\n         const unsigned char* pbegin = &privkey[0];\n         if (d2i_ECPrivateKey(&pkey, &pbegin, privkey.size())) {\n             // d2i_ECPrivateKey returns true if parsing succeeds.\n             // This doesn't necessarily mean the key is valid.\n-            if (EC_KEY_check_key(pkey))\n+            \n+            if (fSkipCheck)\n                 return true;\n+            \n+            const EC_GROUP *group = EC_KEY_get0_group(pkey);\n+            const EC_POINT *pub_key = EC_KEY_get0_public_key(pkey);\n+            const BIGNUM *priv_key = EC_KEY_get0_private_key(pkey);\n+\n+            BN_CTX\t*ctx = NULL;\n+            BIGNUM\t*order  = NULL;\n+            EC_POINT *point = NULL;\n+\n+            if (!pkey || !group || !pub_key || !priv_key)\n+                goto err;\n+            \n+            order = BN_new();\n+            \n+            if ((ctx = BN_CTX_new()) == NULL)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4523261",
      "id" : 4523261,
      "original_commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "original_position" : 43,
      "path" : "src/key.cpp",
      "position" : 43,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733",
      "updated_at" : "2013-06-04T14:19:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4523261",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4523428"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4523428"
         }
      },
      "body" : "Goto is fine in C code (in many cases the only sane way to do error\nhandling with proper cleanup), but in C++ we can indeed do better with RAII.\nUsing boost would be preferable to rolling our own RAII wrappers.",
      "commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "created_at" : "2013-06-04T14:24:31Z",
      "diff_hunk" : "@@ -164,13 +168,56 @@ class CECKey {\n         assert(nSize == nSize2);\n     }\n \n-    bool SetPrivKey(const CPrivKey &privkey) {\n+    bool SetPrivKey(const CPrivKey &privkey, bool fSkipCheck=false) {\n         const unsigned char* pbegin = &privkey[0];\n         if (d2i_ECPrivateKey(&pkey, &pbegin, privkey.size())) {\n             // d2i_ECPrivateKey returns true if parsing succeeds.\n             // This doesn't necessarily mean the key is valid.\n-            if (EC_KEY_check_key(pkey))\n+            \n+            if (fSkipCheck)\n                 return true;\n+            \n+            const EC_GROUP *group = EC_KEY_get0_group(pkey);\n+            const EC_POINT *pub_key = EC_KEY_get0_public_key(pkey);\n+            const BIGNUM *priv_key = EC_KEY_get0_private_key(pkey);\n+\n+            BN_CTX\t*ctx = NULL;\n+            BIGNUM\t*order  = NULL;\n+            EC_POINT *point = NULL;\n+\n+            if (!pkey || !group || !pub_key || !priv_key)\n+                goto err;\n+            \n+            order = BN_new();\n+            \n+            if ((ctx = BN_CTX_new()) == NULL)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4523428",
      "id" : 4523428,
      "original_commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "original_position" : 43,
      "path" : "src/key.cpp",
      "position" : 43,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733",
      "updated_at" : "2013-06-04T14:24:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4523428",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4681882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4681882"
         }
      },
      "body" : "I'm not a c++ guy, but I believe there are RuntimeExceptions, right? And maybe they allows to pass description of error. It would be much better than to use goto.",
      "commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "created_at" : "2013-06-13T15:47:09Z",
      "diff_hunk" : "@@ -164,13 +168,56 @@ class CECKey {\n         assert(nSize == nSize2);\n     }\n \n-    bool SetPrivKey(const CPrivKey &privkey) {\n+    bool SetPrivKey(const CPrivKey &privkey, bool fSkipCheck=false) {\n         const unsigned char* pbegin = &privkey[0];\n         if (d2i_ECPrivateKey(&pkey, &pbegin, privkey.size())) {\n             // d2i_ECPrivateKey returns true if parsing succeeds.\n             // This doesn't necessarily mean the key is valid.\n-            if (EC_KEY_check_key(pkey))\n+            \n+            if (fSkipCheck)\n                 return true;\n+            \n+            const EC_GROUP *group = EC_KEY_get0_group(pkey);\n+            const EC_POINT *pub_key = EC_KEY_get0_public_key(pkey);\n+            const BIGNUM *priv_key = EC_KEY_get0_private_key(pkey);\n+\n+            BN_CTX\t*ctx = NULL;\n+            BIGNUM\t*order  = NULL;\n+            EC_POINT *point = NULL;\n+\n+            if (!pkey || !group || !pub_key || !priv_key)\n+                goto err;\n+            \n+            order = BN_new();\n+            \n+            if ((ctx = BN_CTX_new()) == NULL)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r4681882",
      "id" : 4681882,
      "original_commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "original_position" : 43,
      "path" : "src/key.cpp",
      "position" : 43,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733",
      "updated_at" : "2013-06-13T15:47:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4681882",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/905759?v=3",
         "events_url" : "https://api.github.com/users/ValleZ/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ValleZ/followers",
         "following_url" : "https://api.github.com/users/ValleZ/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ValleZ/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ValleZ",
         "id" : 905759,
         "login" : "ValleZ",
         "organizations_url" : "https://api.github.com/users/ValleZ/orgs",
         "received_events_url" : "https://api.github.com/users/ValleZ/received_events",
         "repos_url" : "https://api.github.com/users/ValleZ/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ValleZ/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ValleZ/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ValleZ"
      }
   },
   {
      "body" : "Would you mind if I rewrote this a bit, by simultaneously changing how keys are stored in the wallet file (using a serialized CKey, instead of CPrivKey, and combining it with the new CKeyMeta)?\r\n\r\n",
      "created_at" : "2013-06-15T15:55:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2733#issuecomment-19498612",
      "id" : 19498612,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2733",
      "updated_at" : "2013-06-15T15:55:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/19498612",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "That sounds like a good idea.",
      "created_at" : "2013-06-15T20:17:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2733#issuecomment-19502773",
      "id" : 19502773,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2733",
      "updated_at" : "2013-06-15T20:17:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/19502773",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=3",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r5003860"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/5003860"
         }
      },
      "body" : "Rather than creating 90 Lines of RAII wrappers, You could probably just rewrite it like this:\r\n```c++\r\nbool SetPrivKeyCleanup(BN_CTX *ctx,EC_POINT *point)\r\n{\r\n if (ctx   != NULL)\r\n  BN_CTX_free(ctx);\r\n if (point != NULL)\r\n  EC_POINT_free(point);\r\n return false;\r\n}\r\n```\r\nThen just ammend:\r\n```c++\r\n            if (!pkey || !group || !pub_key || !priv_key)\r\n                return SetPrivKeyCleanup(ctx,point);\r\n\r\n            order = BN_new();\r\n\r\n            if ((ctx = BN_CTX_new()) == NULL)\r\n                return SetPrivKeyCleanup(ctx,point);\r\n\r\n            if (!EC_GROUP_get_order(group, order, ctx))\r\n                return SetPrivKeyCleanup(ctx,point);\r\n\r\n            // check if generator * priv_key == pub_key \r\n            if (BN_cmp(priv_key, order) >= 0)\r\n                return SetPrivKeyCleanup(ctx,point);\r\n\r\n            if ((point = EC_POINT_new(group)) == NULL)\r\n                return SetPrivKeyCleanup(ctx,point);\r\n\r\n            if (!EC_POINT_mul(group, point, priv_key, NULL, NULL, ctx))\r\n                return SetPrivKeyCleanup(ctx,point);\r\n\r\n            if (EC_POINT_cmp(group, point, pub_key, ctx) != 0)\r\n                return SetPrivKeyCleanup(ctx,point);\r\n\r\n            return true;\r\n```\r\n\r\nSince I didn't test this there is probably a good reason why it wouldn't work, but you get the basic idea.",
      "commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "created_at" : "2013-07-03T08:14:04Z",
      "diff_hunk" : "@@ -164,13 +168,56 @@ class CECKey {\n         assert(nSize == nSize2);\n     }\n \n-    bool SetPrivKey(const CPrivKey &privkey) {\n+    bool SetPrivKey(const CPrivKey &privkey, bool fSkipCheck=false) {\n         const unsigned char* pbegin = &privkey[0];\n         if (d2i_ECPrivateKey(&pkey, &pbegin, privkey.size())) {\n             // d2i_ECPrivateKey returns true if parsing succeeds.\n             // This doesn't necessarily mean the key is valid.\n-            if (EC_KEY_check_key(pkey))\n+            \n+            if (fSkipCheck)\n                 return true;\n+            \n+            const EC_GROUP *group = EC_KEY_get0_group(pkey);\n+            const EC_POINT *pub_key = EC_KEY_get0_public_key(pkey);\n+            const BIGNUM *priv_key = EC_KEY_get0_private_key(pkey);\n+\n+            BN_CTX\t*ctx = NULL;\n+            BIGNUM\t*order  = NULL;\n+            EC_POINT *point = NULL;\n+\n+            if (!pkey || !group || !pub_key || !priv_key)\n+                goto err;\n+            \n+            order = BN_new();\n+            \n+            if ((ctx = BN_CTX_new()) == NULL)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r5003860",
      "id" : 5003860,
      "original_commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "original_position" : 43,
      "path" : "src/key.cpp",
      "position" : 43,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733",
      "updated_at" : "2013-07-03T08:15:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/5003860",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/444143?v=3",
         "events_url" : "https://api.github.com/users/GilesBathgate/events{/privacy}",
         "followers_url" : "https://api.github.com/users/GilesBathgate/followers",
         "following_url" : "https://api.github.com/users/GilesBathgate/following{/other_user}",
         "gists_url" : "https://api.github.com/users/GilesBathgate/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/GilesBathgate",
         "id" : 444143,
         "login" : "GilesBathgate",
         "organizations_url" : "https://api.github.com/users/GilesBathgate/orgs",
         "received_events_url" : "https://api.github.com/users/GilesBathgate/received_events",
         "repos_url" : "https://api.github.com/users/GilesBathgate/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/GilesBathgate/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/GilesBathgate/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/GilesBathgate"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r5004340"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/5004340"
         }
      },
      "body" : "I still prefer RAII. Make the compiler do the work of making it leak proof.\nSafer *and* more convenient.",
      "commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "created_at" : "2013-07-03T08:51:24Z",
      "diff_hunk" : "@@ -164,13 +168,56 @@ class CECKey {\n         assert(nSize == nSize2);\n     }\n \n-    bool SetPrivKey(const CPrivKey &privkey) {\n+    bool SetPrivKey(const CPrivKey &privkey, bool fSkipCheck=false) {\n         const unsigned char* pbegin = &privkey[0];\n         if (d2i_ECPrivateKey(&pkey, &pbegin, privkey.size())) {\n             // d2i_ECPrivateKey returns true if parsing succeeds.\n             // This doesn't necessarily mean the key is valid.\n-            if (EC_KEY_check_key(pkey))\n+            \n+            if (fSkipCheck)\n                 return true;\n+            \n+            const EC_GROUP *group = EC_KEY_get0_group(pkey);\n+            const EC_POINT *pub_key = EC_KEY_get0_public_key(pkey);\n+            const BIGNUM *priv_key = EC_KEY_get0_private_key(pkey);\n+\n+            BN_CTX\t*ctx = NULL;\n+            BIGNUM\t*order  = NULL;\n+            EC_POINT *point = NULL;\n+\n+            if (!pkey || !group || !pub_key || !priv_key)\n+                goto err;\n+            \n+            order = BN_new();\n+            \n+            if ((ctx = BN_CTX_new()) == NULL)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r5004340",
      "id" : 5004340,
      "original_commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "original_position" : 43,
      "path" : "src/key.cpp",
      "position" : 43,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733",
      "updated_at" : "2013-07-03T08:51:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/5004340",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r5005718"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/5005718"
         }
      },
      "body" : "Indeed making an EC_POINT class that implements EC_POINT_new in the constructor and EC_POINT_free in the destructor, as well as operator overloads for EC_POINT_mul and EC_POINT_cmp, is much more in the spirit of C++. I was really just addressing the comment:\r\n>Do I need my glasses or is that a \"goto\" statement?\r\n\r\nIts not really an issue worth making a fuss about really. Perhaps I should have kept quiet.\r\n",
      "commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "created_at" : "2013-07-03T10:17:16Z",
      "diff_hunk" : "@@ -164,13 +168,56 @@ class CECKey {\n         assert(nSize == nSize2);\n     }\n \n-    bool SetPrivKey(const CPrivKey &privkey) {\n+    bool SetPrivKey(const CPrivKey &privkey, bool fSkipCheck=false) {\n         const unsigned char* pbegin = &privkey[0];\n         if (d2i_ECPrivateKey(&pkey, &pbegin, privkey.size())) {\n             // d2i_ECPrivateKey returns true if parsing succeeds.\n             // This doesn't necessarily mean the key is valid.\n-            if (EC_KEY_check_key(pkey))\n+            \n+            if (fSkipCheck)\n                 return true;\n+            \n+            const EC_GROUP *group = EC_KEY_get0_group(pkey);\n+            const EC_POINT *pub_key = EC_KEY_get0_public_key(pkey);\n+            const BIGNUM *priv_key = EC_KEY_get0_private_key(pkey);\n+\n+            BN_CTX\t*ctx = NULL;\n+            BIGNUM\t*order  = NULL;\n+            EC_POINT *point = NULL;\n+\n+            if (!pkey || !group || !pub_key || !priv_key)\n+                goto err;\n+            \n+            order = BN_new();\n+            \n+            if ((ctx = BN_CTX_new()) == NULL)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2733#discussion_r5005718",
      "id" : 5005718,
      "original_commit_id" : "ab139c964e32b3ec5279eea0e749e0fe4a31a2dd",
      "original_position" : 43,
      "path" : "src/key.cpp",
      "position" : 43,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2733",
      "updated_at" : "2013-07-03T10:17:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/5005718",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/444143?v=3",
         "events_url" : "https://api.github.com/users/GilesBathgate/events{/privacy}",
         "followers_url" : "https://api.github.com/users/GilesBathgate/followers",
         "following_url" : "https://api.github.com/users/GilesBathgate/following{/other_user}",
         "gists_url" : "https://api.github.com/users/GilesBathgate/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/GilesBathgate",
         "id" : 444143,
         "login" : "GilesBathgate",
         "organizations_url" : "https://api.github.com/users/GilesBathgate/orgs",
         "received_events_url" : "https://api.github.com/users/GilesBathgate/received_events",
         "repos_url" : "https://api.github.com/users/GilesBathgate/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/GilesBathgate/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/GilesBathgate/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/GilesBathgate"
      }
   },
   {
      "body" : "I'm closing this pull request.\r\n\r\nsipa's suggestion is a better long term solution.",
      "created_at" : "2013-07-04T21:19:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2733#issuecomment-20493830",
      "id" : 20493830,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2733",
      "updated_at" : "2013-07-04T21:19:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/20493830",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=3",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   }
]
