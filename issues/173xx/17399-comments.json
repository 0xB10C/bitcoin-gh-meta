[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16658](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16658.html) (validation: Rename CheckInputs to CheckInputScripts by jnewbery)\n* [#15606](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15606.html) ([experimental] UTXO snapshots by jamesob)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-11-07T03:36:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#issuecomment-550647765",
      "id" : 550647765,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17399",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MDY0Nzc2NQ==",
      "updated_at" : "2019-11-10T10:49:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/550647765",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r343577327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343577327"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, in L85 do `} m_mode{MODE_VALID};` and drop constructor?",
      "commit_id" : "0468628e8191c574d2568f5e9e7fa15dd43d80f2",
      "created_at" : "2019-11-07T10:28:17Z",
      "diff_hunk" : "@@ -71,31 +71,32 @@ enum class BlockValidationResult {\n \n \n \n-/** Base class for capturing information about block/transaction validation. This is subclassed\n+/** Template for capturing information about block/transaction validation. This is instantiated\n  *  by TxValidationState and BlockValidationState for validation information on transactions\n  *  and blocks respectively. */\n+template <typename Result>\n class ValidationState {\n private:\n     enum mode_state {\n         MODE_VALID,   //!< everything ok\n         MODE_INVALID, //!< network rule violation (DoS value may be set)\n         MODE_ERROR,   //!< run-time error\n     } m_mode;\n+    Result m_result;\n     std::string m_reject_reason;\n     std::string m_debug_message;\n-protected:\n-    void Invalid(const std::string &reject_reason=\"\",\n+public:\n+    ValidationState() : m_mode(MODE_VALID) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r343577327",
      "id" : 343577327,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzU3NzMyNw==",
      "original_commit_id" : "aa67e6d736fab1cf125687f3393a3eb259fb8608",
      "original_position" : 22,
      "path" : "src/consensus/validation.h",
      "position" : 22,
      "pull_request_review_id" : 313241691,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399",
      "updated_at" : "2019-11-08T22:04:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343577327",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r343579534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343579534"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You can still forward declare `TxValidationState` and `BlockValidationState` where needed and avoid the issues pointed by @ryanofsky?",
      "commit_id" : "0468628e8191c574d2568f5e9e7fa15dd43d80f2",
      "created_at" : "2019-11-07T10:33:17Z",
      "diff_hunk" : "@@ -5,6 +5,8 @@\n #ifndef BITCOIN_CONSENSUS_TX_CHECK_H\n #define BITCOIN_CONSENSUS_TX_CHECK_H\n \n+#include <consensus/validation.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r343579534",
      "id" : 343579534,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzU3OTUzNA==",
      "original_commit_id" : "aa67e6d736fab1cf125687f3393a3eb259fb8608",
      "original_position" : 4,
      "path" : "src/consensus/tx_check.h",
      "position" : null,
      "pull_request_review_id" : 313241691,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399",
      "updated_at" : "2019-11-08T22:04:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343579534",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r343805188"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343805188"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This causes a compilation error:\r\n\r\n```console\r\nIn file included from consensus/tx_check.cpp:8:\r\n./consensus/validation.h:115:7: error: typedef redefinition with different types ('ValidationState<TxValidationResult>' vs 'TxValidationState')\r\nusing TxValidationState = ValidationState<TxValidationResult>;\r\n      ^\r\n./consensus/tx_check.h:16:7: note: previous definition is here\r\nclass TxValidationState;\r\n```\r\n\r\nI'd have to forward declare the full template type and enum then use that in the function declaration.\r\n\r\n```c++\r\nenum class TxValidationResult;\r\ntemplate <typename Result>\r\nclass ValidationState;\r\n\r\nbool CheckTransaction(const CTransaction& tx, ValidationState<TxValidationResult>& state);\r\n```\r\n\r\nSeems a bit verbose and would mismatch the function definition. FWIW, here are some [pros and cons](https://google.github.io/styleguide/cppguide.html#Forward_Declarations) of forward declaring that I'm aware of.",
      "commit_id" : "0468628e8191c574d2568f5e9e7fa15dd43d80f2",
      "created_at" : "2019-11-07T18:28:55Z",
      "diff_hunk" : "@@ -5,6 +5,8 @@\n #ifndef BITCOIN_CONSENSUS_TX_CHECK_H\n #define BITCOIN_CONSENSUS_TX_CHECK_H\n \n+#include <consensus/validation.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r343805188",
      "id" : 343805188,
      "in_reply_to_id" : 343579534,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzgwNTE4OA==",
      "original_commit_id" : "aa67e6d736fab1cf125687f3393a3eb259fb8608",
      "original_position" : 4,
      "path" : "src/consensus/tx_check.h",
      "position" : null,
      "pull_request_review_id" : 313545850,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399",
      "updated_at" : "2019-11-08T22:04:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343805188",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r343805959"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343805959"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The diff here is a bit misleading as I'm actually moving `Invalid` to the `public` section and not modifying the constructor. Is the convention to put this in a separate a commit? Or would it be considered outside the scope of the PR?",
      "commit_id" : "0468628e8191c574d2568f5e9e7fa15dd43d80f2",
      "created_at" : "2019-11-07T18:30:29Z",
      "diff_hunk" : "@@ -71,31 +71,32 @@ enum class BlockValidationResult {\n \n \n \n-/** Base class for capturing information about block/transaction validation. This is subclassed\n+/** Template for capturing information about block/transaction validation. This is instantiated\n  *  by TxValidationState and BlockValidationState for validation information on transactions\n  *  and blocks respectively. */\n+template <typename Result>\n class ValidationState {\n private:\n     enum mode_state {\n         MODE_VALID,   //!< everything ok\n         MODE_INVALID, //!< network rule violation (DoS value may be set)\n         MODE_ERROR,   //!< run-time error\n     } m_mode;\n+    Result m_result;\n     std::string m_reject_reason;\n     std::string m_debug_message;\n-protected:\n-    void Invalid(const std::string &reject_reason=\"\",\n+public:\n+    ValidationState() : m_mode(MODE_VALID) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r343805959",
      "id" : 343805959,
      "in_reply_to_id" : 343577327,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzgwNTk1OQ==",
      "original_commit_id" : "aa67e6d736fab1cf125687f3393a3eb259fb8608",
      "original_position" : 22,
      "path" : "src/consensus/validation.h",
      "position" : 22,
      "pull_request_review_id" : 313545850,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399",
      "updated_at" : "2019-11-08T22:04:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343805959",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.\r\n\r\n> Added #includes and template function might slow down compilation a bit, though.\r\n\r\nYes, although this is a quite straightforward use of templates, no boost nested template horrors, so I hope it's not too bad.",
      "created_at" : "2019-11-08T08:37:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#issuecomment-551436906",
      "id" : 551436906,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17399",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MTQzNjkwNg==",
      "updated_at" : "2019-11-08T08:39:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551436906",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r344134666"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344134666"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could move this into ValidationState directly, and make it\r\n```\r\nstd::string FormatStateMessage() const { return m_reject_reason + (m_debug_message.empty() ? \"\" : \", \" + m_debug_message); }\r\n```",
      "commit_id" : "0468628e8191c574d2568f5e9e7fa15dd43d80f2",
      "created_at" : "2019-11-08T11:35:46Z",
      "diff_hunk" : "@@ -6,12 +6,18 @@\n #ifndef BITCOIN_UTIL_VALIDATION_H\n #define BITCOIN_UTIL_VALIDATION_H\n \n-#include <string>\n+#include <consensus/validation.h>\n \n-class ValidationState;\n+#include <string>\n \n /** Convert ValidationState to a human-readable message for logging */\n-std::string FormatStateMessage(const ValidationState &state);\n+template <typename Result>\n+std::string FormatStateMessage(const ValidationState<Result>& state)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r344134666",
      "id" : 344134666,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NDEzNDY2Ng==",
      "original_commit_id" : "aa67e6d736fab1cf125687f3393a3eb259fb8608",
      "original_position" : 13,
      "path" : "src/util/validation.h",
      "position" : null,
      "pull_request_review_id" : 314148167,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399",
      "updated_at" : "2019-11-08T22:04:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344134666",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r344135555"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344135555"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think you can do `class TxValidationState : ValidationState<TxValidationResult> { };` and still be able to use forward declarations `class TxValidationState;` fwiw.",
      "commit_id" : "0468628e8191c574d2568f5e9e7fa15dd43d80f2",
      "created_at" : "2019-11-08T11:38:26Z",
      "diff_hunk" : "@@ -106,40 +107,13 @@ class ValidationState {\n     bool IsValid() const { return m_mode == MODE_VALID; }\n     bool IsInvalid() const { return m_mode == MODE_INVALID; }\n     bool IsError() const { return m_mode == MODE_ERROR; }\n+    Result GetResult() const { return m_result; }\n     std::string GetRejectReason() const { return m_reject_reason; }\n     std::string GetDebugMessage() const { return m_debug_message; }\n };\n \n-inline ValidationState::~ValidationState() {};\n-\n-class TxValidationState : public ValidationState {\n-private:\n-    TxValidationResult m_result;\n-public:\n-    bool Invalid(TxValidationResult result,\n-                 const std::string &reject_reason=\"\",\n-                 const std::string &debug_message=\"\")\n-    {\n-        m_result = result;\n-        ValidationState::Invalid(reject_reason, debug_message);\n-        return false;\n-    }\n-    TxValidationResult GetResult() const { return m_result; }\n-};\n-\n-class BlockValidationState : public ValidationState {\n-private:\n-    BlockValidationResult m_result;\n-public:\n-    bool Invalid(BlockValidationResult result,\n-                 const std::string &reject_reason=\"\",\n-                 const std::string &debug_message=\"\") {\n-        m_result = result;\n-        ValidationState::Invalid(reject_reason, debug_message);\n-        return false;\n-    }\n-    BlockValidationResult GetResult() const { return m_result; }\n-};\n+using TxValidationState = ValidationState<TxValidationResult>;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r344135555",
      "id" : 344135555,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NDEzNTU1NQ==",
      "original_commit_id" : "aa67e6d736fab1cf125687f3393a3eb259fb8608",
      "original_position" : 80,
      "path" : "src/consensus/validation.h",
      "position" : null,
      "pull_request_review_id" : 314148167,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399",
      "updated_at" : "2019-11-08T22:04:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344135555",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Will review code once @ajtowns's comments are addressed.",
      "created_at" : "2019-11-08T20:21:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#issuecomment-551976554",
      "id" : 551976554,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17399",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MTk3NjU1NA==",
      "updated_at" : "2019-11-08T20:21:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551976554",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-11-08T21:24:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#issuecomment-551995182",
      "id" : 551995182,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17399",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MTk5NTE4Mg==",
      "updated_at" : "2019-11-08T21:24:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551995182",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r344373034"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344373034"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Right, but the constructor could still be dropped.",
      "commit_id" : "0468628e8191c574d2568f5e9e7fa15dd43d80f2",
      "created_at" : "2019-11-08T21:26:30Z",
      "diff_hunk" : "@@ -71,31 +71,32 @@ enum class BlockValidationResult {\n \n \n \n-/** Base class for capturing information about block/transaction validation. This is subclassed\n+/** Template for capturing information about block/transaction validation. This is instantiated\n  *  by TxValidationState and BlockValidationState for validation information on transactions\n  *  and blocks respectively. */\n+template <typename Result>\n class ValidationState {\n private:\n     enum mode_state {\n         MODE_VALID,   //!< everything ok\n         MODE_INVALID, //!< network rule violation (DoS value may be set)\n         MODE_ERROR,   //!< run-time error\n     } m_mode;\n+    Result m_result;\n     std::string m_reject_reason;\n     std::string m_debug_message;\n-protected:\n-    void Invalid(const std::string &reject_reason=\"\",\n+public:\n+    ValidationState() : m_mode(MODE_VALID) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r344373034",
      "id" : 344373034,
      "in_reply_to_id" : 343577327,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NDM3MzAzNA==",
      "original_commit_id" : "aa67e6d736fab1cf125687f3393a3eb259fb8608",
      "original_position" : 22,
      "path" : "src/consensus/validation.h",
      "position" : 22,
      "pull_request_review_id" : 314468752,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399",
      "updated_at" : "2019-11-08T22:04:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344373034",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r344388046"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344388046"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good idea! Done in 0468628.",
      "commit_id" : "0468628e8191c574d2568f5e9e7fa15dd43d80f2",
      "created_at" : "2019-11-08T22:15:34Z",
      "diff_hunk" : "@@ -106,40 +107,13 @@ class ValidationState {\n     bool IsValid() const { return m_mode == MODE_VALID; }\n     bool IsInvalid() const { return m_mode == MODE_INVALID; }\n     bool IsError() const { return m_mode == MODE_ERROR; }\n+    Result GetResult() const { return m_result; }\n     std::string GetRejectReason() const { return m_reject_reason; }\n     std::string GetDebugMessage() const { return m_debug_message; }\n };\n \n-inline ValidationState::~ValidationState() {};\n-\n-class TxValidationState : public ValidationState {\n-private:\n-    TxValidationResult m_result;\n-public:\n-    bool Invalid(TxValidationResult result,\n-                 const std::string &reject_reason=\"\",\n-                 const std::string &debug_message=\"\")\n-    {\n-        m_result = result;\n-        ValidationState::Invalid(reject_reason, debug_message);\n-        return false;\n-    }\n-    TxValidationResult GetResult() const { return m_result; }\n-};\n-\n-class BlockValidationState : public ValidationState {\n-private:\n-    BlockValidationResult m_result;\n-public:\n-    bool Invalid(BlockValidationResult result,\n-                 const std::string &reject_reason=\"\",\n-                 const std::string &debug_message=\"\") {\n-        m_result = result;\n-        ValidationState::Invalid(reject_reason, debug_message);\n-        return false;\n-    }\n-    BlockValidationResult GetResult() const { return m_result; }\n-};\n+using TxValidationState = ValidationState<TxValidationResult>;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r344388046",
      "id" : 344388046,
      "in_reply_to_id" : 344135555,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NDM4ODA0Ng==",
      "original_commit_id" : "aa67e6d736fab1cf125687f3393a3eb259fb8608",
      "original_position" : 80,
      "path" : "src/consensus/validation.h",
      "position" : null,
      "pull_request_review_id" : 314489132,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399",
      "updated_at" : "2019-11-08T22:15:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344388046",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r344388068"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344388068"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in 7239d01 but named it `ToString` since #16688 uses it for valid states as well.",
      "commit_id" : "0468628e8191c574d2568f5e9e7fa15dd43d80f2",
      "created_at" : "2019-11-08T22:15:38Z",
      "diff_hunk" : "@@ -6,12 +6,18 @@\n #ifndef BITCOIN_UTIL_VALIDATION_H\n #define BITCOIN_UTIL_VALIDATION_H\n \n-#include <string>\n+#include <consensus/validation.h>\n \n-class ValidationState;\n+#include <string>\n \n /** Convert ValidationState to a human-readable message for logging */\n-std::string FormatStateMessage(const ValidationState &state);\n+template <typename Result>\n+std::string FormatStateMessage(const ValidationState<Result>& state)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r344388068",
      "id" : 344388068,
      "in_reply_to_id" : 344134666,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NDM4ODA2OA==",
      "original_commit_id" : "aa67e6d736fab1cf125687f3393a3eb259fb8608",
      "original_position" : 13,
      "path" : "src/util/validation.h",
      "position" : null,
      "pull_request_review_id" : 314489160,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399",
      "updated_at" : "2019-11-08T22:15:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344388068",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r344388339"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344388339"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Understood. But that doesn't answer either of my questions... ð¤ ",
      "commit_id" : "0468628e8191c574d2568f5e9e7fa15dd43d80f2",
      "created_at" : "2019-11-08T22:16:36Z",
      "diff_hunk" : "@@ -71,31 +71,32 @@ enum class BlockValidationResult {\n \n \n \n-/** Base class for capturing information about block/transaction validation. This is subclassed\n+/** Template for capturing information about block/transaction validation. This is instantiated\n  *  by TxValidationState and BlockValidationState for validation information on transactions\n  *  and blocks respectively. */\n+template <typename Result>\n class ValidationState {\n private:\n     enum mode_state {\n         MODE_VALID,   //!< everything ok\n         MODE_INVALID, //!< network rule violation (DoS value may be set)\n         MODE_ERROR,   //!< run-time error\n     } m_mode;\n+    Result m_result;\n     std::string m_reject_reason;\n     std::string m_debug_message;\n-protected:\n-    void Invalid(const std::string &reject_reason=\"\",\n+public:\n+    ValidationState() : m_mode(MODE_VALID) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r344388339",
      "id" : 344388339,
      "in_reply_to_id" : 343577327,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NDM4ODMzOQ==",
      "original_commit_id" : "aa67e6d736fab1cf125687f3393a3eb259fb8608",
      "original_position" : 22,
      "path" : "src/consensus/validation.h",
      "position" : 22,
      "pull_request_review_id" : 314489518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399",
      "updated_at" : "2019-11-08T22:16:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344388339",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK: new code is easier to reason about",
      "created_at" : "2019-11-11T12:44:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#issuecomment-552431092",
      "id" : 552431092,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17399",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MjQzMTA5Mg==",
      "updated_at" : "2019-11-11T12:44:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/552431092",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r344745928"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344745928"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It seems a bit sad to leave this const all by itself in this implementation file. Perhaps move it to the header file and change to a constexpr? Bonus points for renaming `util/validation.h` to `util/strings.h` since it isn't anything to do with validation any more, and I can't find anywhere that would be a better home for this const.",
      "commit_id" : "0468628e8191c574d2568f5e9e7fa15dd43d80f2",
      "created_at" : "2019-11-11T14:48:34Z",
      "diff_hunk" : "@@ -5,15 +5,4 @@\n \n #include <util/validation.h>\n \n-#include <consensus/validation.h>\n-#include <tinyformat.h>\n-\n-/** Convert ValidationState to a human-readable message for logging */\n-std::string FormatStateMessage(const ValidationState &state)\n-{\n-    return strprintf(\"%s%s\",\n-        state.GetRejectReason(),\n-        state.GetDebugMessage().empty() ? \"\" : \", \"+state.GetDebugMessage());\n-}\n-\n const std::string strMessageMagic = \"Bitcoin Signed Message:\\n\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r344745928",
      "id" : 344745928,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NDc0NTkyOA==",
      "original_commit_id" : "0468628e8191c574d2568f5e9e7fa15dd43d80f2",
      "original_position" : 15,
      "path" : "src/util/validation.cpp",
      "position" : 15,
      "pull_request_review_id" : 314943375,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399",
      "updated_at" : "2019-11-11T14:56:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344745928",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
