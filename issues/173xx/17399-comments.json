[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16688](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16688.html) (log: Add validation interface logging by jkczyz)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-11-07T03:36:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#issuecomment-550647765",
      "id" : 550647765,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17399",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MDY0Nzc2NQ==",
      "updated_at" : "2019-11-07T03:36:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/550647765",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r343577327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343577327"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, in L85 do `} m_mode{MODE_VALID};` and drop constructor?",
      "commit_id" : "aa67e6d736fab1cf125687f3393a3eb259fb8608",
      "created_at" : "2019-11-07T10:28:17Z",
      "diff_hunk" : "@@ -71,31 +71,32 @@ enum class BlockValidationResult {\n \n \n \n-/** Base class for capturing information about block/transaction validation. This is subclassed\n+/** Template for capturing information about block/transaction validation. This is instantiated\n  *  by TxValidationState and BlockValidationState for validation information on transactions\n  *  and blocks respectively. */\n+template <typename Result>\n class ValidationState {\n private:\n     enum mode_state {\n         MODE_VALID,   //!< everything ok\n         MODE_INVALID, //!< network rule violation (DoS value may be set)\n         MODE_ERROR,   //!< run-time error\n     } m_mode;\n+    Result m_result;\n     std::string m_reject_reason;\n     std::string m_debug_message;\n-protected:\n-    void Invalid(const std::string &reject_reason=\"\",\n+public:\n+    ValidationState() : m_mode(MODE_VALID) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r343577327",
      "id" : 343577327,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzU3NzMyNw==",
      "original_commit_id" : "aa67e6d736fab1cf125687f3393a3eb259fb8608",
      "original_position" : 22,
      "path" : "src/consensus/validation.h",
      "position" : 22,
      "pull_request_review_id" : 313241691,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399",
      "updated_at" : "2019-11-07T10:34:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343577327",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r343579534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343579534"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You can still forward declare `TxValidationState` and `BlockValidationState` where needed and avoid the issues pointed by @ryanofsky?",
      "commit_id" : "aa67e6d736fab1cf125687f3393a3eb259fb8608",
      "created_at" : "2019-11-07T10:33:17Z",
      "diff_hunk" : "@@ -5,6 +5,8 @@\n #ifndef BITCOIN_CONSENSUS_TX_CHECK_H\n #define BITCOIN_CONSENSUS_TX_CHECK_H\n \n+#include <consensus/validation.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r343579534",
      "id" : 343579534,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzU3OTUzNA==",
      "original_commit_id" : "aa67e6d736fab1cf125687f3393a3eb259fb8608",
      "original_position" : 4,
      "path" : "src/consensus/tx_check.h",
      "position" : 4,
      "pull_request_review_id" : 313241691,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399",
      "updated_at" : "2019-11-07T10:34:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343579534",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r343805188"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343805188"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This causes a compilation error:\r\n\r\n```console\r\nIn file included from consensus/tx_check.cpp:8:\r\n./consensus/validation.h:115:7: error: typedef redefinition with different types ('ValidationState<TxValidationResult>' vs 'TxValidationState')\r\nusing TxValidationState = ValidationState<TxValidationResult>;\r\n      ^\r\n./consensus/tx_check.h:16:7: note: previous definition is here\r\nclass TxValidationState;\r\n```\r\n\r\nI'd have to forward declare the full template type and enum then use that in the function declaration.\r\n\r\n```c++\r\nenum class TxValidationResult;\r\ntemplate <typename Result>\r\nclass ValidationState;\r\n\r\nbool CheckTransaction(const CTransaction& tx, ValidationState<TxValidationResult>& state);\r\n```\r\n\r\nSeems a bit verbose and would mismatch the function definition. FWIW, here are some [pros and cons](https://google.github.io/styleguide/cppguide.html#Forward_Declarations) of forward declaring that I'm aware of.",
      "commit_id" : "aa67e6d736fab1cf125687f3393a3eb259fb8608",
      "created_at" : "2019-11-07T18:28:55Z",
      "diff_hunk" : "@@ -5,6 +5,8 @@\n #ifndef BITCOIN_CONSENSUS_TX_CHECK_H\n #define BITCOIN_CONSENSUS_TX_CHECK_H\n \n+#include <consensus/validation.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r343805188",
      "id" : 343805188,
      "in_reply_to_id" : 343579534,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzgwNTE4OA==",
      "original_commit_id" : "aa67e6d736fab1cf125687f3393a3eb259fb8608",
      "original_position" : 4,
      "path" : "src/consensus/tx_check.h",
      "position" : 4,
      "pull_request_review_id" : 313545850,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399",
      "updated_at" : "2019-11-07T18:44:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343805188",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r343805959"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343805959"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The diff here is a bit misleading as I'm actually moving `Invalid` to the `public` section and not modifying the constructor. Is the convention to put this in a separate a commit? Or would it be considered outside the scope of the PR?",
      "commit_id" : "aa67e6d736fab1cf125687f3393a3eb259fb8608",
      "created_at" : "2019-11-07T18:30:29Z",
      "diff_hunk" : "@@ -71,31 +71,32 @@ enum class BlockValidationResult {\n \n \n \n-/** Base class for capturing information about block/transaction validation. This is subclassed\n+/** Template for capturing information about block/transaction validation. This is instantiated\n  *  by TxValidationState and BlockValidationState for validation information on transactions\n  *  and blocks respectively. */\n+template <typename Result>\n class ValidationState {\n private:\n     enum mode_state {\n         MODE_VALID,   //!< everything ok\n         MODE_INVALID, //!< network rule violation (DoS value may be set)\n         MODE_ERROR,   //!< run-time error\n     } m_mode;\n+    Result m_result;\n     std::string m_reject_reason;\n     std::string m_debug_message;\n-protected:\n-    void Invalid(const std::string &reject_reason=\"\",\n+public:\n+    ValidationState() : m_mode(MODE_VALID) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17399#discussion_r343805959",
      "id" : 343805959,
      "in_reply_to_id" : 343577327,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MzgwNTk1OQ==",
      "original_commit_id" : "aa67e6d736fab1cf125687f3393a3eb259fb8608",
      "original_position" : 22,
      "path" : "src/consensus/validation.h",
      "position" : 22,
      "pull_request_review_id" : 313545850,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17399",
      "updated_at" : "2019-11-07T18:44:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/343805959",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   }
]
