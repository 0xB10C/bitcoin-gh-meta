[
   {
      "author_association" : "MEMBER",
      "body" : "I think this is the eventual right direction for us to go (because mapRelay doesn't have great memory bounds), but without something like #15505 this turns nodes into accidental DoSers whenever they evict a transaction after announcement and before a getdata comes in.  If you're a node running with a small mempool, then transactions can be evicted even if they're not \"low feerate\".\r\n\r\nI tend to think we should not be turning nodes with small mempools into DoSers; so if we solve that problem first (eg by making the peer receiving a NOTFOUND be able to find the transaction elsewhere in a reasonable amount of time), then I think we could go ahead and remove mapRelay and only serve things from our mempool.  We should go ahead and fix the privacy problem (mentioned in #14220) at the same time though.",
      "created_at" : "2019-10-29T19:23:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17303#issuecomment-547589047",
      "id" : 547589047,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17303",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NzU4OTA0Nw==",
      "updated_at" : "2019-10-29T19:23:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/547589047",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">  We should go ahead and fix the privacy problem (mentioned in #14220) at the same time though.\r\n\r\nIt is trivial to fix that now, but I refuse to write code that does time comparisons that don't use std::chrono. Will push the commit after #17243 .",
      "created_at" : "2019-10-29T20:12:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17303#issuecomment-547608501",
      "id" : 547608501,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17303",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NzYwODUwMQ==",
      "updated_at" : "2019-10-29T20:12:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/547608501",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "created_at" : "2019-10-29T22:52:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17303#issuecomment-547664454",
      "id" : 547664454,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17303",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NzY2NDQ1NA==",
      "updated_at" : "2019-11-01T21:43:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/547664454",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This sounds reasonable to me, but I think we should be careful here to not introduce vulns as a side-effect.\r\nSo I'd want to give a more thorough review once all the pre-reqs mentioned above are satisfied.",
      "created_at" : "2019-11-04T19:06:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17303#issuecomment-549501082",
      "id" : 549501082,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17303",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0OTUwMTA4Mg==",
      "updated_at" : "2019-11-04T19:06:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/549501082",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Minimized the diff. Also fixed the privacy issue as requested by @sdaftuar ",
      "created_at" : "2019-11-06T18:38:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17303#issuecomment-550443904",
      "id" : 550443904,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17303",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MDQ0MzkwNA==",
      "updated_at" : "2019-11-06T18:38:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/550443904",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "### Summary\r\n\r\nI think the privacy problem mentioned above is fixed here in a limited way.\r\nThere are 2 privacy threats related to the discussed behavior right now:\r\na) inferring an origin node of the particular transaction\r\nb) inferring tx relay network topology\r\n\r\nThis proposal fixes a), but does not fix b), see below.\r\nI also show that ideas of fixing b) after this change would require bringing back mapRelay in another form.\r\n\r\n### New attack\r\n\r\nWe will not respond if something wasn't INVed, right. But imagine flooding the network with tx_A, so that everybody announces is to an attacker and an attacker now can query for it. \r\nThen in 30 seconds, when everyone does have tx_A, we selectively announce tx_B  (which is an RBF to tx_A and will evict tx_A from the mempool) to **node_victim**. And start querying for **tx_A** persistently. Whoever responds with ``NOTFOUND`` received tx_B, which means that node was closer to **node_victim**.\r\n\r\nStuff like diffusion, [previous PR addressing the problem](https://github.com/bitcoin/bitcoin/pull/14220) and **this** proposal would make it difficult to infer tx_A or tx_B relay paths directly, but they can easily be deduced by querying for tx_A. \r\n\r\nSo, the cost of an attack is increased from ``1 tx (or even 0 if using someone's txs)`` to ``1 tx + 1 RBF``, which does not really address the goal.\r\n\r\n### Ideas\r\n\r\n#### Crazy expensive but fundamental\r\nKeep responding about tx_A even when it's replaced with tx_B.\r\nThis would require storing tx_A while tx_B is still in the mempool. Afaik this is very opposite to the current intuition we implement in the codebase.\r\n\r\n#### Less expensive but limited\r\nAllow at most 1 (or 2 just in case) queries per transaction. So that tx_A can be requested by every node at most once. \r\nIn this case, an attacker would have to run more nodes or spend more double-spends. Not ideal, but at least something.\r\nIt would also require a data structure like a bloom filter to track our past responses.\r\n\r\nMaybe this should be implemented as a follow-up PR, I might do that sometime.\r\n",
      "created_at" : "2019-11-06T19:19:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17303#issuecomment-550460346",
      "id" : 550460346,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17303",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MDQ2MDM0Ng==",
      "updated_at" : "2019-11-06T20:34:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/550460346",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17303#discussion_r345435567"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17303"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/345435567"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You can now remove `push` and then update `vNotFound` in an else branch opposite the `PushMessage` below.",
      "commit_id" : "fa5f3dae9ca12a06fe64fb8ccfa7d1f53e858e40",
      "created_at" : "2019-11-12T20:47:19Z",
      "diff_hunk" : "@@ -1554,20 +1554,17 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             const CInv &inv = *it;\n             it++;\n \n-            // Send stream from relay memory\n             bool push = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17303#discussion_r345435567",
      "id" : 345435567,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NTQzNTU2Nw==",
      "original_commit_id" : "fa9aa380a11f413a68ec9caf7846547ded3632b5",
      "original_position" : 5,
      "path" : "src/net_processing.cpp",
      "position" : 36,
      "pull_request_review_id" : 315831634,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17303",
      "updated_at" : "2019-11-13T00:18:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/345435567",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17303#discussion_r345435673"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17303"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/345435673"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Is this scope needed?",
      "commit_id" : "fa5f3dae9ca12a06fe64fb8ccfa7d1f53e858e40",
      "created_at" : "2019-11-12T20:47:33Z",
      "diff_hunk" : "@@ -1554,20 +1554,17 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             const CInv &inv = *it;\n             it++;\n \n-            // Send stream from relay memory\n             bool push = false;\n-            auto mi = mapRelay.find(inv.hash);\n             int nSendFlags = (inv.type == MSG_TX ? SERIALIZE_TRANSACTION_NO_WITNESS : 0);\n-            if (mi != mapRelay.end()) {\n-                connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::TX, *mi->second));\n-                push = true;\n-            } else {\n+            {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17303#discussion_r345435673",
      "id" : 345435673,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NTQzNTY3Mw==",
      "original_commit_id" : "fa9aa380a11f413a68ec9caf7846547ded3632b5",
      "original_position" : 12,
      "path" : "src/net_processing.cpp",
      "position" : 43,
      "pull_request_review_id" : 315831634,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17303",
      "updated_at" : "2019-11-13T00:18:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/345435673",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17303#discussion_r345522122"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17303"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/345522122"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Happy to remove in a new commit if I get at least one ACK and others agree to do this.",
      "commit_id" : "fa5f3dae9ca12a06fe64fb8ccfa7d1f53e858e40",
      "created_at" : "2019-11-13T00:52:46Z",
      "diff_hunk" : "@@ -1554,20 +1554,17 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             const CInv &inv = *it;\n             it++;\n \n-            // Send stream from relay memory\n             bool push = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17303#discussion_r345522122",
      "id" : 345522122,
      "in_reply_to_id" : 345435567,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NTUyMjEyMg==",
      "original_commit_id" : "fa9aa380a11f413a68ec9caf7846547ded3632b5",
      "original_position" : 5,
      "path" : "src/net_processing.cpp",
      "position" : 36,
      "pull_request_review_id" : 315941195,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17303",
      "updated_at" : "2019-11-13T00:52:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/345522122",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17303#discussion_r345522136"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17303"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/345522136"
         }
      },
      "author_association" : "MEMBER",
      "body" : "no, but it keeps the scope that came previously after the else to minimize the diff. Happy to remove in a new commit if I get at least one ACK and others agree to do this.",
      "commit_id" : "fa5f3dae9ca12a06fe64fb8ccfa7d1f53e858e40",
      "created_at" : "2019-11-13T00:52:49Z",
      "diff_hunk" : "@@ -1554,20 +1554,17 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             const CInv &inv = *it;\n             it++;\n \n-            // Send stream from relay memory\n             bool push = false;\n-            auto mi = mapRelay.find(inv.hash);\n             int nSendFlags = (inv.type == MSG_TX ? SERIALIZE_TRANSACTION_NO_WITNESS : 0);\n-            if (mi != mapRelay.end()) {\n-                connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::TX, *mi->second));\n-                push = true;\n-            } else {\n+            {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17303#discussion_r345522136",
      "id" : 345522136,
      "in_reply_to_id" : 345435673,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NTUyMjEzNg==",
      "original_commit_id" : "fa9aa380a11f413a68ec9caf7846547ded3632b5",
      "original_position" : 12,
      "path" : "src/net_processing.cpp",
      "position" : 43,
      "pull_request_review_id" : 315941210,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17303",
      "updated_at" : "2019-11-13T00:52:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/345522136",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The PR title states that this change \"improve tx privacy slightly\". Could you elaborate in the PR description how? (i.e., why was it less private before?)",
      "created_at" : "2019-11-13T18:59:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17303#issuecomment-553550171",
      "id" : 553550171,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17303",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MzU1MDE3MQ==",
      "updated_at" : "2019-11-13T18:59:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/553550171",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\n@sdaftuar\r\nYou had two concept comments on this PR:\r\n1. If we make this change, then it should address the privacy issue identified in #14220. I haven't fully reviewed the second commit yet, but it seems like a reasonable fix (keep a per-peer timestamp of the last tx INV we sent, don't respond to GETDATAs for txs that entered our mempool after that timestamp).\r\n2. This PR might exacerbate the problem in #15505 and we could stall relay for txs that are removed from our mempool for `SIZELIMIT`. That seems to me to be a very minor edge condition for transactions that are at the bottom of the mempool. Presumably we expect almost all nodes' mempool limits to be at least an order of magnitude greater than the block weight limit, which means that any tx that falls into this category has at least ten blocks worth of better transactions than it in the mempool, and we wouldn't expect it to be mined for 100 minutes. That's plenty of time for the peer to request the tx from another peer.\r\n\r\n@naumenkogs \r\nI don't think the topology probing technique you describe in https://github.com/bitcoin/bitcoin/pull/17303#issuecomment-550460346 is made any worse by this PR. We can always probe whether a tx is in a peer's mempool using the technique here: https://github.com/bitcoin/bitcoin/pull/16851#issuecomment-530794255.",
      "created_at" : "2019-11-13T21:27:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17303#issuecomment-553611188",
      "id" : 553611188,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17303",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MzYxMTE4OA==",
      "updated_at" : "2019-11-13T21:27:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/553611188",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I think Suhas point is requester is going to keep sending GETDATA as tx isn't erased from m_tx_process_time at NOTFOUND processing?\r\n\r\nI think the concern is that a peer will send us an INV for a tx that then gets removed from its mempool because of `SIZELIMIT`. It'll reply with a `NOTFOUND` which we don't do anything with.\r\n\r\nI think that's ok because one minute later we'll request from another peer that INV'ed the transaction to us: https://github.com/bitcoin/bitcoin/blob/cd6cb9745e13a62e130b11f78a13bcc1d424b05e/src/net_processing.cpp#L4043 and if the tx was removed from the first peer's mempool for `SIZELIMIT`, then one minute delay shouldn't be a problem (since we don't expect the tx to be mined any time soon).",
      "created_at" : "2019-11-14T18:25:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17303#issuecomment-554016248",
      "id" : 554016248,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17303",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NDAxNjI0OA==",
      "updated_at" : "2019-11-14T18:25:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554016248",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I think that's ok because one minute later we'll request from another peer that INV'ed the transaction to us\r\n\r\nOk, I was making the assumption than the NOTFOUND peer is the origin one so you don't have an INV from other peers. Isn't our current logic going to loop on the sending GETDATA, receiving NOTFOUND sequence ? Or is this too an edge case?",
      "created_at" : "2019-11-14T20:09:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17303#issuecomment-554058157",
      "id" : 554058157,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17303",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NDA1ODE1Nw==",
      "updated_at" : "2019-11-14T20:09:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554058157",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "So the benefits of this PR are presumably to eliminate DoS attack surface on mapRelay (though Iâm not sure anyone has articulated this clearly) and to solve a privacy issue.  I think both those things could also be solved without introducing relay problems from announcing transactions and then not responding (and Iâve proposed one approach that I think would be satisfactory; Iâm sure someone could probably propose a solution to both these things that involves keeping mapRelay around as well).\r\n\r\nAnyway I donât understand why we would be sloppy here; itâs not like relay degradation is some kind of fundamental trade-off with what weâre trying to accomplish.  (And the DoS and privacy issues are not new, they have been around for a long time, so it doesnât really seem like they are urgent to address either?)\r\n\r\n(BTW if anyone wants to pick up #15505 and try to get that merged so that this gets unblocked, please go for it â I closed it earlier this year because there didnât seem to be much review interest, and then reopened it in light of this PR to remind others of one approach to solving the issue that I thought needed to be fixed first, before we went in the direction proposed here.)",
      "created_at" : "2019-11-14T20:12:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17303#issuecomment-554059479",
      "id" : 554059479,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17303",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NDA1OTQ3OQ==",
      "updated_at" : "2019-11-14T20:12:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554059479",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@jnewbery \r\n> I don't think the topology probing technique you describe in #17303 (comment) is made any worse by this PR. We can always probe whether a tx is in a peer's mempool using the technique here: #16851 (comment).\r\n\r\nI have never said it's made any worse. What I don't like is that in future when we'll want to fix privacy issue we might return ``mapRelay`` in a slightly different form, so I thought maybe we should do it right away here. \r\nThis is not a deal-breaker for me, but I want others to understand this while making a decision.",
      "created_at" : "2019-11-15T00:55:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17303#issuecomment-554158568",
      "id" : 554158568,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17303",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NDE1ODU2OA==",
      "updated_at" : "2019-11-15T00:55:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554158568",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   }
]
