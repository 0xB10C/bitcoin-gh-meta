[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#17369](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17369.html) (Refactor: Move encryption code between KeyMan and Wallet by achow101)\n* [#17261](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17261.html) (Make ScriptPubKeyMan an actual interface and the wallet to have multiple by achow101)\n* [#17237](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17237.html) (wallet: LearnRelatedScripts only if KeepDestination by promag)\n* [#16895](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16895.html) (External signer multisig support by Sjors)\n* [#16549](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16549.html) ([WIP] UI external signer support (e.g. hardware wallet) by Sjors)\n* [#16546](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16546.html) ([WIP] External signer support - Wallet Box edition by Sjors)\n* [#16528](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16528.html) ([WIP] Native Descriptor Wallets (take 2) by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-11-04T23:26:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-549593880",
      "id" : 549593880,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0OTU5Mzg4MA==",
      "updated_at" : "2019-11-07T22:13:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/549593880",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342634238"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342634238"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: remove one more line",
      "commit_id" : "228a316e6390e512668095331417a5ae25130170",
      "created_at" : "2019-11-05T15:41:47Z",
      "diff_hunk" : "@@ -3242,9 +3242,6 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-    if (!pwallet->CanGetAddresses(internal)) {\n-        return false;\n-    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342634238",
      "id" : 342634238,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjYzNDIzOA==",
      "original_commit_id" : "4e9c2a59f500d017dbc1e3b6a3548f7b93977459",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : 25,
      "pull_request_review_id" : 311826649,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-11-06T23:04:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342634238",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342636404"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342636404"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Move assert for `vchPubKey.IsValid()` as well? (I know it's deleted later, but that commit is still under discussion)",
      "commit_id" : "228a316e6390e512668095331417a5ae25130170",
      "created_at" : "2019-11-05T15:45:42Z",
      "diff_hunk" : "@@ -3246,16 +3246,14 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n     if (nIndex == -1)\n     {\n         CKeyPool keypool;\n-        if (!m_spk_man->GetReservedDestination(type, internal, nIndex, keypool)) {\n+        if (!m_spk_man->GetReservedDestination(type, internal, dest, nIndex, keypool)) {\n             return false;\n         }\n         vchPubKey = keypool.vchPubKey;\n         fInternal = keypool.fInternal;\n+        address = dest;\n     }\n     assert(vchPubKey.IsValid());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342636404",
      "id" : 342636404,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjYzNjQwNA==",
      "original_commit_id" : "763c298e7fe1858c03c178d62bd58f31d40de32b",
      "original_position" : 12,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 311826649,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-11-06T23:04:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342636404",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> The change seems useful, but incomplete. CTxDestination is more generic than CPubKey, which offers more flexibility with (e.g. multisig) descriptor wallets. But then I think we should use CTxDestination everywhere, so maybe:\r\n\r\nI would prefer to clean this up in a followup.",
      "created_at" : "2019-11-05T19:06:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-549972243",
      "id" : 549972243,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0OTk3MjI0Mw==",
      "updated_at" : "2019-11-05T19:06:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/549972243",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342748149"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342748149"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Does it really matter? It's removed a few commits later anyways.",
      "commit_id" : "228a316e6390e512668095331417a5ae25130170",
      "created_at" : "2019-11-05T19:15:39Z",
      "diff_hunk" : "@@ -3242,9 +3242,6 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-    if (!pwallet->CanGetAddresses(internal)) {\n-        return false;\n-    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342748149",
      "id" : 342748149,
      "in_reply_to_id" : 342634238,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0Mjc0ODE0OQ==",
      "original_commit_id" : "4e9c2a59f500d017dbc1e3b6a3548f7b93977459",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : 25,
      "pull_request_review_id" : 311977188,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-11-06T23:04:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342748149",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342748706"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342748706"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ignoring that it's removed later, the check matters here. since the pubkey should always be valid after GetReservedDestination. Either it was fetched earlier, or it was fetched just then.",
      "commit_id" : "228a316e6390e512668095331417a5ae25130170",
      "created_at" : "2019-11-05T19:16:54Z",
      "diff_hunk" : "@@ -3246,16 +3246,14 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n     if (nIndex == -1)\n     {\n         CKeyPool keypool;\n-        if (!m_spk_man->GetReservedDestination(type, internal, nIndex, keypool)) {\n+        if (!m_spk_man->GetReservedDestination(type, internal, dest, nIndex, keypool)) {\n             return false;\n         }\n         vchPubKey = keypool.vchPubKey;\n         fInternal = keypool.fInternal;\n+        address = dest;\n     }\n     assert(vchPubKey.IsValid());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342748706",
      "id" : 342748706,
      "in_reply_to_id" : 342636404,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0Mjc0ODcwNg==",
      "original_commit_id" : "763c298e7fe1858c03c178d62bd58f31d40de32b",
      "original_position" : 12,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 311977938,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-11-06T23:04:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342748706",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342778921"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342778921"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No, it's a nit :-)",
      "commit_id" : "228a316e6390e512668095331417a5ae25130170",
      "created_at" : "2019-11-05T20:21:42Z",
      "diff_hunk" : "@@ -3242,9 +3242,6 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-    if (!pwallet->CanGetAddresses(internal)) {\n-        return false;\n-    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342778921",
      "id" : 342778921,
      "in_reply_to_id" : 342634238,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0Mjc3ODkyMQ==",
      "original_commit_id" : "4e9c2a59f500d017dbc1e3b6a3548f7b93977459",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : 25,
      "pull_request_review_id" : 312017276,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-11-06T23:04:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342778921",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I would love for somebody to do a novelization of this PR like I did for https://github.com/bitcoin/bitcoin/pull/17369#pullrequestreview-313636620. I think I understand what the changes here are doing, but not why they are being made. Particularly I don't understand motivation for commits:\r\n\r\n- 8b9a1ed9fb5ef64385d3881b1423059e4daaef13 Key pool: Move TopUp call (3/6)\r\n- 8fc748e8050525a4235e34f3d93f3849245177f0 Key pool: Change ReturnDestination interface to take address instead of key (4/6)\r\n- 51ed5b0d73fc1e7010fc4b1bc26b4e1946cf60b0 Key pool: Make TopUp fail if unexpected wallet flags are set (5/6)\r\n\r\nAlso unclear if Sjors comment above about \"Make TopUp fail\" https://github.com/bitcoin/bitcoin/pull/17373#pullrequestreview-311826649 needs to be addressed\r\n",
      "created_at" : "2019-11-07T22:04:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-551287220",
      "id" : 551287220,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MTI4NzIyMA==",
      "updated_at" : "2019-11-07T22:04:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551287220",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky I've updated the OP with something like that.",
      "created_at" : "2019-11-07T23:56:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-551321055",
      "id" : 551321055,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MTMyMTA1NQ==",
      "updated_at" : "2019-11-07T23:56:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551321055",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the novelization.\r\n\r\n> Also unclear if Sjors comment above about \"Make TopUp fail\" [#17373 (review)](https://github.com/bitcoin/bitcoin/pull/17373#pullrequestreview-311826649) needs to be addressed\r\n\r\nI.e. descriptor wallets with `WALLET_FLAG_DISABLE_PRIVATE_KEYS` should be able to up their \"keypool\". Not too hard to change that later though.\r\n",
      "created_at" : "2019-11-08T08:37:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-551436646",
      "id" : 551436646,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MTQzNjY0Ng==",
      "updated_at" : "2019-11-08T08:37:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551436646",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346548666"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346548666"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Move CanGetAddresses call\" (f034e5748aa2fac9fb8c9010c806d00b2b8d79ba)\r\n\r\nMaybe say something like \"Call LegacyScriptPubKeyMan::CanGetAddresses directly instead of calling CWallet::CanGetAddresses to only query the relevant key manager\" in the commit description be clearer about what the change is supposed to do.\r\n\r\nIn case it helps anybody else, after 9b161a718f3c9d301419940cc9456f2065f8ca58 from #17261 there can more than keymanager and CWallet::CanGetAddresses will return false any of them can't generate addresses, so it wouldn't be right to call that method here.\r\n",
      "commit_id" : "228a316e6390e512668095331417a5ae25130170",
      "created_at" : "2019-11-14T21:14:02Z",
      "diff_hunk" : "@@ -3252,9 +3252,6 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-    if (!pwallet->CanGetAddresses(internal)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346548666",
      "id" : 346548666,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU0ODY2Ng==",
      "original_commit_id" : "f034e5748aa2fac9fb8c9010c806d00b2b8d79ba",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : 23,
      "pull_request_review_id" : 317263779,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-11-14T21:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346548666",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346554060"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346554060"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Move LearnRelated and GetDestination calls\" (35c37b59c5bb918c15aca3092b6506ef3974e50c)\r\n\r\nMaybe point out in the commit description that addresses are determined by LegacyScriptPubKeyMan::GetReservedDestination \r\ninstead of ReserveDestination::GetReservedDestination because other key manager implementations might construct them in other ways.",
      "commit_id" : "228a316e6390e512668095331417a5ae25130170",
      "created_at" : "2019-11-14T21:26:59Z",
      "diff_hunk" : "@@ -271,6 +271,8 @@ bool LegacyScriptPubKeyMan::GetReservedDestination(const OutputType type, bool i\n     if (!ReserveKeyFromKeyPool(index, keypool, internal)) {\n         return false;\n     }\n+    LearnRelatedScripts(keypool.vchPubKey, type);\n+    address = GetDestinationForKey(keypool.vchPubKey, type);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346554060",
      "id" : 346554060,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU1NDA2MA==",
      "original_commit_id" : "35c37b59c5bb918c15aca3092b6506ef3974e50c",
      "original_position" : 14,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 15,
      "pull_request_review_id" : 317263779,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-11-14T21:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346554060",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346558726"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346558726"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Move TopUp call\" (8b9a1ed9fb5ef64385d3881b1423059e4daaef13)\r\n\r\nSorry if this is a dumb question, because my understanding here is not great, but the PR description says this call has to be moved so \"it will work after future changes where m_spk_man is not a global thing in CWallet and is fetched based on type and internal-ness\".\r\n\r\nBut why couldn't the code here just look up the right keyman object using the type above and the internal-ness which it already knows?\r\n\r\nNot saying this shouldn't be moved, just that this doesn't seem to explain the move",
      "commit_id" : "228a316e6390e512668095331417a5ae25130170",
      "created_at" : "2019-11-14T21:37:30Z",
      "diff_hunk" : "@@ -3076,8 +3076,6 @@ bool CWallet::GetNewChangeDestination(const OutputType type, CTxDestination& des\n {\n     error.clear();\n \n-    m_spk_man->TopUp();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346558726",
      "id" : 346558726,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU1ODcyNg==",
      "original_commit_id" : "8b9a1ed9fb5ef64385d3881b1423059e4daaef13",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : 14,
      "pull_request_review_id" : 317263779,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-11-14T21:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346558726",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346562487"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346562487"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Key pool: Move TopUp call\" (8b9a1ed9fb5ef64385d3881b1423059e4daaef13)\r\n\r\nSince aside from the call in `GetNewChangeDestination` this code is also called from `CWallet::CreateTransaction`, I'm wondering if this is a change in behavior. Is topup already called when creating transactions? Wondering if this the \"unsollicited keypool topup\" refered to by https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-510903836\r\n",
      "commit_id" : "228a316e6390e512668095331417a5ae25130170",
      "created_at" : "2019-11-14T21:46:00Z",
      "diff_hunk" : "@@ -3252,6 +3250,7 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n+    m_spk_man->TopUp();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346562487",
      "id" : 346562487,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU2MjQ4Nw==",
      "original_commit_id" : "8b9a1ed9fb5ef64385d3881b1423059e4daaef13",
      "original_position" : 13,
      "path" : "src/wallet/wallet.cpp",
      "position" : 26,
      "pull_request_review_id" : 317263779,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-11-14T21:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346562487",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346568939"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346568939"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The place it is moved to does the lookup as well. It was redundant to do the lookup twice.",
      "commit_id" : "228a316e6390e512668095331417a5ae25130170",
      "created_at" : "2019-11-14T22:01:29Z",
      "diff_hunk" : "@@ -3076,8 +3076,6 @@ bool CWallet::GetNewChangeDestination(const OutputType type, CTxDestination& des\n {\n     error.clear();\n \n-    m_spk_man->TopUp();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346568939",
      "id" : 346568939,
      "in_reply_to_id" : 346558726,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU2ODkzOQ==",
      "original_commit_id" : "8b9a1ed9fb5ef64385d3881b1423059e4daaef13",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : 14,
      "pull_request_review_id" : 317289718,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
      "updated_at" : "2019-11-14T22:01:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346568939",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
