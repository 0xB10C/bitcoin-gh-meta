[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#17369](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17369.html) (Refactor: Move encryption code between KeyMan and Wallet by achow101)\n* [#17261](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17261.html) (Make ScriptPubKeyMan an actual interface and the wallet to have multiple by achow101)\n* [#17211](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17211.html) (Allow fundrawtransaction and walletcreatefundedpsbt to take external inputs by achow101)\n* [#16528](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16528.html) ([WIP] Native Descriptor Wallets (take 2) by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-11-04T23:27:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17371#issuecomment-549594143",
      "id" : 549594143,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17371",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0OTU5NDE0Mw==",
      "updated_at" : "2019-11-04T23:27:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/549594143",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r342585216"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342585216"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Adding `complete = false` would seem more consistent with previous behavior which sets `complete` to false if it can't sign one of the inputs.",
      "commit_id" : "d0dab897afaac0a18aa47d3ce673a4a43a69178a",
      "created_at" : "2019-11-05T14:15:54Z",
      "diff_hunk" : "@@ -39,12 +39,33 @@ TransactionError FillPSBT(const CWallet* pwallet, PartiallySignedTransaction& ps\n             return TransactionError::SIGHASH_MISMATCH;\n         }\n \n-        complete &= SignPSBTInput(HidingSigningProvider(pwallet->GetSigningProvider(), !sign, !bip32derivs), psbtx, i, sighash_type);\n+        // Get the scriptPubKey to know which SigningProvider to use\n+        CScript script;\n+        if (input.non_witness_utxo) {\n+            script = input.non_witness_utxo->vout[txin.prevout.n].scriptPubKey;\n+        } else if (!input.witness_utxo.IsNull()) {\n+            script = input.witness_utxo.scriptPubKey;\n+        } else {\n+            // There's no UTXO so we can just skip this now\n+            continue;\n+        }\n+        SignatureData sigdata;\n+        input.FillSignatureData(sigdata);\n+        const SigningProvider* provider = pwallet->GetSigningProvider(script, sigdata);\n+        if (!provider) {\n+            continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r342585216",
      "id" : 342585216,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjU4NTIxNg==",
      "original_commit_id" : "fd8ab05148da9dfba37aa5fb7314c67d471ea5ea",
      "original_position" : 19,
      "path" : "src/wallet/psbtwallet.cpp",
      "position" : 21,
      "pull_request_review_id" : 311762109,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371",
      "updated_at" : "2019-11-18T20:42:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342585216",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r342588205"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342588205"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Add `complete = false`?",
      "commit_id" : "d0dab897afaac0a18aa47d3ce673a4a43a69178a",
      "created_at" : "2019-11-05T14:21:15Z",
      "diff_hunk" : "@@ -39,12 +39,33 @@ TransactionError FillPSBT(const CWallet* pwallet, PartiallySignedTransaction& ps\n             return TransactionError::SIGHASH_MISMATCH;\n         }\n \n-        complete &= SignPSBTInput(HidingSigningProvider(pwallet->GetSigningProvider(), !sign, !bip32derivs), psbtx, i, sighash_type);\n+        // Get the scriptPubKey to know which SigningProvider to use\n+        CScript script;\n+        if (input.non_witness_utxo) {\n+            script = input.non_witness_utxo->vout[txin.prevout.n].scriptPubKey;\n+        } else if (!input.witness_utxo.IsNull()) {\n+            script = input.witness_utxo.scriptPubKey;\n+        } else {\n+            // There's no UTXO so we can just skip this now",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r342588205",
      "id" : 342588205,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjU4ODIwNQ==",
      "original_commit_id" : "fd8ab05148da9dfba37aa5fb7314c67d471ea5ea",
      "original_position" : 12,
      "path" : "src/wallet/psbtwallet.cpp",
      "position" : 12,
      "pull_request_review_id" : 311762109,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371",
      "updated_at" : "2019-11-18T20:42:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342588205",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r342588280"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342588280"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Check for the witness UTXO first? (given the above `The signing code will switch to the smaller witness_utxo if this is ok.`). It seems unlikely they'd have different signing providers, but still.\r\n\r\n",
      "commit_id" : "d0dab897afaac0a18aa47d3ce673a4a43a69178a",
      "created_at" : "2019-11-05T14:21:23Z",
      "diff_hunk" : "@@ -39,12 +39,33 @@ TransactionError FillPSBT(const CWallet* pwallet, PartiallySignedTransaction& ps\n             return TransactionError::SIGHASH_MISMATCH;\n         }\n \n-        complete &= SignPSBTInput(HidingSigningProvider(pwallet->GetSigningProvider(), !sign, !bip32derivs), psbtx, i, sighash_type);\n+        // Get the scriptPubKey to know which SigningProvider to use\n+        CScript script;\n+        if (input.non_witness_utxo) {\n+            script = input.non_witness_utxo->vout[txin.prevout.n].scriptPubKey;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r342588280",
      "id" : 342588280,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjU4ODI4MA==",
      "original_commit_id" : "fd8ab05148da9dfba37aa5fb7314c67d471ea5ea",
      "original_position" : 8,
      "path" : "src/wallet/psbtwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 311762109,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371",
      "updated_at" : "2019-11-18T20:42:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342588280",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r342597291"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342597291"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This seems brittle. I'm assuming the goal, if multiple signing providers match, is to have them all sign (part of) the transaction? What if the first signer succeeds, but the second returns an error object because it didn't have the key (in which it shouldn't have matched, but still...)?",
      "commit_id" : "d0dab897afaac0a18aa47d3ce673a4a43a69178a",
      "created_at" : "2019-11-05T14:37:47Z",
      "diff_hunk" : "@@ -3281,7 +3290,23 @@ UniValue signrawtransactionwithwallet(const JSONRPCRequest& request)\n     // Parse the prevtxs array\n     ParsePrevouts(request.params[1], nullptr, coins);\n \n-    return SignTransaction(mtx, &*pwallet->GetLegacyScriptPubKeyMan(), coins, request.params[2]);\n+    std::set<const SigningProvider*> providers;\n+    for (const std::pair<COutPoint, Coin> coin_pair : coins) {\n+        const SigningProvider* provider = pwallet->GetSigningProvider(coin_pair.second.out.scriptPubKey);\n+        if (provider) {\n+            providers.insert(std::move(provider));\n+        }\n+    }\n+    if (providers.size() == 0) {\n+        // When there are no available providers, use DUMMY_SIGNING_PROVIDER so we can check if the tx is complete\n+        providers.insert(&DUMMY_SIGNING_PROVIDER);\n+    }\n+\n+    UniValue result;\n+    for (const SigningProvider* provider : providers) {\n+        result = SignTransaction(mtx, provider, coins, request.params[2]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r342597291",
      "id" : 342597291,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjU5NzI5MQ==",
      "original_commit_id" : "fd8ab05148da9dfba37aa5fb7314c67d471ea5ea",
      "original_position" : 109,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 311762109,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371",
      "updated_at" : "2019-11-18T20:42:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342597291",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r342689536"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342689536"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Refactor: Require scriptPubKey to get wallet SigningProvider\" (f7510c144b2262e1ee114eaa740b889c24ec7abb)\r\n\r\nIt would seem more direct to replace `*pkhash` with `dest` here and call `GetScriptForDestination(dest)`",
      "commit_id" : "d0dab897afaac0a18aa47d3ce673a4a43a69178a",
      "created_at" : "2019-11-05T17:18:59Z",
      "diff_hunk" : "@@ -550,7 +550,11 @@ static UniValue signmessage(const JSONRPCRequest& request)\n         throw JSONRPCError(RPC_TYPE_ERROR, \"Address does not refer to key\");\n     }\n \n-    const SigningProvider* provider = pwallet->GetSigningProvider();\n+    CScript script_pub_key = GetScriptForDestination(*pkhash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r342689536",
      "id" : 342689536,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjY4OTUzNg==",
      "original_commit_id" : "fd8ab05148da9dfba37aa5fb7314c67d471ea5ea",
      "original_position" : 5,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 5,
      "pull_request_review_id" : 311898109,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371",
      "updated_at" : "2019-11-18T20:42:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342689536",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r342752069"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342752069"
         }
      },
      "author_association" : "MEMBER",
      "body" : "There shouldn't ever be a SigningProvider that doesn't match. ",
      "commit_id" : "d0dab897afaac0a18aa47d3ce673a4a43a69178a",
      "created_at" : "2019-11-05T19:23:32Z",
      "diff_hunk" : "@@ -3281,7 +3290,23 @@ UniValue signrawtransactionwithwallet(const JSONRPCRequest& request)\n     // Parse the prevtxs array\n     ParsePrevouts(request.params[1], nullptr, coins);\n \n-    return SignTransaction(mtx, &*pwallet->GetLegacyScriptPubKeyMan(), coins, request.params[2]);\n+    std::set<const SigningProvider*> providers;\n+    for (const std::pair<COutPoint, Coin> coin_pair : coins) {\n+        const SigningProvider* provider = pwallet->GetSigningProvider(coin_pair.second.out.scriptPubKey);\n+        if (provider) {\n+            providers.insert(std::move(provider));\n+        }\n+    }\n+    if (providers.size() == 0) {\n+        // When there are no available providers, use DUMMY_SIGNING_PROVIDER so we can check if the tx is complete\n+        providers.insert(&DUMMY_SIGNING_PROVIDER);\n+    }\n+\n+    UniValue result;\n+    for (const SigningProvider* provider : providers) {\n+        result = SignTransaction(mtx, provider, coins, request.params[2]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r342752069",
      "id" : 342752069,
      "in_reply_to_id" : 342597291,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0Mjc1MjA2OQ==",
      "original_commit_id" : "fd8ab05148da9dfba37aa5fb7314c67d471ea5ea",
      "original_position" : 109,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 311982202,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371",
      "updated_at" : "2019-11-18T20:42:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342752069",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r342752241"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342752241"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "d0dab897afaac0a18aa47d3ce673a4a43a69178a",
      "created_at" : "2019-11-05T19:23:51Z",
      "diff_hunk" : "@@ -39,12 +39,33 @@ TransactionError FillPSBT(const CWallet* pwallet, PartiallySignedTransaction& ps\n             return TransactionError::SIGHASH_MISMATCH;\n         }\n \n-        complete &= SignPSBTInput(HidingSigningProvider(pwallet->GetSigningProvider(), !sign, !bip32derivs), psbtx, i, sighash_type);\n+        // Get the scriptPubKey to know which SigningProvider to use\n+        CScript script;\n+        if (input.non_witness_utxo) {\n+            script = input.non_witness_utxo->vout[txin.prevout.n].scriptPubKey;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r342752241",
      "id" : 342752241,
      "in_reply_to_id" : 342588280,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0Mjc1MjI0MQ==",
      "original_commit_id" : "fd8ab05148da9dfba37aa5fb7314c67d471ea5ea",
      "original_position" : 8,
      "path" : "src/wallet/psbtwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 311982417,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371",
      "updated_at" : "2019-11-18T20:42:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342752241",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r342752261"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342752261"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "d0dab897afaac0a18aa47d3ce673a4a43a69178a",
      "created_at" : "2019-11-05T19:23:54Z",
      "diff_hunk" : "@@ -39,12 +39,33 @@ TransactionError FillPSBT(const CWallet* pwallet, PartiallySignedTransaction& ps\n             return TransactionError::SIGHASH_MISMATCH;\n         }\n \n-        complete &= SignPSBTInput(HidingSigningProvider(pwallet->GetSigningProvider(), !sign, !bip32derivs), psbtx, i, sighash_type);\n+        // Get the scriptPubKey to know which SigningProvider to use\n+        CScript script;\n+        if (input.non_witness_utxo) {\n+            script = input.non_witness_utxo->vout[txin.prevout.n].scriptPubKey;\n+        } else if (!input.witness_utxo.IsNull()) {\n+            script = input.witness_utxo.scriptPubKey;\n+        } else {\n+            // There's no UTXO so we can just skip this now",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r342752261",
      "id" : 342752261,
      "in_reply_to_id" : 342588205,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0Mjc1MjI2MQ==",
      "original_commit_id" : "fd8ab05148da9dfba37aa5fb7314c67d471ea5ea",
      "original_position" : 12,
      "path" : "src/wallet/psbtwallet.cpp",
      "position" : 12,
      "pull_request_review_id" : 311982441,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371",
      "updated_at" : "2019-11-18T20:42:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342752261",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r342752282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342752282"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "d0dab897afaac0a18aa47d3ce673a4a43a69178a",
      "created_at" : "2019-11-05T19:23:56Z",
      "diff_hunk" : "@@ -39,12 +39,33 @@ TransactionError FillPSBT(const CWallet* pwallet, PartiallySignedTransaction& ps\n             return TransactionError::SIGHASH_MISMATCH;\n         }\n \n-        complete &= SignPSBTInput(HidingSigningProvider(pwallet->GetSigningProvider(), !sign, !bip32derivs), psbtx, i, sighash_type);\n+        // Get the scriptPubKey to know which SigningProvider to use\n+        CScript script;\n+        if (input.non_witness_utxo) {\n+            script = input.non_witness_utxo->vout[txin.prevout.n].scriptPubKey;\n+        } else if (!input.witness_utxo.IsNull()) {\n+            script = input.witness_utxo.scriptPubKey;\n+        } else {\n+            // There's no UTXO so we can just skip this now\n+            continue;\n+        }\n+        SignatureData sigdata;\n+        input.FillSignatureData(sigdata);\n+        const SigningProvider* provider = pwallet->GetSigningProvider(script, sigdata);\n+        if (!provider) {\n+            continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r342752282",
      "id" : 342752282,
      "in_reply_to_id" : 342585216,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0Mjc1MjI4Mg==",
      "original_commit_id" : "fd8ab05148da9dfba37aa5fb7314c67d471ea5ea",
      "original_position" : 19,
      "path" : "src/wallet/psbtwallet.cpp",
      "position" : 21,
      "pull_request_review_id" : 311982460,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371",
      "updated_at" : "2019-11-18T20:42:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342752282",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r347567723"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347567723"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Refactor: Require scriptPubKey to get wallet SigningProvider\" (f7510c144b2262e1ee114eaa740b889c24ec7abb)\r\n\r\nAccording to RPC documentation result has three fields: \"hex\" \"complete\" and \"errors\". I guess for \"hex\" and \"complete\" fields it makes sense to take the last values, but errors field should probably accumulate? In any case, this code is not very future proof in case new fields are added. Would suggest changing SignTransaction to take a `UniValue& result` input/output parameter, so it can be responsible for updating the result at each step, and this code isn't just blindly overwriting previous results.",
      "commit_id" : "d0dab897afaac0a18aa47d3ce673a4a43a69178a",
      "created_at" : "2019-11-18T19:29:58Z",
      "diff_hunk" : "@@ -3281,7 +3290,23 @@ UniValue signrawtransactionwithwallet(const JSONRPCRequest& request)\n     // Parse the prevtxs array\n     ParsePrevouts(request.params[1], nullptr, coins);\n \n-    return SignTransaction(mtx, &*pwallet->GetLegacyScriptPubKeyMan(), coins, request.params[2]);\n+    std::set<const SigningProvider*> providers;\n+    for (const std::pair<COutPoint, Coin> coin_pair : coins) {\n+        const SigningProvider* provider = pwallet->GetSigningProvider(coin_pair.second.out.scriptPubKey);\n+        if (provider) {\n+            providers.insert(std::move(provider));\n+        }\n+    }\n+    if (providers.size() == 0) {\n+        // When there are no available providers, use DUMMY_SIGNING_PROVIDER so we can check if the tx is complete\n+        providers.insert(&DUMMY_SIGNING_PROVIDER);\n+    }\n+\n+    UniValue result;\n+    for (const SigningProvider* provider : providers) {\n+        result = SignTransaction(mtx, provider, coins, request.params[2]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r347567723",
      "id" : 347567723,
      "in_reply_to_id" : 342597291,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzU2NzcyMw==",
      "original_commit_id" : "fd8ab05148da9dfba37aa5fb7314c67d471ea5ea",
      "original_position" : 109,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 311898109,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371",
      "updated_at" : "2019-11-18T20:42:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347567723",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r347568781"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347568781"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Refactor: Require scriptPubKey to get wallet SigningProvider\" (f7510c144b2262e1ee114eaa740b889c24ec7abb)\r\n\r\nWould be slightly simpler to replace ternary with `solvable = provider && IsSolvable(*provider)`",
      "commit_id" : "d0dab897afaac0a18aa47d3ce673a4a43a69178a",
      "created_at" : "2019-11-18T19:32:16Z",
      "diff_hunk" : "@@ -3740,11 +3766,11 @@ UniValue getaddressinfo(const JSONRPCRequest& request)\n \n     CScript scriptPubKey = GetScriptForDestination(dest);\n     ret.pushKV(\"scriptPubKey\", HexStr(scriptPubKey.begin(), scriptPubKey.end()));\n-    const SigningProvider* provider = pwallet->GetSigningProvider();\n+    const SigningProvider* provider = pwallet->GetSigningProvider(scriptPubKey);\n \n     isminetype mine = pwallet->IsMine(dest);\n     ret.pushKV(\"ismine\", bool(mine & ISMINE_SPENDABLE));\n-    bool solvable = IsSolvable(*provider, scriptPubKey);\n+    bool solvable = provider ? IsSolvable(*provider, scriptPubKey) : false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r347568781",
      "id" : 347568781,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzU2ODc4MQ==",
      "original_commit_id" : "f7510c144b2262e1ee114eaa740b889c24ec7abb",
      "original_position" : 137,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 311898109,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371",
      "updated_at" : "2019-11-18T20:42:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347568781",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r347576440"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347576440"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think it really matters as we still need `pkhash` since `signmessage` is supposed to only work on p2pkh addresses.",
      "commit_id" : "d0dab897afaac0a18aa47d3ce673a4a43a69178a",
      "created_at" : "2019-11-18T19:49:11Z",
      "diff_hunk" : "@@ -550,7 +550,11 @@ static UniValue signmessage(const JSONRPCRequest& request)\n         throw JSONRPCError(RPC_TYPE_ERROR, \"Address does not refer to key\");\n     }\n \n-    const SigningProvider* provider = pwallet->GetSigningProvider();\n+    CScript script_pub_key = GetScriptForDestination(*pkhash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r347576440",
      "id" : 347576440,
      "in_reply_to_id" : 342689536,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzU3NjQ0MA==",
      "original_commit_id" : "fd8ab05148da9dfba37aa5fb7314c67d471ea5ea",
      "original_position" : 5,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 5,
      "pull_request_review_id" : 318586457,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371",
      "updated_at" : "2019-11-18T20:42:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347576440",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r347598676"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347598676"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "d0dab897afaac0a18aa47d3ce673a4a43a69178a",
      "created_at" : "2019-11-18T20:42:13Z",
      "diff_hunk" : "@@ -3740,11 +3766,11 @@ UniValue getaddressinfo(const JSONRPCRequest& request)\n \n     CScript scriptPubKey = GetScriptForDestination(dest);\n     ret.pushKV(\"scriptPubKey\", HexStr(scriptPubKey.begin(), scriptPubKey.end()));\n-    const SigningProvider* provider = pwallet->GetSigningProvider();\n+    const SigningProvider* provider = pwallet->GetSigningProvider(scriptPubKey);\n \n     isminetype mine = pwallet->IsMine(dest);\n     ret.pushKV(\"ismine\", bool(mine & ISMINE_SPENDABLE));\n-    bool solvable = IsSolvable(*provider, scriptPubKey);\n+    bool solvable = provider ? IsSolvable(*provider, scriptPubKey) : false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r347598676",
      "id" : 347598676,
      "in_reply_to_id" : 347568781,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzU5ODY3Ng==",
      "original_commit_id" : "f7510c144b2262e1ee114eaa740b889c24ec7abb",
      "original_position" : 137,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 318615654,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371",
      "updated_at" : "2019-11-18T20:42:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347598676",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r347599081"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347599081"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've added a commit which changes `SignTransaction` to `void` and has a `result` parameter to accumulate the errors array.",
      "commit_id" : "d0dab897afaac0a18aa47d3ce673a4a43a69178a",
      "created_at" : "2019-11-18T20:43:17Z",
      "diff_hunk" : "@@ -3281,7 +3290,23 @@ UniValue signrawtransactionwithwallet(const JSONRPCRequest& request)\n     // Parse the prevtxs array\n     ParsePrevouts(request.params[1], nullptr, coins);\n \n-    return SignTransaction(mtx, &*pwallet->GetLegacyScriptPubKeyMan(), coins, request.params[2]);\n+    std::set<const SigningProvider*> providers;\n+    for (const std::pair<COutPoint, Coin> coin_pair : coins) {\n+        const SigningProvider* provider = pwallet->GetSigningProvider(coin_pair.second.out.scriptPubKey);\n+        if (provider) {\n+            providers.insert(std::move(provider));\n+        }\n+    }\n+    if (providers.size() == 0) {\n+        // When there are no available providers, use DUMMY_SIGNING_PROVIDER so we can check if the tx is complete\n+        providers.insert(&DUMMY_SIGNING_PROVIDER);\n+    }\n+\n+    UniValue result;\n+    for (const SigningProvider* provider : providers) {\n+        result = SignTransaction(mtx, provider, coins, request.params[2]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17371#discussion_r347599081",
      "id" : 347599081,
      "in_reply_to_id" : 342597291,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzU5OTA4MQ==",
      "original_commit_id" : "fd8ab05148da9dfba37aa5fb7314c67d471ea5ea",
      "original_position" : 109,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 318616182,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17371",
      "updated_at" : "2019-11-18T20:43:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347599081",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
