[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9939#discussion_r104735147"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9939"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104735147"
         }
      },
      "body" : "I there's an ACK from the community, I would love to see this giant `if` break down with several early continues (to facilitate the reading), as applied [here](https://github.com/bitcoin/bitcoin/pull/8952/files#diff-b2bb174788c7409b671c46ccc86034bdR2066).",
      "commit_id" : "dca8d8926e655ba6639e748bcd32c560a5539b88",
      "created_at" : "2017-03-07T18:00:30Z",
      "diff_hunk" : "@@ -2080,8 +2082,15 @@ void CWallet::AvailableCoins(vector<COutput>& vCoins, bool fOnlyConfirmed, const\n             }\n \n             for (unsigned int i = 0; i < pcoin->tx->vout.size(); i++) {\n-                isminetype mine = IsMine(pcoin->tx->vout[i]);\n-                if (!(IsSpent(wtxid, i)) && mine != ISMINE_NO &&\n+                isminetype mine = ISMINE_NO;\n+                std::map<CScript, isminetype>::const_iterator im = mapOutputIsMine.find(pcoin->tx->vout[i].scriptPubKey);\n+                if (im != mapOutputIsMine.end()) {\n+                    mine = im->second;\n+                } else {\n+                    mine = mapOutputIsMine[pcoin->tx->vout[i].scriptPubKey] = IsMine(pcoin->tx->vout[i]);\n+                }\n+\n+                if (mine != ISMINE_NO && !(IsSpent(wtxid, i)) &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9939#discussion_r104735147",
      "id" : 104735147,
      "original_commit_id" : "dca8d8926e655ba6639e748bcd32c560a5539b88",
      "original_position" : 23,
      "path" : "src/wallet/wallet.cpp",
      "position" : 23,
      "pull_request_review_id" : 25585061,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9939",
      "updated_at" : "2017-03-07T18:00:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104735147",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4319748?v=3",
         "events_url" : "https://api.github.com/users/pedrobranco/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pedrobranco/followers",
         "following_url" : "https://api.github.com/users/pedrobranco/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pedrobranco/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pedrobranco",
         "id" : 4319748,
         "login" : "pedrobranco",
         "organizations_url" : "https://api.github.com/users/pedrobranco/orgs",
         "received_events_url" : "https://api.github.com/users/pedrobranco/received_events",
         "repos_url" : "https://api.github.com/users/pedrobranco/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pedrobranco/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pedrobranco/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pedrobranco"
      }
   },
   {
      "body" : "Please check https://github.com/bitcoin/bitcoin/pull/9167, morcos is working on it",
      "created_at" : "2017-03-08T03:11:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9939#issuecomment-284933779",
      "id" : 284933779,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9939",
      "updated_at" : "2017-03-08T03:11:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/284933779",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "body" : "@pedrobranco yes, that `if` is a little mess. I'll also take a look at it.\r\n\r\n@NicolasDorier If I understood the @morcos PR correctly, it's related to the `isminetype` of the transaction inputs and not the outputs, which we need here to find our `utxos`.",
      "created_at" : "2017-03-08T11:26:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9939#issuecomment-285016733",
      "id" : 285016733,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9939",
      "updated_at" : "2017-03-08T11:26:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285016733",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/16206754?v=3",
         "events_url" : "https://api.github.com/users/joaopaulofonseca/events{/privacy}",
         "followers_url" : "https://api.github.com/users/joaopaulofonseca/followers",
         "following_url" : "https://api.github.com/users/joaopaulofonseca/following{/other_user}",
         "gists_url" : "https://api.github.com/users/joaopaulofonseca/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/joaopaulofonseca",
         "id" : 16206754,
         "login" : "joaopaulofonseca",
         "organizations_url" : "https://api.github.com/users/joaopaulofonseca/orgs",
         "received_events_url" : "https://api.github.com/users/joaopaulofonseca/received_events",
         "repos_url" : "https://api.github.com/users/joaopaulofonseca/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/joaopaulofonseca/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/joaopaulofonseca/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/joaopaulofonseca"
      }
   },
   {
      "body" : "my bad I read too fast.",
      "created_at" : "2017-03-08T11:51:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9939#issuecomment-285021353",
      "id" : 285021353,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9939",
      "updated_at" : "2017-03-08T11:51:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285021353",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "body" : "Why not having the cache scoped to the WalletTransaction type ?\r\nInstead of \r\n```\r\nIsMine(pcoin->tx->vout[i])\r\n````\r\nwe would have\r\n```\r\npcoin->IsMine(i)\r\n````\r\nwhere WalletTransaction::IsMine would cache the result at the WalletTransaction level.\r\n\r\n1. this would make it more readable, \r\n2. this cache could be populated everywhere in the code when IsMine is called,\r\n3. the cache would span accross different calls to AvailableCoins, making AvailableCoins even faster.",
      "created_at" : "2017-03-08T12:00:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9939#issuecomment-285022930",
      "id" : 285022930,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9939",
      "updated_at" : "2017-03-08T12:00:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285022930",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9939#discussion_r104997820"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9939"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104997820"
         }
      },
      "body" : "Can simplify this as:\r\n\r\n```\r\n+                auto inserted = mapOutputIsMine.emplace(pcoin->tx->vout[i].scriptPubKey, ISMINE_NO);\r\n+                if (inserted.second) {\r\n+                   inserted.first->second = IsMine(pcoin->tx->vout[i]);\r\n+                }\r\n+                isminetype mine = inserted.first->second;\r\n```",
      "commit_id" : "dca8d8926e655ba6639e748bcd32c560a5539b88",
      "created_at" : "2017-03-08T19:13:28Z",
      "diff_hunk" : "@@ -2080,8 +2082,15 @@ void CWallet::AvailableCoins(vector<COutput>& vCoins, bool fOnlyConfirmed, const\n             }\n \n             for (unsigned int i = 0; i < pcoin->tx->vout.size(); i++) {\n-                isminetype mine = IsMine(pcoin->tx->vout[i]);\n-                if (!(IsSpent(wtxid, i)) && mine != ISMINE_NO &&\n+                isminetype mine = ISMINE_NO;\n+                std::map<CScript, isminetype>::const_iterator im = mapOutputIsMine.find(pcoin->tx->vout[i].scriptPubKey);\n+                if (im != mapOutputIsMine.end()) {\n+                    mine = im->second;\n+                } else {\n+                    mine = mapOutputIsMine[pcoin->tx->vout[i].scriptPubKey] = IsMine(pcoin->tx->vout[i]);\n+                }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9939#discussion_r104997820",
      "id" : 104997820,
      "original_commit_id" : "dca8d8926e655ba6639e748bcd32c560a5539b88",
      "original_position" : 21,
      "path" : "src/wallet/wallet.cpp",
      "position" : 21,
      "pull_request_review_id" : 25857481,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9939",
      "updated_at" : "2017-03-08T19:20:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104997820",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9939#discussion_r104998244"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9939"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104998244"
         }
      },
      "body" : "This would seem like a good idea, especially if the continues were documented with new comments. Not really on-topic for this PR, however.",
      "commit_id" : "dca8d8926e655ba6639e748bcd32c560a5539b88",
      "created_at" : "2017-03-08T19:15:14Z",
      "diff_hunk" : "@@ -2080,8 +2082,15 @@ void CWallet::AvailableCoins(vector<COutput>& vCoins, bool fOnlyConfirmed, const\n             }\n \n             for (unsigned int i = 0; i < pcoin->tx->vout.size(); i++) {\n-                isminetype mine = IsMine(pcoin->tx->vout[i]);\n-                if (!(IsSpent(wtxid, i)) && mine != ISMINE_NO &&\n+                isminetype mine = ISMINE_NO;\n+                std::map<CScript, isminetype>::const_iterator im = mapOutputIsMine.find(pcoin->tx->vout[i].scriptPubKey);\n+                if (im != mapOutputIsMine.end()) {\n+                    mine = im->second;\n+                } else {\n+                    mine = mapOutputIsMine[pcoin->tx->vout[i].scriptPubKey] = IsMine(pcoin->tx->vout[i]);\n+                }\n+\n+                if (mine != ISMINE_NO && !(IsSpent(wtxid, i)) &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9939#discussion_r104998244",
      "id" : 104998244,
      "original_commit_id" : "dca8d8926e655ba6639e748bcd32c560a5539b88",
      "original_position" : 23,
      "path" : "src/wallet/wallet.cpp",
      "position" : 23,
      "pull_request_review_id" : 25857481,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9939",
      "updated_at" : "2017-03-08T19:20:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104998244",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
