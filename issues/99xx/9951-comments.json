[
   {
      "body" : "Great!\r\nConcept ACK.\r\nNeeds rebase.",
      "created_at" : "2017-03-09T08:02:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9951#issuecomment-285281844",
      "id" : 285281844,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9951",
      "updated_at" : "2017-03-09T08:02:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285281844",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Yep needed trivial rebase for #9643.",
      "created_at" : "2017-03-09T08:18:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9951#issuecomment-285284819",
      "id" : 285284819,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9951",
      "updated_at" : "2017-03-09T08:18:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285284819",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105120742"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105120742"
         }
      },
      "body" : "This unique_ptr here bothers me. The interface shouldn't care what kind of pointer is used. I think I'm going to change this to take a `CWalletDBWrapper&`, then replace the call sites with `CWalletDB(*dbw)`. That's better than `CWalletDB(dbw.get())` at least.\r\nEdit: done",
      "commit_id" : "a2bf727b7dedb74606c89e5574ce6376840f6353",
      "created_at" : "2017-03-09T09:35:17Z",
      "diff_hunk" : "@@ -112,11 +112,19 @@ class CKeyMetadata\n     }\n };\n \n-/** Access to the wallet database */\n-class CWalletDB : public CDB\n+/** Access to the wallet database.\n+ * This should really be named CWalletDBBatch, as it represents a single transaction at the\n+ * database. It will be committed when the object goes out of scope.\n+ * Optionally (on by default) it will flush to disk as well.\n+ */\n+class CWalletDB\n {\n public:\n-    CWalletDB(const std::string& strFilename, const char* pszMode = \"r+\", bool _fFlushOnClose = true) : CDB(strFilename, pszMode, _fFlushOnClose)\n+    /** Takes a std::unique_ptr reference to avoid having to use",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105120742",
      "id" : 105120742,
      "original_commit_id" : "4ab3a72687c67379df0634c7c62ff88477b2af15",
      "original_position" : 15,
      "path" : "src/wallet/walletdb.h",
      "position" : null,
      "pull_request_review_id" : 25983520,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951",
      "updated_at" : "2017-03-09T15:01:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105120742",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105191282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105191282"
         }
      },
      "body" : "Better to use `const std::string& strFileName`, no copying and it's clear it won't be modified.",
      "commit_id" : "a2bf727b7dedb74606c89e5574ce6376840f6353",
      "created_at" : "2017-03-09T15:32:39Z",
      "diff_hunk" : "@@ -359,13 +359,12 @@ void CDBEnv::CheckpointLSN(const std::string& strFile)\n }\n \n \n-CDB::CDB(const std::string& strFilename, const char* pszMode, bool fFlushOnCloseIn) : pdb(NULL), activeTxn(NULL)\n+CDB::CDB(CWalletDBWrapper &dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb(NULL), activeTxn(NULL)\n {\n     int ret;\n     fReadOnly = (!strchr(pszMode, '+') && !strchr(pszMode, 'w'));\n     fFlushOnClose = fFlushOnCloseIn;\n-    if (strFilename.empty())\n-        return;\n+    std::string strFilename = dbw.strWalletFile;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105191282",
      "id" : 105191282,
      "original_commit_id" : "757f0a7261c0b23f26aa9cf76eea8e83d9097d7d",
      "original_position" : 12,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 26058623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951",
      "updated_at" : "2017-03-09T15:44:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105191282",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1225267?v=3",
         "events_url" : "https://api.github.com/users/benma/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benma/followers",
         "following_url" : "https://api.github.com/users/benma/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benma/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benma",
         "id" : 1225267,
         "login" : "benma",
         "organizations_url" : "https://api.github.com/users/benma/orgs",
         "received_events_url" : "https://api.github.com/users/benma/received_events",
         "repos_url" : "https://api.github.com/users/benma/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benma/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benma/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benma"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105191328"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105191328"
         }
      },
      "body" : "same",
      "commit_id" : "a2bf727b7dedb74606c89e5574ce6376840f6353",
      "created_at" : "2017-03-09T15:32:47Z",
      "diff_hunk" : "@@ -472,8 +471,11 @@ bool CDBEnv::RemoveDb(const std::string& strFile)\n     return (rc == 0);\n }\n \n-bool CDB::Rewrite(const std::string& strFile, const char* pszSkip)\n+bool CDB::Rewrite(CWalletDBWrapper &dbw, const char* pszSkip)\n {\n+    if (!dbw.env)\n+        return true;\n+    std::string strFile = dbw.strWalletFile;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105191328",
      "id" : 105191328,
      "original_commit_id" : "757f0a7261c0b23f26aa9cf76eea8e83d9097d7d",
      "original_position" : 25,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 26058623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951",
      "updated_at" : "2017-03-09T15:44:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105191328",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1225267?v=3",
         "events_url" : "https://api.github.com/users/benma/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benma/followers",
         "following_url" : "https://api.github.com/users/benma/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benma/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benma",
         "id" : 1225267,
         "login" : "benma",
         "organizations_url" : "https://api.github.com/users/benma/orgs",
         "received_events_url" : "https://api.github.com/users/benma/received_events",
         "repos_url" : "https://api.github.com/users/benma/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benma/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benma/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benma"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105191387"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105191387"
         }
      },
      "body" : "same",
      "commit_id" : "a2bf727b7dedb74606c89e5574ce6376840f6353",
      "created_at" : "2017-03-09T15:32:58Z",
      "diff_hunk" : "@@ -596,9 +598,13 @@ void CDBEnv::Flush(bool fShutdown)\n     }\n }\n \n-bool CDB::PeriodicFlush(std::string strFile)\n+bool CDB::PeriodicFlush(CWalletDBWrapper *dbw)\n {\n     bool ret = false;\n+    if (!dbw) {\n+        return true;\n+    }\n+    std::string strFile = dbw->strWalletFile;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105191387",
      "id" : 105191387,
      "original_commit_id" : "757f0a7261c0b23f26aa9cf76eea8e83d9097d7d",
      "original_position" : 49,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 26058623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951",
      "updated_at" : "2017-03-09T15:44:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105191387",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1225267?v=3",
         "events_url" : "https://api.github.com/users/benma/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benma/followers",
         "following_url" : "https://api.github.com/users/benma/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benma/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benma",
         "id" : 1225267,
         "login" : "benma",
         "organizations_url" : "https://api.github.com/users/benma/orgs",
         "received_events_url" : "https://api.github.com/users/benma/received_events",
         "repos_url" : "https://api.github.com/users/benma/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benma/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benma/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benma"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105191688"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105191688"
         }
      },
      "body" : "Better to move the check to the top, above `bool ret`.",
      "commit_id" : "a2bf727b7dedb74606c89e5574ce6376840f6353",
      "created_at" : "2017-03-09T15:34:08Z",
      "diff_hunk" : "@@ -596,9 +598,13 @@ void CDBEnv::Flush(bool fShutdown)\n     }\n }\n \n-bool CDB::PeriodicFlush(std::string strFile)\n+bool CDB::PeriodicFlush(CWalletDBWrapper *dbw)\n {\n     bool ret = false;\n+    if (!dbw) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105191688",
      "id" : 105191688,
      "original_commit_id" : "757f0a7261c0b23f26aa9cf76eea8e83d9097d7d",
      "original_position" : 46,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 26058623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951",
      "updated_at" : "2017-03-09T15:44:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105191688",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1225267?v=3",
         "events_url" : "https://api.github.com/users/benma/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benma/followers",
         "following_url" : "https://api.github.com/users/benma/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benma/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benma",
         "id" : 1225267,
         "login" : "benma",
         "organizations_url" : "https://api.github.com/users/benma/orgs",
         "received_events_url" : "https://api.github.com/users/benma/received_events",
         "repos_url" : "https://api.github.com/users/benma/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benma/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benma/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benma"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105191969"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105191969"
         }
      },
      "body" : "Inconsistent style with using/skipping braces (above, you used braces, here, you don't). I'd add them.",
      "commit_id" : "a2bf727b7dedb74606c89e5574ce6376840f6353",
      "created_at" : "2017-03-09T15:35:16Z",
      "diff_hunk" : "@@ -633,3 +639,44 @@ bool CDB::PeriodicFlush(std::string strFile)\n \n     return ret;\n }\n+\n+bool CWalletDBWrapper::Rewrite(const char* pszSkip)\n+{\n+    return CDB::Rewrite(*this, pszSkip);\n+}\n+\n+bool CWalletDBWrapper::Backup(const std::string& strDest)\n+{\n+    if (!env)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105191969",
      "id" : 105191969,
      "original_commit_id" : "757f0a7261c0b23f26aa9cf76eea8e83d9097d7d",
      "original_position" : 65,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 26058623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951",
      "updated_at" : "2017-03-09T15:44:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105191969",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1225267?v=3",
         "events_url" : "https://api.github.com/users/benma/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benma/followers",
         "following_url" : "https://api.github.com/users/benma/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benma/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benma",
         "id" : 1225267,
         "login" : "benma",
         "organizations_url" : "https://api.github.com/users/benma/orgs",
         "received_events_url" : "https://api.github.com/users/benma/received_events",
         "repos_url" : "https://api.github.com/users/benma/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benma/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benma/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benma"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105192424"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105192424"
         }
      },
      "body" : "const std::string",
      "commit_id" : "a2bf727b7dedb74606c89e5574ce6376840f6353",
      "created_at" : "2017-03-09T15:37:01Z",
      "diff_hunk" : "@@ -87,6 +87,33 @@ class CDBEnv\n \n extern CDBEnv bitdb;\n \n+/** An instance of this class represents one database.\n+ * For BerkeleyDB this is just a (env, strWalletFile) tuple.\n+ **/\n+class CWalletDBWrapper\n+{\n+public:\n+    CWalletDBWrapper(CDBEnv *env_in, const std::string &strWalletFile_in):\n+        env(env_in), strWalletFile(strWalletFile_in)\n+    {\n+    }\n+\n+    /** Rewrite the entire database on disk, with the exception of key pszSkip if non-zero\n+     */\n+    bool Rewrite(const char* pszSkip=nullptr);\n+\n+    /** Back up the entire database to a file.\n+     */\n+    bool Backup(const std::string& strDest);\n+\n+    /** Get a name for this database, for debugging etc.\n+     */\n+    std::string GetName() { return strWalletFile; }\n+\n+    CDBEnv *env;\n+    std::string strWalletFile;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105192424",
      "id" : 105192424,
      "original_commit_id" : "757f0a7261c0b23f26aa9cf76eea8e83d9097d7d",
      "original_position" : 28,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 26058623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951",
      "updated_at" : "2017-03-09T15:44:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105192424",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1225267?v=3",
         "events_url" : "https://api.github.com/users/benma/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benma/followers",
         "following_url" : "https://api.github.com/users/benma/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benma/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benma",
         "id" : 1225267,
         "login" : "benma",
         "organizations_url" : "https://api.github.com/users/benma/orgs",
         "received_events_url" : "https://api.github.com/users/benma/received_events",
         "repos_url" : "https://api.github.com/users/benma/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benma/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benma/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benma"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105192897"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105192897"
         }
      },
      "body" : "`std::string GetName() const`\r\n\r\nYou have this function, and the public `strWalletFile`, which you access directly in other places. Maybe `strWalletFile` should be made private, or alternatively, this function removed.",
      "commit_id" : "a2bf727b7dedb74606c89e5574ce6376840f6353",
      "created_at" : "2017-03-09T15:38:31Z",
      "diff_hunk" : "@@ -87,6 +87,33 @@ class CDBEnv\n \n extern CDBEnv bitdb;\n \n+/** An instance of this class represents one database.\n+ * For BerkeleyDB this is just a (env, strWalletFile) tuple.\n+ **/\n+class CWalletDBWrapper\n+{\n+public:\n+    CWalletDBWrapper(CDBEnv *env_in, const std::string &strWalletFile_in):\n+        env(env_in), strWalletFile(strWalletFile_in)\n+    {\n+    }\n+\n+    /** Rewrite the entire database on disk, with the exception of key pszSkip if non-zero\n+     */\n+    bool Rewrite(const char* pszSkip=nullptr);\n+\n+    /** Back up the entire database to a file.\n+     */\n+    bool Backup(const std::string& strDest);\n+\n+    /** Get a name for this database, for debugging etc.\n+     */\n+    std::string GetName() { return strWalletFile; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105192897",
      "id" : 105192897,
      "original_commit_id" : "757f0a7261c0b23f26aa9cf76eea8e83d9097d7d",
      "original_position" : 25,
      "path" : "src/wallet/db.h",
      "position" : 31,
      "pull_request_review_id" : 26058623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951",
      "updated_at" : "2017-03-09T15:52:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105192897",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1225267?v=3",
         "events_url" : "https://api.github.com/users/benma/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benma/followers",
         "following_url" : "https://api.github.com/users/benma/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benma/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benma",
         "id" : 1225267,
         "login" : "benma",
         "organizations_url" : "https://api.github.com/users/benma/orgs",
         "received_events_url" : "https://api.github.com/users/benma/received_events",
         "repos_url" : "https://api.github.com/users/benma/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benma/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benma/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benma"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105193519"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105193519"
         }
      },
      "body" : "`GetName() const`",
      "commit_id" : "a2bf727b7dedb74606c89e5574ce6376840f6353",
      "created_at" : "2017-03-09T15:40:52Z",
      "diff_hunk" : "@@ -653,17 +653,35 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n      */\n     bool AddWatchOnly(const CScript& dest) override;\n \n+    std::unique_ptr<CWalletDBWrapper> dbw;\n+\n public:\n     /*\n      * Main wallet lock.\n      * This lock protects all the fields added by CWallet\n      *   except for:\n      *      fFileBacked (immutable after instantiation)\n-     *      strWalletFile (immutable after instantiation)\n      */\n     mutable CCriticalSection cs_wallet;\n \n-    const std::string strWalletFile;\n+    /** Get database handle used by this wallet. Ideally this function would\n+     * not be necessary.\n+     */\n+    CWalletDBWrapper *GetDBHandle()\n+    {\n+        return dbw.get();\n+    }\n+\n+    /** Get a name for this wallet for logging/debugging purposes.\n+     */\n+    std::string GetName()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105193519",
      "id" : 105193519,
      "original_commit_id" : "757f0a7261c0b23f26aa9cf76eea8e83d9097d7d",
      "original_position" : 27,
      "path" : "src/wallet/wallet.h",
      "position" : 37,
      "pull_request_review_id" : 26058623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951",
      "updated_at" : "2017-03-09T15:44:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105193519",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1225267?v=3",
         "events_url" : "https://api.github.com/users/benma/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benma/followers",
         "following_url" : "https://api.github.com/users/benma/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benma/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benma",
         "id" : 1225267,
         "login" : "benma",
         "organizations_url" : "https://api.github.com/users/benma/orgs",
         "received_events_url" : "https://api.github.com/users/benma/received_events",
         "repos_url" : "https://api.github.com/users/benma/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benma/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benma/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benma"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105193794"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105193794"
         }
      },
      "body" : "Maybe it is a matter of personal preference, but I always find it odd to put an `else` when the `if` returns.",
      "commit_id" : "a2bf727b7dedb74606c89e5574ce6376840f6353",
      "created_at" : "2017-03-09T15:41:48Z",
      "diff_hunk" : "@@ -653,17 +653,35 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n      */\n     bool AddWatchOnly(const CScript& dest) override;\n \n+    std::unique_ptr<CWalletDBWrapper> dbw;\n+\n public:\n     /*\n      * Main wallet lock.\n      * This lock protects all the fields added by CWallet\n      *   except for:\n      *      fFileBacked (immutable after instantiation)\n-     *      strWalletFile (immutable after instantiation)\n      */\n     mutable CCriticalSection cs_wallet;\n \n-    const std::string strWalletFile;\n+    /** Get database handle used by this wallet. Ideally this function would\n+     * not be necessary.\n+     */\n+    CWalletDBWrapper *GetDBHandle()\n+    {\n+        return dbw.get();\n+    }\n+\n+    /** Get a name for this wallet for logging/debugging purposes.\n+     */\n+    std::string GetName()\n+    {\n+        if (dbw) {\n+            return dbw->GetName();\n+        } else {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105193794",
      "id" : 105193794,
      "original_commit_id" : "757f0a7261c0b23f26aa9cf76eea8e83d9097d7d",
      "original_position" : 31,
      "path" : "src/wallet/wallet.h",
      "position" : 41,
      "pull_request_review_id" : 26058623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951",
      "updated_at" : "2017-03-09T15:44:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105193794",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1225267?v=3",
         "events_url" : "https://api.github.com/users/benma/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benma/followers",
         "following_url" : "https://api.github.com/users/benma/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benma/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benma",
         "id" : 1225267,
         "login" : "benma",
         "organizations_url" : "https://api.github.com/users/benma/orgs",
         "received_events_url" : "https://api.github.com/users/benma/received_events",
         "repos_url" : "https://api.github.com/users/benma/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benma/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benma/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benma"
      }
   }
]
