[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9979#discussion_r109936241"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9979"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/109936241"
         }
      },
      "body" : "an easy way to replicate this without a new boost dep is:\r\n```c++\r\nif (!i->rfind(RPC_ADD_PREFIX_UNIX, 0))\r\n```",
      "commit_id" : "9abf3c9da2c9e8e90b813ee379c7b8ff16a8f550",
      "created_at" : "2017-04-05T14:47:56Z",
      "diff_hunk" : "@@ -331,6 +337,8 @@ static bool HTTPBindAddresses(struct evhttp* http)\n     } else if (mapMultiArgs.count(\"-rpcbind\")) { // Specific bind address\n         const std::vector<std::string>& vbind = mapMultiArgs.at(\"-rpcbind\");\n         for (std::vector<std::string>::const_iterator i = vbind.begin(); i != vbind.end(); ++i) {\n+            if (boost::starts_with(*i, RPC_ADDR_PREFIX_UNIX)) // Skip UNIX sockets here",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9979#discussion_r109936241",
      "id" : 109936241,
      "original_commit_id" : "45fad466d1b25478b384a3535460b6f679b3788c",
      "original_position" : 30,
      "path" : "src/httpserver.cpp",
      "position" : 30,
      "pull_request_review_id" : 31071186,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9979",
      "updated_at" : "2017-04-05T16:19:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/109936241",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9979#discussion_r109937942"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9979"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/109937942"
         }
      },
      "body" : "Might be better to have the ifdef define two different functions HandleUnixSocket.\r\n\r\nI'm always nervous with compiler directives inside functions, unless the code switched is ~1 line. Large ifdefs are in a couple places in this PR.",
      "commit_id" : "9abf3c9da2c9e8e90b813ee379c7b8ff16a8f550",
      "created_at" : "2017-04-05T14:53:38Z",
      "diff_hunk" : "@@ -195,8 +198,35 @@ UniValue CallRPC(const std::string& strMethod, const UniValue& params)\n     // Obtain event base\n     raii_event_base base = obtain_event_base();\n \n-    // Synchronously look up hostname\n-    raii_evhttp_connection evcon = obtain_evhttp_connection_base(base.get(), host, port);\n+    raii_evhttp_connection evcon;\n+    if (boost::starts_with(host, RPC_ADDR_PREFIX_UNIX)) {\n+#if defined(HAVE_SOCKADDR_UN) && defined(LIBEVENT_EXPERIMENTAL)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9979#discussion_r109937942",
      "id" : 109937942,
      "original_commit_id" : "45fad466d1b25478b384a3535460b6f679b3788c",
      "original_position" : 23,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 23,
      "pull_request_review_id" : 31071186,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9979",
      "updated_at" : "2017-04-05T16:19:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/109937942",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9979#discussion_r109944856"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9979"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/109944856"
         }
      },
      "body" : "slight preference for something with ownership guarantees of\r\n\r\n```c++\r\nstd::vector<std::unique_ptr<void>> cleanupUNIXSockets;\r\n// must be non null value\r\ncleanupUNIXSockets.emplace_back(1, [=](void*) { evunix_remove_socket(path); });\r\ncleanupUNIXSockets.clear();\r\n```\r\nso that sockets aren't double removed.\r\n\r\nMaybe wrap the evunix stuff in a class and just keep a vector of those around?",
      "commit_id" : "9abf3c9da2c9e8e90b813ee379c7b8ff16a8f550",
      "created_at" : "2017-04-05T15:18:41Z",
      "diff_hunk" : "@@ -505,6 +547,12 @@ void StopHTTPServer()\n         event_base_free(eventBase);\n         eventBase = 0;\n     }\n+#ifdef HAVE_SOCKADDR_UN\n+    //! Clean up UNIX sockets on shutdown\n+    for (const auto& path: cleanupUNIXSockets) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9979#discussion_r109944856",
      "id" : 109944856,
      "original_commit_id" : "45fad466d1b25478b384a3535460b6f679b3788c",
      "original_position" : 82,
      "path" : "src/httpserver.cpp",
      "position" : 82,
      "pull_request_review_id" : 31071186,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9979",
      "updated_at" : "2017-04-05T16:19:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/109944856",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9979#discussion_r109948645"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9979"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/109948645"
         }
      },
      "body" : "recommend comment language (took me a minute to understand your comment because of ambiguity on here and that):\r\n\r\nWe will get an address of localhost either via a unix socket or via a localhost peer. There is no sane way to return an address for a socket, so we always return localhost's IPv6.",
      "commit_id" : "9abf3c9da2c9e8e90b813ee379c7b8ff16a8f550",
      "created_at" : "2017-04-05T15:31:02Z",
      "diff_hunk" : "@@ -619,6 +667,12 @@ CService HTTPRequest::GetPeer()\n         const char* address = \"\";\n         uint16_t port = 0;\n         evhttp_connection_get_peer(con, (char**)&address, &port);\n+        if (!strcmp(address, \"localhost\")) {\n+            /* Special: will get here for UNIX sockets. As we have no way to indicate that,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9979#discussion_r109948645",
      "id" : 109948645,
      "original_commit_id" : "45fad466d1b25478b384a3535460b6f679b3788c",
      "original_position" : 94,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_review_id" : 31071186,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9979",
      "updated_at" : "2017-04-05T16:19:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/109948645",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   }
]
