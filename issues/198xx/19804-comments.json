[
   {
      "author_association" : "MEMBER",
      "body" : "Heh, this one might be controversial. In theory it shouldn't be confusing if there is only exactly one p2p connection. If this pull gets Concept ACKs, that is fine. If not, it might be good to replace the `assert self.p2ps` with `assert len(self.p2ps)==1`.",
      "created_at" : "2020-08-25T17:45:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19804#issuecomment-680174958",
      "id" : 680174958,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19804",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4MDE3NDk1OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-25T17:45:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/680174958",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke indeed. [You put this idea in my head](https://github.com/bitcoin/bitcoin/pull/19252#issuecomment-644442680) ð but `assert len == 1` is a good way too. I don't see any advantages to having this though.",
      "created_at" : "2020-08-25T17:51:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19804#issuecomment-680177633",
      "id" : 680177633,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19804",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4MDE3NzYzMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-25T17:51:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/680177633",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/gzhao408/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gzhao408/followers",
         "following_url" : "https://api.github.com/users/gzhao408/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gzhao408/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gzhao408",
         "id" : 25183001,
         "login" : "gzhao408",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/gzhao408/orgs",
         "received_events_url" : "https://api.github.com/users/gzhao408/received_events",
         "repos_url" : "https://api.github.com/users/gzhao408/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gzhao408/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gzhao408/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gzhao408"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yes, I remember that. It looks like that was in reply to a performance bottleneck. Is that still observable?",
      "created_at" : "2020-08-25T18:16:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19804#issuecomment-680190467",
      "id" : 680190467,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19804",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4MDE5MDQ2Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-25T18:16:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/680190467",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke I think the performance problems were addressed elsewhere [(comment)](https://github.com/bitcoin/bitcoin/pull/19252#issuecomment-644530432). We were talking about p2p_invalid_messages.py which has a lot of subtests that needed to wait for `disconnect_p2ps` before moving on.",
      "created_at" : "2020-08-25T19:01:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19804#issuecomment-680212829",
      "id" : 680212829,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19804",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4MDIxMjgyOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-25T19:01:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/680212829",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/gzhao408/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gzhao408/followers",
         "following_url" : "https://api.github.com/users/gzhao408/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gzhao408/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gzhao408",
         "id" : 25183001,
         "login" : "gzhao408",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/gzhao408/orgs",
         "received_events_url" : "https://api.github.com/users/gzhao408/received_events",
         "repos_url" : "https://api.github.com/users/gzhao408/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gzhao408/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gzhao408/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gzhao408"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19801 (test: check for all possible OP_CLTV fail reasons in feature_cltv.py (BIP 65) by theStack)\n* #19760 (test: Remove confusing mininode terminology by jnewbery)\n* #19752 (test: Update wait_until usage in tests not to use the one from utils by slmtpz)\n* #19393 (test: Add more tests for orphan tx handling by hebasto)\n* #19315 ([tests] Allow outbound & block-relay-only connections in functional tests. by amitiuttarwar)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-08-26T01:12:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19804#issuecomment-680401982",
      "id" : 680401982,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19804",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4MDQwMTk4Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-26T01:12:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/680401982",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-08-26T09:01:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19804#issuecomment-680754468",
      "id" : 680754468,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19804",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4MDc1NDQ2OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-26T09:01:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/680754468",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\nI agree that the `p2p` property can be quite confusing, as it is a bit too much of \"implicit magic\" going on.\r\n```\r\nnode.add_p2p_connection(P2PInterface())\r\nnode.p2p.do_something_fancy()\r\n```\r\nis less clear than the explicit\r\n```\r\np2p_conn = node.add_p2p_connection(P2PInterface())\r\np2p_conn.do_something_fancy()\r\n```\r\nin terms of readability, in my opinion. Generally, if you have a function to create an object, the handle returned by that function should be the preferred way to access that object, and not some other implicit way. (`.p2ps[0]` suffers from the same problem, but at least it is more obvious that it is the _first_ connection.)\r\n\r\nThat said, I also agree to MarcoFalke that this might be controversial... if it doesn't get enough Concept ACKs, I'm also happy to ACK the variant with `assert len(self.p2ps)==1` in the p2p property.",
      "created_at" : "2020-08-28T10:39:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19804#issuecomment-682455956",
      "id" : 682455956,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19804",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4MjQ1NTk1Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-28T10:39:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/682455956",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks for Concept ACK @theStack! \r\n\r\nAgreed that's more clear, I could also just apply the explicit `p2p_conn = node.add_p2p_connection(...)` to all the places where `p2p` is used (just couldn't be a scripted-diff).\r\n\r\nI'll wait for more people to weigh in :)",
      "created_at" : "2020-08-28T15:50:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19804#issuecomment-682753036",
      "id" : 682753036,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19804",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4Mjc1MzAzNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-28T15:50:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/682753036",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/gzhao408/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gzhao408/followers",
         "following_url" : "https://api.github.com/users/gzhao408/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gzhao408/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gzhao408",
         "id" : 25183001,
         "login" : "gzhao408",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/gzhao408/orgs",
         "received_events_url" : "https://api.github.com/users/gzhao408/received_events",
         "repos_url" : "https://api.github.com/users/gzhao408/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gzhao408/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gzhao408/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gzhao408"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Yes, agreed that this seems controversial :) there was even discussion of this in the original PR: https://github.com/bitcoin/bitcoin/pull/11182#issuecomment-331467540\r\n\r\nI don't have a strong preference for `p2p` vs `p2ps[0]`. I have a mild preference for not reversing an existing style decision without new information. Maybe you can see if the original author says \"I regret my decision to introduce the `p2p` property; let's change it\"? :)\r\n\r\nBut I'm definitely in favor of `assert len(self.p2ps) == 1` to avoid incorrect/confusing use of the `p2p` property!",
      "created_at" : "2020-09-01T06:25:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19804#issuecomment-684437371",
      "id" : 684437371,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19804",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDQzNzM3MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-01T06:25:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684437371",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4276679?v=4",
         "events_url" : "https://api.github.com/users/robot-dreams/events{/privacy}",
         "followers_url" : "https://api.github.com/users/robot-dreams/followers",
         "following_url" : "https://api.github.com/users/robot-dreams/following{/other_user}",
         "gists_url" : "https://api.github.com/users/robot-dreams/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/robot-dreams",
         "id" : 4276679,
         "login" : "robot-dreams",
         "node_id" : "MDQ6VXNlcjQyNzY2Nzk=",
         "organizations_url" : "https://api.github.com/users/robot-dreams/orgs",
         "received_events_url" : "https://api.github.com/users/robot-dreams/received_events",
         "repos_url" : "https://api.github.com/users/robot-dreams/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/robot-dreams/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/robot-dreams/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/robot-dreams"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "That is true, I should have asked - @jnewbery how do you feel about this?",
      "created_at" : "2020-09-01T11:45:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19804#issuecomment-684792137",
      "id" : 684792137,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19804",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDc5MjEzNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-01T11:45:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684792137",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/gzhao408/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gzhao408/followers",
         "following_url" : "https://api.github.com/users/gzhao408/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gzhao408/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gzhao408",
         "id" : 25183001,
         "login" : "gzhao408",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/gzhao408/orgs",
         "received_events_url" : "https://api.github.com/users/gzhao408/received_events",
         "repos_url" : "https://api.github.com/users/gzhao408/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gzhao408/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gzhao408/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gzhao408"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> @jnewbery how do you feel about this?\r\n\r\nI can see how `TestNode.p2p` could introduce subtle bugs if tests get extended and the wrong connection is used by mistake, so we should either remove the property or add an assert when it gets used.\r\n\r\nThe approach in this PR (removing the property entirely) seems fine to me. Concept ACK.",
      "created_at" : "2020-09-01T13:35:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19804#issuecomment-684858325",
      "id" : 684858325,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19804",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDg1ODMyNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-01T13:35:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684858325",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
