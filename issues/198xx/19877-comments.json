[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19877#discussion_r483977328"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19877"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483977328"
         }
      },
      "author_association" : "NONE",
      "body" : "Why did you move `test_getpeerinfo` function declaration 75 lines upwards if you haven't modified it? It just creates unnecessary diffs for your commit.",
      "commit_id" : "9bd90db7e97cbc3f34d6f6da8097305325af0420",
      "created_at" : "2020-09-05T18:48:12Z",
      "diff_hunk" : "@@ -69,6 +72,30 @@ def test_connection_count(self):\n         # After using `connect_nodes` to connect nodes 0 and 1 to each other.\n         assert_equal(self.nodes[0].getconnectioncount(), 2)\n \n+    def test_getpeerinfo(self):\n+        self.log.info(\"Test getpeerinfo\")\n+        # Create a few getpeerinfo last_block/last_transaction values.\n+        if self.is_wallet_compiled():\n+            self.nodes[0].sendtoaddress(self.nodes[1].getnewaddress(), 1)\n+        self.nodes[1].generate(1)\n+        self.sync_all()\n+        time_now = int(time.time())\n+        peer_info = [x.getpeerinfo() for x in self.nodes]\n+        # Verify last_block and last_transaction keys/values.\n+        for node, peer, field in product(range(self.num_nodes), range(2), ['last_block', 'last_transaction']):\n+            assert field in peer_info[node][peer].keys()\n+            if peer_info[node][peer][field] != 0:\n+                assert_approx(peer_info[node][peer][field], time_now, vspan=60)\n+        # check both sides of bidirectional connection between nodes\n+        # the address bound to on one side will be the source address for the other node\n+        assert_equal(peer_info[0][0]['addrbind'], peer_info[1][0]['addr'])\n+        assert_equal(peer_info[1][0]['addrbind'], peer_info[0][0]['addr'])\n+        assert_equal(peer_info[0][0]['minfeefilter'], Decimal(\"0.00000500\"))\n+        assert_equal(peer_info[1][0]['minfeefilter'], Decimal(\"0.00001000\"))\n+        # check the `servicesnames` field\n+        for info in peer_info:\n+            assert_net_servicesnames(int(info[0][\"services\"], 0x10), info[0][\"servicesnames\"])\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19877#discussion_r483977328",
      "id" : 483977328,
      "line" : 98,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk3NzMyOA==",
      "original_commit_id" : "9bd90db7e97cbc3f34d6f6da8097305325af0420",
      "original_line" : 98,
      "original_position" : 42,
      "original_start_line" : 75,
      "path" : "test/functional/rpc_net.py",
      "position" : 42,
      "pull_request_review_id" : 483072459,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19877",
      "side" : "RIGHT",
      "start_line" : 75,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-05T18:48:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483977328",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/9049790?v=4",
         "events_url" : "https://api.github.com/users/ipriver/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ipriver/followers",
         "following_url" : "https://api.github.com/users/ipriver/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ipriver/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ipriver",
         "id" : 9049790,
         "login" : "ipriver",
         "node_id" : "MDQ6VXNlcjkwNDk3OTA=",
         "organizations_url" : "https://api.github.com/users/ipriver/orgs",
         "received_events_url" : "https://api.github.com/users/ipriver/received_events",
         "repos_url" : "https://api.github.com/users/ipriver/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ipriver/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ipriver/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ipriver"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19877#discussion_r483984051"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19877"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483984051"
         }
      },
      "author_association" : "NONE",
      "body" : "Yeah, reasonable question!\r\n\r\n- If you review one commit at a time, it's clearer to see what's going on (there's a move-only commit followed by a small functionality change)\r\n- The commit message explains why this function was moved: \"Match test order with run order\"",
      "commit_id" : "9bd90db7e97cbc3f34d6f6da8097305325af0420",
      "created_at" : "2020-09-05T20:11:33Z",
      "diff_hunk" : "@@ -69,6 +72,30 @@ def test_connection_count(self):\n         # After using `connect_nodes` to connect nodes 0 and 1 to each other.\n         assert_equal(self.nodes[0].getconnectioncount(), 2)\n \n+    def test_getpeerinfo(self):\n+        self.log.info(\"Test getpeerinfo\")\n+        # Create a few getpeerinfo last_block/last_transaction values.\n+        if self.is_wallet_compiled():\n+            self.nodes[0].sendtoaddress(self.nodes[1].getnewaddress(), 1)\n+        self.nodes[1].generate(1)\n+        self.sync_all()\n+        time_now = int(time.time())\n+        peer_info = [x.getpeerinfo() for x in self.nodes]\n+        # Verify last_block and last_transaction keys/values.\n+        for node, peer, field in product(range(self.num_nodes), range(2), ['last_block', 'last_transaction']):\n+            assert field in peer_info[node][peer].keys()\n+            if peer_info[node][peer][field] != 0:\n+                assert_approx(peer_info[node][peer][field], time_now, vspan=60)\n+        # check both sides of bidirectional connection between nodes\n+        # the address bound to on one side will be the source address for the other node\n+        assert_equal(peer_info[0][0]['addrbind'], peer_info[1][0]['addr'])\n+        assert_equal(peer_info[1][0]['addrbind'], peer_info[0][0]['addr'])\n+        assert_equal(peer_info[0][0]['minfeefilter'], Decimal(\"0.00000500\"))\n+        assert_equal(peer_info[1][0]['minfeefilter'], Decimal(\"0.00001000\"))\n+        # check the `servicesnames` field\n+        for info in peer_info:\n+            assert_net_servicesnames(int(info[0][\"services\"], 0x10), info[0][\"servicesnames\"])\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19877#discussion_r483984051",
      "id" : 483984051,
      "in_reply_to_id" : 483977328,
      "line" : 98,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk4NDA1MQ==",
      "original_commit_id" : "9bd90db7e97cbc3f34d6f6da8097305325af0420",
      "original_line" : 98,
      "original_position" : 42,
      "original_start_line" : 75,
      "path" : "test/functional/rpc_net.py",
      "position" : 42,
      "pull_request_review_id" : 483076443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19877",
      "side" : "RIGHT",
      "start_line" : 75,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-05T20:11:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483984051",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4276679?v=4",
         "events_url" : "https://api.github.com/users/robot-dreams/events{/privacy}",
         "followers_url" : "https://api.github.com/users/robot-dreams/followers",
         "following_url" : "https://api.github.com/users/robot-dreams/following{/other_user}",
         "gists_url" : "https://api.github.com/users/robot-dreams/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/robot-dreams",
         "id" : 4276679,
         "login" : "robot-dreams",
         "node_id" : "MDQ6VXNlcjQyNzY2Nzk=",
         "organizations_url" : "https://api.github.com/users/robot-dreams/orgs",
         "received_events_url" : "https://api.github.com/users/robot-dreams/received_events",
         "repos_url" : "https://api.github.com/users/robot-dreams/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/robot-dreams/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/robot-dreams/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/robot-dreams"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Concept ACK, thanks for clarifying! After trying to trace the code, I agree with you that `addnode` should add connections in both directions.\r\n\r\n- Would it also make sense to change the \"Connect nodes both ways\" on line 147 below?\r\n- The `wait_for_helper` calls in the `connect_nodes` implementation wait until the node has received a version and a verack. However, it doesn't wait until the **peer** has received a verack. Could this introduce some sort of extremely rare race condition?",
      "created_at" : "2020-09-05T20:15:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19877#issuecomment-687657879",
      "id" : 687657879,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19877",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NzY1Nzg3OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-05T20:15:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687657879",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4276679?v=4",
         "events_url" : "https://api.github.com/users/robot-dreams/events{/privacy}",
         "followers_url" : "https://api.github.com/users/robot-dreams/followers",
         "following_url" : "https://api.github.com/users/robot-dreams/following{/other_user}",
         "gists_url" : "https://api.github.com/users/robot-dreams/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/robot-dreams",
         "id" : 4276679,
         "login" : "robot-dreams",
         "node_id" : "MDQ6VXNlcjQyNzY2Nzk=",
         "organizations_url" : "https://api.github.com/users/robot-dreams/orgs",
         "received_events_url" : "https://api.github.com/users/robot-dreams/received_events",
         "repos_url" : "https://api.github.com/users/robot-dreams/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/robot-dreams/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/robot-dreams/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/robot-dreams"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19877#discussion_r483985934"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19877"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483985934"
         }
      },
      "author_association" : "NONE",
      "body" : "@robot-dreams Agree, I missed the second commit and its title that describes this change. :blush:",
      "commit_id" : "9bd90db7e97cbc3f34d6f6da8097305325af0420",
      "created_at" : "2020-09-05T20:37:05Z",
      "diff_hunk" : "@@ -69,6 +72,30 @@ def test_connection_count(self):\n         # After using `connect_nodes` to connect nodes 0 and 1 to each other.\n         assert_equal(self.nodes[0].getconnectioncount(), 2)\n \n+    def test_getpeerinfo(self):\n+        self.log.info(\"Test getpeerinfo\")\n+        # Create a few getpeerinfo last_block/last_transaction values.\n+        if self.is_wallet_compiled():\n+            self.nodes[0].sendtoaddress(self.nodes[1].getnewaddress(), 1)\n+        self.nodes[1].generate(1)\n+        self.sync_all()\n+        time_now = int(time.time())\n+        peer_info = [x.getpeerinfo() for x in self.nodes]\n+        # Verify last_block and last_transaction keys/values.\n+        for node, peer, field in product(range(self.num_nodes), range(2), ['last_block', 'last_transaction']):\n+            assert field in peer_info[node][peer].keys()\n+            if peer_info[node][peer][field] != 0:\n+                assert_approx(peer_info[node][peer][field], time_now, vspan=60)\n+        # check both sides of bidirectional connection between nodes\n+        # the address bound to on one side will be the source address for the other node\n+        assert_equal(peer_info[0][0]['addrbind'], peer_info[1][0]['addr'])\n+        assert_equal(peer_info[1][0]['addrbind'], peer_info[0][0]['addr'])\n+        assert_equal(peer_info[0][0]['minfeefilter'], Decimal(\"0.00000500\"))\n+        assert_equal(peer_info[1][0]['minfeefilter'], Decimal(\"0.00001000\"))\n+        # check the `servicesnames` field\n+        for info in peer_info:\n+            assert_net_servicesnames(int(info[0][\"services\"], 0x10), info[0][\"servicesnames\"])\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19877#discussion_r483985934",
      "id" : 483985934,
      "in_reply_to_id" : 483977328,
      "line" : 98,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk4NTkzNA==",
      "original_commit_id" : "9bd90db7e97cbc3f34d6f6da8097305325af0420",
      "original_line" : 98,
      "original_position" : 42,
      "original_start_line" : 75,
      "path" : "test/functional/rpc_net.py",
      "position" : 42,
      "pull_request_review_id" : 483077530,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19877",
      "side" : "RIGHT",
      "start_line" : 75,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-05T20:37:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483985934",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/9049790?v=4",
         "events_url" : "https://api.github.com/users/ipriver/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ipriver/followers",
         "following_url" : "https://api.github.com/users/ipriver/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ipriver/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ipriver",
         "id" : 9049790,
         "login" : "ipriver",
         "node_id" : "MDQ6VXNlcjkwNDk3OTA=",
         "organizations_url" : "https://api.github.com/users/ipriver/orgs",
         "received_events_url" : "https://api.github.com/users/ipriver/received_events",
         "repos_url" : "https://api.github.com/users/ipriver/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ipriver/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ipriver/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ipriver"
      }
   }
]
