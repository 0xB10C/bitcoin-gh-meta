[
   {
      "author_association" : "NONE",
      "body" : "Welp, I did crazy thing and launched `bitcoind` as root, with:\r\n```\r\nsudo src/bitcoind -regtest -walletdir=/ -datadir=/tmp/datadir -server\r\n```\r\nCreated wallet, and then listed:\r\n```\r\n{\r\n  \"wallets\": [\r\n    {\r\n      \"name\": \"est\"\r\n    },\r\n    {\r\n      \"name\": \"ome/vincas/.bitcoin/regtest/wallets\"\r\n    },\r\n    {\r\n      \"name\": \"ome/vincas/code/eclair/eclair_recovery_tool.git/eclair-core/target/integration-8198c6f7-2f0b-4394-a92a-d4d738994f33/datadir-bitcoin/regtest/wallets\"\r\n    },\r\n    {\r\n      \"name\": \"ome/vincas/code/eclair/eclair_recovery_tool.git/eclair-core/target/integration-9063e6a5-c013-4127-a7dd-a10a3874ed18/datadir-bitcoin/regtest/wallets\"\r\n    },\r\n    {\r\n      \"name\": \"ome/vincas/code/eclair/eclair_recovery_tool.git/eclair-core/target/integration-e9783f5b-51ab-458f-ab57-31976e38bff8/datadir-bitcoin/regtest/wallets\"\r\n    },\r\n    {\r\n      \"name\": \"ome/vincas/code/eclair/eclair_recovery_tool.git/eclair-core/target/integration-f1c34eba-d63e-4379-a315-75056bbcc162/datadir-bitcoin/regtest/wallets\"\r\n    },\r\n    {\r\n      \"name\": \"ome/vincas/code/eclair/eclair_recovery_tool.git/eclair-core/target/integration-d4096df3-5adb-40dd-9425-6f80fb6fd07b/datadir-bitcoin/regtest/wallets\"\r\n    },\r\n    {\r\n      \"name\": \"ome/vincas/code/eclair/eclair_recovery_tool.git/eclair-core/target/integration-e6a27da9-a78e-48a5-a272-38a950ddfd41/datadir-bitcoin/regtest/wallets\"\r\n    },\r\n    {\r\n      \"name\": \"ome/vincas/code/bitcoin/123-bitcoin-core-gui.git/test/functional/data/wallets/high_minversion\"\r\n    },\r\n    {\r\n      \"name\": \"ome/vincas/code/bitcoin/149-bitcoin-core-gui.git/test/functional/data/wallets/high_minversion\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nInteresting to see `bitcoind` scan whole system for wallets :D (log even printed `ListDatabases: Error scanning /sys/fs/bpf: boost::filesystem::status: Operation not permitted: \"/sys/fs/bpf/wallet.dat\"`).\r\n\r\nAnyhow, issue is the same on Linux, and this PR did fix that too:\r\n```\r\n{\r\n  \"wallets\": [\r\n    {\r\n      \"name\": \"test\"\r\n    },\r\n...same...\r\n```\r\n",
      "created_at" : "2021-05-13T18:34:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21944#issuecomment-840750672",
      "id" : 840750672,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21944",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0MDc1MDY3Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-13T18:34:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840750672",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/292191?v=4",
         "events_url" : "https://api.github.com/users/Talkless/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Talkless/followers",
         "following_url" : "https://api.github.com/users/Talkless/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Talkless/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Talkless",
         "id" : 292191,
         "login" : "Talkless",
         "node_id" : "MDQ6VXNlcjI5MjE5MQ==",
         "organizations_url" : "https://api.github.com/users/Talkless/orgs",
         "received_events_url" : "https://api.github.com/users/Talkless/received_events",
         "repos_url" : "https://api.github.com/users/Talkless/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Talkless/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Talkless/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Talkless"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21944#discussion_r632029229"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21944"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632029229"
         }
      },
      "author_association" : "NONE",
      "body" : "You could still keep `path` const as before, by utilizing immediately-invoked lambda, as suggested in [ES.28: Use lambdas for complex initialization, especially of const variables](https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-lambda-init) guideline, with something like this (also avoiding re-initializing `path` variable):\r\n\r\n```\r\n            const fs::path path = [&wallet_dir, &it, offset]() {\r\n\r\n                if (wallet_dir == wallet_dir.root_path()) {\r\n                   return it->path().string().substr(offset - 1);\r\n                }\r\n\r\n                return it->path().string().substr(offset);\r\n            }();\r\n```\r\nNot sure if this is the best way to do that overall, as I don't have basically any experience with boost/stl filesystem...",
      "commit_id" : "48a73833c27608b3302f0537bdbfbfb23e725c4e",
      "created_at" : "2021-05-13T18:50:09Z",
      "diff_hunk" : "@@ -25,7 +25,13 @@ std::vector<fs::path> ListDatabases(const fs::path& wallet_dir)\n         try {\n             // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n             // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n-            const fs::path path = it->path().string().substr(offset);\n+            fs::path path = wallet_dir.string();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21944#discussion_r632029229",
      "id" : 632029229,
      "line" : 28,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjAyOTIyOQ==",
      "original_commit_id" : "48a73833c27608b3302f0537bdbfbfb23e725c4e",
      "original_line" : 28,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : 5,
      "pull_request_review_id" : 659201602,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21944",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-13T18:50:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632029229",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/292191?v=4",
         "events_url" : "https://api.github.com/users/Talkless/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Talkless/followers",
         "following_url" : "https://api.github.com/users/Talkless/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Talkless/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Talkless",
         "id" : 292191,
         "login" : "Talkless",
         "node_id" : "MDQ6VXNlcjI5MjE5MQ==",
         "organizations_url" : "https://api.github.com/users/Talkless/orgs",
         "received_events_url" : "https://api.github.com/users/Talkless/received_events",
         "repos_url" : "https://api.github.com/users/Talkless/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Talkless/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Talkless/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Talkless"
      }
   }
]
