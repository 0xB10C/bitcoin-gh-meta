[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK on burying taproot deployment in the next major release :grimacing: ",
      "created_at" : "2021-11-17T15:22:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-971685204",
      "id" : 971685204,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII58456r1U",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/971685204/reactions"
      },
      "updated_at" : "2021-11-17T15:23:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/971685204",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "concept ACK -- note that the IsNull v.s. optional doesn't really matter; i do mildly prefer consistency though with the BIP16Exception.",
      "created_at" : "2021-11-17T16:04:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-971723797",
      "id" : 971723797,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII584561QV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/971723797/reactions"
      },
      "updated_at" : "2021-11-17T16:04:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/971723797",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "created_at" : "2021-11-18T02:51:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-972467628",
      "id" : 972467628,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII58459q2s",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/972467628/reactions"
      },
      "updated_at" : "2021-11-30T16:01:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/972467628",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Not sure what the right amount of PoW is to burry this under. How much was SegWit burried under?",
      "created_at" : "2021-11-18T12:50:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-972836744",
      "id" : 972836744,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5845_E-I",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/972836744/reactions"
      },
      "updated_at" : "2021-11-18T12:50:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/972836744",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sjors Segwit was activated in ~summer 2017 and https://github.com/bitcoin/bitcoin/pull/11739 was created in ~fall 2017, however it wasn't merged until April 2018, and first included in the 17.0 release (Oct 2018). If it was merged earlier it could have been included in 16.0 (Feb 2018). If the changes here are included in the next major release, they will have ~5 months of POW until 23.0 (April 2022).",
      "created_at" : "2021-11-18T13:48:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-972881871",
      "id" : 972881871,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5845_P_P",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/972881871/reactions"
      },
      "updated_at" : "2021-11-18T13:48:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/972881871",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r752578924"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/752578924"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can just be `!consensusparams.TaprootException` (https://en.cppreference.com/w/cpp/utility/optional/operator_bool).",
      "commit_id" : "fa75e6e79a1635480786a8a001d2ebff07e8bc8d",
      "created_at" : "2021-11-18T19:53:39Z",
      "diff_hunk" : "@@ -1595,6 +1595,13 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex* pindex, const Consens\n     {\n         // Enforce WITNESS rules whenever P2SH is in effect\n         flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS;\n+        // Enforce Taproot (BIP340-BIP342) whenever WITNESS is in effect,\n+        // unless except\n+        if (!consensusparams.TaprootException.has_value() ||          // no Taproot exception on this chain",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r752578924",
      "id" : 752578924,
      "line" : 1600,
      "node_id" : "PRRC_kwDOABII584s23Fs",
      "original_commit_id" : "fa75e6e79a1635480786a8a001d2ebff07e8bc8d",
      "original_line" : 1600,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 6,
      "pull_request_review_id" : 810389033,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/752578924/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-18T19:53:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/752578924",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, for consistency with previous soft fork deployments and the benefits well articulated in the PR description.",
      "created_at" : "2021-11-18T19:55:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-973209664",
      "id" : 973209664,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5846AgBA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/973209664/reactions"
      },
      "updated_at" : "2021-11-18T19:55:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/973209664",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\n\r\nRunning verification since genesis now.",
      "created_at" : "2021-11-21T17:30:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-974860471",
      "id" : 974860471,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5846GzC3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/974860471/reactions"
      },
      "updated_at" : "2021-11-21T17:30:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/974860471",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3072149?v=4",
         "events_url" : "https://api.github.com/users/dunxen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dunxen/followers",
         "following_url" : "https://api.github.com/users/dunxen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dunxen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dunxen",
         "id" : 3072149,
         "login" : "dunxen",
         "node_id" : "MDQ6VXNlcjMwNzIxNDk=",
         "organizations_url" : "https://api.github.com/users/dunxen/orgs",
         "received_events_url" : "https://api.github.com/users/dunxen/received_events",
         "repos_url" : "https://api.github.com/users/dunxen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dunxen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dunxen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dunxen"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r754213377"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754213377"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Needs to drop \"regardless of validity\" (except for scriptpath_invalid_unkleaf)",
      "commit_id" : "fa75e6e79a1635480786a8a001d2ebff07e8bc8d",
      "created_at" : "2021-11-22T12:13:12Z",
      "diff_hunk" : "@@ -1171,13 +1171,9 @@ def spenders_taproot_inactive():\n \n     # Test that keypath spending is valid & non-standard, regardless of validity.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r754213377",
      "id" : 754213377,
      "line" : 1172,
      "node_id" : "PRRC_kwDOABII584s9GIB",
      "original_commit_id" : "fa75e6e79a1635480786a8a001d2ebff07e8bc8d",
      "original_line" : 1172,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "test/functional/feature_taproot.py",
      "position" : 2,
      "pull_request_review_id" : 812456488,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754213377/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-22T14:03:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754213377",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r754329694"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754329694"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good point. I'll fix the comment on the next force push with any other nits, if there are any. The force push is currently scheduled to happen after #23512 is merged.",
      "commit_id" : "fa75e6e79a1635480786a8a001d2ebff07e8bc8d",
      "created_at" : "2021-11-22T14:28:53Z",
      "diff_hunk" : "@@ -1171,13 +1171,9 @@ def spenders_taproot_inactive():\n \n     # Test that keypath spending is valid & non-standard, regardless of validity.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r754329694",
      "id" : 754329694,
      "in_reply_to_id" : 754213377,
      "line" : 1172,
      "node_id" : "PRRC_kwDOABII584s9ihe",
      "original_commit_id" : "fa75e6e79a1635480786a8a001d2ebff07e8bc8d",
      "original_line" : 1172,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "test/functional/feature_taproot.py",
      "position" : 2,
      "pull_request_review_id" : 812604663,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754329694/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-22T14:28:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754329694",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r754329775"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754329775"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there a reason to prefer one over the other?",
      "commit_id" : "fa75e6e79a1635480786a8a001d2ebff07e8bc8d",
      "created_at" : "2021-11-22T14:28:59Z",
      "diff_hunk" : "@@ -1595,6 +1595,13 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex* pindex, const Consens\n     {\n         // Enforce WITNESS rules whenever P2SH is in effect\n         flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS;\n+        // Enforce Taproot (BIP340-BIP342) whenever WITNESS is in effect,\n+        // unless except\n+        if (!consensusparams.TaprootException.has_value() ||          // no Taproot exception on this chain",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r754329775",
      "id" : 754329775,
      "in_reply_to_id" : 752578924,
      "line" : 1600,
      "node_id" : "PRRC_kwDOABII584s9iiv",
      "original_commit_id" : "fa75e6e79a1635480786a8a001d2ebff07e8bc8d",
      "original_line" : 1600,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 6,
      "pull_request_review_id" : 812604786,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754329775/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-22T14:28:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/754329775",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-11-25T07:41:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-978914492",
      "id" : 978914492,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5846WQy8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/978914492/reactions"
      },
      "updated_at" : "2021-11-25T07:41:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/978914492",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r756766033"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756766033"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Gone",
      "commit_id" : "fa386f6a27968cce94b03a8c5317dbc1c6707ffb",
      "created_at" : "2021-11-25T10:34:19Z",
      "diff_hunk" : "@@ -1595,6 +1595,13 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex* pindex, const Consens\n     {\n         // Enforce WITNESS rules whenever P2SH is in effect\n         flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS;\n+        // Enforce Taproot (BIP340-BIP342) whenever WITNESS is in effect,\n+        // unless except\n+        if (!consensusparams.TaprootException.has_value() ||          // no Taproot exception on this chain",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r756766033",
      "id" : 756766033,
      "in_reply_to_id" : 752578924,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tG1VR",
      "original_commit_id" : "fa75e6e79a1635480786a8a001d2ebff07e8bc8d",
      "original_line" : 1600,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 815820156,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756766033/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-25T10:34:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756766033",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r756766215"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756766215"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Reworked test",
      "commit_id" : "fa386f6a27968cce94b03a8c5317dbc1c6707ffb",
      "created_at" : "2021-11-25T10:34:32Z",
      "diff_hunk" : "@@ -1171,13 +1171,9 @@ def spenders_taproot_inactive():\n \n     # Test that keypath spending is valid & non-standard, regardless of validity.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r756766215",
      "id" : 756766215,
      "in_reply_to_id" : 754213377,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tG1YH",
      "original_commit_id" : "fa75e6e79a1635480786a8a001d2ebff07e8bc8d",
      "original_line" : 1172,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "test/functional/feature_taproot.py",
      "position" : null,
      "pull_request_review_id" : 815820416,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756766215/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-25T10:34:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756766215",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased with the following changes:\r\n\r\n* Two refactoring cleanup commits per myself\r\n* Use plain `uint256` (not optional) per @JeremyRubin \r\n* Rework test per @Sjors ",
      "created_at" : "2021-11-25T10:36:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-979077116",
      "id" : 979077116,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5846W4f8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/979077116/reactions"
      },
      "updated_at" : "2021-11-25T10:36:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/979077116",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r757058717"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757058717"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit",
      "commit_id" : "fa386f6a27968cce94b03a8c5317dbc1c6707ffb",
      "created_at" : "2021-11-25T17:29:33Z",
      "diff_hunk" : "@@ -7,6 +7,7 @@\n #define BITCOIN_CONSENSUS_PARAMS_H\n \n #include <uint256.h>\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r757058717",
      "id" : 757058717,
      "line" : 10,
      "node_id" : "PRRC_kwDOABII584tH8yd",
      "original_commit_id" : "fa386f6a27968cce94b03a8c5317dbc1c6707ffb",
      "original_line" : 10,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 4,
      "pull_request_review_id" : 816212023,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757058717/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-25T17:29:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757058717",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r757060366"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757060366"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, there should be a newline between project-internal includes and project-external ones.",
      "commit_id" : "fa386f6a27968cce94b03a8c5317dbc1c6707ffb",
      "created_at" : "2021-11-25T17:33:22Z",
      "diff_hunk" : "@@ -7,6 +7,7 @@\n #define BITCOIN_CONSENSUS_PARAMS_H\n \n #include <uint256.h>\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r757060366",
      "id" : 757060366,
      "in_reply_to_id" : 757058717,
      "line" : 10,
      "node_id" : "PRRC_kwDOABII584tH9MO",
      "original_commit_id" : "fa386f6a27968cce94b03a8c5317dbc1c6707ffb",
      "original_line" : 10,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 4,
      "pull_request_review_id" : 816214077,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757060366/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-25T17:33:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757060366",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "if tests pass this should be OK, but the removal of the nullptr check and change to assert does seem a bit creepy to me.",
      "created_at" : "2021-11-25T17:34:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-979378315",
      "id" : 979378315,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5846YCCL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/979378315/reactions"
      },
      "updated_at" : "2021-11-25T17:34:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/979378315",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-11-25T17:35:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-979379020",
      "id" : 979379020,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5846YCNM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/979379020/reactions"
      },
      "updated_at" : "2021-11-25T17:35:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/979379020",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11212268?v=4",
         "events_url" : "https://api.github.com/users/gruve-p/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gruve-p/followers",
         "following_url" : "https://api.github.com/users/gruve-p/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gruve-p/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gruve-p",
         "id" : 11212268,
         "login" : "gruve-p",
         "node_id" : "MDQ6VXNlcjExMjEyMjY4",
         "organizations_url" : "https://api.github.com/users/gruve-p/orgs",
         "received_events_url" : "https://api.github.com/users/gruve-p/received_events",
         "repos_url" : "https://api.github.com/users/gruve-p/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gruve-p/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gruve-p/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gruve-p"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> if tests pass this should be OK, but the removal of the nullptr check and change to assert does seem a bit creepy to me.\r\n\r\nCan you elaborate why this is creepy? All call sites assume the hash to be existing. See the commit message and for example:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/fa65b65821add01e28118899d4f2eef98aa4c37a/src/validation.cpp#L1643",
      "created_at" : "2021-11-25T17:40:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-979381311",
      "id" : 979381311,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5846YCw_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/979381311/reactions"
      },
      "updated_at" : "2021-11-25T17:40:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/979381311",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK and light Code Review ACK\r\n\r\nI will do some testing in the next days.",
      "created_at" : "2021-11-27T17:05:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-980713841",
      "id" : 980713841,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5846dIFx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/980713841/reactions"
      },
      "updated_at" : "2021-11-27T17:05:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/980713841",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r759421087"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759421087"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Force pushed to remove the nit-fix, since it is being fixed in another pull already.",
      "commit_id" : "fa3335bcc143beb7585ebf8c01c028b1762fd77a",
      "created_at" : "2021-11-30T15:55:55Z",
      "diff_hunk" : "@@ -7,6 +7,7 @@\n #define BITCOIN_CONSENSUS_PARAMS_H\n \n #include <uint256.h>\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r759421087",
      "id" : 759421087,
      "in_reply_to_id" : 757058717,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tQ9if",
      "original_commit_id" : "fa386f6a27968cce94b03a8c5317dbc1c6707ffb",
      "original_line" : 10,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : null,
      "pull_request_review_id" : 819227521,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759421087/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-30T15:55:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759421087",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Force pushed last commit, only change is whitespace related",
      "created_at" : "2021-11-30T15:56:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-982772150",
      "id" : 982772150,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5846k-m2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/982772150/reactions"
      },
      "updated_at" : "2021-11-30T15:56:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/982772150",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r759867187"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759867187"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe clarify this into `*(block_index.phashBlock)`?\r\n\r\nI tested that this indeed syncs past the `BIP16Exception` block, and that - conversely - chaning the exception block to a non-existing block causes a failure at height 170,060.",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-01T05:36:58Z",
      "diff_hunk" : "@@ -1589,43 +1589,42 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex* pindex, const Consens\n     // mainnet and testnet), so for simplicity, always leave P2SH\n     // on except for the one violating block.\n     if (consensusparams.BIP16Exception.IsNull() || // no bip16 exception on this chain\n-        pindex->phashBlock == nullptr || // this is a new candidate block, eg from TestBlockValidity()\n-        *pindex->phashBlock != consensusparams.BIP16Exception) // this block isn't the historical exception\n+        block_index.phashBlock == nullptr || // this is a new candidate block, eg from TestBlockValidity()\n+        *block_index.phashBlock != consensusparams.BIP16Exception) // this block isn't the historical exception",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r759867187",
      "id" : 759867187,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tSqcz",
      "original_commit_id" : "fa5fb6f2f2eca7d4c011ae33d42b4f01c559644f",
      "original_line" : 1593,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 819822628,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759867187/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-01T07:16:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759867187",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r759869636"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759869636"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`CChain` does not guarantee that `Tip() != nullptr`. Maybe add an assert as well as a comment for why it's safe to assume in this context `Tip()` exists?",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-01T05:43:43Z",
      "diff_hunk" : "@@ -939,7 +939,7 @@ bool MemPoolAccept::ConsensusScriptChecks(const ATMPArgs& args, Workspace& ws)\n     // There is a similar check in CreateNewBlock() to prevent creating\n     // invalid blocks (using TestBlockValidity), however allowing such\n     // transactions into the mempool can be exploited as a DoS attack.\n-    unsigned int currentBlockScriptVerifyFlags = GetBlockScriptFlags(m_active_chainstate.m_chain.Tip(), chainparams.GetConsensus());\n+    unsigned int currentBlockScriptVerifyFlags{GetBlockScriptFlags(*m_active_chainstate.m_chain.Tip(), chainparams.GetConsensus())};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r759869636",
      "id" : 759869636,
      "line" : 942,
      "node_id" : "PRRC_kwDOABII584tSrDE",
      "original_commit_id" : "fa5fb6f2f2eca7d4c011ae33d42b4f01c559644f",
      "original_line" : 942,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 14,
      "pull_request_review_id" : 819822628,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759869636/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-01T07:16:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759869636",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r759901567"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759901567"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It seems more readable to me to move this assert into the main function body. On mainnet this doesn't change anything, and I checked that it doesn't break any tests.",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-01T06:57:04Z",
      "diff_hunk" : "@@ -1589,8 +1589,7 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex& block_index, const Co\n     // mainnet and testnet), so for simplicity, always leave P2SH\n     // on except for the one violating block.\n     if (consensusparams.BIP16Exception.IsNull() || // no bip16 exception on this chain\n-        block_index.phashBlock == nullptr || // this is a new candidate block, eg from TestBlockValidity()\n-        *block_index.phashBlock != consensusparams.BIP16Exception) // this block isn't the historical exception\n+        *Assert(block_index.phashBlock) != consensusparams.BIP16Exception) // this block isn't the historical exception",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r759901567",
      "id" : 759901567,
      "line" : 1592,
      "node_id" : "PRRC_kwDOABII584tSy1_",
      "original_commit_id" : "fa65b65821add01e28118899d4f2eef98aa4c37a",
      "original_line" : 1592,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 33,
      "pull_request_review_id" : 819822628,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759901567/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-01T07:16:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759901567",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r759909651"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759909651"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Did you mean to drop the `!`?",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-01T07:13:46Z",
      "diff_hunk" : "@@ -1593,6 +1593,13 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex& block_index, const Co\n     {\n         // Enforce WITNESS rules whenever P2SH is in effect\n         flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS;\n+        // Enforce Taproot (BIP340-BIP342) whenever WITNESS is in effect,\n+        // unless except\n+        if (!consensusparams.TaprootException.IsNull() ||                        // no Taproot exception on this chain",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r759909651",
      "id" : 759909651,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tS00T",
      "original_commit_id" : "fa3335bcc143beb7585ebf8c01c028b1762fd77a",
      "original_line" : 1598,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 819822628,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759909651/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-01T07:16:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759909651",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r759922281"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759922281"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Seems unrelated to the changes here? Generally, it is not possible to run a mempool without a chainstate or a chainstate without genesis block (i.e. no tip). If the assert is added, I recommend doing it in `PreChecks`, not in the checks that are done last. You may review https://github.com/bitcoin/bitcoin/pull/23630 which adds the assert.",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-01T07:37:37Z",
      "diff_hunk" : "@@ -939,7 +939,7 @@ bool MemPoolAccept::ConsensusScriptChecks(const ATMPArgs& args, Workspace& ws)\n     // There is a similar check in CreateNewBlock() to prevent creating\n     // invalid blocks (using TestBlockValidity), however allowing such\n     // transactions into the mempool can be exploited as a DoS attack.\n-    unsigned int currentBlockScriptVerifyFlags = GetBlockScriptFlags(m_active_chainstate.m_chain.Tip(), chainparams.GetConsensus());\n+    unsigned int currentBlockScriptVerifyFlags{GetBlockScriptFlags(*m_active_chainstate.m_chain.Tip(), chainparams.GetConsensus())};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r759922281",
      "id" : 759922281,
      "in_reply_to_id" : 759869636,
      "line" : 942,
      "node_id" : "PRRC_kwDOABII584tS35p",
      "original_commit_id" : "fa5fb6f2f2eca7d4c011ae33d42b4f01c559644f",
      "original_line" : 942,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 14,
      "pull_request_review_id" : 819894611,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759922281/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-01T07:37:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759922281",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r759922965"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759922965"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In a later commit this will change to `*Assert(block_index.phashBlock)`, so I think there is nothing left to do here?",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-01T07:38:51Z",
      "diff_hunk" : "@@ -1589,43 +1589,42 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex* pindex, const Consens\n     // mainnet and testnet), so for simplicity, always leave P2SH\n     // on except for the one violating block.\n     if (consensusparams.BIP16Exception.IsNull() || // no bip16 exception on this chain\n-        pindex->phashBlock == nullptr || // this is a new candidate block, eg from TestBlockValidity()\n-        *pindex->phashBlock != consensusparams.BIP16Exception) // this block isn't the historical exception\n+        block_index.phashBlock == nullptr || // this is a new candidate block, eg from TestBlockValidity()\n+        *block_index.phashBlock != consensusparams.BIP16Exception) // this block isn't the historical exception",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r759922965",
      "id" : 759922965,
      "in_reply_to_id" : 759867187,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tS4EV",
      "original_commit_id" : "fa5fb6f2f2eca7d4c011ae33d42b4f01c559644f",
      "original_line" : 1593,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 819895571,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759922965/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-01T07:38:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759922965",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r759923681"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759923681"
         }
      },
      "author_association" : "MEMBER",
      "body" : "the main function already has the assert: https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-979381311\r\n\r\nThis is just another belt-and-suspenders assert.",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-01T07:40:09Z",
      "diff_hunk" : "@@ -1589,8 +1589,7 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex& block_index, const Co\n     // mainnet and testnet), so for simplicity, always leave P2SH\n     // on except for the one violating block.\n     if (consensusparams.BIP16Exception.IsNull() || // no bip16 exception on this chain\n-        block_index.phashBlock == nullptr || // this is a new candidate block, eg from TestBlockValidity()\n-        *block_index.phashBlock != consensusparams.BIP16Exception) // this block isn't the historical exception\n+        *Assert(block_index.phashBlock) != consensusparams.BIP16Exception) // this block isn't the historical exception",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r759923681",
      "id" : 759923681,
      "in_reply_to_id" : 759901567,
      "line" : 1592,
      "node_id" : "PRRC_kwDOABII584tS4Ph",
      "original_commit_id" : "fa65b65821add01e28118899d4f2eef98aa4c37a",
      "original_line" : 1592,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 33,
      "pull_request_review_id" : 819896474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759923681/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-01T07:40:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759923681",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r759927632"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759927632"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah yes, good catch!\r\n\r\nMaybe my preference would be to drop the `IsNull` check and purely rely on the the actual comparison, which is already sufficient and necessary. ",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-01T07:47:04Z",
      "diff_hunk" : "@@ -1593,6 +1593,13 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex& block_index, const Co\n     {\n         // Enforce WITNESS rules whenever P2SH is in effect\n         flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS;\n+        // Enforce Taproot (BIP340-BIP342) whenever WITNESS is in effect,\n+        // unless except\n+        if (!consensusparams.TaprootException.IsNull() ||                        // no Taproot exception on this chain",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r759927632",
      "id" : 759927632,
      "in_reply_to_id" : 759909651,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tS5NQ",
      "original_commit_id" : "fa3335bcc143beb7585ebf8c01c028b1762fd77a",
      "original_line" : 1598,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 819901716,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759927632/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-01T07:47:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/759927632",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r760107438"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760107438"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's nice for it to be identifcal to the BIP16 check, which made this mistake easier to see. It's also probably more similar to what future code will look like that has to handle multiple blocks.",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-01T11:45:06Z",
      "diff_hunk" : "@@ -1593,6 +1593,13 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex& block_index, const Co\n     {\n         // Enforce WITNESS rules whenever P2SH is in effect\n         flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS;\n+        // Enforce Taproot (BIP340-BIP342) whenever WITNESS is in effect,\n+        // unless except\n+        if (!consensusparams.TaprootException.IsNull() ||                        // no Taproot exception on this chain",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r760107438",
      "id" : 760107438,
      "in_reply_to_id" : 759909651,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tTlGu",
      "original_commit_id" : "fa3335bcc143beb7585ebf8c01c028b1762fd77a",
      "original_line" : 1598,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 820150002,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760107438/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-01T11:45:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760107438",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r760108768"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760108768"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's in reference to the `*` which dereferences `Tip()`",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-01T11:47:00Z",
      "diff_hunk" : "@@ -939,7 +939,7 @@ bool MemPoolAccept::ConsensusScriptChecks(const ATMPArgs& args, Workspace& ws)\n     // There is a similar check in CreateNewBlock() to prevent creating\n     // invalid blocks (using TestBlockValidity), however allowing such\n     // transactions into the mempool can be exploited as a DoS attack.\n-    unsigned int currentBlockScriptVerifyFlags = GetBlockScriptFlags(m_active_chainstate.m_chain.Tip(), chainparams.GetConsensus());\n+    unsigned int currentBlockScriptVerifyFlags{GetBlockScriptFlags(*m_active_chainstate.m_chain.Tip(), chainparams.GetConsensus())};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r760108768",
      "id" : 760108768,
      "in_reply_to_id" : 759869636,
      "line" : 942,
      "node_id" : "PRRC_kwDOABII584tTlbg",
      "original_commit_id" : "fa5fb6f2f2eca7d4c011ae33d42b4f01c559644f",
      "original_line" : 942,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 14,
      "pull_request_review_id" : 820151768,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760108768/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-01T11:47:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760108768",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r760109311"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760109311"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Assuming that `Assert()` stays where it is, then indeed it already has the brackets.",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-01T11:47:45Z",
      "diff_hunk" : "@@ -1589,43 +1589,42 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex* pindex, const Consens\n     // mainnet and testnet), so for simplicity, always leave P2SH\n     // on except for the one violating block.\n     if (consensusparams.BIP16Exception.IsNull() || // no bip16 exception on this chain\n-        pindex->phashBlock == nullptr || // this is a new candidate block, eg from TestBlockValidity()\n-        *pindex->phashBlock != consensusparams.BIP16Exception) // this block isn't the historical exception\n+        block_index.phashBlock == nullptr || // this is a new candidate block, eg from TestBlockValidity()\n+        *block_index.phashBlock != consensusparams.BIP16Exception) // this block isn't the historical exception",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r760109311",
      "id" : 760109311,
      "in_reply_to_id" : 759867187,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tTlj_",
      "original_commit_id" : "fa5fb6f2f2eca7d4c011ae33d42b4f01c559644f",
      "original_line" : 1593,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 820152470,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760109311/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-01T11:47:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760109311",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r760111690"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760111690"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok, the first time that `Tip` is dereferenced is in `if (!CheckFinalTx(m_active_chainstate.m_chain.Tip()` in `PreChecks`.\r\n\r\nThe function actually has the assert you are asking for:\r\n\r\n```cpp\r\n    assert(active_chain_tip); // TODO: Make active_chain_tip a reference\r\n",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-01T11:51:13Z",
      "diff_hunk" : "@@ -939,7 +939,7 @@ bool MemPoolAccept::ConsensusScriptChecks(const ATMPArgs& args, Workspace& ws)\n     // There is a similar check in CreateNewBlock() to prevent creating\n     // invalid blocks (using TestBlockValidity), however allowing such\n     // transactions into the mempool can be exploited as a DoS attack.\n-    unsigned int currentBlockScriptVerifyFlags = GetBlockScriptFlags(m_active_chainstate.m_chain.Tip(), chainparams.GetConsensus());\n+    unsigned int currentBlockScriptVerifyFlags{GetBlockScriptFlags(*m_active_chainstate.m_chain.Tip(), chainparams.GetConsensus())};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r760111690",
      "id" : 760111690,
      "in_reply_to_id" : 759869636,
      "line" : 942,
      "node_id" : "PRRC_kwDOABII584tTmJK",
      "original_commit_id" : "fa5fb6f2f2eca7d4c011ae33d42b4f01c559644f",
      "original_line" : 942,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 14,
      "pull_request_review_id" : 820155695,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760111690/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-01T11:51:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/760111690",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-01T13:04:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-983620076",
      "id" : 983620076,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5846oNns",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/983620076/reactions"
      },
      "updated_at" : "2021-12-01T13:04:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/983620076",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "For what it's worth, I don't find the listed benefits very persuasive:\r\n\r\n> * Script verification flags are constant and do not change as the chain progresses.\r\n\r\nThe script verification flags aren't constant -- there's an exception for a particular block in the chain that matters most.\r\n\r\n> * Any future bugs introduced in the deployment code won't have any effect on the script flags, as they are independent of deployment.\r\n\r\nDepends a lot on how severe the bugs are; undefined behaviour could do anything after all. Simply burying the deployment to a fixed height would achieve this goal better, I think.\r\n \r\n> * Enforcing the taproot rules regardless of the deployment status makes testing easier because invalid blocks after activation are also invalid before activation. So there is no need to differentiate the two cases.\r\n\r\nFor testing on regtest or signet, taproot is already always active; there's no need to change the deployment rules to have taproot rules applied to the mempool.  I believe with this patch, we're unable to test the code path that's executed for mainnet block 692261 except by validating the entire mainnet chain up until that point, where prior to this patch we test it automatically on regtest as part of feature_taproot.\r\n\r\n> * It may alert a miner earlier if they produce taproot invalid blocks. For example, if they test their system on a test chain where taproot isn't active yet. Producing blocks with invalid taproot spends may hurt them only when they switch to mainnet.\r\n\r\nThe only way this would happen is if they're mining their own fork of testnet without having synced to anytime since July; and they'd need to be mining pay to taproot spends into those blocks (which they're presumably not getting from public testnet, since they're not synced to the public testnet), and then mining non-standard transactions spend them without following taproot rules (which again they're not getting from public testnet or they'd be synced with public testnet, so are somehow generating them themselves?). That doesn't sound very plausible to me...\r\n\r\nSo I don't think those benefits would justify this change. But...\r\n \r\n> For reference, previously the same was done for P2SH and WITNESS in commit [0a8b7b4](https://github.com/bitcoin/bitcoin/commit/0a8b7b4b33c9d78574627fc606267e2d8955cd1c).\r\n\r\nThat references an [irc meeting](https://www.erisian.com.au/bitcoin-core-dev/log-2017-10-12.html#l-264) which seems to have a different rationale: that if you're in IBD on mainnet, you won't accept a forked chain with invalid taproot spends (even if you're eclipsed). eg:\r\n\r\n`333 2017-10-12T19:12:53  <morcos> sipa: i just really hate the attack scenarios that involve feeding alternate chains that eventually get reorged out but possibly with poor consequences...  perhaps this is not a problem with segwit, but perhaps it is... say your wallet loses money in an unexpected way or something?`\r\n\r\nI'm not sure that's a huge benefit; but I could see there being potential for a reorg as IBD completes to somehow leave you with an invalid taproot spend in the mempool that you might try to include in a block you mine later invalidating that block, or, more plausibly, that you might relay a tx paying to your own taproot address, that then gets mined on the fork and spend via an invalid taproot spend, making you incorrectly think that you've lost funds.\r\n\r\nAgain, not sure that's a huge benefit, but that does seem to me to justify the change. So ConceptACK.",
      "created_at" : "2021-12-08T04:22:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-988486858",
      "id" : 988486858,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII58466xzK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/988486858/reactions"
      },
      "updated_at" : "2021-12-08T04:22:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/988486858",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r764540108"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764540108"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Arguably it would also be correct to write this as:\r\n\r\n```c++\r\nconst auto& h = *Assert(block_index.phashBlock);\r\nif (h.IsNull() || (h != BIP16Exception && h != TaprootException)) {\r\n    flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS | SCRIPT_VERIFY_TAPROOT;\r\n}\r\n```\r\n\r\nsince the taproot exception block has already been validated to comply with p2sh and segwit tx rules (and the inclusion of witness data is handled via BLOCK_OPT_WITNESS elsewhere)",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-08T04:27:38Z",
      "diff_hunk" : "@@ -1593,6 +1593,13 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex& block_index, const Co\n     {\n         // Enforce WITNESS rules whenever P2SH is in effect\n         flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS;\n+        // Enforce Taproot (BIP340-BIP342) whenever WITNESS is in effect,\n+        // unless except\n+        if (consensusparams.TaprootException.IsNull() ||                         // no Taproot exception on this chain\n+            *Assert(block_index.phashBlock) != consensusparams.TaprootException) // this block is not the historical exception",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r764540108",
      "id" : 764540108,
      "line" : 1599,
      "node_id" : "PRRC_kwDOABII584tkfTM",
      "original_commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "original_line" : 1599,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 40,
      "pull_request_review_id" : 825997633,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764540108/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-08T04:47:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764540108",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r764541634"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764541634"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Is there any value to keeping any of the `inactive/` test cases? They aren't being tested with taproot inactive anymore, and the behaviour when taproot is active should already be being tested elsewhere...",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-08T04:32:54Z",
      "diff_hunk" : "@@ -1181,15 +1181,11 @@ def spenders_taproot_inactive():\n     ]\n     tap = taproot_construct(pub, scripts)\n \n-    # Test that keypath spending is valid & non-standard, regardless of validity.\n+    # Test that valid spending is standard.\n     add_spender(spenders, \"inactive/keypath_valid\", key=sec, tap=tap, standard=Standard.V23)\n-    add_spender(spenders, \"inactive/keypath_invalidsig\", key=sec, tap=tap, standard=False, sighash=bitflipper(default_sighash))\n-    add_spender(spenders, \"inactive/keypath_empty\", key=sec, tap=tap, standard=False, witness=[])\n-\n-    # Same for scriptpath spending (and features like annex, leaf versions, or OP_SUCCESS don't change this)\n     add_spender(spenders, \"inactive/scriptpath_valid\", key=sec, tap=tap, leaf=\"pk\", standard=Standard.V23, inputs=[getter(\"sign\")])\n-    add_spender(spenders, \"inactive/scriptpath_invalidsig\", key=sec, tap=tap, leaf=\"pk\", standard=False, inputs=[getter(\"sign\")], sighash=bitflipper(default_sighash))\n-    add_spender(spenders, \"inactive/scriptpath_invalidcb\", key=sec, tap=tap, leaf=\"pk\", standard=False, inputs=[getter(\"sign\")], controlblock=bitflipper(default_controlblock))\n+\n+    # Test that features like annex, leaf versions, or OP_SUCCESS are valid but non-standard",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r764541634",
      "id" : 764541634,
      "line" : 1188,
      "node_id" : "PRRC_kwDOABII584tkfrC",
      "original_commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "original_line" : 1188,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "test/functional/feature_taproot.py",
      "position" : 15,
      "pull_request_review_id" : 825997633,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764541634/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-08T04:45:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764541634",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r766543278"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/766543278"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It seems there is a typo in your idea. `h.IsNull()` should never evaluate to true. Maybe you meant to write\r\n\r\n```cpp\r\nconst auto& h = *Assert(block_index.phashBlock);\r\nif (BIP16Exception.IsNull() || TaprootException.IsNull() || (h != BIP16Exception && h != TaprootException)) {\r\n    flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS | SCRIPT_VERIFY_TAPROOT;\r\n}\r\n```\r\n\r\nThough, this doesn't work, as I expect it to fail to sync testnet3.\r\n\r\nAs I mentioned earlier, just dropping the IsNull check seems simpler (https://github.com/bitcoin/bitcoin/pull/23536#discussion_r759927632).\r\n\r\nSo your code would be \r\n\r\n```cpp\r\nconst auto& h = *Assert(block_index.phashBlock);\r\nif (h != BIP16Exception && h != TaprootException) {\r\n    flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS | SCRIPT_VERIFY_TAPROOT;\r\n}\r\n```\r\n\r\nwhich should work (Haven't synced any chain with it yet). Happy to switch if reviewers think it is worth it.\r\n",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-10T10:11:38Z",
      "diff_hunk" : "@@ -1593,6 +1593,13 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex& block_index, const Co\n     {\n         // Enforce WITNESS rules whenever P2SH is in effect\n         flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS;\n+        // Enforce Taproot (BIP340-BIP342) whenever WITNESS is in effect,\n+        // unless except\n+        if (consensusparams.TaprootException.IsNull() ||                         // no Taproot exception on this chain\n+            *Assert(block_index.phashBlock) != consensusparams.TaprootException) // this block is not the historical exception",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r766543278",
      "id" : 766543278,
      "in_reply_to_id" : 764540108,
      "line" : 1599,
      "node_id" : "PRRC_kwDOABII584tsIWu",
      "original_commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "original_line" : 1599,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 40,
      "pull_request_review_id" : 828716766,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/766543278/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-10T10:11:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/766543278",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thank you for reviewing the pull request description @ajtowns . The use of the word \"constant\" was indeed wrong. I've replaced it with \"known in advance\". Also, I've removed the section talking about miner testing.\r\n\r\n> 333 2017-10-12T19:12:53 <morcos> sipa: i just really hate the attack scenarios that involve feeding alternate chains that eventually get reorged out but possibly with poor consequences... perhaps this is not a problem with segwit, but perhaps it is... say your wallet loses money in an unexpected way or something?\r\n> I'm not sure that's a huge benefit; but I could see there being potential for a reorg as IBD completes to somehow leave you with an invalid taproot spend in the mempool that you might try to include in a block you mine later invalidating that block, or, more plausibly, that you might relay a tx paying to your own taproot address, that then gets mined on the fork and spend via an invalid taproot spend, making you incorrectly think that you've lost funds.\r\n> Again, not sure that's a huge benefit, but that does seem to me to justify the change. So ConceptACK.\r\n\r\n\r\nUnless I am missing something this seems to be a reason *against* this change, no? Currently we won't process any blocks that are not part of a chain that has at least the amount of work of the main chain at the time of the software release. So the attack that this patch is supposed to \"fix\" assumes a massive reorg. With a reorg this massive the change here isn't safe because it may split network consensus into two. And having split consensus in two, you can launch other attacks.\r\n\r\nSo I don't think the patch here should be thought as a countermeasure against some kind of (reorg) attack. The motivation for it is mostly nifty. Or to quote the IRC meeting you linked to: \"cleanest\", \"very nice property\".",
      "created_at" : "2021-12-10T10:29:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-990824225",
      "id" : 990824225,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5847Dsch",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990824225/reactions"
      },
      "updated_at" : "2021-12-10T10:29:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990824225",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r766569018"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/766569018"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good point. Currently they are used to run against previous releases, but given that the tests passed once one the previous releases (and previous releases are \"constant\"), we can probably remove this code. Happy to look into this as a follow-up unless reviewers want me to do it here.",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-10T10:32:46Z",
      "diff_hunk" : "@@ -1181,15 +1181,11 @@ def spenders_taproot_inactive():\n     ]\n     tap = taproot_construct(pub, scripts)\n \n-    # Test that keypath spending is valid & non-standard, regardless of validity.\n+    # Test that valid spending is standard.\n     add_spender(spenders, \"inactive/keypath_valid\", key=sec, tap=tap, standard=Standard.V23)\n-    add_spender(spenders, \"inactive/keypath_invalidsig\", key=sec, tap=tap, standard=False, sighash=bitflipper(default_sighash))\n-    add_spender(spenders, \"inactive/keypath_empty\", key=sec, tap=tap, standard=False, witness=[])\n-\n-    # Same for scriptpath spending (and features like annex, leaf versions, or OP_SUCCESS don't change this)\n     add_spender(spenders, \"inactive/scriptpath_valid\", key=sec, tap=tap, leaf=\"pk\", standard=Standard.V23, inputs=[getter(\"sign\")])\n-    add_spender(spenders, \"inactive/scriptpath_invalidsig\", key=sec, tap=tap, leaf=\"pk\", standard=False, inputs=[getter(\"sign\")], sighash=bitflipper(default_sighash))\n-    add_spender(spenders, \"inactive/scriptpath_invalidcb\", key=sec, tap=tap, leaf=\"pk\", standard=False, inputs=[getter(\"sign\")], controlblock=bitflipper(default_controlblock))\n+\n+    # Test that features like annex, leaf versions, or OP_SUCCESS are valid but non-standard",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r766569018",
      "id" : 766569018,
      "in_reply_to_id" : 764541634,
      "line" : 1188,
      "node_id" : "PRRC_kwDOABII584tsOo6",
      "original_commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "original_line" : 1188,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "test/functional/feature_taproot.py",
      "position" : 15,
      "pull_request_review_id" : 828737893,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/766569018/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-10T10:32:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/766569018",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "tACK fa9a4d1\n\nReverified mainnet chain with assumevalid=0 and also confirmed that the exception is needed.",
      "created_at" : "2021-12-12T05:45:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-991838983",
      "id" : 991838983,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5847HkMH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/991838983/reactions"
      },
      "updated_at" : "2021-12-12T05:45:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/991838983",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3072149?v=4",
         "events_url" : "https://api.github.com/users/dunxen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dunxen/followers",
         "following_url" : "https://api.github.com/users/dunxen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dunxen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dunxen",
         "id" : 3072149,
         "login" : "dunxen",
         "node_id" : "MDQ6VXNlcjMwNzIxNDk=",
         "organizations_url" : "https://api.github.com/users/dunxen/orgs",
         "received_events_url" : "https://api.github.com/users/dunxen/received_events",
         "repos_url" : "https://api.github.com/users/dunxen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dunxen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dunxen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dunxen"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r771242098"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771242098"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think it's worth including in this PR -- if it's worth including at all, doing so in an eventual followup is fine.\r\n\r\nIf we're sure `h.IsNull()` is never true, then `BIP16Exception.IsNull()` implies `h != BIP16Exception` so you don't need the `IsNull` test at all. I thought it was supposed to be able to be null if you were generating a new block and trying to work out which txs you were allowed to include.\r\nThe way I'm thinking of this is:\r\n\r\n * features that will be used by many wallets (segwit, taproot, p2sh) should be \"always\" enforced if possible; this reduces the risk of bugs that might be triggered by an attacker against a node while it's doing IBD\r\n \r\n * there have to be some exceptions unfortunately, but the exceptions aren't the interesting part at all, so should be emphasising the enforcement path more than the exception logic\r\n \r\n  * since the block hash already commits to everything that goes into proving the validity, actually running the checks is only useful to validate the code hasn't changed it's behaviour, not that the block is valid or not. that is, if we ever report that the exception blocks are invalid, that's a bug in the code, not a problem with the block.\r\n\r\nMaybe a cleaner approach would be:\r\n\r\n```c++\r\n// add to Consensus::Params or CChainState\r\n// (lists the rules that *don't* apply to exception blocks)\r\nconst unordered_map<uint256, uint32_t, BlockHasher> script_verify_exception_blocks = {\r\n    { BIP16Exception, SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS | SCRIPT_VERIFY_TAPROOT },\r\n    { TaprootException, SCRIPT_VERIFY_TAPROOT },\r\n};\r\n\r\n// validation:\r\nflags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS | SCRIPT_VERIFY_TAPROOT;\r\n\r\nconst auto& i = script_verify_exception_blocks.find(*Assert(block_index.phashBlock))\r\nif (i != script_verify_exception_blocks.end()) {\r\n    // block is special case exception to some rules\r\n    flags &= ~(i->second);\r\n}\r\n```\r\n\r\nThen for chains where there's no exceptions, the map is just empty.",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-17T09:42:50Z",
      "diff_hunk" : "@@ -1593,6 +1593,13 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex& block_index, const Co\n     {\n         // Enforce WITNESS rules whenever P2SH is in effect\n         flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS;\n+        // Enforce Taproot (BIP340-BIP342) whenever WITNESS is in effect,\n+        // unless except\n+        if (consensusparams.TaprootException.IsNull() ||                         // no Taproot exception on this chain\n+            *Assert(block_index.phashBlock) != consensusparams.TaprootException) // this block is not the historical exception",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r771242098",
      "id" : 771242098,
      "in_reply_to_id" : 764540108,
      "line" : 1599,
      "node_id" : "PRRC_kwDOABII584t-Dhy",
      "original_commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "original_line" : 1599,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 40,
      "pull_request_review_id" : 835022646,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771242098/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-17T09:42:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771242098",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r771266510"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771266510"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> If we're sure h.IsNull() is never true\r\n\r\nYes, I think we can be pretty certain about this. Both call sites assume the hash of the passed block is not null:\r\n\r\nE.g.\r\n\r\n```\r\n    assert(*pindex->phashBlock == block.GetHash());\r\n```\r\n\r\nThe `IsNull` was added based on this comment: https://github.com/bitcoin/bitcoin/pull/11739#discussion_r160814301",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-17T10:08:31Z",
      "diff_hunk" : "@@ -1593,6 +1593,13 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex& block_index, const Co\n     {\n         // Enforce WITNESS rules whenever P2SH is in effect\n         flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS;\n+        // Enforce Taproot (BIP340-BIP342) whenever WITNESS is in effect,\n+        // unless except\n+        if (consensusparams.TaprootException.IsNull() ||                         // no Taproot exception on this chain\n+            *Assert(block_index.phashBlock) != consensusparams.TaprootException) // this block is not the historical exception",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r771266510",
      "id" : 771266510,
      "in_reply_to_id" : 764540108,
      "line" : 1599,
      "node_id" : "PRRC_kwDOABII584t-JfO",
      "original_commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "original_line" : 1599,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 40,
      "pull_request_review_id" : 835055671,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771266510/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-17T10:08:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771266510",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r771286156"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771286156"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Maybe a cleaner approach would be:\r\n\r\nNot sure if I like your suggestion to split \"flags math\" into two different files. This would make reading the code harder. Based on your earlier suggestion, just treating a set of block hashes as \"assumed valid\" with regard to script verification flags seems cleaner:\r\n\r\n```cpp\r\n\r\nconst std::set<uint256> script_verify_exception_blocks;\r\n\r\nconst auto& it_ex{script_verify_exception_blocks.find(*Assert(block_index.phashBlock))};\r\nif (it_ex != script_verify_exception_blocks.end()) {\r\n    flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS | SCRIPT_VERIFY_TAPROOT;\r\n}",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-17T10:35:15Z",
      "diff_hunk" : "@@ -1593,6 +1593,13 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex& block_index, const Co\n     {\n         // Enforce WITNESS rules whenever P2SH is in effect\n         flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS;\n+        // Enforce Taproot (BIP340-BIP342) whenever WITNESS is in effect,\n+        // unless except\n+        if (consensusparams.TaprootException.IsNull() ||                         // no Taproot exception on this chain\n+            *Assert(block_index.phashBlock) != consensusparams.TaprootException) // this block is not the historical exception",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r771286156",
      "id" : 771286156,
      "in_reply_to_id" : 764540108,
      "line" : 1599,
      "node_id" : "PRRC_kwDOABII584t-OSM",
      "original_commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "original_line" : 1599,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 40,
      "pull_request_review_id" : 835080462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771286156/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-17T10:35:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771286156",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Unless I am missing something this seems to be a reason _against_ this change, no? Currently we won't process any blocks that are not part of a chain that has at least the amount of work of the main chain at the time of the software release. So the attack that this patch is supposed to \"fix\" assumes a massive reorg. With a reorg this massive the change here isn't safe because it may split network consensus into two. And having split consensus in two, you can launch other attacks.\r\n\r\nI think the massive reorg that's assumed is from a fake, lower-work chain to the current chain which is much easier than doing a \"real\" reorg. The idea being:\r\n\r\n * an attacker eclipses your node during IBD so that you can only follow their chain\r\n * your node is not running this code, so accepts a non-standard taproot invalid tx because they include it in some block in their chain\r\n \r\nThen either,\r\n \r\n * the attacker then allows you to reorg to the main chain, at which point the taproot invalid tx perhaps enters your mempool\r\n * despite the huge reorg and eventual activation of taproot that tx doesn't get removed from your mempool\r\n * you then include that tx in blocks you attempt to mine, rendering them invalid\r\n\r\nor\r\n\r\n * the invalid tx spends to or from an address of yours, causing your wallet balance to be incorrect\r\n * due to the shock, you have a heart attack and die, losing access to your coins?\r\n\r\nBecause you're reorging *to* the main chain, you can do those attacks with substantially less resources than it would take to reorg the current chain back prior to taproot's activation. Hence I think that's a reason for this change (and why it's a \"nice property\" to have).\r\n\r\nConsidering three ways of enforcing taproot:\r\n\r\n * bip341 rules (current)\r\n * unconditional activation at height 709632 (#23505)\r\n * activation except for block `0000000000000000000f14c35b2d841e986ab5441de8c585d5ffe55ea1e395ad` (this pr)\r\n \r\nthen the first two will only result in differences if there is a reorg back to block 687283 (and taproot was prevented from activating via bip341 rules, or timewarp was used to delay activation to a later block), whereas the latter could result in differences if there is a reorg back to block 709630 (with block 709631 being taproot invalid). I think the longer reorg would require about 4.6x as much work as the latter at present. Presuming this change isn't released until April, that's another ~15000 blocks, and the ratio would presumably be 1.8x.\r\n\r\nBut either would already be over 4800 blocks (and by April would be ~20,000 blocks), which I'd expect to result in a network split independently of any activation rules (due to people invalidating the reorg and continuing to follow/mine the lower work chain)... Hence I don't think the risk of a higher-work reorg of the current chain is a reason against this change.",
      "created_at" : "2021-12-17T10:35:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-996614301",
      "id" : 996614301,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5847ZyCd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996614301/reactions"
      },
      "updated_at" : "2021-12-17T10:35:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996614301",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r771288906"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771288906"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Putting the map in `CChainState` rather than `Consensus::Params` would allow keeping it validation rather than splitting it into validation/chainparams fwiw. Agree that your suggestion also works fine.",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-17T10:39:35Z",
      "diff_hunk" : "@@ -1593,6 +1593,13 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex& block_index, const Co\n     {\n         // Enforce WITNESS rules whenever P2SH is in effect\n         flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS;\n+        // Enforce Taproot (BIP340-BIP342) whenever WITNESS is in effect,\n+        // unless except\n+        if (consensusparams.TaprootException.IsNull() ||                         // no Taproot exception on this chain\n+            *Assert(block_index.phashBlock) != consensusparams.TaprootException) // this block is not the historical exception",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r771288906",
      "id" : 771288906,
      "in_reply_to_id" : 764540108,
      "line" : 1599,
      "node_id" : "PRRC_kwDOABII584t-O9K",
      "original_commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "original_line" : 1599,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 40,
      "pull_request_review_id" : 835084469,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771288906/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-17T10:39:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771288906",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Sorry, I still don't follow how an eclipse attack can disable our protection against reorgs during IBD.\r\n\r\nThe code:\r\n\r\n```cpp\r\n    if (!fRequested) {  // If we didn't ask for it:\r\n// .. snip ..\r\n\r\n        // Protect against DoS attacks from low-work chains.\r\n        // If our tip is behind, a peer could try to send us\r\n        // low-work blocks on a fake chain that we would never\r\n        // request; don't process these.\r\n        if (pindex->nChainWork < nMinimumChainWork) return true;\r\n    }\r\n```\r\n\r\nAnd `fRequested` is never set for \"boring\" peers. See:\r\n\r\n```cpp\r\n    if (...snip... || state->pindexBestKnownBlock->nChainWork < nMinimumChainWork) {\r\n        // This peer has nothing interesting.\r\n        return;\r\n    }\r\n```\r\n\r\nIf this protection didn't work, we should fix it. Again, I don't think seeing this pull request as a \"bug fix\" for an attack is the right approach. If there was a bug, it would be exploitable on current master (with witness v2 outputs maybe?).\r\n\r\n",
      "created_at" : "2021-12-17T11:02:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-996633642",
      "id" : 996633642,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5847Z2wq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996633642/reactions"
      },
      "updated_at" : "2021-12-17T11:02:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996633642",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Witness v2 outputs don't matter I think -- they won't affect your wallet (for the second case) and won't be any more valid/invalid on the main chain than on a hypothetical lower work fork (so won't invalidate your blocks in the first case).\r\n\r\nThe minimum chain work check would currently just mean you'd need to start your fake chain after block 691719, but presumably it'd be easiest to start just prior to taproot's activation anyway (709632). Updating min chainwork prior to 23.0 to something well past the chain work as at taproot's activation would likely make this attack prohibitively expensive against people running 23.0, even if this PR weren't included. But this patch would prevent that attack even if someone were willing to do that much work (eg, perhaps there's a huge improvement in sha256d asics making such an attack much cheaper). My feeling is that's not super important, but still a worthwhile additional protection.\r\n\r\nBut if I'm wrong and this change isn't protecting against bugs for people simply following mainnet, I'm not sure it makes sense to be touching consensus code in this way though: better to just bury the deployment rather than adding consensus logic for something with no tangible benefits. Burial gains both the first two benefits listed in the pr description (if you know the block's height, you know whether taproot is enforced or not; and bugs in bip9/whatever logic no affect it), and for the third, the only cases where taproot isn't activated is if you manually configure regtest that way, or you're trying a massive reorg of testnet or mainnet, so presuming you don't do those things, you can treat a buried deployment of taproot as always active too. Burial has a higher cost to creating a consensus split due to needing a deeper reorg, and seems like it has a lower risk of introducing bugs (due to less new code). (The same argument would apply to making p2sh and segwit rules apply to (almost) all blocks originally, and would also presumably apply to reverting that change or p2sh/segwit now).",
      "created_at" : "2021-12-17T12:39:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-996691958",
      "id" : 996691958,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5847aE_2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996691958/reactions"
      },
      "updated_at" : "2021-12-17T12:39:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996691958",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r771376283"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771376283"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is the full diff (checked that it compiles, but didn't sync the chain). Maybe instead of a follow-up we can decide whether it is a good idea, and if yes, just push it here?\r\n\r\n\r\n```diff\r\ncommit bb064cf5ba34ac3214577a55aa40702e1dc4d19c\r\nAuthor: MarcoFalke <falke.marco@gmail.com>\r\nDate:   Fri Dec 17 13:57:39 2021 +0100\r\n\r\n    set\r\n\r\ndiff --git a/src/chainparams.cpp b/src/chainparams.cpp\r\nindex b0bded4355..a14633a80a 100644\r\n--- a/src/chainparams.cpp\r\n+++ b/src/chainparams.cpp\r\n@@ -65,8 +65,10 @@ public:\r\n         consensus.signet_blocks = false;\r\n         consensus.signet_challenge.clear();\r\n         consensus.nSubsidyHalvingInterval = 210000;\r\n-        consensus.BIP16Exception = uint256S(\"0x00000000000002dc756eebf4f49723ed8d30cc28a5f108eb94b1ba88ac4f9c22\");\r\n-        consensus.TaprootException = uint256S(\"0x0000000000000000000f14c35b2d841e986ab5441de8c585d5ffe55ea1e395ad\");\r\n+        consensus.script_verify_exception_blocks.emplace( // BIP16 exception\r\n+            uint256S(\"0x00000000000002dc756eebf4f49723ed8d30cc28a5f108eb94b1ba88ac4f9c22\"));\r\n+        consensus.script_verify_exception_blocks.emplace( // Taproot exception\r\n+            uint256S(\"0x0000000000000000000f14c35b2d841e986ab5441de8c585d5ffe55ea1e395ad\"));\r\n         consensus.BIP34Height = 227931;\r\n         consensus.BIP34Hash = uint256S(\"0x000000000000024b89b42a942fe0d9fea3bb44ab7bd1b19115dd6a759c0808b8\");\r\n         consensus.BIP65Height = 388381; // 000000000000000004c2b624ed5d7756c508d90fd0da2c7c679febfa6c4735f0\r\n@@ -185,8 +187,8 @@ public:\r\n         consensus.signet_blocks = false;\r\n         consensus.signet_challenge.clear();\r\n         consensus.nSubsidyHalvingInterval = 210000;\r\n-        consensus.BIP16Exception = uint256S(\"0x00000000dd30457c001f4095d208cc1296b0eed002427aa599874af7a432b105\");\r\n-        consensus.TaprootException = uint256::ZERO;\r\n+        consensus.script_verify_exception_blocks.emplace( // BIP16 exception\r\n+            uint256S(\"0x00000000dd30457c001f4095d208cc1296b0eed002427aa599874af7a432b105\"));\r\n         consensus.BIP34Height = 21111;\r\n         consensus.BIP34Hash = uint256S(\"0x0000000023b3a96d3484e5abb3755c413e7d41500f8e2a5c3f0dd01299cd8ef8\");\r\n         consensus.BIP65Height = 581885; // 00000000007f6655f22f98e72ed80d8b06dc761d5da09df0fa1dc4be4f861eb6\r\n@@ -325,8 +327,6 @@ public:\r\n         consensus.signet_blocks = true;\r\n         consensus.signet_challenge.assign(bin.begin(), bin.end());\r\n         consensus.nSubsidyHalvingInterval = 210000;\r\n-        consensus.BIP16Exception = uint256{};\r\n-        consensus.TaprootException = uint256::ZERO;\r\n         consensus.BIP34Height = 1;\r\n         consensus.BIP34Hash = uint256{};\r\n         consensus.BIP65Height = 1;\r\n@@ -394,8 +394,6 @@ public:\r\n         consensus.signet_blocks = false;\r\n         consensus.signet_challenge.clear();\r\n         consensus.nSubsidyHalvingInterval = 150;\r\n-        consensus.BIP16Exception = uint256();\r\n-        consensus.TaprootException = uint256::ZERO;\r\n         consensus.BIP34Height = 1; // Always active unless overridden\r\n         consensus.BIP34Hash = uint256();\r\n         consensus.BIP65Height = 1;  // Always active unless overridden\r\ndiff --git a/src/consensus/params.h b/src/consensus/params.h\r\nindex 97e755a80b..b9b9b6de78 100644\r\n--- a/src/consensus/params.h\r\n+++ b/src/consensus/params.h\r\n@@ -7,7 +7,9 @@\r\n #define BITCOIN_CONSENSUS_PARAMS_H\r\n \r\n #include <uint256.h>\r\n+\r\n #include <limits>\r\n+#include <set>\r\n \r\n namespace Consensus {\r\n \r\n@@ -70,10 +72,13 @@ struct BIP9Deployment {\r\n struct Params {\r\n     uint256 hashGenesisBlock;\r\n     int nSubsidyHalvingInterval;\r\n-    /* Block hash that is excepted from BIP16 enforcement, or Null if none exists */\r\n-    uint256 BIP16Exception;\r\n-    /* Block hash that is excepted from SCRIPT_VERIFY_TAPROOT enforcement, or Null if none exists */\r\n-    uint256 TaprootException;\r\n+    /**\r\n+     * Hashes of blocks that are\r\n+     * - known to be consensus valid, and\r\n+     * - buried in the chain, and\r\n+     * - fail if script flags from the chain tip are applied.\r\n+     */\r\n+    std::set<uint256> script_verify_exception_blocks;\r\n     /** Block height and hash at which BIP34 becomes active */\r\n     int BIP34Height;\r\n     uint256 BIP34Hash;\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\nindex a1c5a2f286..5677ff4952 100644\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -1586,20 +1586,15 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex& block_index, const Co\r\n     // BIP16 didn't become active until Apr 1 2012 (on mainnet, and\r\n     // retroactively applied to testnet)\r\n     // However, only one historical block violated the P2SH rules (on both\r\n-    // mainnet and testnet), so for simplicity, always leave P2SH\r\n-    // on except for the one violating block.\r\n-    if (consensusparams.BIP16Exception.IsNull() || // no bip16 exception on this chain\r\n-        *Assert(block_index.phashBlock) != consensusparams.BIP16Exception) // this block isn't the historical exception\r\n-    {\r\n-        // Enforce WITNESS rules whenever P2SH is in effect\r\n-        flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS;\r\n-        // Enforce Taproot (BIP340-BIP342) whenever WITNESS is in effect,\r\n-        // unless except\r\n-        if (consensusparams.TaprootException.IsNull() ||                         // no Taproot exception on this chain\r\n-            *Assert(block_index.phashBlock) != consensusparams.TaprootException) // this block is not the historical exception\r\n-        {\r\n-            flags |= SCRIPT_VERIFY_TAPROOT;\r\n-        }\r\n+    // mainnet and testnet).\r\n+    // Similarly, only one historical block violated the TAPROOT rules on\r\n+    // mainnet.\r\n+    // For simplicity, always leave P2SH+WITNESS+TAPROOT on except for the two\r\n+    // violating blocks.\r\n+\r\n+    const auto& it_exception{consensusparams.script_verify_exception_blocks.find(*Assert(block_index.phashBlock))};\r\n+    if (it_exception != consensusparams.script_verify_exception_blocks.end()) {\r\n+        flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS | SCRIPT_VERIFY_TAPROOT;\r\n     }\r\n \r\n     // Enforce the DERSIG (BIP66) rule\r\n",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-17T13:00:06Z",
      "diff_hunk" : "@@ -1593,6 +1593,13 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex& block_index, const Co\n     {\n         // Enforce WITNESS rules whenever P2SH is in effect\n         flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS;\n+        // Enforce Taproot (BIP340-BIP342) whenever WITNESS is in effect,\n+        // unless except\n+        if (consensusparams.TaprootException.IsNull() ||                         // no Taproot exception on this chain\n+            *Assert(block_index.phashBlock) != consensusparams.TaprootException) // this block is not the historical exception",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r771376283",
      "id" : 771376283,
      "in_reply_to_id" : 764540108,
      "line" : 1599,
      "node_id" : "PRRC_kwDOABII584t-kSb",
      "original_commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "original_line" : 1599,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 40,
      "pull_request_review_id" : 835205249,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771376283/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-17T13:00:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771376283",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks, I've summarize your point in OP in three sentences.",
      "created_at" : "2021-12-17T13:22:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-996718804",
      "id" : 996718804,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5847aLjU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996718804/reactions"
      },
      "updated_at" : "2021-12-17T13:22:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996718804",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r771399902"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771399902"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If you're using a `set` rather than a `map`, you can just say `script_verify_exception_blocks.count(...) != 0` and avoid the iterator and the `.end()` check.",
      "commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "created_at" : "2021-12-17T13:37:35Z",
      "diff_hunk" : "@@ -1593,6 +1593,13 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex& block_index, const Co\n     {\n         // Enforce WITNESS rules whenever P2SH is in effect\n         flags |= SCRIPT_VERIFY_P2SH | SCRIPT_VERIFY_WITNESS;\n+        // Enforce Taproot (BIP340-BIP342) whenever WITNESS is in effect,\n+        // unless except\n+        if (consensusparams.TaprootException.IsNull() ||                         // no Taproot exception on this chain\n+            *Assert(block_index.phashBlock) != consensusparams.TaprootException) // this block is not the historical exception",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#discussion_r771399902",
      "id" : 771399902,
      "in_reply_to_id" : 764540108,
      "line" : 1599,
      "node_id" : "PRRC_kwDOABII584t-qDe",
      "original_commit_id" : "fa9a4d103ff673724dfeb53b10a2707a81539d68",
      "original_line" : 1599,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 40,
      "pull_request_review_id" : 835238640,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23536",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771399902/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-17T13:37:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771399902",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> the attacker then allows you to reorg to the main chain, at which point the taproot invalid tx perhaps enters your mempool\r\n\r\nRe-reading this, I think it shouldn't be possible for the invalid tx to enter the mempool, since MaybeUpdateMempoolForReorg calls ATMP, which requires txs to be policy and consensus valid, no?",
      "created_at" : "2021-12-17T16:17:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-996846755",
      "id" : 996846755,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5847aqyj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996846755/reactions"
      },
      "updated_at" : "2021-12-17T16:17:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996846755",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > the attacker then allows you to reorg to the main chain, at which point the taproot invalid tx perhaps enters your mempool\r\n> \r\n> Re-reading this, I think it shouldn't be possible for the invalid tx to enter the mempool, since MaybeUpdateMempoolForReorg calls ATMP, which requires txs to be policy and consensus valid, no?\r\n\r\nYeah, that's what I'd expect (or at least hope for). But that logic's more complicated than just \"you can't ever make a new valid block with a taproot-invalid tx\", so there's more chance of that code having a bug, either already or sometime in the future.",
      "created_at" : "2021-12-17T16:54:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23536#issuecomment-996871674",
      "id" : 996871674,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23536",
      "node_id" : "IC_kwDOABII5847aw36",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996871674/reactions"
      },
      "updated_at" : "2021-12-17T16:54:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996871674",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   }
]
