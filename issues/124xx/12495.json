{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "The comment in the code explains the situation in detail, but I'll condense it here. I'm trying to optimize performance for IBD on I/O bound systems, and a lot of yak-shaving has led me to the CDBWrapper code, which sets a low value for `max_open_files`. On 64-bit POSIX hosts this is unnecessary because on such systems LevelDB will always just reserve 10 file handles for itself, and use the remainder of the value as a limit on the size of an LRU used as a table cache. The entries in this table cache do not use any file descriptors at all: LevelDB will open the underlying file read-only, mmap the region with `PROT_READ`, and then close the original file descriptor. This optimization only applies for POSIX hosts, and only for 64-bit hosts.\r\n\r\nBy increasing the limit here we drastically reduce churn on the chainstate database during IBD (in my testing I've actually been doing `-reindex-chainstate`). This can also help the kernel manage its page cache more effectively, as it has a better idea of which file regions are actually likely to be used imminently.\r\n\r\nIf you want to verify this locally without digging into `env_posix.cc`, run `bitcoind -reindex-chainstate` and after letting it go for a bit look at it with `lsof -p`. You should see no more than 10 open file descriptors related to chainstate files (usually, much less than this). You'll also see 52 (or less) .ldb files that are open as mmap regions, but that do *not* have open file descriptors.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495/comments",
   "created_at" : "2018-02-20T22:37:06Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495",
   "id" : 298775304,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 12495,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/12495.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12495",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/12495.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12495"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Increase LevelDB max_open_files on 64-bit POSIX systems",
   "updated_at" : "2018-02-20T22:37:06Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12495",
   "user" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
      "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
      "followers_url" : "https://api.github.com/users/eklitzke/followers",
      "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
      "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/eklitzke",
      "id" : 2734,
      "login" : "eklitzke",
      "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
      "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
      "repos_url" : "https://api.github.com/users/eklitzke/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/eklitzke"
   }
}
