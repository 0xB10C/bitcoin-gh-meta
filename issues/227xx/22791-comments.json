[
   {
      "author_association" : "MEMBER",
      "body" : "I'm unable to build (with clang 13, CI seems to agree). The first commit compiles; testing. \r\n\r\n<details><summary>build output</summary><p>\r\n\r\n```\r\nbench/addrman.cpp:76:18: error: no matching constructor for initialization of 'CAddrMan'\r\n        CAddrMan addrman{/* deterministic */ false, /* consistency_check_ratio */ 0};\r\n                 ^      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n./addrman.h:181:7: note: candidate constructor (the implicit copy constructor) not viable: requires 1 argument, but 2 were provided\r\nclass CAddrMan\r\n      ^\r\n./addrman.h:458:14: note: candidate constructor not viable: requires 3 arguments, but 2 were provided\r\n    explicit CAddrMan(std::vector<bool>* asmap, bool deterministic, int32_t consistency_check_ratio);\r\n             ^\r\nbench/addrman.cpp:83:14: error: no matching constructor for initialization of 'CAddrMan'\r\n    CAddrMan addrman(/* deterministic */ false, /* consistency_check_ratio */ 0);\r\n             ^                           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n./addrman.h:181:7: note: candidate constructor (the implicit copy constructor) not viable: requires 1 argument, but 2 were provided\r\nclass CAddrMan\r\n      ^\r\n./addrman.h:458:14: note: candidate constructor not viable: requires 3 arguments, but 2 were provided\r\n    explicit CAddrMan(std::vector<bool>* asmap, bool deterministic, int32_t consistency_check_ratio);\r\n             ^\r\nbench/addrman.cpp:95:14: error: no matching constructor for initialization of 'CAddrMan'\r\n    CAddrMan addrman(/* deterministic */ false, /* consistency_check_ratio */ 0);\r\n             ^                           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n./addrman.h:181:7: note: candidate constructor (the implicit copy constructor) not viable: requires 1 argument, but 2 were provided\r\nclass CAddrMan\r\n      ^\r\n./addrman.h:458:14: note: candidate constructor not viable: requires 3 arguments, but 2 were provided\r\n    explicit CAddrMan(std::vector<bool>* asmap, bool deterministic, int32_t consistency_check_ratio);\r\n             ^\r\n```\r\n</p></details>\r\n",
      "created_at" : "2021-08-24T13:34:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-904647597",
      "id" : 904647597,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22791",
      "node_id" : "IC_kwDOABII584169Ot",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-24T13:51:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/904647597",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I'm unable to build (with clang 13, CI seems to agree)\r\n\r\nOops. I don't build with bench locally to save a bit of time. Now fixed.",
      "created_at" : "2021-08-24T13:43:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-904654593",
      "id" : 904654593,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22791",
      "node_id" : "IC_kwDOABII58416-8B",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-24T13:43:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/904654593",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "First commit: the addrman checks pass throughout, but I lose 18k addresses on startup and then see parsing errors with the asmap file (and same on bitcoind restart, which fails).\r\n```\r\n2021-08-24T13:39:14Z [init] Opened asmap file \"/home/jon/projects/bitcoin/asmap/demo.map\" (932999 bytes) from disk\r\n2021-08-24T13:39:15Z [init] Using asmap version 7ead927689f884bc4021618017cc1438d9328578779edd2adfbed044fb52928e for IP bucketing\r\n2021-08-24T13:39:15Z [init] init message: Loading P2P addressesâ¦\r\n2021-08-24T13:39:16Z [init] Bucketing method was updated, re-bucketing addrman entries from disk\r\n2021-08-24T13:39:25Z [init] addrman lost 18599 new and 1 tried addresses due to collisions or invalid addresses\r\n2021-08-24T13:39:25Z [init] Addrman checks started: new 26373, tried 72, total 26445\r\n2021-08-24T13:39:25Z [init] Addrman checks completed successfully\r\n2021-08-24T13:39:25Z [init] Loaded 26445 addresses from peers.dat  9577ms\r\n...\r\nError: Error reading configuration file: parse error on line 334: 2021-08-24T13:39:14Z [init] Opened asmap file \"/home/jon/projects/bitcoin/asmap/demo.map\" (932999 bytes) from disk\r\n```\r\n\r\n<details><summary>tested with these config args</summary><p>\r\n\r\n```\r\n2021-08-24T13:41:49Z [init] Config file arg: blockfilterindex=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: checkaddrman=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: checkblocks=\"12\"\r\n2021-08-24T13:41:49Z [init] Config file arg: checklevel=\"4\"\r\n2021-08-24T13:41:49Z [init] Config file arg: checkmempool=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: coinstatsindex=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: debug=\"tor\"\r\n2021-08-24T13:41:49Z [init] Config file arg: debug=\"i2p\"\r\n2021-08-24T13:41:49Z [init] Config file arg: debug=\"addrman\"\r\n2021-08-24T13:41:49Z [init] Config file arg: i2psam=\"127.0.0.1:7656\"\r\n2021-08-24T13:41:49Z [init] Config file arg: logips=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: logthreadnames=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: par=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: peerbloomfilters=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: persistmempool=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: txindex=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: walletbroadcast=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: [main] asmap=\"/home/jon/projects/bitcoin/asmap/demo.map\"\r\n```\r\n</p></details>\r\n",
      "created_at" : "2021-08-24T13:45:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-904656625",
      "id" : 904656625,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22791",
      "node_id" : "IC_kwDOABII58416_bx",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-24T13:55:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/904656625",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r694991699"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/694991699"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What is the point of `{}`?",
      "commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "created_at" : "2021-08-24T16:01:12Z",
      "diff_hunk" : "@@ -1171,10 +1171,38 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     fDiscover = args.GetBoolArg(\"-discover\", true);\n     const bool ignores_incoming_txs{args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)};\n \n-    assert(!node.addrman);\n-    auto check_addrman = std::clamp<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\n-    node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n     {\n+        // Initialize addrman\n+        assert(!node.addrman);\n+\n+        // Read asmap file if configured\n+        std::vector<bool> asmap{};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r694991699",
      "id" : 694991699,
      "line" : 1179,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NDk5MTY5OQ==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 1179,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 12,
      "pull_request_review_id" : 737414947,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-24T16:20:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/694991699",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695003334"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695003334"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4ffc8b81bc520fe66fb is there any benefit to making `m_asmap` private rather than a public data member? referencing our previous conversation:\r\n\r\n- https://github.com/bitcoin/bitcoin/pull/20210#issuecomment-766093925\r\n\r\n- https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines.html#c131-avoid-trivial-getters-and-setters\r\n\r\n(otherwise, make the getter const?)\r\n```suggestion\r\n    const std::vector<bool>& GetAsmap() const { return m_asmap; }\r\n```",
      "commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "created_at" : "2021-08-24T16:15:08Z",
      "diff_hunk" : "@@ -593,6 +577,8 @@ class CAddrMan\n         Check();\n     }\n \n+    const std::vector<bool>& GetAsmap() { return m_asmap; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695003334",
      "id" : 695003334,
      "line" : 580,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTAwMzMzNA==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 580,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 36,
      "pull_request_review_id" : 737430387,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-24T16:46:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695003334",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695005038"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695005038"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n\r\n```suggestion\r\n    const std::vector<bool>& GetAsmap() const { return m_asmap; }\r\n```",
      "commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "created_at" : "2021-08-24T16:17:20Z",
      "diff_hunk" : "@@ -593,6 +577,8 @@ class CAddrMan\n         Check();\n     }\n \n+    const std::vector<bool>& GetAsmap() { return m_asmap; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695005038",
      "id" : 695005038,
      "line" : 580,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTAwNTAzOA==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 580,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 36,
      "pull_request_review_id" : 737414947,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-24T16:20:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695005038",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695006419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695006419"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This pattern `asmap = Consume(); if (!Sanity()) { asmap.clear(); }` is used in two places. Maybe not worth it, but consider adding `ConsumeASMap()` to deduplicate it.",
      "commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "created_at" : "2021-08-24T16:19:04Z",
      "diff_hunk" : "@@ -306,9 +307,12 @@ FUZZ_TARGET_INIT(addrman_serdeser, initialize_addrman)\n     FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n \n-    CAddrManDeterministic addr_man1{fuzzed_data_provider};\n-    CAddrManDeterministic addr_man2{fuzzed_data_provider};\n-    addr_man2.m_asmap = addr_man1.m_asmap;\n+    std::vector<bool> asmap = ConsumeRandomLengthBitVector(fuzzed_data_provider);\n+    if (!SanityCheckASMap(asmap)) {\n+        asmap.clear();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695006419",
      "id" : 695006419,
      "line" : 313,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTAwNjQxOQ==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 313,
      "original_position" : 55,
      "original_start_line" : 310,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : 55,
      "pull_request_review_id" : 737414947,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : 310,
      "start_side" : "RIGHT",
      "updated_at" : "2021-08-24T16:20:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695006419",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695020652"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695020652"
         }
      },
      "author_association" : "MEMBER",
      "body" : "47ad0fd2644c4de7a11efa9c9e288f73d6c147e5 naming nit: `asmap_data` would allow more easily grepping for / distinguishing this new data structure in the code \r\n```suggestion\r\n        std::vector<bool> asmap_data;\r\n```",
      "commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "created_at" : "2021-08-24T16:37:22Z",
      "diff_hunk" : "@@ -1171,10 +1171,38 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     fDiscover = args.GetBoolArg(\"-discover\", true);\n     const bool ignores_incoming_txs{args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)};\n \n-    assert(!node.addrman);\n-    auto check_addrman = std::clamp<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\n-    node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n     {\n+        // Initialize addrman\n+        assert(!node.addrman);\n+\n+        // Read asmap file if configured\n+        std::vector<bool> asmap{};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695020652",
      "id" : 695020652,
      "line" : 1179,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTAyMDY1Mg==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 1179,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 12,
      "pull_request_review_id" : 737430387,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-24T16:48:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695020652",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695022214"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695022214"
         }
      },
      "author_association" : "MEMBER",
      "body" : "47ad0fd2644c4de7a11efa9c9e288f73d6c147e5 nit, why these outer brackets?",
      "commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "created_at" : "2021-08-24T16:39:31Z",
      "diff_hunk" : "@@ -1183,11 +1211,12 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n             LogPrintf(\"Loaded %i addresses from peers.dat  %dms\\n\", node.addrman->size(), GetTimeMillis() - nStart);\n         } else {\n             // Addrman can be in an inconsistent state after failure, reset it\n-            node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n+            node.addrman = std::make_unique<CAddrMan>(&asmap, /* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n             LogPrintf(\"Recreating peers.dat\\n\");\n             adb.Write(*node.addrman);\n         }\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695022214",
      "id" : 695022214,
      "line" : 1218,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTAyMjIxNA==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 1218,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 51,
      "pull_request_review_id" : 737430387,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-24T16:46:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695022214",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
