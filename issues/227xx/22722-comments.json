[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22722#discussion_r690144369"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22722"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690144369"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Suggestion, you could use braced initialization and `std::max` with an initializer list.\r\n```diff\r\n-    CFeeRate feeRate = fee_estimator.estimateSmartFee(conf_target, &feeCalc, conservative);\r\n-    CFeeRate min_mempool_feerate = mempool.GetMinFee(gArgs.GetArg(\"-maxmempool\", DEFAULT_MAX_MEMPOOL_SIZE) * 1000000);\r\n-    if (feeRate < min_mempool_feerate) {\r\n-        feeRate = min_mempool_feerate;\r\n-    }\r\n-    CFeeRate min_relay_feerate = ::minRelayTxFee;\r\n-    if (feeRate < min_relay_feerate) {\r\n-        feeRate = min_relay_feerate;\r\n-    }\r\n+    CFeeRate feeRate{fee_estimator.estimateSmartFee(conf_target, &feeCalc, conservative)};\r\n+    CFeeRate min_mempool_feerate{mempool.GetMinFee(gArgs.GetArg(\"-maxmempool\", DEFAULT_MAX_MEMPOOL_SIZE) * 1000000)};\r\n+    CFeeRate min_relay_feerate{::minRelayTxFee};\r\n+    feeRate = std::max({feeRate, min_mempool_feerate, min_relay_feerate});\r\n```\r\n",
      "commit_id" : "3f3e2b962c5f3d74babfef7c04783510fcdefde3",
      "created_at" : "2021-08-17T08:19:50Z",
      "diff_hunk" : "@@ -1113,6 +1115,14 @@ static RPCHelpMan estimatesmartfee()\n     UniValue errors(UniValue::VARR);\n     FeeCalculation feeCalc;\n     CFeeRate feeRate = fee_estimator.estimateSmartFee(conf_target, &feeCalc, conservative);\n+    CFeeRate min_mempool_feerate = mempool.GetMinFee(gArgs.GetArg(\"-maxmempool\", DEFAULT_MAX_MEMPOOL_SIZE) * 1000000);\n+    if (feeRate < min_mempool_feerate) {\n+        feeRate = min_mempool_feerate;\n+    }\n+    CFeeRate min_relay_feerate = ::minRelayTxFee;\n+    if (feeRate < min_relay_feerate) {\n+        feeRate = min_relay_feerate;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22722#discussion_r690144369",
      "id" : 690144369,
      "line" : 1125,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MDE0NDM2OQ==",
      "original_commit_id" : "3f3e2b962c5f3d74babfef7c04783510fcdefde3",
      "original_line" : 1125,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : 20,
      "pull_request_review_id" : 731469939,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22722",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-17T08:23:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690144369",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22722#discussion_r690145620"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22722"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690145620"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        self.log.info(\"Test fee rate estimation after restarting node with high MempoolMinFee\")\r\n```",
      "commit_id" : "3f3e2b962c5f3d74babfef7c04783510fcdefde3",
      "created_at" : "2021-08-17T08:21:27Z",
      "diff_hunk" : "@@ -278,6 +282,11 @@ def run_test(self):\n         self.log.info(\"Final estimates after emptying mempools\")\n         check_estimates(self.nodes[1], self.fees_per_kb)\n \n+        # check that the effective feerate is greater than or equal to the mempoolminfee even for high mempoolminfee\n+        self.log.info(\"Estimates after restarting node with high MempoolMinFee\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22722#discussion_r690145620",
      "id" : 690145620,
      "line" : 286,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MDE0NTYyMA==",
      "original_commit_id" : "3f3e2b962c5f3d74babfef7c04783510fcdefde3",
      "original_line" : 286,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "test/functional/feature_fee_estimation.py",
      "position" : 19,
      "pull_request_review_id" : 731469939,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22722",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-17T08:23:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690145620",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22722#discussion_r690145848"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22722"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690145848"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, missing space\r\n```diff\r\n-        assert_greater_than_or_equal(feerate,float(mempoolMinFee))\r\n-        assert_greater_than_or_equal(feerate,float(minRelaytxFee))\r\n+        assert_greater_than_or_equal(feerate, float(mempoolMinFee))\r\n+        assert_greater_than_or_equal(feerate, float(minRelaytxFee))\r\n```",
      "commit_id" : "3f3e2b962c5f3d74babfef7c04783510fcdefde3",
      "created_at" : "2021-08-17T08:21:45Z",
      "diff_hunk" : "@@ -133,9 +133,13 @@ def check_smart_estimates(node, fees_seen):\n     delta = 1.0e-6  # account for rounding error\n     last_feerate = float(max(fees_seen))\n     all_smart_estimates = [node.estimatesmartfee(i) for i in range(1, 26)]\n+    mempoolMinFee = node.getmempoolinfo()['mempoolminfee']\n+    minRelaytxFee = node.getmempoolinfo()['minrelaytxfee']\n     for i, e in enumerate(all_smart_estimates):  # estimate is for i+1\n         feerate = float(e[\"feerate\"])\n         assert_greater_than(feerate, 0)\n+        assert_greater_than_or_equal(feerate,float(mempoolMinFee))\n+        assert_greater_than_or_equal(feerate,float(minRelaytxFee))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22722#discussion_r690145848",
      "id" : 690145848,
      "line" : 142,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MDE0NTg0OA==",
      "original_commit_id" : "3f3e2b962c5f3d74babfef7c04783510fcdefde3",
      "original_line" : 142,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "test/functional/feature_fee_estimation.py",
      "position" : 10,
      "pull_request_review_id" : 731469939,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22722",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-17T08:23:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690145848",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22722#discussion_r690149493"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22722"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690149493"
         }
      },
      "author_association" : "MEMBER",
      "body" : "can be `const`\r\n```suggestion\r\n    const NodeContext& node = EnsureAnyNodeContext(request.context);\r\n```",
      "commit_id" : "3f3e2b962c5f3d74babfef7c04783510fcdefde3",
      "created_at" : "2021-08-17T08:26:30Z",
      "diff_hunk" : "@@ -1097,6 +1097,8 @@ static RPCHelpMan estimatesmartfee()\n     RPCTypeCheckArgument(request.params[0], UniValue::VNUM);\n \n     CBlockPolicyEstimator& fee_estimator = EnsureAnyFeeEstimator(request.context);\n+    NodeContext& node = EnsureAnyNodeContext(request.context);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22722#discussion_r690149493",
      "id" : 690149493,
      "line" : 1100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MDE0OTQ5Mw==",
      "original_commit_id" : "3f3e2b962c5f3d74babfef7c04783510fcdefde3",
      "original_line" : 1100,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : 4,
      "pull_request_review_id" : 731476430,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22722",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-17T08:26:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690149493",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK (Including mempoolMinFee)\r\n\r\n`estimatesmartfee` should become better (smart) after this change although I am not sure about the approach. Will test it today.",
      "created_at" : "2021-08-17T08:37:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22722#issuecomment-900105817",
      "id" : 900105817,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22722",
      "node_id" : "IC_kwDOABII5841poZZ",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-17T08:57:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/900105817",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-08-17T18:14:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22722#issuecomment-900524714",
      "id" : 900524714,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22722",
      "node_id" : "IC_kwDOABII5841rOqq",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-17T18:14:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/900524714",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4500994?v=4",
         "events_url" : "https://api.github.com/users/kristapsk/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kristapsk/followers",
         "following_url" : "https://api.github.com/users/kristapsk/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kristapsk/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kristapsk",
         "id" : 4500994,
         "login" : "kristapsk",
         "node_id" : "MDQ6VXNlcjQ1MDA5OTQ=",
         "organizations_url" : "https://api.github.com/users/kristapsk/orgs",
         "received_events_url" : "https://api.github.com/users/kristapsk/received_events",
         "repos_url" : "https://api.github.com/users/kristapsk/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kristapsk/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kristapsk"
      }
   }
]
