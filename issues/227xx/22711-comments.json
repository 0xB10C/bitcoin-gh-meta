[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22711#discussion_r690530132"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22711"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690530132"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(Per `git show ca6523d0c8` (thanks for the commit reference!) this was changed in January 2018, is it still accurate, covered in `feature_block.py`?)",
      "commit_id" : "d742b1c7d05cfc56994833fd90aab0d8852ffe4a",
      "created_at" : "2021-08-17T16:24:15Z",
      "diff_hunk" : "@@ -869,7 +875,7 @@ def test_block_malleability(self):\n     @subtest  # type: ignore\n     def test_witness_block_size(self):\n         # TODO: Test that non-witness carrying blocks can't exceed 1MB\n-        # Skipping this test for now; this is covered in p2p-fullblocktest.py\n+        # Skipping this test for now; this is covered in feature_block.py",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22711#discussion_r690530132",
      "id" : 690530132,
      "line" : 878,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MDUzMDEzMg==",
      "original_commit_id" : "d742b1c7d05cfc56994833fd90aab0d8852ffe4a",
      "original_line" : 878,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "test/functional/p2p_segwit.py",
      "position" : 56,
      "pull_request_review_id" : 731979111,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22711",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-17T16:51:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690530132",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22711#discussion_r690578934"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22711"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690578934"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, I think the relevant part is here:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/fdd80b0a53b4af0b29cb6e03118e2456d053a757/test/functional/feature_block.py#L315-L337\r\n\r\nThese blocks (as all others in feature_block.py, IIRC) don't have a witness commitment, so they are \"non-witness carrying blocks\". For those the serialized size equals to the block weight divided by WITNESS_SCALE_FACTOR (4), i.e. with MAX_BLOCK_WEIGHT (4000000) this results in the 1MB size limit being checked. Note that these test parts were changed recently in #22378 to switch to weight-based accounting, the constant used was formerly named `MAX_BLOCK_BASE_SIZE`.",
      "commit_id" : "d742b1c7d05cfc56994833fd90aab0d8852ffe4a",
      "created_at" : "2021-08-17T17:28:45Z",
      "diff_hunk" : "@@ -869,7 +875,7 @@ def test_block_malleability(self):\n     @subtest  # type: ignore\n     def test_witness_block_size(self):\n         # TODO: Test that non-witness carrying blocks can't exceed 1MB\n-        # Skipping this test for now; this is covered in p2p-fullblocktest.py\n+        # Skipping this test for now; this is covered in feature_block.py",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22711#discussion_r690578934",
      "id" : 690578934,
      "in_reply_to_id" : 690530132,
      "line" : 878,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MDU3ODkzNA==",
      "original_commit_id" : "d742b1c7d05cfc56994833fd90aab0d8852ffe4a",
      "original_line" : 878,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "test/functional/p2p_segwit.py",
      "position" : 56,
      "pull_request_review_id" : 732041270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22711",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-17T17:28:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/690578934",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Interesting. Are these error cases already covered by `./src/test/test_bitcoin -t script_tests`?\r\n\r\nIt seems like each one of the following script interpreter errors (see `src/script/script_error.cpp`):\r\n- ERR_WITNESS_PROGRAM_WITNESS_EMPTY (\"Witness program was passed an empty witness\")\r\n- ERR_WITNESS_UNEXPECTED (\"Witness provided for non-witness script\")\r\n- ERR_CLEANSTACK (\"Stack size must be exactly one after execution\")\r\n- ERR_WITNESS_MALLEATED (\"Witness requires empty scriptSig\")\r\n- ERR_PUSH_SIZE (\"Push value size limit exceeded\")\r\n- ERR_SCRIPT_SIZE (\"Script is too big\")\r\n- ERR_INVALID_STACK_OPERATION (\"Operation not valid with the current stack size\")\r\n- ERR_EVAL_FALSE (\"Script evaluated without error but finished with a false/empty top stack element\")\r\n\r\ncan at least be found once in `src/test/data/script_tests.json` (without the `ERR_` prefix), which is in turn used as input for the script tests in `src/test/script_tests.cpp`. I'm thinking that maybe a good follow-up PR idea would be to als introduce these script error constants in the functional test framework too, to not have those strings duplicated in the tests; it would be also easier to find which script errors are covered in unit and functional tests with a single grep. The test `feature_taproot.py` already does this locally:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/fdd80b0a53b4af0b29cb6e03118e2456d053a757/test/functional/feature_taproot.py#L554-L575",
      "created_at" : "2021-08-17T17:29:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22711#issuecomment-900493558",
      "id" : 900493558,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22711",
      "node_id" : "IC_kwDOABII5841rHD2",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-17T17:29:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/900493558",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22711#discussion_r691179132"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22711"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691179132"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is this TODO still relevant now that it explicitly sets single-threaded validation?",
      "commit_id" : "d742b1c7d05cfc56994833fd90aab0d8852ffe4a",
      "created_at" : "2021-08-18T12:15:42Z",
      "diff_hunk" : "@@ -514,7 +519,8 @@ def test_v0_outputs_arent_spendable(self):\n             # 'non-mandatory-script-verify-flag (Witness program was passed an\n             # empty witness)' (otherwise).\n             # TODO: support multiple acceptable reject reasons.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22711#discussion_r691179132",
      "id" : 691179132,
      "line" : 521,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTE3OTEzMg==",
      "original_commit_id" : "d742b1c7d05cfc56994833fd90aab0d8852ffe4a",
      "original_line" : 521,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "test/functional/p2p_segwit.py",
      "position" : 26,
      "pull_request_review_id" : 732785992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22711",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T12:15:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691179132",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22711#discussion_r691209611"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22711"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691209611"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good question. One could argue that by implementing this TODO it'd be possible to further increase test coverage by asserting for the two different reject reasons dynamically, depending on whether `g_parallel_script_checks` is on; so on single-core systems, the specific message would be checked (like in this PR), and on multi-core systems, the more generic error message `block-validation-failed` would be checked. At least that's my interpreration of the TODO's original intention.\r\n\r\n(Not sure though if it's worth it to do that. Currently, as far as I know we don't even have an easy way of determining of whether bitcoind uses parallel script verification if we don't pass `-par` explicitely. Also it makes the test less deterministic, and since most of the systems nowadays are multi-core, the case with the specific reject reasons would rarely be tested.)",
      "commit_id" : "d742b1c7d05cfc56994833fd90aab0d8852ffe4a",
      "created_at" : "2021-08-18T12:55:39Z",
      "diff_hunk" : "@@ -514,7 +519,8 @@ def test_v0_outputs_arent_spendable(self):\n             # 'non-mandatory-script-verify-flag (Witness program was passed an\n             # empty witness)' (otherwise).\n             # TODO: support multiple acceptable reject reasons.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22711#discussion_r691209611",
      "id" : 691209611,
      "in_reply_to_id" : 691179132,
      "line" : 521,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MTIwOTYxMQ==",
      "original_commit_id" : "d742b1c7d05cfc56994833fd90aab0d8852ffe4a",
      "original_line" : 521,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "test/functional/p2p_segwit.py",
      "position" : 26,
      "pull_request_review_id" : 732825918,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22711",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-18T12:55:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/691209611",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22711#discussion_r696798153"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22711"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696798153"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe remove the TODO then?",
      "commit_id" : "d742b1c7d05cfc56994833fd90aab0d8852ffe4a",
      "created_at" : "2021-08-26T16:34:38Z",
      "diff_hunk" : "@@ -514,7 +519,8 @@ def test_v0_outputs_arent_spendable(self):\n             # 'non-mandatory-script-verify-flag (Witness program was passed an\n             # empty witness)' (otherwise).\n             # TODO: support multiple acceptable reject reasons.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22711#discussion_r696798153",
      "id" : 696798153,
      "in_reply_to_id" : 691179132,
      "line" : 521,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5Njc5ODE1Mw==",
      "original_commit_id" : "d742b1c7d05cfc56994833fd90aab0d8852ffe4a",
      "original_line" : 521,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "test/functional/p2p_segwit.py",
      "position" : 26,
      "pull_request_review_id" : 739702323,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22711",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-26T16:34:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696798153",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22711#discussion_r696866825"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22711"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696866825"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke: Yes, seems to be better to remove it (forgot to do that after my comment). Done.",
      "commit_id" : "00b93e5e990b04e8f8b3e1d6d0a274de89e83f8b",
      "created_at" : "2021-08-26T18:09:50Z",
      "diff_hunk" : "@@ -514,7 +519,8 @@ def test_v0_outputs_arent_spendable(self):\n             # 'non-mandatory-script-verify-flag (Witness program was passed an\n             # empty witness)' (otherwise).\n             # TODO: support multiple acceptable reject reasons.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22711#discussion_r696866825",
      "id" : 696866825,
      "in_reply_to_id" : 691179132,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5Njg2NjgyNQ==",
      "original_commit_id" : "d742b1c7d05cfc56994833fd90aab0d8852ffe4a",
      "original_line" : 521,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "test/functional/p2p_segwit.py",
      "position" : null,
      "pull_request_review_id" : 739791292,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22711",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-26T18:09:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696866825",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   }
]
