[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r693960652"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693960652"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in 238ce0b02b1f7ac78c8c0466cef33628c6d49359:\r\n\r\nIf it is turned on later, we could keep it a nullptr until then and only initialize if and when we receive a `filter*` message?",
      "commit_id" : "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
      "created_at" : "2021-08-23T13:15:15Z",
      "diff_hunk" : "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r693960652",
      "id" : 693960652,
      "line" : 2648,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5Mzk2MDY1Mg==",
      "original_commit_id" : "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
      "original_line" : 2648,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 314,
      "pull_request_review_id" : 736105932,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-23T13:15:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/693960652",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23042](https://github.com/bitcoin/bitcoin/pull/23042) (net: Avoid logging AlreadyHaveTx when disconnecting misbehaving peer by MarcoFalke)\n* [#22777](https://github.com/bitcoin/bitcoin/pull/22777) (net processing: don't request tx relay on feeler connections by jnewbery)\n* [#22053](https://github.com/bitcoin/bitcoin/pull/22053) (refactor: Release cs_main before MaybeSendFeefilter by MarcoFalke)\n* [#21878](https://github.com/bitcoin/bitcoin/pull/21878) (Make all networking code mockable by vasild)\n* [#21515](https://github.com/bitcoin/bitcoin/pull/21515) (Erlay: bandwidth-efficient transaction relay protocol by naumenkogs)\n* [#19499](https://github.com/bitcoin/bitcoin/pull/19499) (p2p: Make timeout mockable and type safe, speed up test by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-08-23T13:25:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-903765978",
      "id" : 903765978,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII58413l_a",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-29T23:17:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903765978",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r694001534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/694001534"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps, but I think it's better to allocate resources for the worst-case scenario up front, rather than try to reduce resource usage and later find out that you need to allocate a new structure.",
      "commit_id" : "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
      "created_at" : "2021-08-23T14:02:54Z",
      "diff_hunk" : "@@ -2643,10 +2642,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // set nodes not capable of serving the complete blockchain history as \"limited nodes\"\n         pfrom.m_limited_node = (!(nServices & NODE_NETWORK) && (nServices & NODE_NETWORK_LIMITED));\n \n-        LOCK(peer->m_tx_relay_mutex);\n-        if (peer->m_tx_relay != nullptr) {\n+        // We don't initialize the m_tx_relay data structure if:\n+        // - this is an outbound block-relay-only connection; or\n+        // - fRelay=false and we're not offering NODE_BLOOM to this peer\n+        //   (NODE_BLOOM means that the peer may turn on tx relay later)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#discussion_r694001534",
      "id" : 694001534,
      "in_reply_to_id" : 693960652,
      "line" : 2648,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NDAwMTUzNA==",
      "original_commit_id" : "238ce0b02b1f7ac78c8c0466cef33628c6d49359",
      "original_line" : 2648,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 314,
      "pull_request_review_id" : 736162717,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22778",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-23T14:02:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/694001534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-08-23T17:16:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-903961930",
      "id" : 903961930,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII58414V1K",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-23T17:16:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/903961930",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've pushed a new branch that simplifies the implementation a bit. I'd previously wanted to amalgamate the various mutexes and atomics in `Peer::TxRelay` as part of this PR, but it's easier to wait until #21527 to do that, otherwise there are all kinds of lock ordering/inversion issues to work around.",
      "created_at" : "2021-08-27T08:37:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-907031918",
      "id" : 907031918,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5842EDVu",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-27T08:37:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/907031918",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased",
      "created_at" : "2021-08-27T10:00:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-907082695",
      "id" : 907082695,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5842EPvH",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-27T10:00:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/907082695",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2021-09-01T16:04:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-910429435",
      "id" : 910429435,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5842RAz7",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-01T16:04:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/910429435",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-09-06T10:58:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-913554695",
      "id" : 913554695,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5842c70H",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-06T10:58:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/913554695",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on the latest #21160",
      "created_at" : "2021-09-24T11:13:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-926544378",
      "id" : 926544378,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5843OfH6",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-24T11:13:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/926544378",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Some rough estimates on how much this will save:\r\n\r\n```\r\n(gdb) p sizeof(CNode::TxRelay)\r\n$1 = 152\r\n```\r\n\r\nAssuming 50 incoming connections and 20% of them being block-only, that makes 10 peers will benefit from this. 152 bytes each, so 1520 bytes will be saved.",
      "created_at" : "2021-09-30T07:49:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22778#issuecomment-930958812",
      "id" : 930958812,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22778",
      "node_id" : "IC_kwDOABII5843fU3c",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-30T07:49:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/930958812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
