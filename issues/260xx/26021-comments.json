[
   {
      "author_association" : "MEMBER",
      "body" : "This also happens when loading a wallet containing a miniscript descriptor.\r\n\r\nCatching the error is good, though I still wonder if we should use a flag or something like that to prevent loading future descriptor types.\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1189415605",
      "created_at" : "2022-09-06T13:57:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26021#issuecomment-1238190137",
      "id" : 1238190137,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26021",
      "node_id" : "IC_kwDOABII585JzUg5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1238190137/reactions"
      },
      "updated_at" : "2022-09-06T13:57:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1238190137",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> This also happens when loading a wallet containing a miniscript descriptor.\r\n> \r\n> Catching the error is good, though I still wonder if we should use a flag or something like that to prevent loading future descriptor types.\r\n> \r\n> [#24148 (comment)](https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1189415605)\r\n\r\nHmm, if you load unrecognized descriptor types, the parsing process should always fail with the current flow. It's not different to parsing corrupted data.\r\n\r\nWill add test coverage for both scenarios and expand the returned error mentioning the last soft version that opened the wallet if it is newer than the current one.\r\n\r\n-----------------------------------------\r\n\r\nA new feature that could be handy for users is \"partial wallet loads\" (or \"force wallet loads\"), meaning that previous soft versions will be able to load every wallet (until where they can), without loading the unrecognized descriptors/data. Where, implementation wise, could be a startup flag that tells the wallet to skip all the entries related to any unrecognized descriptor instead of aborting right away.\r\n\r\nSo, end result would look like this:\r\n\r\n1. If the descriptor parse fails for any reason: the app will, by default, abort and notify the user about the unrecognized descriptor; mentioning the wallet version if it was created/opened by a newer software version before or, if not, just saying that the file is corrupt.\r\n\r\n2. In case of the user wanting to partially/force load wallets with all the information that can be parsed: The user will add a startup flag \"-partial-wallet-load=true\" (or something like that). So he/she is aware of the behavior as it can/will only be able to see a partial view of the owned/watched transactions.\r\n\r\nWhat do you think?",
      "created_at" : "2022-09-06T14:53:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26021#issuecomment-1238264817",
      "id" : 1238264817,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26021",
      "node_id" : "IC_kwDOABII585Jzmvx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1238264817/reactions"
      },
      "updated_at" : "2022-09-06T14:59:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1238264817",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I would add an argument to the `loadwallet` RPC instead, but that's more of a followup thing.",
      "created_at" : "2022-09-06T15:46:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26021#issuecomment-1238332201",
      "id" : 1238332201,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26021",
      "node_id" : "IC_kwDOABII585Jz3Mp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1238332201/reactions"
      },
      "updated_at" : "2022-09-06T15:46:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1238332201",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26021#discussion_r963887520"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26021"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963887520"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 8c52bbe5923cb3d78bfd37e429d85b9727cf2dae \"wallet: bugfix, load wallet with an unknown descriptor cause fatal error\"\r\n\r\nI think this should mention that the descriptor is either unknown or corrupt as this will occur for unknown future descriptors. I think it is far more likely that a user downgrades and runs into this error than actually has data corruption in the wallet file.\r\n\r\nAlso, I think it would be better to added a `DBErrors::UNKNOWN_DESCRIPTOR` so that the real error gets propagated to the user interface rather than directing them to find the log file.",
      "commit_id" : "f59489cb7be71b9e8125c23ce265e8f88582b787",
      "created_at" : "2022-09-06T15:54:56Z",
      "diff_hunk" : "@@ -832,6 +839,9 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n                     // Set tx_corrupt back to false so that the error is only printed once (per corrupt tx)\n                     wss.tx_corrupt = false;\n                     result = DBErrors::CORRUPT;\n+                } else if (wss.descriptor_corrupt) {\n+                    pwallet->WalletLogPrintf(\"Error: Corrupt wallet descriptor found in wallet %s. This can be fixed by removing wallet from the settings so it's not loaded at startup.\\n\", pwallet->GetName());\n+                    return DBErrors::CORRUPT;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26021#discussion_r963887520",
      "id" : 963887520,
      "line" : 844,
      "node_id" : "PRRC_kwDOABII5845c8Gg",
      "original_commit_id" : "8c52bbe5923cb3d78bfd37e429d85b9727cf2dae",
      "original_line" : 844,
      "original_position" : 29,
      "original_start_line" : 842,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 29,
      "pull_request_review_id" : 1097862418,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26021",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963887520/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 842,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-06T15:55:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963887520",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
