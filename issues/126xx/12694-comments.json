[
   {
      "author_association" : "MEMBER",
      "body" : "Dare I ask if you can write a test for this?",
      "created_at" : "2018-03-15T06:47:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12694#issuecomment-373277663",
      "id" : 373277663,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12694",
      "updated_at" : "2018-03-15T06:47:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373277663",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Added a test",
      "created_at" : "2018-03-15T15:26:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12694#issuecomment-373415965",
      "id" : 373415965,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12694",
      "updated_at" : "2018-03-15T15:26:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373415965",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12694#discussion_r174895100"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174895100"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Actually disable BnB when there are preset inputs\"\r\n\r\nSorry to repeat my comment from the other PR, but I do think it'd be clearer to add explicit non-reference `bool disable_bnb` parameters to SelectCoins methods, so the `CoinSelectionParams` struct can remain const and not be changing on the fly. The current bug seems like evidence to me that controlling bnb through the struct is not a great idea.",
      "commit_id" : "081bf54ee4a282eed72e7de409ad6b9ab97f2987",
      "created_at" : "2018-03-15T18:56:40Z",
      "diff_hunk" : "@@ -2523,6 +2523,7 @@ bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAm\n     {\n         // For now, don't use BnB if preset inputs are selected. TODO: Enable this later\n         bnb_used = false;\n+        coin_selection_params.use_bnb = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12694#discussion_r174895100",
      "id" : 174895100,
      "original_commit_id" : "6ef99826b9ab2c9d95ed4b55403d22225bcf086a",
      "original_position" : 13,
      "path" : "src/wallet/wallet.cpp",
      "position" : 13,
      "pull_request_review_id" : 104337004,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12694",
      "updated_at" : "2018-03-15T19:22:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174895100",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12694#discussion_r174895880"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174895880"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Test that BnB is not used when there are preset inputs\"\r\n\r\nMight want to split this up into two `BOOST_CHECK` statements, so if one condition fails, the output shows which one is failing.",
      "commit_id" : "081bf54ee4a282eed72e7de409ad6b9ab97f2987",
      "created_at" : "2018-03-15T18:59:33Z",
      "diff_hunk" : "@@ -222,6 +224,17 @@ BOOST_AUTO_TEST_CASE(bnb_search_test)\n     add_coin(1);\n     vCoins.at(0).nInputBytes = 40; // Make sure that it has a negative effective value. The next check should assert if this somehow got through. Otherwise it will fail\n     BOOST_CHECK(!testWallet.SelectCoinsMinConf( 1 * CENT, filter_standard, vCoins, setCoinsRet, nValueRet, coin_selection_params_bnb, bnb_used));\n+\n+    // Make sure that we aren't using BnB when there are preset inputs\n+    empty_wallet();\n+    add_coin(5 * CENT);\n+    add_coin(3 * CENT);\n+    add_coin(2 * CENT);\n+    CCoinControl coin_control;\n+    coin_control.fAllowOtherInputs = true;\n+    coin_control.Select(COutPoint(vCoins.at(0).tx->GetHash(), vCoins.at(0).i));\n+    BOOST_CHECK(testWallet.SelectCoins(vCoins, 10 * CENT, setCoinsRet, nValueRet, coin_control, coin_selection_params_bnb, bnb_used));\n+    BOOST_CHECK(!bnb_used && !coin_selection_params_bnb.use_bnb);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12694#discussion_r174895880",
      "id" : 174895880,
      "original_commit_id" : "3f97e7cc129876b3b392057151cfece44e747938",
      "original_position" : 39,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 104337004,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12694",
      "updated_at" : "2018-03-15T19:22:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174895880",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12694#discussion_r174902125"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174902125"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree that it isn't ideal, but having the caller control whether BnB should be used is just a temporary shim to work with the current coin selection. I intend for it to go away when the replacement fallback strategy is implemented (which I have already started doing so). I don't think changing it now is worth the additional review effort required when the parameter will be removed later.",
      "commit_id" : "081bf54ee4a282eed72e7de409ad6b9ab97f2987",
      "created_at" : "2018-03-15T19:18:23Z",
      "diff_hunk" : "@@ -2523,6 +2523,7 @@ bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAm\n     {\n         // For now, don't use BnB if preset inputs are selected. TODO: Enable this later\n         bnb_used = false;\n+        coin_selection_params.use_bnb = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12694#discussion_r174902125",
      "id" : 174902125,
      "in_reply_to_id" : 174895100,
      "original_commit_id" : "6ef99826b9ab2c9d95ed4b55403d22225bcf086a",
      "original_position" : 13,
      "path" : "src/wallet/wallet.cpp",
      "position" : 13,
      "pull_request_review_id" : 104345209,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12694",
      "updated_at" : "2018-03-15T19:22:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174902125",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12694#discussion_r174903301"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174903301"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "081bf54ee4a282eed72e7de409ad6b9ab97f2987",
      "created_at" : "2018-03-15T19:22:44Z",
      "diff_hunk" : "@@ -222,6 +224,17 @@ BOOST_AUTO_TEST_CASE(bnb_search_test)\n     add_coin(1);\n     vCoins.at(0).nInputBytes = 40; // Make sure that it has a negative effective value. The next check should assert if this somehow got through. Otherwise it will fail\n     BOOST_CHECK(!testWallet.SelectCoinsMinConf( 1 * CENT, filter_standard, vCoins, setCoinsRet, nValueRet, coin_selection_params_bnb, bnb_used));\n+\n+    // Make sure that we aren't using BnB when there are preset inputs\n+    empty_wallet();\n+    add_coin(5 * CENT);\n+    add_coin(3 * CENT);\n+    add_coin(2 * CENT);\n+    CCoinControl coin_control;\n+    coin_control.fAllowOtherInputs = true;\n+    coin_control.Select(COutPoint(vCoins.at(0).tx->GetHash(), vCoins.at(0).i));\n+    BOOST_CHECK(testWallet.SelectCoins(vCoins, 10 * CENT, setCoinsRet, nValueRet, coin_control, coin_selection_params_bnb, bnb_used));\n+    BOOST_CHECK(!bnb_used && !coin_selection_params_bnb.use_bnb);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12694#discussion_r174903301",
      "id" : 174903301,
      "in_reply_to_id" : 174895880,
      "original_commit_id" : "3f97e7cc129876b3b392057151cfece44e747938",
      "original_position" : 39,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 104346590,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12694",
      "updated_at" : "2018-03-15T19:22:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174903301",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12694#discussion_r175226317"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175226317"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I guess the code was like this when you started, but it seems kind of dangerous to be mutating global variables in the test suite like this, because it can cause errors to propagate from one test to another. It looks like it would be pretty straightforward to change the code in the test to not use globals. Consider making these variables local to each method (maybe in a future PR?).",
      "commit_id" : "081bf54ee4a282eed72e7de409ad6b9ab97f2987",
      "created_at" : "2018-03-16T22:13:13Z",
      "diff_hunk" : "@@ -72,6 +73,7 @@ static void add_coin(const CAmount& nValue, int nAge = 6*24, bool fIsFromMe = fa\n     }\n     COutput output(wtx.get(), nInput, nAge, true /* spendable */, true /* solvable */, true /* safe */);\n     vCoins.push_back(output);\n+    testWallet.AddToWallet(*wtx.get());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12694#discussion_r175226317",
      "id" : 175226317,
      "original_commit_id" : "081bf54ee4a282eed72e7de409ad6b9ab97f2987",
      "original_position" : 21,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 21,
      "pull_request_review_id" : 104732125,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12694",
      "updated_at" : "2018-03-16T22:21:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175226317",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12694#discussion_r175227239"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175227239"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since this is just temporary code anyway, keep the parameter const and make a copy:\r\n\r\n```c++\r\nauto params = coin_selection_params;\r\nparams.use_bnb = false;\r\n```\r\n\r\nThat way this diff doesn't have to change the function signature, you don't need to change the header file, and you can have more const. Considering all of the other work this method is doing, the overhead of the copy won't even be measurable.",
      "commit_id" : "081bf54ee4a282eed72e7de409ad6b9ab97f2987",
      "created_at" : "2018-03-16T22:19:22Z",
      "diff_hunk" : "@@ -2523,6 +2523,7 @@ bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAm\n     {\n         // For now, don't use BnB if preset inputs are selected. TODO: Enable this later\n         bnb_used = false;\n+        coin_selection_params.use_bnb = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12694#discussion_r175227239",
      "id" : 175227239,
      "in_reply_to_id" : 174895100,
      "original_commit_id" : "6ef99826b9ab2c9d95ed4b55403d22225bcf086a",
      "original_position" : 13,
      "path" : "src/wallet/wallet.cpp",
      "position" : 13,
      "pull_request_review_id" : 104732125,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12694",
      "updated_at" : "2018-03-16T22:21:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175227239",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   }
]
