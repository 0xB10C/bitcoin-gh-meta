[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This looks fine to me. It looks like the existing leak scenarios are for fatal errors, but more RAII pointer types is good in my opinion.\r\n\r\nIt's kind of weird that you're putting this in a `std::unique_ptr` and then later on giving the raw pointer to a `WalletRescanReserver()`; for that pattern I would have expected to see a `std::shared_ptr`. That being said `WalletRescanReserver()` looks like kind of a mess in general (e.g. it uses a mutex to access `fScanningWallet` in `reserve()`, but not in `isReserved()`).\r\n\r\nutACK 9378d89",
      "created_at" : "2018-03-11T02:26:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12647#issuecomment-372084114",
      "id" : 372084114,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12647",
      "updated_at" : "2018-03-11T02:27:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372084114",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12647#discussion_r173665252"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12647"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173665252"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Use MakeUnique?",
      "commit_id" : "9378d89cbb9741493411d61bc1cffa4d02204dc5",
      "created_at" : "2018-03-11T18:57:58Z",
      "diff_hunk" : "@@ -3929,7 +3929,7 @@ CWallet* CWallet::CreateWalletFromFile(const std::string& name, const fs::path&\n \n     int64_t nStart = GetTimeMillis();\n     bool fFirstRun = true;\n-    CWallet *walletInstance = new CWallet(name, CWalletDBWrapper::Create(path));\n+    std::unique_ptr<CWallet> walletInstance(new CWallet(name, CWalletDBWrapper::Create(path)));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12647#discussion_r173665252",
      "id" : 173665252,
      "original_commit_id" : "9378d89cbb9741493411d61bc1cffa4d02204dc5",
      "original_position" : 5,
      "path" : "src/wallet/wallet.cpp",
      "position" : 5,
      "pull_request_review_id" : 102892132,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12647",
      "updated_at" : "2018-03-11T19:00:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173665252",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12647#discussion_r173665264"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12647"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173665264"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Release on return?",
      "commit_id" : "9378d89cbb9741493411d61bc1cffa4d02204dc5",
      "created_at" : "2018-03-11T18:58:27Z",
      "diff_hunk" : "@@ -4101,7 +4098,11 @@ CWallet* CWallet::CreateWalletFromFile(const std::string& name, const fs::path&\n         LogPrintf(\"mapAddressBook.size() = %u\\n\",  walletInstance->mapAddressBook.size());\n     }\n \n-    return walletInstance;\n+    walletInstance->m_last_block_processed = chainActive.Tip();\n+\n+    CWallet* wallet_ptr = walletInstance.release();\n+    RegisterValidationInterface(wallet_ptr);\n+    return wallet_ptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12647#discussion_r173665264",
      "id" : 173665264,
      "original_commit_id" : "9378d89cbb9741493411d61bc1cffa4d02204dc5",
      "original_position" : 37,
      "path" : "src/wallet/wallet.cpp",
      "position" : 37,
      "pull_request_review_id" : 102892132,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12647",
      "updated_at" : "2018-03-11T19:00:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173665264",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
