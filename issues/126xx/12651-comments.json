[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Would the pruned peer immediately drop the block, or keep it around for some time - if so, how? Can we just append it to the blocks on disk and have it fall out after pruning LIFO style?",
      "created_at" : "2018-03-09T14:25:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12651#issuecomment-371826163",
      "id" : 371826163,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12651",
      "updated_at" : "2018-03-09T14:25:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/371826163",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7999704?v=4",
         "events_url" : "https://api.github.com/users/esotericnonsense/events{/privacy}",
         "followers_url" : "https://api.github.com/users/esotericnonsense/followers",
         "following_url" : "https://api.github.com/users/esotericnonsense/following{/other_user}",
         "gists_url" : "https://api.github.com/users/esotericnonsense/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/esotericnonsense",
         "id" : 7999704,
         "login" : "esotericnonsense",
         "organizations_url" : "https://api.github.com/users/esotericnonsense/orgs",
         "received_events_url" : "https://api.github.com/users/esotericnonsense/received_events",
         "repos_url" : "https://api.github.com/users/esotericnonsense/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/esotericnonsense/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/esotericnonsense/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/esotericnonsense"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Curious what the use case is for this. Makes sense, but I can't think of why a pruned node would actually want this.\r\n\r\nThat being said... I am uncomfortably excited by the idea of removing an index based on `CDiskBlockPos`. I have enough experience with logical/physical indexing schemes in my pre-Bitcoin life to feel strongly about this. Besides the pruning use case you just gave, using physical offsets now is trading a very small efficiency gain for a lot of pain in the future if we want to change the data format.\r\n\r\nNormally the way this is implemented in a real database is via a \"secondary index\", which is not supported by LevelDB natively. If you imagine we stored blocks in MySQL or Postgres, you might have an auto-increment \"block id\" that maps to the full block hash, and then the txindex would map to block ids instead of the full hash. This is similar to your idea of using block height. Dealing with actual block heights sounds kind of confusing because you'd either need to deal with reorgs, or have confusing code that ignores reorgs (the node is missing data afterall) that would make things more convoluted.\r\n\r\nSince this is a brainstorming issue, something else that's been on my mind is whether it's possible to support more exotic index types (e.g. address indexes) in a sane way with the existing LevelDB code. In general, having more flexible indexing code would be a big benefit. There's a lot of duplication in the existing index logic we have that could be cleaned up and made more efficient.",
      "created_at" : "2018-03-11T08:48:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12651#issuecomment-372099280",
      "id" : 372099280,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12651",
      "updated_at" : "2018-03-11T08:48:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372099280",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> [...] but I can't think of why a pruned node would actually want this.\r\n\r\nUse case: a secure and decentralised way to access and decompose a transaction by it's ID on low resource hardware. Usually, if you want a decentralised self-validated txindex, you need 100GB+ of free spaces.\r\n",
      "created_at" : "2018-03-11T12:09:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12651#issuecomment-372110491",
      "id" : 372110491,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12651",
      "updated_at" : "2018-03-11T12:09:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372110491",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "If I understand correctly, this would be very inefficient without additional extensions to the P2P protocol, since if you wanted to actually fetch the transaction data for a tx that's not in a locally stored block you would have to download the full block. I can see how it would be useful though if you were in a kind of semi-trusted setup (e.g. querying a full node that you can access over a local network).",
      "created_at" : "2018-03-13T05:54:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12651#issuecomment-372555239",
      "id" : 372555239,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12651",
      "updated_at" : "2018-03-13T05:54:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372555239",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If one has verified the chain on a pruned peer, fetching an already verified historical block (that has been pruned) seems secure to me.\r\nSeems ideal for merchants or other small businesses.\r\nIt allows one to securely fetch a transaction by it's ID with a overhead of ~1MB.\r\n\r\nAssume you have a node-in-a-box with limited disk space but you still want the ability to fetch all transaction by it's ID instead of using a block explorer.\r\n\r\nIdeally fetching arbitrary transactions would be avoided with use of the wallet as relevant-transaction cache... but still: users want the ability to fetch by TX ID and it seems to be worth to allow this on pruned peers since it's unrealistic to only have this possibility in the long run for non pruned peers.\r\n\r\nIt may also discourage the use of centralized validation (blockexplorers), or at least it gives low resource systems an alternative option.",
      "created_at" : "2018-03-13T06:06:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12651#issuecomment-372556896",
      "id" : 372556896,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12651",
      "updated_at" : "2018-03-13T06:06:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372556896",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   }
]
