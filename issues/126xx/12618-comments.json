[
   {
      "author_association" : "OWNER",
      "body" : "Is loadblk thread the only thread this is relevant for? what about the script verification threads?",
      "created_at" : "2018-03-06T19:03:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12618#issuecomment-370891217",
      "id" : 370891217,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12618",
      "updated_at" : "2018-03-06T19:03:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370891217",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Is this the windows equivalent?\r\n```cpp\r\nSetThreadPriority(GetCurrentThread(), THREAD_MODE_BACKGROUND_BEGIN)\r\n```",
      "created_at" : "2018-03-06T19:48:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12618#issuecomment-370905121",
      "id" : 370905121,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12618",
      "updated_at" : "2018-03-06T19:48:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370905121",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "On Linux `SCHED_BATCH` just prevents batch tasks from pre-empting normal tasks (i.e. normal tasks will run until their timeslice expires, or another normal tasks pre-empts them). When picking the next task to run the scheduler considers `SCHED_OTHER` (i.e. normal) and `SCHED_BATCH` tasks equally. This is why setting `SCHED_BATCH` tasks are only \"mildly disfavored\", because they'll still be considered to run using the normal metrics whenever the scheduler ticks (usually 100Hz or 1000Hz).\r\n\r\nIt sounds like Windows `THREAD_MODE_BACKGROUND_BEGIN` is [much more extreme](https://stackoverflow.com/questions/43051261/why-does-thread-mode-background-begin-cause-my-code-to-run-20x-slower-than-threa). It looks like maybe the Windows equivalent is `THREAD_PRIORITY_BELOW_NORMAL` but I do not know a lot about Windows.\r\n\r\nI don't know as much about the script verification threads. If we are going to set `SCHED_BATCH` for loadblk then it makes sense to me to set the script verification threads to `SCHED_BATCH` as well, at least until the loadblk thread completes. You can freely switch back from `SCHED_BATCH` to `SCHED_OTHER` so it would be possible to only run them in the batch mode while reindexing is happening, or we could just always have them set at batch priority.",
      "created_at" : "2018-03-06T20:34:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12618#issuecomment-370918802",
      "id" : 370918802,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12618",
      "updated_at" : "2018-03-06T20:34:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370918802",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK for this: \r\n\r\none note: you would want something realtime for scriptcheck threads while they are validating a block incoming from network -- we want these to take priority over other threads aggressively.\r\n",
      "created_at" : "2018-03-06T23:00:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12618#issuecomment-370960158",
      "id" : 370960158,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12618",
      "updated_at" : "2018-03-06T23:00:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370960158",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Re: Jeremy's comment, there are a few ways to increase the priority of the script verification thread to ensure low-latency block relay. On Linux there exists `SCHED_FIFO` and `SCHED_RR` threads which give threads semi-realtime scheduling guarantees, and can ensure that such threads are always prioritized above other threads. Linux also supports per-thread nice values (this is a Linux extension, POSIX specifies that nice values are per-process).\r\n\r\nUsing the other scheduling modes is better for realtime behavior, but somewhat dangerous because such threads can pre-empt all other non-realtime processes, meaning that this could be used as a DOS vector. Changing the nice value is a bit safer. I will probably look into this as part of another PR because I'd like to benchmark that change.",
      "created_at" : "2018-03-09T18:42:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12618#issuecomment-371908136",
      "id" : 371908136,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12618",
      "updated_at" : "2018-03-09T18:42:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/371908136",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   }
]
