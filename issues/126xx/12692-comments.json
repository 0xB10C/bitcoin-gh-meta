[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nVery nice!",
      "created_at" : "2018-03-15T10:06:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12692#issuecomment-373323988",
      "id" : 373323988,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12692",
      "updated_at" : "2018-03-15T10:06:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373323988",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The code actually looks good with `-fsanitize=undefined` and `-fsanitize=thread`, the test suite passes cleanly and my `bitcoind` seems fine with those options.\r\n\r\nThings are horribly broken if you try to use `-fsanitize=address`. If anyone wants to play with that option I recommend you use `--disable-asm`, otherwise you get segfaults in `sha256_sse4::Transform` (which I think is a bug in address sanitizer) and you can't get very far without that.",
      "created_at" : "2018-03-15T13:08:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12692#issuecomment-373369583",
      "id" : 373369583,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12692",
      "updated_at" : "2018-03-15T13:08:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373369583",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "I don't think we should add configure options for every possible sanitation flag. This might confuse people that are trying to build the software with a flurry of options. It looks like the beginning of trying to wrap all compiler options. Which is unnecessary as they can already be passed through `./configure CXXFLAGS=\"-fsanitize=magnetic-flux\"`.\r\n\r\nWhat about a single `--enable-sanitize=a,b,c` option where a b and c can be multiple such flags?",
      "created_at" : "2018-03-15T13:33:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12692#issuecomment-373376866",
      "id" : 373376866,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12692",
      "updated_at" : "2018-03-15T13:33:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373376866",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@laanwj But the sanitizers are mutually exclusive, right? I.e. you cannot run ASan and TSan at the same time.",
      "created_at" : "2018-03-15T14:06:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12692#issuecomment-373387238",
      "id" : 373387238,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12692",
      "updated_at" : "2018-03-15T14:32:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373387238",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@practicalswift Some are. Some are not. Different compilers may have different limitations in the future as well.",
      "created_at" : "2018-03-15T14:25:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12692#issuecomment-373393556",
      "id" : 373393556,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12692",
      "updated_at" : "2018-03-15T14:25:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373393556",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Also, it should be noted that the downside of these flags is not limited to performance overhead: they may also introduce security issues. (This is why it's discouraged to build your entire system with them enabled.)",
      "created_at" : "2018-03-15T14:27:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12692#issuecomment-373394419",
      "id" : 373394419,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12692",
      "updated_at" : "2018-03-15T14:27:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373394419",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@luke-jr Yes, good point!\r\n\r\nAfter thinking about it a bit more and in light of @luke-jr:s comment I think @laanwj:s suggested `--enable-sanitize=a,b,c` (or even better: `--enable-sanitizer=a,b,c` is the way to go.",
      "created_at" : "2018-03-15T14:31:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12692#issuecomment-373395849",
      "id" : 373395849,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12692",
      "updated_at" : "2018-03-15T14:36:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373395849",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@eklitzke While we're at it Ã¢ÂÂ what about allowing for MemorySanitizer (MSan: `-fsanitize=memory`) too? ",
      "created_at" : "2018-03-15T14:35:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12692#issuecomment-373397380",
      "id" : 373397380,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12692",
      "updated_at" : "2018-03-15T14:35:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373397380",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> @laanwj But the sanitizers are mutually exclusive, right? I.e. you cannot run ASan and TSan at the same time.\r\n\r\nThat's a subset right? In that case, the option would take only one argument. I was just illustrating how it generalizes to multiple. Mesa has similar option to provide a comma-separated list of drivers to build in, for example.",
      "created_at" : "2018-03-15T15:02:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12692#issuecomment-373407056",
      "id" : 373407056,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12692",
      "updated_at" : "2018-03-15T15:02:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373407056",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@laanwj Yes, you're right! I think `--enable-sanitizer=a,b,c` is a good idea.",
      "created_at" : "2018-03-15T15:05:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12692#issuecomment-373408240",
      "id" : 373408240,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12692",
      "updated_at" : "2018-03-15T15:05:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373408240",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12692#discussion_r174907923"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12692"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174907923"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Does AX_CHECK_LINK_FLAG not do what we want here?",
      "commit_id" : "78618b8b03db698fa60b28fc87346f64e5d6cd02",
      "created_at" : "2018-03-15T19:40:24Z",
      "diff_hunk" : "@@ -247,6 +268,27 @@ if test \"x$enable_debug\" = xyes; then\n     fi\n fi\n \n+# Checking for -fsanitize flags works differently from other compiler flags.\n+# That's because with GCC there's an implicit linking dependency on libasan,\n+# libtsan, etc. when using the related -fsanitize flags. Clang works\n+# differently: it statically links these dependencies. Therefore we can't use\n+# AC_CHECK_LIB to test this, we need to compile and link.\n+if test \"x$enable_asan\" = xyes; then",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12692#discussion_r174907923",
      "id" : 174907923,
      "original_commit_id" : "78618b8b03db698fa60b28fc87346f64e5d6cd02",
      "original_position" : 37,
      "path" : "configure.ac",
      "position" : 37,
      "pull_request_review_id" : 104352258,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12692",
      "updated_at" : "2018-03-15T19:40:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174907923",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12692#discussion_r174908426"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12692"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174908426"
         }
      },
      "author_association" : "MEMBER",
      "body" : "As mentioned in the debugging PR, Please add these to a SANITIZE_CXXFLAGS or DEBUG_CXXFLAGS or so, rather than CXXFLAGS directly.\r\n\r\nAdding to CXXFLAGS means that future tests will be done with sanitizers enabled, which can cause false-negatives.",
      "commit_id" : "78618b8b03db698fa60b28fc87346f64e5d6cd02",
      "created_at" : "2018-03-15T19:42:21Z",
      "diff_hunk" : "@@ -247,6 +268,27 @@ if test \"x$enable_debug\" = xyes; then\n     fi\n fi\n \n+# Checking for -fsanitize flags works differently from other compiler flags.\n+# That's because with GCC there's an implicit linking dependency on libasan,\n+# libtsan, etc. when using the related -fsanitize flags. Clang works\n+# differently: it statically links these dependencies. Therefore we can't use\n+# AC_CHECK_LIB to test this, we need to compile and link.\n+if test \"x$enable_asan\" = xyes; then\n+  BITCOIN_CHECK_COMPILE_FLAG_AND_LINK([-fsanitize=address],\n+                                      [CXXFLAGS=\"$CXXFLAGS -fsanitize=address\"],\n+                                      [AC_MSG_ERROR([-fsanitize=asan broken, check if you have libasan installed])])\n+fi\n+if test \"x$enable_tsan\" = xyes; then\n+  BITCOIN_CHECK_COMPILE_FLAG_AND_LINK([-fsanitize=thread],\n+                                      [CXXFLAGS=\"$CXXFLAGS -fsanitize=thread\"],",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12692#discussion_r174908426",
      "id" : 174908426,
      "original_commit_id" : "78618b8b03db698fa60b28fc87346f64e5d6cd02",
      "original_position" : 44,
      "path" : "configure.ac",
      "position" : 44,
      "pull_request_review_id" : 104352818,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12692",
      "updated_at" : "2018-03-15T19:42:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174908426",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   }
]
