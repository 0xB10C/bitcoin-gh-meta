[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r172936877"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172936877"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Snake case is for variables.",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-03-07T18:20:42Z",
      "diff_hunk" : "@@ -1055,11 +1055,10 @@ void CTxMemPool::TrimToSize(size_t sizelimit, std::vector<COutPoint>* pvNoSpends\n     }\n }\n \n-bool CTxMemPool::TransactionWithinChainLimit(const uint256& txid, size_t chainLimit) const {\n+int64_t CTxMemPool::chain_limit_value(const uint256& txid) const {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r172936877",
      "id" : 172936877,
      "original_commit_id" : "667592e1b6b2d5532037fe6c290079a99691757e",
      "original_position" : 5,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 102040832,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172936877",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r172938327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172938327"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If not in the mempool could return 0 since `GetCountWithAncestors` and `GetCountWithDescendants` are always `> 0` (self is counted). In that case you can revert s/uint64_t/int64_t.",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-03-07T18:25:20Z",
      "diff_hunk" : "@@ -619,8 +619,10 @@ class CTxMemPool\n     /** Expire all transaction (and their dependencies) in the mempool older than time. Return the number of removed transactions. */\n     int Expire(int64_t time);\n \n-    /** Returns false if the transaction is in the mempool and not within the chain limit specified. */\n-    bool TransactionWithinChainLimit(const uint256& txid, size_t chainLimit) const;\n+    /** Get the maximum of the chain limit value in the mempool of the given transaction.\n+      * If the transaction is not in the mempool, -1 is returned.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r172938327",
      "id" : 172938327,
      "original_commit_id" : "667592e1b6b2d5532037fe6c290079a99691757e",
      "original_position" : 7,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 102040832,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172938327",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r172941467"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172941467"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It seems like we are moving to snake case, e.g. for new code like\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/a34ac6ae0788b50e12dd2c8ac59dbda2a03a3c2e/src/cuckoocache.h#L92\r\n\r\nMaybe I'm mistaken on that one. Will check recent merges.",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-03-07T18:35:00Z",
      "diff_hunk" : "@@ -1055,11 +1055,10 @@ void CTxMemPool::TrimToSize(size_t sizelimit, std::vector<COutPoint>* pvNoSpends\n     }\n }\n \n-bool CTxMemPool::TransactionWithinChainLimit(const uint256& txid, size_t chainLimit) const {\n+int64_t CTxMemPool::chain_limit_value(const uint256& txid) const {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r172941467",
      "id" : 172941467,
      "in_reply_to_id" : 172936877,
      "original_commit_id" : "667592e1b6b2d5532037fe6c290079a99691757e",
      "original_position" : 5,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 102046075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172941467",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r172956896"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172956896"
         }
      },
      "author_association" : "MEMBER",
      "body" : "From the developer notes:\r\n  - Variable and namespace names are all lowercase, and may use `_` to\r\n    separate words (snake_case).\r\n  - Class names, function names and method names are UpperCamelCase\r\n    (PascalCase).\r\n",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-03-07T19:25:20Z",
      "diff_hunk" : "@@ -1055,11 +1055,10 @@ void CTxMemPool::TrimToSize(size_t sizelimit, std::vector<COutPoint>* pvNoSpends\n     }\n }\n \n-bool CTxMemPool::TransactionWithinChainLimit(const uint256& txid, size_t chainLimit) const {\n+int64_t CTxMemPool::chain_limit_value(const uint256& txid) const {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r172956896",
      "id" : 172956896,
      "in_reply_to_id" : 172936877,
      "original_commit_id" : "667592e1b6b2d5532037fe6c290079a99691757e",
      "original_position" : 5,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 102064226,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172956896",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r172959441"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172959441"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I looked in the code and it seems to me they can be both 0 and that self is not counted.",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-03-07T19:33:29Z",
      "diff_hunk" : "@@ -619,8 +619,10 @@ class CTxMemPool\n     /** Expire all transaction (and their dependencies) in the mempool older than time. Return the number of removed transactions. */\n     int Expire(int64_t time);\n \n-    /** Returns false if the transaction is in the mempool and not within the chain limit specified. */\n-    bool TransactionWithinChainLimit(const uint256& txid, size_t chainLimit) const;\n+    /** Get the maximum of the chain limit value in the mempool of the given transaction.\n+      * If the transaction is not in the mempool, -1 is returned.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r172959441",
      "id" : 172959441,
      "in_reply_to_id" : 172938327,
      "original_commit_id" : "667592e1b6b2d5532037fe6c290079a99691757e",
      "original_position" : 7,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 102067102,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172959441",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r172964915"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172964915"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@NicolasDorier have you checked these?\r\nhttps://github.com/bitcoin/bitcoin/blob/a34ac6ae0788b50e12dd2c8ac59dbda2a03a3c2e/src/txmempool.cpp#L30\r\nhttps://github.com/bitcoin/bitcoin/blob/a34ac6ae0788b50e12dd2c8ac59dbda2a03a3c2e/src/txmempool.cpp#L36\r\nhttps://github.com/bitcoin/bitcoin/blob/a34ac6ae0788b50e12dd2c8ac59dbda2a03a3c2e/src/txmempool.cpp#L317\r\nhttps://github.com/bitcoin/bitcoin/blob/a34ac6ae0788b50e12dd2c8ac59dbda2a03a3c2e/src/txmempool.cpp#L326",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-03-07T19:52:36Z",
      "diff_hunk" : "@@ -619,8 +619,10 @@ class CTxMemPool\n     /** Expire all transaction (and their dependencies) in the mempool older than time. Return the number of removed transactions. */\n     int Expire(int64_t time);\n \n-    /** Returns false if the transaction is in the mempool and not within the chain limit specified. */\n-    bool TransactionWithinChainLimit(const uint256& txid, size_t chainLimit) const;\n+    /** Get the maximum of the chain limit value in the mempool of the given transaction.\n+      * If the transaction is not in the mempool, -1 is returned.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r172964915",
      "id" : 172964915,
      "in_reply_to_id" : 172938327,
      "original_commit_id" : "667592e1b6b2d5532037fe6c290079a99691757e",
      "original_position" : 7,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 102073721,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172964915",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r172984929"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172984929"
         }
      },
      "author_association" : "MEMBER",
      "body" : "woops, completely missed that indeed. I failed to notice how the clients were forcing this invariant though.",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-03-07T21:07:51Z",
      "diff_hunk" : "@@ -619,8 +619,10 @@ class CTxMemPool\n     /** Expire all transaction (and their dependencies) in the mempool older than time. Return the number of removed transactions. */\n     int Expire(int64_t time);\n \n-    /** Returns false if the transaction is in the mempool and not within the chain limit specified. */\n-    bool TransactionWithinChainLimit(const uint256& txid, size_t chainLimit) const;\n+    /** Get the maximum of the chain limit value in the mempool of the given transaction.\n+      * If the transaction is not in the mempool, -1 is returned.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r172984929",
      "id" : 172984929,
      "in_reply_to_id" : 172938327,
      "original_commit_id" : "667592e1b6b2d5532037fe6c290079a99691757e",
      "original_position" : 7,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 102097578,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172984929",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r172985902"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172985902"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Got confused when I saw [that](https://github.com/bitcoin/bitcoin/blob/9501dc27b336fc20adb0c367e0904b57bd507f51/src/txmempool.cpp#L857) which seemed to me it could be 0.",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-03-07T21:11:41Z",
      "diff_hunk" : "@@ -619,8 +619,10 @@ class CTxMemPool\n     /** Expire all transaction (and their dependencies) in the mempool older than time. Return the number of removed transactions. */\n     int Expire(int64_t time);\n \n-    /** Returns false if the transaction is in the mempool and not within the chain limit specified. */\n-    bool TransactionWithinChainLimit(const uint256& txid, size_t chainLimit) const;\n+    /** Get the maximum of the chain limit value in the mempool of the given transaction.\n+      * If the transaction is not in the mempool, -1 is returned.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r172985902",
      "id" : 172985902,
      "in_reply_to_id" : 172938327,
      "original_commit_id" : "667592e1b6b2d5532037fe6c290079a99691757e",
      "original_position" : 7,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 102098746,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172985902",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r173196924"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173196924"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Wow, okay. I totally missed that, thanks!",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-03-08T15:42:34Z",
      "diff_hunk" : "@@ -1055,11 +1055,10 @@ void CTxMemPool::TrimToSize(size_t sizelimit, std::vector<COutPoint>* pvNoSpends\n     }\n }\n \n-bool CTxMemPool::TransactionWithinChainLimit(const uint256& txid, size_t chainLimit) const {\n+int64_t CTxMemPool::chain_limit_value(const uint256& txid) const {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r173196924",
      "id" : 173196924,
      "in_reply_to_id" : 172936877,
      "original_commit_id" : "667592e1b6b2d5532037fe6c290079a99691757e",
      "original_position" : 5,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 102345321,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173196924",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r173197224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173197224"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I made the change for a reason but that reason may have been flawed. I'll try it with uint64_t and 0 again. Thanks!",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-03-08T15:43:32Z",
      "diff_hunk" : "@@ -619,8 +619,10 @@ class CTxMemPool\n     /** Expire all transaction (and their dependencies) in the mempool older than time. Return the number of removed transactions. */\n     int Expire(int64_t time);\n \n-    /** Returns false if the transaction is in the mempool and not within the chain limit specified. */\n-    bool TransactionWithinChainLimit(const uint256& txid, size_t chainLimit) const;\n+    /** Get the maximum of the chain limit value in the mempool of the given transaction.\n+      * If the transaction is not in the mempool, -1 is returned.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r173197224",
      "id" : 173197224,
      "in_reply_to_id" : 172938327,
      "original_commit_id" : "667592e1b6b2d5532037fe6c290079a99691757e",
      "original_position" : 7,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 102345657,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173197224",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r173215045"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173215045"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-03-08T16:37:11Z",
      "diff_hunk" : "@@ -1055,11 +1055,10 @@ void CTxMemPool::TrimToSize(size_t sizelimit, std::vector<COutPoint>* pvNoSpends\n     }\n }\n \n-bool CTxMemPool::TransactionWithinChainLimit(const uint256& txid, size_t chainLimit) const {\n+int64_t CTxMemPool::chain_limit_value(const uint256& txid) const {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r173215045",
      "id" : 173215045,
      "in_reply_to_id" : 172936877,
      "original_commit_id" : "667592e1b6b2d5532037fe6c290079a99691757e",
      "original_position" : 5,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 102367402,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173215045",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r173225129"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173225129"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The thing is, the check in `SelectCoinsMinConf` checks if the chain limit value `>= nMaxAncestors`, which is `0` for `no chained ancestors` in the code. With the old method, this would be true, but with a 0 returned, it would be false.\r\n\r\nI could change the `0` to a `1` to fix it, which may be a better solution here, and is probably what I will end up doing.",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-03-08T17:08:24Z",
      "diff_hunk" : "@@ -619,8 +619,10 @@ class CTxMemPool\n     /** Expire all transaction (and their dependencies) in the mempool older than time. Return the number of removed transactions. */\n     int Expire(int64_t time);\n \n-    /** Returns false if the transaction is in the mempool and not within the chain limit specified. */\n-    bool TransactionWithinChainLimit(const uint256& txid, size_t chainLimit) const;\n+    /** Get the maximum of the chain limit value in the mempool of the given transaction.\n+      * If the transaction is not in the mempool, -1 is returned.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r173225129",
      "id" : 173225129,
      "in_reply_to_id" : 172938327,
      "original_commit_id" : "667592e1b6b2d5532037fe6c290079a99691757e",
      "original_position" : 7,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 102379589,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173225129",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r173226846"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173226846"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If I do that, the semantics becomes misleading. It says 'max *ancestors*' so 1 makes it sound like it allows 1 ancestor or descendant, when in reality it only counts itself. I'm gonna keep the change to signed, for now.",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-03-08T17:14:24Z",
      "diff_hunk" : "@@ -619,8 +619,10 @@ class CTxMemPool\n     /** Expire all transaction (and their dependencies) in the mempool older than time. Return the number of removed transactions. */\n     int Expire(int64_t time);\n \n-    /** Returns false if the transaction is in the mempool and not within the chain limit specified. */\n-    bool TransactionWithinChainLimit(const uint256& txid, size_t chainLimit) const;\n+    /** Get the maximum of the chain limit value in the mempool of the given transaction.\n+      * If the transaction is not in the mempool, -1 is returned.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r173226846",
      "id" : 173226846,
      "in_reply_to_id" : 172938327,
      "original_commit_id" : "667592e1b6b2d5532037fe6c290079a99691757e",
      "original_position" : 7,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 102381640,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173226846",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r173249025"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173249025"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Indeed, now:\r\n\r\nwith @promag suggestion,  if `nMaxAncestors==0` and the tx is not in mempool then `mempool.ChainLimitValue(pcoin->GetHash()) >= nMaxAncestors` evaluate to `true`.\r\n\r\nWhile before `!mempool.TransactionWithinChainLimit(pcoin->GetHash(), nMaxAncestors)` evaluate to `false`.",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-03-08T18:32:31Z",
      "diff_hunk" : "@@ -619,8 +619,10 @@ class CTxMemPool\n     /** Expire all transaction (and their dependencies) in the mempool older than time. Return the number of removed transactions. */\n     int Expire(int64_t time);\n \n-    /** Returns false if the transaction is in the mempool and not within the chain limit specified. */\n-    bool TransactionWithinChainLimit(const uint256& txid, size_t chainLimit) const;\n+    /** Get the maximum of the chain limit value in the mempool of the given transaction.\n+      * If the transaction is not in the mempool, -1 is returned.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r173249025",
      "id" : 173249025,
      "in_reply_to_id" : 172938327,
      "original_commit_id" : "667592e1b6b2d5532037fe6c290079a99691757e",
      "original_position" : 7,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 102408048,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173249025",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK b0928df",
      "created_at" : "2018-03-08T18:33:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#issuecomment-371580080",
      "id" : 371580080,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12634",
      "updated_at" : "2018-03-08T18:33:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/371580080",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 8154223.",
      "created_at" : "2018-05-15T13:32:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#issuecomment-389167631",
      "id" : 389167631,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12634",
      "updated_at" : "2018-05-15T13:32:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/389167631",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I find this whole thing unnecessarily confusing. Not your change in particular, more how the code works today.\r\n\r\nThere are two separate config limits, `-limitancestorcount` and `-limitdescendantcount`, which are treated as the same and merged into a single limit `nMaxChainLength`. Then that value is compared against both the ancestor count and descendant count of the transaction containing the candidate output. So first, it seems like there should be a separate `max_descendants` field on EligibilityFilter.\r\n\r\nBut further, the descendants check isn't even right: the documentation says \"Do not accept transactions if any ancestor would have <n> or more in-mempool descendants\". So the descendants check really needs to check the descendants count on all ancestors, not just the direct parent.\r\n\r\nRegardless of all that, even just looking at the ancestors limit, which is easier to check, I think it should not be a strict equality check, whereas it is currently in the code. If trying to spend an output from a transaction with 3 ancestors, the spending transaction would have 4 ancestors. Say the ancestor limit is 3. The code currently would call that spend ineligible because GetCountWithAncestors returns 3, and there is a strict < check, whereas the spend should be allowed because the ancestor count is not above the limit. So that is to say `TransactionLimitValue` can return 0 on the case where the tx is not in the mempool.",
      "created_at" : "2018-05-18T22:29:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#issuecomment-390349147",
      "id" : 390349147,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12634",
      "updated_at" : "2018-05-18T22:29:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/390349147",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jimpo Yeah it's not entirely straightforward that's for sure, and I think further consideration should be given. I don't think this PR makes the situation worse, though.",
      "created_at" : "2018-05-19T01:44:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#issuecomment-390369692",
      "id" : 390369692,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12634",
      "updated_at" : "2018-05-19T01:44:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/390369692",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Well, I think it does make things worse because it formalizes the concept of a `chain_limit_value`, which is a broken concept. If such a value were useful, it should really be two things, the count of ancestors and the max count of descendants of any ancestor. But furthermore, to calculate them (especially the latter), it's helpful to have an explicit limit on the depth of recursive searching, which is why they are passed into the mempool function rather than returned from it. To see what I mean, see `CalculateMemPoolAncestors`, which implements this sort of checking.",
      "created_at" : "2018-05-19T17:42:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#issuecomment-390421080",
      "id" : 390421080,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12634",
      "updated_at" : "2018-05-19T17:42:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/390421080",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jimpo Thanks for spelling it out. To summarize:\r\n\r\n1. The max ancestors and max descendants stuff is needlessly complex and can be simplified.\r\n2. It is also broken.\r\n3. It can be replaced with a single value (e.g. `max descendants`) that checks the descendant count of the top parent in the mempool.\r\n\r\nDoes that seem accurate?",
      "created_at" : "2018-05-21T00:43:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#issuecomment-390526011",
      "id" : 390526011,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12634",
      "updated_at" : "2018-05-21T00:43:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/390526011",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Delving into this a bit further, the ascendant vs descendant thing is quite different. There's usually only one ascendant per transaction except if several transactions were merged together, while there can be a tree of transactions as descendants.\r\n\r\nI'm wondering if this should instead be \"max unconfirmed group size\", and default to the sum of the default values for max descendants/ascendants.",
      "created_at" : "2018-05-21T02:02:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#issuecomment-390533449",
      "id" : 390533449,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12634",
      "updated_at" : "2018-05-21T02:07:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/390533449",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Actually, I think the more straightforward fix here is to fix ~~the description of max descendants~~  the max descendants check, and to add it to the eligibility filter.\r\n\r\nThis PR can then be rewritten to take both max ancestors and max descendants. That would address your concerns, right?",
      "created_at" : "2018-05-21T02:08:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#issuecomment-390534179",
      "id" : 390534179,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12634",
      "updated_at" : "2018-05-21T03:33:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/390534179",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jimpo \r\n\r\n* 2d8748b adds a `max_descendants` to the eligibility class and uses it in the eligibility method in coin selection\r\n* 4e742ba addresses the max descendants check to iterate over parents and using the top parent's descendant count. This is not exact, because a tx with multiple parents in the mempool will pick one of them and only use its values, but it's better than what we are doing right now.\r\n\r\nWould you mind checking that out and seeing if it looks okay to you?",
      "created_at" : "2018-05-21T04:06:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#issuecomment-390547697",
      "id" : 390547697,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12634",
      "updated_at" : "2018-05-21T04:06:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/390547697",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r189515577"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189515577"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe add some bounds-checking asserts here ala `assert(int64_t(nCountWithDescendants) > 0);`",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-05-21T07:43:36Z",
      "diff_hunk" : "@@ -1055,11 +1055,25 @@ void CTxMemPool::TrimToSize(size_t sizelimit, std::vector<COutPoint>* pvNoSpends\n     }\n }\n \n-bool CTxMemPool::TransactionWithinChainLimit(const uint256& txid, size_t chainLimit) const {\n+uint64_t CTxMemPool::CalculateDescendantMaximum(txiter entry) const {\n+    // find top parent\n+    txiter top = entry;\n+    for (;;) {\n+        const setEntries& parents = GetMemPoolParents(top);\n+        if (parents.size() == 0) break;\n+        top = *parents.begin();\n+    }\n+    return top->GetCountWithDescendants();\n+}\n+\n+void CTxMemPool::GetTransactionAncestry(const uint256& txid, int64_t& ancestors, int64_t& descendants) const {\n     LOCK(cs);\n     auto it = mapTx.find(txid);\n-    return it == mapTx.end() || (it->GetCountWithAncestors() < chainLimit &&\n-       it->GetCountWithDescendants() < chainLimit);\n+    ancestors = descendants = -1;\n+    if (it != mapTx.end()) {\n+        ancestors = it->GetCountWithAncestors();\n+        descendants = (int64_t)CalculateDescendantMaximum(it);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r189515577",
      "id" : 189515577,
      "original_commit_id" : "d8864ab573d8fdb1acef000ddee7f5f8cc157b64",
      "original_position" : 24,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 121707926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189515577",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r189631391"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189631391"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "commit: Switch to GetTransactionAncestry() in OutputEligibleForSpending\r\n\r\nI think these should be strict `>` checks, in which case you don't need to switch to signed results. This makes sense logically because ancestors and descendants counts includes the transaction queried, so if the count is at the maximum allowable, it is still valid to create one more in the chain.",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-05-21T15:51:51Z",
      "diff_hunk" : "@@ -2467,8 +2467,11 @@ bool CWallet::OutputEligibleForSpending(const COutput& output, const CoinEligibi\n     if (output.nDepth < (output.tx->IsFromMe(ISMINE_ALL) ? eligibility_filter.conf_mine : eligibility_filter.conf_theirs))\n         return false;\n \n-    if (!mempool.TransactionWithinChainLimit(output.tx->GetHash(), eligibility_filter.max_ancestors, eligibility_filter.max_descendants))\n+    int64_t ancestors, descendants;\n+    mempool.GetTransactionAncestry(output.tx->GetHash(), ancestors, descendants);\n+    if (ancestors >= eligibility_filter.max_ancestors || descendants >= eligibility_filter.max_descendants) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r189631391",
      "id" : 189631391,
      "original_commit_id" : "33eca3e0ea1c1c54b3f088d597e0a0da7c657dbe",
      "original_position" : 7,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 121848321,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189631391",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r189632127"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189632127"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "commit: mempool: Fix max descendants check\r\n\r\nYou actually need to recurse down all parents and take the max `GetCountWithDescendants` of all ancestors. A transaction can have multiple chains of ancestry with different descendants counts. This is also why it kind of makes sense to take the descendants limit as a parameter to this method rather than (or in addition to) returning it -- because it can limit the recursion. ",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-05-21T15:54:29Z",
      "diff_hunk" : "@@ -1055,11 +1055,22 @@ void CTxMemPool::TrimToSize(size_t sizelimit, std::vector<COutPoint>* pvNoSpends\n     }\n }\n \n+uint64_t CTxMemPool::CalculateDescendantMaximum(txiter entry) const {\n+    // find top parent\n+    txiter top = entry;\n+    for (;;) {\n+        const setEntries& parents = GetMemPoolParents(top);\n+        if (parents.size() == 0) break;\n+        top = *parents.begin();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r189632127",
      "id" : 189632127,
      "original_commit_id" : "4e742baf11f9bba05d16ac67a1981885bf590498",
      "original_position" : 10,
      "path" : "src/txmempool.cpp",
      "position" : 11,
      "pull_request_review_id" : 121848321,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189632127",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r189742119"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189742119"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was afraid that would be too resource intensive and potential for DoS. Doing a 'depth first optimistic pass' seemed like a good estimate.",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-05-21T23:35:17Z",
      "diff_hunk" : "@@ -1055,11 +1055,22 @@ void CTxMemPool::TrimToSize(size_t sizelimit, std::vector<COutPoint>* pvNoSpends\n     }\n }\n \n+uint64_t CTxMemPool::CalculateDescendantMaximum(txiter entry) const {\n+    // find top parent\n+    txiter top = entry;\n+    for (;;) {\n+        const setEntries& parents = GetMemPoolParents(top);\n+        if (parents.size() == 0) break;\n+        top = *parents.begin();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r189742119",
      "id" : 189742119,
      "in_reply_to_id" : 189632127,
      "original_commit_id" : "4e742baf11f9bba05d16ac67a1981885bf590498",
      "original_position" : 10,
      "path" : "src/txmempool.cpp",
      "position" : 11,
      "pull_request_review_id" : 121980196,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189742119",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r189742212"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189742212"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It means having to change the parameter for all the calls (bump by 1), but I think you're right. The -1 hack is bad. Fixing.",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-05-21T23:35:56Z",
      "diff_hunk" : "@@ -2467,8 +2467,11 @@ bool CWallet::OutputEligibleForSpending(const COutput& output, const CoinEligibi\n     if (output.nDepth < (output.tx->IsFromMe(ISMINE_ALL) ? eligibility_filter.conf_mine : eligibility_filter.conf_theirs))\n         return false;\n \n-    if (!mempool.TransactionWithinChainLimit(output.tx->GetHash(), eligibility_filter.max_ancestors, eligibility_filter.max_descendants))\n+    int64_t ancestors, descendants;\n+    mempool.GetTransactionAncestry(output.tx->GetHash(), ancestors, descendants);\n+    if (ancestors >= eligibility_filter.max_ancestors || descendants >= eligibility_filter.max_descendants) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r189742212",
      "id" : 189742212,
      "in_reply_to_id" : 189631391,
      "original_commit_id" : "33eca3e0ea1c1c54b3f088d597e0a0da7c657dbe",
      "original_position" : 7,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 121980298,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189742212",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r189742259"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189742259"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm going to switch back to unsigned, so no need.",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-05-21T23:36:22Z",
      "diff_hunk" : "@@ -1055,11 +1055,25 @@ void CTxMemPool::TrimToSize(size_t sizelimit, std::vector<COutPoint>* pvNoSpends\n     }\n }\n \n-bool CTxMemPool::TransactionWithinChainLimit(const uint256& txid, size_t chainLimit) const {\n+uint64_t CTxMemPool::CalculateDescendantMaximum(txiter entry) const {\n+    // find top parent\n+    txiter top = entry;\n+    for (;;) {\n+        const setEntries& parents = GetMemPoolParents(top);\n+        if (parents.size() == 0) break;\n+        top = *parents.begin();\n+    }\n+    return top->GetCountWithDescendants();\n+}\n+\n+void CTxMemPool::GetTransactionAncestry(const uint256& txid, int64_t& ancestors, int64_t& descendants) const {\n     LOCK(cs);\n     auto it = mapTx.find(txid);\n-    return it == mapTx.end() || (it->GetCountWithAncestors() < chainLimit &&\n-       it->GetCountWithDescendants() < chainLimit);\n+    ancestors = descendants = -1;\n+    if (it != mapTx.end()) {\n+        ancestors = it->GetCountWithAncestors();\n+        descendants = (int64_t)CalculateDescendantMaximum(it);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r189742259",
      "id" : 189742259,
      "in_reply_to_id" : 189515577,
      "original_commit_id" : "d8864ab573d8fdb1acef000ddee7f5f8cc157b64",
      "original_position" : 24,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 121980358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189742259",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r189761725"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189761725"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I had to do one minor tweak, but otherwise the current values worked even with the change. I also switched from `nMaxChainLength` to using `max_ancestors` and `max_descendants` with their corresponding defaults. (See 6ab847bce76224ff46552dd647b542fa70350a91.)",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-05-22T02:15:23Z",
      "diff_hunk" : "@@ -2467,8 +2467,11 @@ bool CWallet::OutputEligibleForSpending(const COutput& output, const CoinEligibi\n     if (output.nDepth < (output.tx->IsFromMe(ISMINE_ALL) ? eligibility_filter.conf_mine : eligibility_filter.conf_theirs))\n         return false;\n \n-    if (!mempool.TransactionWithinChainLimit(output.tx->GetHash(), eligibility_filter.max_ancestors, eligibility_filter.max_descendants))\n+    int64_t ancestors, descendants;\n+    mempool.GetTransactionAncestry(output.tx->GetHash(), ancestors, descendants);\n+    if (ancestors >= eligibility_filter.max_ancestors || descendants >= eligibility_filter.max_descendants) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r189761725",
      "id" : 189761725,
      "in_reply_to_id" : 189631391,
      "original_commit_id" : "33eca3e0ea1c1c54b3f088d597e0a0da7c657dbe",
      "original_position" : 7,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 122002455,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189761725",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r190026352"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190026352"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This underflows if nMaxChainLength is 0.",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-05-22T19:34:06Z",
      "diff_hunk" : "@@ -2592,7 +2592,7 @@ bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAm\n         (m_spend_zero_conf_change && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, CoinEligibilityFilter(0, 1, 2), vCoins, setCoinsRet, nValueRet, coin_selection_params, bnb_used)) ||\n         (m_spend_zero_conf_change && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, CoinEligibilityFilter(0, 1, std::min((size_t)4, nMaxChainLength/3)), vCoins, setCoinsRet, nValueRet, coin_selection_params, bnb_used)) ||\n         (m_spend_zero_conf_change && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, CoinEligibilityFilter(0, 1, nMaxChainLength/2), vCoins, setCoinsRet, nValueRet, coin_selection_params, bnb_used)) ||\n-        (m_spend_zero_conf_change && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, CoinEligibilityFilter(0, 1, nMaxChainLength), vCoins, setCoinsRet, nValueRet, coin_selection_params, bnb_used)) ||\n+        (m_spend_zero_conf_change && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, CoinEligibilityFilter(0, 1, nMaxChainLength-1), vCoins, setCoinsRet, nValueRet, coin_selection_params, bnb_used)) ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r190026352",
      "id" : 190026352,
      "original_commit_id" : "2e5606f1986287621a3daa51dc3e341baccf0ad0",
      "original_position" : 17,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 122320066,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T19:42:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190026352",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r190027446"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190027446"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This underflows if max_ancestors or max_descendants is 0.",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-05-22T19:38:07Z",
      "diff_hunk" : "@@ -2583,16 +2583,17 @@ bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAm\n             ++it;\n     }\n \n-    size_t nMaxChainLength = std::min(gArgs.GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT), gArgs.GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT));\n+    size_t max_ancestors = gArgs.GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT);\n+    size_t max_descendants = gArgs.GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT);\n     bool fRejectLongChains = gArgs.GetBoolArg(\"-walletrejectlongchains\", DEFAULT_WALLET_REJECT_LONG_CHAINS);\n \n     bool res = nTargetValue <= nValueFromPresetInputs ||\n         SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, CoinEligibilityFilter(1, 6, 0), vCoins, setCoinsRet, nValueRet, coin_selection_params, bnb_used) ||\n         SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, CoinEligibilityFilter(1, 1, 0), vCoins, setCoinsRet, nValueRet, coin_selection_params, bnb_used) ||\n         (m_spend_zero_conf_change && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, CoinEligibilityFilter(0, 1, 2), vCoins, setCoinsRet, nValueRet, coin_selection_params, bnb_used)) ||\n-        (m_spend_zero_conf_change && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, CoinEligibilityFilter(0, 1, std::min((size_t)4, nMaxChainLength/3)), vCoins, setCoinsRet, nValueRet, coin_selection_params, bnb_used)) ||\n-        (m_spend_zero_conf_change && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, CoinEligibilityFilter(0, 1, nMaxChainLength/2), vCoins, setCoinsRet, nValueRet, coin_selection_params, bnb_used)) ||\n-        (m_spend_zero_conf_change && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, CoinEligibilityFilter(0, 1, nMaxChainLength-1), vCoins, setCoinsRet, nValueRet, coin_selection_params, bnb_used)) ||\n+        (m_spend_zero_conf_change && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, CoinEligibilityFilter(0, 1, std::min((size_t)4, max_ancestors/3), std::min((size_t)4, max_descendants/3)), vCoins, setCoinsRet, nValueRet, coin_selection_params, bnb_used)) ||\n+        (m_spend_zero_conf_change && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, CoinEligibilityFilter(0, 1, max_ancestors/2, max_descendants/2), vCoins, setCoinsRet, nValueRet, coin_selection_params, bnb_used)) ||\n+        (m_spend_zero_conf_change && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, CoinEligibilityFilter(0, 1, max_ancestors-1, max_descendants-1), vCoins, setCoinsRet, nValueRet, coin_selection_params, bnb_used)) ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r190027446",
      "id" : 190027446,
      "original_commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "original_position" : 18,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 122320066,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T19:42:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190027446",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r190028623"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190028623"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm, I understand the concern, but this doesn't match the advertised behavior of the flag. Also, the ancestor limit can be used to limit the depth of recursion. I'd like some more opinions on this.",
      "commit_id" : "d9b765b2b066b642e0ad9a45bd8f3aab788e8f38",
      "created_at" : "2018-05-22T19:42:01Z",
      "diff_hunk" : "@@ -1055,11 +1055,22 @@ void CTxMemPool::TrimToSize(size_t sizelimit, std::vector<COutPoint>* pvNoSpends\n     }\n }\n \n+uint64_t CTxMemPool::CalculateDescendantMaximum(txiter entry) const {\n+    // find top parent\n+    txiter top = entry;\n+    for (;;) {\n+        const setEntries& parents = GetMemPoolParents(top);\n+        if (parents.size() == 0) break;\n+        top = *parents.begin();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12634#discussion_r190028623",
      "id" : 190028623,
      "in_reply_to_id" : 189632127,
      "original_commit_id" : "4e742baf11f9bba05d16ac67a1981885bf590498",
      "original_position" : 10,
      "path" : "src/txmempool.cpp",
      "position" : 11,
      "pull_request_review_id" : 122320066,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12634",
      "updated_at" : "2018-05-22T19:42:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/190028623",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   }
]
