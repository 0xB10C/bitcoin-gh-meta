[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306501234"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306501234"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd prefer to make the call to `GetDataDir` in the cpp file.",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-23T19:48:28Z",
      "diff_hunk" : "@@ -19,6 +19,8 @@\n #include <script/script_error.h>\n #include <sync.h>\n #include <txmempool.h> // For CTxMemPool::cs\n+#include <txdb.h>\n+#include <util/system.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306501234",
      "id" : 306501234,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjUwMTIzNA==",
      "original_commit_id" : "e56af43d8dfccd50f0163a0d63019fdc4f9023e7",
      "original_position" : 5,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 265637148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306501234",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306501435"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306501435"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why are you removing the comment that this data is protected by cs_main?",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-23T19:48:58Z",
      "diff_hunk" : "@@ -659,11 +718,7 @@ CChain& ChainActive();\n /** @returns the global block index map. */\n BlockMap& BlockIndex();\n \n-/** Global variable that points to the coins database (protected by cs_main) */\n-extern std::unique_ptr<CCoinsViewDB> pcoinsdbview;\n-\n-/** Global variable that points to the active CCoinsView (protected by cs_main) */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306501435",
      "id" : 306501435,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjUwMTQzNQ==",
      "original_commit_id" : "e56af43d8dfccd50f0163a0d63019fdc4f9023e7",
      "original_position" : 119,
      "path" : "src/validation.h",
      "position" : 133,
      "pull_request_review_id" : 265637148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306501435",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306502062"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306502062"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    const CCoinsViewCache& coins_cache = ::ChainstateActive().CoinsTip();\r\n```",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-23T19:50:29Z",
      "diff_hunk" : "@@ -3853,12 +3873,13 @@ bool static LoadBlockIndexDB(const CChainParams& chainparams) EXCLUSIVE_LOCKS_RE\n bool LoadChainTip(const CChainParams& chainparams)\n {\n     AssertLockHeld(cs_main);\n-    assert(!pcoinsTip->GetBestBlock().IsNull()); // Never called when the coins view is empty\n+    CCoinsViewCache* coins_cache = &::ChainstateActive().CoinsTip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306502062",
      "id" : 306502062,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjUwMjA2Mg==",
      "original_commit_id" : "e56af43d8dfccd50f0163a0d63019fdc4f9023e7",
      "original_position" : 204,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 265637148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306502062",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306502987"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306502987"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    return *g_chainstate;\r\n```",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-23T19:52:30Z",
      "diff_hunk" : "@@ -81,11 +81,17 @@ namespace {\n BlockManager g_blockman;\n } // anon namespace\n \n-static CChainState g_chainstate(g_blockman);\n+std::unique_ptr<CChainState> g_chainstate;\n \n-CChainState& ChainstateActive() { return g_chainstate; }\n+CChainState& ChainstateActive() {\n+    assert(g_chainstate);\n+    return *g_chainstate.get();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306502987",
      "id" : 306502987,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjUwMjk4Nw==",
      "original_commit_id" : "e56af43d8dfccd50f0163a0d63019fdc4f9023e7",
      "original_position" : 10,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 265637148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306502987",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306504014"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306504014"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            const CCoinsViewCache& coins_cache = ::ChainstateActive().CoinsTip();\r\n```",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-23T19:54:59Z",
      "diff_hunk" : "@@ -1291,11 +1291,12 @@ bool static AlreadyHave(const CInv& inv) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n                 LOCK(g_cs_orphans);\n                 if (mapOrphanTransactions.count(inv.hash)) return true;\n             }\n+            CCoinsViewCache& coins_cache = ::ChainstateActive().CoinsTip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306504014",
      "id" : 306504014,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjUwNDAxNA==",
      "original_commit_id" : "e56af43d8dfccd50f0163a0d63019fdc4f9023e7",
      "original_position" : 4,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 265637148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306504014",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16452](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16452.html) (refactor: use RelayTransaction in BroadcastTransaction utility by ariard)\n* [#16411](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16411.html) (Signet support by kallewoof)\n* [#16224](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16224.html) (gui: Bilingual GUI error messages by hebasto)\n* [#15997](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15997.html) (refactor: GuessVerificationProgress requires cs_main lock by promag)\n* [#15713](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15713.html) (refactor: Replace chain relayTransactions/submitMemoryPool by higher method by ariard)\n* [#15192](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15192.html) (Add missing cs_main locks in ThreadImport(...)/Shutdown(...)/gettxoutsetinfo(...)/InitScriptExecutionCache(). Add missing locking annotations. by practicalswift)\n* [#15169](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15169.html) (Parallelize CheckInputs() in AcceptToMemoryPool() by sdaftuar)\n* [#13868](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/13868.html) (Remove unused fScriptChecks parameter from CheckInputs by Empact)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-07-23T22:30:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#issuecomment-514407351",
      "id" : 514407351,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNDQwNzM1MQ==",
      "updated_at" : "2019-07-29T21:43:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/514407351",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306949954"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306949954"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: pcoinsTip -> CChainState::CoinsTip()\" (9edf6537f13b61952f77ab62c2221c2b18d9561a)\r\n\r\nHere and in rpc/blockchain.cpp, if you're going to introduce a new variable, it seems better to make it a reference than a raw pointer. (IMO at least it is best to reserve c++ pointers for nullable cases to refer to objects that may or may not exist, and c++ references to refer to objects that are assumed to exist).",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-24T18:11:09Z",
      "diff_hunk" : "@@ -513,12 +513,13 @@ static bool AcceptToMemoryPoolWorker(const CChainParams& chainparams, CTxMemPool\n         CCoinsViewCache view(&dummy);\n \n         LockPoints lp;\n-        CCoinsViewMemPool viewMemPool(pcoinsTip.get(), pool);\n+        CCoinsViewCache* coins_cache = &::ChainstateActive().CoinsTip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306949954",
      "id" : 306949954,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjk0OTk1NA==",
      "original_commit_id" : "9edf6537f13b61952f77ab62c2221c2b18d9561a",
      "original_position" : 43,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 266195630,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306949954",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306951381"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306951381"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: pcoinsTip -> CChainState::CoinsTip()\" (9edf6537f13b61952f77ab62c2221c2b18d9561a)\r\n\r\n> Why are you removing the comment that this data is protected by cs_main?\r\n\r\nSeems resolved now (comment is just moved).",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-24T18:14:28Z",
      "diff_hunk" : "@@ -659,11 +718,7 @@ CChain& ChainActive();\n /** @returns the global block index map. */\n BlockMap& BlockIndex();\n \n-/** Global variable that points to the coins database (protected by cs_main) */\n-extern std::unique_ptr<CCoinsViewDB> pcoinsdbview;\n-\n-/** Global variable that points to the active CCoinsView (protected by cs_main) */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306951381",
      "id" : 306951381,
      "in_reply_to_id" : 306501435,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjk1MTM4MQ==",
      "original_commit_id" : "e56af43d8dfccd50f0163a0d63019fdc4f9023e7",
      "original_position" : 119,
      "path" : "src/validation.h",
      "position" : 133,
      "pull_request_review_id" : 266195630,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306951381",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306954646"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306954646"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: add CoinsViews class\" (e5d83bf15bbf1f9359dcb6146dc5f12ae61d8720)\r\n\r\nThis doesn't seem to compile. CCoinsViewDB at this point takes 3 arguments not 4. Also could avoid raw pointer management and `new` call with member initialization and `MakeUnique`:\r\n\r\n```c++\r\n: m_dbview(MakeUnique<CCoinsViewDB>(cache_size_bytes, in_memory, should_wipe))\r\n```\r\n\r\nMember initialization is better because it ensure objects are destroyed in reverse order they are constructed, and raw pointers and news are just generally suspicious and should be avoided when you can make ownership explicit.",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-24T18:21:51Z",
      "diff_hunk" : "@@ -1038,6 +1038,18 @@ CAmount GetBlockSubsidy(int nHeight, const Consensus::Params& consensusParams)\n     return nSubsidy;\n }\n \n+CoinsViews::CoinsViews(\n+    std::string ldb_name,\n+    size_t cache_size_bytes,\n+    bool in_memory,\n+    bool should_wipe)\n+{\n+    m_dbview.reset(new CCoinsViewDB(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306954646",
      "id" : 306954646,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjk1NDY0Ng==",
      "original_commit_id" : "e5d83bf15bbf1f9359dcb6146dc5f12ae61d8720",
      "original_position" : 10,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 266195630,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306954646",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306974591"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306974591"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Cover UTXO set access with lock annotations\" (ceca2c92b79a8a2c5ae37d03e99de80ec55895c3)\r\n\r\nCommit message is a bit misleading imo, because this is adding a new lock, not just new annotations.\r\n\r\nBut more importantly, GetUTXOStats is acquiring and releasing cs_main internally, so this change seems like it is complicating locking and also locking too much. Maybe a change like the following would make sense?\r\n\r\n```diff\r\n-    LOCK(::cs_main);\r\n-    if (GetUTXOStats(&::ChainstateActive().CoinsDB(), stats)) {\r\n+    CCoinsView* coins_view = WITH_LOCK(cs_main, return &ChainstateActive().CoinsDB());\r\n+    if (GetUTXOStats(coins_view, stats)) {\r\n```",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-24T19:06:20Z",
      "diff_hunk" : "@@ -1062,6 +1062,8 @@ static UniValue gettxoutsetinfo(const JSONRPCRequest& request)\n \n     CCoinsStats stats;\n     ::ChainstateActive().ForceFlushStateToDisk();\n+\n+    LOCK(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306974591",
      "id" : 306974591,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjk3NDU5MQ==",
      "original_commit_id" : "ceca2c92b79a8a2c5ae37d03e99de80ec55895c3",
      "original_position" : 5,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 266195630,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306974591",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306984125"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306984125"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: have CCoins* data managed under CChainState\" (eed4e62ad6b162ff0d3e2b87eb8762a689678bca)\r\n\r\nCan you add a comment here about when it's appropriate to access `g_chainstate` variable directly, as opposed to calling `ChainstateActive()`? I see code in `init.cpp` is using both, but mostly the former, which is different than what I'd expect. I'd expect init code to just create a CChainState object and assign it it to `g_chainstate` once rather than accessing the `g_chainstate` global repeatedly.",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-24T19:30:58Z",
      "diff_hunk" : "@@ -686,8 +714,7 @@ CChain& ChainActive();\n /** @returns the global block index map. */\n BlockMap& BlockIndex();\n \n-/** Global variable that points to the coins database (protected by cs_main) */\n-extern std::unique_ptr<CCoinsViewDB> pcoinsdbview;\n+extern std::unique_ptr<CChainState> g_chainstate;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306984125",
      "id" : 306984125,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjk4NDEyNQ==",
      "original_commit_id" : "eed4e62ad6b162ff0d3e2b87eb8762a689678bca",
      "original_position" : 68,
      "path" : "src/validation.h",
      "position" : 138,
      "pull_request_review_id" : 266195630,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306984125",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306984839"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306984839"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: have CCoins* data managed under CChainState\" (eed4e62ad6b162ff0d3e2b87eb8762a689678bca)\r\n\r\nSuggest `x = MakeUnique<X>()` instead of `x.reset(new X())` to avoid raw pointers and new in C++, which are suspicious.",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-24T19:33:00Z",
      "diff_hunk" : "@@ -1050,6 +1054,21 @@ CoinsViews::CoinsViews(\n     m_cacheview.reset(new CCoinsViewCache(m_catcherview.get()));\n }\n \n+CChainState::CChainState(\n+    /* parameters forwarded to CoinsViews */\n+    size_t cache_size_bytes,\n+    bool in_memory,\n+    bool should_wipe,\n+    std::string leveldb_name\n+    // NOTE: for now m_blockman is set to a global, but this will be changed\n+    // in a future commit.\n+    ) : m_blockman(g_blockman)\n+{\n+    m_coins_views.reset(new CoinsViews(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306984839",
      "id" : 306984839,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjk4NDgzOQ==",
      "original_commit_id" : "eed4e62ad6b162ff0d3e2b87eb8762a689678bca",
      "original_position" : 44,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 266195630,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306984839",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306984979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306984979"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: have CCoins* data managed under CChainState\" (eed4e62ad6b162ff0d3e2b87eb8762a689678bca)\r\n\r\nSuggest `x = MakeUnique<X>()` instead of `x.reset(new X())` to avoid raw pointers and new in C++, which are suspicious.",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-24T19:33:24Z",
      "diff_hunk" : "@@ -1464,10 +1460,18 @@ bool AppInitMain(InitInterfaces& interfaces)\n             bool is_coinsview_empty;\n             try {\n                 LOCK(cs_main);\n+                g_chainstate.reset(new CChainState(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306984979",
      "id" : 306984979,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjk4NDk3OQ==",
      "original_commit_id" : "eed4e62ad6b162ff0d3e2b87eb8762a689678bca",
      "original_position" : 47,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 266195630,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306984979",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306985098"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306985098"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: have CCoins* data managed under CChainState\" (eed4e62ad6b162ff0d3e2b87eb8762a689678bca)\r\n\r\nSuggest `x = MakeUnique<X>()` instead of `x.reset(new X())` to avoid raw pointers and new in C++, which are suspicious.",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-24T19:33:41Z",
      "diff_hunk" : "@@ -82,8 +82,8 @@ TestingSetup::TestingSetup(const std::string& chainName) : BasicTestingSetup(cha\n \n     mempool.setSanityCheck(1.0);\n     pblocktree.reset(new CBlockTreeDB(1 << 20, true));\n-    pcoinsdbview.reset(new CCoinsViewDB(1 << 23, true));\n-    pcoinsTip.reset(new CCoinsViewCache(pcoinsdbview.get()));\n+    g_chainstate.reset(new CChainState(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306985098",
      "id" : 306985098,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjk4NTA5OA==",
      "original_commit_id" : "eed4e62ad6b162ff0d3e2b87eb8762a689678bca",
      "original_position" : 6,
      "path" : "src/test/setup_common.cpp",
      "position" : null,
      "pull_request_review_id" : 266195630,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306985098",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306986668"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306986668"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: have CCoins* data managed under CChainState\" (eed4e62ad6b162ff0d3e2b87eb8762a689678bca)\r\n\r\nCould you specify in the commit message whether this is changing initialization order in any significant way? It seems like utxo database is being loaded a lot earlier now.",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-24T19:38:11Z",
      "diff_hunk" : "@@ -1518,33 +1522,23 @@ bool AppInitMain(InitInterfaces& interfaces)\n                 // At this point we're either in reindex or we've loaded a useful\n                 // block tree into BlockIndex()!\n \n-                pcoinsdbview.reset(new CCoinsViewDB(nCoinDBCache, false, fReset || fReindexChainState));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306986668",
      "id" : 306986668,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjk4NjY2OA==",
      "original_commit_id" : "eed4e62ad6b162ff0d3e2b87eb8762a689678bca",
      "original_position" : 69,
      "path" : "src/init.cpp",
      "position" : 64,
      "pull_request_review_id" : 266195630,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306986668",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306988095"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306988095"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: have CCoins* data managed under CChainState\" (eed4e62ad6b162ff0d3e2b87eb8762a689678bca)\r\n\r\nCan we get rid of these default values? It seems like they are not actually used anymore, and default booleans params  in general tend to make code trickier to read and mask bugs.",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-24T19:41:50Z",
      "diff_hunk" : "@@ -48,7 +48,15 @@ class CCoinsViewDB final : public CCoinsView\n protected:\n     CDBWrapper db;\n public:\n-    explicit CCoinsViewDB(size_t nCacheSize, bool fMemory = false, bool fWipe = false);\n+    /**\n+     * @param[in] ldb_path    Location in the filesystem where leveldb data will be stored.\n+     */\n+    explicit CCoinsViewDB(\n+        fs::path ldb_path,\n+        size_t nCacheSize,\n+        bool fMemory = false,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306988095",
      "id" : 306988095,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjk4ODA5NQ==",
      "original_commit_id" : "eed4e62ad6b162ff0d3e2b87eb8762a689678bca",
      "original_position" : 11,
      "path" : "src/txdb.h",
      "position" : null,
      "pull_request_review_id" : 266195630,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306988095",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306998642"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306998642"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good point - since it was easy to do, I've tacked on a commit that adds lock annotations to the equivalent CoinsViews members.",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-24T20:08:25Z",
      "diff_hunk" : "@@ -659,11 +718,7 @@ CChain& ChainActive();\n /** @returns the global block index map. */\n BlockMap& BlockIndex();\n \n-/** Global variable that points to the coins database (protected by cs_main) */\n-extern std::unique_ptr<CCoinsViewDB> pcoinsdbview;\n-\n-/** Global variable that points to the active CCoinsView (protected by cs_main) */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r306998642",
      "id" : 306998642,
      "in_reply_to_id" : 306501435,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNjk5ODY0Mg==",
      "original_commit_id" : "e56af43d8dfccd50f0163a0d63019fdc4f9023e7",
      "original_position" : 119,
      "path" : "src/validation.h",
      "position" : 133,
      "pull_request_review_id" : 266257083,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/306998642",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307001210"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307001210"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah, oops - you're right. Shouldn't have tried to split those commits out.",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-24T20:15:47Z",
      "diff_hunk" : "@@ -1038,6 +1038,18 @@ CAmount GetBlockSubsidy(int nHeight, const Consensus::Params& consensusParams)\n     return nSubsidy;\n }\n \n+CoinsViews::CoinsViews(\n+    std::string ldb_name,\n+    size_t cache_size_bytes,\n+    bool in_memory,\n+    bool should_wipe)\n+{\n+    m_dbview.reset(new CCoinsViewDB(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307001210",
      "id" : 307001210,
      "in_reply_to_id" : 306954646,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNzAwMTIxMA==",
      "original_commit_id" : "e5d83bf15bbf1f9359dcb6146dc5f12ae61d8720",
      "original_position" : 10,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 266260680,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307001210",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307005027"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307005027"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah that's a good point - I forgot that `GetUTXOStats` only briefly acquires cs_main to get the height for a certain blockhash; it (counterintuitively) doesn't need to hold cs_main to iterate through the coins db because leveldb's implicit use of snapshots with cursors. \r\n\r\nI think the `WITH_LOCK` usage above obeys the letter of the law but not the spirit since technically the coinsdb could be modified in between that line and the GetUTXOStats call, but in this context I don't think it matters. Thanks for the suggestion!",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-24T20:25:24Z",
      "diff_hunk" : "@@ -1062,6 +1062,8 @@ static UniValue gettxoutsetinfo(const JSONRPCRequest& request)\n \n     CCoinsStats stats;\n     ::ChainstateActive().ForceFlushStateToDisk();\n+\n+    LOCK(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307005027",
      "id" : 307005027,
      "in_reply_to_id" : 306974591,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNzAwNTAyNw==",
      "original_commit_id" : "ceca2c92b79a8a2c5ae37d03e99de80ec55895c3",
      "original_position" : 5,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 266265511,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307005027",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the feedback, @ryanofsky. I think I've incorporated all of it.",
      "created_at" : "2019-07-24T21:52:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#issuecomment-514813701",
      "id" : 514813701,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNDgxMzcwMQ==",
      "updated_at" : "2019-07-24T21:52:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/514813701",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307074208"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307074208"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: You could document this constructor, at least referring to doc fields in `CDBWrapper` declaration\r\n\r\nsuper-nit: Also at first read, I found `CoinsViews` name confusing because we already have `CoinsView`, we could have `CoinsViewSet`",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-25T00:33:39Z",
      "diff_hunk" : "@@ -508,6 +508,24 @@ class BlockManager {\n /** Global variable that points to the active CCoinsView (protected by cs_main) */\n extern std::unique_ptr<CCoinsViewCache> pcoinsTip;\n \n+/**\n+ * A convenience class for constructing the CCoinsView* hierarchy used\n+ * to facilitate access to the UTXO set.\n+ */\n+class CoinsViews {\n+\n+public:\n+    std::unique_ptr<CCoinsViewDB> m_dbview;\n+    std::unique_ptr<CCoinsViewErrorCatcher> m_catcherview;\n+    std::unique_ptr<CCoinsViewCache> m_cacheview;\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307074208",
      "id" : 307074208,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNzA3NDIwOA==",
      "original_commit_id" : "09e6959ccb002680e312c319699364b5542d6c62",
      "original_position" : 30,
      "path" : "src/validation.h",
      "position" : 35,
      "pull_request_review_id" : 266347647,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307074208",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307082309"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307082309"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Did you remove it in last commit ? I still see it at d0e1e37",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-25T01:23:56Z",
      "diff_hunk" : "@@ -505,6 +505,9 @@ class BlockManager {\n         CBlockIndex** ppindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n };\n \n+/** Global variable that points to the active CCoinsView (protected by cs_main) */\n+extern std::unique_ptr<CCoinsViewCache> pcoinsTip;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307082309",
      "id" : 307082309,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNzA4MjMwOQ==",
      "original_commit_id" : "5fa4763f538b8bdb02d2205bbc01243709726a55",
      "original_position" : 5,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 266347647,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307082309",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307082780"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307082780"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Also comment in ATMP refers to it",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-25T01:27:07Z",
      "diff_hunk" : "@@ -505,6 +505,9 @@ class BlockManager {\n         CBlockIndex** ppindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n };\n \n+/** Global variable that points to the active CCoinsView (protected by cs_main) */\n+extern std::unique_ptr<CCoinsViewCache> pcoinsTip;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307082780",
      "id" : 307082780,
      "in_reply_to_id" : 307082309,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNzA4Mjc4MA==",
      "original_commit_id" : "5fa4763f538b8bdb02d2205bbc01243709726a55",
      "original_position" : 5,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 266347647,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307082780",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307085455"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307085455"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmmm is there any risk than having a default leveldb_name cause database collisions for different CChainState at some point ?",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-25T01:43:28Z",
      "diff_hunk" : "@@ -556,12 +574,21 @@ class CChainState {\n     //! easily as opposed to referencing a global.\n     BlockManager& m_blockman;\n \n+    //! Manages the UTXO set, which is a reflection of the contents of `m_chain`.\n+    std::unique_ptr<CoinsViews> m_coins_views;\n+\n public:\n-    CChainState(BlockManager& blockman) : m_blockman(blockman) { }\n+    CChainState(\n+        /* parameters forwarded to CoinsViews */\n+        size_t cache_size_bytes,\n+        bool in_memory,\n+        bool should_wipe,\n+        std::string leveldb_name = \"chainstate\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307085455",
      "id" : 307085455,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNzA4NTQ1NQ==",
      "original_commit_id" : "09e6959ccb002680e312c319699364b5542d6c62",
      "original_position" : 55,
      "path" : "src/validation.h",
      "position" : 71,
      "pull_request_review_id" : 266347647,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307085455",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307085845"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307085845"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit : I know these fields weren't documented as global, but maybe add comment explaining the aforementioned hierarchy between them",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-25T01:45:50Z",
      "diff_hunk" : "@@ -508,6 +508,24 @@ class BlockManager {\n /** Global variable that points to the active CCoinsView (protected by cs_main) */\n extern std::unique_ptr<CCoinsViewCache> pcoinsTip;\n \n+/**\n+ * A convenience class for constructing the CCoinsView* hierarchy used\n+ * to facilitate access to the UTXO set.\n+ */\n+class CoinsViews {\n+\n+public:\n+    std::unique_ptr<CCoinsViewDB> m_dbview;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307085845",
      "id" : 307085845,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNzA4NTg0NQ==",
      "original_commit_id" : "09e6959ccb002680e312c319699364b5542d6c62",
      "original_position" : 27,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 266347647,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307085845",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "`EXCLUSIVE_LOCK_REQUIRED` is checked at compile time, but only when the compiler has certain flags enabled (only on Clang, I believe).\r\n\r\n`AssertLockHeld` is checked at runtime when lock debugging is compiled in (available for all compilers, but only enabled in debug builds).",
      "created_at" : "2019-07-25T01:55:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#issuecomment-514863335",
      "id" : 514863335,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNDg2MzMzNQ==",
      "updated_at" : "2019-07-25T01:55:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/514863335",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes `EXCLUSIVE_LOCK_REQUIRED` is defined in `threadsafety.h` and is part of Clang static analysis on Mac OS X. But reviewing last commit, e.g in `ActivateBestChainStep` we only use `AssertLockHeld` but in fact we should use Clang attribute (or maybe both). Is there a consistent policy on which one to favour ?",
      "created_at" : "2019-07-25T02:01:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#issuecomment-514864651",
      "id" : 514864651,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNDg2NDY1MQ==",
      "updated_at" : "2019-07-25T02:01:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/514864651",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307311134"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307311134"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good catch! Forgot to remove this after I split out the `CoinsTip()` rename commit.",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-25T13:59:46Z",
      "diff_hunk" : "@@ -505,6 +505,9 @@ class BlockManager {\n         CBlockIndex** ppindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n };\n \n+/** Global variable that points to the active CCoinsView (protected by cs_main) */\n+extern std::unique_ptr<CCoinsViewCache> pcoinsTip;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307311134",
      "id" : 307311134,
      "in_reply_to_id" : 307082309,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNzMxMTEzNA==",
      "original_commit_id" : "5fa4763f538b8bdb02d2205bbc01243709726a55",
      "original_position" : 5,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 266644973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307311134",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307318877"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307318877"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This seems like something that would be caught pretty easily in tests if the confusion ever did happen, and I'm not sure if repeating `\"chainstate\"` in a few different places inline is any better. That said I'm happy to make this change if others agree it seems worthwhile.",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-25T14:14:57Z",
      "diff_hunk" : "@@ -556,12 +574,21 @@ class CChainState {\n     //! easily as opposed to referencing a global.\n     BlockManager& m_blockman;\n \n+    //! Manages the UTXO set, which is a reflection of the contents of `m_chain`.\n+    std::unique_ptr<CoinsViews> m_coins_views;\n+\n public:\n-    CChainState(BlockManager& blockman) : m_blockman(blockman) { }\n+    CChainState(\n+        /* parameters forwarded to CoinsViews */\n+        size_t cache_size_bytes,\n+        bool in_memory,\n+        bool should_wipe,\n+        std::string leveldb_name = \"chainstate\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307318877",
      "id" : 307318877,
      "in_reply_to_id" : 307085455,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNzMxODg3Nw==",
      "original_commit_id" : "09e6959ccb002680e312c319699364b5542d6c62",
      "original_position" : 55,
      "path" : "src/validation.h",
      "position" : 71,
      "pull_request_review_id" : 266655264,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307318877",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the look, @ariard. Feedback pushed.",
      "created_at" : "2019-07-25T15:30:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#issuecomment-515091980",
      "id" : 515091980,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNTA5MTk4MA==",
      "updated_at" : "2019-07-25T15:30:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/515091980",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "https://clang.llvm.org/docs/ThreadSafetyAnalysis.html#known-limitations",
      "created_at" : "2019-07-26T10:51:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#issuecomment-515408020",
      "id" : 515408020,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNTQwODAyMA==",
      "updated_at" : "2019-07-26T10:51:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/515408020",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "In commit 53c8d59d18 refactor: have CCoins* data managed under CChainState\r\n```\r\n   - The initialization order in init.cpp is changed slightly: the coinsdb (leveldb)\r\n      creation is moved to be earlier than block index and genesis block loading,\r\n      though this shouldn't have any noticeable effect.\r\n```\r\nCould you elaborate a bit more why it is save to flush the chainstate when shutdown is requested during the init sequence? As I read the code, previously we wouldn't flush and now we flush an empty db (potentially not having the best block hash set, because genesis is not loaded?).",
      "created_at" : "2019-07-26T12:15:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#issuecomment-515427932",
      "id" : 515427932,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNTQyNzkzMg==",
      "updated_at" : "2019-07-26T12:15:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/515427932",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307722194"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307722194"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why are you removing the mempool lock annotation? Aren't the lock annotations in the header correct?",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-26T12:35:21Z",
      "diff_hunk" : "@@ -2177,9 +2205,10 @@ void static UpdateTip(const CBlockIndex *pindexNew, const CChainParams& chainPar\n   * disconnectpool (note that the caller is responsible for mempool consistency\n   * in any case).\n   */\n-bool CChainState::DisconnectTip(CValidationState& state, const CChainParams& chainparams, DisconnectedBlockTransactions *disconnectpool)\n+bool CChainState::DisconnectTip(CValidationState& state, const CChainParams& chainparams, DisconnectedBlockTransactions* disconnectpool)\n+    EXCLUSIVE_LOCKS_REQUIRED(::cs_main)\n {\n-    CBlockIndex *pindexDelete = m_chain.Tip();\n+    CBlockIndex* pindexDelete = m_chain.Tip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307722194",
      "id" : 307722194,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNzcyMjE5NA==",
      "original_commit_id" : "c860b44ce33f424de7f0fe5f96efa65c58bdb531",
      "original_position" : 207,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 267160563,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307722194",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307722259"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307722259"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-26T12:35:30Z",
      "diff_hunk" : "@@ -2297,7 +2326,8 @@ class ConnectTrace {\n  *\n  * The block is added to connectTrace if connection succeeds.\n  */\n-bool CChainState::ConnectTip(CValidationState& state, const CChainParams& chainparams, CBlockIndex* pindexNew, const std::shared_ptr<const CBlock>& pblock, ConnectTrace& connectTrace, DisconnectedBlockTransactions &disconnectpool)\n+bool CChainState::ConnectTip(CValidationState& state, const CChainParams& chainparams, CBlockIndex* pindexNew, const std::shared_ptr<const CBlock>& pblock, ConnectTrace& connectTrace, DisconnectedBlockTransactions& disconnectpool)\n+    EXCLUSIVE_LOCKS_REQUIRED(::cs_main)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307722259",
      "id" : 307722259,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNzcyMjI1OQ==",
      "original_commit_id" : "c860b44ce33f424de7f0fe5f96efa65c58bdb531",
      "original_position" : 226,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 267160563,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307722259",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I am seeing segmentation faults when shutting down during init:\r\n\r\n```\r\n==4778== Thread 9 bitcoin-shutoff:\r\n==4778== Invalid read of size 4\r\n==4778==    at 0x4953BC: FlushBlockFile(bool) (validation.cpp:1548)\r\n==4778==    by 0x496B76: CChainState::FlushStateToDisk(CChainParams const&, CValidationState&, FlushStateMode, int) (validation.cpp:2061)\r\n==4778==    by 0x497AB5: CChainState::ForceFlushStateToDisk() (validation.cpp:2115)\r\n==4778==    by 0x32AE19: Shutdown(InitInterfaces&) (init.cpp:239)\r\n==4778==    by 0x223F6F: BitcoinCore::shutdown() (bitcoin.cpp:161)\r\n==4778==    by 0x58F4BF9: QObject::event(QEvent*) (in /usr/lib64/libQt5Core.so.5.12.4)\r\n==4778==    by 0x4BFCAF5: QApplicationPrivate::notify_helper(QObject*, QEvent*) (in /usr/lib64/libQt5Widgets.so.5.12.4)\r\n==4778==    by 0x4C05E7F: QApplication::notify(QObject*, QEvent*) (in /usr/lib64/libQt5Widgets.so.5.12.4)\r\n==4778==    by 0x58C9AE7: QCoreApplication::notifyInternal2(QObject*, QEvent*) (in /usr/lib64/libQt5Core.so.5.12.4)\r\n==4778==    by 0x58CCA92: QCoreApplicationPrivate::sendPostedEvents(QObject*, int, QThreadData*) (in /usr/lib64/libQt5Core.so.5.12.4)\r\n==4778==    by 0x591EE46: ??? (in /usr/lib64/libQt5Core.so.5.12.4)\r\n==4778==    by 0x6F2EEDC: g_main_context_dispatch (in /usr/lib64/libglib-2.0.so.0.6000.5)\r\n==4778==  Address 0x4 is not stack'd, malloc'd or (recently) free'd\r\n==4778== \r\n==4778== \r\n==4778== Process terminating with default action of signal 11 (SIGSEGV): dumping core\r\n==4778==  Access not within mapped region at address 0x4\r\n==4778==    at 0x4953BC: FlushBlockFile(bool) (validation.cpp:1548)\r\n==4778==    by 0x496B76: CChainState::FlushStateToDisk(CChainParams const&, CValidationState&, FlushStateMode, int) (validation.cpp:2061)\r\n==4778==    by 0x497AB5: CChainState::ForceFlushStateToDisk() (validation.cpp:2115)\r\n==4778==    by 0x32AE19: Shutdown(InitInterfaces&) (init.cpp:239)\r\n==4778==    by 0x223F6F: BitcoinCore::shutdown() (bitcoin.cpp:161)\r\n==4778==    by 0x58F4BF9: QObject::event(QEvent*) (in /usr/lib64/libQt5Core.so.5.12.4)\r\n==4778==    by 0x4BFCAF5: QApplicationPrivate::notify_helper(QObject*, QEvent*) (in /usr/lib64/libQt5Widgets.so.5.12.4)\r\n==4778==    by 0x4C05E7F: QApplication::notify(QObject*, QEvent*) (in /usr/lib64/libQt5Widgets.so.5.12.4)\r\n==4778==    by 0x58C9AE7: QCoreApplication::notifyInternal2(QObject*, QEvent*) (in /usr/lib64/libQt5Core.so.5.12.4)\r\n==4778==    by 0x58CCA92: QCoreApplicationPrivate::sendPostedEvents(QObject*, int, QThreadData*) (in /usr/lib64/libQt5Core.so.5.12.4)\r\n==4778==    by 0x591EE46: ??? (in /usr/lib64/libQt5Core.so.5.12.4)\r\n==4778==    by 0x6F2EEDC: g_main_context_dispatch (in /usr/lib64/libglib-2.0.so.0.6000.5)\r\n",
      "created_at" : "2019-07-26T12:35:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#issuecomment-515433681",
      "id" : 515433681,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNTQzMzY4MQ==",
      "updated_at" : "2019-07-26T12:35:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/515433681",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307785654"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307785654"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah you're right - dumb mistake on my part.",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-26T15:07:11Z",
      "diff_hunk" : "@@ -2177,9 +2205,10 @@ void static UpdateTip(const CBlockIndex *pindexNew, const CChainParams& chainPar\n   * disconnectpool (note that the caller is responsible for mempool consistency\n   * in any case).\n   */\n-bool CChainState::DisconnectTip(CValidationState& state, const CChainParams& chainparams, DisconnectedBlockTransactions *disconnectpool)\n+bool CChainState::DisconnectTip(CValidationState& state, const CChainParams& chainparams, DisconnectedBlockTransactions* disconnectpool)\n+    EXCLUSIVE_LOCKS_REQUIRED(::cs_main)\n {\n-    CBlockIndex *pindexDelete = m_chain.Tip();\n+    CBlockIndex* pindexDelete = m_chain.Tip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r307785654",
      "id" : 307785654,
      "in_reply_to_id" : 307722194,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNzc4NTY1NA==",
      "original_commit_id" : "c860b44ce33f424de7f0fe5f96efa65c58bdb531",
      "original_position" : 207,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 267243924,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-26T19:49:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/307785654",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Good catches, @MarcoFalke! I've [pushed fixes](https://github.com/bitcoin/bitcoin/compare/c860b44ce33f424de7f0fe5f96efa65c58bdb531..8cd527d72442e76cfc6dc848eb01b52f2a8f2d4c), including https://github.com/bitcoin/bitcoin/pull/16443/commits/e4b3247d4a67f248ff13bf43c378337ee993555b to solve the init bug you found. There are a few ways of addressing that one but I think an early exit from `FlushStateToDisk()` is the cleanest since it doesn't involve partial construction of `CoinsViews` or introducing more have-I-initialized-yet state, but let me know if you think there's a better way.",
      "created_at" : "2019-07-26T16:10:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#issuecomment-515511905",
      "id" : 515511905,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNTUxMTkwNQ==",
      "updated_at" : "2019-07-26T16:10:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/515511905",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> In commit [53c8d59](https://github.com/bitcoin/bitcoin/commit/53c8d59d182684f33f944e3513b56d3be4f557d2) refactor: have CCoins* data managed under CChainState\r\n> \r\n> ```\r\n>    - The initialization order in init.cpp is changed slightly: the coinsdb (leveldb)\r\n>       creation is moved to be earlier than block index and genesis block loading,\r\n>       though this shouldn't have any noticeable effect.\r\n> ```\r\n> \r\n> Could you elaborate a bit more why it is save to flush the chainstate when shutdown is requested during the init sequence?\r\n\r\nI'm also curious about the answer to this. Would be good to say what's motivating the move in the comment. I guess I also had a similar question previously:  https://github.com/bitcoin/bitcoin/pull/15606#discussion_r271901526",
      "created_at" : "2019-07-26T17:41:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#issuecomment-515539883",
      "id" : 515539883,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNTUzOTg4Mw==",
      "updated_at" : "2019-07-26T17:41:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/515539883",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky @MarcoFalke good points. I've abandoned trying to reorder the init.cpp stuff and now have separated the construction of `CChainState` from `CoinsViews` to preserve the existing order. ",
      "created_at" : "2019-07-26T19:53:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#issuecomment-515579006",
      "id" : 515579006,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNTU3OTAwNg==",
      "updated_at" : "2019-07-26T19:53:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/515579006",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r308993272"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/308993272"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Based on above discussion on lock annotations, you may use also `AssertLockHeld` here and in `UpdateTip`\r\n(also `AcceptToMemoryPoolWithTime`, `DisconnectTip`, `ConnectTip`)",
      "commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "created_at" : "2019-07-31T00:09:29Z",
      "diff_hunk" : "@@ -314,7 +314,8 @@ bool CheckSequenceLocks(const CTxMemPool& pool, const CTransaction& tx, int flag\n // Returns the script flags which should be checked for a given block\n static unsigned int GetBlockScriptFlags(const CBlockIndex* pindex, const Consensus::Params& chainparams);\n \n-static void LimitMempoolSize(CTxMemPool& pool, size_t limit, unsigned long age) EXCLUSIVE_LOCKS_REQUIRED(pool.cs)\n+static void LimitMempoolSize(CTxMemPool& pool, size_t limit, unsigned long age)\n+    EXCLUSIVE_LOCKS_REQUIRED(pool.cs, ::cs_main)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16443#discussion_r308993272",
      "id" : 308993272,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwODk5MzI3Mg==",
      "original_commit_id" : "4e307e5f5d676d01a94e1b645dcb0ee8574faf77",
      "original_position" : 6,
      "path" : "src/validation.cpp",
      "position" : 47,
      "pull_request_review_id" : 268729278,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16443",
      "updated_at" : "2019-07-31T00:18:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/308993272",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   }
]
