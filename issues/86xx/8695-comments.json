[
   {
      "body" : "Doesn't this need a protection to only do this once? (we wouldn't want to repeat failing commands every 1ms)",
      "created_at" : "2016-09-13T15:26:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8695#issuecomment-246719608",
      "id" : 246719608,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8695",
      "updated_at" : "2016-09-13T15:55:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/246719608",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj The address being connected it selected new each time the loop runs, because of how the logic works it won't try the same thing in a loop.",
      "created_at" : "2016-09-13T16:40:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8695#issuecomment-246744232",
      "id" : 246744232,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8695",
      "updated_at" : "2016-09-13T16:40:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/246744232",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=3",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "body" : "Sure, so it won't 'DoS' a single host, but what if there is a connection problem with a whole IP range? E.g. from the local network to the internet. Then you don't want to keep retrying every ms either.",
      "created_at" : "2016-09-14T16:35:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8695#issuecomment-247074003",
      "id" : 247074003,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8695",
      "updated_at" : "2016-09-14T16:35:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247074003",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj It re-tries every 500ms",
      "created_at" : "2016-09-15T12:36:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8695#issuecomment-247316067",
      "id" : 247316067,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8695",
      "updated_at" : "2016-09-15T12:36:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247316067",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=3",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "body" : "ACK.  Maybe it could use a comment to point out that it uses and depends on the outer loop sleep.",
      "created_at" : "2016-09-18T21:53:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8695#issuecomment-247883299",
      "id" : 247883299,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8695",
      "updated_at" : "2016-09-18T21:53:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247883299",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "rebased and comment added",
      "created_at" : "2016-11-14T22:25:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8695#issuecomment-260483493",
      "id" : 260483493,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8695",
      "updated_at" : "2016-11-14T22:25:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/260483493",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=3",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8695#discussion_r88082991"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8695"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88082991"
         }
      },
      "body" : "nNextFeeler is in microseconds, so you should reuse the value of the call to GetTimeMicros instead (or just assign 0, which will have the same effect).",
      "commit_id" : "ce1e69ab936188d989489f306a5e337cb60a6160",
      "created_at" : "2016-11-15T18:37:40Z",
      "diff_hunk" : "@@ -1734,7 +1734,15 @@ void ThreadOpenConnections()\n                 LogPrint(\"net\", \"Making feeler connection to %s\\n\", addrConnect.ToString());\n             }\n \n-            OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, NULL, false, fFeeler);\n+            int64_t nStartTime = GetTimeMicros();\n+\n+            bool fRet = OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, NULL, false, fFeeler);\n+\n+            // Retry feeler connection if OpenNetworkConnection fails in under 1ms.\n+            // Avoids issues with feelers to IP space we don't know how to route.\n+            if (!fRet && GetTimeMicros() - nStartTime < 1000) {\n+                nNextFeeler = GetTime();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8695#discussion_r88082991",
      "id" : 88082991,
      "original_commit_id" : "ce1e69ab936188d989489f306a5e337cb60a6160",
      "original_position" : 12,
      "path" : "src/net.cpp",
      "position" : 12,
      "pull_request_review_id" : 8667499,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8695",
      "updated_at" : "2016-11-15T18:37:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88082991",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
