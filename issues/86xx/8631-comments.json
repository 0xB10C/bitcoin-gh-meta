[
   {
      "body" : "Concept ACK. \r\n\r\nWill review & test soon.\r\n\r\nThe boost interruption_point paradigm is messy and can make code hard to reason about. In my code for https://github.com/bitcoin/bitcoin/pull/8464 I have also removed boost::thread and interruption points, preferring more explicit quitting. Dealing with the interruption code made working on #8464  more difficult than it had to be.\r\n\r\nOne Nit, which I think is worth addressing. I would refactor the names from Interrupt to Quit, Shutdown, or even ControlledExit. Connotation of interrupt is a non-consensual break, whereas Quit or Shutdown implies being done as a normal part of control flow.",
      "created_at" : "2016-08-31T03:46:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8631#issuecomment-243650672",
      "id" : 243650672,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8631",
      "updated_at" : "2016-08-31T03:46:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243650672",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "body" : "@JeremyRubin Nearly every thread uses separate interrupt/shutdown calls for exactly that reason.\r\n\r\nInterrupt is non-consensual, and means \"stop what you're doing and don't start anything else\". Shutdown means \"please gracefully exit now and don't return until you do\".",
      "created_at" : "2016-08-31T03:52:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8631#issuecomment-243651371",
      "id" : 243651371,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8631",
      "updated_at" : "2016-08-31T03:52:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243651371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "@theuni Ah, gotcha. Was looking at small sample; my bad. I guess my comment should instead be, we should eventually migrate to shutdown only no interrupt threads; but this is a big step in that direction and precursor to that happening.",
      "created_at" : "2016-08-31T03:59:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8631#issuecomment-243652147",
      "id" : 243652147,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8631",
      "updated_at" : "2016-08-31T03:59:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243652147",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "body" : "Concept ACK, testing.",
      "created_at" : "2016-08-31T15:30:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8631#issuecomment-243802502",
      "id" : 243802502,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8631",
      "updated_at" : "2016-08-31T15:30:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243802502",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "OS X here:\r\n\r\n```\r\nMaking all in src\r\n  CXX      test/test_test_bitcoin-scheduler_tests.o\r\nIn file included from test/scheduler_tests.cpp:8:\r\nIn file included from ./test/test_bitcoin.h:16:\r\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../include/c++/v1/thread:337:5: error: attempt to use a deleted function\r\n    __invoke(std::__1::move(std::__1::get<0>(__t)), std::__1::move(std::__1::get<_Indices>(__t))...);\r\n    ^\r\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../include/c++/v1/thread:347:5: note: in instantiation of function template specialization 'std::__1::__thread_execute<void (CScheduler::*)(), std::__1::reference_wrapper<CScheduler> , 1>' requested here\r\n    __thread_execute(*__p, _Index());\r\n    ^\r\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../include/c++/v1/thread:359:42: note: in instantiation of function template specialization 'std::__1::__thread_proxy<std::__1::tuple<void (CScheduler::*)(), std::__1::reference_wrapper<CScheduler> > >' requested here\r\n    int __ec = pthread_create(&__t_, 0, &__thread_proxy<_Gp>, __p.get());\r\n                                         ^\r\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../include/c++/v1/memory:1673:31: note: in instantiation of function template specialization 'std::__1::thread::thread<void (CScheduler::*)(), std::__1::reference_wrapper<CScheduler> , void>' requested here\r\n            ::new((void*)__p) _Up(std::__1::forward<_Args>(__args)...);\r\n                              ^\r\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../include/c++/v1/memory:1600:18: note: in instantiation of function template specialization 'std::__1::allocator<std::__1::thread>::construct<std::__1::thread, void (CScheduler::*)(), std::__1::reference_wrapper<CScheduler> >' requested here\r\n            {__a.construct(__p, std::__1::forward<_Args>(__args)...);}\r\n                 ^\r\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../include/c++/v1/memory:1453:14: note: in instantiation of function template specialization 'std::__1::allocator_traits<std::__1::allocator<std::__1::thread> >::__construct<std::__1::thread, void (CScheduler::*)(), std::__1::reference_wrapper<CScheduler> >' requested here\r\n            {__construct(__has_construct<allocator_type, _Tp*, _Args...>(),\r\n             ^\r\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../include/c++/v1/vector:1643:25: note: in instantiation of function template specialization 'std::__1::allocator_traits<std::__1::allocator<std::__1::thread> >::construct<std::__1::thread, void (CScheduler::*)(), std::__1::reference_wrapper<CScheduler> >' requested here\r\n        __alloc_traits::construct(this->__alloc(),\r\n                        ^\r\ntest/scheduler_tests.cpp:89:22: note: in instantiation of function template specialization 'std::__1::vector<std::__1::thread, std::__1::allocator<std::__1::thread> >::emplace_back<void (CScheduler::*)(), std::__1::reference_wrapper<CScheduler> >' requested here\r\n        microThreads.emplace_back(&CScheduler::serviceQueue, std::ref(microTasks));\r\n                     ^\r\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../include/c++/v1/type_traits:1043:5: note: '~__nat' has been explicitly marked deleted here\r\n    ~__nat() = delete;\r\n    ^\r\n```",
      "created_at" : "2016-08-31T16:02:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8631#issuecomment-243812773",
      "id" : 243812773,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8631",
      "updated_at" : "2016-08-31T16:02:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243812773",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "Compile error fixed here.\r\n",
      "created_at" : "2016-08-31T18:04:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8631#issuecomment-243849411",
      "id" : 243849411,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8631",
      "updated_at" : "2016-08-31T18:04:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243849411",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "Needs rebase.",
      "created_at" : "2016-08-31T23:06:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8631#issuecomment-243929430",
      "id" : 243929430,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8631",
      "updated_at" : "2016-08-31T23:06:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243929430",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "rebased and squashed in the compile fix.",
      "created_at" : "2016-09-01T00:10:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8631#issuecomment-243939675",
      "id" : 243939675,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8631",
      "updated_at" : "2016-09-01T00:10:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243939675",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : ">  Nearly every thread uses separate interrupt/shutdown calls for exactly that reason.\r\n\r\nThere's another reason, and that is that interrupt is supposed to be an instant operation at the caller site, and shutdown is allowed to wait. This allows parallelism in the shutdown process:\r\n\r\n- Send module A interrupt  (A starts terminating its threads, which may take some time)\r\n- Send module B interrupt  (B starts terminating its threads, which may take some time)\r\n\r\n...\r\n\r\n- Module A shutdown (waits for A's threads to join)\r\n- Module B shutdown (waits for B's threads to join)\r\n\r\nSure, the naming may not be optimal, \"interrupt\" is more like a hint to stop work, but I think the approach makes sense.\r\n\r\n(I'm sure this can be implemented more thoroughly with explicit shutdown-dependencies and std::futures, but the idea is the same, to make shutdown as fast as possible)\r\n\r\nEdit: re-triggered travis, the failure was a timeout, probably has nothing to do with the changes here.",
      "created_at" : "2016-09-01T12:10:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8631#issuecomment-244059787",
      "id" : 244059787,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8631",
      "updated_at" : "2016-09-01T12:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/244059787",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Travis does keep failing. There may be an issue after all.",
      "created_at" : "2016-09-01T13:47:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8631#issuecomment-244083563",
      "id" : 244083563,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8631",
      "updated_at" : "2016-09-01T13:47:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/244083563",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Hmm, travis was happy before the rebase. I'll try to reproduce locally, maybe something changed.",
      "created_at" : "2016-09-01T15:32:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8631#issuecomment-244117354",
      "id" : 244117354,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8631",
      "updated_at" : "2016-09-01T15:32:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/244117354",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "The travis failures were caused by the rebase after all. ab48c5e72156b34300db4a6521cb3c9969be3937 introduced a new test that relied on the interruptible semantics. I've added a commit that should fix that up.",
      "created_at" : "2016-09-02T05:05:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8631#issuecomment-244284118",
      "id" : 244284118,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8631",
      "updated_at" : "2016-09-02T05:05:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/244284118",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "needs rebase again :( \r\n",
      "created_at" : "2016-09-02T11:21:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8631#issuecomment-244349754",
      "id" : 244349754,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8631",
      "updated_at" : "2016-09-02T11:22:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/244349754",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7275704?v=3",
         "events_url" : "https://api.github.com/users/btcdrak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/btcdrak/followers",
         "following_url" : "https://api.github.com/users/btcdrak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/btcdrak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/btcdrak",
         "id" : 7275704,
         "login" : "btcdrak",
         "organizations_url" : "https://api.github.com/users/btcdrak/orgs",
         "received_events_url" : "https://api.github.com/users/btcdrak/received_events",
         "repos_url" : "https://api.github.com/users/btcdrak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/btcdrak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/btcdrak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/btcdrak"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8631#discussion_r77481047"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8631"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/77481047"
         }
      },
      "body" : "Nit:\r\n\r\nI find the semantics of bind to be pretty confusing confusing. If we're cleaning up threading semantics I think it might be clearer to do as follows:\r\n\r\nscheduler_thread = std::thread([](){ TraceThread(\"scheduler\", CScheduler::serviceQueue(scheduler)); };\r\n\r\nThis should also allow you to get rid of the explicit template param.",
      "commit_id" : "01f8700b0e5a40465a5bd7707a3e9a9a94f8023e",
      "created_at" : "2016-09-05T07:46:05Z",
      "diff_hunk" : "@@ -1078,7 +1086,7 @@ bool AppInit2(boost::thread_group& threadGroup, CScheduler& scheduler)\n \n     // Start the lightweight task scheduler thread\n     CScheduler::Function serviceLoop = boost::bind(&CScheduler::serviceQueue, &scheduler);\n-    threadGroup.create_thread(boost::bind(&TraceThread<CScheduler::Function>, \"scheduler\", serviceLoop));\n+    scheduler_thread = std::thread(std::bind(&TraceThread<CScheduler::Function>, \"scheduler\", serviceLoop));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8631#discussion_r77481047",
      "id" : 77481047,
      "original_commit_id" : "8447a96ee2e796b7de89968429b586206a40b04c",
      "original_position" : 49,
      "path" : "src/init.cpp",
      "position" : 132,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8631",
      "updated_at" : "2016-09-05T07:46:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/77481047",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8631#discussion_r77482322"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8631"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/77482322"
         }
      },
      "body" : "This is OK -- initially, I was confused as to why you use an atomic var for the condition variable, as usually access is guarded by the lock so atomic would be overkill. But in this case, it's fine.\r\n\r\nMay be worth writing a profile at some point for if it is better to use a cond+atomic or to lock on writing the condition externally, or just throwing a comment in here as to why you're using an atomic.\r\n",
      "commit_id" : "01f8700b0e5a40465a5bd7707a3e9a9a94f8023e",
      "created_at" : "2016-09-05T07:58:20Z",
      "diff_hunk" : "@@ -120,6 +120,12 @@ boost::condition_variable messageHandlerCondition;\n static CNodeSignals g_signals;\n CNodeSignals& GetNodeSignals() { return g_signals; }\n \n+static std::condition_variable net_interrupt_cond;\n+static std::mutex cs_net_interrupt;\n+static std::atomic<bool> net_interrupted(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8631#discussion_r77482322",
      "id" : 77482322,
      "original_commit_id" : "ed68c688d3f5f76d3a0d56924d4421a7ad8af977",
      "original_position" : 6,
      "path" : "src/net.cpp",
      "position" : 23,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8631",
      "updated_at" : "2016-09-05T07:58:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/77482322",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8631#discussion_r77483473"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8631"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/77483473"
         }
      },
      "body" : "repeating comment about using lambdas.",
      "commit_id" : "01f8700b0e5a40465a5bd7707a3e9a9a94f8023e",
      "created_at" : "2016-09-05T08:08:22Z",
      "diff_hunk" : "@@ -2176,16 +2180,16 @@ void StartNode(boost::thread_group& threadGroup, CScheduler& scheduler)\n     MapPort(GetBoolArg(\"-upnp\", DEFAULT_UPNP));\n \n     // Send and receive from sockets, accept connections\n-    threadGroup.create_thread(boost::bind(&TraceThread<void (*)()>, \"net\", &ThreadSocketHandler));\n+    socket_handler_thread = std::thread(std::bind(&TraceThread<void (*)()>, \"net\", &ThreadSocketHandler));\n \n     // Initiate outbound connections from -addnode\n-    threadGroup.create_thread(boost::bind(&TraceThread<void (*)()>, \"addcon\", &ThreadOpenAddedConnections));\n+    open_added_connections_thread = std::thread(std::bind(&TraceThread<void (*)()>, \"addcon\", &ThreadOpenAddedConnections));\n \n     // Initiate outbound connections\n-    threadGroup.create_thread(boost::bind(&TraceThread<void (*)()>, \"opencon\", &ThreadOpenConnections));\n+    open_connections_thread = std::thread(std::bind(&TraceThread<void (*)()>, \"opencon\", &ThreadOpenConnections));\n \n     // Process messages\n-    threadGroup.create_thread(boost::bind(&TraceThread<void (*)()>, \"msghand\", &ThreadMessageHandler));\n+    message_handler_thread = std::thread(std::bind(&TraceThread<void (*)()>, \"msghand\", &ThreadMessageHandler));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8631#discussion_r77483473",
      "id" : 77483473,
      "original_commit_id" : "54cb55b2086ab93941d7f9ef96590c3bb4c2f7e3",
      "original_position" : 55,
      "path" : "src/net.cpp",
      "position" : 395,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8631",
      "updated_at" : "2016-09-05T08:08:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/77483473",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   }
]
