[
   {
      "body" : "Impressive changeset!\r\nGeneral Concept ACK.\r\n\r\nInstead of the extending the RPC auth, I could imaging using different RPC endpoints would also work.\r\n* Accessing RPC at `/` would result in the default wallet.\r\n* Accessing RPC at `/<walletid>` would result in using the wallet with the id `<walletid>`.\r\n\r\nbitcoin-cli could just support a new argument `-walletid`.\r\nSomething like `bitcoin-cli -walletid=something getbalance` would result in the same RPC call just against the endpoint `/something`.\r\nMaybe this would result in a simple RPC access to the multiple wallets.\r\n\r\nWill review soon.",
      "created_at" : "2016-09-10T06:54:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-246095336",
      "id" : 246095336,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2016-09-10T06:54:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/246095336",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "> Instead of the extending the RPC auth, I could imaging using different RPC endpoints would also work.\r\n\r\nIndeed, although my main purpose in doing this was to isolate JoinMarket, and it's less isolated if it has auth to my real hotwallet. :)\r\n\r\n(Also, endpoints seemed like they'd require more code.)\r\n\r\n> Accessing RPC at `/<walletid>` would result in using the wallet with the id `<walletid>`.\r\n\r\nThis isn't very future-proof. If we go this route, I'd suggest `/?wallet=<walletid>`",
      "created_at" : "2016-09-10T10:22:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-246104190",
      "id" : 246104190,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2016-09-10T10:22:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/246104190",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "Nice, Concept ACK. Will test.",
      "created_at" : "2016-09-14T21:21:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-247158244",
      "id" : 247158244,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2016-09-14T21:21:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247158244",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7275704?v=3",
         "events_url" : "https://api.github.com/users/btcdrak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/btcdrak/followers",
         "following_url" : "https://api.github.com/users/btcdrak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/btcdrak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/btcdrak",
         "id" : 7275704,
         "login" : "btcdrak",
         "organizations_url" : "https://api.github.com/users/btcdrak/orgs",
         "received_events_url" : "https://api.github.com/users/btcdrak/received_events",
         "repos_url" : "https://api.github.com/users/btcdrak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/btcdrak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/btcdrak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/btcdrak"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r79791358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/79791358"
         }
      },
      "body" : "I like the approach by @jonasschnelli better. Let's keep most of the multiwallet logic in `wallet.cpp`.\n",
      "commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "created_at" : "2016-09-21T09:17:28Z",
      "diff_hunk" : "@@ -196,8 +196,9 @@ void Shutdown()\n     StopRPC();\n     StopHTTPServer();\n #ifdef ENABLE_WALLET\n-    if (pwalletMain)\n-        pwalletMain->Flush(false);\n+    for (CWallet_ptr pwallet : vpwallets) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r79791358",
      "id" : 79791358,
      "original_commit_id" : "996948af12b418562cbc2d29c1d7f9d8b9ca2a46",
      "original_position" : 6,
      "path" : "src/init.cpp",
      "position" : 6,
      "pull_request_review_id" : 912360,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-03-09T23:46:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/79791358",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "Rebased, but please prioritise #8775 review (which this is based on) first. Once that's merged, it may or may not make sense to split the Qt changes out of this.",
      "created_at" : "2017-01-03T22:48:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-270247894",
      "id" : 270247894,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-01-03T22:48:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/270247894",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "Concept ACK.\r\n\r\nSyntax for the auth field should have a clear way to extend it to support a list of wallets (first being the default, I guess).  I think.  To support things like the path selected wallets suggested above later.",
      "created_at" : "2017-01-07T15:31:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-271090119",
      "id" : 271090119,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-01-07T15:35:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/271090119",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Moved RPC/GUI changes out of this, and rebased.",
      "created_at" : "2017-02-03T05:10:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-277166185",
      "id" : 277166185,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-02-03T05:10:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/277166185",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104261222"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104261222"
         }
      },
      "body" : "It's not in `wallet.cpp` now. Moving it there seems like a good idea, but independent of this PR...",
      "commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "created_at" : "2017-03-03T23:09:58Z",
      "diff_hunk" : "@@ -196,8 +196,9 @@ void Shutdown()\n     StopRPC();\n     StopHTTPServer();\n #ifdef ENABLE_WALLET\n-    if (pwalletMain)\n-        pwalletMain->Flush(false);\n+    for (CWallet_ptr pwallet : vpwallets) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104261222",
      "id" : 104261222,
      "original_commit_id" : "996948af12b418562cbc2d29c1d7f9d8b9ca2a46",
      "original_position" : 6,
      "path" : "src/init.cpp",
      "position" : 6,
      "pull_request_review_id" : 25090434,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-03-09T23:46:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104261222",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "Rebased and now the next-step in multiwallet integration.",
      "created_at" : "2017-03-04T03:54:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-284124924",
      "id" : 284124924,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-04T03:54:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/284124924",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "Re-Concept ACK.\r\nBinaries to play with: https://bitcoin.jonasschnelli.ch/build/PR/8694",
      "created_at" : "2017-03-06T08:34:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-284332981",
      "id" : 284332981,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-06T09:57:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/284332981",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104459247"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104459247"
         }
      },
      "body" : "Curious, why have a `CWallet_ptr` typedef instead of using `CWallet *`? Is there a plan to switch to a different type of pointer later? Curious, because this seems to make the rest of the code more opaque. For example:\r\n\r\n```\r\nfor (CWallet_ptr pwallet : vpwallets)\r\n```\r\n\r\nBecause this says `CWallet_ptr` instead of `CWallet*` it's unclear whether the copy initialization has extra cost (which it would for a shared_ptr), implying a const reference should be used instead.\r\n",
      "commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "created_at" : "2017-03-06T16:37:12Z",
      "diff_hunk" : "@@ -31,7 +31,8 @@\n #include <boost/shared_ptr.hpp>\n #include <boost/thread.hpp>\n \n-extern CWallet* pwalletMain;\n+typedef CWallet* CWallet_ptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104459247",
      "id" : 104459247,
      "original_commit_id" : "0d348d5a5646cf9c522896a297538b7d1ec1509f",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 25297921,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-03-09T23:46:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104459247",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104467005"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104467005"
         }
      },
      "body" : "This thread is created from the non-static method `CWallet::postInitProcess`, so it seems like it makes more sense for it to continue flushing a single wallet, rather than going through the global wallets list. Instead of looping and accessing the global `vpwallet` variable, `ThreadFlushWalletDB` could just take a new `CWallet* pwallet` argument and be invoked with:\r\n\r\n```\r\nthreadGroup.create_thread([this](){ThreadFlushWalletDB(this);});\r\n```\r\n\r\nfrom `CWallet::postInitProcess`.",
      "commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "created_at" : "2017-03-06T17:07:04Z",
      "diff_hunk" : "@@ -819,21 +819,23 @@ void ThreadFlushWalletDB()\n                 if (nRefCount == 0)\n                 {\n                     boost::this_thread::interruption_point();\n-                    const std::string& strFile = pwalletMain->strWalletFile;\n-                    map<string, int>::iterator _mi = bitdb.mapFileUseCount.find(strFile);\n-                    if (_mi != bitdb.mapFileUseCount.end())\n-                    {\n-                        LogPrint(\"db\", \"Flushing %s\\n\", strFile);\n-                        nLastFlushed = CWalletDB::GetUpdateCounter();\n-                        int64_t nStart = GetTimeMillis();\n-\n-                        // Flush wallet file so it's self contained\n-                        bitdb.CloseDb(strFile);\n-                        bitdb.CheckpointLSN(strFile);\n-\n-                        bitdb.mapFileUseCount.erase(_mi++);\n-                        LogPrint(\"db\", \"Flushed %s %dms\\n\", strFile, GetTimeMillis() - nStart);\n+                    for (CWallet_ptr pwallet : vpwallets) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104467005",
      "id" : 104467005,
      "original_commit_id" : "0d348d5a5646cf9c522896a297538b7d1ec1509f",
      "original_position" : 18,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 25297921,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-03-09T23:46:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104467005",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104467401"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104467401"
         }
      },
      "body" : "How come the `nLastFlushed` assignment is moving ouside of the `_mi != bitdb.mapFileUseCount.end()` condition? It seems unrelated to this change. Maybe a code comment explaining the assignment would be good here.",
      "commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "created_at" : "2017-03-06T17:08:37Z",
      "diff_hunk" : "@@ -819,21 +819,23 @@ void ThreadFlushWalletDB()\n                 if (nRefCount == 0)\n                 {\n                     boost::this_thread::interruption_point();\n-                    const std::string& strFile = pwalletMain->strWalletFile;\n-                    map<string, int>::iterator _mi = bitdb.mapFileUseCount.find(strFile);\n-                    if (_mi != bitdb.mapFileUseCount.end())\n-                    {\n-                        LogPrint(\"db\", \"Flushing %s\\n\", strFile);\n-                        nLastFlushed = CWalletDB::GetUpdateCounter();\n-                        int64_t nStart = GetTimeMillis();\n-\n-                        // Flush wallet file so it's self contained\n-                        bitdb.CloseDb(strFile);\n-                        bitdb.CheckpointLSN(strFile);\n-\n-                        bitdb.mapFileUseCount.erase(_mi++);\n-                        LogPrint(\"db\", \"Flushed %s %dms\\n\", strFile, GetTimeMillis() - nStart);\n+                    for (CWallet_ptr pwallet : vpwallets) {\n+                        const std::string& strFile = pwallet->strWalletFile;\n+                        map<string, int>::iterator _mi = bitdb.mapFileUseCount.find(strFile);\n+                        if (_mi != bitdb.mapFileUseCount.end())\n+                        {\n+                            LogPrint(\"db\", \"Flushing %s\\n\", strFile);\n+                            int64_t nStart = GetTimeMillis();\n+\n+                            // Flush wallet file so it's self contained\n+                            bitdb.CloseDb(strFile);\n+                            bitdb.CheckpointLSN(strFile);\n+\n+                            bitdb.mapFileUseCount.erase(_mi++);\n+                            LogPrint(\"db\", \"Flushed %s %dms\\n\", strFile, GetTimeMillis() - nStart);\n+                        }\n                     }\n+                    nLastFlushed = CWalletDB::GetUpdateCounter();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104467401",
      "id" : 104467401,
      "original_commit_id" : "0d348d5a5646cf9c522896a297538b7d1ec1509f",
      "original_position" : 34,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 25297921,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-03-09T23:46:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104467401",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104522825"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104522825"
         }
      },
      "body" : "Indeed, a shared_ptr or similar would be needed for when/if we add the ability to close wallets at runtime.",
      "commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "created_at" : "2017-03-06T21:08:54Z",
      "diff_hunk" : "@@ -31,7 +31,8 @@\n #include <boost/shared_ptr.hpp>\n #include <boost/thread.hpp>\n \n-extern CWallet* pwalletMain;\n+typedef CWallet* CWallet_ptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104522825",
      "id" : 104522825,
      "original_commit_id" : "0d348d5a5646cf9c522896a297538b7d1ec1509f",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 25364181,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-03-09T23:46:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104522825",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104523089"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104523089"
         }
      },
      "body" : "Having a dedicated thread per wallet is just needlessly inefficient.",
      "commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "created_at" : "2017-03-06T21:10:00Z",
      "diff_hunk" : "@@ -819,21 +819,23 @@ void ThreadFlushWalletDB()\n                 if (nRefCount == 0)\n                 {\n                     boost::this_thread::interruption_point();\n-                    const std::string& strFile = pwalletMain->strWalletFile;\n-                    map<string, int>::iterator _mi = bitdb.mapFileUseCount.find(strFile);\n-                    if (_mi != bitdb.mapFileUseCount.end())\n-                    {\n-                        LogPrint(\"db\", \"Flushing %s\\n\", strFile);\n-                        nLastFlushed = CWalletDB::GetUpdateCounter();\n-                        int64_t nStart = GetTimeMillis();\n-\n-                        // Flush wallet file so it's self contained\n-                        bitdb.CloseDb(strFile);\n-                        bitdb.CheckpointLSN(strFile);\n-\n-                        bitdb.mapFileUseCount.erase(_mi++);\n-                        LogPrint(\"db\", \"Flushed %s %dms\\n\", strFile, GetTimeMillis() - nStart);\n+                    for (CWallet_ptr pwallet : vpwallets) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104523089",
      "id" : 104523089,
      "original_commit_id" : "0d348d5a5646cf9c522896a297538b7d1ec1509f",
      "original_position" : 18,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 25364459,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-03-09T23:46:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104523089",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104523568"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104523568"
         }
      },
      "body" : "Because the condition is per-wallet. Maybe nLastFlushed ought to be as well...?",
      "commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "created_at" : "2017-03-06T21:12:16Z",
      "diff_hunk" : "@@ -819,21 +819,23 @@ void ThreadFlushWalletDB()\n                 if (nRefCount == 0)\n                 {\n                     boost::this_thread::interruption_point();\n-                    const std::string& strFile = pwalletMain->strWalletFile;\n-                    map<string, int>::iterator _mi = bitdb.mapFileUseCount.find(strFile);\n-                    if (_mi != bitdb.mapFileUseCount.end())\n-                    {\n-                        LogPrint(\"db\", \"Flushing %s\\n\", strFile);\n-                        nLastFlushed = CWalletDB::GetUpdateCounter();\n-                        int64_t nStart = GetTimeMillis();\n-\n-                        // Flush wallet file so it's self contained\n-                        bitdb.CloseDb(strFile);\n-                        bitdb.CheckpointLSN(strFile);\n-\n-                        bitdb.mapFileUseCount.erase(_mi++);\n-                        LogPrint(\"db\", \"Flushed %s %dms\\n\", strFile, GetTimeMillis() - nStart);\n+                    for (CWallet_ptr pwallet : vpwallets) {\n+                        const std::string& strFile = pwallet->strWalletFile;\n+                        map<string, int>::iterator _mi = bitdb.mapFileUseCount.find(strFile);\n+                        if (_mi != bitdb.mapFileUseCount.end())\n+                        {\n+                            LogPrint(\"db\", \"Flushing %s\\n\", strFile);\n+                            int64_t nStart = GetTimeMillis();\n+\n+                            // Flush wallet file so it's self contained\n+                            bitdb.CloseDb(strFile);\n+                            bitdb.CheckpointLSN(strFile);\n+\n+                            bitdb.mapFileUseCount.erase(_mi++);\n+                            LogPrint(\"db\", \"Flushed %s %dms\\n\", strFile, GetTimeMillis() - nStart);\n+                        }\n                     }\n+                    nLastFlushed = CWalletDB::GetUpdateCounter();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104523568",
      "id" : 104523568,
      "original_commit_id" : "0d348d5a5646cf9c522896a297538b7d1ec1509f",
      "original_position" : 34,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 25364997,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-03-09T23:46:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104523568",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "(needs another rebase)",
      "created_at" : "2017-03-08T17:00:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-285100437",
      "id" : 285100437,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-08T17:00:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285100437",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Added 0.15.0 milestone.",
      "created_at" : "2017-03-09T09:22:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-285298597",
      "id" : 285298597,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-09T09:22:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285298597",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105283157"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105283157"
         }
      },
      "body" : "Sanitised this better in the rebase",
      "commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "created_at" : "2017-03-09T22:07:20Z",
      "diff_hunk" : "@@ -819,21 +819,23 @@ void ThreadFlushWalletDB()\n                 if (nRefCount == 0)\n                 {\n                     boost::this_thread::interruption_point();\n-                    const std::string& strFile = pwalletMain->strWalletFile;\n-                    map<string, int>::iterator _mi = bitdb.mapFileUseCount.find(strFile);\n-                    if (_mi != bitdb.mapFileUseCount.end())\n-                    {\n-                        LogPrint(\"db\", \"Flushing %s\\n\", strFile);\n-                        nLastFlushed = CWalletDB::GetUpdateCounter();\n-                        int64_t nStart = GetTimeMillis();\n-\n-                        // Flush wallet file so it's self contained\n-                        bitdb.CloseDb(strFile);\n-                        bitdb.CheckpointLSN(strFile);\n-\n-                        bitdb.mapFileUseCount.erase(_mi++);\n-                        LogPrint(\"db\", \"Flushed %s %dms\\n\", strFile, GetTimeMillis() - nStart);\n+                    for (CWallet_ptr pwallet : vpwallets) {\n+                        const std::string& strFile = pwallet->strWalletFile;\n+                        map<string, int>::iterator _mi = bitdb.mapFileUseCount.find(strFile);\n+                        if (_mi != bitdb.mapFileUseCount.end())\n+                        {\n+                            LogPrint(\"db\", \"Flushing %s\\n\", strFile);\n+                            int64_t nStart = GetTimeMillis();\n+\n+                            // Flush wallet file so it's self contained\n+                            bitdb.CloseDb(strFile);\n+                            bitdb.CheckpointLSN(strFile);\n+\n+                            bitdb.mapFileUseCount.erase(_mi++);\n+                            LogPrint(\"db\", \"Flushed %s %dms\\n\", strFile, GetTimeMillis() - nStart);\n+                        }\n                     }\n+                    nLastFlushed = CWalletDB::GetUpdateCounter();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105283157",
      "id" : 105283157,
      "original_commit_id" : "0d348d5a5646cf9c522896a297538b7d1ec1509f",
      "original_position" : 34,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 26157122,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-03-09T23:46:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105283157",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "Significantly rebased. Also fixed minor race conditions surrounding wallet flush (it was bumping the \"have update to flush\" counter before doing the actual update).",
      "created_at" : "2017-03-09T22:08:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-285499326",
      "id" : 285499326,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-09T22:08:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285499326",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "It would be preferable to increment the update counter after committing a database transaction, not after every call to a CWalletDB method.\r\nSo this would mean the destructor of `CWalletDB` and `TxnCommit()` . Which should be overridden in CWalletDB, or alternatively use composition not inheritance for CDB as I've done in the last commit in #9951.\r\nThis will simplify these changes (no need to do WriteIC/EraseIC everywhere), as well as makes sure that only changes that actually hit the database/disk are counted.\r\n",
      "created_at" : "2017-03-10T07:40:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-285599692",
      "id" : 285599692,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-10T07:40:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285599692",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105344494"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105344494"
         }
      },
      "body" : "I think it is confusing for a \"Set\" function to add something to a list. If anything it should replace it.\r\nWhat do you need this for, specifically?\r\nIn the past I've defined [SoftSetMultiArg](https://github.com/laanwj/bitcoin/commit/1024183eff629b758745aa7ebf9329d987179644) to be able to define a whole list argument at once.",
      "commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "created_at" : "2017-03-10T07:44:19Z",
      "diff_hunk" : "@@ -418,6 +418,7 @@ bool SoftSetArg(const std::string& strArg, const std::string& strValue)\n     if (mapArgs.count(strArg))\n         return false;\n     mapArgs[strArg] = strValue;\n+    _mapMultiArgs[strArg].push_back(strValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105344494",
      "id" : 105344494,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 4,
      "path" : "src/util.cpp",
      "position" : 4,
      "pull_request_review_id" : 26220683,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-03-10T07:44:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105344494",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105344527"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105344527"
         }
      },
      "body" : "Why define pwalletMain here?",
      "commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "created_at" : "2017-03-10T07:44:40Z",
      "diff_hunk" : "@@ -8,6 +8,8 @@\n #include \"wallet/db.h\"\n #include \"wallet/wallet.h\"\n \n+CWallet *pwalletMain;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105344527",
      "id" : 105344527,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 4,
      "path" : "src/wallet/test/wallet_test_fixture.cpp",
      "position" : 4,
      "pull_request_review_id" : 26220719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-03-10T07:44:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105344527",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I think the overall approach here is good. This is another step towards multi-wallet support. As it's not anywhere on the API yet, I guess it's too early to ask for a multiwallet test?",
      "created_at" : "2017-03-10T07:46:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-285600713",
      "id" : 285600713,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-10T07:46:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285600713",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105443469"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105443469"
         }
      },
      "body" : "It can't get here unless the list is currently empty. It's used to initialise `-wallet`, which is accessed as a list only now.",
      "commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "created_at" : "2017-03-10T17:16:56Z",
      "diff_hunk" : "@@ -418,6 +418,7 @@ bool SoftSetArg(const std::string& strArg, const std::string& strValue)\n     if (mapArgs.count(strArg))\n         return false;\n     mapArgs[strArg] = strValue;\n+    _mapMultiArgs[strArg].push_back(strValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105443469",
      "id" : 105443469,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 4,
      "path" : "src/util.cpp",
      "position" : 4,
      "pull_request_review_id" : 26328271,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-03-10T17:16:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105443469",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105443597"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105443597"
         }
      },
      "body" : "There's no need to modify the tests to use vpwallets in most cases?",
      "commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "created_at" : "2017-03-10T17:17:36Z",
      "diff_hunk" : "@@ -8,6 +8,8 @@\n #include \"wallet/db.h\"\n #include \"wallet/wallet.h\"\n \n+CWallet *pwalletMain;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105443597",
      "id" : 105443597,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 4,
      "path" : "src/wallet/test/wallet_test_fixture.cpp",
      "position" : 4,
      "pull_request_review_id" : 26328413,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-03-10T17:17:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105443597",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "> It would be preferable to increment the update counter after committing a database transaction, not after every call to a CWalletDB method.\r\n\r\nIMO too much for this PR. Just trying to multiwallet here, not refactor stuff that doesn't need it. :)",
      "created_at" : "2017-03-10T17:20:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-285729345",
      "id" : 285729345,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-10T17:20:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285729345",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105449231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105449231"
         }
      },
      "body" : "In commit \"Wallet: Replace pwalletMain with a vector of wallet pointers\":\r\n\r\nMaybe add a TODO comment for updating the tests to stop referencing pwalletMain, since this will be confusing to someone seeing this who isn't familiar with the pre-multiwallet history of the code.",
      "commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "created_at" : "2017-03-10T17:44:04Z",
      "diff_hunk" : "@@ -8,6 +8,8 @@\n #include \"wallet/db.h\"\n #include \"wallet/wallet.h\"\n \n+CWallet *pwalletMain;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105449231",
      "id" : 105449231,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 4,
      "path" : "src/wallet/test/wallet_test_fixture.cpp",
      "position" : 4,
      "pull_request_review_id" : 26334485,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-03-10T19:14:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105449231",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105457768"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105457768"
         }
      },
      "body" : "Depends on the reason why they are setting pwalletMain. Generally that is to communicate with stuff in wallet.cpp/walletdb.cpp I'd say.",
      "commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "created_at" : "2017-03-10T18:24:08Z",
      "diff_hunk" : "@@ -8,6 +8,8 @@\n #include \"wallet/db.h\"\n #include \"wallet/wallet.h\"\n \n+CWallet *pwalletMain;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105457768",
      "id" : 105457768,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 4,
      "path" : "src/wallet/test/wallet_test_fixture.cpp",
      "position" : 4,
      "pull_request_review_id" : 26343423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-03-10T18:24:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105457768",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "> IMO too much for this PR. Just trying to multiwallet here, not refactor stuff that doesn't need it. :)\r\n\r\nMaybe my recommendation goes to far but I just think your current approach there is messy. The mutator functions call `WriteIC`/`EraseIC` which call `IncrementUpdateCounter` which calls `IncrementUpdateCounter(strFile)` which indexes into a global map indexed by name. This makes the wallet code even more complex and hard to understand as it introduces another place where per-wallet(-database) information is stored.\r\n\r\nWe need to decide whether CWalletDBStateInfo belongs with the database wrapper, or with the wallet.\r\n\r\n- If it is part of the database statistics side of things, the place to put it would be CDBEnv, with the other maps `mapFileUseCount` and `mapDb`. After #9951 I'm going to refactor these to put them on a CDBWrapper object which represents a single database.\r\n- If it is specific to wallets, the structure could be put on CWallet, and a reference passed in where it is needed (e.g. to CWalletDB) instead of looking it up all the time. This makes the CWallet more self-contained.",
      "created_at" : "2017-03-10T18:36:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-285748918",
      "id" : 285748918,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-10T18:36:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285748918",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105461051"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105461051"
         }
      },
      "body" : "In commit \"Bugfix: wallet: Increment \"update counter\" only after actually making the applicable db changes to avoid potential races\":\r\n\r\nI'm probably missing something, but if the first write above succeeds and second write fails, the counter won't be incremented. Is this wrong? Would a possible fix be to drop this line and replace all the Write/Erases above with WriteIC/EraseIC?",
      "commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "created_at" : "2017-03-10T18:39:55Z",
      "diff_hunk" : "@@ -103,42 +94,40 @@ bool CWalletDB::WriteCryptedKey(const CPubKey& vchPubKey,\n         Erase(std::make_pair(std::string(\"key\"), vchPubKey));\n         Erase(std::make_pair(std::string(\"wkey\"), vchPubKey));\n     }\n+\n+    IncrementUpdateCounter();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105461051",
      "id" : 105461051,
      "original_commit_id" : "f1052c224c9ea7699dac4d2fba988b3a8ef2224b",
      "original_position" : 75,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 96,
      "pull_request_review_id" : 26334485,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-03-10T19:14:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105461051",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105461805"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105461805"
         }
      },
      "body" : "In commit \"Bugfix: wallet: Increment \"update counter\" only after actually making the applicable db changes to avoid potential races\":\r\n\r\nIt seems good not to increment the counter when a write or erase fails. But I don't understand what the \"potential races\" are that could happen if the counter is incremented regardless. If you could clarify / expand the commit message on this point, I think that would be helpful.",
      "commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "created_at" : "2017-03-10T18:44:00Z",
      "diff_hunk" : "@@ -32,46 +32,38 @@ static std::atomic<unsigned int> nWalletDBUpdateCounter;\n \n bool CWalletDB::WriteName(const std::string& strAddress, const std::string& strName)\n {\n-    nWalletDBUpdateCounter++;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105461805",
      "id" : 105461805,
      "original_commit_id" : "f1052c224c9ea7699dac4d2fba988b3a8ef2224b",
      "original_position" : 4,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 25,
      "pull_request_review_id" : 26334485,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-03-10T19:14:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105461805",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105520211"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105520211"
         }
      },
      "body" : "1. (thread 1) Increment the counter.\r\n2. (thread 2) DB gets flushed\r\n3. (thread 1) Actual change happens.\r\n4. (thread 2) Thinks DB hasn't changed, so doesn't flush again.",
      "commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "created_at" : "2017-03-11T01:25:50Z",
      "diff_hunk" : "@@ -32,46 +32,38 @@ static std::atomic<unsigned int> nWalletDBUpdateCounter;\n \n bool CWalletDB::WriteName(const std::string& strAddress, const std::string& strName)\n {\n-    nWalletDBUpdateCounter++;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105520211",
      "id" : 105520211,
      "original_commit_id" : "f1052c224c9ea7699dac4d2fba988b3a8ef2224b",
      "original_position" : 4,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 25,
      "pull_request_review_id" : 26410271,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-03-11T01:25:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105520211",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105520237"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105520237"
         }
      },
      "body" : "Hmm, not sure what we want to happen in that case...",
      "commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "created_at" : "2017-03-11T01:26:25Z",
      "diff_hunk" : "@@ -103,42 +94,40 @@ bool CWalletDB::WriteCryptedKey(const CPubKey& vchPubKey,\n         Erase(std::make_pair(std::string(\"key\"), vchPubKey));\n         Erase(std::make_pair(std::string(\"wkey\"), vchPubKey));\n     }\n+\n+    IncrementUpdateCounter();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105520237",
      "id" : 105520237,
      "original_commit_id" : "f1052c224c9ea7699dac4d2fba988b3a8ef2224b",
      "original_position" : 75,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 96,
      "pull_request_review_id" : 26410301,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-03-11T01:26:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105520237",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "@laanwj I agree that stuff should be refactored, but I don't think multiwallet needs to depend on it here.\r\n\r\n(Why is CWalletDB not just a private parent class of CWallet anyway?)",
      "created_at" : "2017-03-11T01:27:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-285828510",
      "id" : 285828510,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-11T01:27:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285828510",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   }
]
