[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10612#discussion_r122541162"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122541162"
         }
      },
      "body" : "Nit: `s/^individual/Individual/` :-)",
      "commit_id" : "5a0134a5deb09103e4ba70ebf519c26c1557985b",
      "created_at" : "2017-06-16T21:55:13Z",
      "diff_hunk" : "@@ -15,84 +15,148 @@ The util tests are run as part of `make check` target. The functional\n tests are run by the travis continuous build process whenever a pull\n request is opened. Both sets of tests can also be run locally.\n \n-Functional Test dependencies\n-============================\n+# Running tests locally\n+\n+Build for your system first. Be sure to enable wallet, utils and daemon when you configure. Tests will not run otherwise.\n+\n+### Functional tests\n+\n+#### Dependencies\n+\n The ZMQ functional test requires a python ZMQ library. To install it:\n \n - on Unix, run `sudo apt-get install python3-zmq`\n - on mac OS, run `pip3 install pyzmq`\n \n-Running tests locally\n-=====================\n+#### Running the tests\n \n-Build for your system first. Be sure to enable wallet, utils and daemon when you configure. Tests will not run otherwise.\n+individual tests can be run by directly calling the test script, eg:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10612#discussion_r122541162",
      "id" : 122541162,
      "original_commit_id" : "a001a92dba5bf91082f625b70bae3b49508e47f6",
      "original_position" : 24,
      "path" : "test/README.md",
      "position" : null,
      "pull_request_review_id" : 44672275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10612",
      "updated_at" : "2017-06-16T23:35:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122541162",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7826565?v=3",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10612#discussion_r122551491"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122551491"
         }
      },
      "body" : "Thanks! Fixed",
      "commit_id" : "5a0134a5deb09103e4ba70ebf519c26c1557985b",
      "created_at" : "2017-06-16T23:35:43Z",
      "diff_hunk" : "@@ -15,84 +15,148 @@ The util tests are run as part of `make check` target. The functional\n tests are run by the travis continuous build process whenever a pull\n request is opened. Both sets of tests can also be run locally.\n \n-Functional Test dependencies\n-============================\n+# Running tests locally\n+\n+Build for your system first. Be sure to enable wallet, utils and daemon when you configure. Tests will not run otherwise.\n+\n+### Functional tests\n+\n+#### Dependencies\n+\n The ZMQ functional test requires a python ZMQ library. To install it:\n \n - on Unix, run `sudo apt-get install python3-zmq`\n - on mac OS, run `pip3 install pyzmq`\n \n-Running tests locally\n-=====================\n+#### Running the tests\n \n-Build for your system first. Be sure to enable wallet, utils and daemon when you configure. Tests will not run otherwise.\n+individual tests can be run by directly calling the test script, eg:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10612#discussion_r122551491",
      "id" : 122551491,
      "original_commit_id" : "a001a92dba5bf91082f625b70bae3b49508e47f6",
      "original_position" : 24,
      "path" : "test/README.md",
      "position" : null,
      "pull_request_review_id" : 44683557,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10612",
      "updated_at" : "2017-06-16T23:35:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122551491",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "Thanks @jimmysong - added sections on **Coverage** and **RPC and p2p definitions** to `test/functional/README.md`",
      "created_at" : "2017-06-16T23:37:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10612#issuecomment-309164224",
      "id" : 309164224,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10612",
      "updated_at" : "2017-06-16T23:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/309164224",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "Awesome! Thanks for adding a guide to make tests.",
      "created_at" : "2017-06-17T11:11:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10612#issuecomment-309208810",
      "id" : 309208810,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10612",
      "updated_at" : "2017-06-17T11:11:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/309208810",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10612#discussion_r122592565"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122592565"
         }
      },
      "body" : "I'd prefer if the assert was moved into wait_until and the return statement removed from wait_until.\r\n\r\nThe places in the code where it is missing right now are likely oversights and should be fixed.",
      "commit_id" : "5a0134a5deb09103e4ba70ebf519c26c1557985b",
      "created_at" : "2017-06-18T14:40:12Z",
      "diff_hunk" : "@@ -0,0 +1,205 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"An example functional test\n+\n+The module-level docstring should include a high-level description of\n+what the test is doing. It's the first thing people see when they open\n+the file and should give the reader information about *what* the test\n+is testing and *how* it's being tested\n+\"\"\"\n+# Imports should be in PEP8 ordering (std library first, then third party\n+# libraries then local imports).\n+from collections import defaultdict\n+\n+# Avoid wildcard * imports if possible\n+from test_framework.blocktools import (create_block, create_coinbase)\n+from test_framework.mininode import (\n+    CInv,\n+    NetworkThread,\n+    NodeConn,\n+    NodeConnCB,\n+    msg_block,\n+    msg_getdata,\n+    wait_until,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (connect_nodes_bi, p2p_port)\n+\n+# NodeConnCB is a class containing callbacks to be executed when a p2p\n+# message is received from the node-under-test. Subclass NodeConnCB and\n+# override the on_*() methods if you need custom behaviour.\n+class BaseNode(NodeConnCB):\n+    def __init__(self):\n+        \"\"\"Initialize the NodeConnCB\n+\n+        Used to inialize custom properties for the Node that aren't\n+        included by default in the base class. Be aware that the NodeConnCB\n+        base class already stores a counter for each p2p message type and the\n+        last received message of each type, which should be sufficient for the\n+        needs of most tests.\n+\n+        Call super().__init__() first for standard initialization and then\n+        initialize custom properties.\"\"\"\n+        super().__init__()\n+        # Stores a dictionary of all blocks received\n+        self.block_receive_map = defaultdict(int)\n+\n+    def on_block(self, conn, message):\n+        \"\"\"Override the standard on_block callback\n+\n+        Store the hash of a received block in the dictionary.\"\"\"\n+        message.block.calc_sha256()\n+        self.block_receive_map[message.block.sha256] += 1\n+\n+def custom_function():\n+    \"\"\"Do some custom behaviour\n+\n+    If this function is more generally useful for other tests, consider\n+    moving it to a module in test_framework.\"\"\"\n+    # self.log.info(\"running custom_function\")  # Oops! Can't run self.log outside the BitcoinTestFramework\n+    pass\n+\n+class ExampleTest(BitcoinTestFramework):\n+    # Each functional test is a subclass of the BitcoinTestFramework class.\n+\n+    # Override the __init__(), add_options(), setup_chain(), setup_network()\n+    # and setup_nodes() methods to customize the test setup as required.\n+\n+    def __init__(self):\n+        \"\"\"Initialize the test\n+\n+        Call super().__init__() first, and then override any test parameters\n+        for your individual test.\"\"\"\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        # Use self.extra_args to change command-line arguments for the nodes\n+        self.extra_args = [[], [\"-logips\"], []]\n+\n+        # self.log.info(\"I've finished __init__\")  # Oops! Can't run self.log before run_test()\n+\n+    # Use add_options() to add specific command-line options for your test.\n+    # In practice this is not used very much, since the tests are mostly written\n+    # to be run in automated environments without command-line options.\n+    # def add_options()\n+    #     pass\n+\n+    # Use setup_chain() to customize the node data directories. In practice\n+    # this is not used very much since the default behaviour is almost always\n+    # fine\n+    # def setup_chain():\n+    #     pass\n+\n+    def setup_network(self):\n+        \"\"\"Setup the test network topology\n+\n+        Often you won't need to override this, since the standard network topology\n+        (linear: node0 <-> node1 <-> node2 <-> ...) is fine for most tests.\n+\n+        If you do override this method, remember to start the nodes, assign\n+        them to self.nodes, connect them and then sync.\"\"\"\n+\n+        self.setup_nodes()\n+\n+        # In this test, we're not connecting node2 to node0 or node1. Calls to\n+        # sync_all() should not include node2, since we're not expecting it to\n+        # sync.\n+        connect_nodes_bi(self.nodes, 0, 1)\n+        self.sync_all([self.nodes[0:1]])\n+\n+    # Use setup_nodes() to customize the node start behaviour (for example if\n+    # you don't want to start all nodes at the start of the test).\n+    # def setup_nodes():\n+    #     pass\n+\n+    def custom_method(self):\n+        \"\"\"Do some custom behaviour for this test\n+\n+        Define it in a method here because you're going to use it repeatedly.\n+        If you think it's useful in general, consider moving it to the base\n+        BitcoinTestFramework class so other tests can use it.\"\"\"\n+\n+        self.log.info(\"Running custom_method\")\n+\n+    def run_test(self):\n+        \"\"\"Main test logic\"\"\"\n+\n+        # Create a p2p connection to one of the nodes\n+        node0 = BaseNode()\n+        connections = []\n+        connections.append(NodeConn('127.0.0.1', p2p_port(0), self.nodes[0], node0))\n+        node0.add_connection(connections[0])\n+\n+        # Start up network handling in another thread. This needs to be called\n+        # after the p2p connections have been created.\n+        NetworkThread().start()\n+        # wait_for_verack ensures that the p2p connection is fully up.\n+        node0.wait_for_verack()\n+\n+        # Generating a block on one of the nodes will get us out of IBD\n+        blocks = [int(self.nodes[0].generate(nblocks=1)[0], 16)]\n+\n+        # Notice above how we called an RPC by calling a method with the same\n+        # name on the node object. Notice also how we used a keyword argument\n+        # to specify a named RPC argument. Neither of those are defined on the\n+        # node object. Instead there's some __getattr__() magic going on under\n+        # the covers to dispatch unrecognised attribute calls to the RPC\n+        # interface.\n+\n+        # Logs are nice. Do plenty of them. They can be used in place of comments for\n+        # breaking the test into sub-sections.\n+        self.log.info(\"Starting test!\")\n+\n+        self.log.info(\"Calling a custom function\")\n+        custom_function()\n+\n+        self.log.info(\"Calling a custom method\")\n+        self.custom_method()\n+\n+        self.log.info(\"Create some blocks\")\n+        self.tip = int(self.nodes[0].getbestblockhash(), 16)\n+        self.block_time = self.nodes[0].getblock(self.nodes[0].getbestblockhash())['time'] + 1\n+\n+        height = 1\n+\n+        for i in range(10):\n+            # Use the mininode and blocktools functionality to manually build a block\n+            # Calling the generate() rpc is easier, but this allows us to exactly\n+            # control the blocks and transactions.\n+            block = create_block(self.tip, create_coinbase(height), self.block_time)\n+            block.solve()\n+            block_message = msg_block(block)\n+            # Send message is used to send a p2p message to the node over our NodeConn connection\n+            node0.send_message(block_message)\n+            self.tip = block.sha256\n+            blocks.append(self.tip)\n+            self.block_time += 1\n+            height += 1\n+\n+        self.log.info(\"Wait for node1 to reach current tip (height 11) using RPC\")\n+        self.nodes[1].waitforblockheight(11)\n+\n+        self.log.info(\"Connect node2 and node1\")\n+        connect_nodes_bi(self.nodes, 1, 2)\n+\n+        self.log.info(\"Add p2p connection to node2\")\n+        node2 = BaseNode()\n+        connections.append(NodeConn('127.0.0.1', p2p_port(2), self.nodes[2], node2))\n+        node2.add_connection(connections[1])\n+        node2.wait_for_verack()\n+\n+        self.log.info(\"Wait for node2 reach current tip. Test that it has propogated all the blocks to us\")\n+\n+        for block in blocks:\n+            getdata_request = msg_getdata()\n+            getdata_request.inv.append(CInv(2, block))\n+            node2.send_message(getdata_request)\n+\n+        # wait_until() will loop until a predicate condition is met. Use it to test properties of the\n+        # ConnNodeCB objects.\n+        assert wait_until(lambda: sorted(blocks) == sorted(list(node2.block_receive_map.keys())), timeout=5)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10612#discussion_r122592565",
      "id" : 122592565,
      "original_commit_id" : "5a0134a5deb09103e4ba70ebf519c26c1557985b",
      "original_position" : 202,
      "path" : "test/functional/example_test.py",
      "position" : 202,
      "pull_request_review_id" : 44722930,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10612",
      "updated_at" : "2017-06-18T14:47:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122592565",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10612#discussion_r122592584"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122592584"
         }
      },
      "body" : "Ã°ÂÂÂ ",
      "commit_id" : "5a0134a5deb09103e4ba70ebf519c26c1557985b",
      "created_at" : "2017-06-18T14:40:54Z",
      "diff_hunk" : "@@ -0,0 +1,205 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"An example functional test\n+\n+The module-level docstring should include a high-level description of\n+what the test is doing. It's the first thing people see when they open\n+the file and should give the reader information about *what* the test\n+is testing and *how* it's being tested\n+\"\"\"\n+# Imports should be in PEP8 ordering (std library first, then third party\n+# libraries then local imports).\n+from collections import defaultdict\n+\n+# Avoid wildcard * imports if possible\n+from test_framework.blocktools import (create_block, create_coinbase)\n+from test_framework.mininode import (\n+    CInv,\n+    NetworkThread,\n+    NodeConn,\n+    NodeConnCB,\n+    msg_block,\n+    msg_getdata,\n+    wait_until,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (connect_nodes_bi, p2p_port)\n+\n+# NodeConnCB is a class containing callbacks to be executed when a p2p\n+# message is received from the node-under-test. Subclass NodeConnCB and\n+# override the on_*() methods if you need custom behaviour.\n+class BaseNode(NodeConnCB):\n+    def __init__(self):\n+        \"\"\"Initialize the NodeConnCB\n+\n+        Used to inialize custom properties for the Node that aren't\n+        included by default in the base class. Be aware that the NodeConnCB\n+        base class already stores a counter for each p2p message type and the\n+        last received message of each type, which should be sufficient for the\n+        needs of most tests.\n+\n+        Call super().__init__() first for standard initialization and then\n+        initialize custom properties.\"\"\"\n+        super().__init__()\n+        # Stores a dictionary of all blocks received\n+        self.block_receive_map = defaultdict(int)\n+\n+    def on_block(self, conn, message):\n+        \"\"\"Override the standard on_block callback\n+\n+        Store the hash of a received block in the dictionary.\"\"\"\n+        message.block.calc_sha256()\n+        self.block_receive_map[message.block.sha256] += 1\n+\n+def custom_function():\n+    \"\"\"Do some custom behaviour\n+\n+    If this function is more generally useful for other tests, consider\n+    moving it to a module in test_framework.\"\"\"\n+    # self.log.info(\"running custom_function\")  # Oops! Can't run self.log outside the BitcoinTestFramework\n+    pass\n+\n+class ExampleTest(BitcoinTestFramework):\n+    # Each functional test is a subclass of the BitcoinTestFramework class.\n+\n+    # Override the __init__(), add_options(), setup_chain(), setup_network()\n+    # and setup_nodes() methods to customize the test setup as required.\n+\n+    def __init__(self):\n+        \"\"\"Initialize the test\n+\n+        Call super().__init__() first, and then override any test parameters\n+        for your individual test.\"\"\"\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        # Use self.extra_args to change command-line arguments for the nodes\n+        self.extra_args = [[], [\"-logips\"], []]\n+\n+        # self.log.info(\"I've finished __init__\")  # Oops! Can't run self.log before run_test()\n+\n+    # Use add_options() to add specific command-line options for your test.\n+    # In practice this is not used very much, since the tests are mostly written\n+    # to be run in automated environments without command-line options.\n+    # def add_options()\n+    #     pass\n+\n+    # Use setup_chain() to customize the node data directories. In practice\n+    # this is not used very much since the default behaviour is almost always\n+    # fine\n+    # def setup_chain():\n+    #     pass\n+\n+    def setup_network(self):\n+        \"\"\"Setup the test network topology\n+\n+        Often you won't need to override this, since the standard network topology\n+        (linear: node0 <-> node1 <-> node2 <-> ...) is fine for most tests.\n+\n+        If you do override this method, remember to start the nodes, assign\n+        them to self.nodes, connect them and then sync.\"\"\"\n+\n+        self.setup_nodes()\n+\n+        # In this test, we're not connecting node2 to node0 or node1. Calls to\n+        # sync_all() should not include node2, since we're not expecting it to\n+        # sync.\n+        connect_nodes_bi(self.nodes, 0, 1)\n+        self.sync_all([self.nodes[0:1]])\n+\n+    # Use setup_nodes() to customize the node start behaviour (for example if\n+    # you don't want to start all nodes at the start of the test).\n+    # def setup_nodes():\n+    #     pass\n+\n+    def custom_method(self):\n+        \"\"\"Do some custom behaviour for this test\n+\n+        Define it in a method here because you're going to use it repeatedly.\n+        If you think it's useful in general, consider moving it to the base\n+        BitcoinTestFramework class so other tests can use it.\"\"\"\n+\n+        self.log.info(\"Running custom_method\")\n+\n+    def run_test(self):\n+        \"\"\"Main test logic\"\"\"\n+\n+        # Create a p2p connection to one of the nodes\n+        node0 = BaseNode()\n+        connections = []\n+        connections.append(NodeConn('127.0.0.1', p2p_port(0), self.nodes[0], node0))\n+        node0.add_connection(connections[0])\n+\n+        # Start up network handling in another thread. This needs to be called\n+        # after the p2p connections have been created.\n+        NetworkThread().start()\n+        # wait_for_verack ensures that the p2p connection is fully up.\n+        node0.wait_for_verack()\n+\n+        # Generating a block on one of the nodes will get us out of IBD\n+        blocks = [int(self.nodes[0].generate(nblocks=1)[0], 16)]\n+\n+        # Notice above how we called an RPC by calling a method with the same\n+        # name on the node object. Notice also how we used a keyword argument\n+        # to specify a named RPC argument. Neither of those are defined on the\n+        # node object. Instead there's some __getattr__() magic going on under\n+        # the covers to dispatch unrecognised attribute calls to the RPC\n+        # interface.\n+\n+        # Logs are nice. Do plenty of them. They can be used in place of comments for\n+        # breaking the test into sub-sections.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10612#discussion_r122592584",
      "id" : 122592584,
      "original_commit_id" : "5a0134a5deb09103e4ba70ebf519c26c1557985b",
      "original_position" : 152,
      "path" : "test/functional/example_test.py",
      "position" : 152,
      "pull_request_review_id" : 44722930,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10612",
      "updated_at" : "2017-06-18T14:47:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122592584",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10612#discussion_r122592689"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122592689"
         }
      },
      "body" : "Since travis supports color, could we run `combine_logs.py` on travis as well?",
      "commit_id" : "5a0134a5deb09103e4ba70ebf519c26c1557985b",
      "created_at" : "2017-06-18T14:45:33Z",
      "diff_hunk" : "@@ -15,84 +15,148 @@ The util tests are run as part of `make check` target. The functional\n tests are run by the travis continuous build process whenever a pull\n request is opened. Both sets of tests can also be run locally.\n \n-Functional Test dependencies\n-============================\n+# Running tests locally\n+\n+Build for your system first. Be sure to enable wallet, utils and daemon when you configure. Tests will not run otherwise.\n+\n+### Functional tests\n+\n+#### Dependencies\n+\n The ZMQ functional test requires a python ZMQ library. To install it:\n \n - on Unix, run `sudo apt-get install python3-zmq`\n - on mac OS, run `pip3 install pyzmq`\n \n-Running tests locally\n-=====================\n+#### Running the tests\n \n-Build for your system first. Be sure to enable wallet, utils and daemon when you configure. Tests will not run otherwise.\n+Individual tests can be run by directly calling the test script, eg:\n \n-Functional tests\n-----------------\n+```\n+test/functional/replace-by-fee.py\n+```\n \n-You can run any single test by calling\n+or can be run through the test_runner harness, eg:\n \n-    test/functional/test_runner.py <testname>\n+```\n+test/functional/test_runner.py replace-by-fee.py\n+```\n \n-Or you can run any combination (incl. duplicates) of tests by calling\n+You can run any combination (incl. duplicates) of tests by calling:\n \n-    test/functional/test_runner.py <testname1> <testname2> <testname3> ...\n+```\n+test/functional/test_runner.py <testname1> <testname2> <testname3> ...\n+```\n \n-Run the regression test suite with\n+Run the regression test suite with:\n \n-    test/functional/test_runner.py\n+```\n+test/functional/test_runner.py\n+```\n \n Run all possible tests with\n \n-    test/functional/test_runner.py --extended\n+```\n+test/functional/test_runner.py --extended\n+```\n+\n+By default, up to 4 tests will be run in parallel by test_runner. To specify\n+how many jobs to run, append `--jobs=n`\n \n-By default, tests will be run in parallel. To specify how many jobs to run,\n-append `--jobs=n` (default n=4).\n+The individual tests and the test_runner harness have many command-line\n+options. Run `test_runner.py -h` to see them all.\n \n-If you want to create a basic coverage report for the RPC test suite, append `--coverage`.\n+#### Troubleshooting and debugging test failures\n \n-Possible options, which apply to each individual test run:\n+##### Resource contention\n \n-```\n-  -h, --help            show this help message and exit\n-  --nocleanup           Leave bitcoinds and test.* datadir on exit or error\n-  --noshutdown          Don't stop bitcoinds after the test execution\n-  --srcdir=SRCDIR       Source directory containing bitcoind/bitcoin-cli\n-                        (default: ../../src)\n-  --tmpdir=TMPDIR       Root directory for datadirs\n-  --tracerpc            Print out all RPC calls as they are made\n-  --coveragedir=COVERAGEDIR\n-                        Write tested RPC commands into this directory\n+The p2p and RPC ports used by the bitcoind nodes-under-test are chosen to make\n+conflicts with other processes unlikely. However, if there is another bitcoind\n+process running on the system (perhaps from a previous test which hasn't successfully\n+killed all its bitcoind nodes), then there may be a port conflict which will\n+cause the test to fail. It is recommended that you run the tests on a system\n+where no other bitcoind processes are running.\n+\n+On linux, the test_framework will warn if there is another\n+bitcoind process running when the tests are started.\n+\n+If there are zombie bitcoind processes after test failure, you can kill them by running:\n+\n+```bash\n+killall bitcoind\n ```\n \n-If you set the environment variable `PYTHON_DEBUG=1` you will get some debug\n-output (example: `PYTHON_DEBUG=1 test/functional/test_runner.py wallet`).\n+or\n \n-A 200-block -regtest blockchain and wallets for four nodes\n-is created the first time a regression test is run and\n-is stored in the cache/ directory. Each node has 25 mature\n-blocks (25*50=1250 BTC) in its wallet.\n+```bash\n+pkill -9 bitcoind\n+```\n \n-After the first run, the cache/ blockchain and wallets are\n-copied into a temporary directory and used as the initial\n-test state.\n+##### Data directory cache\n \n-If you get into a bad state, you should be able\n-to recover with:\n+A pre-mined blockchain with 200 blocks is generated the first time a\n+functional test is run and is stored in test/cache. This speeds up\n+test startup times since new blockchains don't need to be generated for\n+each test. However, the cache may get into a bad state, in which case\n+tests will fail. If this happens, remove the cache directory (and make\n+sure bitcoind processes are stopped as above):\n \n ```bash\n rm -rf cache\n killall bitcoind\n ```\n \n-Util tests\n-----------\n+##### Test logging\n+\n+The tests contain logging at different levels (debug, info, warning, etc). By\n+default:\n+\n+- when run through the test_runner harness, *all* logs are written to\n+  `test_framework.log` and no logs are output to the console.\n+- when run directly, *all* logs are written to `test_framework.log` and INFO\n+  level and above are output to the console.\n+- when run on Travis, no logs are output to the console. However, if a test",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10612#discussion_r122592689",
      "id" : 122592689,
      "original_commit_id" : "5a0134a5deb09103e4ba70ebf519c26c1557985b",
      "original_position" : 145,
      "path" : "test/README.md",
      "position" : 145,
      "pull_request_review_id" : 44722930,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10612",
      "updated_at" : "2017-06-18T14:47:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122592689",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "Awesome! Concept ACK x2 ",
      "created_at" : "2017-06-18T14:55:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10612#issuecomment-309282442",
      "id" : 309282442,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10612",
      "updated_at" : "2017-06-18T14:55:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/309282442",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3514957?v=3",
         "events_url" : "https://api.github.com/users/Christewart/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Christewart/followers",
         "following_url" : "https://api.github.com/users/Christewart/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Christewart/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Christewart",
         "id" : 3514957,
         "login" : "Christewart",
         "organizations_url" : "https://api.github.com/users/Christewart/orgs",
         "received_events_url" : "https://api.github.com/users/Christewart/received_events",
         "repos_url" : "https://api.github.com/users/Christewart/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Christewart/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Christewart/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Christewart"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10612#discussion_r122593943"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122593943"
         }
      },
      "body" : "Indeed. I'd also like to see an assert within `wait_until()`. I've previously tried adding an assert into that function and it causes several tests to fail.\r\n\r\nFixing those cases where `wait_until()` isn't actually returning True is a job for another PR. When that happens, a scripted diff to `s/assert wait_until/wait_until/` should be run, which will update this example test script.",
      "commit_id" : "5a0134a5deb09103e4ba70ebf519c26c1557985b",
      "created_at" : "2017-06-18T15:39:20Z",
      "diff_hunk" : "@@ -0,0 +1,205 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"An example functional test\n+\n+The module-level docstring should include a high-level description of\n+what the test is doing. It's the first thing people see when they open\n+the file and should give the reader information about *what* the test\n+is testing and *how* it's being tested\n+\"\"\"\n+# Imports should be in PEP8 ordering (std library first, then third party\n+# libraries then local imports).\n+from collections import defaultdict\n+\n+# Avoid wildcard * imports if possible\n+from test_framework.blocktools import (create_block, create_coinbase)\n+from test_framework.mininode import (\n+    CInv,\n+    NetworkThread,\n+    NodeConn,\n+    NodeConnCB,\n+    msg_block,\n+    msg_getdata,\n+    wait_until,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (connect_nodes_bi, p2p_port)\n+\n+# NodeConnCB is a class containing callbacks to be executed when a p2p\n+# message is received from the node-under-test. Subclass NodeConnCB and\n+# override the on_*() methods if you need custom behaviour.\n+class BaseNode(NodeConnCB):\n+    def __init__(self):\n+        \"\"\"Initialize the NodeConnCB\n+\n+        Used to inialize custom properties for the Node that aren't\n+        included by default in the base class. Be aware that the NodeConnCB\n+        base class already stores a counter for each p2p message type and the\n+        last received message of each type, which should be sufficient for the\n+        needs of most tests.\n+\n+        Call super().__init__() first for standard initialization and then\n+        initialize custom properties.\"\"\"\n+        super().__init__()\n+        # Stores a dictionary of all blocks received\n+        self.block_receive_map = defaultdict(int)\n+\n+    def on_block(self, conn, message):\n+        \"\"\"Override the standard on_block callback\n+\n+        Store the hash of a received block in the dictionary.\"\"\"\n+        message.block.calc_sha256()\n+        self.block_receive_map[message.block.sha256] += 1\n+\n+def custom_function():\n+    \"\"\"Do some custom behaviour\n+\n+    If this function is more generally useful for other tests, consider\n+    moving it to a module in test_framework.\"\"\"\n+    # self.log.info(\"running custom_function\")  # Oops! Can't run self.log outside the BitcoinTestFramework\n+    pass\n+\n+class ExampleTest(BitcoinTestFramework):\n+    # Each functional test is a subclass of the BitcoinTestFramework class.\n+\n+    # Override the __init__(), add_options(), setup_chain(), setup_network()\n+    # and setup_nodes() methods to customize the test setup as required.\n+\n+    def __init__(self):\n+        \"\"\"Initialize the test\n+\n+        Call super().__init__() first, and then override any test parameters\n+        for your individual test.\"\"\"\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 3\n+        # Use self.extra_args to change command-line arguments for the nodes\n+        self.extra_args = [[], [\"-logips\"], []]\n+\n+        # self.log.info(\"I've finished __init__\")  # Oops! Can't run self.log before run_test()\n+\n+    # Use add_options() to add specific command-line options for your test.\n+    # In practice this is not used very much, since the tests are mostly written\n+    # to be run in automated environments without command-line options.\n+    # def add_options()\n+    #     pass\n+\n+    # Use setup_chain() to customize the node data directories. In practice\n+    # this is not used very much since the default behaviour is almost always\n+    # fine\n+    # def setup_chain():\n+    #     pass\n+\n+    def setup_network(self):\n+        \"\"\"Setup the test network topology\n+\n+        Often you won't need to override this, since the standard network topology\n+        (linear: node0 <-> node1 <-> node2 <-> ...) is fine for most tests.\n+\n+        If you do override this method, remember to start the nodes, assign\n+        them to self.nodes, connect them and then sync.\"\"\"\n+\n+        self.setup_nodes()\n+\n+        # In this test, we're not connecting node2 to node0 or node1. Calls to\n+        # sync_all() should not include node2, since we're not expecting it to\n+        # sync.\n+        connect_nodes_bi(self.nodes, 0, 1)\n+        self.sync_all([self.nodes[0:1]])\n+\n+    # Use setup_nodes() to customize the node start behaviour (for example if\n+    # you don't want to start all nodes at the start of the test).\n+    # def setup_nodes():\n+    #     pass\n+\n+    def custom_method(self):\n+        \"\"\"Do some custom behaviour for this test\n+\n+        Define it in a method here because you're going to use it repeatedly.\n+        If you think it's useful in general, consider moving it to the base\n+        BitcoinTestFramework class so other tests can use it.\"\"\"\n+\n+        self.log.info(\"Running custom_method\")\n+\n+    def run_test(self):\n+        \"\"\"Main test logic\"\"\"\n+\n+        # Create a p2p connection to one of the nodes\n+        node0 = BaseNode()\n+        connections = []\n+        connections.append(NodeConn('127.0.0.1', p2p_port(0), self.nodes[0], node0))\n+        node0.add_connection(connections[0])\n+\n+        # Start up network handling in another thread. This needs to be called\n+        # after the p2p connections have been created.\n+        NetworkThread().start()\n+        # wait_for_verack ensures that the p2p connection is fully up.\n+        node0.wait_for_verack()\n+\n+        # Generating a block on one of the nodes will get us out of IBD\n+        blocks = [int(self.nodes[0].generate(nblocks=1)[0], 16)]\n+\n+        # Notice above how we called an RPC by calling a method with the same\n+        # name on the node object. Notice also how we used a keyword argument\n+        # to specify a named RPC argument. Neither of those are defined on the\n+        # node object. Instead there's some __getattr__() magic going on under\n+        # the covers to dispatch unrecognised attribute calls to the RPC\n+        # interface.\n+\n+        # Logs are nice. Do plenty of them. They can be used in place of comments for\n+        # breaking the test into sub-sections.\n+        self.log.info(\"Starting test!\")\n+\n+        self.log.info(\"Calling a custom function\")\n+        custom_function()\n+\n+        self.log.info(\"Calling a custom method\")\n+        self.custom_method()\n+\n+        self.log.info(\"Create some blocks\")\n+        self.tip = int(self.nodes[0].getbestblockhash(), 16)\n+        self.block_time = self.nodes[0].getblock(self.nodes[0].getbestblockhash())['time'] + 1\n+\n+        height = 1\n+\n+        for i in range(10):\n+            # Use the mininode and blocktools functionality to manually build a block\n+            # Calling the generate() rpc is easier, but this allows us to exactly\n+            # control the blocks and transactions.\n+            block = create_block(self.tip, create_coinbase(height), self.block_time)\n+            block.solve()\n+            block_message = msg_block(block)\n+            # Send message is used to send a p2p message to the node over our NodeConn connection\n+            node0.send_message(block_message)\n+            self.tip = block.sha256\n+            blocks.append(self.tip)\n+            self.block_time += 1\n+            height += 1\n+\n+        self.log.info(\"Wait for node1 to reach current tip (height 11) using RPC\")\n+        self.nodes[1].waitforblockheight(11)\n+\n+        self.log.info(\"Connect node2 and node1\")\n+        connect_nodes_bi(self.nodes, 1, 2)\n+\n+        self.log.info(\"Add p2p connection to node2\")\n+        node2 = BaseNode()\n+        connections.append(NodeConn('127.0.0.1', p2p_port(2), self.nodes[2], node2))\n+        node2.add_connection(connections[1])\n+        node2.wait_for_verack()\n+\n+        self.log.info(\"Wait for node2 reach current tip. Test that it has propogated all the blocks to us\")\n+\n+        for block in blocks:\n+            getdata_request = msg_getdata()\n+            getdata_request.inv.append(CInv(2, block))\n+            node2.send_message(getdata_request)\n+\n+        # wait_until() will loop until a predicate condition is met. Use it to test properties of the\n+        # ConnNodeCB objects.\n+        assert wait_until(lambda: sorted(blocks) == sorted(list(node2.block_receive_map.keys())), timeout=5)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10612#discussion_r122593943",
      "id" : 122593943,
      "original_commit_id" : "5a0134a5deb09103e4ba70ebf519c26c1557985b",
      "original_position" : 202,
      "path" : "test/functional/example_test.py",
      "position" : 202,
      "pull_request_review_id" : 44724055,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10612",
      "updated_at" : "2017-06-18T15:41:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122593943",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10612#discussion_r122594010"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10612"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122594010"
         }
      },
      "body" : "Potentially, yes. `combine_logs.py` was written to be portable (and even usable on machines where test_framework is not installed).\r\n\r\nAgain, I think this is a job for another PR.",
      "commit_id" : "5a0134a5deb09103e4ba70ebf519c26c1557985b",
      "created_at" : "2017-06-18T15:41:59Z",
      "diff_hunk" : "@@ -15,84 +15,148 @@ The util tests are run as part of `make check` target. The functional\n tests are run by the travis continuous build process whenever a pull\n request is opened. Both sets of tests can also be run locally.\n \n-Functional Test dependencies\n-============================\n+# Running tests locally\n+\n+Build for your system first. Be sure to enable wallet, utils and daemon when you configure. Tests will not run otherwise.\n+\n+### Functional tests\n+\n+#### Dependencies\n+\n The ZMQ functional test requires a python ZMQ library. To install it:\n \n - on Unix, run `sudo apt-get install python3-zmq`\n - on mac OS, run `pip3 install pyzmq`\n \n-Running tests locally\n-=====================\n+#### Running the tests\n \n-Build for your system first. Be sure to enable wallet, utils and daemon when you configure. Tests will not run otherwise.\n+Individual tests can be run by directly calling the test script, eg:\n \n-Functional tests\n-----------------\n+```\n+test/functional/replace-by-fee.py\n+```\n \n-You can run any single test by calling\n+or can be run through the test_runner harness, eg:\n \n-    test/functional/test_runner.py <testname>\n+```\n+test/functional/test_runner.py replace-by-fee.py\n+```\n \n-Or you can run any combination (incl. duplicates) of tests by calling\n+You can run any combination (incl. duplicates) of tests by calling:\n \n-    test/functional/test_runner.py <testname1> <testname2> <testname3> ...\n+```\n+test/functional/test_runner.py <testname1> <testname2> <testname3> ...\n+```\n \n-Run the regression test suite with\n+Run the regression test suite with:\n \n-    test/functional/test_runner.py\n+```\n+test/functional/test_runner.py\n+```\n \n Run all possible tests with\n \n-    test/functional/test_runner.py --extended\n+```\n+test/functional/test_runner.py --extended\n+```\n+\n+By default, up to 4 tests will be run in parallel by test_runner. To specify\n+how many jobs to run, append `--jobs=n`\n \n-By default, tests will be run in parallel. To specify how many jobs to run,\n-append `--jobs=n` (default n=4).\n+The individual tests and the test_runner harness have many command-line\n+options. Run `test_runner.py -h` to see them all.\n \n-If you want to create a basic coverage report for the RPC test suite, append `--coverage`.\n+#### Troubleshooting and debugging test failures\n \n-Possible options, which apply to each individual test run:\n+##### Resource contention\n \n-```\n-  -h, --help            show this help message and exit\n-  --nocleanup           Leave bitcoinds and test.* datadir on exit or error\n-  --noshutdown          Don't stop bitcoinds after the test execution\n-  --srcdir=SRCDIR       Source directory containing bitcoind/bitcoin-cli\n-                        (default: ../../src)\n-  --tmpdir=TMPDIR       Root directory for datadirs\n-  --tracerpc            Print out all RPC calls as they are made\n-  --coveragedir=COVERAGEDIR\n-                        Write tested RPC commands into this directory\n+The p2p and RPC ports used by the bitcoind nodes-under-test are chosen to make\n+conflicts with other processes unlikely. However, if there is another bitcoind\n+process running on the system (perhaps from a previous test which hasn't successfully\n+killed all its bitcoind nodes), then there may be a port conflict which will\n+cause the test to fail. It is recommended that you run the tests on a system\n+where no other bitcoind processes are running.\n+\n+On linux, the test_framework will warn if there is another\n+bitcoind process running when the tests are started.\n+\n+If there are zombie bitcoind processes after test failure, you can kill them by running:\n+\n+```bash\n+killall bitcoind\n ```\n \n-If you set the environment variable `PYTHON_DEBUG=1` you will get some debug\n-output (example: `PYTHON_DEBUG=1 test/functional/test_runner.py wallet`).\n+or\n \n-A 200-block -regtest blockchain and wallets for four nodes\n-is created the first time a regression test is run and\n-is stored in the cache/ directory. Each node has 25 mature\n-blocks (25*50=1250 BTC) in its wallet.\n+```bash\n+pkill -9 bitcoind\n+```\n \n-After the first run, the cache/ blockchain and wallets are\n-copied into a temporary directory and used as the initial\n-test state.\n+##### Data directory cache\n \n-If you get into a bad state, you should be able\n-to recover with:\n+A pre-mined blockchain with 200 blocks is generated the first time a\n+functional test is run and is stored in test/cache. This speeds up\n+test startup times since new blockchains don't need to be generated for\n+each test. However, the cache may get into a bad state, in which case\n+tests will fail. If this happens, remove the cache directory (and make\n+sure bitcoind processes are stopped as above):\n \n ```bash\n rm -rf cache\n killall bitcoind\n ```\n \n-Util tests\n-----------\n+##### Test logging\n+\n+The tests contain logging at different levels (debug, info, warning, etc). By\n+default:\n+\n+- when run through the test_runner harness, *all* logs are written to\n+  `test_framework.log` and no logs are output to the console.\n+- when run directly, *all* logs are written to `test_framework.log` and INFO\n+  level and above are output to the console.\n+- when run on Travis, no logs are output to the console. However, if a test",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10612#discussion_r122594010",
      "id" : 122594010,
      "original_commit_id" : "5a0134a5deb09103e4ba70ebf519c26c1557985b",
      "original_position" : 145,
      "path" : "test/README.md",
      "position" : 145,
      "pull_request_review_id" : 44724108,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10612",
      "updated_at" : "2017-06-18T15:41:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122594010",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "@laanwj @Marcofalke @christewart - thanks for the feedback.\r\n\r\nAny comments on the suggested style guide? I was expecting that to be the area where people would have opinions.",
      "created_at" : "2017-06-18T15:43:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10612#issuecomment-309285220",
      "id" : 309285220,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10612",
      "updated_at" : "2017-06-18T15:43:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/309285220",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
