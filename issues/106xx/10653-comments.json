[
   {
      "body" : "This is a simple and effective change. I could think this is viable for a first step.\r\n\r\nThe downsides of this are:\r\n-> Incompatible with non name based RPC calls\r\n-> Harder for later process separation (wallet switch is then in the JSON/Data layer)",
      "created_at" : "2017-06-23T08:50:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10653#issuecomment-310610290",
      "id" : 310610290,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10653",
      "updated_at" : "2017-06-23T08:50:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310610290",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10653#discussion_r123700777"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10653"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/123700777"
         }
      },
      "body" : "I guess `vpwallets` needs concurrency protection. ",
      "commit_id" : "01bd4bef23d0f3c81bb11fb8ecba409898ff01f1",
      "created_at" : "2017-06-23T08:51:33Z",
      "diff_hunk" : "@@ -31,7 +31,14 @@\n \n CWallet *GetWalletForJSONRPCRequest(const JSONRPCRequest& request)\n {\n-    // TODO: Some way to access secondary wallets\n+    if (!request.wallet.empty()) {\n+        for (const auto& wallet : ::vpwallets) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10653#discussion_r123700777",
      "id" : 123700777,
      "original_commit_id" : "01bd4bef23d0f3c81bb11fb8ecba409898ff01f1",
      "original_position" : 6,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 45930463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10653",
      "updated_at" : "2017-06-23T08:51:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/123700777",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "I kind of like this solution. It's simple and elegant. A pity no one brought this up at the IRC meeting two weeks ago when this was discussed. I hadn't realized name-based arguments had made this so easy.\r\n\r\nEndpoint-based has the slight advantage that the RPC client code only has to make one change to use a different wallet: use a different URL. This needs a change to pass the argument for every RPC call, and forgetting one may result in hard-to-troubleshoot, possibly even dangerous issues (as it is not enforced, so it uses the default wallet by accident).\r\n",
      "created_at" : "2017-06-24T11:26:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10653#issuecomment-310833084",
      "id" : 310833084,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10653",
      "updated_at" : "2017-06-24T11:26:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310833084",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "> A pity no one brought this up at the IRC meeting two weeks ago when this was discussed\r\n\r\n> 12:46 < luke-jr> BTW, did we consider a generic JSON-RPC \"wallet\" named param?\r\n> 12:46 < sipa> luke-jr: i suggested that before, yes\r\n> 12:46 < sipa> luke-jr: i'd be fine with it, except it's less compatible with a future change that moves it to a different process (which will necessarily have a new endpoint)\r\n> 12:46 < jonasschnelli> luke-jr: generic wallet named parameter seems fine. Is it mixable with the non-named parameter?\r\n> 12:47 < sipa> so i think this guideline may help: arguments that select something that may in the future move to another process, should go into the path\r\n> 12:47 < sipa> other things should be RPC named args\r\n\r\nI'm fine with supporting this however, it would certainly be easier to use in some cases. We don't have to support the entire future today-- when the wallet is separated the API could change.\r\n\r\nOr not.\r\n\r\nI'm just commenting to point out that it did come up in the meeting! :)\r\n",
      "created_at" : "2017-06-27T19:21:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10653#issuecomment-311458573",
      "id" : 311458573,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10653",
      "updated_at" : "2017-06-27T19:21:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/311458573",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "I like this approach. It seems like the simplest and most straightforward way of exposing multiwallet functionality through the RPC interface. Longer term, if we do separate wallets out into separate processes, then I think multiple endpoints (#10650) makes sense. So my preference would be to do this now, with a warning that the API is unstable and will likely change in the future.\r\n\r\nI haven't reviewed the code for any of the PRs yet. The above comment is simply on the concept. I intend to to look at the code for all four proposals soon.\r\n\r\nNote that the OP for this PR has a wrong link. *#10653 is an alternate implementation ...* should be *#10661 is an alternate implementation ...*",
      "created_at" : "2017-06-27T19:47:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10653#issuecomment-311465199",
      "id" : 311465199,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10653",
      "updated_at" : "2017-06-27T19:47:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/311465199",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "Thanks, updated the description. I do think #10661 is preferable to this PR. Although #10661 and this PR look almost the same externally (both accepting new wallet= named parameters for wallet methods), there are some differences:\r\n\r\n- Wallet parameters are documented in #10661, while in this PR they are completely undocumented.\r\n- Extra wallet= parameters on non-wallet methods trigger errors in #10661, while here they are silently ignored.\r\n- Passing wallet values as positional arguments is possible in #10661, while here they have to be passed as named arguments.",
      "created_at" : "2017-06-28T00:34:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10653#issuecomment-311523589",
      "id" : 311523589,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10653",
      "updated_at" : "2017-06-28T00:34:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/311523589",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Just want to point out that both this PR and #10661 are compatible with #10615 and #10650. Accepting wallet JSON-RPC arguments doesn't prevent us from restricting access to wallets based on endpoint or user authorization in the future. (In #10661, I'm keeping the unused `request` argument to `GetWalletForJSONRPCRequest` specifically to make sure this is easy to do later on.)\r\n\r\n> This needs a change to pass the argument for every RPC call, and forgetting one may result in hard-to-troubleshoot, possibly even dangerous issues (as it is not enforced, so it uses the default wallet by accident).\r\n\r\nThis is a really good point that I didn't think of. I think in general this could be a dangerous side effect of supporting a \"default wallet\" for RPC calls in any of the 4 PRs. A user could accidentally forget to specify the wallet in a single API call, and wind up affecting a different wallet than intended. Maybe it would be good to kill the notion of a \"default wallet\" for RPCs entirely by requiring the wallet to be explicitly specified whenever more than one is loaded. This could be done by returning null from `GetWalletForJSONRPCRequest` whenever `vpwallets.size() > 1` when no wallet is specified in any of the PRs.\r\n",
      "created_at" : "2017-06-28T00:50:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10653#issuecomment-311525753",
      "id" : 311525753,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10653",
      "updated_at" : "2017-06-28T00:50:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/311525753",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "> Extra wallet= parameters on non-wallet methods trigger errors in #10661, while here they are silently ignored.\r\n\r\nThis seems to be the largest downside of this approach to me, but it seems fixable by adding a flag to the RPC dispatch tables to mark wallet RPC specially?",
      "created_at" : "2017-06-28T00:54:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10653#issuecomment-311526218",
      "id" : 311526218,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10653",
      "updated_at" : "2017-06-28T00:55:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/311526218",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "> This seems to be the largest downside of this approach to me, but it seems fixable by adding a flag to the RPC dispatch tables to mark wallet RPC specially?\r\n\r\nSure, but adding more special treatment of wallet parameters to this PR would just make me prefer #10661 even more. I don't like the idea of wallet parameters having magical attributes that make them different from other parameters when #10661 shows they can work just fine as normal arguments.",
      "created_at" : "2017-06-28T01:02:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10653#issuecomment-311527551",
      "id" : 311527551,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10653",
      "updated_at" : "2017-06-28T01:04:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/311527551",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "@ryanofsky I don't think that's so bad if you see it as a preparation for moving the wallet to a separate process entirely.",
      "created_at" : "2017-06-28T01:07:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10653#issuecomment-311528150",
      "id" : 311528150,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10653",
      "updated_at" : "2017-06-28T01:07:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/311528150",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
