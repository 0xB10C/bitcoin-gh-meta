[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10618#discussion_r122555176"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10618"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122555176"
         }
      },
      "body" : "Probably easier to rewrite this expression using a separate constant MIN_TRANSACTION_WEIGHT",
      "commit_id" : "f1cc730e35e8582a4b481eccaa3292f9cf25a4c5",
      "created_at" : "2017-06-17T00:25:58Z",
      "diff_hunk" : "@@ -50,7 +50,7 @@ uint64_t CBlockHeaderAndShortTxIDs::GetShortID(const uint256& txhash) const {\n ReadStatus PartiallyDownloadedBlock::InitData(const CBlockHeaderAndShortTxIDs& cmpctblock, const std::vector<std::pair<uint256, CTransactionRef>>& extra_txn) {\n     if (cmpctblock.header.IsNull() || (cmpctblock.shorttxids.empty() && cmpctblock.prefilledtxn.empty()))\n         return READ_STATUS_INVALID;\n-    if (cmpctblock.shorttxids.size() + cmpctblock.prefilledtxn.size() > MAX_BLOCK_BASE_SIZE / MIN_TRANSACTION_BASE_SIZE)\n+    if (cmpctblock.shorttxids.size() + cmpctblock.prefilledtxn.size() > MAX_BLOCK_WEIGHT / (WITNESS_SCALE_FACTOR * MIN_TRANSACTION_BASE_SIZE))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10618#discussion_r122555176",
      "id" : 122555176,
      "original_commit_id" : "f1cc730e35e8582a4b481eccaa3292f9cf25a4c5",
      "original_position" : 5,
      "path" : "src/blockencodings.cpp",
      "position" : 5,
      "pull_request_review_id" : 44687350,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10618",
      "updated_at" : "2017-06-17T00:25:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122555176",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10618#discussion_r122555918"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10618"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122555918"
         }
      },
      "body" : "Similarly, this is probably easier to write using a MIN_TRANSACTION_OUTPUT_WEIGHT.",
      "commit_id" : "f1cc730e35e8582a4b481eccaa3292f9cf25a4c5",
      "created_at" : "2017-06-17T00:40:02Z",
      "diff_hunk" : "@@ -237,7 +237,7 @@ bool CCoinsViewCache::HaveInputs(const CTransaction& tx) const\n     return true;\n }\n \n-static const size_t MAX_OUTPUTS_PER_BLOCK = MAX_BLOCK_BASE_SIZE /  ::GetSerializeSize(CTxOut(), SER_NETWORK, PROTOCOL_VERSION); // TODO: merge with similar definition in undo.h.\n+static const size_t MAX_OUTPUTS_PER_BLOCK = MAX_BLOCK_WEIGHT / (WITNESS_SCALE_FACTOR * ::GetSerializeSize(CTxOut(), SER_NETWORK, PROTOCOL_VERSION)); // TODO: merge with similar definition in undo.h.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10618#discussion_r122555918",
      "id" : 122555918,
      "original_commit_id" : "f1cc730e35e8582a4b481eccaa3292f9cf25a4c5",
      "original_position" : 5,
      "path" : "src/coins.cpp",
      "position" : 5,
      "pull_request_review_id" : 44688073,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10618",
      "updated_at" : "2017-06-17T00:40:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/122555918",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "utACK, but needs rebase.\r\n\r\nWhy isn't WITNESS_SCALE_FACTOR in consensus/consensus.h ?\r\n\r\nThank you very much for this, sometimes I've explained that the max size is superflous once you replace it with the max weight, and often people don't believe me and some times they even link to the max size constant as a \"proof\" that I am wrong.\r\n",
      "created_at" : "2017-06-25T05:35:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10618#issuecomment-310883862",
      "id" : 310883862,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10618",
      "updated_at" : "2017-06-25T05:35:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310883862",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Needs rebase after #10608",
      "created_at" : "2017-06-25T08:27:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10618#issuecomment-310889858",
      "id" : 310889858,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10618",
      "updated_at" : "2017-06-25T08:27:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310889858",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "> Why isn't WITNESS_SCALE_FACTOR in consensus/consensus.h ?\r\n\r\nThe weight calculations are currently in primtives/transaction.h, and I don't think that file should depend on consensus.h. Perhaps all weight based calculations can be moved to consensus/*, though.",
      "created_at" : "2017-06-25T19:28:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10618#issuecomment-310922773",
      "id" : 310922773,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10618",
      "updated_at" : "2017-06-25T19:28:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310922773",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "> The weight calculations are currently in primtives/transaction.h, and I don't think that file should depend on consensus.h. \r\n\r\nWhy not? consensus/consensus.h it's just consensus constants. Anyway, not a big deal, there with MIN_TRANSACTION_WEIGHT isn't bad.\r\n\r\n> Perhaps all weight based calculations can be moved to consensus/*, though.\r\n\r\nDo you mean moving primitives/* to consensus/ ? I proposed that in the past, I'm all for it, but that's definitely out of scope for this PR.\r\n",
      "created_at" : "2017-06-25T20:55:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10618#issuecomment-310927687",
      "id" : 310927687,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10618",
      "updated_at" : "2017-06-25T20:55:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310927687",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "No, just moving the weight calculations to consensus. Primitives is data structures and serialization, and shouldn't depend on consensus validity rules.",
      "created_at" : "2017-06-25T21:02:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10618#issuecomment-310928116",
      "id" : 310928116,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10618",
      "updated_at" : "2017-06-25T21:02:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310928116",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
