[
   {
      "body" : "Under which circumstances can Tip() be NULL? \r\nIsn't there always at least the genesis block? \r\n\r\nIf it is NULL, it crashes anyway as there are many more instances  of Tip() dereferences without NULL checks in the same function alone (i.e. for `bestblockhash`, chainwork`, etc.).\r\n \r\nIf it can be NULL, then we should define how the rpc output should look like in this case, and fix all instances / make the output consistent.\r\n\r\nIf it can't be null, we should ensure that in the Tip() function.",
      "created_at" : "2017-06-17T12:15:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10619#issuecomment-309211611",
      "id" : 309211611,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10619",
      "updated_at" : "2017-06-17T12:15:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/309211611",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1225267?v=3",
         "events_url" : "https://api.github.com/users/benma/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benma/followers",
         "following_url" : "https://api.github.com/users/benma/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benma/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benma",
         "id" : 1225267,
         "login" : "benma",
         "organizations_url" : "https://api.github.com/users/benma/orgs",
         "received_events_url" : "https://api.github.com/users/benma/received_events",
         "repos_url" : "https://api.github.com/users/benma/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benma/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benma/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benma"
      }
   },
   {
      "body" : "If Tip() never returns NULL, then checking `block` for nullness in the following statment:\r\n`while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA))`\r\n is redundant.\r\n\r\nDo you think this should become:\r\n`while (block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA))`\r\nwith the rest of the code remaining as is?\r\n\r\nSince Tip() can theoretically return NULL, I think that the best coding practice is to check for nullness somehow.",
      "created_at" : "2017-06-17T12:23:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10619#issuecomment-309211996",
      "id" : 309211996,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10619",
      "updated_at" : "2017-06-17T12:30:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/309211996",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/14562480?v=3",
         "events_url" : "https://api.github.com/users/pavlosantoniou/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pavlosantoniou/followers",
         "following_url" : "https://api.github.com/users/pavlosantoniou/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pavlosantoniou/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pavlosantoniou",
         "id" : 14562480,
         "login" : "pavlosantoniou",
         "organizations_url" : "https://api.github.com/users/pavlosantoniou/orgs",
         "received_events_url" : "https://api.github.com/users/pavlosantoniou/received_events",
         "repos_url" : "https://api.github.com/users/pavlosantoniou/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pavlosantoniou/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pavlosantoniou/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pavlosantoniou"
      }
   },
   {
      "body" : "> If Tip() never returns NULL [...] Do you think this should become:\r\n`while (block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA))`\r\nwith the rest of the code remaining as is?\r\n\r\nIn that case, yes.\r\n\r\nAs I said, if tip actually returns null, the function will crash as it is today, so we should either fix all of that (and document/test it), or have tip() not return null (and work backwards to ensure correctness).\r\n ",
      "created_at" : "2017-06-17T12:31:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10619#issuecomment-309212366",
      "id" : 309212366,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10619",
      "updated_at" : "2017-06-17T12:31:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/309212366",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1225267?v=3",
         "events_url" : "https://api.github.com/users/benma/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benma/followers",
         "following_url" : "https://api.github.com/users/benma/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benma/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benma",
         "id" : 1225267,
         "login" : "benma",
         "organizations_url" : "https://api.github.com/users/benma/orgs",
         "received_events_url" : "https://api.github.com/users/benma/received_events",
         "repos_url" : "https://api.github.com/users/benma/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benma/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benma/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benma"
      }
   },
   {
      "body" : "I think that checking the return value of a function that returns a pointer for nullness is a good practice that will safeguard the code from dereferencing a null pointer either under the current or under any other future implementation of Tip().\r\n\r\nActually, I see that in other parts of the code the return value of Tip() is checked for nullness. \r\nDo you think this PR should be merged to ensure consistency with that, before a more generic solution is investigated?\r\n",
      "created_at" : "2017-06-17T12:38:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10619#issuecomment-309212741",
      "id" : 309212741,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10619",
      "updated_at" : "2017-06-17T12:38:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/309212741",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/14562480?v=3",
         "events_url" : "https://api.github.com/users/pavlosantoniou/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pavlosantoniou/followers",
         "following_url" : "https://api.github.com/users/pavlosantoniou/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pavlosantoniou/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pavlosantoniou",
         "id" : 14562480,
         "login" : "pavlosantoniou",
         "organizations_url" : "https://api.github.com/users/pavlosantoniou/orgs",
         "received_events_url" : "https://api.github.com/users/pavlosantoniou/received_events",
         "repos_url" : "https://api.github.com/users/pavlosantoniou/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pavlosantoniou/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pavlosantoniou/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pavlosantoniou"
      }
   }
]
