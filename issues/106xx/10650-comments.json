[
   {
      "body" : "This would make much more sense as `?wallet=WALLETID` than trying to emulate a path...",
      "created_at" : "2017-06-22T07:56:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#issuecomment-310305250",
      "id" : 310305250,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10650",
      "updated_at" : "2017-06-22T07:56:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310305250",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "> This would make much more sense as ?wallet=WALLETID than trying to emulate a path...\r\n\r\nNo. Please no query string.\r\nThat doesn't make sense to me.\r\n\r\nPOST data to `/wallet/<name>` seems more reasonable to me then POST data to `/?wallet=<name>`",
      "created_at" : "2017-06-22T09:30:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#issuecomment-310328049",
      "id" : 310328049,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10650",
      "updated_at" : "2017-06-22T09:30:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310328049",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r123475967"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/123475967"
         }
      },
      "body" : "In commit \"Add -wallet endpoint support to bitcoin-cli\":\r\n\r\nProbably should url encode in case filename contains spaces, reserved characters, or unicode (utf8) https://en.wikipedia.org/wiki/Percent-encoding#Percent-encoding_reserved_characters\r\n\r\nCorresponding decode would be needed in GetWalletForJSONRPCRequest.",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-06-22T10:38:00Z",
      "diff_hunk" : "@@ -235,7 +235,12 @@ UniValue CallRPC(const std::string& strMethod, const UniValue& params)\n     assert(output_buffer);\n     evbuffer_add(output_buffer, strRequest.data(), strRequest.size());\n \n-    int r = evhttp_make_request(evcon.get(), req.get(), EVHTTP_REQ_POST, \"/\");\n+    // check if we should use a special wallet endpoint\n+    std::string endpoint = \"/\";\n+    if (GetArg(\"-wallet\", \"\") != \"\") {\n+        endpoint = \"/wallet/\"+GetArg(\"-wallet\", \"\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r123475967",
      "id" : 123475967,
      "original_commit_id" : "2753ea62b9ac1fbae8b5b96f251b0f46246253e4",
      "original_position" : 8,
      "path" : "src/bitcoin-cli.cpp",
      "position" : null,
      "pull_request_review_id" : 45681446,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-07T14:03:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/123475967",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r123484826"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/123484826"
         }
      },
      "body" : "In commit \"[QA] Add support for wallet endpoints in Authproxy\"\r\n\r\nIt seems hacky to me for AuthServiceProxy to be aware of multiwallet and to be munging urls and service name strings this way.\r\n\r\nI think it would be better if AuthServiceProxy didn't know anything about bitcoin urls and just let the caller control the request. There are many ways to allow this, but a simple one might be to define:\r\n\r\n```python\r\ndef __idiv__(self, relative_uri):\r\n    return AuthServiceProxy(\"{}/{}\".format(self.__service_url, relative_uri), self._service_name, connection=self.__conn)\r\n```\r\n\r\nThen you could call methods on individual wallets with:\r\n\r\n```python\r\nw1 = self.nodes[0] / \"wallet/w1.dat\"\r\nw1.getwalletinfo()\r\nw1.getbalance()\r\n```",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-06-22T11:25:51Z",
      "diff_hunk" : "@@ -139,17 +139,24 @@ def _request(self, method, path, postdata):\n             return self._get_response()\n \n     def __call__(self, *args, **argsn):\n-        AuthServiceProxy.__id_count += 1\n+        # check for a possible wallet endpoint\n+        urlAdd = \"\"\n+        method = self._service_name\n+        elements = self._service_name.split(\".\")\n+        if len(elements) > 1:\n+            urlAdd = \"/wallet/\" + '.'.join(elements[:-1])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r123484826",
      "id" : 123484826,
      "original_commit_id" : "8775248d0699f433c983fb986d86186ff1cab94f",
      "original_position" : 10,
      "path" : "test/functional/test_framework/authproxy.py",
      "position" : null,
      "pull_request_review_id" : 45681446,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-07T14:03:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/123484826",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r123489861"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/123489861"
         }
      },
      "body" : "In commit \"Add -wallet endpoint support to bitcoin-cli\":\r\n\r\nYou should update `HelpMessageCli` to mention the new argument.\r\n\r\nSince I started making a similar change (but didn't get very far) you could steal my help string:\r\n\r\n```diff\r\nstrUsage += HelpMessageOpt(\"-wallet=<file>\", _(\"Send RPC for non-default wallet on RPC server (argument is wallet filename in bitcoind directory)\"));\r\n```",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-06-22T11:54:51Z",
      "diff_hunk" : "@@ -235,7 +235,12 @@ UniValue CallRPC(const std::string& strMethod, const UniValue& params)\n     assert(output_buffer);\n     evbuffer_add(output_buffer, strRequest.data(), strRequest.size());\n \n-    int r = evhttp_make_request(evcon.get(), req.get(), EVHTTP_REQ_POST, \"/\");\n+    // check if we should use a special wallet endpoint\n+    std::string endpoint = \"/\";\n+    if (GetArg(\"-wallet\", \"\") != \"\") {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r123489861",
      "id" : 123489861,
      "original_commit_id" : "2753ea62b9ac1fbae8b5b96f251b0f46246253e4",
      "original_position" : 7,
      "path" : "src/bitcoin-cli.cpp",
      "position" : null,
      "pull_request_review_id" : 45681446,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-07T14:03:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/123489861",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Concept ACK, will review.\r\n\r\n> POST data to /wallet/<name> seems more reasonable to me then POST data to /?wallet=<name>\r\n\r\nI tend to agree:\r\n- The use of query strings is usually avoided in modern APIs because they make URLs less readable, compared to path segments.\r\n- Also for POST the query data is in the payload. It is very uncommon  to have query arguments in the URL.",
      "created_at" : "2017-06-22T13:36:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#issuecomment-310382168",
      "id" : 310382168,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10650",
      "updated_at" : "2017-06-22T13:36:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310382168",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I guess personally I don't see how `/?wallet=<name>` is \"less readable\" then `/wallet/<name>` and I think I mentioned some practical reasons above for wanting to prefer query strings, but I don't have a very strong preference.\r\n\r\nIf we want to go down the road of encoding request metadata in path segments instead of query parameters maybe we should put more thought into what the path hierarchy should be? It isn't obvious to me that you'd want to put wallet selection at the very top of the path hierarchy instead of something else like an API version version number.",
      "created_at" : "2017-06-22T15:06:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#issuecomment-310408400",
      "id" : 310408400,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10650",
      "updated_at" : "2017-06-22T15:06:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310408400",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r123543935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/123543935"
         }
      },
      "body" : "In commit \"Select wallet based on the given endpoint\"\r\n\r\nMaybe change error message to something like \"Wallet file does not exist or is not loaded\" to avoid implying that the wallet doesn't exist when it might just not be loaded.\r\n\r\nAlso, since this is a URI, sanitize call should be changed to allow `%` character and probably all reserved and unreserved characters from RFC3986 (`\"%-_.~!*'();:@&=+$,/?#[]\"`).",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-06-22T15:31:04Z",
      "diff_hunk" : "@@ -31,10 +31,30 @@\n \n #include <univalue.h>\n \n+static const std::string WALLET_ENDPOINT_BASE = \"/wallet/\";\n+\n CWallet *GetWalletForJSONRPCRequest(const JSONRPCRequest& request)\n {\n-    // TODO: Some way to access secondary wallets\n-    return vpwallets.empty() ? nullptr : vpwallets[0];\n+    LOCK(cs_main); // for now, protect vpwallets via cs_main\n+\n+    if (vpwallets.empty()) {\n+        return nullptr;\n+    }\n+    else if (request.URI.substr(0, WALLET_ENDPOINT_BASE.size()) == WALLET_ENDPOINT_BASE) {\n+        // wallet endpoint was used\n+        std::string requestedWallet = request.URI.substr(WALLET_ENDPOINT_BASE.size());\n+        for(CWallet* pwallet : vpwallets) {\n+            if (pwallet->GetWalletID() == requestedWallet) {\n+                return pwallet;\n+            }\n+        }\n+        // no wallet found with the given endpoint\n+        throw JSONRPCError(RPC_WALLET_NOT_FOUND, \"Requested wallet not found (\"+SanitizeString(requestedWallet)+\")\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r123543935",
      "id" : 123543935,
      "original_commit_id" : "1fa7d7e26b5056c66fabd1bec12c208f4dc963c8",
      "original_position" : 24,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 40,
      "pull_request_review_id" : 45758667,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-07T14:03:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/123543935",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "My initial impression was \"I thought we were going to put an RPC api version in the path\" too. FWIW.  I don't know what the norms are in this kind of rpc thing.  Are there parallels in hosted wallet service APIs in the Bitcoin space already?",
      "created_at" : "2017-06-22T18:42:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#issuecomment-310467327",
      "id" : 310467327,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10650",
      "updated_at" : "2017-06-22T18:42:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310467327",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Yes. Versioning makes probably sense at this point.\r\nThe often seen design advice is `/api/v1/wallet?id=walletid`, though not sure if we want the `/api/`.\r\n\r\nI could think of `/v1/wallet/walletID`.\r\n\r\nThe query string makes sense if we expect multiple non-hierarchical inputs.\r\n\r\nIf we start to use a URI query-string == non-hierarchical inputs, where would be the main difference between the query-string key/value level and the JSON key/value level?\r\nWhat are the arguments for a query-string rather then put the wallet id into the JSON RPC request?\r\n\r\nI don't think there are huge advantages/disadvantages between query-string vs path. It's probably a design choice, matter of taste.",
      "created_at" : "2017-06-22T19:39:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#issuecomment-310481482",
      "id" : 310481482,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10650",
      "updated_at" : "2017-06-22T19:39:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310481482",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "> If we start to use a URI query-string == non-hierarchical inputs, where would be the main difference between the query-string key/value level and the JSON key/value level?\r\n\r\nI think for simplicity we should almost always prefer using JSON-RPC parameters for passing request options. If I were designing a bitcoin JSON-RPC API from scratch, I'd require a fixed, basic, future-proof request-uri like `/api/v1` and require request options to be specified in JSON-RPC parameters, not in out-of-band url path extensions, or query strings, or http headers.\r\n\r\nBut in this case we're talking about updating an existing JSON-RPC API with dozens of commands that already have their own ways of interpreting JSON-RPC parameters and that all assume they'll be interacting with a single wallet. So for backwards compatability, I think it's a good idea to allow an out-of-band `wallet=filename` option that can be tacked on to the request-uri query string and onto the bitcoin-cli command line, and that will control which wallet the existing API methods will access by default, without having to update dozens of individual method implementations, or change API in an incompatible way.\r\n\r\nI think if you want to come up with complicated new URL schemes or authorization schemes to provide more structured and controlled access to the API, that could be great, but it goes beyond what you need for basic backward-compatible multiwallet support, which is a simple `wallet=filename` option that you can tack on to requests and command lines.",
      "created_at" : "2017-06-22T20:37:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#issuecomment-310495487",
      "id" : 310495487,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10650",
      "updated_at" : "2017-06-22T20:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310495487",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Another multiwallet RPC implemention for discussion: #10653",
      "created_at" : "2017-06-22T23:55:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#issuecomment-310533555",
      "id" : 310533555,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10650",
      "updated_at" : "2017-06-22T23:55:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310533555",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Added the /v1/ path element.\r\n\r\n@ryanofsky pointed out that we should urlencode/decode the walletID in the path element.\r\nNot having to do this is one advantage of putting the walletID into the JSON part (but again, having the wallet selector in the JSON layer makes later server separation harder).\r\n\r\nThe walletID should in future not be a representation of the filename. User should be able to manually choose the walletID. Ideally, we write the walletID into the wallet database. There we could only allow alphanumeric chars.",
      "created_at" : "2017-06-23T08:35:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#issuecomment-310606962",
      "id" : 310606962,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10650",
      "updated_at" : "2017-06-23T08:35:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310606962",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "> but again, having the wallet selector in the JSON layer makes later server separation harder\r\n\r\nWhat's this about? I think I missed this point...\r\n\r\n> Ideally, we write the walletID into the wallet database. There we could only allow alphanumeric chars.\r\n\r\nI don't think I understand the advantages of adding a \"walletID.\" The user already has to choose one name for the wallet when they make a filename, so what's the advantage of being able to choose two potentially different names for the same wallet? It seems like this would only add confusion.\r\n\r\nAlso, even you only allow alphanumerics, unless you restrict to english, you still need percent encoding for unicode.",
      "created_at" : "2017-06-23T11:06:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#issuecomment-310638177",
      "id" : 310638177,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10650",
      "updated_at" : "2017-06-23T11:06:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310638177",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : ">> but again, having the wallet selector in the JSON layer makes later server separation harder\r\n\r\n> What's this about? I think I missed this point...\r\n\r\nIf we would decouple the wallet completely, a specific endpoint could probably be the better approach to switch between processes or/and even implementations.\r\n\r\n> I don't think I understand the advantages of adding a \"walletID.\" The user already has to choose one name for the wallet when they make a filename, so what's the advantage of being able to choose two potentially different names for the same wallet? It seems like this would only add confusion.\r\n\r\nYeah. Not sure if custom wallet names is a good idea. AFAIK most multiwallet application offer a custom wallet naming.\r\nBut I agree, walletID should probably be the filename, otherwise this may lead to huge confusion.\r\n\r\n> Also, even you only allow alphanumerics, unless you restrict to English, you still need percent encoding for unicode.\r\n\r\nIndeed.\r\n\r\n### API design\r\nUsing the HTTP request path makes sense to me.\r\n\r\nURLEncode/Decode would then be required if we use the path approach (not required if we embed the walletID in the JSON payload).\r\n\r\nLets have a look at GitHub's API (I don't say its good just because it's GitHub):\r\n`https://api.github.com/repos/bitcoin/bitcoin/issues?state=closed`.\r\n\r\nFor me, that makes perfect sense.\r\nWe locate a resource via: `https://api.github.com/repos/bitcoin/bitcoin/issues` and query it with `state=closed`.\r\n\r\nSame for HTTP posts:\r\n`https://api.github.com/repos/bitcoin/bitcoin/pulls/10000`.\r\nThen a JSON post of\r\n```json\r\n{\r\n  \"title\": \"new title\",\r\n  \"body\": \"updated body\",\r\n  \"state\": \"open\",\r\n  \"base\": \"master\"\r\n}\r\n```",
      "created_at" : "2017-06-23T11:34:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#issuecomment-310643221",
      "id" : 310643221,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10650",
      "updated_at" : "2017-06-23T11:34:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310643221",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "To summarize current state of things, we have 3 (nonexclusive) choices for allowing existing RPC methods work on multiple wallets:\r\n\r\n1. Add optional \"wallet\" JSON-RPC parameters to wallet RPC methods. There implementations of this in #10653 and #10661.\r\n2. Add a wallet option to the JSON-RPC endpoint URL. Could just be a query option, or could be baked into structure of a new request-path scheme. This is implemented here in #10650.\r\n3. Add a wallet option to `-rpcauth` config strings. This is implemented in #10615.",
      "created_at" : "2017-06-23T19:41:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#issuecomment-310755811",
      "id" : 310755811,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10650",
      "updated_at" : "2017-06-23T19:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310755811",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Long term, here's one suggestion of how this could work:\r\n\r\n1. each wallet runs in its own process, and binds to a separate local port. Users can access RPCs for wallet commands directly on that port\r\n2. each wallet has its own rpcauth config, to control access to that wallet. A single user may have access to multiple wallets\r\n3. The bitcoin-server RPC server can dispatch wallet commands to individual wallets based on which endpoint the RPC was received on (either as a query option or request-path scheme). We could either make bitcoin-server RPC users have superuser access to all wallets or authenticate per call.\r\n\r\nI think that achieves the multi-user functionality from #10615 without the drawbacks:\r\n\r\n- it's more secure since individual wallet users won't have access to the bitcoin-server RPC interface, and will only be connecting to the wallet process\r\n- it doesn't tie users to as single wallet\r\n- it doesn't add dependencies from bitcoin-server to bitcoin-wallet.\r\n\r\nShort-term, we can implement this PR, either with query options or a request-path scheme. When the wallet is separated, the interface doesn't have to change, since this is (3) from the design above. My preference is for a query option, since this seems more flexible and doesn't restrict the API scheme if we want to use a different request-path in future.\r\n\r\nIf it's going to take time to get this PR merged, I think we should merge #10653 as a short-term measure, with warnings that the API will change.",
      "created_at" : "2017-06-28T14:03:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#issuecomment-311669411",
      "id" : 311669411,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10650",
      "updated_at" : "2017-06-28T14:03:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/311669411",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r125478756"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/125478756"
         }
      },
      "body" : "Use `evhttp_uriencode()`?",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-04T13:54:36Z",
      "diff_hunk" : "@@ -701,3 +702,28 @@ bool ParseFixedPoint(const std::string &val, int decimals, int64_t *amount_out)\n     return true;\n }\n \n+std::string urlEncode(const std::string &urlPart) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r125478756",
      "id" : 125478756,
      "original_commit_id" : "b5088c505f492eb6de7ca9cffd3b5caf522f1168",
      "original_position" : 12,
      "path" : "src/utilstrencodings.cpp",
      "position" : null,
      "pull_request_review_id" : 47869785,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-07T14:03:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/125478756",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3534524?v=3",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r125478798"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/125478798"
         }
      },
      "body" : "Use `evhttp_uridecode()`?",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-04T13:54:52Z",
      "diff_hunk" : "@@ -701,3 +702,28 @@ bool ParseFixedPoint(const std::string &val, int decimals, int64_t *amount_out)\n     return true;\n }\n \n+std::string urlEncode(const std::string &urlPart) {\n+    std::ostringstream escaped;\n+    escaped.fill('0');\n+    escaped << std::hex;\n+\n+    for (const std::string::value_type c : urlPart) {\n+        // Keep alphanumeric and other accepted characters intact\n+        if (isalnum(c) || c == '-' || c == '_' || c == '.' || c == '~') {\n+            escaped << c;\n+            continue;\n+        }\n+\n+        // Any other characters are percent-encoded\n+        escaped << std::uppercase;\n+        escaped << '%' << std::setw(2) << int((unsigned char) c);\n+        escaped << std::nouppercase;\n+    }\n+\n+    return escaped.str();\n+}\n+\n+std::string urlDecode(const std::string &urlEncoded) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r125478798",
      "id" : 125478798,
      "original_commit_id" : "b5088c505f492eb6de7ca9cffd3b5caf522f1168",
      "original_position" : 33,
      "path" : "src/utilstrencodings.cpp",
      "position" : null,
      "pull_request_review_id" : 47869785,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-07T14:03:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/125478798",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3534524?v=3",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r125479615"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/125479615"
         }
      },
      "body" : "Use `evhttp_uri` and it's primitives?",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-04T13:58:55Z",
      "diff_hunk" : "@@ -235,7 +235,13 @@ UniValue CallRPC(const std::string& strMethod, const UniValue& params)\n     assert(output_buffer);\n     evbuffer_add(output_buffer, strRequest.data(), strRequest.size());\n \n-    int r = evhttp_make_request(evcon.get(), req.get(), EVHTTP_REQ_POST, \"/\");\n+    // check if we should use a special wallet endpoint\n+    std::string endpoint = \"/\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r125479615",
      "id" : 125479615,
      "original_commit_id" : "b5088c505f492eb6de7ca9cffd3b5caf522f1168",
      "original_position" : 6,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 6,
      "pull_request_review_id" : 47869785,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-07T14:03:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/125479615",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3534524?v=3",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r125480438"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/125480438"
         }
      },
      "body" : "const.",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-04T14:03:00Z",
      "diff_hunk" : "@@ -1122,6 +1124,8 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n        caller must ensure the current wallet version is correct before calling\n        this function). */\n     bool SetHDMasterKey(const CPubKey& key);\n+\n+    const std::string GetWalletID() { return walletID; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r125480438",
      "id" : 125480438,
      "original_commit_id" : "b5088c505f492eb6de7ca9cffd3b5caf522f1168",
      "original_position" : 23,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 47869785,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-07T14:03:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/125480438",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3534524?v=3",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r125493753"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/125493753"
         }
      },
      "body" : "Oh! Very good point. Will do that.",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-04T15:08:00Z",
      "diff_hunk" : "@@ -701,3 +702,28 @@ bool ParseFixedPoint(const std::string &val, int decimals, int64_t *amount_out)\n     return true;\n }\n \n+std::string urlEncode(const std::string &urlPart) {\n+    std::ostringstream escaped;\n+    escaped.fill('0');\n+    escaped << std::hex;\n+\n+    for (const std::string::value_type c : urlPart) {\n+        // Keep alphanumeric and other accepted characters intact\n+        if (isalnum(c) || c == '-' || c == '_' || c == '.' || c == '~') {\n+            escaped << c;\n+            continue;\n+        }\n+\n+        // Any other characters are percent-encoded\n+        escaped << std::uppercase;\n+        escaped << '%' << std::setw(2) << int((unsigned char) c);\n+        escaped << std::nouppercase;\n+    }\n+\n+    return escaped.str();\n+}\n+\n+std::string urlDecode(const std::string &urlEncoded) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r125493753",
      "id" : 125493753,
      "original_commit_id" : "b5088c505f492eb6de7ca9cffd3b5caf522f1168",
      "original_position" : 33,
      "path" : "src/utilstrencodings.cpp",
      "position" : null,
      "pull_request_review_id" : 47888026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-07T14:03:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/125493753",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126151074"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126151074"
         }
      },
      "body" : "I guess for the endpoint a plain std::string is okay.",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-07T13:50:17Z",
      "diff_hunk" : "@@ -235,7 +235,13 @@ UniValue CallRPC(const std::string& strMethod, const UniValue& params)\n     assert(output_buffer);\n     evbuffer_add(output_buffer, strRequest.data(), strRequest.size());\n \n-    int r = evhttp_make_request(evcon.get(), req.get(), EVHTTP_REQ_POST, \"/\");\n+    // check if we should use a special wallet endpoint\n+    std::string endpoint = \"/\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126151074",
      "id" : 126151074,
      "original_commit_id" : "b5088c505f492eb6de7ca9cffd3b5caf522f1168",
      "original_position" : 6,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 6,
      "pull_request_review_id" : 48610802,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-07T14:03:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126151074",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Rebased and overhauled.\r\nAdded urlencode/urldecode via libevent (thanks @promag for the hint).\r\nThere is now a `/v1/node/` and a `/v1/wallet/<filename>` endpoint.\r\nThe endpoint-split is not very mature yet, but does the job (we should then mark it as experimental in the 0.15 release notes).\r\n\r\nWhat can be done outside Ã¢ÂÂ this already large Ã¢ÂÂ PR:\r\n* Better API versioning\r\n* RPC tests multiwallet support (currently approach `self.nodes[1].<walletfilename>.metho\bd` may not be the best)\r\n* Release notes\r\n\r\nPassed travis now (see circular dependency fix 386c299 [ping @theuni]).",
      "created_at" : "2017-07-07T14:44:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#issuecomment-313702138",
      "id" : 313702138,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10650",
      "updated_at" : "2017-07-07T14:45:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/313702138",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126449799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126449799"
         }
      },
      "body" : "Note that \"Add -wallet endpoint support to bitcoin-cli\" doesnt build as urlDecode is undefined here (you need to swap commit ordering).",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-10T15:09:50Z",
      "diff_hunk" : "@@ -43,7 +43,7 @@ CWallet *GetWalletForJSONRPCRequest(const JSONRPCRequest& request)\n     }\n     else if (request.URI.substr(0, WALLET_ENDPOINT_BASE.size()) == WALLET_ENDPOINT_BASE) {\n         // wallet endpoint was used\n-        std::string requestedWallet = request.URI.substr(WALLET_ENDPOINT_BASE.size());\n+        std::string requestedWallet = urlDecode(request.URI.substr(WALLET_ENDPOINT_BASE.size()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126449799",
      "id" : 126449799,
      "original_commit_id" : "ea785096c052abf6d7211ebb52d758cca89a972b",
      "original_position" : 5,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 48934394,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-10T15:31:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126449799",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126453963"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126453963"
         }
      },
      "body" : "Wait, why?",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-10T15:22:11Z",
      "diff_hunk" : "@@ -10,6 +10,7 @@\n #include <cstdlib>\n #include <cstring>\n #include <errno.h>\n+#include <iomanip>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126453963",
      "id" : 126453963,
      "original_commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "original_position" : 4,
      "path" : "src/utilstrencodings.cpp",
      "position" : 4,
      "pull_request_review_id" : 48934394,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-10T15:31:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126453963",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126456469"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126456469"
         }
      },
      "body" : "This seems superfluous. Why not just either auto-register based on the endpoint in the commands table or just register everything explicitly in httprpc.cpp (its only 4 things).",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-10T15:31:04Z",
      "diff_hunk" : "@@ -226,6 +226,11 @@ static bool InitRPCAuthentication()\n     return true;\n }\n \n+void RegisterJSONEndpoint(const std::string& endpoint, bool exactMatch)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126456469",
      "id" : 126456469,
      "original_commit_id" : "617ce96f11a988d89837a0119f1eb954f6af47a3",
      "original_position" : 4,
      "path" : "src/httprpc.cpp",
      "position" : 4,
      "pull_request_review_id" : 48934394,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-10T15:31:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126456469",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126456621"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126456621"
         }
      },
      "body" : "Can we use some constant for this instead of duplicating the string everyhwere?",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-10T15:31:35Z",
      "diff_hunk" : "@@ -1535,33 +1535,33 @@ UniValue getchaintxstats(const JSONRPCRequest& request)\n static const CRPCCommand commands[] =\n { //  category              name                      actor (function)         okSafe argNames\n   //  --------------------- ------------------------  -----------------------  ------ ----------\n-    { \"blockchain\",         \"getblockchaininfo\",      &getblockchaininfo,      true,  {} },\n-    { \"blockchain\",         \"getchaintxstats\",        &getchaintxstats,        true,  {\"nblocks\", \"blockhash\"} },\n-    { \"blockchain\",         \"getbestblockhash\",       &getbestblockhash,       true,  {} },\n-    { \"blockchain\",         \"getblockcount\",          &getblockcount,          true,  {} },\n-    { \"blockchain\",         \"getblock\",               &getblock,               true,  {\"blockhash\",\"verbosity|verbose\"} },\n-    { \"blockchain\",         \"getblockhash\",           &getblockhash,           true,  {\"height\"} },\n-    { \"blockchain\",         \"getblockheader\",         &getblockheader,         true,  {\"blockhash\",\"verbose\"} },\n-    { \"blockchain\",         \"getchaintips\",           &getchaintips,           true,  {} },\n-    { \"blockchain\",         \"getdifficulty\",          &getdifficulty,          true,  {} },\n-    { \"blockchain\",         \"getmempoolancestors\",    &getmempoolancestors,    true,  {\"txid\",\"verbose\"} },\n-    { \"blockchain\",         \"getmempooldescendants\",  &getmempooldescendants,  true,  {\"txid\",\"verbose\"} },\n-    { \"blockchain\",         \"getmempoolentry\",        &getmempoolentry,        true,  {\"txid\"} },\n-    { \"blockchain\",         \"getmempoolinfo\",         &getmempoolinfo,         true,  {} },\n-    { \"blockchain\",         \"getrawmempool\",          &getrawmempool,          true,  {\"verbose\"} },\n-    { \"blockchain\",         \"gettxout\",               &gettxout,               true,  {\"txid\",\"n\",\"include_mempool\"} },\n-    { \"blockchain\",         \"gettxoutsetinfo\",        &gettxoutsetinfo,        true,  {} },\n-    { \"blockchain\",         \"pruneblockchain\",        &pruneblockchain,        true,  {\"height\"} },\n-    { \"blockchain\",         \"verifychain\",            &verifychain,            true,  {\"checklevel\",\"nblocks\"} },\n-\n-    { \"blockchain\",         \"preciousblock\",          &preciousblock,          true,  {\"blockhash\"} },\n+    { \"blockchain\",         \"/v1/node/\",  \"getblockchaininfo\",      &getblockchaininfo,      true,  {} },",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126456621",
      "id" : 126456621,
      "original_commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "original_position" : 24,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 24,
      "pull_request_review_id" : 48934394,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-10T15:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126456621",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126923023"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126923023"
         }
      },
      "body" : "In commit \"Expose JSON endpoint registration\"\r\n\r\nI don't see the reasoning for this either... If you decide to keep this, maybe document the function with a comment to explain why the urls shouldn't be listed in a single place.",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-12T10:51:51Z",
      "diff_hunk" : "@@ -226,6 +226,11 @@ static bool InitRPCAuthentication()\n     return true;\n }\n \n+void RegisterJSONEndpoint(const std::string& endpoint, bool exactMatch)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126923023",
      "id" : 126923023,
      "original_commit_id" : "617ce96f11a988d89837a0119f1eb954f6af47a3",
      "original_position" : 4,
      "path" : "src/httprpc.cpp",
      "position" : 4,
      "pull_request_review_id" : 49453724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-12T16:07:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126923023",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126923979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126923979"
         }
      },
      "body" : "In commit \"Register /wallet/* endpoint in RPC server\"\r\n\r\nName `MaybeRegisterWalletRPCEndpoints` might be more descriptive since nothing happens if wallet is disabled.",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-12T10:57:26Z",
      "diff_hunk" : "@@ -3044,3 +3048,11 @@ void RegisterWalletRPCCommands(CRPCTable &t)\n     for (unsigned int vcidx = 0; vcidx < ARRAYLEN(commands); vcidx++)\n         t.appendCommand(commands[vcidx].name, &commands[vcidx]);\n }\n+\n+void RegisterWalletRPCEndpoints()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126923979",
      "id" : 126923979,
      "original_commit_id" : "177fc1a6b7b104831c9a7c7aa6fd163a26bbeadb",
      "original_position" : 23,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 171,
      "pull_request_review_id" : 49453724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-12T16:07:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126923979",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126925235"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126925235"
         }
      },
      "body" : "In commit \"Select wallet based on the given endpoint\"\r\n\r\nPrevious comment not addressed (https://github.com/bitcoin/bitcoin/pull/10650#discussion_r123543935)",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-12T11:04:20Z",
      "diff_hunk" : "@@ -31,10 +31,30 @@\n \n #include <univalue.h>\n \n+static const std::string WALLET_ENDPOINT_BASE = \"/wallet/\";\n+\n CWallet *GetWalletForJSONRPCRequest(const JSONRPCRequest& request)\n {\n-    // TODO: Some way to access secondary wallets\n-    return vpwallets.empty() ? nullptr : vpwallets[0];\n+    LOCK(cs_main); // for now, protect vpwallets via cs_main\n+\n+    if (vpwallets.empty()) {\n+        return nullptr;\n+    }\n+    else if (request.URI.substr(0, WALLET_ENDPOINT_BASE.size()) == WALLET_ENDPOINT_BASE) {\n+        // wallet endpoint was used\n+        std::string requestedWallet = request.URI.substr(WALLET_ENDPOINT_BASE.size());\n+        for(CWallet* pwallet : vpwallets) {\n+            if (pwallet->GetWalletID() == requestedWallet) {\n+                return pwallet;\n+            }\n+        }\n+        // no wallet found with the given endpoint\n+        throw JSONRPCError(RPC_WALLET_NOT_FOUND, \"Requested wallet not found (\"+SanitizeString(requestedWallet)+\")\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126925235",
      "id" : 126925235,
      "original_commit_id" : "1fa7d7e26b5056c66fabd1bec12c208f4dc963c8",
      "original_position" : 24,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 40,
      "pull_request_review_id" : 49453724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-12T16:07:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126925235",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126926410"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126926410"
         }
      },
      "body" : "In commit \"Select wallet based on the given endpoint\"\r\n\r\nThis logic doesn't seem right because it will silently ignore the `requestedWallet` value when `vpwallets` is empty. It would be better to trigger the \"Requested wallet not found\" error if `requestedWallet` is nonempty when `vpwallets` is empty instead of silently ignoring the `requestedWallet` value.\r\n\r\nYou could fix this by just deleting this early return and changing the last line to `return vpwallets.empty() ? nullptr : vpwallets[0];`",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-12T11:11:13Z",
      "diff_hunk" : "@@ -36,8 +36,26 @@ static const std::string WALLET_ENDPOINT_BASE = \"/v1/wallet/\";\n \n CWallet *GetWalletForJSONRPCRequest(const JSONRPCRequest& request)\n {\n-    // TODO: Some way to access secondary wallets\n-    return vpwallets.empty() ? nullptr : vpwallets[0];\n+    LOCK(cs_main); // for now, protect vpwallets via cs_main\n+\n+    if (vpwallets.empty()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126926410",
      "id" : 126926410,
      "original_commit_id" : "0e7d0c129abfca17ecaa48b8d8b2c39ec8a7f903",
      "original_position" : 8,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 28,
      "pull_request_review_id" : 49453724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-12T16:07:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126926410",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126928365"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126928365"
         }
      },
      "body" : "In commit \"Select wallet based on the given endpoint\"\r\n\r\nPer @laanwj's comment at https://github.com/bitcoin/bitcoin/pull/10653#issuecomment-310833084, I think it would be a good idea for this to raise an error if vpwallets.size() is not 1. If somebody has loaded multiple wallets, they should have to explicitly specify which wallet they want to call. Otherwise, it's easy to imagine writing a script that makes many rpc calls, and forgets to add the `-wallet=` option in one call, and suddenly winds up using funds or balances from the wrong wallet, causing dangerous or difficult to debug errors.\r\n\r\nHaving a default wallet is needed for backwards compatibility when there is 1 wallet, but otherwise it just seems like a dangerous and not very useful idea to want to support right now.",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-12T11:23:25Z",
      "diff_hunk" : "@@ -36,8 +36,26 @@ static const std::string WALLET_ENDPOINT_BASE = \"/v1/wallet/\";\n \n CWallet *GetWalletForJSONRPCRequest(const JSONRPCRequest& request)\n {\n-    // TODO: Some way to access secondary wallets\n-    return vpwallets.empty() ? nullptr : vpwallets[0];\n+    LOCK(cs_main); // for now, protect vpwallets via cs_main\n+\n+    if (vpwallets.empty()) {\n+        return nullptr;\n+    }\n+    else if (request.URI.substr(0, WALLET_ENDPOINT_BASE.size()) == WALLET_ENDPOINT_BASE) {\n+        // wallet endpoint was used\n+        std::string requestedWallet = request.URI.substr(WALLET_ENDPOINT_BASE.size());\n+        for(CWallet* pwallet : vpwallets) {\n+            if (pwallet->GetWalletID() == requestedWallet) {\n+                return pwallet;\n+            }\n+        }\n+        // no wallet found with the given endpoint\n+        throw JSONRPCError(RPC_WALLET_NOT_FOUND, \"Requested wallet not found (\"+SanitizeString(requestedWallet)+\")\");\n+    }\n+    else {\n+        // default endpoint, use first wallet\n+        return vpwallets[0];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126928365",
      "id" : 126928365,
      "original_commit_id" : "0e7d0c129abfca17ecaa48b8d8b2c39ec8a7f903",
      "original_position" : 24,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 44,
      "pull_request_review_id" : 49453724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-12T16:07:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126928365",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126967741"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126967741"
         }
      },
      "body" : "In commit \"Add a walletID to CWallet (use filename for now)\"\r\n\r\nI believe this commit should be dropped because we already have a `CWallet::GetName()` method and the duplicative functionality introduced here with mysterious \"for now\" comments is just confusing.",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-12T14:20:58Z",
      "diff_hunk" : "@@ -3793,7 +3793,7 @@ CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n     int64_t nStart = GetTimeMillis();\n     bool fFirstRun = true;\n     std::unique_ptr<CWalletDBWrapper> dbw(new CWalletDBWrapper(&bitdb, walletFile));\n-    CWallet *walletInstance = new CWallet(std::move(dbw));\n+    CWallet *walletInstance = new CWallet(std::move(dbw), walletFile); // use filename as walletID for now",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126967741",
      "id" : 126967741,
      "original_commit_id" : "7025861eebc96fbeb1bb5b56479a557bc0264d7b",
      "original_position" : 14,
      "path" : "src/wallet/wallet.cpp",
      "position" : 14,
      "pull_request_review_id" : 49453724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-12T16:07:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126967741",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126968651"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126968651"
         }
      },
      "body" : "In commit \"Select wallet based on the given endpoint\"\r\n\r\n`requestedWallet` should be percent decoded here.",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-12T14:24:20Z",
      "diff_hunk" : "@@ -36,8 +36,26 @@ static const std::string WALLET_ENDPOINT_BASE = \"/v1/wallet/\";\n \n CWallet *GetWalletForJSONRPCRequest(const JSONRPCRequest& request)\n {\n-    // TODO: Some way to access secondary wallets\n-    return vpwallets.empty() ? nullptr : vpwallets[0];\n+    LOCK(cs_main); // for now, protect vpwallets via cs_main\n+\n+    if (vpwallets.empty()) {\n+        return nullptr;\n+    }\n+    else if (request.URI.substr(0, WALLET_ENDPOINT_BASE.size()) == WALLET_ENDPOINT_BASE) {\n+        // wallet endpoint was used\n+        std::string requestedWallet = request.URI.substr(WALLET_ENDPOINT_BASE.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126968651",
      "id" : 126968651,
      "original_commit_id" : "0e7d0c129abfca17ecaa48b8d8b2c39ec8a7f903",
      "original_position" : 13,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 49453724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-12T16:07:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126968651",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126969502"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126969502"
         }
      },
      "body" : "In commit \"Add -wallet endpoint support to bitcoin-cli\"\r\n\r\nPrevious comment not addressed (https://github.com/bitcoin/bitcoin/pull/10650#discussion_r123489861).",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-12T14:27:24Z",
      "diff_hunk" : "@@ -235,7 +235,12 @@ UniValue CallRPC(const std::string& strMethod, const UniValue& params)\n     assert(output_buffer);\n     evbuffer_add(output_buffer, strRequest.data(), strRequest.size());\n \n-    int r = evhttp_make_request(evcon.get(), req.get(), EVHTTP_REQ_POST, \"/\");\n+    // check if we should use a special wallet endpoint\n+    std::string endpoint = \"/\";\n+    if (GetArg(\"-wallet\", \"\") != \"\") {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126969502",
      "id" : 126969502,
      "original_commit_id" : "2753ea62b9ac1fbae8b5b96f251b0f46246253e4",
      "original_position" : 7,
      "path" : "src/bitcoin-cli.cpp",
      "position" : null,
      "pull_request_review_id" : 49453724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-12T16:07:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126969502",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126971554"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126971554"
         }
      },
      "body" : "In commit \"Add -wallet endpoint support to bitcoin-cli\"\r\n\r\nThis change belongs in commit \"Select wallet based on the given endpoint\" not in this bitcoin-cli commit. Also the commit introducing url encode/decode functions needs to be pushed back earlier in the history like Matt said for this to compile.\r\n\r\nAlternately you could consolidate some of the commits. I don't think having 12 commits in this PR accomplishes very much when many of the commits introduce functionality that isn't called anywhere and doesn't make sense without context from later commits.",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-12T14:34:41Z",
      "diff_hunk" : "@@ -43,7 +43,7 @@ CWallet *GetWalletForJSONRPCRequest(const JSONRPCRequest& request)\n     }\n     else if (request.URI.substr(0, WALLET_ENDPOINT_BASE.size()) == WALLET_ENDPOINT_BASE) {\n         // wallet endpoint was used\n-        std::string requestedWallet = request.URI.substr(WALLET_ENDPOINT_BASE.size());\n+        std::string requestedWallet = urlDecode(request.URI.substr(WALLET_ENDPOINT_BASE.size()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126971554",
      "id" : 126971554,
      "original_commit_id" : "ea785096c052abf6d7211ebb52d758cca89a972b",
      "original_position" : 5,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 49453724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-12T16:07:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126971554",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126972266"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126972266"
         }
      },
      "body" : "In commit \"Add urlencode/decode via libevent2\"\r\n\r\nMemory leak here, need to free `encodedURI`.",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-12T14:37:10Z",
      "diff_hunk" : "@@ -237,9 +237,13 @@ UniValue CallRPC(const std::string& strMethod, const UniValue& params)\n \n     // check if we should use a special wallet endpoint\n     std::string endpoint = \"/\";\n-    if (GetArg(\"-wallet\", \"\") != \"\") {\n+    std::string walletName = GetArg(\"-wallet\", \"\");\n+    if (walletName != \"\") {\n         // always use v1 endpoint if -wallet has been provided\n-        endpoint = \"/v1/wallet/\"+urlEncode(GetArg(\"-wallet\", \"\"));\n+        char *encodedURI = evhttp_uriencode(walletName.c_str(), walletName.size(), false);\n+        if (encodedURI) {\n+            endpoint = \"/v1/wallet/\"+ std::string(encodedURI);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126972266",
      "id" : 126972266,
      "original_commit_id" : "73dbe48ced5c75cf827da54881c011ad95b4abdb",
      "original_position" : 11,
      "path" : "src/bitcoin-cli.cpp",
      "position" : null,
      "pull_request_review_id" : 49453724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-12T16:07:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126972266",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126972541"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126972541"
         }
      },
      "body" : "In commit \"Add urlencode/decode via libevent2\"\r\n\r\nMore idiomatic / efficient to write `!walletName.empty()`",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-12T14:38:06Z",
      "diff_hunk" : "@@ -237,9 +237,13 @@ UniValue CallRPC(const std::string& strMethod, const UniValue& params)\n \n     // check if we should use a special wallet endpoint\n     std::string endpoint = \"/\";\n-    if (GetArg(\"-wallet\", \"\") != \"\") {\n+    std::string walletName = GetArg(\"-wallet\", \"\");\n+    if (walletName != \"\") {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126972541",
      "id" : 126972541,
      "original_commit_id" : "73dbe48ced5c75cf827da54881c011ad95b4abdb",
      "original_position" : 6,
      "path" : "src/bitcoin-cli.cpp",
      "position" : null,
      "pull_request_review_id" : 49453724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-12T16:07:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126972541",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126973678"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126973678"
         }
      },
      "body" : "In commit \"Add urlencode/decode via libevent2\"\r\n\r\nMore idiomatic / efficient to just use the default string constructor (write `std::string res;`).",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-12T14:42:06Z",
      "diff_hunk" : "@@ -665,3 +665,14 @@ void UnregisterHTTPHandler(const std::string &prefix, bool exactMatch)\n     }\n }\n \n+std::string urlDecode(const std::string &urlEncoded) {\n+    std::string res = \"\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126973678",
      "id" : 126973678,
      "original_commit_id" : "73dbe48ced5c75cf827da54881c011ad95b4abdb",
      "original_position" : 5,
      "path" : "src/httpserver.cpp",
      "position" : 5,
      "pull_request_review_id" : 49453724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-12T16:07:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126973678",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126974112"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126974112"
         }
      },
      "body" : "In commit \"Add urlencode/decode via libevent2\"\r\n\r\nSomething seems to have gone a little haywire in the rebased history. This commit seems to be inlining a nonexistent `urlEncode` function, which I think would be a step backwards from having a reusable `urlEncode` function that complements `urlDecode`.\r\n\r\nAlso this commit has unrelated changes to `src/utilstrencodings.cpp` and `src/wallet/rpcwallet.cpp` which should be reverted.",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-12T14:43:39Z",
      "diff_hunk" : "@@ -237,9 +237,13 @@ UniValue CallRPC(const std::string& strMethod, const UniValue& params)\n \n     // check if we should use a special wallet endpoint\n     std::string endpoint = \"/\";\n-    if (GetArg(\"-wallet\", \"\") != \"\") {\n+    std::string walletName = GetArg(\"-wallet\", \"\");\n+    if (walletName != \"\") {\n         // always use v1 endpoint if -wallet has been provided\n-        endpoint = \"/v1/wallet/\"+urlEncode(GetArg(\"-wallet\", \"\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126974112",
      "id" : 126974112,
      "original_commit_id" : "73dbe48ced5c75cf827da54881c011ad95b4abdb",
      "original_position" : 8,
      "path" : "src/bitcoin-cli.cpp",
      "position" : null,
      "pull_request_review_id" : 49453724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-12T16:07:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126974112",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126976236"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126976236"
         }
      },
      "body" : "In commit \"[QA] Add support for wallet endpoints in Authproxy\"\r\n\r\nIt's fragile, over complicated, and not necessary to add multiwallet code and hardcoded url fragments in authproxy. I suggested a simpler approach here: https://github.com/bitcoin/bitcoin/pull/10650#discussion_r123484826, adding a one-line `__idiv__` method.\r\n",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-12T14:49:56Z",
      "diff_hunk" : "@@ -139,17 +139,24 @@ def _request(self, method, path, postdata):\n             return self._get_response()\n \n     def __call__(self, *args, **argsn):\n-        AuthServiceProxy.__id_count += 1\n+        # check for a possible wallet endpoint\n+        urlAdd = \"\"\n+        method = self._service_name\n+        elements = self._service_name.split(\".\")\n+        if len(elements) > 1:\n+            urlAdd = \"/v1/wallet/\" + '.'.join(elements[:-1])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126976236",
      "id" : 126976236,
      "original_commit_id" : "72fee26bc417aebe6c5d59c3ea975f630920d0a1",
      "original_position" : 10,
      "path" : "test/functional/test_framework/authproxy.py",
      "position" : 10,
      "pull_request_review_id" : 49453724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-12T16:07:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126976236",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126988589"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126988589"
         }
      },
      "body" : "In commit \"Split node / wallet RPC calls based on the endpoint\"\r\n\r\nI don't see what this has to do with multiwallet support and I think this commit and previous commit should go into a separate PR if we want to introduce a more heavily embroidered URL scheme beyond `/v1/wallet/filename`.\r\n\r\nAlso if there's going to be a JSON-RPC URL scheme, it needs to be documented and explained somewhere (maybe a new `doc/JSONRPC-interface.md` file), and should probably get a some more discussion. Personally I don't see why people seem to be in love with convoluted URL schemes. We are **not** implementing a REST API which is centered around URLs. We are implementing a RPC API where you call a method, pass JSON arguments, and get a JSON return value. I don't think it's good to be adding restrictions and side-channels around the JSON requests without explicit reason.\r\n\r\nSupporting a `?wallet=filename` query option or `/wallet/filename` path selector makes a certain amount of sense if we think JSON-RPC named arguments are too awkward, or because we want to implement a multiprocess framework like the one John described where the RPC handler has \"superuser access\" to all wallets and forwards calls to them (https://github.com/bitcoin/bitcoin/pull/10650#issuecomment-311669411).\r\n\r\nSupporting `/v1`, `/v2` path selectors maybe also makes sense if we want to be able to make breaking changes to RPC methods. And maybe requiring node / wallet URL endpoints also makes sense for reasons that I don't understand, but I definitely think those reasons deserve to be discussed, and to get some documentation, and not to be shoehorned into the last 2 commits of a tangentially related PR.",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-12T15:30:49Z",
      "diff_hunk" : "@@ -493,7 +493,12 @@ UniValue CRPCTable::execute(const JSONRPCRequest &request) const\n     const CRPCCommand *pcmd = tableRPC[request.strMethod];\n     if (!pcmd)\n         throw JSONRPCError(RPC_METHOD_NOT_FOUND, \"Method not found\");\n-\n+    if (request.URI != \"\" && request.URI != \"/\") {\n+        // enforce correct endpoint usage",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126988589",
      "id" : 126988589,
      "original_commit_id" : "b62a4bbcb160757453a95552bc27b3a6d05cc1b3",
      "original_position" : 19,
      "path" : "src/rpc/server.cpp",
      "position" : 19,
      "pull_request_review_id" : 49453724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-12T16:07:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126988589",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126989883"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126989883"
         }
      },
      "body" : "In commit \"Add walletid to getwalletinfo\"\r\n\r\nShould be called `wallet_path` as in #10733, or `walletname` as in #10604 and use the `GetName` method, unless we actually do want to introduce a new wallet id concept. This commit could be also be dropped and left for the other prs.",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-12T15:35:03Z",
      "diff_hunk" : "@@ -2434,6 +2434,7 @@ UniValue getwalletinfo(const JSONRPCRequest& request)\n     UniValue obj(UniValue::VOBJ);\n \n     size_t kpExternalSize = pwallet->KeypoolCountExternalKeys();\n+    obj.push_back(Pair(\"walletid\", pwallet->GetWalletID()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r126989883",
      "id" : 126989883,
      "original_commit_id" : "6fe03854abb796f995e07af9c43b5545d4dcb241",
      "original_position" : 4,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 53,
      "pull_request_review_id" : 49453724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-12T16:07:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126989883",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "@jonasschnelli build change looks fine.",
      "created_at" : "2017-07-12T18:25:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#issuecomment-314855793",
      "id" : 314855793,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10650",
      "updated_at" : "2017-07-12T18:25:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314855793",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "Concept ACK on this approach for multiwallet, but needs rebase and addressing of comments.",
      "created_at" : "2017-07-12T19:18:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#issuecomment-314869863",
      "id" : 314869863,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10650",
      "updated_at" : "2017-07-12T19:18:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314869863",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r127068342"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127068342"
         }
      },
      "body" : "Free `encodedURI`.",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-12T20:51:27Z",
      "diff_hunk" : "@@ -235,7 +235,17 @@ UniValue CallRPC(const std::string& strMethod, const UniValue& params)\n     assert(output_buffer);\n     evbuffer_add(output_buffer, strRequest.data(), strRequest.size());\n \n-    int r = evhttp_make_request(evcon.get(), req.get(), EVHTTP_REQ_POST, \"/\");\n+    // check if we should use a special wallet endpoint\n+    std::string endpoint = \"/\";\n+    std::string walletName = GetArg(\"-wallet\", \"\");\n+    if (walletName != \"\") {\n+        // always use v1 endpoint if -wallet has been provided\n+        char *encodedURI = evhttp_uriencode(walletName.c_str(), walletName.size(), false);\n+        if (encodedURI) {\n+            endpoint = \"/v1/wallet/\"+ std::string(encodedURI);\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r127068342",
      "id" : 127068342,
      "original_commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "original_position" : 13,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 13,
      "pull_request_review_id" : 49615846,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-12T20:58:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127068342",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3534524?v=3",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r127068584"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127068584"
         }
      },
      "body" : "Else should fail?",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-12T20:52:24Z",
      "diff_hunk" : "@@ -235,7 +235,17 @@ UniValue CallRPC(const std::string& strMethod, const UniValue& params)\n     assert(output_buffer);\n     evbuffer_add(output_buffer, strRequest.data(), strRequest.size());\n \n-    int r = evhttp_make_request(evcon.get(), req.get(), EVHTTP_REQ_POST, \"/\");\n+    // check if we should use a special wallet endpoint\n+    std::string endpoint = \"/\";\n+    std::string walletName = GetArg(\"-wallet\", \"\");\n+    if (walletName != \"\") {\n+        // always use v1 endpoint if -wallet has been provided\n+        char *encodedURI = evhttp_uriencode(walletName.c_str(), walletName.size(), false);\n+        if (encodedURI) {\n+            endpoint = \"/v1/wallet/\"+ std::string(encodedURI);\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r127068584",
      "id" : 127068584,
      "original_commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "original_position" : 13,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 13,
      "pull_request_review_id" : 49615846,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-12T20:58:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127068584",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3534524?v=3",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r127068888"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127068888"
         }
      },
      "body" : "Ã°ÂÂ¤Â ",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-12T20:53:36Z",
      "diff_hunk" : "@@ -10,6 +10,7 @@\n #include <cstdlib>\n #include <cstring>\n #include <errno.h>\n+#include <iomanip>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r127068888",
      "id" : 127068888,
      "original_commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "original_position" : 4,
      "path" : "src/utilstrencodings.cpp",
      "position" : 4,
      "pull_request_review_id" : 49615846,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-12T20:58:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127068888",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3534524?v=3",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "body" : "It'd be great to get this in for 0.15. I'm holding off on my review until @TheBlueMatt and @ryanofsky comments are addressed.\r\n\r\nIf there's anything I can do to help this be ready in time for feature freeze, let me know.",
      "created_at" : "2017-07-12T21:02:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#issuecomment-314896184",
      "id" : 314896184,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10650",
      "updated_at" : "2017-07-12T21:02:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314896184",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r127191606"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127191606"
         }
      },
      "body" : "In the last weeks IRC meeting I had the feeling we had consensus about splitting the calls into node non node.\r\nIMO the v1 approach (while still supporting / [v0]) gives us the chance to eventually clean up some APIs (accounts?!). Not sure if we are going to do this but at least we would have the chance.\r\nThis is why I think we should mark the V1 api as \"experimental\" and \"unstable\" which then allows us to remove/add things without caring to much about API compatibility.",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-13T11:26:06Z",
      "diff_hunk" : "@@ -493,7 +493,12 @@ UniValue CRPCTable::execute(const JSONRPCRequest &request) const\n     const CRPCCommand *pcmd = tableRPC[request.strMethod];\n     if (!pcmd)\n         throw JSONRPCError(RPC_METHOD_NOT_FOUND, \"Method not found\");\n-\n+    if (request.URI != \"\" && request.URI != \"/\") {\n+        // enforce correct endpoint usage",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r127191606",
      "id" : 127191606,
      "original_commit_id" : "b62a4bbcb160757453a95552bc27b3a6d05cc1b3",
      "original_position" : 19,
      "path" : "src/rpc/server.cpp",
      "position" : 19,
      "pull_request_review_id" : 49748842,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-13T11:26:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127191606",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r127195223"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127195223"
         }
      },
      "body" : "Oh,. yes. This is a relict of a custom URIencode/decode implementation. Will remove.",
      "commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "created_at" : "2017-07-13T11:49:05Z",
      "diff_hunk" : "@@ -10,6 +10,7 @@\n #include <cstdlib>\n #include <cstring>\n #include <errno.h>\n+#include <iomanip>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10650#discussion_r127195223",
      "id" : 127195223,
      "original_commit_id" : "386c299270cd955aebc7984b319805ac7403e906",
      "original_position" : 4,
      "path" : "src/utilstrencodings.cpp",
      "position" : 4,
      "pull_request_review_id" : 49752836,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10650",
      "updated_at" : "2017-07-13T11:49:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127195223",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   }
]
