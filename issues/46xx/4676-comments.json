[
   {
      "body" : "`-daemonize` is indeed a hack, but I wouldn't be for adding code to extend it.\r\n\r\nOn modern systems all of this is handled by the service manager, for example upstart or systemd. The daemonizing functionality of the service itself is not used. Doing chrooting, setuid-ing and such properly is non-trivial and needs a lot of testing. So this is prefereably handled in one place and correctly.\r\n\r\nEdit: to be clear, I'm not arguing against doing -daemonize properly. However I don't want to burden bitcoind with 'system set up' functionality such as chrooting, setuid, and such.",
      "created_at" : "2014-08-11T08:36:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4676#issuecomment-51754202",
      "id" : 51754202,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4676",
      "updated_at" : "2014-08-11T08:46:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/51754202",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "* no one said anything about setuid().  setuid() introduces new security issues.  setuid() has little to do with chroot()\r\n* as long as bitcoind file use is confined to $datadir, chroot() works.  That is the function of chroot(), to limit the scope of your filesystem access beyond point X.  Standard security principle of least-access / dropping privs you don't need.\r\n* it is not correct that \"On modern systems all of this is handled by the service manager, for example upstart or systemd\"  Startup scripts invoke the equivalent of the \"-daemon\" option in other projects, to handle the steps listed at [1]\r\n\r\nsystemd is a different layer on top of that.\r\n\r\nThere are valid security reasons for all the steps listed at [1], and missing steps reduces security [ever so slightly].\r\n\r\n[1]  http://stackoverflow.com/questions/3095566/linux-daemonize\r\n",
      "created_at" : "2014-08-11T13:33:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4676#issuecomment-51780064",
      "id" : 51780064,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4676",
      "updated_at" : "2014-08-11T13:34:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/51780064",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "Cannot you just chroot *before* starting bitcoind?\r\nI really don't like extending bitcoind with more and more ancillary features (that can be handled by other tools or the system).\r\n",
      "created_at" : "2014-08-11T15:27:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4676#issuecomment-51795644",
      "id" : 51795644,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4676",
      "updated_at" : "2014-08-11T15:30:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/51795644",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "No opinion on where this functionality belongs, but chrooting() before starting bitcoind at least requires having the bitcoind binary and all its shared libraries inside the chroot environment.",
      "created_at" : "2014-08-11T15:52:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4676#issuecomment-51799399",
      "id" : 51799399,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4676",
      "updated_at" : "2014-08-11T15:52:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/51799399",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Right, that would be an advantage to doing it in-process.\r\n\r\nI'm just afraid of feature creep. It's easy to say yes to one more thing. But if we start adding all kinds of unix daemon specific features, why not windows-specific features, or Mac specific features. And it all needs testing and maintenance (on different flavors of Unix, I'd suppose). We need to define limits to what is part of Bitcoin Core's responsibility.\r\n",
      "created_at" : "2014-08-11T15:58:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4676#issuecomment-51800176",
      "id" : 51800176,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4676",
      "updated_at" : "2014-08-11T15:58:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/51800176",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Correct.  Typically you read shared libs and other files needed outside the jail, then you reduce privs.  That most easily happens in-process.  Same pattern as several other \"reduced privileges after point X in program\" security measures.",
      "created_at" : "2014-08-11T16:08:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4676#issuecomment-51801619",
      "id" : 51801619,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4676",
      "updated_at" : "2014-08-11T16:08:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/51801619",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "https://lkml.org/lkml/2007/9/25/434\r\nand\r\nhttp://misc.openbsd.narkive.com/UrTwzZcc/chroot-ssh-users#post17\r\n",
      "created_at" : "2015-02-26T06:02:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4676#issuecomment-76126963",
      "id" : 76126963,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4676",
      "updated_at" : "2015-02-26T06:02:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/76126963",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1087?v=3",
         "events_url" : "https://api.github.com/users/jwilkins/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jwilkins/followers",
         "following_url" : "https://api.github.com/users/jwilkins/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jwilkins/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jwilkins",
         "id" : 1087,
         "login" : "jwilkins",
         "organizations_url" : "https://api.github.com/users/jwilkins/orgs",
         "received_events_url" : "https://api.github.com/users/jwilkins/received_events",
         "repos_url" : "https://api.github.com/users/jwilkins/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jwilkins/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jwilkins/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jwilkins"
      }
   },
   {
      "body" : "@jwilkins Chaining root requires UID zero.  Using chroot against a file breaks the root user out of the chroot, but for normal users it does not.  If the chroot has no files or no suid root binaries then it can be an effective jail for processes with EUID && UID != 0.  Though it was never intended to do so, it's just a by-product.\r\n\r\n@all\r\nBitcoin and chroot has other issues, the ability to write to files and even worse write permissions on a directory.  The effectiveness of a chroot is limited until these are addressed.\r\n\r\nThough it's not entirely necessary to have daemons support changing euid/uid/root/ect.  I use [daemon](http://libslack.org/daemon/) for that.\r\n\r\nClosing the terminal(pty/tty) is important as not doing so can cause ssh sessions to be unable to close cleanly.\r\n\r\nI also suggest looking at http://libslack.org/daemon/manpages/daemon.1.html as [1] looks a little barren in comparison.",
      "created_at" : "2015-04-20T03:45:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4676#issuecomment-94349283",
      "id" : 94349283,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4676",
      "updated_at" : "2015-04-20T03:45:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/94349283",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1366303?v=3",
         "events_url" : "https://api.github.com/users/cheako/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cheako/followers",
         "following_url" : "https://api.github.com/users/cheako/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cheako/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cheako",
         "id" : 1366303,
         "login" : "cheako",
         "organizations_url" : "https://api.github.com/users/cheako/orgs",
         "received_events_url" : "https://api.github.com/users/cheako/received_events",
         "repos_url" : "https://api.github.com/users/cheako/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cheako/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cheako/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cheako"
      }
   }
]
