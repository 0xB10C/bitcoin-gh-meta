[
   {
      "body" : "Updated to fill up to nNodes.  Should now be \"feature complete.\"\r\n",
      "created_at" : "2014-08-04T23:45:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4632#issuecomment-51132961",
      "id" : 51132961,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4632",
      "updated_at" : "2014-08-04T23:45:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/51132961",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "Looks like a very nice idea, will test this later.",
      "created_at" : "2014-08-05T08:50:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4632#issuecomment-51166911",
      "id" : 51166911,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4632",
      "updated_at" : "2014-08-05T08:50:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/51166911",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "body" : "Compiles fine and I have a testnet and mainnet node running this patch now.\r\nWhat about a debug message, which addresses are dropped?",
      "created_at" : "2014-08-05T12:03:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4632#issuecomment-51187781",
      "id" : 51187781,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4632",
      "updated_at" : "2014-08-05T12:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/51187781",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "body" : "Thanks for working on this! Sounds like a good step towards getaddr results matching the quality of DNS seed results (so becoming more usable for spv clients).\r\n\r\nIt's hard to test this ... it could return garbage and a test node would seem to operate properly. It'd be nice if we had a tool to diff the results of getaddr. Maybe @TheBlueMatt feels up for it, as he did some work on addr[man] in bitcoinj.",
      "created_at" : "2014-08-11T10:08:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4632#issuecomment-51762119",
      "id" : 51762119,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4632",
      "updated_at" : "2014-08-11T10:08:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/51762119",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/971089?v=3",
         "events_url" : "https://api.github.com/users/mikehearn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mikehearn/followers",
         "following_url" : "https://api.github.com/users/mikehearn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mikehearn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mikehearn",
         "id" : 971089,
         "login" : "mikehearn",
         "organizations_url" : "https://api.github.com/users/mikehearn/orgs",
         "received_events_url" : "https://api.github.com/users/mikehearn/received_events",
         "repos_url" : "https://api.github.com/users/mikehearn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mikehearn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mikehearn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mikehearn"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/4632#discussion_r16289938"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4632"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16289938"
         }
      },
      "body" : "You've changed the type of nNodes to unsigned already. Maybe use an unsigned int or size_t counter here as well instead of an int - no need for the (int) cast in that case, which could theoretically be a truncation.\r\n\r\n\r\n",
      "commit_id" : "3a56de7fc318a45a7096cd318e2f2d7f8124ce24",
      "created_at" : "2014-08-15T12:23:34Z",
      "diff_hunk" : "@@ -492,17 +492,23 @@ int CAddrMan::Check_()\n \n void CAddrMan::GetAddr_(std::vector<CAddress> &vAddr)\n {\n-    int nNodes = ADDRMAN_GETADDR_MAX_PCT*vRandom.size()/100;\n+    unsigned int nNodes = ADDRMAN_GETADDR_MAX_PCT * vRandom.size() / 100;\n     if (nNodes > ADDRMAN_GETADDR_MAX)\n         nNodes = ADDRMAN_GETADDR_MAX;\n \n     // perform a random shuffle over the first nNodes elements of vRandom (selecting from all)\n-    for (int n = 0; n<nNodes; n++)\n+    for (int n = 0; n < (int)vRandom.size(); n++)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4632#discussion_r16289938",
      "id" : 16289938,
      "original_commit_id" : "50dedd76253764727d3a53dd1c36673718cb8616",
      "original_position" : 11,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4632",
      "updated_at" : "2014-08-18T20:50:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16289938",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/4632#discussion_r16380443"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4632"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16380443"
         }
      },
      "body" : "Updated thusly.",
      "commit_id" : "3a56de7fc318a45a7096cd318e2f2d7f8124ce24",
      "created_at" : "2014-08-18T20:44:24Z",
      "diff_hunk" : "@@ -492,17 +492,23 @@ int CAddrMan::Check_()\n \n void CAddrMan::GetAddr_(std::vector<CAddress> &vAddr)\n {\n-    int nNodes = ADDRMAN_GETADDR_MAX_PCT*vRandom.size()/100;\n+    unsigned int nNodes = ADDRMAN_GETADDR_MAX_PCT * vRandom.size() / 100;\n     if (nNodes > ADDRMAN_GETADDR_MAX)\n         nNodes = ADDRMAN_GETADDR_MAX;\n \n     // perform a random shuffle over the first nNodes elements of vRandom (selecting from all)\n-    for (int n = 0; n<nNodes; n++)\n+    for (int n = 0; n < (int)vRandom.size(); n++)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4632#discussion_r16380443",
      "id" : 16380443,
      "original_commit_id" : "50dedd76253764727d3a53dd1c36673718cb8616",
      "original_position" : 11,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4632",
      "updated_at" : "2014-08-18T20:50:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16380443",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/4632#discussion_r16380614"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4632"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16380614"
         }
      },
      "body" : "Update the comment too, please.",
      "commit_id" : "3a56de7fc318a45a7096cd318e2f2d7f8124ce24",
      "created_at" : "2014-08-18T20:47:03Z",
      "diff_hunk" : "@@ -492,17 +492,23 @@ int CAddrMan::Check_()\n \n void CAddrMan::GetAddr_(std::vector<CAddress> &vAddr)\n {\n-    int nNodes = ADDRMAN_GETADDR_MAX_PCT*vRandom.size()/100;\n+    unsigned int nNodes = ADDRMAN_GETADDR_MAX_PCT * vRandom.size() / 100;\n     if (nNodes > ADDRMAN_GETADDR_MAX)\n         nNodes = ADDRMAN_GETADDR_MAX;\n \n     // perform a random shuffle over the first nNodes elements of vRandom (selecting from all)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4632#discussion_r16380614",
      "id" : 16380614,
      "original_commit_id" : "de2a68d84e6d755576cbff362cbc5489f80be234",
      "original_position" : 9,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4632",
      "updated_at" : "2014-08-18T20:50:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16380614",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/p4632_3a56de7fc318a45a7096cd318e2f2d7f8124ce24/ for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.",
      "created_at" : "2014-08-18T22:43:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4632#issuecomment-52565971",
      "id" : 52565971,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4632",
      "updated_at" : "2014-08-18T22:43:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/52565971",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "body" : "I've been testing this on my node for some time, and can confirm that it remains stable.\r\n\r\nI also ran with added logging for a while, logging which IPs are dropped as terrible, and how many peers are sent. For every getaddr about 20-30 terrible peers are avoided to be sent.\r\nI've examined a sample of these, and they were indeed all unconnectable. In total it does send 2500 addresses per query (`ADDRMAN_GETADDR_MAX`), as expected.\r\n\r\nI've also sampled part of the addresses that were returned - a part of these were connectable. So all in all, this improves the quality of returned addresses\r\n\r\nACK.",
      "created_at" : "2014-08-21T11:18:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4632#issuecomment-52906953",
      "id" : 52906953,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4632",
      "updated_at" : "2014-08-21T11:18:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/52906953",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Untested ACK",
      "created_at" : "2014-08-23T10:43:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4632#issuecomment-53149413",
      "id" : 53149413,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4632",
      "updated_at" : "2014-08-23T10:43:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53149413",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Already noticing the improvements from this!",
      "created_at" : "2014-09-06T02:30:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4632#issuecomment-54699955",
      "id" : 54699955,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4632",
      "updated_at" : "2014-09-06T02:30:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/54699955",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   }
]
