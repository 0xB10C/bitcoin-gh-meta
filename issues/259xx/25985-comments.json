[
   {
      "author_association" : "MEMBER",
      "body" : "It would be nice if we could figure out why macOS SQLite is different from self built so that we can replicate those performance improvements in our depends build.",
      "created_at" : "2022-09-02T16:31:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25985#issuecomment-1235699568",
      "id" : 1235699568,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25985",
      "node_id" : "IC_kwDOABII585Jp0dw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1235699568/reactions"
      },
      "updated_at" : "2022-09-02T16:31:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1235699568",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\n\r\nThe Homebrew [docs](https://docs.brew.sh/How-to-Build-Software-Outside-Homebrew-with-Homebrew-keg-only-Dependencies#what-does-keg-only-mean) recommend to \"not remove macOS native tools and forcefully replace them with symlinks back to the Homebrew-provided tool.\"\r\n\r\nBut I couldn't find anything on whether MacOS's version of SQLite is different to the brew version of SQLite (assuming the same version numbers). That difference in performance is surely not entirely explained by different version numbers being used.",
      "created_at" : "2022-09-02T17:03:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25985#issuecomment-1235726102",
      "id" : 1235726102,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25985",
      "node_id" : "IC_kwDOABII585Jp68W",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1235726102/reactions"
      },
      "updated_at" : "2022-09-02T17:03:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1235726102",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nit's not correct to say there was \"no rationale\", it's in the pr description: \r\n> On master (https://github.com/bitcoin/bitcoin/commit/7ae86b3c6845873ca96650fc69beb4ae5285c801) installed Homebrew sqlite package is ignored during build on macOS.\r\n> This PR fixes this issue and update macOS build docs.\r\n\r\nBut we now know we'd prefer not to use the brew version.",
      "created_at" : "2022-09-02T20:08:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25985#issuecomment-1235859207",
      "id" : 1235859207,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25985",
      "node_id" : "IC_kwDOABII585JqbcH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1235859207/reactions"
      },
      "updated_at" : "2022-09-02T20:08:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1235859207",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23396902?v=4",
         "events_url" : "https://api.github.com/users/jarolrod/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jarolrod/followers",
         "following_url" : "https://api.github.com/users/jarolrod/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jarolrod/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jarolrod",
         "id" : 23396902,
         "login" : "jarolrod",
         "node_id" : "MDQ6VXNlcjIzMzk2OTAy",
         "organizations_url" : "https://api.github.com/users/jarolrod/orgs",
         "received_events_url" : "https://api.github.com/users/jarolrod/received_events",
         "repos_url" : "https://api.github.com/users/jarolrod/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jarolrod/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jarolrod/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jarolrod"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> It would be nice if we could figure out why macOS SQLite is different from self built so that we can replicate those performance improvements in our depends build.\r\n\r\nI agree. Started having a look through https://github.com/apple-oss-distributions to see if there might be any clues.\r\n\r\n> it's not correct to say there was \"no rationale\", it's in the pr description:\r\n\r\nThe description just says we should prefer brew installed sqlite if it happens to be installed. There's no reasoning given as to why we should prefer that instead of just using the system library (i.e it's faster, has newer features we require, system libs are severely outdated/buggy) etc.\r\n",
      "created_at" : "2022-09-02T20:24:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25985#issuecomment-1235869475",
      "id" : 1235869475,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25985",
      "node_id" : "IC_kwDOABII585Jqd8j",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1235869475/reactions"
      },
      "updated_at" : "2022-09-02T20:24:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1235869475",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "What is the sqlite version on macOS 10.15?",
      "created_at" : "2022-09-03T07:05:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25985#issuecomment-1236063775",
      "id" : 1236063775,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25985",
      "node_id" : "IC_kwDOABII585JrNYf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1236063775/reactions"
      },
      "updated_at" : "2022-09-03T07:05:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1236063775",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested d216d714aae36e6f1c95f82aef81a0be74dee2f3\r\n\r\nOn the first machine the system library is twice as fast, on the second machine there's no difference (or it's even slightly slower). I checked in the log that right Sqlite version was indeed used.\r\n\r\nI agree with @hebasto that we should check if this holds for older (supported) macOS versions. Perhaps a safer approach is to pick whichever version is higher.\r\n\r\nMachine 1 MacBook Pro (2.3 GHz 8-Core Intel Core i9), macOS 12.5.1\r\n * with Sqlite 3.39.2 via homebrew: 3.8s\r\n * system Sqlite 3.37.0: 2.0s\r\n \r\nMachine 2: iMac (3.4 GHz Quad-Core Intel Core i5): macOS 12.5.1\r\n * with Sqlite 3.39.2 via homebrew: 0.5s\r\n * system Sqlite 3.37.0: 0.6s\r\n\r\n\r\nNote that machine 2 is _much_ slower than machine 1, yet sqlite performs faster. There's something else going on, possibly specific to my setup. I got even more extreme results with the `migratewallet` RPC. ",
      "created_at" : "2022-09-05T11:31:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25985#issuecomment-1236878280",
      "id" : 1236878280,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25985",
      "node_id" : "IC_kwDOABII585JuUPI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1236878280/reactions"
      },
      "updated_at" : "2022-09-05T11:31:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1236878280",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
