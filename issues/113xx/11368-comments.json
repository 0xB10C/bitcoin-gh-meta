[
   {
      "author_association" : "MEMBER",
      "body" : "Duplicate of https://github.com/bitcoin/bitcoin/issues/11322?",
      "created_at" : "2017-09-19T10:22:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-330496512",
      "id" : 330496512,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11368",
      "updated_at" : "2017-09-19T10:22:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/330496512",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Not sure, these are valid queries ... not invalid ones. RPC queue gets filled up. Getting responses back ... ",
      "created_at" : "2017-09-19T10:23:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-330496846",
      "id" : 330496846,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11368",
      "updated_at" : "2017-09-19T10:23:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/330496846",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/15045051?v=4",
         "events_url" : "https://api.github.com/users/KanoczTomas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/KanoczTomas/followers",
         "following_url" : "https://api.github.com/users/KanoczTomas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/KanoczTomas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/KanoczTomas",
         "id" : 15045051,
         "login" : "KanoczTomas",
         "organizations_url" : "https://api.github.com/users/KanoczTomas/orgs",
         "received_events_url" : "https://api.github.com/users/KanoczTomas/received_events",
         "repos_url" : "https://api.github.com/users/KanoczTomas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/KanoczTomas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/KanoczTomas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/KanoczTomas"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "and I forgot, tested on rest interface as well, managed to kill it with the same procedure ... \r\ncalling GET /rest/tx/TX-HASH.json instead of getrawtransaction ... \r\nmaybe it helps ... ",
      "created_at" : "2017-09-19T10:34:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-330499065",
      "id" : 330499065,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11368",
      "updated_at" : "2017-09-19T10:41:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/330499065",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/15045051?v=4",
         "events_url" : "https://api.github.com/users/KanoczTomas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/KanoczTomas/followers",
         "following_url" : "https://api.github.com/users/KanoczTomas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/KanoczTomas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/KanoczTomas",
         "id" : 15045051,
         "login" : "KanoczTomas",
         "organizations_url" : "https://api.github.com/users/KanoczTomas/orgs",
         "received_events_url" : "https://api.github.com/users/KanoczTomas/received_events",
         "repos_url" : "https://api.github.com/users/KanoczTomas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/KanoczTomas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/KanoczTomas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/KanoczTomas"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "[Hello,](url)\r\n\r\nHere is a small script to reproduce in nodejs.\r\n\r\n```javascript\r\n'use strict';\r\nvar request = require('request-promise');\r\nvar zmq = require('zeromq');\r\nvar sock = zmq.socket('sub');\r\nsock.connect('tcp://127.0.0.1:28332');\r\nsock.subscribe('hashtx');\r\n\r\nsock.on('message', function(topic, message) {\r\n    var uri = 'http://127.0.0.1:8332/rest/tx/' + message.toString('hex') + '.json'; \r\n    request(uri)\r\n    .then(function (res){\r\n        console.log(res);\r\n    })\r\n    .error(function (err){\r\n        console.error(err);\r\n        process.exit(1);\r\n    })\r\n});\r\n```\r\nbitcoind config:\r\n```\r\nprune=550\r\nwalletbroadcast=0\r\ndaemon=1\r\nserver=1\r\nrest=1\r\nzmqpubhashtx=tcp://127.0.0.1:28332\r\nrpcworkqueue=100\r\n```\r\n\r\nIt takes some time to kill bitcoind, the time varies, could not figure out what influences the time variance.\r\n\r\nbitcoind crashes and all I see in the logs is this:\r\n```\r\n<lot of similar output>\r\n2017-09-26 09:55:42 WARNING: request rejected because http work queue depth exceeded, it can be increased with the -rpcworkqueue= setting\r\n2017-09-26 09:55:44 Error reading from database: Database I/O error\r\n```",
      "created_at" : "2017-09-27T06:12:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-332419482",
      "id" : 332419482,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11368",
      "updated_at" : "2017-09-27T06:13:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/332419482",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/15045051?v=4",
         "events_url" : "https://api.github.com/users/KanoczTomas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/KanoczTomas/followers",
         "following_url" : "https://api.github.com/users/KanoczTomas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/KanoczTomas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/KanoczTomas",
         "id" : 15045051,
         "login" : "KanoczTomas",
         "organizations_url" : "https://api.github.com/users/KanoczTomas/orgs",
         "received_events_url" : "https://api.github.com/users/KanoczTomas/received_events",
         "repos_url" : "https://api.github.com/users/KanoczTomas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/KanoczTomas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/KanoczTomas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/KanoczTomas"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Your reproduction is using the `/rest/tx/...`, not RPC?",
      "created_at" : "2017-11-01T09:06:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-341043192",
      "id" : 341043192,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11368",
      "updated_at" : "2017-11-01T09:06:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341043192",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/413395?v=4",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Hi,\r\n\r\ncalling the RPC directly behaves the same. Same error, same behavior as in the example log output above. When talking to @gmaxwell on #bitcoin I recall he mentioned they use the same internals in the background.\r\n\r\nGood catch though, I was testing if the rest API behaves the same and copied that here, was not really thinking it should have been RPC there to make the point - my bad!\r\n\r\nWorking with a queue to not overwhelm bitcoind helps, it does not kill it, but I think it should not be so easily crashed! The crash happens only if RPC/rest calls are not policed/shaped ... ",
      "created_at" : "2017-11-02T12:14:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-341403042",
      "id" : 341403042,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11368",
      "updated_at" : "2017-11-02T12:14:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341403042",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/15045051?v=4",
         "events_url" : "https://api.github.com/users/KanoczTomas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/KanoczTomas/followers",
         "following_url" : "https://api.github.com/users/KanoczTomas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/KanoczTomas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/KanoczTomas",
         "id" : 15045051,
         "login" : "KanoczTomas",
         "organizations_url" : "https://api.github.com/users/KanoczTomas/orgs",
         "received_events_url" : "https://api.github.com/users/KanoczTomas/received_events",
         "repos_url" : "https://api.github.com/users/KanoczTomas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/KanoczTomas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/KanoczTomas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/KanoczTomas"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "If possible, can you reproduce the issue with -debug=leveldb or after calling 'logging [\"leveldb\"]'?",
      "created_at" : "2017-11-02T19:29:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-341532797",
      "id" : 341532797,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11368",
      "updated_at" : "2017-11-02T19:29:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341532797",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "now used RPC to show it behaves the same. The log is full of repeating messages, so pasting the relevant ones only, I can provide the full log, but it created 70k+ lines ...\r\n\r\nCode to reproduce: \r\ntest.js\r\n```javascript\r\n'use strict';\r\nvar zmq = require('zeromq');\r\nvar sock = zmq.socket('sub');\r\nsock.connect('tcp://127.0.0.1:28332');\r\nsock.subscribe('hashtx');\r\nvar bitcoinRPC = require('node-bitcoin-rpc');\r\nvar Promise = require('bluebird');\r\nPromise.promisifyAll(bitcoinRPC);\r\n\r\nbitcoinRPC.init('localhost', 8332, 'secret_rpc_username', 'even_more_secret_rpc_password');\r\n\r\nsock.on('message', function(topic, message) {\r\n    console.log('received message ' + message.toString('hex'));\r\n    for(var i=0;i< 10; i++){//making sure we make enough calls to stress bitcoind\r\n        bitcoinRPC.callAsync('getrawtransaction', [message.toString('hex')])\r\n        .then(function (res){\r\n            console.log(res);\r\n        })\r\n        .error(function (err){\r\n            console.error(err);\r\n        });\r\n    }\r\n});\r\n```\r\nUsed forever (available on npm) to restart the js script as the rpc lib has an annoying error and throws when bitcoin replies with work queue full - too lazy to work around it.\r\nenvoking the script:\r\n```\r\nforever test.js\r\n```\r\ndebug.log output:\r\n```\r\n2017-11-02 23:07:45 ThreadRPCServer method=getrawtransaction\r\n2017-11-02 23:07:45 ThreadRPCServer method=getrawtransaction\r\n2017-11-02 23:07:45 Generated table #958831@3: 39102 keys, 2174699 bytes\r\n2017-11-02 23:07:46 Generated table #958832@3: 6726 keys, 382075 bytes\r\n2017-11-02 23:07:46 Compacted 1@3 + 11@4 files => 22123265 bytes\r\n2017-11-02 23:07:46 compacted to: files[ 0 0 1 369 1119 0 0 ]\r\n2017-11-02 23:07:46 Delete type=2 #956892\r\n2017-11-02 23:07:46 Delete type=2 #956893\r\n2017-11-02 23:07:46 Delete type=2 #956894\r\n2017-11-02 23:07:46 Delete type=2 #956895\r\n2017-11-02 23:07:46 Delete type=2 #956896\r\n2017-11-02 23:07:46 Delete type=2 #957071\r\n2017-11-02 23:07:46 Delete type=2 #957072\r\n2017-11-02 23:07:46 Delete type=2 #957069\r\n2017-11-02 23:07:46 Delete type=2 #956891\r\n2017-11-02 23:07:46 Delete type=2 #957070\r\n2017-11-02 23:07:46 Delete type=2 #957387\r\n2017-11-02 23:07:46 Delete type=2 #957068\r\n2017-11-02 23:07:46 ThreadRPCServer method=getrawtransaction\r\n2017-11-02 23:07:46 ThreadRPCServer method=getrawtransaction\r\n--- same message repeated ---\r\n2017-11-02 23:07:49 WARNING: request rejected because http work queue depth exceeded, it can be increased with the -rpcworkqueue= setting\r\n2017-11-02 23:07:49 WARNING: request rejected because http work queue depth exceeded, it can be increased with the -rpcworkqueue= setting\r\n2017-11-02 23:07:49 ThreadRPCServer method=getrawtransaction\r\n--- same message repeated ---\r\n--- this part is where bitcoin-qt crashed ---\r\n2017-11-02 23:07:54 ThreadRPCServer method=getrawtransaction\r\n2017-11-02 23:07:54 ThreadRPCServer method=getrawtransaction\r\n2017-11-02 23:07:54 ThreadRPCServer method=getrawtransaction\r\n2017-11-02 23:07:54 ThreadRPCServer method=getrawtransaction\r\n2017-11-02 23:07:54 ThreadRPCServer method=getrawtransaction\r\n2017-11-02 23:07:54 ThreadRPCServer method=getrawtransaction\r\n2017-11-02 23:07:54 ThreadRPCServer method=getrawtransaction\r\n2017-11-02 23:07:54 ThreadRPCServer method=getrawtransaction\r\n2017-11-02 23:07:54 ThreadRPCServer method=getrawtransaction\r\n2017-11-02 23:07:54 ThreadRPCServer method=getrawtransaction\r\n2017-11-02 23:07:54 ThreadRPCServer method=getrawtransaction\r\n2017-11-02 23:07:54 ThreadRPCServer method=getrawtransaction\r\n2017-11-02 23:07:54 libevent: Error from accept() call: Too many open files\r\n2017-11-02 23:07:54 libevent: Error from accept() call: Too many open files\r\n2017-11-02 23:07:54 libevent: Error from accept() call: Too many open files\r\n2017-11-02 23:07:54 libevent: Error from accept() call: Too many open files\r\n2017-11-02 23:07:54 libevent: Error from accept() call: Too many open files\r\n2017-11-02 23:07:54 libevent: Error from accept() call: Too many open files\r\n2017-11-02 23:07:54 libevent: Error from accept() call: Too many open files\r\n2017-11-02 23:07:54 libevent: Error from accept() call: Too many open files\r\n2017-11-02 23:07:54 libevent: Error from accept() call: Too many open files\r\n2017-11-02 23:07:54 libevent: Error from accept() call: Too many open files\r\n--- same message repeated (around 1k lines)\r\n2017-11-02 23:07:54 LevelDB read failure: IO error: /media/sentinel/B2783BC6783B87DD/Users/Sentinel/AppData/Roaming/Bitcoin/chainstate/957866.ldb: Too many open files\r\n2017-11-02 23:07:54 libevent: Error from accept() call: Too many open files\r\n2017-11-02 23:07:54 libevent: Error from accept() call: Too many open files\r\n--- 70 000 times repeated the above ---\r\n```\r\n\r\nIf you need more debug flags turned on, please let me know!",
      "created_at" : "2017-11-02T23:34:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-341588854",
      "id" : 341588854,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11368",
      "updated_at" : "2017-11-02T23:38:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341588854",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/15045051?v=4",
         "events_url" : "https://api.github.com/users/KanoczTomas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/KanoczTomas/followers",
         "following_url" : "https://api.github.com/users/KanoczTomas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/KanoczTomas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/KanoczTomas",
         "id" : 15045051,
         "login" : "KanoczTomas",
         "organizations_url" : "https://api.github.com/users/KanoczTomas/orgs",
         "received_events_url" : "https://api.github.com/users/KanoczTomas/received_events",
         "repos_url" : "https://api.github.com/users/KanoczTomas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/KanoczTomas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/KanoczTomas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/KanoczTomas"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Could you please give this a shot: https://github.com/theuni/bitcoin/commit/c22ab2282bc68ab71ed052e9e6fe7e956b490e11 ? It's a wild stab in the dark.\r\n\r\nIt's built on latest master, but you can just build from my \"fix-rpc-error\" branch",
      "created_at" : "2017-11-03T02:16:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-341608621",
      "id" : 341608621,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11368",
      "updated_at" : "2017-11-03T02:16:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341608621",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Hello,\r\n\r\nI have built bitcoin-qt from your fix-rpc-error branch. \r\n\r\nI am testing now on a laptop with SSD disk, an it takes roughly 14 minutes to see the error. The same error, same behavior. The previous test was done on a laptop with spinning disks, it took 5-8 minutes to crash bitcoin-qt. I also ran (after a restart, to make sure all is clear) v0.15.0.1 and it took 14 minutes to bring down as well.\r\n\r\nI created a 4G tmpfs directory (in ram) and copied the data dir content there (started bitcoin-qt with -datadir=). As the node is pruned it fitted fine. Than ran the test script again, I could not crash your rpc fix version (gave up after running it for 1 hour), v0.15.0.1 crashed after 33 minutes.\r\n\r\nI will have access to the spinning disk laptop later, I will run it there as well and update the comment.",
      "created_at" : "2017-11-04T16:58:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-341912477",
      "id" : 341912477,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11368",
      "updated_at" : "2017-11-04T17:00:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341912477",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/15045051?v=4",
         "events_url" : "https://api.github.com/users/KanoczTomas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/KanoczTomas/followers",
         "following_url" : "https://api.github.com/users/KanoczTomas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/KanoczTomas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/KanoczTomas",
         "id" : 15045051,
         "login" : "KanoczTomas",
         "organizations_url" : "https://api.github.com/users/KanoczTomas/orgs",
         "received_events_url" : "https://api.github.com/users/KanoczTomas/received_events",
         "repos_url" : "https://api.github.com/users/KanoczTomas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/KanoczTomas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/KanoczTomas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/KanoczTomas"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@theuni I suppose a better fix is to drop incoming RPC sockets on the floor before we read any data from them if we're way over some upper water mark?\r\n\r\n@KanoczTomas as a workaround, you can change the open files limit using ulimit, which may solve your issue.",
      "created_at" : "2017-11-04T17:54:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-341916741",
      "id" : 341916741,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11368",
      "updated_at" : "2017-11-04T17:54:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341916741",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@TheBlueMatt I tried that at first, raising it to e.g. 8k helped, but only changed the frequency of the crash. With 8k It crashed every few days, the same error. So it seems whatever high number I give it, it gets always full, as I am fetching the input of every new mempool TX received through zmq I do stress bitcoind in my app a lot. The problem is that sometimes it corrupts the database and I have to reindex which takes days on my node (odroid).\r\n\r\nWhen I rate limit the RPC queries on the client side, all is fine. ",
      "created_at" : "2017-11-04T21:53:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-341932411",
      "id" : 341932411,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11368",
      "updated_at" : "2017-11-04T21:55:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341932411",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/15045051?v=4",
         "events_url" : "https://api.github.com/users/KanoczTomas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/KanoczTomas/followers",
         "following_url" : "https://api.github.com/users/KanoczTomas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/KanoczTomas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/KanoczTomas",
         "id" : 15045051,
         "login" : "KanoczTomas",
         "organizations_url" : "https://api.github.com/users/KanoczTomas/orgs",
         "received_events_url" : "https://api.github.com/users/KanoczTomas/received_events",
         "repos_url" : "https://api.github.com/users/KanoczTomas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/KanoczTomas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/KanoczTomas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/KanoczTomas"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yea, sorry, I realized after posting that that wont help - you're outrunning the RPC server - there's nothing we can do to really fix it, though its true bitcoind shouldn't crash, it should instead be just cleanly not responding to the requests that come in when there are no queue slots left instead of trying to return errors.",
      "created_at" : "2017-11-04T22:24:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-341934085",
      "id" : 341934085,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11368",
      "updated_at" : "2017-11-04T22:24:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341934085",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@TheBlueMatt To clarify, the current code uses a deferred response to try to return the error, which I think may be creating a feedback loop. Connections may be accepted faster than we can close them due to a full queue. The patch makes rejection immediate, which reverses that, and ensures that no more than 1 superfluous connection is never accepted.\r\n\r\nWe _could_ just drop the connection on the floor, but I think that the above fix addresses the issue. I'm not convinced that the reply overhead is relevant once that is fixed.\r\n\r\n@laanwj Mind having a look?",
      "created_at" : "2017-11-05T19:50:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-341999817",
      "id" : 341999817,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11368",
      "updated_at" : "2017-11-05T19:50:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341999817",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yea, agreed, if we can return an error that'd be nice, but it's not gonna help the user all that much, and if the user is pegging the interface faster than we can respond to much, just dropping it on the floor works just as well.\n\nOn November 5, 2017 2:50:50 PM EST, Cory Fields <notifications@github.com> wrote:\n>@TheBlueMatt To clarify, the current code uses a deferred response to\n>try to return the error, which I think may be creating a feedback loop.\n>Connections may be accepted faster than we can close them due to a full\n>queue. The patch makes rejection immediate, which reverses that, and\n>ensures that no more than 1 superfluous connection is never accepted.\n>\n>We _could_ just drop the connection on the floor, but I think that the\n>above fix addresses the issue. I'm not convinced that the reply\n>overhead is relevant once that is fixed.\n>\n>@laanwj Mind having a look?\n>\n>-- \n>You are receiving this because you were mentioned.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-341999817\n",
      "created_at" : "2017-11-05T20:00:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-342000566",
      "id" : 342000566,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11368",
      "updated_at" : "2017-11-05T20:00:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/342000566",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> @laanwj Mind having a look?\r\n\r\nCan we make WriteReplyImmediate private or protected so that it is not part of the public interface? It should never be called from one of the worker threads. If not, this restriction should at least be documented very well.\r\n\r\nOtherwise: Looks good to me. I hope this works. I prefer returning an error to just dropping the connection, it is incredibly frustrating for things to fail without error message. Though arguably we at least (unconditionally) log an error to the debug log.\r\n\r\n",
      "created_at" : "2017-11-05T20:41:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-342003686",
      "id" : 342003686,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11368",
      "updated_at" : "2017-11-05T20:41:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/342003686",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@laanwj Sure. WriteReplyImmediate was just a quick hack to test, but looking now, I don't really see another straightforward way without doing a bunch of refactors first. So I guess I'll just make it private and document as you suggested.\r\n\r\n@KanoczTomas Can you confirm that this has indeed fixed your issue on all tested configs?",
      "created_at" : "2017-11-05T21:25:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-342007050",
      "id" : 342007050,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11368",
      "updated_at" : "2017-11-05T21:25:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/342007050",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@theuni he already confirmed that the branch did *not* fix his issue. https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-341912477\n\nOn November 5, 2017 4:26:00 PM EST, Cory Fields <notifications@github.com> wrote:\n>@laanwj Sure. WriteReplyImmediate was just a quick hack to test, but\n>looking now, I don't really see another straightforward way without\n>doing a bunch of refactors first. So I guess I'll just make it private\n>and document as you suggested.\n>\n>@KanoczTomas Can you confirm that this has indeed fixed your issue on\n>all tested configs?\n>\n>-- \n>You are receiving this because you were mentioned.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-342007050\n",
      "created_at" : "2017-11-05T21:46:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-342008484",
      "id" : 342008484,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11368",
      "updated_at" : "2017-11-05T21:46:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/342008484",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@TheBlueMatt Thanks, I misread the first paragraph there. So this only fixes on tmpfs.",
      "created_at" : "2017-11-05T22:11:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11368#issuecomment-342010089",
      "id" : 342010089,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11368",
      "updated_at" : "2017-11-05T22:11:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/342010089",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   }
]
