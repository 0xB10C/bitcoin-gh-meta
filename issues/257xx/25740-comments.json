[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25862](https://github.com/bitcoin/bitcoin/pull/25862) (refactor, kernel: Remove gArgs accesses from dbwrapper and txdb by ryanofsky)\n* [#25722](https://github.com/bitcoin/bitcoin/pull/25722) (refactor: Use util::Result class for wallet loading by ryanofsky)\n* [#25704](https://github.com/bitcoin/bitcoin/pull/25704) (refactor: Remove almost all validation option globals by MarcoFalke)\n* [#25665](https://github.com/bitcoin/bitcoin/pull/25665) (refactor: Add util::Result failure values, multiple error and warning messages by ryanofsky)\n* [#19888](https://github.com/bitcoin/bitcoin/pull/19888) (rpc, test: Improve getblockstats for unspendables by fjahr)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-07-29T21:47:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#issuecomment-1199966506",
      "id" : 1199966506,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25740",
      "node_id" : "IC_kwDOABII585Hhgkq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1199966506/reactions"
      },
      "updated_at" : "2022-10-24T01:50:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1199966506",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "```\r\ntest/validation_chainstatemanager_tests.cpp:418:35: error: calling function 'DisconnectTip' requires holding mutex 'bg_chainstate.m_mempool->cs' exclusively [-Werror,-Wthread-safety-precise]\r\n        BOOST_CHECK(bg_chainstate.DisconnectTip(unused_state, &unused_pool));\r\n                                  ^\r\ntest/validation_chainstatemanager_tests.cpp:418:35: note: found near match 'mempool->cs'\r\n1 error generated.\r\n```\r\n",
      "created_at" : "2022-07-30T08:57:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#issuecomment-1200119940",
      "id" : 1200119940,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25740",
      "node_id" : "IC_kwDOABII585HiGCE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1200119940/reactions"
      },
      "updated_at" : "2022-07-30T08:57:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1200119940",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r934711528"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/934711528"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"test: add testcases for snapshot initialization\" (5ff0d2f7e78a40225a1eb9aa7bbf5c358d94bf48)\r\n\r\nSomething wonky is going on in this commit. It seems like some rebase error. This is dropping the `chainstatemanager_loadblockindex` test, and replacing it with an exact copy of the `chainstatemanager_snapshot_init` below, which now appears twice (and is edited in later commit 65ad0860ffd9441b005ac4bc240f596d9a81836f to become a different chainstatemanager_snapshot_completion test)",
      "commit_id" : "93e6a234678b98abe1c50b11b1d47cbe266d25fa",
      "created_at" : "2022-08-01T16:26:47Z",
      "diff_hunk" : "@@ -387,82 +387,57 @@ BOOST_FIXTURE_TEST_CASE(chainstatemanager_activate_snapshot, SnapshotTestSetup)\n     this->SetupSnapshot();\n }\n \n-//! Test LoadBlockIndex behavior when multiple chainstates are in use.\n-//!\n-//! - First, verfiy that setBlockIndexCandidates is as expected when using a single,\n-//!   fully-validating chainstate.\n-//!\n-//! - Then mark a region of the chain BLOCK_ASSUMED_VALID and introduce a second chainstate\n-//!   that will tolerate assumed-valid blocks. Run LoadBlockIndex() and ensure that the first\n-//!   chainstate only contains fully validated blocks and the other chainstate contains all blocks,\n-//!   even those assumed-valid.\n-//!\n-BOOST_FIXTURE_TEST_CASE(chainstatemanager_loadblockindex, TestChain100Setup)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r934711528",
      "id" : 934711528,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843tpDo",
      "original_commit_id" : "5ff0d2f7e78a40225a1eb9aa7bbf5c358d94bf48",
      "original_line" : 325,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/validation_chainstatemanager_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1057565671,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/934711528/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-01T16:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/934711528",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-08-03T09:23:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#issuecomment-1203702766",
      "id" : 1203702766,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25740",
      "node_id" : "IC_kwDOABII585Hvwvu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1203702766/reactions"
      },
      "updated_at" : "2022-08-03T09:23:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1203702766",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Clang failure on some platforms looks spurious:\r\n\r\n```\r\ntest/validation_chainstatemanager_tests.cpp:501:35: error: calling function 'DisconnectTip' requires holding mutex 'bg_chainstate.m_mempool->cs' exclusively [-Werror,-Wthread-safety-precise]\r\n        BOOST_CHECK(bg_chainstate.DisconnectTip(unused_state, &unused_pool));\r\n                                  ^\r\ntest/validation_chainstatemanager_tests.cpp:501:35: note: found near match 'mempool->cs'\r\n1 error generated.\r\n```\r\nbut lock is taken [here](https://github.com/bitcoin/bitcoin/pull/25740/commits/a9e27d3f242361534a1a50e403ab176b556ba528#diff-dbada1fe3a3d0af884304dd28be8c9df74b592401dec2c6400f6b491aefe6c9bR500). \r\n\r\nAnyone have ideas for workarounds?",
      "created_at" : "2022-09-06T22:47:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#issuecomment-1238726951",
      "id" : 1238726951,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25740",
      "node_id" : "IC_kwDOABII585J1Xkn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1238726951/reactions"
      },
      "updated_at" : "2022-09-06T22:47:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1238726951",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r964236783"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/964236783"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@ryanofsky yeah, thanks - not sure what happened there. Should be fixed.",
      "commit_id" : "93e6a234678b98abe1c50b11b1d47cbe266d25fa",
      "created_at" : "2022-09-06T22:47:56Z",
      "diff_hunk" : "@@ -387,82 +387,57 @@ BOOST_FIXTURE_TEST_CASE(chainstatemanager_activate_snapshot, SnapshotTestSetup)\n     this->SetupSnapshot();\n }\n \n-//! Test LoadBlockIndex behavior when multiple chainstates are in use.\n-//!\n-//! - First, verfiy that setBlockIndexCandidates is as expected when using a single,\n-//!   fully-validating chainstate.\n-//!\n-//! - Then mark a region of the chain BLOCK_ASSUMED_VALID and introduce a second chainstate\n-//!   that will tolerate assumed-valid blocks. Run LoadBlockIndex() and ensure that the first\n-//!   chainstate only contains fully validated blocks and the other chainstate contains all blocks,\n-//!   even those assumed-valid.\n-//!\n-BOOST_FIXTURE_TEST_CASE(chainstatemanager_loadblockindex, TestChain100Setup)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r964236783",
      "id" : 964236783,
      "in_reply_to_id" : 934711528,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845eRXv",
      "original_commit_id" : "5ff0d2f7e78a40225a1eb9aa7bbf5c358d94bf48",
      "original_line" : 325,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/validation_chainstatemanager_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1098333048,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/964236783/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-06T22:47:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/964236783",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "If the lock is for `bg_chainstate.GetMempool()->cs` but the annotation requires `bg_chainstate.m_mempool->cs`, the compiler probably isn't going to know that `GetMempool()` and `m_mempool` are the same. Probably should stick with `m_mempool`",
      "created_at" : "2022-09-06T22:52:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#issuecomment-1238729341",
      "id" : 1238729341,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25740",
      "node_id" : "IC_kwDOABII585J1YJ9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1238729341/reactions"
      },
      "updated_at" : "2022-09-06T22:52:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1238729341",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">  Probably should stick with m_mempool\r\n\r\nIt's protected :grimacing:. But looks like I can use the `RETURNS_LOCK` annotation on `MempoolMutex()`.\r\n\r\nEdit: that's private too, hah.",
      "created_at" : "2022-09-06T23:02:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#issuecomment-1238733581",
      "id" : 1238733581,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25740",
      "node_id" : "IC_kwDOABII585J1ZMN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1238733581/reactions"
      },
      "updated_at" : "2022-09-06T23:02:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1238733581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-09-13T16:34:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#issuecomment-1245663156",
      "id" : 1245663156,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25740",
      "node_id" : "IC_kwDOABII585KP0-0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1245663156/reactions"
      },
      "updated_at" : "2022-09-13T16:34:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1245663156",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Reopening and closing to get Github to deduplicate commits now included on master.",
      "created_at" : "2022-10-13T14:40:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#issuecomment-1277723681",
      "id" : 1277723681,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25740",
      "node_id" : "IC_kwDOABII585MKIQh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1277723681/reactions"
      },
      "updated_at" : "2022-10-13T14:40:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1277723681",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jamesob this PR should probably be added to #15606 now that it's out of draft.",
      "created_at" : "2022-10-13T15:00:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#issuecomment-1277755175",
      "id" : 1277755175,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25740",
      "node_id" : "IC_kwDOABII585MKP8n",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1277755175/reactions"
      },
      "updated_at" : "2022-10-13T15:31:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1277755175",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the ping @aureleoules; the parent PR description has been updated.",
      "created_at" : "2022-10-13T17:10:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#issuecomment-1277928248",
      "id" : 1277928248,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25740",
      "node_id" : "IC_kwDOABII585MK6M4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1277928248/reactions"
      },
      "updated_at" : "2022-10-13T17:10:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1277928248",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r997479271"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997479271"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc \"validation: add ChainMan logic for completing UTXO snapshot validation\"\r\n\r\nSince this is also caused by an invalid snapshot, should this be below and also call `handle_invalid_snapshot`? Otherwise it seems like this would just continue with the IBD chainstate without invalidating the snapshot chainstate which I think would be incorrect?",
      "commit_id" : "50909f0d5dc3a8f15c25ebab756b9a723e2deed3",
      "created_at" : "2022-10-17T20:25:58Z",
      "diff_hunk" : "@@ -5117,6 +5168,146 @@ bool ChainstateManager::PopulateAndValidateSnapshot(\n     return true;\n }\n \n+// Currently, this function holds cs_main for its duration, which could be for\n+// multiple minutes due to the GetUTXOStats call. This hold is necessary\n+// because we need to avoid advancing the background validation chainstate\n+// farther than the snapshot base block - and this function is also invoked\n+// from within ConnectTip, i.e. from within ActivateBestChain, so cs_main is\n+// held anyway.\n+//\n+// Eventually (TODO), we could somehow separate this function's runtime from\n+// maintenance of the active chain, but that will either require\n+//\n+//  (i) setting `m_stop_use` immediately and ensuring all chainstate accesses go\n+//      through IsUsable() checks, or\n+//\n+//  (ii) giving each chainstate its own lock instead of using cs_main for everything.\n+SnapshotCompletionResult ChainstateManager::MaybeCompleteSnapshotValidation(\n+      std::function<void(bilingual_str)> shutdown_fnc)\n+{\n+    AssertLockHeld(cs_main);\n+    if (m_ibd_chainstate.get() == &this->ActiveChainstate() ||\n+            !this->IsUsable(m_snapshot_chainstate.get()) ||\n+            !this->IsUsable(m_ibd_chainstate.get()) ||\n+            !m_ibd_chainstate->m_chain.Tip()) {\n+       // Nothing to do - this function only applies to the background\n+       // validation chainstate.\n+       return SnapshotCompletionResult::SKIPPED;\n+    }\n+    int snapshot_tip_height = this->ActiveHeight();\n+    int snapshot_base_height = *this->GetSnapshotBaseHeight();\n+    CBlockIndex& index_new = *m_ibd_chainstate->m_chain.Tip();\n+\n+    if (index_new.nHeight < snapshot_base_height) {\n+        // Background IBD not complete yet.\n+        return SnapshotCompletionResult::SKIPPED;\n+    }\n+\n+    assert(SnapshotBlockhash());\n+    uint256 snapshot_blockhash = *SnapshotBlockhash();\n+\n+    if (index_new.GetBlockHash() != snapshot_blockhash) {\n+      LogPrintf(\"[snapshot] supposed base block %s does not match the \" /* Continued */\n+          \"snapshot base block %s (height %d). Snapshot is not valid.\",\n+          index_new.ToString(), snapshot_blockhash.ToString(), snapshot_base_height);\n+       return SnapshotCompletionResult::BASE_BLOCKHASH_MISMATCH;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r997479271",
      "id" : 997479271,
      "line" : 5216,
      "node_id" : "PRRC_kwDOABII5847dFNn",
      "original_commit_id" : "a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc",
      "original_line" : 5214,
      "original_position" : 150,
      "original_start_line" : 5209,
      "path" : "src/validation.cpp",
      "position" : 150,
      "pull_request_review_id" : 1144767699,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997479271/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 5211,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-17T20:53:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997479271",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r997480620"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997480620"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc \"validation: add ChainMan logic for completing UTXO snapshot validation\"\r\n\r\nThis only renames the chainstate dir, it's not clear to me if/when the invalid chainstate is deleted. Considering that moving the chainstate dir and deleting it are effectively the same thing here, I think it could just do `fs::remove_all`.",
      "commit_id" : "50909f0d5dc3a8f15c25ebab756b9a723e2deed3",
      "created_at" : "2022-10-17T20:27:37Z",
      "diff_hunk" : "@@ -5213,6 +5404,39 @@ Chainstate& ChainstateManager::ActivateExistingSnapshot(CTxMemPool* mempool, uin\n     return *m_snapshot_chainstate;\n }\n \n+void Chainstate::InvalidateCoinsDBOnDisk()\n+{\n+    AssertLockHeld(::cs_main);\n+    // Should never be called on a non-snapshot chainstate.\n+    assert(m_from_snapshot_blockhash);\n+    auto storage_path_maybe = this->CoinsDB().StoragePath();\n+    // Should never be called with a non-existent storage path.\n+    assert(storage_path_maybe);\n+    fs::path snapshot_datadir = *storage_path_maybe;\n+\n+    // Coins views no longer usable.\n+    m_coins_views.reset();\n+\n+    auto invalid_path = snapshot_datadir + \"_INVALID\";\n+    std::string dbpath = fs::PathToString(snapshot_datadir);\n+    std::string target = fs::PathToString(invalid_path);\n+    LogPrintf(\"[snapshot] renaming snapshot datadir %s to %s\\n\", dbpath, target);\n+\n+    try {\n+        fs::rename(snapshot_datadir, invalid_path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r997480620",
      "id" : 997480620,
      "line" : 5428,
      "node_id" : "PRRC_kwDOABII5847dFis",
      "original_commit_id" : "a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc",
      "original_line" : 5426,
      "original_position" : 273,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 273,
      "pull_request_review_id" : 1144767699,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997480620/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-17T20:53:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997480620",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r997485284"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997485284"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc \"validation: add ChainMan logic for completing UTXO snapshot validation\"\r\n\r\n```\r\nvalidation.cpp: In member function âbool ChainstateManager::PopulateAndValidateSnapshot(Chainstate&, AutoFile&, const node::SnapshotMetadata&)â:\r\nvalidation.cpp:5103:14: warning: catching polymorphic type âstruct StopHashingExceptionâ by value [-Wcatch-value=]\r\n 5103 |     } catch (StopHashingException) {\r\n      |    \r\n```",
      "commit_id" : "50909f0d5dc3a8f15c25ebab756b9a723e2deed3",
      "created_at" : "2022-10-17T20:33:24Z",
      "diff_hunk" : "@@ -5043,13 +5089,18 @@ bool ChainstateManager::PopulateAndValidateSnapshot(\n \n     assert(coins_cache.GetBestBlock() == base_blockhash);\n \n-    auto breakpoint_fnc = [] { /* TODO insert breakpoint here? */ };\n-\n     // As above, okay to immediately release cs_main here since no other context knows\n     // about the snapshot_chainstate.\n     CCoinsViewDB* snapshot_coinsdb = WITH_LOCK(::cs_main, return &snapshot_chainstate.CoinsDB());\n \n-    const std::optional<CCoinsStats> maybe_stats = ComputeUTXOStats(CoinStatsHashType::HASH_SERIALIZED, snapshot_coinsdb, m_blockman, breakpoint_fnc);\n+    std::optional<CCoinsStats> maybe_stats;\n+\n+    try {\n+        maybe_stats = ComputeUTXOStats(\n+            CoinStatsHashType::HASH_SERIALIZED, snapshot_coinsdb, m_blockman, SnapshotUTXOHashBreakpoint);\n+    } catch (StopHashingException) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r997485284",
      "id" : 997485284,
      "line" : 5103,
      "node_id" : "PRRC_kwDOABII5847dGrk",
      "original_commit_id" : "a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc",
      "original_line" : 5101,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 97,
      "pull_request_review_id" : 1144767699,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997485284/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-17T20:53:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997485284",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998027021"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998027021"
         }
      },
      "author_association" : "MEMBER",
      "body" : "f7179525b5cb37f010d5e42f41650414e648bf45: can be made const\r\n```diff\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\nindex a6bc06201..eb0799b15 100644\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -5439,16 +5439,16 @@ void Chainstate::InvalidateCoinsDBOnDisk()\r\n     }\r\n }\r\n \r\n-CBlockIndex* ChainstateManager::GetSnapshotBaseBlock()\r\n+const CBlockIndex* ChainstateManager::GetSnapshotBaseBlock() const\r\n {\r\n     auto blockhash_op = this->SnapshotBlockhash();\r\n     if (!blockhash_op) return nullptr;\r\n     return Assert(m_blockman.LookupBlockIndex(*blockhash_op));\r\n }\r\n \r\n-std::optional<int> ChainstateManager::GetSnapshotBaseHeight()\r\n+std::optional<int> ChainstateManager::GetSnapshotBaseHeight() const\r\n {\r\n-    CBlockIndex* base = this->GetSnapshotBaseBlock();\r\n+    const CBlockIndex* base = this->GetSnapshotBaseBlock();\r\n     return base ? std::make_optional(base->nHeight) : std::nullopt;\r\n }\r\n \r\ndiff --git a/src/validation.h b/src/validation.h\r\nindex d435d76b4..7b3498d55 100644\r\n--- a/src/validation.h\r\n+++ b/src/validation.h\r\n@@ -908,11 +908,11 @@ private:\r\n     std::chrono::time_point<std::chrono::steady_clock> m_last_presync_update GUARDED_BY(::cs_main) {};\r\n \r\n     //! Returns nullptr if no snapshot has been loaded.\r\n-    CBlockIndex* GetSnapshotBaseBlock() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\r\n+    const CBlockIndex* GetSnapshotBaseBlock() const EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\r\n \r\n     //! Return the height of the base block of the snapshot in use, if one exists, else\r\n     //! nullopt.\r\n-    std::optional<int> GetSnapshotBaseHeight() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\r\n+    std::optional<int> GetSnapshotBaseHeight() const EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\r\n \r\n     //! Return true if a chainstate is considered usable.\r\n     //!\r\n```",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-18T10:33:07Z",
      "diff_hunk" : "@@ -5211,3 +5211,16 @@ Chainstate& ChainstateManager::ActivateExistingSnapshot(CTxMemPool* mempool, uin\n     m_active_chainstate = m_snapshot_chainstate.get();\n     return *m_snapshot_chainstate;\n }\n+\n+CBlockIndex* ChainstateManager::GetSnapshotBaseBlock()\n+{\n+    auto blockhash_op = this->SnapshotBlockhash();\n+    if (!blockhash_op) return nullptr;\n+    return Assert(m_blockman.LookupBlockIndex(*blockhash_op));\n+}\n+\n+std::optional<int> ChainstateManager::GetSnapshotBaseHeight()\n+{\n+    CBlockIndex* base = this->GetSnapshotBaseBlock();\n+    return base ? std::make_optional(base->nHeight) : std::nullopt;\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998027021",
      "id" : 998027021,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847fK8N",
      "original_commit_id" : "f7179525b5cb37f010d5e42f41650414e648bf45",
      "original_line" : 5459,
      "original_position" : 16,
      "original_start_line" : 5215,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1145532345,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998027021/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-18T12:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998027021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998050396"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998050396"
         }
      },
      "author_association" : "MEMBER",
      "body" : "062c8883da2f32e9b58bb846d37b911f4ac365db\r\nI think it's clearer.\r\n```suggestion\r\n    bool m_disabled GUARDED_BY(::cs_main) {false};\r\n```",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-18T10:58:17Z",
      "diff_hunk" : "@@ -470,6 +470,13 @@ class Chainstate\n     //! Manages the UTXO set, which is a reflection of the contents of `m_chain`.\n     std::unique_ptr<CoinsViews> m_coins_views;\n \n+    //! This toggle exists for use when doing background validation for UTXO\n+    //! snapshots. It is set once the background validation chain reaches the\n+    //! same height as the base of the snapshot, and signals that we should no\n+    //! longer connect blocks to the background chainstate. It may also be set\n+    //! for snapshot chainstates found to be invalid.\n+    bool m_stop_use GUARDED_BY(::cs_main) {false};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998050396",
      "id" : 998050396,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847fQpc",
      "original_commit_id" : "062c8883da2f32e9b58bb846d37b911f4ac365db",
      "original_line" : 478,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 1145532345,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998050396/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T12:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998050396",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998054962"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998054962"
         }
      },
      "author_association" : "MEMBER",
      "body" : "236ae38274669ce9fd4dcd2a85ab2c373226457f\r\n```suggestion\r\n    bool HasCoinsViews() const { return m_coins_views != nullptr; }\r\n```",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-18T11:03:21Z",
      "diff_hunk" : "@@ -570,12 +570,14 @@ class Chainstate\n     CCoinsViewErrorCatcher& CoinsErrorCatcher() EXCLUSIVE_LOCKS_REQUIRED(::cs_main)\n     {\n         AssertLockHeld(::cs_main);\n-        return m_coins_views->m_catcherview;\n+        return Assert(m_coins_views)->m_catcherview;\n     }\n \n     //! Destructs all objects related to accessing the UTXO set.\n     void ResetCoinsViews() { m_coins_views.reset(); }\n \n+    bool HasCoinsViews() { return (bool)m_coins_views; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998054962",
      "id" : 998054962,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847fRwy",
      "original_commit_id" : "236ae38274669ce9fd4dcd2a85ab2c373226457f",
      "original_line" : 580,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 1145532345,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998054962/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T12:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998054962",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998087278"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998087278"
         }
      },
      "author_association" : "MEMBER",
      "body" : "a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc\r\n```suggestion\r\n```",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-18T11:34:16Z",
      "diff_hunk" : "@@ -25,16 +25,52 @@\n #include <vector>\n \n namespace node {\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998087278",
      "id" : 998087278,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847fZpu",
      "original_commit_id" : "a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc",
      "original_line" : 28,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/node/chainstate.cpp",
      "position" : null,
      "pull_request_review_id" : 1145532345,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998087278/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T12:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998087278",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998094634"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998094634"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc\r\n```suggestion\r\n        return {ChainstateLoadStatus::FAILURE, _(\"You need to rebuild the database using -reindex to go back to unpruned mode. This will redownload the entire blockchain\")};\r\n```",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-18T11:42:09Z",
      "diff_hunk" : "@@ -25,16 +25,52 @@\n #include <vector>\n \n namespace node {\n+\n // Complete initialization of chainstates after the initial call has been made\n // to ChainstateManager::InitializeChainstate().\n static ChainstateLoadResult CompleteChainstateInitialization(\n     ChainstateManager& chainman,\n     const ChainstateLoadOptions& options) EXCLUSIVE_LOCKS_REQUIRED(::cs_main)\n {\n+    if (options.check_interrupt && options.check_interrupt()) return {ChainstateLoadStatus::INTERRUPTED, {}};\n+\n+    // LoadBlockIndex will load m_have_pruned if we've ever removed a\n+    // block file from disk.\n+    // Note that it also sets fReindex global based on the disk flag!\n+    // From here on, fReindex and options.reindex values may be different!\n+    if (!chainman.LoadBlockIndex()) {\n+        if (options.check_interrupt && options.check_interrupt()) return {ChainstateLoadStatus::INTERRUPTED, {}};\n+        return {ChainstateLoadStatus::FAILURE, _(\"Error loading block database\")};\n+    }\n+\n+    // Check for changed -prune state.  What we are concerned about is a user who has pruned blocks\n+    // in the past, but is now trying to run unpruned.\n+    if (chainman.m_blockman.m_have_pruned && !options.prune) {\n+        return {ChainstateLoadStatus::FAILURE, _(\"You need to rebuild the database using -reindex to go back to unpruned mode.  This will redownload the entire blockchain\")};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998094634",
      "id" : 998094634,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847fbcq",
      "original_commit_id" : "a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc",
      "original_line" : 49,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/node/chainstate.cpp",
      "position" : null,
      "pull_request_review_id" : 1145532345,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998094634/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T12:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998094634",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998102475"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998102475"
         }
      },
      "author_association" : "MEMBER",
      "body" : "a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc\r\n```suggestion\r\n        assert(chainman.GetAll().empty());\r\n```",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-18T11:50:30Z",
      "diff_hunk" : "@@ -141,41 +177,46 @@ ChainstateLoadResult LoadChainstate(ChainstateManager& chainman, const CacheSize\n         }\n     }\n \n-    if (options.check_interrupt && options.check_interrupt()) return {ChainstateLoadStatus::INTERRUPTED, {}};\n-\n-    // LoadBlockIndex will load m_have_pruned if we've ever removed a\n-    // block file from disk.\n-    // Note that it also sets fReindex global based on the disk flag!\n-    // From here on, fReindex and options.reindex values may be different!\n-    if (!chainman.LoadBlockIndex()) {\n-        if (options.check_interrupt && options.check_interrupt()) return {ChainstateLoadStatus::INTERRUPTED, {}};\n-        return {ChainstateLoadStatus::FAILURE, _(\"Error loading block database\")};\n+    auto [init_status, init_error] = CompleteChainstateInitialization(chainman, options);\n+    if (init_status != ChainstateLoadStatus::SUCCESS) {\n+        return {init_status, init_error};\n     }\n \n-    if (!chainman.BlockIndex().empty() &&\n-            !chainman.m_blockman.LookupBlockIndex(chainman.GetConsensus().hashGenesisBlock)) {\n-        // If the loaded chain has a wrong genesis, bail out immediately\n-        // (we're likely using a testnet datadir, or the other way around).\n-        return {ChainstateLoadStatus::FAILURE_INCOMPATIBLE_DB, _(\"Incorrect or no genesis block found. Wrong datadir for network?\")};\n-    }\n+    // If a snapshot chainstate was fully validated by a background chainstate during\n+    // the last run, detect it here and clean up the now-unneeded background\n+    // chainstate. This is the expected case during snapshot completion, and\n+    // not just a belt-and-suspenders.\n+    auto snapshot_completion = chainman.MaybeCompleteSnapshotValidation();\n+\n+    if (snapshot_completion == SnapshotCompletionResult::SKIPPED) {\n+        // do nothing; expected case\n+    } else if (snapshot_completion == SnapshotCompletionResult::SUCCESS) {\n+        LogPrintf(\"[snapshot] cleaning up unneeded background chainstate, then reinitializing\\n\");\n+        if (!chainman.ValidatedSnapshotCleanup()) {\n+            AbortNode(\"Background chainstate cleanup failed unexpectedly.\");\n+        }\n \n-    // Check for changed -prune state.  What we are concerned about is a user who has pruned blocks\n-    // in the past, but is now trying to run unpruned.\n-    if (chainman.m_blockman.m_have_pruned && !options.prune) {\n-        return {ChainstateLoadStatus::FAILURE, _(\"You need to rebuild the database using -reindex to go back to unpruned mode.  This will redownload the entire blockchain\")};\n-    }\n+        // Because ValidatedSnapshotCleanup() has torn down chainstates with\n+        // ChainstateManager::ResetChainstates(), reinitialize them here without\n+        // duplicating the blockindex work above.\n+        assert(chainman.GetAll().size() == 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998102475",
      "id" : 998102475,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847fdXL",
      "original_commit_id" : "a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc",
      "original_line" : 202,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "src/node/chainstate.cpp",
      "position" : null,
      "pull_request_review_id" : 1145532345,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998102475/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T12:58:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998102475",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998124561"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998124561"
         }
      },
      "author_association" : "MEMBER",
      "body" : "a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc: maybe `Assert` first?",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-18T12:12:46Z",
      "diff_hunk" : "@@ -5117,6 +5168,146 @@ bool ChainstateManager::PopulateAndValidateSnapshot(\n     return true;\n }\n \n+// Currently, this function holds cs_main for its duration, which could be for\n+// multiple minutes due to the GetUTXOStats call. This hold is necessary\n+// because we need to avoid advancing the background validation chainstate\n+// farther than the snapshot base block - and this function is also invoked\n+// from within ConnectTip, i.e. from within ActivateBestChain, so cs_main is\n+// held anyway.\n+//\n+// Eventually (TODO), we could somehow separate this function's runtime from\n+// maintenance of the active chain, but that will either require\n+//\n+//  (i) setting `m_stop_use` immediately and ensuring all chainstate accesses go\n+//      through IsUsable() checks, or\n+//\n+//  (ii) giving each chainstate its own lock instead of using cs_main for everything.\n+SnapshotCompletionResult ChainstateManager::MaybeCompleteSnapshotValidation(\n+      std::function<void(bilingual_str)> shutdown_fnc)\n+{\n+    AssertLockHeld(cs_main);\n+    if (m_ibd_chainstate.get() == &this->ActiveChainstate() ||\n+            !this->IsUsable(m_snapshot_chainstate.get()) ||\n+            !this->IsUsable(m_ibd_chainstate.get()) ||\n+            !m_ibd_chainstate->m_chain.Tip()) {\n+       // Nothing to do - this function only applies to the background\n+       // validation chainstate.\n+       return SnapshotCompletionResult::SKIPPED;\n+    }\n+    int snapshot_tip_height = this->ActiveHeight();\n+    int snapshot_base_height = *this->GetSnapshotBaseHeight();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998124561",
      "id" : 998124561,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847fiwR",
      "original_commit_id" : "a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc",
      "original_line" : 5198,
      "original_position" : 134,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1145532345,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998124561/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T12:58:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998124561",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998125501"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998125501"
         }
      },
      "author_association" : "MEMBER",
      "body" : "a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc: `Assert` here as well and can be const",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-18T12:13:43Z",
      "diff_hunk" : "@@ -5117,6 +5168,146 @@ bool ChainstateManager::PopulateAndValidateSnapshot(\n     return true;\n }\n \n+// Currently, this function holds cs_main for its duration, which could be for\n+// multiple minutes due to the GetUTXOStats call. This hold is necessary\n+// because we need to avoid advancing the background validation chainstate\n+// farther than the snapshot base block - and this function is also invoked\n+// from within ConnectTip, i.e. from within ActivateBestChain, so cs_main is\n+// held anyway.\n+//\n+// Eventually (TODO), we could somehow separate this function's runtime from\n+// maintenance of the active chain, but that will either require\n+//\n+//  (i) setting `m_stop_use` immediately and ensuring all chainstate accesses go\n+//      through IsUsable() checks, or\n+//\n+//  (ii) giving each chainstate its own lock instead of using cs_main for everything.\n+SnapshotCompletionResult ChainstateManager::MaybeCompleteSnapshotValidation(\n+      std::function<void(bilingual_str)> shutdown_fnc)\n+{\n+    AssertLockHeld(cs_main);\n+    if (m_ibd_chainstate.get() == &this->ActiveChainstate() ||\n+            !this->IsUsable(m_snapshot_chainstate.get()) ||\n+            !this->IsUsable(m_ibd_chainstate.get()) ||\n+            !m_ibd_chainstate->m_chain.Tip()) {\n+       // Nothing to do - this function only applies to the background\n+       // validation chainstate.\n+       return SnapshotCompletionResult::SKIPPED;\n+    }\n+    int snapshot_tip_height = this->ActiveHeight();\n+    int snapshot_base_height = *this->GetSnapshotBaseHeight();\n+    CBlockIndex& index_new = *m_ibd_chainstate->m_chain.Tip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998125501",
      "id" : 998125501,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847fi-9",
      "original_commit_id" : "a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc",
      "original_line" : 5199,
      "original_position" : 135,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1145532345,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998125501/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T12:58:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998125501",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998126326"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998126326"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc: can be inlined\r\n```suggestion\r\n\tuint256 snapshot_blockhash{*Assert(SnapshotBlockhash())};",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-18T12:14:33Z",
      "diff_hunk" : "@@ -5117,6 +5168,146 @@ bool ChainstateManager::PopulateAndValidateSnapshot(\n     return true;\n }\n \n+// Currently, this function holds cs_main for its duration, which could be for\n+// multiple minutes due to the GetUTXOStats call. This hold is necessary\n+// because we need to avoid advancing the background validation chainstate\n+// farther than the snapshot base block - and this function is also invoked\n+// from within ConnectTip, i.e. from within ActivateBestChain, so cs_main is\n+// held anyway.\n+//\n+// Eventually (TODO), we could somehow separate this function's runtime from\n+// maintenance of the active chain, but that will either require\n+//\n+//  (i) setting `m_stop_use` immediately and ensuring all chainstate accesses go\n+//      through IsUsable() checks, or\n+//\n+//  (ii) giving each chainstate its own lock instead of using cs_main for everything.\n+SnapshotCompletionResult ChainstateManager::MaybeCompleteSnapshotValidation(\n+      std::function<void(bilingual_str)> shutdown_fnc)\n+{\n+    AssertLockHeld(cs_main);\n+    if (m_ibd_chainstate.get() == &this->ActiveChainstate() ||\n+            !this->IsUsable(m_snapshot_chainstate.get()) ||\n+            !this->IsUsable(m_ibd_chainstate.get()) ||\n+            !m_ibd_chainstate->m_chain.Tip()) {\n+       // Nothing to do - this function only applies to the background\n+       // validation chainstate.\n+       return SnapshotCompletionResult::SKIPPED;\n+    }\n+    int snapshot_tip_height = this->ActiveHeight();\n+    int snapshot_base_height = *this->GetSnapshotBaseHeight();\n+    CBlockIndex& index_new = *m_ibd_chainstate->m_chain.Tip();\n+\n+    if (index_new.nHeight < snapshot_base_height) {\n+        // Background IBD not complete yet.\n+        return SnapshotCompletionResult::SKIPPED;\n+    }\n+\n+    assert(SnapshotBlockhash());\n+    uint256 snapshot_blockhash = *SnapshotBlockhash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998126326",
      "id" : 998126326,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847fjL2",
      "original_commit_id" : "a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc",
      "original_line" : 5207,
      "original_position" : 143,
      "original_start_line" : 5206,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1145532345,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998126326/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-18T12:58:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998126326",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998169857"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998169857"
         }
      },
      "author_association" : "MEMBER",
      "body" : "a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc\r\n```suggestion\r\n    const auto& ibd_stats = *maybe_ibd_stats;\r\n```",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-18T12:52:44Z",
      "diff_hunk" : "@@ -5121,6 +5170,146 @@ bool ChainstateManager::PopulateAndValidateSnapshot(\n     return true;\n }\n \n+// Currently, this function holds cs_main for its duration, which could be for\n+// multiple minutes due to the GetUTXOStats call. This hold is necessary\n+// because we need to avoid advancing the background validation chainstate\n+// farther than the snapshot base block - and this function is also invoked\n+// from within ConnectTip, i.e. from within ActivateBestChain, so cs_main is\n+// held anyway.\n+//\n+// Eventually (TODO), we could somehow separate this function's runtime from\n+// maintenance of the active chain, but that will either require\n+//\n+//  (i) setting `m_stop_use` immediately and ensuring all chainstate accesses go\n+//      through IsUsable() checks, or\n+//\n+//  (ii) giving each chainstate its own lock instead of using cs_main for everything.\n+SnapshotCompletionResult ChainstateManager::MaybeCompleteSnapshotValidation(\n+      std::function<void(bilingual_str)> shutdown_fnc)\n+{\n+    AssertLockHeld(cs_main);\n+    if (m_ibd_chainstate.get() == &this->ActiveChainstate() ||\n+            !this->IsUsable(m_snapshot_chainstate.get()) ||\n+            !this->IsUsable(m_ibd_chainstate.get()) ||\n+            !m_ibd_chainstate->m_chain.Tip()) {\n+       // Nothing to do - this function only applies to the background\n+       // validation chainstate.\n+       return SnapshotCompletionResult::SKIPPED;\n+    }\n+    int snapshot_tip_height = this->ActiveHeight();\n+    int snapshot_base_height = *this->GetSnapshotBaseHeight();\n+    CBlockIndex& index_new = *m_ibd_chainstate->m_chain.Tip();\n+\n+    if (index_new.nHeight < snapshot_base_height) {\n+        // Background IBD not complete yet.\n+        return SnapshotCompletionResult::SKIPPED;\n+    }\n+\n+    assert(SnapshotBlockhash());\n+    uint256 snapshot_blockhash = *SnapshotBlockhash();\n+\n+    if (index_new.GetBlockHash() != snapshot_blockhash) {\n+      LogPrintf(\"[snapshot] supposed base block %s does not match the \" /* Continued */\n+          \"snapshot base block %s (height %d). Snapshot is not valid.\",\n+          index_new.ToString(), snapshot_blockhash.ToString(), snapshot_base_height);\n+       return SnapshotCompletionResult::BASE_BLOCKHASH_MISMATCH;\n+    }\n+\n+    assert(index_new.nHeight == snapshot_base_height);\n+\n+    auto handle_invalid_snapshot = [&]() EXCLUSIVE_LOCKS_REQUIRED(::cs_main) {\n+        bilingual_str user_error = strprintf(_(\n+            \"%s failed to validate the -assumeutxo snapshot state. \"\n+            \"This indicates a hardware problem, or a bug in the software, or a \"\n+            \"bad software modification that allowed an invalid snapshot to be \"\n+            \"loaded. As a result of this, the node will shut down and stop using any \"\n+            \"state that was built on the snapshot, resetting the chain height \"\n+            \"from %d to %d. On the next \"\n+            \"restart, the node will resume syncing from %d \"\n+            \"without using any snapshot data. \"\n+            \"Please report this incident to %s, including how you obtained the snapshot.\"),\n+            PACKAGE_NAME, snapshot_tip_height, snapshot_base_height, snapshot_base_height, PACKAGE_BUGREPORT\n+        );\n+\n+        LogPrintf(\"[snapshot] !!! %s\\n\", user_error.original);\n+        LogPrintf(\"[snapshot] deleting snapshot, reverting to validated chain, and stopping node\\n\");\n+\n+        m_active_chainstate = m_ibd_chainstate.get();\n+        m_snapshot_chainstate->m_stop_use = true;\n+        assert(!this->IsUsable(m_snapshot_chainstate.get()));\n+        assert(this->IsUsable(m_ibd_chainstate.get()));\n+\n+        m_snapshot_chainstate->InvalidateCoinsDBOnDisk();\n+\n+        shutdown_fnc(user_error);\n+    };\n+\n+    int curr_height = m_ibd_chainstate->m_chain.Height();\n+\n+    assert(snapshot_base_height == curr_height);\n+    assert(snapshot_base_height == index_new.nHeight);\n+    assert(this->IsUsable(m_snapshot_chainstate.get()));\n+    assert(this->GetAll().size() == 2);\n+\n+    CCoinsViewDB& ibd_coins_db = m_ibd_chainstate->CoinsDB();\n+    m_ibd_chainstate->ForceFlushStateToDisk();\n+\n+    auto maybe_au_data = ExpectedAssumeutxo(curr_height, ::Params());\n+    if (!maybe_au_data) {\n+        LogPrintf(\"[snapshot] assumeutxo data not found for height \" /* Continued */\n+            \"(%d) - refusing to validate snapshot\\n\", curr_height);\n+        handle_invalid_snapshot();\n+        return SnapshotCompletionResult::MISSING_CHAINPARAMS;\n+    }\n+\n+    const AssumeutxoData& au_data = *maybe_au_data;\n+    std::optional<CCoinsStats> maybe_ibd_stats;\n+    LogPrintf(\"[snapshot] computing UTXO stats for background chainstate to validate \" /* Continued */\n+        \"snapshot - this could take a few minutes\\n\");\n+    try {\n+        maybe_ibd_stats = ComputeUTXOStats(\n+            CoinStatsHashType::HASH_SERIALIZED,\n+            &ibd_coins_db,\n+            m_blockman,\n+            SnapshotUTXOHashBreakpoint);\n+    } catch (StopHashingException) {\n+        return SnapshotCompletionResult::STATS_FAILED;\n+    }\n+\n+    // XXX note that this function is slow and will hold cs_main for potentially minutes.\n+    if (!maybe_ibd_stats) {\n+        LogPrintf(\"[snapshot] failed to generate stats for validation coins db\\n\");\n+        // While this isn't a problem with the snapshot per se, this condition\n+        // prevents us from validating the snapshot, so we should shut down and let the\n+        // user handle the issue manually.\n+        handle_invalid_snapshot();\n+        return SnapshotCompletionResult::STATS_FAILED;\n+    }\n+    const auto ibd_stats = *maybe_ibd_stats;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998169857",
      "id" : 998169857,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847ft0B",
      "original_commit_id" : "50909f0d5dc3a8f15c25ebab756b9a723e2deed3",
      "original_line" : 5288,
      "original_position" : 246,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1145532345,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998169857/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T12:58:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998169857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998170906"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998170906"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc\r\n```suggestion\r\n    const auto& snapshot_chainstate_path = *snapshot_chainstate_path_maybe;\r\n    const auto& ibd_chainstate_path = *ibd_chainstate_path_maybe;\r\n```",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-18T12:53:28Z",
      "diff_hunk" : "@@ -5211,3 +5405,136 @@ Chainstate& ChainstateManager::ActivateExistingSnapshot(CTxMemPool* mempool, uin\n     m_active_chainstate = m_snapshot_chainstate.get();\n     return *m_snapshot_chainstate;\n }\n+\n+void Chainstate::InvalidateCoinsDBOnDisk()\n+{\n+    AssertLockHeld(::cs_main);\n+    // Should never be called on a non-snapshot chainstate.\n+    assert(m_from_snapshot_blockhash);\n+    auto storage_path_maybe = this->CoinsDB().StoragePath();\n+    // Should never be called with a non-existent storage path.\n+    assert(storage_path_maybe);\n+    fs::path snapshot_datadir = *storage_path_maybe;\n+\n+    // Coins views no longer usable.\n+    m_coins_views.reset();\n+\n+    auto invalid_path = snapshot_datadir + \"_INVALID\";\n+    std::string dbpath = fs::PathToString(snapshot_datadir);\n+    std::string target = fs::PathToString(invalid_path);\n+    LogPrintf(\"[snapshot] renaming snapshot datadir %s to %s\\n\", dbpath, target);\n+\n+    try {\n+        fs::rename(snapshot_datadir, invalid_path);\n+    } catch (const fs::filesystem_error& e) {\n+        auto src_str = fs::PathToString(snapshot_datadir);\n+        auto dest_str = fs::PathToString(invalid_path);\n+\n+        LogPrintf(\"%s: error renaming file '%s' -> '%s': %s\\n\",\n+                __func__, src_str, dest_str, e.what());\n+        AbortNode(strprintf(\n+            \"Rename of '%s' -> '%s' failed. \"\n+            \"Do not restart until manually moving or deleting invalid snapshot directory %s.\",\n+            src_str, dest_str, src_str));\n+    }\n+}\n+\n+CBlockIndex* ChainstateManager::GetSnapshotBaseBlock()\n+{\n+    auto blockhash_op = this->SnapshotBlockhash();\n+    if (!blockhash_op) return nullptr;\n+    return Assert(m_blockman.LookupBlockIndex(*blockhash_op));\n+}\n+\n+std::optional<int> ChainstateManager::GetSnapshotBaseHeight()\n+{\n+    CBlockIndex* base = this->GetSnapshotBaseBlock();\n+    return base ? std::make_optional(base->nHeight) : std::nullopt;\n+}\n+\n+bool ChainstateManager::ValidatedSnapshotCleanup()\n+{\n+    AssertLockHeld(::cs_main);\n+    auto get_storage_path = [](auto& chainstate) EXCLUSIVE_LOCKS_REQUIRED(::cs_main) -> std::optional<fs::path> {\n+        if (!(chainstate && chainstate->HasCoinsViews())) {\n+            return {};\n+        }\n+        return chainstate->CoinsDB().StoragePath();\n+    };\n+    std::optional<fs::path> ibd_chainstate_path_maybe = get_storage_path(m_ibd_chainstate);\n+    std::optional<fs::path> snapshot_chainstate_path_maybe = get_storage_path(m_snapshot_chainstate);\n+\n+    if (!this->IsSnapshotValidated()) {\n+        // No need to clean up.\n+        return false;\n+    }\n+    // If either path doesn't exist, that means at least one of the chainstates\n+    // is in-memory, in which case we can't do on-disk cleanup. You'd better be\n+    // in a unittest!\n+    if (!ibd_chainstate_path_maybe || !snapshot_chainstate_path_maybe) {\n+        LogPrintf(\"[snapshot] snapshot chainstate cleanup cannot happen with \" /* Continued */\n+                  \"in-memory chainstates. You are testing, right?\\n\");\n+        return false;\n+    }\n+\n+    auto snapshot_chainstate_path = *snapshot_chainstate_path_maybe;\n+    auto ibd_chainstate_path = *ibd_chainstate_path_maybe;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r998170906",
      "id" : 998170906,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847fuEa",
      "original_commit_id" : "50909f0d5dc3a8f15c25ebab756b9a723e2deed3",
      "original_line" : 5481,
      "original_position" : 377,
      "original_start_line" : 5480,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1145532345,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998170906/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-18T12:58:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998170906",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999448628"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999448628"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since unique_ptr has well-defined semantics for the bool operator, I'm going to leave this as is.",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-19T13:28:24Z",
      "diff_hunk" : "@@ -570,12 +570,14 @@ class Chainstate\n     CCoinsViewErrorCatcher& CoinsErrorCatcher() EXCLUSIVE_LOCKS_REQUIRED(::cs_main)\n     {\n         AssertLockHeld(::cs_main);\n-        return m_coins_views->m_catcherview;\n+        return Assert(m_coins_views)->m_catcherview;\n     }\n \n     //! Destructs all objects related to accessing the UTXO set.\n     void ResetCoinsViews() { m_coins_views.reset(); }\n \n+    bool HasCoinsViews() { return (bool)m_coins_views; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999448628",
      "id" : 999448628,
      "in_reply_to_id" : 998054962,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847kmA0",
      "original_commit_id" : "236ae38274669ce9fd4dcd2a85ab2c373226457f",
      "original_line" : 580,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 1147566419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999448628/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-19T14:38:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999448628",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999530645"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999530645"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed, thanks.",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-19T14:23:19Z",
      "diff_hunk" : "@@ -5043,13 +5089,18 @@ bool ChainstateManager::PopulateAndValidateSnapshot(\n \n     assert(coins_cache.GetBestBlock() == base_blockhash);\n \n-    auto breakpoint_fnc = [] { /* TODO insert breakpoint here? */ };\n-\n     // As above, okay to immediately release cs_main here since no other context knows\n     // about the snapshot_chainstate.\n     CCoinsViewDB* snapshot_coinsdb = WITH_LOCK(::cs_main, return &snapshot_chainstate.CoinsDB());\n \n-    const std::optional<CCoinsStats> maybe_stats = ComputeUTXOStats(CoinStatsHashType::HASH_SERIALIZED, snapshot_coinsdb, m_blockman, breakpoint_fnc);\n+    std::optional<CCoinsStats> maybe_stats;\n+\n+    try {\n+        maybe_stats = ComputeUTXOStats(\n+            CoinStatsHashType::HASH_SERIALIZED, snapshot_coinsdb, m_blockman, SnapshotUTXOHashBreakpoint);\n+    } catch (StopHashingException) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999530645",
      "id" : 999530645,
      "in_reply_to_id" : 997485284,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847k6CV",
      "original_commit_id" : "a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc",
      "original_line" : 5101,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1147566419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999530645/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-19T14:38:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999530645",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999535407"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999535407"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good catch! Fixed.",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-19T14:26:48Z",
      "diff_hunk" : "@@ -5117,6 +5168,146 @@ bool ChainstateManager::PopulateAndValidateSnapshot(\n     return true;\n }\n \n+// Currently, this function holds cs_main for its duration, which could be for\n+// multiple minutes due to the GetUTXOStats call. This hold is necessary\n+// because we need to avoid advancing the background validation chainstate\n+// farther than the snapshot base block - and this function is also invoked\n+// from within ConnectTip, i.e. from within ActivateBestChain, so cs_main is\n+// held anyway.\n+//\n+// Eventually (TODO), we could somehow separate this function's runtime from\n+// maintenance of the active chain, but that will either require\n+//\n+//  (i) setting `m_stop_use` immediately and ensuring all chainstate accesses go\n+//      through IsUsable() checks, or\n+//\n+//  (ii) giving each chainstate its own lock instead of using cs_main for everything.\n+SnapshotCompletionResult ChainstateManager::MaybeCompleteSnapshotValidation(\n+      std::function<void(bilingual_str)> shutdown_fnc)\n+{\n+    AssertLockHeld(cs_main);\n+    if (m_ibd_chainstate.get() == &this->ActiveChainstate() ||\n+            !this->IsUsable(m_snapshot_chainstate.get()) ||\n+            !this->IsUsable(m_ibd_chainstate.get()) ||\n+            !m_ibd_chainstate->m_chain.Tip()) {\n+       // Nothing to do - this function only applies to the background\n+       // validation chainstate.\n+       return SnapshotCompletionResult::SKIPPED;\n+    }\n+    int snapshot_tip_height = this->ActiveHeight();\n+    int snapshot_base_height = *this->GetSnapshotBaseHeight();\n+    CBlockIndex& index_new = *m_ibd_chainstate->m_chain.Tip();\n+\n+    if (index_new.nHeight < snapshot_base_height) {\n+        // Background IBD not complete yet.\n+        return SnapshotCompletionResult::SKIPPED;\n+    }\n+\n+    assert(SnapshotBlockhash());\n+    uint256 snapshot_blockhash = *SnapshotBlockhash();\n+\n+    if (index_new.GetBlockHash() != snapshot_blockhash) {\n+      LogPrintf(\"[snapshot] supposed base block %s does not match the \" /* Continued */\n+          \"snapshot base block %s (height %d). Snapshot is not valid.\",\n+          index_new.ToString(), snapshot_blockhash.ToString(), snapshot_base_height);\n+       return SnapshotCompletionResult::BASE_BLOCKHASH_MISMATCH;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999535407",
      "id" : 999535407,
      "in_reply_to_id" : 997479271,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847k7Mv",
      "original_commit_id" : "a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc",
      "original_line" : 5214,
      "original_position" : 150,
      "original_start_line" : 5209,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1147566419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999535407/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-19T14:38:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999535407",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999539875"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999539875"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think the idea is that we may want to preserve the bad snapshot datadir for later analysis or issue filing. I'll make a note in the abort node log message that the user can manually remove the directory if desired or save it for later forensics when filing an issue.",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-19T14:29:31Z",
      "diff_hunk" : "@@ -5213,6 +5404,39 @@ Chainstate& ChainstateManager::ActivateExistingSnapshot(CTxMemPool* mempool, uin\n     return *m_snapshot_chainstate;\n }\n \n+void Chainstate::InvalidateCoinsDBOnDisk()\n+{\n+    AssertLockHeld(::cs_main);\n+    // Should never be called on a non-snapshot chainstate.\n+    assert(m_from_snapshot_blockhash);\n+    auto storage_path_maybe = this->CoinsDB().StoragePath();\n+    // Should never be called with a non-existent storage path.\n+    assert(storage_path_maybe);\n+    fs::path snapshot_datadir = *storage_path_maybe;\n+\n+    // Coins views no longer usable.\n+    m_coins_views.reset();\n+\n+    auto invalid_path = snapshot_datadir + \"_INVALID\";\n+    std::string dbpath = fs::PathToString(snapshot_datadir);\n+    std::string target = fs::PathToString(invalid_path);\n+    LogPrintf(\"[snapshot] renaming snapshot datadir %s to %s\\n\", dbpath, target);\n+\n+    try {\n+        fs::rename(snapshot_datadir, invalid_path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999539875",
      "id" : 999539875,
      "in_reply_to_id" : 997480620,
      "line" : 5434,
      "node_id" : "PRRC_kwDOABII5847k8Sj",
      "original_commit_id" : "a65af66bd5a292d0bd0030f0c6b49a3dfab0afcc",
      "original_line" : 5434,
      "original_position" : 273,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 330,
      "pull_request_review_id" : 1147566419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999539875/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-19T14:38:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999539875",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999586196"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999586196"
         }
      },
      "author_association" : "MEMBER",
      "body" : "alright, the function can be made const though",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-19T14:59:45Z",
      "diff_hunk" : "@@ -570,12 +570,14 @@ class Chainstate\n     CCoinsViewErrorCatcher& CoinsErrorCatcher() EXCLUSIVE_LOCKS_REQUIRED(::cs_main)\n     {\n         AssertLockHeld(::cs_main);\n-        return m_coins_views->m_catcherview;\n+        return Assert(m_coins_views)->m_catcherview;\n     }\n \n     //! Destructs all objects related to accessing the UTXO set.\n     void ResetCoinsViews() { m_coins_views.reset(); }\n \n+    bool HasCoinsViews() { return (bool)m_coins_views; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999586196",
      "id" : 999586196,
      "in_reply_to_id" : 998054962,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847lHmU",
      "original_commit_id" : "236ae38274669ce9fd4dcd2a85ab2c373226457f",
      "original_line" : 580,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 1147765130,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999586196/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-19T14:59:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999586196",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999588975"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999588975"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yep, done.",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-19T15:02:01Z",
      "diff_hunk" : "@@ -570,12 +570,14 @@ class Chainstate\n     CCoinsViewErrorCatcher& CoinsErrorCatcher() EXCLUSIVE_LOCKS_REQUIRED(::cs_main)\n     {\n         AssertLockHeld(::cs_main);\n-        return m_coins_views->m_catcherview;\n+        return Assert(m_coins_views)->m_catcherview;\n     }\n \n     //! Destructs all objects related to accessing the UTXO set.\n     void ResetCoinsViews() { m_coins_views.reset(); }\n \n+    bool HasCoinsViews() { return (bool)m_coins_views; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999588975",
      "id" : 999588975,
      "in_reply_to_id" : 998054962,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847lIRv",
      "original_commit_id" : "236ae38274669ce9fd4dcd2a85ab2c373226457f",
      "original_line" : 580,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 1147769381,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999588975/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-19T15:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999588975",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999601495"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999601495"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It hasn't changed :grimacing: ",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-19T15:12:29Z",
      "diff_hunk" : "@@ -570,12 +570,14 @@ class Chainstate\n     CCoinsViewErrorCatcher& CoinsErrorCatcher() EXCLUSIVE_LOCKS_REQUIRED(::cs_main)\n     {\n         AssertLockHeld(::cs_main);\n-        return m_coins_views->m_catcherview;\n+        return Assert(m_coins_views)->m_catcherview;\n     }\n \n     //! Destructs all objects related to accessing the UTXO set.\n     void ResetCoinsViews() { m_coins_views.reset(); }\n \n+    bool HasCoinsViews() { return (bool)m_coins_views; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999601495",
      "id" : 999601495,
      "in_reply_to_id" : 998054962,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847lLVX",
      "original_commit_id" : "236ae38274669ce9fd4dcd2a85ab2c373226457f",
      "original_line" : 580,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 1147788194,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999601495/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-19T15:12:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999601495",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999722362"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999722362"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ugh oops, my mistake. Fixed.",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-19T16:57:34Z",
      "diff_hunk" : "@@ -570,12 +570,14 @@ class Chainstate\n     CCoinsViewErrorCatcher& CoinsErrorCatcher() EXCLUSIVE_LOCKS_REQUIRED(::cs_main)\n     {\n         AssertLockHeld(::cs_main);\n-        return m_coins_views->m_catcherview;\n+        return Assert(m_coins_views)->m_catcherview;\n     }\n \n     //! Destructs all objects related to accessing the UTXO set.\n     void ResetCoinsViews() { m_coins_views.reset(); }\n \n+    bool HasCoinsViews() { return (bool)m_coins_views; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999722362",
      "id" : 999722362,
      "in_reply_to_id" : 998054962,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847lo16",
      "original_commit_id" : "236ae38274669ce9fd4dcd2a85ab2c373226457f",
      "original_line" : 580,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 1147968942,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999722362/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-19T16:57:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999722362",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999975053"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999975053"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think could do a `LookupBlockIndex` to display the block height, as it's more speaking for the node operator.",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-19T22:07:33Z",
      "diff_hunk" : "@@ -167,6 +134,93 @@ ChainstateLoadResult LoadChainstate(ChainstateManager& chainman, const CacheSize\n     return {ChainstateLoadStatus::SUCCESS, {}};\n }\n \n+ChainstateLoadResult LoadChainstate(ChainstateManager& chainman, const CacheSizes& cache_sizes,\n+                                    const ChainstateLoadOptions& options)\n+{\n+    if (!hashAssumeValid.IsNull()) {\n+        LogPrintf(\"Assuming ancestors of block %s have valid signatures.\\n\", hashAssumeValid.GetHex());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999975053",
      "id" : 999975053,
      "line" : 141,
      "node_id" : "PRRC_kwDOABII5847mmiN",
      "original_commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "original_line" : 141,
      "original_position" : 106,
      "original_start_line" : null,
      "path" : "src/node/chainstate.cpp",
      "position" : 106,
      "pull_request_review_id" : 1148330864,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999975053/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-19T22:31:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999975053",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999978823"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999978823"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think you could have a quick log of the chainstate initialization success, as this function has a lot of checks/ops and you can inform the node operator where he is in the initialization sequence.",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-19T22:14:21Z",
      "diff_hunk" : "@@ -167,6 +134,93 @@ ChainstateLoadResult LoadChainstate(ChainstateManager& chainman, const CacheSize\n     return {ChainstateLoadStatus::SUCCESS, {}};\n }\n \n+ChainstateLoadResult LoadChainstate(ChainstateManager& chainman, const CacheSizes& cache_sizes,\n+                                    const ChainstateLoadOptions& options)\n+{\n+    if (!hashAssumeValid.IsNull()) {\n+        LogPrintf(\"Assuming ancestors of block %s have valid signatures.\\n\", hashAssumeValid.GetHex());\n+    } else {\n+        LogPrintf(\"Validating signatures for all blocks.\\n\");\n+    }\n+    LogPrintf(\"Setting nMinimumChainWork=%s\\n\", nMinimumChainWork.GetHex());\n+    if (nMinimumChainWork < UintToArith256(chainman.GetConsensus().nMinimumChainWork)) {\n+        LogPrintf(\"Warning: nMinimumChainWork set below default value of %s\\n\", chainman.GetConsensus().nMinimumChainWork.GetHex());\n+    }\n+    if (nPruneTarget == std::numeric_limits<uint64_t>::max()) {\n+        LogPrintf(\"Block pruning enabled.  Use RPC call pruneblockchain(height) to manually prune block and undo files.\\n\");\n+    } else if (nPruneTarget) {\n+        LogPrintf(\"Prune configured to target %u MiB on disk for block and undo files.\\n\", nPruneTarget / 1024 / 1024);\n+    }\n+\n+    LOCK(cs_main);\n+    chainman.m_total_coinstip_cache = cache_sizes.coins;\n+    chainman.m_total_coinsdb_cache = cache_sizes.coins_db;\n+\n+    // Load the fully validated chainstate.\n+    chainman.InitializeChainstate(options.mempool);\n+\n+    // Load a chain created from a UTXO snapshot, if any exist.\n+    chainman.DetectSnapshotChainstate(options.mempool);\n+\n+    auto& pblocktree{chainman.m_blockman.m_block_tree_db};\n+    // new CBlockTreeDB tries to delete the existing file, which\n+    // fails if it's still open from the previous loop. Close it first:\n+    pblocktree.reset();\n+    pblocktree.reset(new CBlockTreeDB(cache_sizes.block_tree_db, options.block_tree_db_in_memory, options.reindex));\n+\n+    if (options.reindex) {\n+        pblocktree->WriteReindexing(true);\n+        //If we're reindexing in prune mode, wipe away unusable block files and all undo data files\n+        if (options.prune) {\n+            CleanupBlockRevFiles();\n+        }\n+    }\n+\n+    auto [init_status, init_error] = CompleteChainstateInitialization(chainman, options);\n+    if (init_status != ChainstateLoadStatus::SUCCESS) {\n+        return {init_status, init_error};\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999978823",
      "id" : 999978823,
      "line" : 182,
      "node_id" : "PRRC_kwDOABII5847mndH",
      "original_commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "original_line" : 182,
      "original_position" : 147,
      "original_start_line" : null,
      "path" : "src/node/chainstate.cpp",
      "position" : 147,
      "pull_request_review_id" : 1148330864,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999978823/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-19T22:31:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999978823",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999984699"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999984699"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think you could go even further, and invite the node operator to fulfill an issue on the repository or at least indicate a communication process to feedback the bug to us ?",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-19T22:24:57Z",
      "diff_hunk" : "@@ -2973,6 +2985,13 @@ bool Chainstate::ActivateBestChain(BlockValidationState& state, std::shared_ptr<\n     // we use m_chainstate_mutex to enforce mutual exclusion so that only one caller may execute this function at a time\n     LOCK(m_chainstate_mutex);\n \n+    // Belt-and-suspenders check that we aren't attempting to advance the background\n+    // chainstate past the snapshot base block.\n+    if (WITH_LOCK(::cs_main, return m_disabled)) {\n+        LogPrintf(\"m_disabled is set - this chainstate should not be in operation. Bug?.\\n\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r999984699",
      "id" : 999984699,
      "line" : 2991,
      "node_id" : "PRRC_kwDOABII5847mo47",
      "original_commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "original_line" : 2991,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 26,
      "pull_request_review_id" : 1148330864,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999984699/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-19T22:31:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999984699",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-10-26T11:19:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#issuecomment-1291878476",
      "id" : 1291878476,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25740",
      "node_id" : "IC_kwDOABII585NAIBM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291878476/reactions"
      },
      "updated_at" : "2022-10-26T11:19:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291878476",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r1009792671"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009792671"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It looks like there has been a rebase error and two previous commits were combined into one commit that doesn't have a valid commit description. The two previous commits were:\r\n\r\n- \"move-only-ish: init: factor out chainstate initialization\" (aead772a24b1f7759cd756bf6534a70dc41ca080)\r\n- \"validation: add ChainMan logic for completing UTXO snapshot validation\" (863e5f389e08cd2069e4834df82879ec39142aac)\r\n\r\nand the new combined commit is \r\n\r\n - \"move-only-ish: init: factor out chainstate initialization\" (07b9dea9d4e8de2ce22e8ba50172a4af85801931)\r\n\r\nIt would help review to split these up and separate moveonly changes from other changes",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-31T19:38:21Z",
      "diff_hunk" : "@@ -5117,6 +5168,149 @@ bool ChainstateManager::PopulateAndValidateSnapshot(\n     return true;\n }\n \n+// Currently, this function holds cs_main for its duration, which could be for\n+// multiple minutes due to the GetUTXOStats call. This hold is necessary\n+// because we need to avoid advancing the background validation chainstate\n+// farther than the snapshot base block - and this function is also invoked\n+// from within ConnectTip, i.e. from within ActivateBestChain, so cs_main is\n+// held anyway.\n+//\n+// Eventually (TODO), we could somehow separate this function's runtime from\n+// maintenance of the active chain, but that will either require\n+//\n+//  (i) setting `m_disabled` immediately and ensuring all chainstate accesses go\n+//      through IsUsable() checks, or\n+//\n+//  (ii) giving each chainstate its own lock instead of using cs_main for everything.\n+SnapshotCompletionResult ChainstateManager::MaybeCompleteSnapshotValidation(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r1009792671",
      "id" : 1009792671,
      "line" : 5187,
      "node_id" : "PRRC_kwDOABII5848MDaf",
      "original_commit_id" : "07b9dea9d4e8de2ce22e8ba50172a4af85801931",
      "original_line" : 5185,
      "original_position" : 121,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 121,
      "pull_request_review_id" : 1162441236,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009792671/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-31T19:38:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009792671",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r1009927654"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009927654"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Comment could be updated to reflect snapshot validation implied the ibd chainstate is from now disabled. No ulterior blocks should be connected.",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-31T22:33:14Z",
      "diff_hunk" : "@@ -985,7 +997,10 @@ class ChainstateManager\n     std::optional<uint256> SnapshotBlockhash() const;\n \n     //! Is there a snapshot in use and has it been fully validated?",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r1009927654",
      "id" : 1009927654,
      "line" : 1048,
      "node_id" : "PRRC_kwDOABII5848MkXm",
      "original_commit_id" : "1dda5f3f5982c8231b4c122b372e02b9ca7d4994",
      "original_line" : 999,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 44,
      "pull_request_review_id" : 1162638204,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009927654/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-31T23:02:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009927654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r1009936620"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009936620"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Comment is unclear if toggle is setup once \"same-height-of-snapshot' or if it also includes UTXO set hash comparison (`PopulateAndValidateSnapshot()`) ",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-31T22:50:57Z",
      "diff_hunk" : "@@ -470,6 +470,13 @@ class Chainstate\n     //! Manages the UTXO set, which is a reflection of the contents of `m_chain`.\n     std::unique_ptr<CoinsViews> m_coins_views;\n \n+    //! This toggle exists for use when doing background validation for UTXO\n+    //! snapshots. It is set once the background validation chain reaches the\n+    //! same height as the base of the snapshot, and signals that we should no",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r1009936620",
      "id" : 1009936620,
      "line" : 476,
      "node_id" : "PRRC_kwDOABII5848Mmjs",
      "original_commit_id" : "1dda5f3f5982c8231b4c122b372e02b9ca7d4994",
      "original_line" : 475,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 6,
      "pull_request_review_id" : 1162638204,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009936620/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-31T23:02:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009936620",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r1009939365"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009939365"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can get a one line comment. That way reduces confusion for the next contributor on a quest to refactor `validation.h`/`coins.h`, without introducing odds of weird consensus bugs. ",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-10-31T22:56:45Z",
      "diff_hunk" : "@@ -570,12 +570,14 @@ class Chainstate\n     CCoinsViewErrorCatcher& CoinsErrorCatcher() EXCLUSIVE_LOCKS_REQUIRED(::cs_main)\n     {\n         AssertLockHeld(::cs_main);\n-        return m_coins_views->m_catcherview;\n+        return Assert(m_coins_views)->m_catcherview;\n     }\n \n     //! Destructs all objects related to accessing the UTXO set.\n     void ResetCoinsViews() { m_coins_views.reset(); }\n \n+    bool HasCoinsViews() const { return (bool)m_coins_views; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r1009939365",
      "id" : 1009939365,
      "line" : 580,
      "node_id" : "PRRC_kwDOABII5848MnOl",
      "original_commit_id" : "65d2ce6417004350466017893d553d04237f4c12",
      "original_line" : 579,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 30,
      "pull_request_review_id" : 1162638204,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009939365/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-31T23:02:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009939365",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r1012923414"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012923414"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Wow, no idea how that got so screwed up. Will fix, thanks.",
      "commit_id" : "c1767471c1cb6f1b856c22d767c35c18e19045e5",
      "created_at" : "2022-11-03T13:46:56Z",
      "diff_hunk" : "@@ -5117,6 +5168,149 @@ bool ChainstateManager::PopulateAndValidateSnapshot(\n     return true;\n }\n \n+// Currently, this function holds cs_main for its duration, which could be for\n+// multiple minutes due to the GetUTXOStats call. This hold is necessary\n+// because we need to avoid advancing the background validation chainstate\n+// farther than the snapshot base block - and this function is also invoked\n+// from within ConnectTip, i.e. from within ActivateBestChain, so cs_main is\n+// held anyway.\n+//\n+// Eventually (TODO), we could somehow separate this function's runtime from\n+// maintenance of the active chain, but that will either require\n+//\n+//  (i) setting `m_disabled` immediately and ensuring all chainstate accesses go\n+//      through IsUsable() checks, or\n+//\n+//  (ii) giving each chainstate its own lock instead of using cs_main for everything.\n+SnapshotCompletionResult ChainstateManager::MaybeCompleteSnapshotValidation(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25740#discussion_r1012923414",
      "id" : 1012923414,
      "in_reply_to_id" : 1009792671,
      "line" : 5187,
      "node_id" : "PRRC_kwDOABII5848X_wW",
      "original_commit_id" : "07b9dea9d4e8de2ce22e8ba50172a4af85801931",
      "original_line" : 5185,
      "original_position" : 121,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 121,
      "pull_request_review_id" : 1166931065,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25740",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012923414/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T13:46:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012923414",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   }
]
