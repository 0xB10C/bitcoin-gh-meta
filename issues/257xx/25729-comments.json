[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "created_at" : "2022-07-28T15:56:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1198340570",
      "id" : 1198340570,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585HbTna",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198340570/reactions"
      },
      "updated_at" : "2022-08-17T08:38:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198340570",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It shouldn't be necessary to pass an entire CMutableTransaction to SelectCoins. CoinSelectionParams already has the information about the sizes of the rest of the transaction, modulo the change output. So a calculation can be done with that information.\r\n\r\nAdditionally, depending on the algorithm used, there may or may not be a change output, so it's size will need to be accounted for in each size calculation.",
      "created_at" : "2022-07-28T17:20:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1198428003",
      "id" : 1198428003,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585Hbo9j",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198428003/reactions"
      },
      "updated_at" : "2022-07-28T17:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198428003",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you for the feedback @achow101.\r\nSizes in the `CoinSelectionParams` appear to be in \"bytes\" and not in \"weight\", so I'm not sure how to use them as the multiplier of each field hasn't been taken into account, unless I'm mistaken.\r\n\r\n> Additionally, depending on the algorithm used, there may or may not be a change output, so it's size will need to be accounted for in each size calculation.\r\n\r\nI'll look into that thanks.",
      "created_at" : "2022-07-28T18:38:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1198504505",
      "id" : 1198504505,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585Hb7o5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198504505/reactions"
      },
      "updated_at" : "2022-07-28T18:39:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198504505",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The size is always vsize, so multiplyging by WITNESS_SCALE_FACTOR is sufficient to convert to weight. There will be some rounding error, but vsize always rounds up, so weight calculated in that way will always be a slight overestimate.",
      "created_at" : "2022-07-28T18:44:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1198508956",
      "id" : 1198508956,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585Hb8uc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198508956/reactions"
      },
      "updated_at" : "2022-07-28T18:44:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198508956",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I've removed the need for a dummy transaction.\r\nThough I'm not sure how to include the change output in the size calculation yet.",
      "created_at" : "2022-07-28T21:40:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1198660495",
      "id" : 1198660495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585HchuP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198660495/reactions"
      },
      "updated_at" : "2022-07-28T21:40:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198660495",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r932703415"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932703415"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Can directly use `coin.input_bytes` instead of calculating the size again.",
      "commit_id" : "627b715f9da819ee0789a593c2a89737b5d8e941",
      "created_at" : "2022-07-28T21:43:13Z",
      "diff_hunk" : "@@ -516,14 +516,32 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }\n \n+    std::vector<SelectionResult> eligible_results;\n+    for (const auto& result : results) {\n+        int weight = coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR;\n+        for (const auto& coin : result.GetInputSet()) {\n+            weight += CalculateMaximumSignedInputSize(coin.txout, &wallet, &coin_control) * WITNESS_SCALE_FACTOR;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r932703415",
      "id" : 932703415,
      "line" : 528,
      "node_id" : "PRRC_kwDOABII5843l-y3",
      "original_commit_id" : "627b715f9da819ee0789a593c2a89737b5d8e941",
      "original_line" : 528,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 58,
      "pull_request_review_id" : 1054799836,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932703415/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-28T21:44:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932703415",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r932718807"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932718807"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, that's much better.",
      "commit_id" : "0741aaad37ffa4929e36c8dc761c2a7051170eea",
      "created_at" : "2022-07-28T22:11:16Z",
      "diff_hunk" : "@@ -516,14 +516,32 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }\n \n+    std::vector<SelectionResult> eligible_results;\n+    for (const auto& result : results) {\n+        int weight = coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR;\n+        for (const auto& coin : result.GetInputSet()) {\n+            weight += CalculateMaximumSignedInputSize(coin.txout, &wallet, &coin_control) * WITNESS_SCALE_FACTOR;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r932718807",
      "id" : 932718807,
      "in_reply_to_id" : 932703415,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843mCjX",
      "original_commit_id" : "627b715f9da819ee0789a593c2a89737b5d8e941",
      "original_line" : 528,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1054821588,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932718807/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-28T22:11:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932718807",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pinging you @Xekyo as you commented on the issue recently.",
      "created_at" : "2022-08-03T15:15:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1204085880",
      "id" : 1204085880,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585HxOR4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1204085880/reactions"
      },
      "updated_at" : "2022-08-05T08:32:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1204085880",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Cool, thank you for working on this. This PR as it is would get us almost all the way there as it should ensure that any coin selection results that exceeded the weight limit get filtered out before we do our final pick out of the selection candidates. Now we'll succeed at building a transaction if there is at least one selection result that doesn't exceed the weight limit, where we might have failed previously if that solution had the best waste score (and that would be the case at a low feerate, as a higher total input weight would get preferred).\r\n\r\n----\r\n\r\nI was pondering whether this would fail to find an existing solution in any scenario. I came up with this:\r\n\r\nSend â¿49.5 at a low feerate from a UXTO pool with\r\nâ¢ 10,000â¯P2PKH inputs of â¿0.04\r\nâ¢ 1,455 P2WPKH inputs of â¿0.034\r\n\r\nExplanation:\r\nâ¢ The UTXO pool has enough funds to pay for the transaction\r\nâ¢ At a negligible `not_input_size`, a standard transaction can have about ~675 P2PKH inputs, but 1470â¯P2WPKH inputs\r\nâ¢ With the above UTXOs, it would take 1,238 P2PKH inputs to pay for the transaction (which would exceed the limit by far), and it awould take 1,456 P2WPKH inputs to pay for the transaction (but there are too few)\r\nâ Only an input set from mixed inputs that is almost exclusively composed from P2WPKH inputs (and a single digit number of P2PKH inputs) would result in a standard transaction\r\n\r\nI don't think that any of our coin selection approaches would find such an input set, even if we added backtracking to BnB when the standard weight limit is exceeded. I figure that to succeed in this edge-case we would need an explicit mechanism to replace the inputs with the lowest value per weight once we exceed the standard weight limit. E.g. adding a heap to SRD that sorts the input set by `effectiveValue/weight`. I think this is out of scope though.\r\n\r\n\r\n------\r\n\r\n\r\nApproach ACK, will have to get back to review the code more carefully.",
      "created_at" : "2022-08-04T22:28:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1205831596",
      "id" : 1205831596,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585H34es",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1205831596/reactions"
      },
      "updated_at" : "2022-08-04T22:28:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1205831596",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased because of silent merge conflict.",
      "created_at" : "2022-08-08T09:03:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1207859533",
      "id" : 1207859533,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585H_nlN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207859533/reactions"
      },
      "updated_at" : "2022-08-08T09:03:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207859533",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Send â¿49.5 at a low feerate from a UXTO pool with\r\n> â¢ 10,000â¯P2PKH inputs of â¿0.04\r\n> â¢ 1,455 P2WPKH inputs of â¿0.034\r\n\r\nI tested this case with the following code and the coin selector did not find a result as you said @Xekyo.\r\n\r\n```cpp\r\n{\r\n    // Send â¿49.5 at a low feerate from a UXTO pool with\r\n    // 10,000â¯P2PKH inputs of â¿0.04\r\n    // 1,455 P2WPKH inputs of â¿0.034\r\n\r\n    std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\r\n    wallet->LoadWallet();\r\n    LOCK(wallet->cs_wallet);\r\n    wallet->SetupLegacyScriptPubKeyMan();\r\n\r\n    CoinsResult available_coins;\r\n    for (int j = 0; j < 10000; ++j) {\r\n        add_coin(available_coins, *wallet, CAmount(0.04 * COIN), CFeeRate(0), 144, false, 0, true);\r\n    }\r\n\r\n    for (int j = 0; j < 1455; ++j) {\r\n        add_coin(available_coins, *wallet, CAmount(0.034 * COIN), CFeeRate(0), 144, false, 0, true);\r\n    }\r\n\r\n    const auto result = SelectCoins(*wallet, available_coins, target, cc, cs_params);\r\n    BOOST_CHECK(result);\r\n}\r\n```",
      "created_at" : "2022-08-08T09:08:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1207863706",
      "id" : 1207863706,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585H_oma",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207863706/reactions"
      },
      "updated_at" : "2022-08-08T09:08:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207863706",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r940619491"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/940619491"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`Insufficient funds` might be a confusing error message since the wallet would also report having sufficient funds at the same time. Perhaps we could return a more specific error, if the last attempt returns from `eligible_results` being empty e.g. `Cannot fund transaction, wallet too fragmented`.",
      "commit_id" : "c166411dad1f4cdaa61f70b92728ecebfc3fc749",
      "created_at" : "2022-08-08T20:05:57Z",
      "diff_hunk" : "@@ -980,7 +980,7 @@ def test_transaction_too_large(self):\n             outputs[recipient.getnewaddress()] = 0.1\n         wallet.sendmany(\"\", outputs)\n         self.generate(self.nodes[0], 10)\n-        assert_raises_rpc_error(-4, \"Transaction too large\", recipient.fundrawtransaction, rawtx)\n+        assert_raises_rpc_error(-4, \"Insufficient funds\", recipient.fundrawtransaction, rawtx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r940619491",
      "id" : 940619491,
      "line" : 983,
      "node_id" : "PRRC_kwDOABII5844ELbj",
      "original_commit_id" : "c166411dad1f4cdaa61f70b92728ecebfc3fc749",
      "original_line" : 983,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : 5,
      "pull_request_review_id" : 1065721188,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/940619491/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-08T20:16:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/940619491",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r940621174"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/940621174"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perhaps we could store some âresult hintâ when we get into this if-block on a coin selection attempt that we could later use to inform the result message.",
      "commit_id" : "c166411dad1f4cdaa61f70b92728ecebfc3fc749",
      "created_at" : "2022-08-08T20:08:12Z",
      "diff_hunk" : "@@ -518,14 +520,27 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }\n \n+    std::vector<SelectionResult> eligible_results;\n+    std::copy_if(results.begin(), results.end(), std::back_inserter(eligible_results), [coin_selection_params](const SelectionResult& result) {\n+        const int weight = std::accumulate(result.GetInputSet().begin(), result.GetInputSet().end(), static_cast<int>(coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR), [](int acc, const auto& coin) {\n+            return acc + coin.input_bytes * WITNESS_SCALE_FACTOR;\n+        });\n+\n+        return weight <= static_cast<int>(MAX_STANDARD_TX_WEIGHT);\n+    });\n+\n+    if (eligible_results.empty()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r940621174",
      "id" : 940621174,
      "line" : 537,
      "node_id" : "PRRC_kwDOABII5844EL12",
      "original_commit_id" : "c166411dad1f4cdaa61f70b92728ecebfc3fc749",
      "original_line" : 537,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 31,
      "pull_request_review_id" : 1065721188,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/940621174/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-08T20:16:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/940621174",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r941824885"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/941824885"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Here's my attempt a3dece4e41de7bd5e118278abf09abcd2fcb4922.",
      "commit_id" : "a3dece4e41de7bd5e118278abf09abcd2fcb4922",
      "created_at" : "2022-08-09T21:37:14Z",
      "diff_hunk" : "@@ -518,14 +520,27 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }\n \n+    std::vector<SelectionResult> eligible_results;\n+    std::copy_if(results.begin(), results.end(), std::back_inserter(eligible_results), [coin_selection_params](const SelectionResult& result) {\n+        const int weight = std::accumulate(result.GetInputSet().begin(), result.GetInputSet().end(), static_cast<int>(coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR), [](int acc, const auto& coin) {\n+            return acc + coin.input_bytes * WITNESS_SCALE_FACTOR;\n+        });\n+\n+        return weight <= static_cast<int>(MAX_STANDARD_TX_WEIGHT);\n+    });\n+\n+    if (eligible_results.empty()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r941824885",
      "id" : 941824885,
      "in_reply_to_id" : 940621174,
      "line" : 560,
      "node_id" : "PRRC_kwDOABII5844Ixt1",
      "original_commit_id" : "c166411dad1f4cdaa61f70b92728ecebfc3fc749",
      "original_line" : 560,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 242,
      "pull_request_review_id" : 1067413121,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/941824885/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-09T21:37:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/941824885",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I have rebased this PR on top of #25734 (slightly rebased because of merge conflicts of the original PR).\r\nAdded a3dece4e41de7bd5e118278abf09abcd2fcb4922 to show a more specific error message when the transaction weight is exceeded during the coin selection.",
      "created_at" : "2022-08-09T21:39:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1209921138",
      "id" : 1209921138,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585IHe5y",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1209921138/reactions"
      },
      "updated_at" : "2022-08-09T21:39:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1209921138",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "About the specific error messages topic, I don't think that passing an enum reference to the function is the best solution. We have the `util::Result` class to cover this purpose (more info in #25218 and #25721)\r\n\r\nPlus, some notes about this in case you haven't seen them:\r\n\r\n* I have decoupled the preset inputs fetching block of code from `SelectCoins` and added `util::Result` class connection with proper error descriptions in #25685.\r\n(the error descriptions there are not due \"Insufficient Funds\", that was wrong).\r\n\r\n* And then have #25806, which has 3b3054f9 which basically adds `util::Result` error support to the entire `SelectCoins` function (which is what I would say that you actually need here).\r\n\r\nSo, would suggest to either cherry-pick 3b3054f9 here, so can return the error string (returning an empty string if the error is \"Insufficient Funds\" so there aren't changes out of the scope of the PR and you can still return the specific error) or, if you don't want it, maybe leave the proper error description point for a follow-up PR and only focus on the functionality here.",
      "created_at" : "2022-08-09T22:45:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1209966225",
      "id" : 1209966225,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585IHp6R",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1209966225/reactions"
      },
      "updated_at" : "2022-08-09T23:12:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1209966225",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you @furszy for your comments!\r\nI'll probably wait until #25806 and #25734 are merged before continuing working on this error message commit and will drop a3dece4e41de7bd5e118278abf09abcd2fcb4922 in the meantime.\r\nI rebased it again since #25734 just got rebased.",
      "created_at" : "2022-08-10T16:02:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1210915414",
      "id" : 1210915414,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585ILRpW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1210915414/reactions"
      },
      "updated_at" : "2022-08-10T16:02:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1210915414",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974690021"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974690021"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`tx_noinputs_size` is 0 when we are subtracting the fee from the outputs, so using it here may not always result in the correct calculation.",
      "commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "created_at" : "2022-09-19T21:06:01Z",
      "diff_hunk" : "@@ -531,14 +533,27 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }\n \n+    std::vector<SelectionResult> eligible_results;\n+    std::copy_if(results.begin(), results.end(), std::back_inserter(eligible_results), [coin_selection_params](const SelectionResult& result) {\n+        const int weight = std::accumulate(result.GetInputSet().begin(), result.GetInputSet().end(), static_cast<int>(coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR), [](int acc, const auto& coin) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974690021",
      "id" : 974690021,
      "line" : 543,
      "node_id" : "PRRC_kwDOABII5846GJbl",
      "original_commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "original_line" : 543,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 24,
      "pull_request_review_id" : 1112881164,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974690021/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-19T21:06:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974690021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974696402"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974696402"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since sizes are already being hardcoded above for `change_output_size` and `change_spend_size`, I think it's fine to hard code this as well instead of having to create an entire wallet just to fetch a single destination in order to get this size, where accuracy also doesn't really matter.",
      "commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "created_at" : "2022-09-19T21:15:20Z",
      "diff_hunk" : "@@ -917,5 +917,176 @@ BOOST_AUTO_TEST_CASE(effective_value_test)\n     BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n }\n \n+BOOST_AUTO_TEST_CASE(check_max_weight)\n+{\n+    const CAmount target = 49.5L * COIN;\n+    CCoinControl cc;\n+\n+    std::unique_ptr<CWallet> tmpWallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+    tmpWallet->LoadWallet();\n+    LOCK(tmpWallet->cs_wallet);\n+    tmpWallet->SetupLegacyScriptPubKeyMan();\n+\n+    const auto op_dest = tmpWallet->GetNewDestination(OutputType::BECH32, \"\");\n+    BOOST_ASSERT(op_dest);\n+    const auto scriptPubKey = GetScriptForDestination(op_dest.value());\n+    const auto txout = CTxOut(target, scriptPubKey);\n+\n+    FastRandomContext rand;\n+    CoinSelectionParams cs_params{\n+        rand,\n+        /*change_output_size=*/34,\n+        /*change_spend_size=*/148,\n+        /*min_change_target=*/CENT,\n+        /*effective_feerate=*/CFeeRate(0),\n+        /*long_term_feerate=*/CFeeRate(0),\n+        /*discard_feerate=*/CFeeRate(0),\n+        /*tx_noinputs_size=*/static_cast<size_t>(10) + GetSerializeSize(txout, PROTOCOL_VERSION), // static header size + output size",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974696402",
      "id" : 974696402,
      "line" : 944,
      "node_id" : "PRRC_kwDOABII5846GK_S",
      "original_commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "original_line" : 944,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 28,
      "pull_request_review_id" : 1112890070,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974696402/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-19T21:18:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974696402",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974697055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974697055"
         }
      },
      "author_association" : "MEMBER",
      "body" : "While these values don't particularly matter, they should probably match the p2wpkh sizes rather than the p2pkh.\r\n\r\n```suggestion\r\n        /*change_output_size=*/31,\r\n        /*change_spend_size=*/68,\r\n```",
      "commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "created_at" : "2022-09-19T21:16:19Z",
      "diff_hunk" : "@@ -917,5 +917,176 @@ BOOST_AUTO_TEST_CASE(effective_value_test)\n     BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n }\n \n+BOOST_AUTO_TEST_CASE(check_max_weight)\n+{\n+    const CAmount target = 49.5L * COIN;\n+    CCoinControl cc;\n+\n+    std::unique_ptr<CWallet> tmpWallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+    tmpWallet->LoadWallet();\n+    LOCK(tmpWallet->cs_wallet);\n+    tmpWallet->SetupLegacyScriptPubKeyMan();\n+\n+    const auto op_dest = tmpWallet->GetNewDestination(OutputType::BECH32, \"\");\n+    BOOST_ASSERT(op_dest);\n+    const auto scriptPubKey = GetScriptForDestination(op_dest.value());\n+    const auto txout = CTxOut(target, scriptPubKey);\n+\n+    FastRandomContext rand;\n+    CoinSelectionParams cs_params{\n+        rand,\n+        /*change_output_size=*/34,\n+        /*change_spend_size=*/148,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974697055",
      "id" : 974697055,
      "line" : 939,
      "node_id" : "PRRC_kwDOABII5846GLJf",
      "original_commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "original_line" : 939,
      "original_position" : 23,
      "original_start_line" : 938,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 23,
      "pull_request_review_id" : 1112890070,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974697055/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 938,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-19T21:18:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974697055",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974697295"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974697295"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Let's avoid making LegacySPKMs in tests which are not specifically testing that behavior.",
      "commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "created_at" : "2022-09-19T21:16:43Z",
      "diff_hunk" : "@@ -917,5 +917,176 @@ BOOST_AUTO_TEST_CASE(effective_value_test)\n     BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n }\n \n+BOOST_AUTO_TEST_CASE(check_max_weight)\n+{\n+    const CAmount target = 49.5L * COIN;\n+    CCoinControl cc;\n+\n+    std::unique_ptr<CWallet> tmpWallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+    tmpWallet->LoadWallet();\n+    LOCK(tmpWallet->cs_wallet);\n+    tmpWallet->SetupLegacyScriptPubKeyMan();\n+\n+    const auto op_dest = tmpWallet->GetNewDestination(OutputType::BECH32, \"\");\n+    BOOST_ASSERT(op_dest);\n+    const auto scriptPubKey = GetScriptForDestination(op_dest.value());\n+    const auto txout = CTxOut(target, scriptPubKey);\n+\n+    FastRandomContext rand;\n+    CoinSelectionParams cs_params{\n+        rand,\n+        /*change_output_size=*/34,\n+        /*change_spend_size=*/148,\n+        /*min_change_target=*/CENT,\n+        /*effective_feerate=*/CFeeRate(0),\n+        /*long_term_feerate=*/CFeeRate(0),\n+        /*discard_feerate=*/CFeeRate(0),\n+        /*tx_noinputs_size=*/static_cast<size_t>(10) + GetSerializeSize(txout, PROTOCOL_VERSION), // static header size + output size\n+        /*avoid_partial=*/false,\n+    };\n+\n+    CMutableTransaction txDummy;\n+    txDummy.vout.push_back(txout);\n+\n+    {\n+        // Scenario 1:\n+        // The actor starts with 1x 50.0 BTC and 1000x 0.05 BTC (100.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // The 50.0 BTC output should be selected, because the transaction would otherwise be too large\n+\n+        std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+        wallet->LoadWallet();\n+        LOCK(wallet->cs_wallet);\n+        wallet->SetupLegacyScriptPubKeyMan();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974697295",
      "id" : 974697295,
      "line" : 960,
      "node_id" : "PRRC_kwDOABII5846GLNP",
      "original_commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "original_line" : 960,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 44,
      "pull_request_review_id" : 1112890070,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974697295/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-19T21:18:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974697295",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974698104"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974698104"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ISTM these tests could be deduplicated intoa helper function with each scenario just being a set of parameters as each test case does basically the same thing but with slightly different params.",
      "commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "created_at" : "2022-09-19T21:18:00Z",
      "diff_hunk" : "@@ -917,5 +917,176 @@ BOOST_AUTO_TEST_CASE(effective_value_test)\n     BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n }\n \n+BOOST_AUTO_TEST_CASE(check_max_weight)\n+{\n+    const CAmount target = 49.5L * COIN;\n+    CCoinControl cc;\n+\n+    std::unique_ptr<CWallet> tmpWallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+    tmpWallet->LoadWallet();\n+    LOCK(tmpWallet->cs_wallet);\n+    tmpWallet->SetupLegacyScriptPubKeyMan();\n+\n+    const auto op_dest = tmpWallet->GetNewDestination(OutputType::BECH32, \"\");\n+    BOOST_ASSERT(op_dest);\n+    const auto scriptPubKey = GetScriptForDestination(op_dest.value());\n+    const auto txout = CTxOut(target, scriptPubKey);\n+\n+    FastRandomContext rand;\n+    CoinSelectionParams cs_params{\n+        rand,\n+        /*change_output_size=*/34,\n+        /*change_spend_size=*/148,\n+        /*min_change_target=*/CENT,\n+        /*effective_feerate=*/CFeeRate(0),\n+        /*long_term_feerate=*/CFeeRate(0),\n+        /*discard_feerate=*/CFeeRate(0),\n+        /*tx_noinputs_size=*/static_cast<size_t>(10) + GetSerializeSize(txout, PROTOCOL_VERSION), // static header size + output size\n+        /*avoid_partial=*/false,\n+    };\n+\n+    CMutableTransaction txDummy;\n+    txDummy.vout.push_back(txout);\n+\n+    {\n+        // Scenario 1:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974698104",
      "id" : 974698104,
      "line" : 952,
      "node_id" : "PRRC_kwDOABII5846GLZ4",
      "original_commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "original_line" : 952,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 36,
      "pull_request_review_id" : 1112890070,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974698104/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-19T21:18:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974698104",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974698287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974698287"
         }
      },
      "author_association" : "MEMBER",
      "body" : "A comment for this test case would be nice.",
      "commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "created_at" : "2022-09-19T21:18:20Z",
      "diff_hunk" : "@@ -917,5 +917,176 @@ BOOST_AUTO_TEST_CASE(effective_value_test)\n     BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n }\n \n+BOOST_AUTO_TEST_CASE(check_max_weight)\n+{\n+    const CAmount target = 49.5L * COIN;\n+    CCoinControl cc;\n+\n+    std::unique_ptr<CWallet> tmpWallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+    tmpWallet->LoadWallet();\n+    LOCK(tmpWallet->cs_wallet);\n+    tmpWallet->SetupLegacyScriptPubKeyMan();\n+\n+    const auto op_dest = tmpWallet->GetNewDestination(OutputType::BECH32, \"\");\n+    BOOST_ASSERT(op_dest);\n+    const auto scriptPubKey = GetScriptForDestination(op_dest.value());\n+    const auto txout = CTxOut(target, scriptPubKey);\n+\n+    FastRandomContext rand;\n+    CoinSelectionParams cs_params{\n+        rand,\n+        /*change_output_size=*/34,\n+        /*change_spend_size=*/148,\n+        /*min_change_target=*/CENT,\n+        /*effective_feerate=*/CFeeRate(0),\n+        /*long_term_feerate=*/CFeeRate(0),\n+        /*discard_feerate=*/CFeeRate(0),\n+        /*tx_noinputs_size=*/static_cast<size_t>(10) + GetSerializeSize(txout, PROTOCOL_VERSION), // static header size + output size\n+        /*avoid_partial=*/false,\n+    };\n+\n+    CMutableTransaction txDummy;\n+    txDummy.vout.push_back(txout);\n+\n+    {\n+        // Scenario 1:\n+        // The actor starts with 1x 50.0 BTC and 1000x 0.05 BTC (100.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // The 50.0 BTC output should be selected, because the transaction would otherwise be too large\n+\n+        std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+        wallet->LoadWallet();\n+        LOCK(wallet->cs_wallet);\n+        wallet->SetupLegacyScriptPubKeyMan();\n+\n+        CoinsResult available_coins;\n+        for (int j = 0; j < 1000; ++j) {\n+            add_coin(available_coins, *wallet, CAmount(0.05 * COIN), CFeeRate(0), 144, false, 0, true);\n+        }\n+\n+        add_coin(available_coins, *wallet, CAmount(50 * COIN), CFeeRate(0), 144, false, 0, true);\n+\n+        // Perform selection\n+        const auto result = SelectCoins(*wallet, available_coins, target, cc, cs_params);\n+        BOOST_CHECK(result);\n+        const bool has_50_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 50 * COIN;\n+        });\n+        BOOST_CHECK(has_50_coin);\n+        txDummy.vin.clear();\n+        for (const auto& coin : result->GetInputSet()) {\n+            txDummy.vin.push_back(CTxIn(coin.outpoint, CScript(), 0));\n+        }\n+        const auto txSize = CalculateMaximumSignedTxSize(CTransaction(txDummy), wallet.get(), &cc);\n+        BOOST_CHECK_LE(txSize.weight, MAX_STANDARD_TX_WEIGHT);\n+\n+        BOOST_CHECK_GE(result->GetSelectedValue(), target);\n+    }\n+\n+    {\n+        // Scenario 2:\n+\n+        // The actor starts with 500x 0.1 BTC and 1000x 0.05 BTC (100.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // A combination of coins should be selected, such that the created transaction is not too large\n+        std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+        wallet->LoadWallet();\n+        LOCK(wallet->cs_wallet);\n+        wallet->SetupLegacyScriptPubKeyMan();\n+\n+        CoinsResult available_coins;\n+        for (int j = 0; j < 500; ++j) {\n+            add_coin(available_coins, *wallet, CAmount(0.1 * COIN), CFeeRate(0), 144, false, 0, true);\n+        }\n+        for (int j = 0; j < 1000; ++j) {\n+            add_coin(available_coins, *wallet, CAmount(0.05 * COIN), CFeeRate(0), 144, false, 0, true);\n+        }\n+\n+        // Perform selection\n+        const auto result = SelectCoins(*wallet, available_coins, target, cc, cs_params);\n+        BOOST_CHECK(result);\n+        const bool has_0_1_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 0.1 * COIN;\n+        });\n+        const bool has_0_05_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 0.05 * COIN;\n+        });\n+        const bool has_not_50_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() != 50 * COIN;\n+        });\n+        BOOST_CHECK(has_0_1_coin);\n+        BOOST_CHECK(has_0_05_coin);\n+        BOOST_CHECK(has_not_50_coin);\n+        txDummy.vin.clear();\n+        for (const auto& coin : result->GetInputSet()) {\n+            txDummy.vin.push_back(CTxIn(coin.outpoint, CScript(), 0));\n+        }\n+        const auto txSize = CalculateMaximumSignedTxSize(CTransaction(txDummy), wallet.get(), &cc);\n+        BOOST_CHECK_LE(txSize.weight, MAX_STANDARD_TX_WEIGHT);\n+        BOOST_CHECK_GE(result->GetSelectedValue(), target);\n+    }\n+\n+    {\n+        // Scenario 3 (available as RPC test):\n+\n+        // The actor starts with 1x 50.0 BTC, 500x 0.1 BTC and 1000x 0.05 BTC (150.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // A combination of coins should be selected, such that the created transaction is not too large\n+        std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+        wallet->LoadWallet();\n+        LOCK(wallet->cs_wallet);\n+        wallet->SetupLegacyScriptPubKeyMan();\n+\n+        CoinsResult available_coins;\n+        for (int j = 0; j < 1000; ++j) {\n+            add_coin(available_coins, *wallet, CAmount(0.05 * COIN), CFeeRate(0), 144, false, 0, true);\n+        }\n+        for (int j = 0; j < 500; ++j) {\n+            add_coin(available_coins, *wallet, CAmount(0.1 * COIN), CFeeRate(0), 144, false, 0, true);\n+        }\n+        add_coin(available_coins, *wallet, CAmount(50 * COIN), CFeeRate(0), 144, false, 0, true);\n+\n+        // Perform selection\n+        const auto result = SelectCoins(*wallet, available_coins, target, cc, cs_params);\n+        BOOST_CHECK(result);\n+        const bool has_0_1_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 0.1 * COIN;\n+        });\n+        const bool has_0_05_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 0.05 * COIN;\n+        });\n+        const bool has_not_50_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() != 50 * COIN;\n+        });\n+        BOOST_CHECK(has_0_1_coin);\n+        BOOST_CHECK(has_0_05_coin);\n+        BOOST_CHECK(has_not_50_coin);\n+\n+        txDummy.vin.clear();\n+        for (const auto& coin : result->GetInputSet()) {\n+            txDummy.vin.push_back(CTxIn(coin.outpoint, CScript(), 0));\n+        }\n+        const auto txSize = CalculateMaximumSignedTxSize(CTransaction(txDummy), wallet.get(), &cc);\n+        BOOST_CHECK_LE(txSize.weight, MAX_STANDARD_TX_WEIGHT);\n+        BOOST_CHECK_GE(result->GetSelectedValue(), target);\n+    }\n+\n+    {\n+        std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+        wallet->LoadWallet();\n+        LOCK(wallet->cs_wallet);\n+        wallet->SetupLegacyScriptPubKeyMan();\n+\n+        CoinsResult available_coins;\n+        for (int j = 0; j < 3000; ++j) {\n+            add_coin(available_coins, *wallet, CAmount(0.017 * COIN), CFeeRate(0), 144, false, 0, true);\n+        }\n+\n+        // Perform selection\n+        const auto result = SelectCoins(*wallet, available_coins, target, cc, cs_params);\n+        BOOST_CHECK(!result);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974698287",
      "id" : 974698287,
      "line" : 1087,
      "node_id" : "PRRC_kwDOABII5846GLcv",
      "original_commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "original_line" : 1087,
      "original_position" : 171,
      "original_start_line" : 1075,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 171,
      "pull_request_review_id" : 1112890070,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974698287/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1075,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-19T21:18:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974698287",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r975280056"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975280056"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Do you know how I can take this into account? I did hear you say \"fuck\" on your stream VOD while reviewing this so I guess that's not trivial?",
      "commit_id" : "32a233773b4536aadecd00a52c897614dc9981b8",
      "created_at" : "2022-09-20T12:11:25Z",
      "diff_hunk" : "@@ -531,14 +533,27 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }\n \n+    std::vector<SelectionResult> eligible_results;\n+    std::copy_if(results.begin(), results.end(), std::back_inserter(eligible_results), [coin_selection_params](const SelectionResult& result) {\n+        const int weight = std::accumulate(result.GetInputSet().begin(), result.GetInputSet().end(), static_cast<int>(coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR), [](int acc, const auto& coin) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r975280056",
      "id" : 975280056,
      "in_reply_to_id" : 974690021,
      "line" : 543,
      "node_id" : "PRRC_kwDOABII5846IZe4",
      "original_commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "original_line" : 543,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 24,
      "pull_request_review_id" : 1113694871,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975280056/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-20T12:11:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975280056",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I refactored the tests and changed the values a bit because I switched from a legacy wallet to a descriptor wallet.\r\nAlso documented the last test.",
      "created_at" : "2022-09-20T12:12:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1252266338",
      "id" : 1252266338,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585KpBFi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1252266338/reactions"
      },
      "updated_at" : "2022-09-20T12:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1252266338",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   }
]
