[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This overlaps with #19865 and #19918.\r\n\r\ncc @hebasto @ryanofsky @MarcoFalke @ajtowns ",
      "created_at" : "2020-09-09T19:05:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19929#issuecomment-689757482",
      "id" : 689757482,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19929",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4OTc1NzQ4Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-09T19:13:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/689757482",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested with the following patch:\r\n```diff\r\n--- a/src/txmempool.cpp\r\n+++ b/src/txmempool.cpp\r\n@@ -1108,7 +1108,7 @@ bool CTxMemPool::IsLoaded() const\r\n \r\n void CTxMemPool::SetIsLoaded(bool loaded)\r\n {\r\n-    LOCK(cs);\r\n+    AssertLockHeld(cs);\r\n     m_is_loaded = loaded;\r\n }\r\n \r\n```\r\n\r\n- on master (564e1ab0f3dc573bd3ea60a80f6649c361243df9) clang emits warning:\r\n```\r\ntxmempool.cpp:1112:5: warning: writing variable 'm_is_loaded' requires holding mutex 'cs' exclusively [-Wthread-safety-analysis]\r\n    m_is_loaded = loaded;\r\n    ^\r\n```\r\n\r\n- with this PR (2a4081e487f1b83a5c9f1194a73d5a01a4c35cc6) clang compiles without warnings\r\n\r\nNot sure if this is correct as in both cases the patch causes run time `abort()`.",
      "created_at" : "2020-09-09T19:50:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19929#issuecomment-689782739",
      "id" : 689782739,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19929",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4OTc4MjczOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-09T19:52:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/689782739",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This is exactly how it is supposed to work: https://clang.llvm.org/docs/ThreadSafetyAnalysis.html#assert-capability-and-assert-shared-capability\r\n\r\n`m_is_loaded = loaded;` is never going to be executed if `cs` is not locked and thus clang does not emit a warning about it.",
      "created_at" : "2020-09-09T20:21:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19929#issuecomment-689800574",
      "id" : 689800574,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19929",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4OTgwMDU3NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-09T20:21:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/689800574",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Just to elaborate - expecting a warning in the example above is similar to expecting a warning in:\r\n\r\n```cpp\r\nint Func(int x)\r\n{\r\n    if (x == 1) {\r\n        return 10;\r\n    }       \r\n    abort();\r\n} // should we get \"control reaches end of non-void function\" here?\r\n```\r\n\r\nThe compiler does not emit a warning because it sees that `abort()` will [not return](https://en.cppreference.com/w/c/language/_Noreturn) and thus code after it is unreachable.\r\n\r\nWhat we are doing now in `master` looks like removing the [no return](https://en.cppreference.com/w/c/language/_Noreturn) attribute from `abort()` in order to get a warning for a code that will never be executed (we have removed the `ASSERT_EXCLUSIVE_LOCK` attribute from `AssertLockHeld()` to warn on unreachable code).",
      "created_at" : "2020-09-10T07:00:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19929#issuecomment-690032955",
      "id" : 690032955,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19929",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MDAzMjk1NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-10T07:00:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/690032955",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
