[
   {
      "author_association" : "MEMBER",
      "body" : "Thanks to @Saibato for setting me straight on this in #19946 and to @michaelfolkson for looking at that PR.",
      "created_at" : "2020-09-13T10:56:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-691656011",
      "id" : 691656011,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MTY1NjAxMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-13T10:56:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691656011",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. Will follow the above steps before ACKing the commit.",
      "created_at" : "2020-09-13T11:22:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-691658695",
      "id" : 691658695,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MTY1ODY5NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-13T11:22:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691658695",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't know why the travis xenial and macOS GUI/no depends are failing. All the other CI jobs pass on travis, cirrus, appveyor ones and bitcoin_builds.org.",
      "created_at" : "2020-09-13T12:01:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-691662576",
      "id" : 691662576,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MTY2MjU3Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-13T13:18:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691662576",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I don't know why the travis xenial and macOS GUI/no depends are failing. All the other CI jobs pass on travis, cirrus, appveyor ones and bitcoin_builds.org.\r\n\r\n BOOST_CHECK_EQUAL(addr.ToString(), ipv6_addr); ipv6 with % != ?\r\n```\r\ntest/net_tests.cpp:259: error: in \"net_tests/cnetaddr_basic\": check addr.ToString() == scoped_addr has failed [1122:3344:5566:7788:9900:aabb:ccdd:eeff != 1122:3344:5566:7788:9900:aabb:ccdd:eeff%1]\r\n```\r\ni.e. test, does the stack support scopes at all?",
      "created_at" : "2020-09-13T13:39:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-691672777",
      "id" : 691672777,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MTY3Mjc3Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-13T13:59:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691672777",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nThanks for adding tests! â¤ï¸ ",
      "created_at" : "2020-09-13T13:55:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-691674599",
      "id" : 691674599,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MTY3NDU5OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-13T13:55:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691674599",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I unsuccessfully tried to make a depends build for the travis macOS GUI no depends job, to try to reproduce the job failures locally, but make always returns `fatal error: 'cstddef' file not found`. At this point I don't know whether the test isn't portable, or whether the feature added without test coverage four years ago isn't portable.",
      "created_at" : "2020-09-13T16:49:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-691695528",
      "id" : 691695528,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MTY5NTUyOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-13T16:49:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691695528",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't think scope ids are intended to be portable.\n\nThey're a way for a user, on their local system, to specify what interface to use if you have multiple and are using a link-local address.\n\nBut in the end it's just a string that's passed to the OS for parsing. What interfaces exist, how they're named, and in what situation they're accepted is entirely up to it.\n\nOne idea that may make it more portable is restricting these scopes in tests to link-local addresses (inside fe80::/10), as the OS may refuse them outside that range.\n\nIf that still doesn't work... this is really no different than trying to unit test whether DNS resolving works, and then noticing the test fails on an offline system or so. It's dependent on local configuration, and there is no good cross-platform spec that all OSes adhere to.\n\n",
      "created_at" : "2020-09-13T17:09:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-691697651",
      "id" : 691697651,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MTY5NzY1MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-13T17:09:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691697651",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> One idea that may make it more portable is restricting these scopes in tests to link-local addresses (inside fe80::/10), as the OS may refuse them outside that range.\r\n\r\nThis suggestion solved the Travis Xenial job and stabilized the macOS no-depends one enough to enable a workaround. Thank you, @sipa!\r\n\r\nCI is now green; ready for review.",
      "created_at" : "2020-09-13T21:07:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19951#issuecomment-691725611",
      "id" : 691725611,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19951",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MTcyNTYxMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-13T21:07:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/691725611",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487792199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487792199"
         }
      },
      "author_association" : "NONE",
      "body" : "I tested this locally on macOS Catalina 10.15.6 and I get an error on this line:\r\n```\r\ntest/net_tests.cpp:261: error: in \"net_tests/cnetaddr_basic\": check addr_str == scoped_addr || addr_str == link_local_edge_case has failed\r\n```\r\n\r\nUpdate: It fails on scope 8 and 21, but not on 32.",
      "commit_id" : "88b6f85419b65122d5a4469a8585b276960bbb1e",
      "created_at" : "2020-09-14T09:56:59Z",
      "diff_hunk" : "@@ -244,6 +245,28 @@ BOOST_AUTO_TEST_CASE(cnetaddr_basic)\n     BOOST_CHECK(!addr.IsBindAny());\n     BOOST_CHECK_EQUAL(addr.ToString(), \"1122:3344:5566:7788:9900:aabb:ccdd:eeff\");\n \n+    // IPv6, scoped/link-local. See https://tools.ietf.org/html/rfc4007\n+    // We support non-negative decimal integers (uint32_t) as zone id indices.\n+    const std::string link_local{\"fe80::1\"};\n+    const std::string link_local_edge_case{\"fe80:0:0:0:0:0:0:1\"}; // macOS no depends travis ci only\n+    const std::string delimiter{\"%\"};\n+    const std::vector<std::string> scopes{\"8\", \"21\", \"32\"};\n+    for (const std::string& scope : scopes) {\n+        const std::string scoped_addr{link_local + delimiter + scope};\n+        BOOST_REQUIRE(LookupHost(scoped_addr, addr, false));\n+        BOOST_REQUIRE(addr.IsValid());\n+        BOOST_REQUIRE(addr.IsIPv6());\n+        BOOST_CHECK(!addr.IsBindAny());\n+        const std::string addr_str{addr.ToString()};\n+        BOOST_CHECK(addr_str == scoped_addr || addr_str == link_local_edge_case);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487792199",
      "id" : 487792199,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc5MjE5OQ==",
      "original_commit_id" : "431ebcefc633ff53bc71f212fe3a9a252c73d330",
      "original_line" : 261,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 487598712,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T11:22:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487792199",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/20860124?v=4",
         "events_url" : "https://api.github.com/users/eriknylund/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eriknylund/followers",
         "following_url" : "https://api.github.com/users/eriknylund/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eriknylund/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eriknylund",
         "id" : 20860124,
         "login" : "eriknylund",
         "node_id" : "MDQ6VXNlcjIwODYwMTI0",
         "organizations_url" : "https://api.github.com/users/eriknylund/orgs",
         "received_events_url" : "https://api.github.com/users/eriknylund/received_events",
         "repos_url" : "https://api.github.com/users/eriknylund/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eriknylund/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eriknylund/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eriknylund"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487815516"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487815516"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks @eriknylund! If you don't mind, can you give the output of rebuilding and running the test after adding these 2 lines?\r\n```diff\r\n         const std::string addr_str{addr.ToString()};\r\n+        BOOST_TEST_MESSAGE(scoped_addr);\r\n+        BOOST_TEST_MESSAGE(addr_str);\r\n         BOOST_CHECK(addr_str == scoped_addr || addr_str == link_local_edge_case);\r\n     }\r\n```",
      "commit_id" : "88b6f85419b65122d5a4469a8585b276960bbb1e",
      "created_at" : "2020-09-14T10:38:44Z",
      "diff_hunk" : "@@ -244,6 +245,28 @@ BOOST_AUTO_TEST_CASE(cnetaddr_basic)\n     BOOST_CHECK(!addr.IsBindAny());\n     BOOST_CHECK_EQUAL(addr.ToString(), \"1122:3344:5566:7788:9900:aabb:ccdd:eeff\");\n \n+    // IPv6, scoped/link-local. See https://tools.ietf.org/html/rfc4007\n+    // We support non-negative decimal integers (uint32_t) as zone id indices.\n+    const std::string link_local{\"fe80::1\"};\n+    const std::string link_local_edge_case{\"fe80:0:0:0:0:0:0:1\"}; // macOS no depends travis ci only\n+    const std::string delimiter{\"%\"};\n+    const std::vector<std::string> scopes{\"8\", \"21\", \"32\"};\n+    for (const std::string& scope : scopes) {\n+        const std::string scoped_addr{link_local + delimiter + scope};\n+        BOOST_REQUIRE(LookupHost(scoped_addr, addr, false));\n+        BOOST_REQUIRE(addr.IsValid());\n+        BOOST_REQUIRE(addr.IsIPv6());\n+        BOOST_CHECK(!addr.IsBindAny());\n+        const std::string addr_str{addr.ToString()};\n+        BOOST_CHECK(addr_str == scoped_addr || addr_str == link_local_edge_case);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487815516",
      "id" : 487815516,
      "in_reply_to_id" : 487792199,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgxNTUxNg==",
      "original_commit_id" : "431ebcefc633ff53bc71f212fe3a9a252c73d330",
      "original_line" : 261,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 487628219,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T11:22:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487815516",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487817788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487817788"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(ISTM the lower scope values are often used by the local machine, so higher values may indeed make the test more agnostic.)",
      "commit_id" : "88b6f85419b65122d5a4469a8585b276960bbb1e",
      "created_at" : "2020-09-14T10:43:06Z",
      "diff_hunk" : "@@ -244,6 +245,28 @@ BOOST_AUTO_TEST_CASE(cnetaddr_basic)\n     BOOST_CHECK(!addr.IsBindAny());\n     BOOST_CHECK_EQUAL(addr.ToString(), \"1122:3344:5566:7788:9900:aabb:ccdd:eeff\");\n \n+    // IPv6, scoped/link-local. See https://tools.ietf.org/html/rfc4007\n+    // We support non-negative decimal integers (uint32_t) as zone id indices.\n+    const std::string link_local{\"fe80::1\"};\n+    const std::string link_local_edge_case{\"fe80:0:0:0:0:0:0:1\"}; // macOS no depends travis ci only\n+    const std::string delimiter{\"%\"};\n+    const std::vector<std::string> scopes{\"8\", \"21\", \"32\"};\n+    for (const std::string& scope : scopes) {\n+        const std::string scoped_addr{link_local + delimiter + scope};\n+        BOOST_REQUIRE(LookupHost(scoped_addr, addr, false));\n+        BOOST_REQUIRE(addr.IsValid());\n+        BOOST_REQUIRE(addr.IsIPv6());\n+        BOOST_CHECK(!addr.IsBindAny());\n+        const std::string addr_str{addr.ToString()};\n+        BOOST_CHECK(addr_str == scoped_addr || addr_str == link_local_edge_case);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487817788",
      "id" : 487817788,
      "in_reply_to_id" : 487792199,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgxNzc4OA==",
      "original_commit_id" : "431ebcefc633ff53bc71f212fe3a9a252c73d330",
      "original_line" : 261,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 487631104,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T11:22:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487817788",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487823231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487823231"
         }
      },
      "author_association" : "NONE",
      "body" : "> (ISTM the lower scope values are often used by the local machine, so higher values may indeed make the test more agnostic.)\r\n\r\nThat seems to be the issue, en2 and vmnet8 are two network interfaces on my local machine:\r\n```\r\nfe80::1%8\r\nfe80::1%en2\r\ntest/net_tests.cpp:264: error: in \"net_tests/cnetaddr_basic\": check addr_str == scoped_addr || addr_str == link_local_edge_case has failed\r\nfe80::1%21\r\nfe80::1%vmnet8\r\ntest/net_tests.cpp:264: error: in \"net_tests/cnetaddr_basic\": check addr_str == scoped_addr || addr_str == link_local_edge_case has failed\r\nfe80::1%32\r\nfe80:0:0:0:0:0:0:1\r\n```",
      "commit_id" : "88b6f85419b65122d5a4469a8585b276960bbb1e",
      "created_at" : "2020-09-14T10:53:46Z",
      "diff_hunk" : "@@ -244,6 +245,28 @@ BOOST_AUTO_TEST_CASE(cnetaddr_basic)\n     BOOST_CHECK(!addr.IsBindAny());\n     BOOST_CHECK_EQUAL(addr.ToString(), \"1122:3344:5566:7788:9900:aabb:ccdd:eeff\");\n \n+    // IPv6, scoped/link-local. See https://tools.ietf.org/html/rfc4007\n+    // We support non-negative decimal integers (uint32_t) as zone id indices.\n+    const std::string link_local{\"fe80::1\"};\n+    const std::string link_local_edge_case{\"fe80:0:0:0:0:0:0:1\"}; // macOS no depends travis ci only\n+    const std::string delimiter{\"%\"};\n+    const std::vector<std::string> scopes{\"8\", \"21\", \"32\"};\n+    for (const std::string& scope : scopes) {\n+        const std::string scoped_addr{link_local + delimiter + scope};\n+        BOOST_REQUIRE(LookupHost(scoped_addr, addr, false));\n+        BOOST_REQUIRE(addr.IsValid());\n+        BOOST_REQUIRE(addr.IsIPv6());\n+        BOOST_CHECK(!addr.IsBindAny());\n+        const std::string addr_str{addr.ToString()};\n+        BOOST_CHECK(addr_str == scoped_addr || addr_str == link_local_edge_case);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487823231",
      "id" : 487823231,
      "in_reply_to_id" : 487792199,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgyMzIzMQ==",
      "original_commit_id" : "431ebcefc633ff53bc71f212fe3a9a252c73d330",
      "original_line" : 261,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 487638403,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T11:22:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487823231",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/20860124?v=4",
         "events_url" : "https://api.github.com/users/eriknylund/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eriknylund/followers",
         "following_url" : "https://api.github.com/users/eriknylund/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eriknylund/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eriknylund",
         "id" : 20860124,
         "login" : "eriknylund",
         "node_id" : "MDQ6VXNlcjIwODYwMTI0",
         "organizations_url" : "https://api.github.com/users/eriknylund/orgs",
         "received_events_url" : "https://api.github.com/users/eriknylund/received_events",
         "repos_url" : "https://api.github.com/users/eriknylund/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eriknylund/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eriknylund/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eriknylund"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487834588"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487834588"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perfect, thanks. Simplified the test to only the 32 and 0 values. No need for more than that.",
      "commit_id" : "88b6f85419b65122d5a4469a8585b276960bbb1e",
      "created_at" : "2020-09-14T11:16:04Z",
      "diff_hunk" : "@@ -244,6 +245,28 @@ BOOST_AUTO_TEST_CASE(cnetaddr_basic)\n     BOOST_CHECK(!addr.IsBindAny());\n     BOOST_CHECK_EQUAL(addr.ToString(), \"1122:3344:5566:7788:9900:aabb:ccdd:eeff\");\n \n+    // IPv6, scoped/link-local. See https://tools.ietf.org/html/rfc4007\n+    // We support non-negative decimal integers (uint32_t) as zone id indices.\n+    const std::string link_local{\"fe80::1\"};\n+    const std::string link_local_edge_case{\"fe80:0:0:0:0:0:0:1\"}; // macOS no depends travis ci only\n+    const std::string delimiter{\"%\"};\n+    const std::vector<std::string> scopes{\"8\", \"21\", \"32\"};\n+    for (const std::string& scope : scopes) {\n+        const std::string scoped_addr{link_local + delimiter + scope};\n+        BOOST_REQUIRE(LookupHost(scoped_addr, addr, false));\n+        BOOST_REQUIRE(addr.IsValid());\n+        BOOST_REQUIRE(addr.IsIPv6());\n+        BOOST_CHECK(!addr.IsBindAny());\n+        const std::string addr_str{addr.ToString()};\n+        BOOST_CHECK(addr_str == scoped_addr || addr_str == link_local_edge_case);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19951#discussion_r487834588",
      "id" : 487834588,
      "in_reply_to_id" : 487792199,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgzNDU4OA==",
      "original_commit_id" : "431ebcefc633ff53bc71f212fe3a9a252c73d330",
      "original_line" : 261,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 487653262,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19951",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-14T11:22:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/487834588",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
