[
   {
      "body" : "Anyone interested in this? @gavinandresen @jgarzik @laanwj @gmaxwell ?",
      "created_at" : "2013-06-16T10:11:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2645#issuecomment-19510401",
      "id" : 19510401,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2645",
      "updated_at" : "2013-06-16T10:11:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/19510401",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "So, it's one of those things :)\r\n\r\nIt is a good change, and something my python code should probably emulate to boost python speed.  Technical review yields an ACK.\r\n\r\nThe main issues are external:  the area of code being touched is a critical component, and this totally rewrites the component [in a positive way], in a slightly more complex way.  That increases the risk profile.  It correspondingly lacks a driving use case, making this is a very high risk, useful cleanup.\r\n\r\nYour inclusion of the old code as a test was an excellent move, and does serve to help mitigate this change risk.\r\n",
      "created_at" : "2013-06-17T13:08:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2645#issuecomment-19543415",
      "id" : 19543415,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2645",
      "updated_at" : "2013-06-17T13:08:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/19543415",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2645#discussion_r4732246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2645"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4732246"
         }
      },
      "body" : "As there is quite some complex logic here, I'd prefer if each variable was on a separate line (at least fAnyoneCanPay, fHashSingle, fHashNone).",
      "commit_id" : "f5857e5cb5fb03bee9c05d1dd6ba2621cac49179",
      "created_at" : "2013-06-17T19:17:41Z",
      "diff_hunk" : "@@ -961,62 +961,116 @@ bool EvalScript(vector<vector<unsigned char> >& stack, const CScript& script, co\n \n \n \n+namespace {\n+/** Wrapper that serializes like CTransaction, but with the modifications\n+ *  required for the signature hash done in-place\n+ */\n+class CTransactionSignatureSerializer {\n+private:\n+    const CTransaction &txTo;\n+    const CScript &scriptCode;\n+    const unsigned int nIn;\n+    const bool fAnyoneCanPay;\n+    const bool fHashSingle;\n+    const bool fHashNone;\n \n-\n-uint256 SignatureHash(CScript scriptCode, const CTransaction& txTo, unsigned int nIn, int nHashType)\n-{\n-    if (nIn >= txTo.vin.size())\n-    {\n-        printf(\"ERROR: SignatureHash() : nIn=%d out of range\\n\", nIn);\n-        return 1;\n+public:\n+    CTransactionSignatureSerializer(const CTransaction &txToIn, const CScript &scriptCodeIn, unsigned int nInIn, int nHashTypeIn) :\n+        txTo(txToIn), scriptCode(scriptCodeIn), nIn(nInIn), fAnyoneCanPay(!!(nHashTypeIn & SIGHASH_ANYONECANPAY)),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2645#discussion_r4732246",
      "id" : 4732246,
      "original_commit_id" : "7eb5183e40c1c19570f0a2d75f5512c40ac68284",
      "original_position" : 26,
      "path" : "src/script.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2645",
      "updated_at" : "2013-09-28T16:37:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4732246",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Are the code paths independent enough to run them side-by-side on live data? If so we could do exactly that and have bitcoind quit if they disagree. You'd then want to enable this behavior probabilistically so that at any time a small subset of the network is using the new code, say 1/8th. If a bug or exploit starts getting used hopefully bug reports will start flowing in. The reason why you would do this probabilistically, as opposed to just enabling side-by-side checking for everyone, is to ensure that a failure resulting in a crash/exploit will not affect the majority of the network either.\r\n\r\nOf course, prior to doing that, run such a side-by-side node yourself, which implies step zero should be just a command line option defaulting to off.",
      "created_at" : "2013-06-17T19:21:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2645#issuecomment-19568087",
      "id" : 19568087,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2645",
      "updated_at" : "2013-06-17T19:21:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/19568087",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "@petertodd If it takes that much effort to convince you this is safe, I'd rather just close this pull request. (note: this isn't a argument to convince you otherwise in any case; it's just not worth that much effort).\r\n\r\nI've of course already run this on testnet and mainnet without problems, but that doesn't mean anything for potential false positives.",
      "created_at" : "2013-06-17T19:24:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2645#issuecomment-19568299",
      "id" : 19568299,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2645",
      "updated_at" : "2013-06-17T19:24:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/19568299",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I agree with this change as it makes what happens more explicit. On the other hand it seems risky as it's very hard to verify or prove that the hashed parts stay exactly the same.",
      "created_at" : "2013-06-17T19:27:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2645#issuecomment-19568454",
      "id" : 19568454,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2645",
      "updated_at" : "2013-06-17T19:27:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/19568454",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@sipa I haven't reviewed the code carefully enough to be convinced one way or the other technically - I just wanted to float the idea given it's an option we haven't used yet.\r\n\r\nThat said inline signature serialization helps most with the largest transactions; I don't think we know much yet about what the advantages and disadvantages of allowing really large and complex transactions actually are yet and there are a whole lot of tradeoffs between networking, UTXO proofs, distributed verification etc. On that basis I'm slightly inclined to say NACK for possible premature optimization, but do keep the code around for later.",
      "created_at" : "2013-06-17T19:56:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2645#issuecomment-19570323",
      "id" : 19570323,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2645",
      "updated_at" : "2013-06-17T19:56:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/19570323",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/2645#discussion_r4743963"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2645"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4743963"
         }
      },
      "body" : "Done.",
      "commit_id" : "f5857e5cb5fb03bee9c05d1dd6ba2621cac49179",
      "created_at" : "2013-06-18T09:25:21Z",
      "diff_hunk" : "@@ -961,62 +961,116 @@ bool EvalScript(vector<vector<unsigned char> >& stack, const CScript& script, co\n \n \n \n+namespace {\n+/** Wrapper that serializes like CTransaction, but with the modifications\n+ *  required for the signature hash done in-place\n+ */\n+class CTransactionSignatureSerializer {\n+private:\n+    const CTransaction &txTo;\n+    const CScript &scriptCode;\n+    const unsigned int nIn;\n+    const bool fAnyoneCanPay;\n+    const bool fHashSingle;\n+    const bool fHashNone;\n \n-\n-uint256 SignatureHash(CScript scriptCode, const CTransaction& txTo, unsigned int nIn, int nHashType)\n-{\n-    if (nIn >= txTo.vin.size())\n-    {\n-        printf(\"ERROR: SignatureHash() : nIn=%d out of range\\n\", nIn);\n-        return 1;\n+public:\n+    CTransactionSignatureSerializer(const CTransaction &txToIn, const CScript &scriptCodeIn, unsigned int nInIn, int nHashTypeIn) :\n+        txTo(txToIn), scriptCode(scriptCodeIn), nIn(nInIn), fAnyoneCanPay(!!(nHashTypeIn & SIGHASH_ANYONECANPAY)),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2645#discussion_r4743963",
      "id" : 4743963,
      "original_commit_id" : "7eb5183e40c1c19570f0a2d75f5512c40ac68284",
      "original_position" : 26,
      "path" : "src/script.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2645",
      "updated_at" : "2013-09-28T16:37:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/4743963",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@gavinandresen @gmaxwell  @jgarzik I'd like some opinions about this. I'm not going to work on this further, but I believe it is sufficiently tested. If it's not considered useful or too risky, I'd rather close it.",
      "created_at" : "2013-08-15T22:05:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2645#issuecomment-22734284",
      "id" : 22734284,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2645",
      "updated_at" : "2013-08-15T22:05:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/22734284",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "ACK. I'm happy with this, and the randomized unit tests builds confidence. I was running it on a live node for a while, fwiw.",
      "created_at" : "2013-08-15T22:23:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2645#issuecomment-22735284",
      "id" : 22735284,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2645",
      "updated_at" : "2013-08-15T22:23:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/22735284",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Nothing to add beyond my above comments, which still apply.\r\n",
      "created_at" : "2013-08-15T22:36:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2645#issuecomment-22735932",
      "id" : 22735932,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2645",
      "updated_at" : "2013-08-15T22:36:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/22735932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "I spent some time this morning trying to break this; the good news is I couldn't, so ACK overall.\r\n\r\nI did find some weaknesses in the unit test, though; the same 20,000 random transactions were being tested every time, not all possible SIGHASH values were being tested (only \"reasonable\" ones), and you weren't testing some ==0/empty edge cases (important to test invalid transactions as well as valid ones).\r\n\r\nSuggested patch:\r\n\r\n```\r\ndiff --git a/src/test/sighash_tests.cpp b/src/test/sighash_tests.cpp\r\nindex cf1f486..fd2ab30 100644\r\n--- a/src/test/sighash_tests.cpp\r\n+++ b/src/test/sighash_tests.cpp\r\n@@ -70,13 +70,13 @@ uint256 static SignatureHashOld(CScript scriptCode, const CTransaction& txTo, un\r\n void static RandomScript(CScript &script) {\r\n     static const opcodetype oplist[] = {OP_FALSE, OP_1, OP_2, OP_3, OP_CHECKSIG, OP_IF, OP_VERIF, OP_RETURN, OP_CODESEPAR\r\n     script = CScript();\r\n-    int ops = (insecure_rand() % 10) + 1;\r\n+    int ops = (insecure_rand() % 10);\r\n     for (int i=0; i<ops; i++)\r\n         script << oplist[insecure_rand() % (sizeof(oplist)/sizeof(oplist[0]))];\r\n }\r\n\r\n void static RandomTransaction(CTransaction &tx, bool fSingle) {\r\n-    tx.nVersion = (insecure_rand() % 2) + 1;\r\n+    tx.nVersion = insecure_rand();\r\n     tx.vin.clear();\r\n     tx.vout.clear();\r\n     tx.nLockTime = (insecure_rand() % 2) ? insecure_rand() : 0;\r\n@@ -93,7 +93,7 @@ void static RandomTransaction(CTransaction &tx, bool fSingle) {\r\n     for (int out = 0; out < outs; out++) {\r\n         tx.vout.push_back(CTxOut());\r\n         CTxOut &txout = tx.vout.back();\r\n-        txout.nValue = (insecure_rand() % 100000000) + 1;\r\n+        txout.nValue = insecure_rand() % 100000000;\r\n         RandomScript(txout.scriptPubKey);\r\n     }\r\n }\r\n@@ -102,8 +102,10 @@ BOOST_AUTO_TEST_SUITE(sighash_tests)\r\n\r\n BOOST_AUTO_TEST_CASE(sighash_test)\r\n {\r\n+    seed_insecure_rand(false);\r\n+\r\n     for (int i=0; i<20000; i++) {\r\n-        int nHashType = 1 + (insecure_rand() % 3) + (insecure_rand() % 2)*0x80;\r\n+        int nHashType = insecure_rand();\r\n         CTransaction txTo;\r\n         RandomTransaction(txTo, (nHashType & 0x1f) == SIGHASH_SINGLE);\r\n         CScript scriptCode;\r\n```\r\n\r\n",
      "created_at" : "2013-08-15T23:34:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2645#issuecomment-22738570",
      "id" : 22738570,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2645",
      "updated_at" : "2013-08-15T23:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/22738570",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "Rebased and incorporated Gavin's suggested changes.",
      "created_at" : "2013-09-28T16:29:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2645#issuecomment-25301283",
      "id" : 25301283,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2645",
      "updated_at" : "2013-09-28T16:29:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/25301283",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/f5857e5cb5fb03bee9c05d1dd6ba2621cac49179 for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.",
      "created_at" : "2013-10-04T08:08:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2645#issuecomment-25682326",
      "id" : 25682326,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2645",
      "updated_at" : "2013-10-04T08:08:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/25682326",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "body" : "@gavinandresen Care to have another look?",
      "created_at" : "2013-10-15T19:28:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2645#issuecomment-26364716",
      "id" : 26364716,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2645",
      "updated_at" : "2013-10-15T19:28:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/26364716",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "As far as I can see by inspection, both functions are equivalent.\r\nIs the OP_CODESEPARATOR removal part tested by test cases? (e.g. OP_CS xx OP_CS OP_CS yy OP_CS -> xx yy)\r\n\r\n",
      "created_at" : "2013-10-17T00:29:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2645#issuecomment-26470891",
      "id" : 26470891,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2645",
      "updated_at" : "2013-10-17T00:29:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/26470891",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1752347?v=3",
         "events_url" : "https://api.github.com/users/SergioDemianLerner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/SergioDemianLerner/followers",
         "following_url" : "https://api.github.com/users/SergioDemianLerner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/SergioDemianLerner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/SergioDemianLerner",
         "id" : 1752347,
         "login" : "SergioDemianLerner",
         "organizations_url" : "https://api.github.com/users/SergioDemianLerner/orgs",
         "received_events_url" : "https://api.github.com/users/SergioDemianLerner/received_events",
         "repos_url" : "https://api.github.com/users/SergioDemianLerner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/SergioDemianLerner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/SergioDemianLerner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/SergioDemianLerner"
      }
   },
   {
      "body" : "@SergioDemianLerner : yes, the unit test creates 50,000 random, 10-opcode-long scriptPubKey transactions, many of which will contain multiple OP_CODESEPARATORs.\r\n\r\n",
      "created_at" : "2013-10-17T00:53:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2645#issuecomment-26471808",
      "id" : 26471808,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2645",
      "updated_at" : "2013-10-17T00:53:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/26471808",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   }
]
