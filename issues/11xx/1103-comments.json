[
   {
      "body" : "IMO this is less ugly instead of more ugly than #1102. All non-implementation information about RPC commands is conveniently in one place, in table vRpcCommands. You could in principle add the help message as well. And there's no long registration function that has to be kept up to date when new commands added, just a simple one.\r\n\r\nOne remark though: can you move the RegisterRPCCommands() call to AppInit2() instead? This make sure that the RPC commands data structure is initialized even if the RPC thread is not started. #1075 makes use of this for executing local \"RPC\" commands without -server.\r\n",
      "created_at" : "2012-04-15T08:00:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1103#issuecomment-5137633",
      "id" : 5137633,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1103",
      "updated_at" : "2012-04-15T08:07:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5137633",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "You could have an RPCDIspatcher class with a singleton object, which uses RegisterRPCCommands as constructor.\r\n",
      "created_at" : "2012-04-15T12:03:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1103#issuecomment-5138742",
      "id" : 5138742,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1103",
      "updated_at" : "2012-04-15T12:11:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5138742",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "As I understand it we currently simply take both mutexes for all RPC commands? (which is inefficient, but very safe) Did that change with this commit?\r\n",
      "created_at" : "2012-04-15T12:09:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1103#issuecomment-5138771",
      "id" : 5138771,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1103",
      "updated_at" : "2012-04-15T12:11:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5138771",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Oh right - I confused safe mode with \"requires extra locking\". I removed the part of the comment about that.",
      "created_at" : "2012-04-15T12:11:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1103#issuecomment-5138788",
      "id" : 5138788,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1103",
      "updated_at" : "2012-04-15T12:11:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5138788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "BTW, I am looking for suggestions on how to best encapsulate the parameter parsing in CommandLineRPC().  That is the last area where there is a long \"if command==foo, do X\" decision table, containing per-RPC-command logic.\r\n\r\nIt would be nice to move that parameter parsing into the vRPCCommand table.",
      "created_at" : "2012-04-15T14:39:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1103#issuecomment-5139633",
      "id" : 5139633,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1103",
      "updated_at" : "2012-04-15T14:39:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5139633",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "I'm not entirely sure about that. IMO it would be nice to separate client and server concerns as far as possible, even into separate implementation files.\r\n\r\n* The server logic is a box that accepts JSON and produces JSON data structures. It knows nothing of argument parsing, formatting, just handles commands. \r\n* The client logic takes a command name and list of (string) arguments, and produces a string message and error code as output. The conversion from argument list to JSON internally is dependent on the command. It can either communicate with the server through the network (as JSON client) or by passing the JSON object in and out in memory (UI console).\r\n\r\nThere's some network code and such that exists in limbo between the two.\r\n\r\n(I have nothing against making the \"convert argument strings to JSON\" data-driven as well, but I'm not convinced it belongs in the same place)\r\n",
      "created_at" : "2012-04-15T14:53:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1103#issuecomment-5139721",
      "id" : 5139721,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1103",
      "updated_at" : "2012-04-15T14:53:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5139721",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "RE @laanwj \"And there's no long registration function that has to be kept up to date when new commands added, just a simple one\"\r\n\r\nWell, the long registration function is replaced with a long table.  As the saying goes, \"six of one, half-dozen of the other\"  In both this pull request and #1102, there is one (1) place that contains a master list of RPC commands.  In this pull request it is vRPCCommands[], and in #1102 it is RegisterRPCCommands().\r\n\r\nI do lean towards this pull request too, because it is smaller and more compact.  However, the continued use of 'rpcfn_type' would probably be ugly to C++ purists :)\r\n",
      "created_at" : "2012-04-15T15:44:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1103#issuecomment-5140037",
      "id" : 5140037,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1103",
      "updated_at" : "2012-04-15T15:44:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5140037",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "ACK. I like this one better.\r\n\r\nI like data-driven programming, so describing argument types in a std::map<string method, std::map<int argNumber, ...something... argType> > or something instead of the current big long \"if/else...\" appeals to me. But that's such a low priority I probably wouldn't bother.\r\n",
      "created_at" : "2012-04-16T23:53:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1103#issuecomment-5165352",
      "id" : 5165352,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1103",
      "updated_at" : "2012-04-16T23:53:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5165352",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "I've extended the encapsulation a bit further (while fixing the initialization issue) in #1124.",
      "created_at" : "2012-04-18T20:47:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1103#issuecomment-5208409",
      "id" : 5208409,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1103",
      "updated_at" : "2012-04-18T20:47:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5208409",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Included in #1124",
      "created_at" : "2012-04-21T23:50:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1103#issuecomment-5264481",
      "id" : 5264481,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1103",
      "updated_at" : "2012-04-21T23:50:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/5264481",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
