[
   {
      "body" : "@morcos @ryanofsky Feel like having a look at this?",
      "created_at" : "2017-06-16T17:23:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10581#issuecomment-309084890",
      "id" : 309084890,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10581",
      "updated_at" : "2017-06-16T17:23:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/309084890",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10581#discussion_r123555279"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10581"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/123555279"
         }
      },
      "body" : "What's the point of the two InsecureRandBits calls skipping the new BOOST_CHECKs? It seems like the checks should always pass and aren't very expensive. Is the point to avoid creating cache entries during the test? Maybe add a comment saying why this only randomly checks HaveCoin results.",
      "commit_id" : "007e965fd4d0a95cb5005c07badd1f2eea696ac7",
      "created_at" : "2017-06-22T16:12:19Z",
      "diff_hunk" : "@@ -147,8 +141,17 @@ BOOST_AUTO_TEST_CASE(coins_cache_simulation_test)\n         {\n             uint256 txid = txids[InsecureRandRange(txids.size())]; // txid we're going to modify in this iteration.\n             Coin& coin = result[COutPoint(txid, 0)];\n+\n+            bool test_havecoin = InsecureRandBits(3) == 0;\n+            bool result_havecoin = test_havecoin ? stack.back()->HaveCoin(COutPoint(txid, 0)) : false;\n             const Coin& entry = (InsecureRandRange(500) == 0) ? AccessByTxid(*stack.back(), txid) : stack.back()->AccessCoin(COutPoint(txid, 0));\n             BOOST_CHECK(coin == entry);\n+            if (test_havecoin) BOOST_CHECK(result_havecoin == !entry.IsSpent());\n+\n+            if (InsecureRandBits(4) == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10581#discussion_r123555279",
      "id" : 123555279,
      "original_commit_id" : "6ba5394841172944082e0c7447f404d6609337f3",
      "original_position" : 24,
      "path" : "src/test/coins_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 45771251,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10581",
      "updated_at" : "2017-06-22T22:23:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/123555279",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10581#discussion_r123636231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10581"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/123636231"
         }
      },
      "body" : "Added a comment, and shuffled the code a bit to make it clearer.",
      "commit_id" : "007e965fd4d0a95cb5005c07badd1f2eea696ac7",
      "created_at" : "2017-06-22T22:23:33Z",
      "diff_hunk" : "@@ -147,8 +141,17 @@ BOOST_AUTO_TEST_CASE(coins_cache_simulation_test)\n         {\n             uint256 txid = txids[InsecureRandRange(txids.size())]; // txid we're going to modify in this iteration.\n             Coin& coin = result[COutPoint(txid, 0)];\n+\n+            bool test_havecoin = InsecureRandBits(3) == 0;\n+            bool result_havecoin = test_havecoin ? stack.back()->HaveCoin(COutPoint(txid, 0)) : false;\n             const Coin& entry = (InsecureRandRange(500) == 0) ? AccessByTxid(*stack.back(), txid) : stack.back()->AccessCoin(COutPoint(txid, 0));\n             BOOST_CHECK(coin == entry);\n+            if (test_havecoin) BOOST_CHECK(result_havecoin == !entry.IsSpent());\n+\n+            if (InsecureRandBits(4) == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10581#discussion_r123636231",
      "id" : 123636231,
      "original_commit_id" : "6ba5394841172944082e0c7447f404d6609337f3",
      "original_position" : 24,
      "path" : "src/test/coins_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 45861321,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10581",
      "updated_at" : "2017-06-22T22:23:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/123636231",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@ryanofsky Oh yes, indeed! Rebased on top of #10559.",
      "created_at" : "2017-06-23T01:33:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10581#issuecomment-310546372",
      "id" : 310546372,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10581",
      "updated_at" : "2017-06-23T01:39:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310546372",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
