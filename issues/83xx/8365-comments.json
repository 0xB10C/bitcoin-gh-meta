[
   {
      "body" : "This solves a different concern than #8364. Concept ACK, but without the removal of bytespersigop.",
      "created_at" : "2016-07-18T19:55:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8365#issuecomment-233439506",
      "id" : 233439506,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8365",
      "updated_at" : "2016-07-18T19:55:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/233439506",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "@luke-jr It was always my assumption that the bytespersigop default was chosen to be equal to MAX_SIZE / MAX_SIGOPS. The fact that it isn't (20, instead of 50) means that someone can pay only 40% of the price for a full block's worth of space, and fill it up with small-size high-sigops transactions.\r\n\r\nI see no reason why the number would ever be other than 50, so I'm removing the parameter.",
      "created_at" : "2016-07-18T19:57:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8365#issuecomment-233440012",
      "id" : 233440012,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8365",
      "updated_at" : "2016-07-18T20:02:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/233440012",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Concept ACK.",
      "created_at" : "2016-07-18T20:02:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8365#issuecomment-233441526",
      "id" : 233441526,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8365",
      "updated_at" : "2016-07-18T20:02:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/233441526",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8365#discussion_r71226700"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8365"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/71226700"
         }
      },
      "body" : "Rather than lose the caching of the cost, how about we just change GetTxSize() to return the max of these two quantities?  This way we have access to the actual cost so we can write smarter code in the future, while I believe GetTxSize() is already used everywhere (but we should confirm) for feerate calculations, included size/feerate of ancestors and descendants, both in the mempool and in the mining code.",
      "commit_id" : "5f514d7320dff8a3bfad97510d9d3f08485b1245",
      "created_at" : "2016-07-18T20:50:39Z",
      "diff_hunk" : "@@ -28,7 +28,7 @@ CTxMemPoolEntry::CTxMemPoolEntry(const CTransaction& _tx, const CAmount& _nFee,\n     hadNoDependencies(poolHasNoInputsOf), inChainInputValue(_inChainInputValue),\n     spendsCoinbase(_spendsCoinbase), sigOpCost(_sigOpsCost), lockPoints(lp)\n {\n-    nTxCost = GetTransactionCost(_tx);\n+    nTxCost = std::max(GetTransactionCost(_tx), (MAX_BLOCK_COST * sigOpCost + MAX_BLOCK_SIGOPS_COST - 1) / MAX_BLOCK_SIGOPS_COST);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8365#discussion_r71226700",
      "id" : 71226700,
      "original_commit_id" : "5f514d7320dff8a3bfad97510d9d3f08485b1245",
      "original_position" : 5,
      "path" : "src/txmempool.cpp",
      "position" : 5,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8365",
      "updated_at" : "2016-07-18T20:50:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/71226700",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "Concept ACK, but to be clear I don't think we should merge a policy change like this for 0.13.  As it applies to all transactions, and in particular not just the ones being rejected under the current `-bytespersigop` policy, we should give users more notice on the proposed change.  (In the worst case, some transactions that are relayed under current policy of 20 bytes per sigop could conceivably see their effective feerates cut by up to 60%.  I'm analyzing some historical data to get a sense of how many transactions would be affected by this policy; current estimate: 0.8%, no stats yet on how much of an effect it has overall on those transactions.)\r\n\r\nMoreover I can imagine that downstream software might want to consider updating their notion of feerate to match what we do here (wallets, block explorers, fee estimators, etc), so we should give people time for that.\r\n\r\nOne nit: putting aside any non-linear optimization issues, there's another slightly suboptimal behavior here in how the mining package selection would work.  If a package is too big to fit into the block using the sigops-inflated size, but would fit using its actual size, then we should add it (as we're sorting based on feerate-using-inflated size, it's clearly the best thing for us to add).  However we're getting rid of the caching of ancestor package actual sizes, so we don't have a good way to do this.  I expect that this is a small enough effect that we don't need to worry about it now, but we should document it for the future.",
      "created_at" : "2016-07-18T21:12:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8365#issuecomment-233460584",
      "id" : 233460584,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8365",
      "updated_at" : "2016-07-18T21:13:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/233460584",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   }
]
