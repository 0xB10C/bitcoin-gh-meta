[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13990#discussion_r214521982"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13990"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214521982"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: these could go in the initializer list",
      "commit_id" : "7f1e3a4c6ab84a8abe6fd52331fda82c79ee0642",
      "created_at" : "2018-09-01T19:58:41Z",
      "diff_hunk" : "@@ -195,6 +202,45 @@ TxConfirmStats::TxConfirmStats(const std::vector<double>& defaultBuckets,\n     resizeInMemoryCounters(buckets.size());\n }\n \n+TxConfirmStats::TxConfirmStats(const std::vector<double>& defaultBuckets, const std::map<double, unsigned int>& defaultBucketMap, const TxConfirmStats& txstatsSource)\n+    : buckets(defaultBuckets), bucketMap(defaultBucketMap)\n+{\n+    decay = txstatsSource.decay;\n+    scale = txstatsSource.scale;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13990#discussion_r214521982",
      "id" : 214521982,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNDUyMTk4Mg==",
      "original_commit_id" : "f9dd933a75bd32a8eb80b408d5f94b45f58030ab",
      "original_position" : 22,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 151602212,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13990",
      "updated_at" : "2018-09-07T04:25:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214521982",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13990#discussion_r214521993"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13990"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214521993"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `++dst` here and elsewhere",
      "commit_id" : "7f1e3a4c6ab84a8abe6fd52331fda82c79ee0642",
      "created_at" : "2018-09-01T19:59:22Z",
      "diff_hunk" : "@@ -195,6 +202,45 @@ TxConfirmStats::TxConfirmStats(const std::vector<double>& defaultBuckets,\n     resizeInMemoryCounters(buckets.size());\n }\n \n+TxConfirmStats::TxConfirmStats(const std::vector<double>& defaultBuckets, const std::map<double, unsigned int>& defaultBucketMap, const TxConfirmStats& txstatsSource)\n+    : buckets(defaultBuckets), bucketMap(defaultBucketMap)\n+{\n+    decay = txstatsSource.decay;\n+    scale = txstatsSource.scale;\n+\n+    const unsigned int maxPeriods = txstatsSource.confAvg.size();\n+    assert(txstatsSource.failAvg.size() == maxPeriods);\n+\n+    confAvg.resize(maxPeriods);\n+    for (unsigned int i = 0; i < maxPeriods; i++) {\n+        confAvg[i].resize(buckets.size());\n+    }\n+    failAvg.resize(maxPeriods);\n+    for (unsigned int i = 0; i < maxPeriods; i++) {\n+        failAvg[i].resize(buckets.size());\n+    }\n+\n+    txCtAvg.resize(buckets.size());\n+    avg.resize(buckets.size());\n+\n+    unsigned int src = 0;\n+    for (unsigned int dst = 0; dst < buckets.size(); dst++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13990#discussion_r214521993",
      "id" : 214521993,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNDUyMTk5Mw==",
      "original_commit_id" : "f9dd933a75bd32a8eb80b408d5f94b45f58030ab",
      "original_position" : 40,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 151602226,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13990",
      "updated_at" : "2018-09-07T04:25:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214521993",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13990#discussion_r214522017"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13990"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214522017"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: can move these conditions into the `for`, so that it manages both `src` and `dst`.",
      "commit_id" : "7f1e3a4c6ab84a8abe6fd52331fda82c79ee0642",
      "created_at" : "2018-09-01T20:00:40Z",
      "diff_hunk" : "@@ -195,6 +202,45 @@ TxConfirmStats::TxConfirmStats(const std::vector<double>& defaultBuckets,\n     resizeInMemoryCounters(buckets.size());\n }\n \n+TxConfirmStats::TxConfirmStats(const std::vector<double>& defaultBuckets, const std::map<double, unsigned int>& defaultBucketMap, const TxConfirmStats& txstatsSource)\n+    : buckets(defaultBuckets), bucketMap(defaultBucketMap)\n+{\n+    decay = txstatsSource.decay;\n+    scale = txstatsSource.scale;\n+\n+    const unsigned int maxPeriods = txstatsSource.confAvg.size();\n+    assert(txstatsSource.failAvg.size() == maxPeriods);\n+\n+    confAvg.resize(maxPeriods);\n+    for (unsigned int i = 0; i < maxPeriods; i++) {\n+        confAvg[i].resize(buckets.size());\n+    }\n+    failAvg.resize(maxPeriods);\n+    for (unsigned int i = 0; i < maxPeriods; i++) {\n+        failAvg[i].resize(buckets.size());\n+    }\n+\n+    txCtAvg.resize(buckets.size());\n+    avg.resize(buckets.size());\n+\n+    unsigned int src = 0;\n+    for (unsigned int dst = 0; dst < buckets.size(); dst++) {\n+        if (buckets[dst] < txstatsSource.buckets[src]) continue;\n+\n+        txCtAvg[dst] = txstatsSource.txCtAvg[src];\n+        avg[dst] = txstatsSource.avg[src];\n+        for (unsigned int i = 0; i < maxPeriods; i++) {\n+            confAvg[i][dst] = txstatsSource.confAvg[i][src];\n+            failAvg[i][dst] = txstatsSource.failAvg[i][src];\n+        }\n+\n+        src++;\n+        if (src >= txstatsSource.buckets.size()) break;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13990#discussion_r214522017",
      "id" : 214522017,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNDUyMjAxNw==",
      "original_commit_id" : "f9dd933a75bd32a8eb80b408d5f94b45f58030ab",
      "original_position" : 51,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 151602247,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13990",
      "updated_at" : "2018-09-07T04:25:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214522017",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The really high fee rates were due to not handling the buckets/bucketMap objects correctly, believe that's fixed now.",
      "created_at" : "2018-09-03T08:47:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13990#issuecomment-418045790",
      "id" : 418045790,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13990",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxODA0NTc5MA==",
      "updated_at" : "2018-09-03T08:47:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/418045790",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Dropped the WIP tag, this should be good to review/nitpick now.\r\n\r\nI couldn't come up with a reasonable way to add functional tests for this change; if someone has a good idea, suggestions/patches welcome :) Though... I guess just generating an estimates file directly in python, pointing bitcoind at it, and seeing what estimates bitcoind comes up with after upgrading it without ever actually putting txes in the blockchain could work okay...",
      "created_at" : "2018-09-07T04:39:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13990#issuecomment-419320374",
      "id" : 419320374,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13990",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxOTMyMDM3NA==",
      "updated_at" : "2018-09-07T04:39:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/419320374",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   }
]
