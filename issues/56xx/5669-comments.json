[
   {
      "body" : "I'm not a fan of adding more try/catch to consensus code, but that's (mostly) a matter of personal taste. Any reason for not simply returning a (differently named) ConsensusException object? Also, as another matter of personal preference, reusing the name CheckTransaction() makes it hard to read/grep. I suppose if we started using the Consensus namespace as a convention I wouldn't mind that though.\r\n\r\ngrumble..bikeshed...consensus.cpp...\r\n\r\nConcept ACK.",
      "created_at" : "2015-01-16T04:44:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5669#issuecomment-70207822",
      "id" : 70207822,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5669",
      "updated_at" : "2015-01-16T04:44:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/70207822",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5669#discussion_r23066315"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5669"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/23066315"
         }
      },
      "body" : "Just a question, ``MoneyRange()`` does ``return (nValue >= 0 && nValue <= MAX_MONEY)``, why not reuse ``MoneyRange()`` also for the check before accumulating the amounts and just give another error message? This would de-duplicate the above code.",
      "commit_id" : "ce58172c737fef66ad33bf58c2dbcda9ef2e8cd5",
      "created_at" : "2015-01-16T07:31:52Z",
      "diff_hunk" : "@@ -0,0 +1,53 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2014 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include \"consensus/consensus.h\"\n+\n+#include \"primitives/transaction.h\"\n+#include \"version.h\"\n+\n+void Consensus::CheckTransaction(const CTransaction& tx)\n+{\n+    // Basic checks that don't depend on any context\n+    if (tx.vin.empty())\n+        throw ConsensusException(10, __func__, \"vin empty\", \"bad-txns-vin-empty\");\n+    if (tx.vout.empty())\n+        throw ConsensusException(10, __func__, \"vout empty\", \"bad-txns-vout-empty\");\n+    // Size limits\n+    if (::GetSerializeSize(tx, SER_NETWORK, PROTOCOL_VERSION) > MAX_BLOCK_SIZE)\n+        throw ConsensusException(100, __func__, \"size limits failed\", \"bad-txns-oversize\");\n+\n+    // Check for negative or overflow output values\n+    CAmount nValueOut = 0;\n+    for (unsigned int i = 0; i < tx.vout.size(); i++) {\n+        if (tx.vout[i].nValue < 0)\n+            throw ConsensusException(100, __func__, \"txout.nValue negative\", \"bad-txns-vout-negative\");\n+        if (tx.vout[i].nValue > MAX_MONEY)\n+            throw ConsensusException(100, __func__, \"txout.nValue too high\", \"bad-txns-vout-toolarge\");\n+        nValueOut += tx.vout[i].nValue;\n+        if (!MoneyRange(nValueOut))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5669#discussion_r23066315",
      "id" : 23066315,
      "original_commit_id" : "89ce4684ba4f60eefd7ecbc11305f3b5078e83d5",
      "original_position" : 30,
      "path" : "src/consensus/consensus.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5669",
      "updated_at" : "2015-01-24T16:41:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/23066315",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5669#discussion_r23066337"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5669"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/23066337"
         }
      },
      "body" : "This has to be ``BITCOIN_CONSENSUS_CONSENSUS_H``, because you are in the directory consensus.",
      "commit_id" : "ce58172c737fef66ad33bf58c2dbcda9ef2e8cd5",
      "created_at" : "2015-01-16T07:32:46Z",
      "diff_hunk" : "@@ -0,0 +1,43 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2014 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CONSENSUS_H",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5669#discussion_r23066337",
      "id" : 23066337,
      "original_commit_id" : "89ce4684ba4f60eefd7ecbc11305f3b5078e83d5",
      "original_position" : 6,
      "path" : "src/consensus/consensus.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5669",
      "updated_at" : "2015-01-24T16:41:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/23066337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5669#discussion_r23066359"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5669"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/23066359"
         }
      },
      "body" : "Perhaps some of the input strings can be constified?",
      "commit_id" : "ce58172c737fef66ad33bf58c2dbcda9ef2e8cd5",
      "created_at" : "2015-01-16T07:33:28Z",
      "diff_hunk" : "@@ -0,0 +1,43 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2014 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_CONSENSUS_H\n+#define BITCOIN_CONSENSUS_H\n+\n+#include <string>\n+\n+class CTransaction;\n+class CValidationState;\n+\n+/** The maximum allowed size for a serialized block, in bytes (network rule) */\n+static const unsigned int MAX_BLOCK_SIZE = 1000000;\n+\n+class ConsensusException: public std::exception\n+{\n+public:\n+    int nDoS;\n+    std::string reason;\n+    std::string description;\n+\n+    ConsensusException(int nDoSIn, std::string functionIn, std::string strErrorIn, std::string reasonIn)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5669#discussion_r23066359",
      "id" : 23066359,
      "original_commit_id" : "89ce4684ba4f60eefd7ecbc11305f3b5078e83d5",
      "original_position" : 24,
      "path" : "src/consensus/consensus.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5669",
      "updated_at" : "2015-01-24T16:41:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/23066359",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5669#discussion_r23066434"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5669"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/23066434"
         }
      },
      "body" : "If MAX_BLOCK_SIZE really should go into consensus.h then you need to remove this comment (and perhaps we have that also in other places).",
      "commit_id" : "ce58172c737fef66ad33bf58c2dbcda9ef2e8cd5",
      "created_at" : "2015-01-16T07:35:51Z",
      "diff_hunk" : "@@ -5,6 +5,7 @@\n \n #include \"merkleblock.h\"\n \n+#include \"consensus/consensus.h\"\n #include \"hash.h\"\n #include \"primitives/block.h\" // for MAX_BLOCK_SIZE",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5669#discussion_r23066434",
      "id" : 23066434,
      "original_commit_id" : "89ce4684ba4f60eefd7ecbc11305f3b5078e83d5",
      "original_position" : 6,
      "path" : "src/merkleblock.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5669",
      "updated_at" : "2015-01-24T16:41:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/23066434",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "body" : "@Diapolo 1) Will fix the #ifndef 2) Good catch on ```#include \"primitives/block.h\" // for MAX_BLOCK_SIZE``` maybe we can completely remove that include from a couple of places.\r\n3) Agree on MoneyRange but I didn't wanted to change functionality in this PR. Maybe it's not a big deal, let's see what others say about it. There's other potential optimizations there (for example, if every individual tx.vout[i].nValue is positive, nValueOut cannot be negative).\r\n\r\n@theuni Yes, the point of the namespace was to avoid naming these functions ConsensusCheckTransaction(), etc. But I'm fine also changing the name. What about Consensus::CheckTx() ?\r\n\r\n@Both of you, I agree that ConsensusException is not the most elegant thing in the world as it is now. @Diapolo proposes to unify functionIn and strErrorIn into maybe descriptionIn. That makes sense. I would prefer not putting there anything at all. Remember that this is only for the log. Would it be much worse if instead of using ```error(e.what())``` we just used ```error(\"Consensus::CheckTransaction: %s\", e.reason)``` in \r\nhttps://github.com/bitcoin/bitcoin/pull/5669/files#diff-7ec3c68a81efff79b6ca22ac1f1eabbaR817\r\n??\r\nInstead of logging \"CheckTransaction() : vin empty\" we would log \"CheckTransaction() : bad-txns-vin-empty\" and things like that. If you ask me, it is worth it if it allows us to remove an attribute of the object (be it an exception or a returned object).\r\nAbout not throwing Exceptions, I was trying to avoid many i/o parameters like int& nDoS and std::string& reason, but it is true that returning an object would do it.\r\nSome errors have nDoS = 10 and most of them have 100. If they all had 100, we could save another attribute for the object. or return bool and have a string& reason param. or return the reason string and treat an empty string as success check...We can have something more beauty if we're willing to minimally change functionality.\r\n \r\n",
      "created_at" : "2015-01-16T10:55:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5669#issuecomment-70238036",
      "id" : 70238036,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5669",
      "updated_at" : "2015-01-16T10:56:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/70238036",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "@jtimon IMHO it makes absolutely sense to create an additional commit, which picks up my suggestion and perhaps also your optimisation ideas. It makes things easy to review if the last commit would be that.\r\n\r\nAbout my suggestion for the input strings, I just meant changing them to ``const std::string&``, if possible. I did not think about making other changes :).\r\n\r\nThanks for also picking up the other things!",
      "created_at" : "2015-01-16T11:08:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5669#issuecomment-70239306",
      "id" : 70239306,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5669",
      "updated_at" : "2015-01-16T11:08:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/70239306",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "body" : "Since it is still very new, I took the liberty of directly editing the commits instead of adding new ones to later rebase and squash.\r\nChanges done:\r\n1) The exception is changed for a Consensus::Result object that is returned as suggested by @theuni  \r\n2) The function attribute is removed as I thought @Diapolo was suggesting...\r\n3) Not only the inputs to the constructor are \"constified\" as suggested by @Diapolo, but also the very attributes of the class.\r\n4) The namespace is created in the first commit to make the second more purely MOVEONLY, and the new Result class is moved inside the namespace.\r\n5) Added a last commit as suggested by @Diapolo with his simplification and my tiny tiny optimization. \r\n\r\nOh, and bikeshed from CheckTransaction() to CheckTx().\r\n",
      "created_at" : "2015-01-16T12:48:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5669#issuecomment-70249138",
      "id" : 70249138,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5669",
      "updated_at" : "2015-01-16T12:48:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/70249138",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Also, I replaced a couple of ```#include \"primitives/block.h\" // for MAX_BLOCK_SIZE``` for ```#include \"consensus/consensus.h\" // for MAX_BLOCK_SIZE``` instead of just adding ```#include \"consensus/consensus.h\"```",
      "created_at" : "2015-01-16T12:51:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5669#issuecomment-70249390",
      "id" : 70249390,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5669",
      "updated_at" : "2015-01-16T12:51:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/70249390",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Hmm, looking at this again.. What's the reason for not dropping state.Abort() (it makes no sense for a state object to be aborting the node anyway imo), creating something like \"abortNodeBadState(CValidationState& state, std::string reason)\" to take its place, and moving CValidationState into consensus.o ? That way we could share much more code with the current implementation.",
      "created_at" : "2015-01-16T22:53:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5669#issuecomment-70335927",
      "id" : 70335927,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5669",
      "updated_at" : "2015-01-16T22:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/70335927",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "I was curious to see what it'd look like, so I tried out the above suggested change in one big nasty commit: https://github.com/theuni/bitcoin/commit/fd19dd4b92e27d2e967daf47c36147eaed3d1e22\r\n\r\nIt seems quite advantageous to have CValidationState in consensus.o.",
      "created_at" : "2015-01-16T23:53:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5669#issuecomment-70341630",
      "id" : 70341630,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5669",
      "updated_at" : "2015-01-16T23:53:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/70341630",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "Yesterday I realized that the result object should be more generic to be used by other consensus functions. Also it would be useful for some policy methods.\r\nI concluded that the simplest thing would be to mimic CValidationState::DoS() header: \r\nhttps://github.com/jtimon/bitcoin/commit/9e67b59d52834fb7b52ad9e3b428117c35d28822 and https://github.com/jtimon/bitcoin/commit/e92e852413c4c8418edd872230710570c4a6fc6f\r\n\r\nBut your approach is definitely simpler. The only disadvantage being the lack of an error string to be passed and thus changing a little bit the logging.\r\nFor example, instead of logging ```ERROR: Consensus::CheckTx(): vin empty``` your approach would log ```ERROR: Consensus::CheckTx(): bad-txns-vin-empty``` instead.\r\nBecause the reason contained in the state it's different from the string passed to ```bool error(char*)``` called to return false for the second parameter of CValidationState::DoS().\r\nIn my opinion this is completely acceptable and will also make those calls to CValidationState::DoS() shorter. We will still need to touch those lines to remove the call to error(), but everything will be simpler to do and review.\r\n\r\nSo I think I'm going to redo this on top of an edited version of your commit.\r\n ",
      "created_at" : "2015-01-17T11:20:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5669#issuecomment-70363377",
      "id" : 70363377,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5669",
      "updated_at" : "2015-01-17T11:20:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/70363377",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Rebased with CValidationState in consensus/validation.h.\r\nI chose not to put it in consensus/consensus.h because:\r\n\r\n1) Not everything that needs consensus.h needs validation.h (like merkleblock.cpp bitcoin-tx.cpp for now)\r\n2) Not everything that needs validation.h needs consensus.h (like probably policy.o)\r\n\r\nFeel free to bikeshed the file names.",
      "created_at" : "2015-01-17T13:37:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5669#issuecomment-70367200",
      "id" : 70367200,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5669",
      "updated_at" : "2015-01-17T13:37:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/70367200",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Mm, this is now hard to review because it's such a moving target. I was ready to ACK the changes after another quick review based on your comment above, but lots of other things have been touched since then. Could you try to keep this to a somewhat narrow scope for the sake of review?\r\n\r\nAlso, since a fresh review is needed, please go ahead and rebase to remove the squashme's.",
      "created_at" : "2015-01-19T21:03:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5669#issuecomment-70560149",
      "id" : 70560149,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5669",
      "updated_at" : "2015-01-19T21:03:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/70560149",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "Rebased on top of #5681, added some \"SQUASHME\" notes since some small commits like those flagged with  \"MOVEONLY\", are only useful for the initial review (for example I separated theuni@fd19dd4 into https://github.com/jtimon/bitcoin/commit/72e5068ebe1aad33f05a02f7eabe65abb098dff0 and https://github.com/jtimon/bitcoin/commit/8a6590ccb3f51978333d50878af3d79005ca4dfb).\r\nI am very sorry for having screwed review by having rebased on top of  #5681.\r\nI should have signaled more clearly that this was a work in progress but I'm trying to keep the policy--refactor-related code in sync with this and I was really having problems editing and moving commits up and down without some solid include basis. I'm thankful to @jgarzik that C's include philosophy is to include everything that you're using, not just the higher level files. I hope that he can give some time to #5681 to make sure I didn't learned anything the wrong way.\r\nI'm also trying to keep in sync https://github.com/luke-jr/bitcoin/compare/nodepolicy2 and #5180.\r\nI hope reviewers don't get mad because I'm using #5681 as a common base for some seemingly unrelated previous proposals, but I believe they will become much easier to maintain.\r\nI needed that to know which ```#include \"main.h\"``` I could really delete when moving things out of main in parallel.\r\nI'll push my longest consensus/policy-related branch soon. If it doesn't make any sense to anyone I can go back to a version without #5681 on the consensus and policy related PRs I have. I may close some of them with some acks to if it makes more sense to concentrate related changes.\r\n \r\n  ",
      "created_at" : "2015-01-20T00:08:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5669#issuecomment-70583170",
      "id" : 70583170,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5669",
      "updated_at" : "2015-01-20T00:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/70583170",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Ok. Concept ACK here. I'll re-review and verify the MOVEONLY's after #5681.",
      "created_at" : "2015-01-20T01:06:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5669#issuecomment-70588246",
      "id" : 70588246,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5669",
      "updated_at" : "2015-01-20T01:06:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/70588246",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "Rebased, now it is dependent on #5696 instead of #5681.",
      "created_at" : "2015-01-26T12:34:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5669#issuecomment-71454161",
      "id" : 71454161,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5669",
      "updated_at" : "2015-01-26T12:34:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/71454161",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   }
]
