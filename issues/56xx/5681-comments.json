[
   {
      "body" : "Very nice, I've been meaning to take a look at this as well. Great to see it was relatively non-invasive.\r\nI've verified that fd10da8cae79a15d2ac23a17120cb2d62e8a28e2 and b46dd0f3f53ec20035660aaca07484f898df1fc5 are read-only. From a quick eye-ball (and since Travis is happy), the includes changes look good too.\r\n\r\nutAck.",
      "created_at" : "2015-01-20T02:35:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5681#issuecomment-70595524",
      "id" : 70595524,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5681",
      "updated_at" : "2015-01-20T02:35:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/70595524",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "ACK. Looks like a definite improvement to me, and low-risk due to (mostly) move only.\r\n\r\nIt becomes kind of apparent from this how much is exported in main.h that \r\n\r\n- a) initialization/shutdown purposes (InitBlockIndex/LoadBlockIndex/UnloadBlockIndex/ThreadScriptCheck at least). \r\n- b) only used lnternally (WriteBlockToDisk, ProcessMessages, GetMinRelayFee at least), but see c - possibly this means they need tests\r\n- c) exported only for testing and could be static/internal otherwise (CScriptCheck)\r\n- d) pure utility (AreInputsStandard, GetLegacySigOpCount, IsStandardTx, GetP2SHSigOpCount)\r\n\r\n(a) could be reduced by factoring the initialization and shutdown sequences from init.cpp and moving them with what is initiialized\r\n(b) could be removed from the header, or tests added\r\n(c) is always thorny, you need to expose them but only to tests, could have a special \"test interface\"\r\n(d) could be moved to a standard.cpp/standard.h\r\n\r\n@sipa may want to weigh in here too as he has specific ideas about refactoring main.\r\n",
      "created_at" : "2015-01-20T10:36:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5681#issuecomment-70634355",
      "id" : 70634355,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5681",
      "updated_at" : "2015-01-20T11:02:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/70634355",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "For b and c, maybe a half-solution that just comes to mind, is just leaving the definitions in main.cpp but expose them with an independent header like main_test.h or something. Just a random thought.\r\n\r\nI'm basically focusing on consensus and policy checks. Trying to take advantage of potential similarities between their dependencies. Right now it's kind of a mess that doesn't even pass the tests, but if you're curious, here's my latest branch on that: https://github.com/jtimon/bitcoin/commits/consensus_policy\r\nI guess it mostly falls into the \"d\" category, with a little bit of \"a\" as you move constants and globals out.\r\nThis (and therefore #5669 and the longest branch) needed rebase.\r\nI'm also trying to isolate a good small base for policy to use as an example and confirm what I think @luke-jr and I (and hopefully everyone) can agree on.\r\n",
      "created_at" : "2015-01-20T20:33:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5681#issuecomment-70727519",
      "id" : 70727519,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5681",
      "updated_at" : "2015-01-20T20:33:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/70727519",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Pretty cool, that you are following the ordering style still ^^. Does this also speedup compilation times, did you benchmark it?",
      "created_at" : "2015-01-20T21:56:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5681#issuecomment-70742296",
      "id" : 70742296,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5681",
      "updated_at" : "2015-01-20T21:56:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/70742296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "body" : "@Diapolo thanks for double-checking the include alphabetical order. \r\nI believe it does speedup compilation times, but I haven't benchmarked it. Some benchmarks would be great if you want to do them.",
      "created_at" : "2015-01-21T11:05:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5681#issuecomment-70819604",
      "id" : 70819604,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5681",
      "updated_at" : "2015-01-21T11:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/70819604",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "I left the final commit cleaning up the includes for later.\r\nIt is the hardest to review. The remaining commits are practically move-only. The only change is creating ```CMainSignals& GetMainSignals()``` for accessing g_signals from main. So the PR becomes trivial to review and it's much less likely to need rebases.\r\nOn the other hand the cleaning up commit is likely to need frequent rebase and would likely break many open PRs so I've created #5697 which builds on top of this as well as on other useful and trivial preparations for consensus and policy code movements (#5696).",
      "created_at" : "2015-01-23T13:04:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5681#issuecomment-71190293",
      "id" : 71190293,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5681",
      "updated_at" : "2015-01-23T13:04:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/71190293",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Needed rebase.",
      "created_at" : "2015-02-03T18:16:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5681#issuecomment-72703844",
      "id" : 72703844,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5681",
      "updated_at" : "2015-02-03T18:16:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/72703844",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Needed rebase. I added a commit to not include main.h from any other header again, but it's not a big and exhaustive cleanup as it was at the beginning. I still leave that for #5697 after more code movements.",
      "created_at" : "2015-02-05T01:08:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5681#issuecomment-72975558",
      "id" : 72975558,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5681",
      "updated_at" : "2015-02-05T01:08:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/72975558",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   }
]
