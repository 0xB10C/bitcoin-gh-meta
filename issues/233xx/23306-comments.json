[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23077](https://github.com/bitcoin/bitcoin/pull/23077) (Full CJDNS support by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-10-19T08:26:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-946479992",
      "id" : 946479992,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844aiN4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946479992/reactions"
      },
      "updated_at" : "2021-10-19T08:26:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946479992",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> For a long part of Bitcoin's history, this codebase has aggressively avoided making automatic connections to anything but nodes running on port 8333. I'd like to propose changing that, and this is a first PR necessary for that.\r\n\r\nConcept ACK for allowing automatic connections to nodes which are not using default ports\r\n\r\n> This concern is (a) no different than what is possible with IPv6 (where large ranges of IP addresses are very cheaply available), and (b) already hopefully sufficiently addressed by addrman's design (which limits access through based selected based on network groups).\r\n\r\nAgree \r\n\r\n> And this policy has downsides too; in particular, a fixed port is easy to detect, and a very obvious sign a Bitcoin node is running there.\r\n\r\nI found UA string as the easiest way to look for Bitcoin nodes while using [shodan](https://www.shodan.io/search/facet?query=User-Agent%3A%2FSatoshi%2F&facet=port) in which I could also see few nodes using non-default ports:\r\n\r\n![image](https://user-images.githubusercontent.com/13405205/137878976-98a5b408-d803-4e8a-9569-4e13b6c1ce18.png)\r\n\r\n![image](https://user-images.githubusercontent.com/13405205/137878986-a0b31970-82c1-487a-8299-333e380780c8.png)\r\n\r\n```\r\n    \"addr\": \"193.32.127.161:58477\",\r\n    \"addrbind\": \"192.168.1.4:60877\",\r\n    \"network\": \"ipv4\",\r\n```\r\n\r\nIgnore if its not related: Few users use Tor hidden services and different ports for RPC as explained in [Learning-Bitcoin-from-the-Command-Line/Verifying_Your_Tor_Setup.md](https://github.com/BlockchainCommons/Learning-Bitcoin-from-the-Command-Line/blob/master/14_1_Verifying_Your_Tor_Setup.md)",
      "created_at" : "2021-10-19T09:15:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-946520083",
      "id" : 946520083,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844asAT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946520083/reactions"
      },
      "updated_at" : "2021-10-19T09:15:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946520083",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\n\r\n> For a long part of Bitcoin's history, this codebase has aggressively avoided making automatic connections to anything but nodes running on port 8333. I'd like to propose changing that, and this is a first PR necessary for that.\r\n\r\nPort 8333 is the cheapest fingerprint for a Bitcoin node. The _possibility_ of port randomization is quite exciting as we will be able to use the raised floor of fingerprinting cost from BIP324.\r\n\r\nWill code review this week.",
      "created_at" : "2021-10-19T14:32:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-946785776",
      "id" : 946785776,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844bs3w",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946785776/reactions"
      },
      "updated_at" : "2021-10-19T14:32:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946785776",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Changes look pretty straightforward.",
      "created_at" : "2021-10-19T18:04:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-946971010",
      "id" : 946971010,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844caGC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946971010/reactions"
      },
      "updated_at" : "2021-10-19T18:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/946971010",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r732613976"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732613976"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why cast to reference? Is that not the same as `static_cast<const CService>(...)`?",
      "commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "created_at" : "2021-10-20T10:01:38Z",
      "diff_hunk" : "@@ -137,24 +137,31 @@ class AddrManDeterministic : public AddrMan\n         // Check that all values in `mapInfo` are equal to all values in `other.mapInfo`.\n         // Keys may be different.\n \n-        using AddrInfoHasher = std::function<size_t(const AddrInfo&)>;\n         using AddrInfoEq = std::function<bool(const AddrInfo&, const AddrInfo&)>;\n \n-        CNetAddrHash netaddr_hasher;\n-\n-        AddrInfoHasher addrinfo_hasher = [&netaddr_hasher](const AddrInfo& a) {\n-            return netaddr_hasher(static_cast<CNetAddr>(a)) ^ netaddr_hasher(a.source) ^\n-                   a.nLastSuccess ^ a.nAttempts ^ a.nRefCount ^ a.fInTried;\n+        auto addrinfo_hasher = [](const AddrInfo& a) {\n+            CSipHasher hasher(0, 0);\n+            auto addr_key = a.GetKey();\n+            auto source_key = a.source.GetAddrBytes();\n+            hasher.Write(a.nLastSuccess);\n+            hasher.Write(a.nAttempts);\n+            hasher.Write(a.nRefCount);\n+            hasher.Write(a.fInTried);\n+            hasher.Write(addr_key.size());\n+            hasher.Write(source_key.size());\n+            hasher.Write(addr_key.data(), addr_key.size());\n+            hasher.Write(source_key.data(), source_key.size());\n+            return (size_t)hasher.Finalize();\n         };\n \n         AddrInfoEq addrinfo_eq = [](const AddrInfo& lhs, const AddrInfo& rhs) {\n-            return static_cast<CNetAddr>(lhs) == static_cast<CNetAddr>(rhs) &&\n+            return static_cast<const CService&>(lhs) == static_cast<const CService&>(rhs) &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r732613976",
      "id" : 732613976,
      "line" : 158,
      "node_id" : "PRRC_kwDOABII584rqs1Y",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 158,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : 29,
      "pull_request_review_id" : 784266773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732613976/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T12:31:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732613976",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> The folklore justification (eventually actually added as a comment to the codebase in #20668) is that this is to prevent the Bitcoin P2P network from being leveraged to perform a DoS attack on other services, if their IP/port would get rumoured. [â¦]Â  Another possible justification would be a risk that treating different IP:port combinations separately would help perform Eclipse attacks (by an attacker rumouring their own IP with many ports). \r\n\r\nA third concern (which I think can be addressed: see below) could be that Bitcoin Core users would risk having to deal with bogus complaints along the lines of \"why am I seeing a failed SSH-login to my server on port 22 from your IP-address `w.x.y.z`?\" if we allowed for automatic outgoing connections on _all_ ports by default.\r\n\r\nWhen opening up for additional port numbers we might want to look at how browsers are tackling \"bad ports\":\r\n* [`kRestrictedPorts` in Chromium](https://chromium.googlesource.com/chromium/src.git/+/refs/heads/main/net/base/port_util.cc)\r\n* [`gBadPortList` in Firefox](https://hg.mozilla.org/mozilla-central/file/tip/netwerk/base/nsIOService.cpp)\r\n* [Definition of \"bad port\" in whatwg's Fetch standard](https://fetch.spec.whatwg.org/#port-blocking)\r\n\r\nAvoiding \"bad ports\" (or a subset of these ports) by default is probably a cheap way to reduce the likelihood of  Bitcoin Core users having to deal with these types of bogus complaints.\r\n\r\nAn alternative route would be to explicitly whitelist (by default) a set of \"good ports\" which a.) have low likelihood of causing said type of complaints, and b.) are unlikely to be firewalled.\r\n",
      "created_at" : "2021-10-20T10:01:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-947516736",
      "id" : 947516736,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844efVA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/947516736/reactions"
      },
      "updated_at" : "2021-10-20T10:05:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/947516736",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r732619057"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732619057"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This does not take into account `CNetAddr::m_net`. So, two addresses from different networks with the same address bytes would hash the same. I think this is fine coz IPv4 and IPv6 have different length of the address. It could happen that a Tor address hashes the same as I2P address if they have identical 32 bytes :eyes:. I think this is ok for tests.",
      "commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "created_at" : "2021-10-20T10:08:17Z",
      "diff_hunk" : "@@ -137,24 +137,31 @@ class AddrManDeterministic : public AddrMan\n         // Check that all values in `mapInfo` are equal to all values in `other.mapInfo`.\n         // Keys may be different.\n \n-        using AddrInfoHasher = std::function<size_t(const AddrInfo&)>;\n         using AddrInfoEq = std::function<bool(const AddrInfo&, const AddrInfo&)>;\n \n-        CNetAddrHash netaddr_hasher;\n-\n-        AddrInfoHasher addrinfo_hasher = [&netaddr_hasher](const AddrInfo& a) {\n-            return netaddr_hasher(static_cast<CNetAddr>(a)) ^ netaddr_hasher(a.source) ^\n-                   a.nLastSuccess ^ a.nAttempts ^ a.nRefCount ^ a.fInTried;\n+        auto addrinfo_hasher = [](const AddrInfo& a) {\n+            CSipHasher hasher(0, 0);\n+            auto addr_key = a.GetKey();\n+            auto source_key = a.source.GetAddrBytes();\n+            hasher.Write(a.nLastSuccess);\n+            hasher.Write(a.nAttempts);\n+            hasher.Write(a.nRefCount);\n+            hasher.Write(a.fInTried);\n+            hasher.Write(addr_key.size());\n+            hasher.Write(source_key.size());\n+            hasher.Write(addr_key.data(), addr_key.size());\n+            hasher.Write(source_key.data(), source_key.size());\n+            return (size_t)hasher.Finalize();\n         };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r732619057",
      "id" : 732619057,
      "line" : 155,
      "node_id" : "PRRC_kwDOABII584rquEx",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 155,
      "original_position" : 25,
      "original_start_line" : 142,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : 25,
      "pull_request_review_id" : 784266773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732619057/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 142,
      "start_side" : "RIGHT",
      "updated_at" : "2021-10-20T12:31:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732619057",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r732619501"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732619501"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why write the size? Is it not unnecessary given that we also write the data?",
      "commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "created_at" : "2021-10-20T10:08:52Z",
      "diff_hunk" : "@@ -137,24 +137,31 @@ class AddrManDeterministic : public AddrMan\n         // Check that all values in `mapInfo` are equal to all values in `other.mapInfo`.\n         // Keys may be different.\n \n-        using AddrInfoHasher = std::function<size_t(const AddrInfo&)>;\n         using AddrInfoEq = std::function<bool(const AddrInfo&, const AddrInfo&)>;\n \n-        CNetAddrHash netaddr_hasher;\n-\n-        AddrInfoHasher addrinfo_hasher = [&netaddr_hasher](const AddrInfo& a) {\n-            return netaddr_hasher(static_cast<CNetAddr>(a)) ^ netaddr_hasher(a.source) ^\n-                   a.nLastSuccess ^ a.nAttempts ^ a.nRefCount ^ a.fInTried;\n+        auto addrinfo_hasher = [](const AddrInfo& a) {\n+            CSipHasher hasher(0, 0);\n+            auto addr_key = a.GetKey();\n+            auto source_key = a.source.GetAddrBytes();\n+            hasher.Write(a.nLastSuccess);\n+            hasher.Write(a.nAttempts);\n+            hasher.Write(a.nRefCount);\n+            hasher.Write(a.fInTried);\n+            hasher.Write(addr_key.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r732619501",
      "id" : 732619501,
      "line" : 150,
      "node_id" : "PRRC_kwDOABII584rquLt",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 150,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : 20,
      "pull_request_review_id" : 784266773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732619501/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T12:31:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732619501",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r732708382"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732708382"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    //! find an nId based on its network address and port\r\n```",
      "commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "created_at" : "2021-10-20T12:10:13Z",
      "diff_hunk" : "@@ -180,7 +180,7 @@ class AddrManImpl\n     std::unordered_map<int, AddrInfo> mapInfo GUARDED_BY(cs);\n \n     //! find an nId based on its network address",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r732708382",
      "id" : 732708382,
      "line" : 182,
      "node_id" : "PRRC_kwDOABII584rrD4e",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 182,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "src/addrman_impl.h",
      "position" : 3,
      "pull_request_review_id" : 784266773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732708382/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T12:31:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732708382",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.\r\nInterested in addressing the [point](https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-947516736) by practicalswift (either dismissing or accepting, but with rationale).\r\n\r\nOtherwise, I agree this change is beneficial and I don't see any real harm.",
      "created_at" : "2021-10-21T12:13:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-948553223",
      "id" : 948553223,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844icYH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/948553223/reactions"
      },
      "updated_at" : "2021-10-21T12:13:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/948553223",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r733627448"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733627448"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`static_cast<const CService>` constructs a new `CService` object which is a copy of the `CService` inside the `AddrInfo`. `static_cast<const CService&>` just constructs a reference to that `CService` object.",
      "commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "created_at" : "2021-10-21T12:32:49Z",
      "diff_hunk" : "@@ -137,24 +137,31 @@ class AddrManDeterministic : public AddrMan\n         // Check that all values in `mapInfo` are equal to all values in `other.mapInfo`.\n         // Keys may be different.\n \n-        using AddrInfoHasher = std::function<size_t(const AddrInfo&)>;\n         using AddrInfoEq = std::function<bool(const AddrInfo&, const AddrInfo&)>;\n \n-        CNetAddrHash netaddr_hasher;\n-\n-        AddrInfoHasher addrinfo_hasher = [&netaddr_hasher](const AddrInfo& a) {\n-            return netaddr_hasher(static_cast<CNetAddr>(a)) ^ netaddr_hasher(a.source) ^\n-                   a.nLastSuccess ^ a.nAttempts ^ a.nRefCount ^ a.fInTried;\n+        auto addrinfo_hasher = [](const AddrInfo& a) {\n+            CSipHasher hasher(0, 0);\n+            auto addr_key = a.GetKey();\n+            auto source_key = a.source.GetAddrBytes();\n+            hasher.Write(a.nLastSuccess);\n+            hasher.Write(a.nAttempts);\n+            hasher.Write(a.nRefCount);\n+            hasher.Write(a.fInTried);\n+            hasher.Write(addr_key.size());\n+            hasher.Write(source_key.size());\n+            hasher.Write(addr_key.data(), addr_key.size());\n+            hasher.Write(source_key.data(), source_key.size());\n+            return (size_t)hasher.Finalize();\n         };\n \n         AddrInfoEq addrinfo_eq = [](const AddrInfo& lhs, const AddrInfo& rhs) {\n-            return static_cast<CNetAddr>(lhs) == static_cast<CNetAddr>(rhs) &&\n+            return static_cast<const CService&>(lhs) == static_cast<const CService&>(rhs) &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#discussion_r733627448",
      "id" : 733627448,
      "in_reply_to_id" : 732613976,
      "line" : 158,
      "node_id" : "PRRC_kwDOABII584rukQ4",
      "original_commit_id" : "5697d6054a1aaec0f89a8c8ce792d5e9f5c02314",
      "original_line" : 158,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : 29,
      "pull_request_review_id" : 785626517,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733627448/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-21T12:32:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733627448",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@practicalswift That's a reasonable concern. I think as a first step, the policy could e.g. still maintain the deprioritization of connections to ports numbered < 1024.",
      "created_at" : "2021-10-21T20:49:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23306#issuecomment-948991979",
      "id" : 948991979,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23306",
      "node_id" : "IC_kwDOABII5844kHfr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/948991979/reactions"
      },
      "updated_at" : "2021-10-21T20:49:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/948991979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
