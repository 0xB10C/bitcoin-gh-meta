[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I will add tests after initial review",
      "created_at" : "2021-10-20T05:51:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23319#issuecomment-947349693",
      "id" : 947349693,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23319",
      "node_id" : "IC_kwDOABII5844d2i9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/947349693/reactions"
      },
      "updated_at" : "2021-10-20T05:51:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/947349693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/976425?v=4",
         "events_url" : "https://api.github.com/users/dougEfresh/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dougEfresh/followers",
         "following_url" : "https://api.github.com/users/dougEfresh/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dougEfresh/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dougEfresh",
         "id" : 976425,
         "login" : "dougEfresh",
         "node_id" : "MDQ6VXNlcjk3NjQyNQ==",
         "organizations_url" : "https://api.github.com/users/dougEfresh/orgs",
         "received_events_url" : "https://api.github.com/users/dougEfresh/received_events",
         "repos_url" : "https://api.github.com/users/dougEfresh/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dougEfresh/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dougEfresh/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dougEfresh"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23319#discussion_r732469998"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23319"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732469998"
         }
      },
      "author_association" : "MEMBER",
      "body" : "wouldn't it make sense to combine the `!blockindex` check here?",
      "commit_id" : "2730b680d250a5e258c38e9d638baf36e78bc17e",
      "created_at" : "2021-10-20T07:03:19Z",
      "diff_hunk" : "@@ -211,8 +213,28 @@ static RPCHelpMan getrawtransaction()\n     }\n \n     UniValue result(UniValue::VOBJ);\n-    if (blockindex) result.pushKV(\"in_active_chain\", in_active_chain);\n-    TxToJSON(*tx, hash_block, result, chainman.ActiveChainstate());\n+    if (!blockindex) {\n+        TxToJSON(*tx, hash_block, result, chainman.ActiveChainstate());\n+        return result;\n+    }\n+    result.pushKV(\"in_active_chain\", in_active_chain);\n+\n+    std::optional<size_t>  opt_tx_position{std::nullopt};\n+    CBlockUndo blockUndo;\n+    CBlock block;\n+    if (IsBlockPruned(blockindex) || !(UndoReadFromDisk(blockUndo, blockindex) && ReadBlockFromDisk(block, blockindex, Params().GetConsensus()))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23319#discussion_r732469998",
      "id" : 732469998,
      "line" : 225,
      "node_id" : "PRRC_kwDOABII584rqJru",
      "original_commit_id" : "2730b680d250a5e258c38e9d638baf36e78bc17e",
      "original_line" : 225,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 48,
      "pull_request_review_id" : 784071729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23319",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732469998/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T07:04:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732469998",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23319#discussion_r732470233"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23319"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732470233"
         }
      },
      "author_association" : "MEMBER",
      "body" : "it is optional?",
      "commit_id" : "2730b680d250a5e258c38e9d638baf36e78bc17e",
      "created_at" : "2021-10-20T07:03:46Z",
      "diff_hunk" : "@@ -97,6 +98,7 @@ static RPCHelpMan getrawtransaction()\n                          {\n                              {RPCResult::Type::BOOL, \"in_active_chain\", /* optional */ true, \"Whether specified block is in the active chain or not (only present with explicit \\\"blockhash\\\" argument)\"},\n                              {RPCResult::Type::STR_HEX, \"hex\", \"The serialized, hex-encoded data for 'txid'\"},\n+                             {RPCResult::Type::STR_AMOUNT, \"fee\", \"transaction fee in \" + CURRENCY_UNIT},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23319#discussion_r732470233",
      "id" : 732470233,
      "line" : 101,
      "node_id" : "PRRC_kwDOABII584rqJvZ",
      "original_commit_id" : "2730b680d250a5e258c38e9d638baf36e78bc17e",
      "original_line" : 101,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 29,
      "pull_request_review_id" : 784071729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23319",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732470233/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T07:04:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732470233",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23319#discussion_r732734970"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23319"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732734970"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "yes, and moved",
      "commit_id" : "d3f084a19bd930a365dcc1f6538d29570241d12c",
      "created_at" : "2021-10-20T12:42:53Z",
      "diff_hunk" : "@@ -211,8 +213,28 @@ static RPCHelpMan getrawtransaction()\n     }\n \n     UniValue result(UniValue::VOBJ);\n-    if (blockindex) result.pushKV(\"in_active_chain\", in_active_chain);\n-    TxToJSON(*tx, hash_block, result, chainman.ActiveChainstate());\n+    if (!blockindex) {\n+        TxToJSON(*tx, hash_block, result, chainman.ActiveChainstate());\n+        return result;\n+    }\n+    result.pushKV(\"in_active_chain\", in_active_chain);\n+\n+    std::optional<size_t>  opt_tx_position{std::nullopt};\n+    CBlockUndo blockUndo;\n+    CBlock block;\n+    if (IsBlockPruned(blockindex) || !(UndoReadFromDisk(blockUndo, blockindex) && ReadBlockFromDisk(block, blockindex, Params().GetConsensus()))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23319#discussion_r732734970",
      "id" : 732734970,
      "in_reply_to_id" : 732469998,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584rrKX6",
      "original_commit_id" : "2730b680d250a5e258c38e9d638baf36e78bc17e",
      "original_line" : 225,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 784429612,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23319",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732734970/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T12:42:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732734970",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/976425?v=4",
         "events_url" : "https://api.github.com/users/dougEfresh/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dougEfresh/followers",
         "following_url" : "https://api.github.com/users/dougEfresh/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dougEfresh/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dougEfresh",
         "id" : 976425,
         "login" : "dougEfresh",
         "node_id" : "MDQ6VXNlcjk3NjQyNQ==",
         "organizations_url" : "https://api.github.com/users/dougEfresh/orgs",
         "received_events_url" : "https://api.github.com/users/dougEfresh/received_events",
         "repos_url" : "https://api.github.com/users/dougEfresh/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dougEfresh/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dougEfresh/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dougEfresh"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23319#discussion_r732741166"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23319"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732741166"
         }
      },
      "author_association" : "MEMBER",
      "body" : "this is an unrelated behavior change",
      "commit_id" : "d3f084a19bd930a365dcc1f6538d29570241d12c",
      "created_at" : "2021-10-20T12:49:52Z",
      "diff_hunk" : "@@ -211,8 +213,24 @@ static RPCHelpMan getrawtransaction()\n     }\n \n     UniValue result(UniValue::VOBJ);\n-    if (blockindex) result.pushKV(\"in_active_chain\", in_active_chain);\n-    TxToJSON(*tx, hash_block, result, chainman.ActiveChainstate());\n+    std::optional<size_t>  opt_tx_position{std::nullopt};\n+    CBlockUndo blockUndo;\n+    CBlock block;\n+    if (!blockindex || IsBlockPruned(blockindex) || !(UndoReadFromDisk(blockUndo, blockindex) && ReadBlockFromDisk(block, blockindex, Params().GetConsensus()))) {\n+        TxToJSON(*tx, hash_block, result, chainman.ActiveChainstate());\n+        return result;\n+    }\n+    result.pushKV(\"in_active_chain\", in_active_chain);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23319#discussion_r732741166",
      "id" : 732741166,
      "line" : 226,
      "node_id" : "PRRC_kwDOABII584rrL4u",
      "original_commit_id" : "25989832aacc77dc362410debf7df718e48b5852",
      "original_line" : 226,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 49,
      "pull_request_review_id" : 784437933,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23319",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732741166/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T12:49:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732741166",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23319#discussion_r732779544"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23319"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732779544"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "right. good catch. ",
      "commit_id" : "d3f084a19bd930a365dcc1f6538d29570241d12c",
      "created_at" : "2021-10-20T13:30:32Z",
      "diff_hunk" : "@@ -211,8 +213,24 @@ static RPCHelpMan getrawtransaction()\n     }\n \n     UniValue result(UniValue::VOBJ);\n-    if (blockindex) result.pushKV(\"in_active_chain\", in_active_chain);\n-    TxToJSON(*tx, hash_block, result, chainman.ActiveChainstate());\n+    std::optional<size_t>  opt_tx_position{std::nullopt};\n+    CBlockUndo blockUndo;\n+    CBlock block;\n+    if (!blockindex || IsBlockPruned(blockindex) || !(UndoReadFromDisk(blockUndo, blockindex) && ReadBlockFromDisk(block, blockindex, Params().GetConsensus()))) {\n+        TxToJSON(*tx, hash_block, result, chainman.ActiveChainstate());\n+        return result;\n+    }\n+    result.pushKV(\"in_active_chain\", in_active_chain);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23319#discussion_r732779544",
      "id" : 732779544,
      "in_reply_to_id" : 732741166,
      "line" : 226,
      "node_id" : "PRRC_kwDOABII584rrVQY",
      "original_commit_id" : "25989832aacc77dc362410debf7df718e48b5852",
      "original_line" : 226,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 49,
      "pull_request_review_id" : 784490365,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23319",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732779544/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T13:30:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/732779544",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/976425?v=4",
         "events_url" : "https://api.github.com/users/dougEfresh/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dougEfresh/followers",
         "following_url" : "https://api.github.com/users/dougEfresh/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dougEfresh/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dougEfresh",
         "id" : 976425,
         "login" : "dougEfresh",
         "node_id" : "MDQ6VXNlcjk3NjQyNQ==",
         "organizations_url" : "https://api.github.com/users/dougEfresh/orgs",
         "received_events_url" : "https://api.github.com/users/dougEfresh/received_events",
         "repos_url" : "https://api.github.com/users/dougEfresh/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dougEfresh/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dougEfresh/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dougEfresh"
      }
   }
]
